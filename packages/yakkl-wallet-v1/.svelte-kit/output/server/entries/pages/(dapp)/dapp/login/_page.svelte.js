import{p as push,h as copy_payload,i as assign_payload,c as pop,a as push_element,b as pop_element,j as store_set}from"../../../../../chunks/index2.js";import{p as page}from"../../../../../chunks/index3.js";import{b as browserSvelte}from"../../../../../chunks/environment.js";import{L as Login}from"../../../../../chunks/Login.js";import{y as yakklUserNameStore,b as yakklDappConnectRequestStore,s as syncStorageToStore,l as log}from"../../../../../chunks/encryption.js";import{s as safeLogout,a as safeNavigate}from"../../../../../chunks/safeNavigate.js";import{messagingService,startActivityTracking}from"../../../../../chunks/messaging.js";import{E as ErrorNoAction}from"../../../../../chunks/ErrorNoAction.js";import{W as Welcome}from"../../../../../chunks/Welcome.js";import{p as protectedContexts}from"../../../../../chunks/globals.js";import{F as FILENAME}from"../../../../../chunks/utils.js";_page[FILENAME]="src/routes/(dapp)/dapp/login/+page.svelte";function _page($$payload,$$props){push(_page);let requestId="";let method="";let showError=false;let errorValue="";let approvalUrl="";function getApprovalUrl(){if(!method)return"/dapp/popups/approve/";switch(method){case"eth_requestAccounts":return"/dapp/popups/accounts/";case"eth_sendTransaction":return"/dapp/popups/transactions/";case"eth_signTypedData_v4":case"personal_sign":case"eth_signTransaction":return"/dapp/popups/sign/";case"wallet_requestPermissions":case"wallet_revokePermissions":case"wallet_getPermissions":return"/dapp/popups/permissions/";case"wallet_switchEthereumChain":return"/dapp/popups/wallet/";default:return"/dapp/popups/approve/"}}function initializeFromUrl(){if(!browserSvelte)return;const urlRequestId=page.url.searchParams.get("requestId")??"";requestId=urlRequestId;method=page.url.searchParams.get("method")??"";approvalUrl=getApprovalUrl();console.log("approvalUrl",approvalUrl);console.log("requestId",requestId);console.log("method",method)}initializeFromUrl();function onSuccess(profile,digest,isMinimal){try{if(!browserSvelte)return;store_set(yakklUserNameStore,profile.userName||"");store_set(yakklDappConnectRequestStore,requestId);syncStorageToStore();const contextType="popup-dapp";if(protectedContexts.includes(contextType)){log.info(`Starting activity tracking for protected context: ${contextType}`);startActivityTracking(contextType)}else{log.info(`Skipping activity tracking for non-protected context: ${contextType}`)}const url=`${approvalUrl}?requestId=${requestId}&method=${method}`;safeNavigate(url)}catch(e){log.error("Error during post-login initialization",false,e);errorValue=e;showError=true;messagingService.sendMessage("rejectRequest",{requestId:requestId,error:"Authentication failed"})}}function onError(value){if(!browserSvelte)return;errorValue=value;showError=true;messagingService.sendMessage("rejectRequest",{requestId:requestId,error:"Authentication failed"})}function onCancel(){if(!browserSvelte)return;safeLogout()}function onClose(){if(!browserSvelte)return;showError=false;errorValue=""}let $$settled=true;let $$inner_payload;function $$render_inner($$payload2){ErrorNoAction($$payload2,{title:"ERROR!",value:errorValue,onClose:onClose,get show(){return showError},set show($$value){showError=$$value;$$settled=false}});$$payload2.out+=`\x3c!----\x3e <div class="relative h-[98vh] text-base-content">`;push_element($$payload2,"div",100,0);$$payload2.out+=`<main class="px-4 text-center">`;push_element($$payload2,"main",101,1);Welcome($$payload2,{});$$payload2.out+=`\x3c!----\x3e <div class="mt-5">`;push_element($$payload2,"div",104,2);Login($$payload2,{minimumAuth:true,requestId:requestId,method:method,onSuccess:onSuccess,onError:onError,onCancel:onCancel,loginButtonText:"Unlock",cancelButtonText:"Exit/Logout"});$$payload2.out+=`\x3c!----\x3e</div>`;pop_element();$$payload2.out+=`</main>`;pop_element();$$payload2.out+=`</div>`;pop_element()}do{$$settled=true;$$inner_payload=copy_payload($$payload);$$render_inner($$inner_payload)}while(!$$settled);assign_payload($$payload,$$inner_payload);pop()}_page.render=function(){throw new Error("Component.render(...) is no longer valid in Svelte 5. See https://svelte.dev/docs/svelte/v5-migration-guide#Components-are-no-longer-classes for more information")};export{_page as default};
//# sourceMappingURL=_page.svelte.js.map
