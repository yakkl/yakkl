{"version":3,"file":"_page.svelte.js","sources":["../../../../../../../../../src/lib/common/duplexShim.ts","../../../../../../../../../src/lib/managers/PortStreamManager.ts","../../../../../../../../../src/lib/managers/PortManagerWithStream.ts","../../../../../../../../../src/routes/(dapp)/dapp/popups/approve/+page.svelte"],"sourcesContent":["// File: src/lib/common/duplexShim.ts\nimport { browserSvelte } from '$lib/common/environment';\n\nexport async function getDuplex(): Promise<any> {\n\tif (browserSvelte) {\n\t\tconst mod = await import('stream-browserify');\n\t\treturn mod.Duplex;\n\t} else {\n\t\tconst mod = await import('readable-stream');\n\t\treturn mod.Duplex;\n\t}\n}\n","// File: PortStreamManager.ts\nimport { log } from '$lib/common/logger-wrapper';\nimport { browser_ext } from '$lib/common/environment';\nimport type { Runtime } from 'webextension-polyfill';\nimport { getDuplex } from '$lib/common/duplexShim';\nimport type { Duplex as StreamDuplex } from 'readable-stream'; // or 'stream'\n\nexport interface LightweightDuplex {\n\twrite(chunk: any): void;\n\ton(event: string, handler: (...args: any[]) => void): void;\n\tdestroy(): void;\n\tpush?(chunk: any): boolean;\n}\nexport class PortDuplexStream {\n\tprivate port: Runtime.Port;\n\tprivate stream: LightweightDuplex;\n\tprivate inflight = 0;\n\n\tconstructor(port: Runtime.Port, stream: LightweightDuplex) {\n\t\tthis.port = port;\n\t\tthis.stream = stream;\n\n\t\tthis.port.onMessage.addListener(this._onMessage.bind(this));\n\t\tthis.port.onDisconnect.addListener(() => this.destroy());\n\t}\n\n\tprivate _onMessage(message: any) {\n\t\ttry {\n\t\t\tlog.info('PortDuplexStream _onMessage:', false, message);\n\t\t\tthis.inflight = Math.max(0, this.inflight - 1);\n\t\t\tthis.stream.push(message);\n\t\t} catch (err) {\n\t\t\tlog.error('PortDuplexStream _onMessage error', false, err);\n\t\t}\n\t}\n\n\twrite(msg: any) {\n\t\tlog.info('PortDuplexStream write:', false, msg);\n\t\tthis.inflight++;\n\t\tthis.port.postMessage(msg);\n\t}\n\n\ton(event: string, handler: (...args: any[]) => void) {\n\t\tlog.info('PortDuplexStream on:', false, event);\n\t\tthis.stream.on(event, handler);\n\t}\n\n\tdestroy() {\n\t\tlog.info('PortDuplexStream destroy:', false);\n\t\tthis.port.disconnect();\n\t\tthis.stream.destroy();\n\t}\n\n\tisIdle() {\n\t\treturn this.inflight === 0;\n\t}\n\n\tasync waitForIdle(timeout = 3000) {\n\t\tlog.info('PortDuplexStream waitForIdle:', false, timeout);\n\t\tconst start = Date.now();\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\tconst check = () => {\n\t\t\t\tif (this.isIdle()) return resolve();\n\t\t\t\tif (Date.now() - start > timeout)\n\t\t\t\t\treturn reject(new Error('Timed out waiting for port to go idle'));\n\t\t\t\tsetTimeout(check, 50);\n\t\t\t};\n\t\t\tcheck();\n\t\t});\n\t}\n}\n\nexport async function createPortStream(channelName = 'secure'): Promise<PortDuplexStream> {\n\tconst port = browser_ext.runtime.connect({ name: channelName });\n\tconst Duplex = await getDuplex();\n\n\tclass WrappedStream extends Duplex {\n\t\tconstructor() {\n\t\t\tsuper({ objectMode: true });\n\t\t}\n\t\t_read() {}\n\t\t_write(_chunk: any, _enc: string, cb: () => void) {\n\t\t\tcb();\n\t\t}\n\t}\n\n\tconst stream = new WrappedStream() as unknown as LightweightDuplex;\n\treturn new PortDuplexStream(port, stream);\n}\n","import { getDuplex } from '$lib/common/duplexShim';\nimport { PortDuplexStream, type LightweightDuplex } from './PortStreamManager';\nimport { log } from '$lib/common/logger-wrapper';\nimport { browser_ext, isClient, getBrowserExt } from '$lib/common/environment';\nimport type { Runtime } from 'webextension-polyfill';\nimport type { DuplexOptions } from 'stream';\n\nexport class PortManagerWithStream {\n\tprivate port: Runtime.Port | null = null;\n\tprivate stream: PortDuplexStream | null = null;\n\tprivate requestId: string | null = null;\n\tprivate readonly name: string;\n\n\tconstructor(name: string) {\n\t\tthis.name = name;\n\t}\n\n\tasync createPort() {\n\t\tif (this.port && this.stream) return true;\n\n\t\tconst ext = isClient ? getBrowserExt() : browser_ext;\n\t\tif (!ext || !ext.runtime?.connect) {\n\t\t\tlog.error('Extension API not available for PortManagerWithStream');\n\t\t\treturn false;\n\t\t}\n\n\t\ttry {\n\t\t\tthis.port = ext.runtime.connect({ name: this.name });\n\t\t\tconst Duplex = await getDuplex();\n\t\t\tclass CustomDuplex extends Duplex implements LightweightDuplex {\n\t\t\t\tconstructor() {\n\t\t\t\t\tsuper({ objectMode: true });\n\t\t\t\t}\n\n\t\t\t\t_read() {}\n\t\t\t\t_write(_chunk: any, _enc: string, cb: () => void) {\n\t\t\t\t\tcb();\n\t\t\t\t}\n\n\t\t\t\twrite(chunk: any): void {\n\t\t\t\t\tsuper.write(chunk);\n\t\t\t\t}\n\n\t\t\t\ton(event: string, handler: (...args: any[]) => void): void {\n\t\t\t\t\tsuper.on(event, handler);\n\t\t\t\t}\n\n\t\t\t\tdestroy(): void {\n\t\t\t\t\tsuper.destroy();\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst baseStream = new CustomDuplex();\n\t\t\tthis.stream = new PortDuplexStream(this.port, baseStream); // Pass both port and stream\n\t\t\treturn true;\n\t\t} catch (error) {\n\t\t\tlog.error('Failed to create port stream', false, error);\n\t\t\tthis.port = null;\n\t\t\tthis.stream = null;\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tgetStream() {\n\t\treturn this.stream;\n\t}\n\n\tgetPort() {\n\t\treturn this.port;\n\t}\n\n\tisIdle() {\n\t\treturn this.stream?.isIdle() ?? true;\n\t}\n\n\tasync waitForIdle(timeout = 3000) {\n\t\treturn this.stream?.waitForIdle(timeout);\n\t}\n\n\tdisconnect() {\n\t\ttry {\n\t\t\tif (this.port && this.requestId) {\n\t\t\t\tbrowser_ext.runtime.sendMessage({\n\t\t\t\t\ttype: 'UNREGISTER_SESSION_PORT',\n\t\t\t\t\trequestId: this.requestId\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.stream?.destroy();\n\t\t} catch (err) {\n\t\t\tlog.warn('Error destroying port stream', false, err);\n\t\t}\n\t\tthis.stream = null;\n\t\tthis.port = null;\n\t\tthis.requestId = null;\n\t}\n\n\tsetRequestId(requestId: string) {\n\t\tthis.requestId = requestId;\n\t}\n\n\tgetRequestId() {\n\t\treturn this.requestId;\n\t}\n\n\tclearRequestId() {\n\t\tthis.requestId = null;\n\t}\n}\n\nexport function createPortManagerWithStream(name: string = 'secure') {\n\treturn new PortManagerWithStream(name);\n}\n","<script lang=\"ts\">\n\timport { browserSvelte } from '$lib/common/environment';\n\timport { page } from '$app/state';\n\t// The grayed out store items are for testing purposes used in the clearData function\n\timport {\n\t\tgetMiscStore,\n\t\tgetSettings,\n\t\tyakklDappConnectRequestStore,\n\t\tyakklMiscStore\n\t} from '$lib/common/stores';\n\timport { PATH_LOGIN, YAKKL_DAPP, DEFAULT_TITLE } from '$lib/common/constants';\n\timport { onMount } from 'svelte';\n\timport Copyright from '$lib/components/Copyright.svelte';\n\timport Failed from '$lib/components/Failed.svelte';\n\timport { log } from '$lib/common/logger-wrapper';\n\timport type { Runtime } from 'webextension-polyfill';\n\timport Warning from '$lib/components/Warning.svelte';\n\timport Confirmation from '$lib/components/Confirmation.svelte';\n\timport { createPortManagerWithStream } from '$lib/managers/PortManagerWithStream';\n\timport { safeNavigate, safeLogout } from '$lib/common/safeNavigate';\n\timport { safeClientSendMessage } from '$lib/common/safeClientSendMessage';\n\n\ttype RuntimePort = Runtime.Port | undefined;\n\t// let port: RuntimePort;\n\n\tlet showConfirm = $state(false);\n\tlet showSuccess = false;\n\tlet showFailure = $state(false);\n\tlet errorValue = $state('No domain/site name was found. Access to YAKKL® is denied.');\n\tlet domain: string = $state('');\n\tlet domainLogo: string = $state('');\n\tlet domainTitle: string = $state('');\n\tlet title: string = $state(DEFAULT_TITLE);\n\tlet requestId: string | null = null;\n\tlet method: string = $state('');\n\tlet message; // This gets passed letting the user know what the intent is\n\n\tlet portManager = createPortManagerWithStream(YAKKL_DAPP);\n\n\tif (browserSvelte) {\n\t\ttry {\n\t\t\trequestId = page.url.searchParams.get('requestId');\n\t\t\tconst methodParam = page.url.searchParams.get('method');\n\t\t\tif (methodParam) method = methodParam;\n\t\t\t$yakklDappConnectRequestStore = requestId;\n\t\t} catch (e) {\n\t\t\tlog.error(e);\n\t\t\thandleReject('No requestId or methodwas found. Access to YAKKL® is denied.');\n\t\t}\n\t}\n\n\t// NOTE: domains will be added (if not already there at the next step - if accounts)\n\tasync function handleProcess() {\n\t\tif (!browserSvelte) return;\n\n\t\ttry {\n\t\t\t// Store the request info in session storage so it persists after login\n\t\t\tsessionStorage.setItem(\n\t\t\t\t'yakklSigningRequest',\n\t\t\t\tJSON.stringify({\n\t\t\t\t\trequestId,\n\t\t\t\t\tmethod\n\t\t\t\t})\n\t\t\t);\n\n\t\t\treturn safeNavigate('/dapp/login?requestId=' + requestId + '&method=' + method);\n\t\t} catch (e) {\n\t\t\terrorValue = e as string;\n\t\t\tshowFailure = true;\n\t\t}\n\t}\n\n\t// We no longer need to do get_params since we can access the request data directly\n\tasync function onMessageListener(event: any) {\n\t\tif (!browserSvelte) return;\n\n\t\ttry {\n\t\t\tif (!domainLogo) domainLogo = '/images/failIcon48x48.png'; // Set default logo but change if favicon is present\n\n\t\t\tif (event.method === 'get_params') {\n\t\t\t\tif (!event?.result?.data) {\n\t\t\t\t\tawait handleReject('No request data was found. Access to YAKKL® is denied.');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst requestData = event.result.data;\n\n\t\t\t\t// Extract metadata from the correct location in the data structure\n\t\t\t\tconst metaData = requestData.metaData?.metaData || requestData.metaData;\n\t\t\t\tif (!metaData) {\n\t\t\t\t\tawait handleReject('Invalid request data structure. Access to YAKKL® is denied.');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdomainTitle = metaData.title;\n\t\t\t\tdomain = metaData.domain;\n\t\t\t\tdomainLogo = metaData.icon ?? '/images/failIcon48x48.png';\n\t\t\t\tmessage =\n\t\t\t\t\tmetaData.message ??\n\t\t\t\t\t'Nothing was passed to explain the intent of this approval. Be mindful of this request!';\n\n\t\t\t\tif (!requestId) requestId = requestData?.id ?? null;\n\t\t\t\tif (!requestId) {\n\t\t\t\t\tawait handleReject('No request ID was found. Access to YAKKL® is denied.');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Set the page title\n\t\t\t\ttitle = domainTitle || domain || DEFAULT_TITLE;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tlog.error(e);\n\t\t}\n\t}\n\n\t// Only use this for testing!\n\t// async function clearData() {\n\t//   ////\n\t//   // NOTE: Only enable these if you need to CLEAR everything out for testing!\n\t//   $yakklConnectedDomainsStore = null;\n\t//   await setYakklConnectedDomainsStorage([]);\n\t//   let yakklAccounts = [];\n\t//   yakklAccounts = await getYakklAccounts();\n\t//   log.debug('onMessageListener - 72 (approve):', false, 'Cleared all connected domains and accounts', $yakklConnectedDomainsStore, yakklAccounts);\n\t//   if (yakklAccounts.length > 0) {\n\t//     yakklAccounts = yakklAccounts.map((item) => {\n\t//       item.connectedDomains = [];\n\t//       return item;\n\t//     });\n\t//   }\n\t//   // Removed redundant loop for clearing connectedDomains\n\t//   $yakklAccountsStore = yakklAccounts;\n\t//   await setYakklAccountsStorage(yakklAccounts);\n\t//   log.debug('onMessageListener - 72 (approve):', false, 'Cleared all connected domains and accounts', $yakklConnectedDomainsStore, $yakklAccountsStore);\n\t//   // Comment out this section after testing for clearing\n\t//   ////\n\t// }\n\n\tonMount(async () => {\n\t\ttry {\n\t\t\tif (browserSvelte) {\n\t\t\t\tdomainLogo = '/images/failIcon48x48.png';\n\t\t\t\tconst settings = await getSettings();\n\t\t\t\tif (!settings.init || !settings.legal.termsAgreed) {\n\t\t\t\t\terrorValue =\n\t\t\t\t\t\t\"You must register and agree to the terms of service before using YAKKL®. Click on 'Open Wallet' to register.\";\n\t\t\t\t\tshowFailure = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tawait safeClientSendMessage({ type: 'clientReady' }); // Safeguard to ensure the client is ready before sending messages\n\n\t\t\t\t// Check if we're returning from login with a session token\n\t\t\t\tconst storedRequest = sessionStorage.getItem('yakklSigningRequest');\n\t\t\t\tif (storedRequest) {\n\t\t\t\t\tconst { requestId: storedRequestId, method: storedMethod } = JSON.parse(storedRequest);\n\t\t\t\t\trequestId = storedRequestId;\n\t\t\t\t\tmethod = storedMethod;\n\t\t\t\t\tsessionStorage.removeItem('yakklSigningRequest');\n\t\t\t\t}\n\n\t\t\t\tif (!requestId) {\n\t\t\t\t\terrorValue = 'Missing request ID';\n\t\t\t\t\tshowFailure = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst ok = await portManager.createPort();\n\t\t\t\tif (ok) {\n\t\t\t\t\tconst stream = portManager.getStream();\n\t\t\t\t\tstream?.on('data', onMessageListener);\n\t\t\t\t\tstream?.write({ method: 'get_params', id: requestId });\n\t\t\t\t}\n\n\t\t\t\t// REGISTER SESSION with background\n\t\t\t\tlog.info(\n\t\t\t\t\t'Approve: BEFORE - REGISTER_SESSION_PORT - requestId and port:',\n\t\t\t\t\tfalse,\n\t\t\t\t\trequestId,\n\t\t\t\t\tportManager.getPort()\n\t\t\t\t);\n\n\t\t\t\tportManager.setRequestId(requestId);\n\n\t\t\t\tawait safeClientSendMessage({\n\t\t\t\t\ttype: 'REGISTER_SESSION_PORT',\n\t\t\t\t\tport: portManager.getPort(),\n\t\t\t\t\trequestId\n\t\t\t\t});\n\n\t\t\t\tlog.info(\n\t\t\t\t\t'Approve: AFTER - REGISTER_SESSION_PORT - requestId and port:',\n\t\t\t\t\tfalse,\n\t\t\t\t\trequestId,\n\t\t\t\t\tportManager.getPort()\n\t\t\t\t);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tlog.error(e);\n\t\t}\n\t});\n\n\t// data must represent ProviderRpcError format\n\tasync function handleReject(message: string = 'User rejected the request.') {\n\t\ttry {\n\t\t\tshowConfirm = false;\n\t\t\tshowFailure = false;\n\t\t\tshowSuccess = false;\n\t\t\terrorValue = '';\n\n\t\t\tconst port = portManager?.getPort();\n\t\t\tif (port) {\n\t\t\t\tport.postMessage({\n\t\t\t\t\tid: requestId,\n\t\t\t\t\tmethod: 'error',\n\t\t\t\t\tresponse: {\n\t\t\t\t\t\ttype: 'YAKKL_RESPONSE',\n\t\t\t\t\t\tdata: { name: 'ProviderRpcError', code: 4001, message: message }\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tif (portManager) {\n\t\t\t\t\tawait portManager.waitForIdle(1500);\n\t\t\t\t\tportManager.disconnect();\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tlog.warn('Port did not go idle in time', false, e);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tlog.error(e);\n\t\t} finally {\n\t\t\tsafeLogout();\n\t\t}\n\t}\n\n\tfunction handleApprove() {\n\t\tshowConfirm = true;\n\t}\n</script>\n\n<svelte:head>\n\t<title>{title}</title>\n</svelte:head>\n\n<!-- <Warning\n  bind:show={showFailure}\n  title=\"Error\"\n  value={errorValue} /> -->\n\n<Failed bind:show={showFailure} title=\"Failed!\" content={errorValue} onReject={handleReject} />\n\n<Confirmation\n\tbind:show={showConfirm}\n\ttitle=\"Connect to {domain}\"\n\tmessage=\"This will connect {domain} to YAKKL®. Do you wish to continue?\"\n\tonConfirm={handleProcess}\n\tonReject={handleReject}\n/>\n\n<div class=\"flex flex-col h-full max-h-screen overflow-hidden\">\n\t<!-- Header -->\n\t<div class=\"p-4 border-b border-base-300 flex-shrink-0\">\n\t\t<div class=\"flex items-center justify-between\">\n\t\t\t<div class=\"flex items-center gap-2 min-w-0\">\n\t\t\t\t<img\n\t\t\t\t\tid=\"dappImageId\"\n\t\t\t\t\tcrossorigin=\"anonymous\"\n\t\t\t\t\tsrc={domainLogo}\n\t\t\t\t\talt=\"Dapp logo\"\n\t\t\t\t\tclass=\"w-8 h-8 rounded-full flex-shrink-0\"\n\t\t\t\t/>\n\t\t\t\t<span class=\"font-semibold truncate\">{title}</span>\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\tonclick={() => handleReject()}\n\t\t\t\tclass=\"btn btn-ghost btn-sm flex-shrink-0\"\n\t\t\t\taria-label=\"Close\"\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tclass=\"h-5 w-5\"\n\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\td=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\"\n\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\n\t<!-- Content -->\n\t<div class=\"flex-1 p-4 flex flex-col max-w-[428px]\">\n\t\t<div class=\"text-center mb-4 flex-shrink-0\">\n\t\t\t{#if method !== 'eth_requestAccounts' && method !== 'eth_sendTransaction' && method !== 'eth_signTypedData_v4' && method !== 'personal_sign'}\n\t\t\t\t<h2 class=\"text-xl font-bold mb-2\">Security Risk</h2>\n\t\t\t{:else}\n\t\t\t\t<h2 class=\"text-xl font-bold mb-2\">Connection Request</h2>\n\t\t\t\t<p class=\"text-base-content/80\">This site would like to:</p>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<div class=\"space-y-4 mb-4 overflow-y-auto flex-1 min-h-0\">\n\t\t\t<div class=\"flex items-center gap-3 p-3 bg-base-200 rounded-lg\">\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tclass=\"h-6 w-6 text-primary flex-shrink-0\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\td=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t\t{#if method === 'eth_requestAccounts'}\n\t\t\t\t\t<span>1. Request approval to connect to your wallet addresses</span>\n\t\t\t\t{:else if method === 'eth_sendTransaction'}\n\t\t\t\t\t<span>1. Request approval to send a transaction</span>\n\t\t\t\t{:else if (method as string) === 'eth_signTypedData_v4' || (method as string) === 'personal_sign' || (method as string) === 'eth_signTransaction'}\n\t\t\t\t\t<span>1. Request approval to sign a message</span>\n\t\t\t\t{:else if method === 'wallet_requestPermissions' || method === 'wallet_revokePermissions' || method === 'wallet_getPermissions'}\n\t\t\t\t\t<!-- wallet_requestPermissions is the only one requiring user approval but added the other two for completeness -->\n\t\t\t\t\t<span>1. Request approval to connect to your wallet addresses</span>\n\t\t\t\t{:else if method === 'wallet_switchEthereumChain'}\n\t\t\t\t\t<span>1. Request approval to switch to a different network</span>\n\t\t\t\t\t<!-- {:else if method === 'wallet_addEthereumChain'}\n          <span>1. Request approval to add a new network</span> -->\n\t\t\t\t{:else}\n\t\t\t\t\t<span\n\t\t\t\t\t\t>Request approval for '{method}' but it is not supported by YAKKL® due to security\n\t\t\t\t\t\tconcerns.</span\n\t\t\t\t\t>\n\t\t\t\t{/if}\n\t\t\t</div>\n\n\t\t\t<!-- <div class=\"flex items-center gap-3 p-3 bg-base-200 rounded-lg\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-6 w-6 text-primary flex-shrink-0\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n        </svg>\n        <span>2. Request approval for signing</span>\n      </div>\n\n      <div class=\"flex items-center gap-3 p-3 bg-base-200 rounded-lg\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-6 w-6 text-primary flex-shrink-0\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n        </svg>\n        <span>3. Request approval for sending transactions</span>\n      </div> -->\n\t\t</div>\n\n\t\t<div class=\"bg-base-200 rounded-lg p-4 mb-4 flex-shrink-0\">\n\t\t\t<p class=\"text-sm text-base-content/70\">\n\t\t\t\t{#if method !== 'eth_requestAccounts' && method !== 'eth_sendTransaction' && method !== 'eth_signTypedData_v4' && method !== 'personal_sign' && method !== 'eth_signTransaction' && method !== 'wallet_requestPermissions' && method !== 'wallet_revokePermissions' && method !== 'wallet_getPermissions' && method !== 'wallet_switchEthereumChain'}\n\t\t\t\t\tThe request is a possible security risk and not allowed!\n\t\t\t\t{:else}\n\t\t\t\t\tBy connecting, you agree to allow this site to connect to your addresses. Any signing or\n\t\t\t\t\ttransaction requests will have an additional approval step.\n\t\t\t\t{/if}\n\t\t\t</p>\n\t\t</div>\n\t</div>\n\n\t<!-- Footer -->\n\t<div class=\"p-4 border-t border-base-300 flex-shrink-0\">\n\t\t<div class=\"flex gap-4 justify-end\">\n\t\t\t{#if method !== 'eth_requestAccounts' && method !== 'eth_sendTransaction' && method !== 'eth_signTypedData_v4' && method !== 'personal_sign' && method !== 'eth_signTransaction' && method !== 'wallet_requestPermissions' && method !== 'wallet_revokePermissions' && method !== 'wallet_getPermissions' && method !== 'wallet_switchEthereumChain'}\n\t\t\t\t<button\n\t\t\t\t\tonclick={() => handleReject('Unsupported method - Security risk: ' + method)}\n\t\t\t\t\tclass=\"btn btn-primary\"\n\t\t\t\t>\n\t\t\t\t\tReject\n\t\t\t\t</button>\n\t\t\t{:else}\n\t\t\t\t<button onclick={handleApprove} class=\"btn btn-primary\">\n\t\t\t\t\t{#if method === 'eth_requestAccounts'}\n\t\t\t\t\t\tConnect\n\t\t\t\t\t{:else if method === 'eth_sendTransaction'}\n\t\t\t\t\t\tApprove Transaction\n\t\t\t\t\t{:else if (method as string) === 'eth_signTypedData_v4' || (method as string) === 'personal_sign' || (method as string) === 'eth_signTransaction'}\n\t\t\t\t\t\tApprove Signing\n\t\t\t\t\t{:else if method === 'wallet_requestPermissions'}\n\t\t\t\t\t\tApprove Connection\n\t\t\t\t\t{:else if method === 'wallet_revokePermissions'}\n\t\t\t\t\t\tRevoke Connection\n\t\t\t\t\t{:else if method === 'wallet_getPermissions'}\n\t\t\t\t\t\tView Permissions\n\t\t\t\t\t{:else if method === 'wallet_switchEthereumChain'}\n\t\t\t\t\t\tSwitch Network\n\t\t\t\t\t{/if}\n\t\t\t\t</button>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n</div>\n\n<Copyright />\n\n<style>\n\t/* Add smooth transitions */\n\t.btn {\n\t\ttransition: all 0.2s ease;\n\t}\n\n\t/* Improve hover states */\n\t.btn:hover {\n\t\ttransform: translateY(-1px);\n\t}\n\n\t/* Custom scrollbar */\n\t.overflow-y-auto {\n\t\tscrollbar-width: thin;\n\t\tscrollbar-color: hsl(var(--p)) transparent;\n\t}\n\n\t.overflow-y-auto::-webkit-scrollbar {\n\t\twidth: 6px;\n\t}\n\n\t.overflow-y-auto::-webkit-scrollbar-track {\n\t\tbackground: transparent;\n\t}\n\n\t.overflow-y-auto::-webkit-scrollbar-thumb {\n\t\tbackground-color: hsl(var(--p));\n\t\tborder-radius: 3px;\n\t}\n</style>\n"],"names":["async","getDuplex","browserSvelte","mod","import","Duplex","PortDuplexStream","port","stream","inflight","constructor","this","onMessage","addListener","_onMessage","bind","onDisconnect","destroy","message","log","info","Math","max","push","err","error","write","msg","postMessage","on","event","handler","disconnect","isIdle","waitForIdle","timeout","start","Date","now","Promise","resolve","reject","check","Error","setTimeout","PortManagerWithStream","requestId","name","createPort","ext","isClient","getBrowserExt","browser_ext","runtime","connect","CustomDuplex","super","objectMode","_read","_write","_chunk","_enc","cb","chunk","baseStream","getStream","getPort","sendMessage","type","warn","setRequestId","getRequestId","clearRequestId","createPortManagerWithStream","showConfirm","showSuccess","showFailure","errorValue","domain","domainLogo","title","DEFAULT_TITLE","method","portManager","YAKKL_DAPP","page","url","searchParams","get","methodParam","$.store_set","yakklDappConnectRequestStore","e","handleReject","handleProcess","sessionStorage","setItem","JSON","stringify","safeNavigate","id","response","data","code","safeLogout","$$value"],"mappings":"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"}