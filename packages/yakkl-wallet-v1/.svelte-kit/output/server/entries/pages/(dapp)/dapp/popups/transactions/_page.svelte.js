import{p as push,j as store_set,h as copy_payload,i as assign_payload,c as pop,r as head,f as attr_class,a as push_element,b as pop_element,e as escape_html,m as attr,s as store_get,u as unsubscribe_stores}from"../../../../../../chunks/index2.js";import{b as browserSvelte}from"../../../../../../chunks/environment.js";import{b as yakklDappConnectRequestStore,l as log,_ as DEFAULT_TITLE,g as getYakklAccounts,i as isEncryptedData,j as decryptData}from"../../../../../../chunks/encryption.js";import{p as page}from"../../../../../../chunks/index3.js";import"../../../../../../chunks/Logger.js";import{F as FILENAME}from"../../../../../../chunks/utils.js";import{v as verifySessionToken,s as sessionToken}from"../../../../../../chunks/session.js";import{C as Confirmation}from"../../../../../../chunks/Confirmation.js";import"../../../../../../chunks/Warning.js";import{F as Failed}from"../../../../../../chunks/Failed.js";import{s as safeLogout}from"../../../../../../chunks/safeNavigate.js";import"../../../../../../chunks/utilities.js";import{P as PincodeVerify}from"../../../../../../chunks/PincodeVerify.js";_page[FILENAME]="src/routes/(dapp)/dapp/popups/transactions/+page.svelte";function _page($$payload,$$props){push(_page);var $$store_subs;let wallet;let yakklMiscStore;let showConfirm=false;let showSuccess=false;let showFailure=false;let showSpinner=false;let showPincode=false;let errorValue="No domain/site name was found. Access to YAKKL® is denied.";let chainId;let domain="";let domainLogo="";let title=DEFAULT_TITLE;let method;let requestId;let message="";let transaction={};let transactionDisplay={};let gasLimit=0n;let tx=null;let stream=null;if(browserSvelte){try{requestId=page.url.searchParams.get("requestId");method=page.url.searchParams.get("method")||"eth_sendTransaction";store_set(yakklDappConnectRequestStore,requestId);if(!requestId){errorValue="No request ID was found. Access to YAKKL® is denied.";showFailure=true}}catch(e){log.error("Error parsing URL parameters:",false,e);errorValue="Invalid request parameters. Access to YAKKL® is denied.";showFailure=true}}async function handleReject(message2="User rejected the request."){try{showConfirm=false;showFailure=false;showSuccess=false;if(stream);}catch(e){log.error("Error sending rejection:",false,e)}finally{await close()}}async function handleApprove(){try{showConfirm=false;if(!verifySessionToken(store_get($$store_subs??={},"$sessionToken",sessionToken))){await handleReject("Session expired. Please log in again.");return}showSpinner=true;const accounts=await getYakklAccounts();const account=accounts.find(acc=>acc.address.toLowerCase()===transaction.from?.toLowerCase());if(!account){await handleReject("Account not found.");return}if(isEncryptedData(account.data)){account.data=await decryptData(account.data,yakklMiscStore)}if(!account.data.privateKey){await handleReject("Account key not available.");return}transaction.gasLimit=gasLimit;transaction.nonce=-1;transaction.type=2;transaction.chainId=chainId;tx=await wallet.sendTransaction(transaction);if(tx?.hash){if(stream);tx.wait().then(async()=>{showSuccess=true;setTimeout(async()=>{await close()},2e3)}).catch(error=>{errorValue=`Transaction failed: ${error.message}`;showFailure=true;showSpinner=false})}else{throw new Error("No transaction hash received")}}catch(e){log.error("Transaction error:",false,e);errorValue=e instanceof Error?e.message:"Transaction failed";showFailure=true;showSpinner=false}}async function close(){if(browserSvelte){showSpinner=false;safeLogout()}}let $$settled=true;let $$inner_payload;function $$render_inner($$payload2){head($$payload2,$$payload3=>{$$payload3.title=`<title>${escape_html(title)}</title>`});Failed($$payload2,{title:"Failed!",content:errorValue,onReject:handleReject,get show(){return showFailure},set show($$value){showFailure=$$value;$$settled=false}});$$payload2.out+=`\x3c!----\x3e `;Confirmation($$payload2,{title:"Approve Transaction",message:"Are you sure you want to send this transaction? This action cannot be undone.",onConfirm:handleApprove,get show(){return showConfirm},set show($$value){showConfirm=$$value;$$settled=false}});$$payload2.out+=`\x3c!----\x3e `;PincodeVerify($$payload2,{onVerified:handleApprove,get show(){return showPincode},set show($$value){showPincode=$$value;$$settled=false}});$$payload2.out+=`\x3c!----\x3e <div${attr_class("modal svelte-kdh5qs",void 0,{"modal-open":showSuccess})}>`;push_element($$payload2,"div",333,0);$$payload2.out+=`<div class="modal-box relative svelte-kdh5qs">`;push_element($$payload2,"div",334,1);$$payload2.out+=`<h3 class="text-lg font-bold svelte-kdh5qs">`;push_element($$payload2,"h3",335,2);$$payload2.out+=`Transaction Submitted!</h3>`;pop_element();$$payload2.out+=` <p class="py-4 svelte-kdh5qs">`;push_element($$payload2,"p",336,2);$$payload2.out+=`Your transaction has been submitted to the blockchain.</p>`;pop_element();$$payload2.out+=` <p class="text-sm svelte-kdh5qs">`;push_element($$payload2,"p",337,2);$$payload2.out+=`Transaction Hash: ${escape_html(tx?.hash)}</p>`;pop_element();$$payload2.out+=` <div class="modal-action svelte-kdh5qs">`;push_element($$payload2,"div",338,2);$$payload2.out+=`<button class="btn svelte-kdh5qs">`;push_element($$payload2,"button",339,3);$$payload2.out+=`Close</button>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=` `;if(!showConfirm&&!showSuccess&&!showFailure){$$payload2.out+="\x3c!--[--\x3e";$$payload2.out+=`<div class="flex flex-col h-full max-h-screen overflow-hidden svelte-kdh5qs">`;push_element($$payload2,"div",345,1);$$payload2.out+=`<div class="p-4 border-b border-base-300 flex-shrink-0 svelte-kdh5qs">`;push_element($$payload2,"div",347,2);$$payload2.out+=`<div class="flex items-center justify-between svelte-kdh5qs">`;push_element($$payload2,"div",348,3);$$payload2.out+=`<div class="flex items-center gap-2 min-w-0 svelte-kdh5qs">`;push_element($$payload2,"div",349,4);$$payload2.out+=`<img crossorigin="anonymous"${attr("src",domainLogo)} alt="Dapp logo" class="w-8 h-8 rounded-full flex-shrink-0 svelte-kdh5qs"/>`;push_element($$payload2,"img",350,5);pop_element();$$payload2.out+=` <span class="font-semibold truncate svelte-kdh5qs">`;push_element($$payload2,"span",356,5);$$payload2.out+=`${escape_html(domain)}</span>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=` <button class="btn btn-ghost btn-sm flex-shrink-0 svelte-kdh5qs" aria-label="Close">`;push_element($$payload2,"button",358,4);$$payload2.out+=`<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 svelte-kdh5qs" viewBox="0 0 20 20" fill="currentColor">`;push_element($$payload2,"svg",363,5);$$payload2.out+=`<path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" class="svelte-kdh5qs">`;push_element($$payload2,"path",369,6);$$payload2.out+=`</path>`;pop_element();$$payload2.out+=`</svg>`;pop_element();$$payload2.out+=`</button>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=` <div class="flex-1 p-6 overflow-hidden flex flex-col svelte-kdh5qs">`;push_element($$payload2,"div",380,2);$$payload2.out+=`<div class="text-center mb-4 flex-shrink-0 svelte-kdh5qs">`;push_element($$payload2,"div",381,3);$$payload2.out+=`<h2 class="text-xl font-bold mb-2 svelte-kdh5qs">`;push_element($$payload2,"h2",382,4);$$payload2.out+=`Transaction Request</h2>`;pop_element();$$payload2.out+=` <p class="text-base-content/80 svelte-kdh5qs">`;push_element($$payload2,"p",383,4);$$payload2.out+=`${escape_html(message)}</p>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=` <div class="overflow-y-auto flex-1 min-h-0 mb-4 svelte-kdh5qs">`;push_element($$payload2,"div",386,3);$$payload2.out+=`<div class="bg-base-200 rounded-lg p-4 space-y-3 svelte-kdh5qs">`;push_element($$payload2,"div",387,4);$$payload2.out+=`<div class="flex justify-between items-center border-b border-base-300 pb-2 svelte-kdh5qs">`;push_element($$payload2,"div",388,5);$$payload2.out+=`<span class="font-medium svelte-kdh5qs">`;push_element($$payload2,"span",389,6);$$payload2.out+=`From:</span>`;pop_element();$$payload2.out+=` <span class="font-mono text-sm svelte-kdh5qs">`;push_element($$payload2,"span",390,6);$$payload2.out+=`${escape_html(transactionDisplay.from)}</span>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=` <div class="flex justify-between items-center border-b border-base-300 pb-2 svelte-kdh5qs">`;push_element($$payload2,"div",392,5);$$payload2.out+=`<span class="font-medium svelte-kdh5qs">`;push_element($$payload2,"span",393,6);$$payload2.out+=`To:</span>`;pop_element();$$payload2.out+=` <span class="font-mono text-sm svelte-kdh5qs">`;push_element($$payload2,"span",394,6);$$payload2.out+=`${escape_html(transactionDisplay.to)}</span>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=` <div class="flex justify-between items-center border-b border-base-300 pb-2 svelte-kdh5qs">`;push_element($$payload2,"div",396,5);$$payload2.out+=`<span class="font-medium svelte-kdh5qs">`;push_element($$payload2,"span",397,6);$$payload2.out+=`Value:</span>`;pop_element();$$payload2.out+=` <span class="font-bold text-primary svelte-kdh5qs">`;push_element($$payload2,"span",398,6);$$payload2.out+=`${escape_html(transactionDisplay.value)}</span>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=` <div class="flex justify-between items-center border-b border-base-300 pb-2 svelte-kdh5qs">`;push_element($$payload2,"div",400,5);$$payload2.out+=`<span class="font-medium svelte-kdh5qs">`;push_element($$payload2,"span",401,6);$$payload2.out+=`Gas Limit:</span>`;pop_element();$$payload2.out+=` <span class="svelte-kdh5qs">`;push_element($$payload2,"span",402,6);$$payload2.out+=`${escape_html(transactionDisplay.gasLimit)}</span>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=` `;if(transaction.data){$$payload2.out+="\x3c!--[--\x3e";$$payload2.out+=`<div class="flex justify-between items-center svelte-kdh5qs">`;push_element($$payload2,"div",405,6);$$payload2.out+=`<span class="font-medium svelte-kdh5qs">`;push_element($$payload2,"span",406,7);$$payload2.out+=`Data:</span>`;pop_element();$$payload2.out+=` <span class="text-sm truncate max-w-[200px] svelte-kdh5qs">`;push_element($$payload2,"span",407,7);$$payload2.out+=`${escape_html(transactionDisplay.data)}</span>`;pop_element();$$payload2.out+=`</div>`;pop_element()}else{$$payload2.out+="\x3c!--[!--\x3e"}$$payload2.out+=`\x3c!--]--\x3e</div>`;pop_element();$$payload2.out+=` `;{$$payload2.out+="\x3c!--[--\x3e";$$payload2.out+=`<div class="alert alert-error mt-4 svelte-kdh5qs">`;push_element($$payload2,"div",413,5);$$payload2.out+=`<svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6 svelte-kdh5qs" fill="none" viewBox="0 0 24 24">`;push_element($$payload2,"svg",414,6);$$payload2.out+=`<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" class="svelte-kdh5qs">`;push_element($$payload2,"path",419,8);$$payload2.out+=`</path>`;pop_element();$$payload2.out+=`</svg>`;pop_element();$$payload2.out+=` <span class="svelte-kdh5qs">`;push_element($$payload2,"span",426,6);$$payload2.out+=`Address not connected to this domain</span>`;pop_element();$$payload2.out+=`</div>`;pop_element()}$$payload2.out+=`\x3c!--]--\x3e</div>`;pop_element();$$payload2.out+=` `;if(showSpinner){$$payload2.out+="\x3c!--[--\x3e";$$payload2.out+=`<div class="flex flex-col items-center justify-center p-4 svelte-kdh5qs">`;push_element($$payload2,"div",432,4);$$payload2.out+=`<div class="loading loading-spinner loading-lg svelte-kdh5qs">`;push_element($$payload2,"div",433,5);$$payload2.out+=`</div>`;pop_element();$$payload2.out+=` <p class="mt-2 font-bold animate-pulse svelte-kdh5qs">`;push_element($$payload2,"p",434,5);$$payload2.out+=`Processing transaction...</p>`;pop_element();$$payload2.out+=`</div>`;pop_element()}else{$$payload2.out+="\x3c!--[!--\x3e"}$$payload2.out+=`\x3c!--]--\x3e</div>`;pop_element();$$payload2.out+=` <div class="p-4 border-t border-base-300 flex-shrink-0 svelte-kdh5qs">`;push_element($$payload2,"div",440,2);$$payload2.out+=`<div class="flex gap-4 justify-end svelte-kdh5qs">`;push_element($$payload2,"div",441,3);$$payload2.out+=`<button class="btn btn-outline svelte-kdh5qs">`;push_element($$payload2,"button",442,4);$$payload2.out+=`Reject</button>`;pop_element();$$payload2.out+=` <button class="btn btn-primary svelte-kdh5qs"${attr("disabled",true,true)}>`;push_element($$payload2,"button",443,4);$$payload2.out+=`Approve</button>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=`</div>`;pop_element()}else{$$payload2.out+="\x3c!--[!--\x3e"}$$payload2.out+=`\x3c!--]--\x3e`}do{$$settled=true;$$inner_payload=copy_payload($$payload);$$render_inner($$inner_payload)}while(!$$settled);assign_payload($$payload,$$inner_payload);if($$store_subs)unsubscribe_stores($$store_subs);pop()}_page.render=function(){throw new Error("Component.render(...) is no longer valid in Svelte 5. See https://svelte.dev/docs/svelte/v5-migration-guide#Components-are-no-longer-classes for more information")};export{_page as default};
//# sourceMappingURL=_page.svelte.js.map
