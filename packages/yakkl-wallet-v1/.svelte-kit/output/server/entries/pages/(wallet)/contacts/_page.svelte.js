import{p as push,h as copy_payload,i as assign_payload,c as pop,f as attr_class,a as push_element,b as pop_element,e as escape_html,l as prevent_snippet_stringification,v as ensure_array_like,m as attr,s as store_get,o as store_mutate,u as unsubscribe_stores}from"../../../../chunks/index2.js";import{i as isEncryptedData,j as decryptData,w as dateString,k as yakklMiscStore,af as setYakklContactsStorage}from"../../../../chunks/encryption.js";import{c as createForm}from"../../../../chunks/create-form.js";import{o as onDestroy}from"../../../../chunks/index-server2.js";import*as yup from"yup";import{B as Button,D as Dropdown,e as DropdownItem}from"../../../../chunks/Hr.js";import{F as FILENAME}from"../../../../chunks/utils.js";import{B as Back}from"../../../../chunks/Back.js";import"../../../../chunks/Logger.js";import"../../../../chunks/environment.js";import{i as isEthereum}from"../../../../chunks/BlockchainGuards.js";async function decryptAndSetData(data,decryptionKey){if(isEncryptedData(data)){const decryptedData=await decryptData(data,decryptionKey);return decryptedData}return data}function setDefinedProperty(target,property,value){if(target&&value!==void 0&&value!==null){target[property]=value}}_page[FILENAME]="src/routes/(wallet)/contacts/+page.svelte";function _page($$payload,$$props){push(_page);var $$store_subs;let wallet;let currentlySelected;let error=false;let errorValue="";let dropdownOpen=false;let name;let address;let alias;let note;let contacts=[];onDestroy(()=>{handleClear()});const{form:form,errors:errors}=createForm({initialValues:{name:"",address:"",alias:"",note:""},validationSchema:yup.object().shape({name:yup.string().required("Please enter contact name"),address:yup.string().required("Please enter the crypto address of this contact").matches(/^(0x)?[0-9a-fA-F]{40}$|^.*\.eth$/,"Must be a valid address or ENS name"),alias:yup.string().optional(),note:yup.string().optional()}),onSubmit:async data=>{try{if(await verifyContact(data.name,data.address,data.alias,data.note)){processContact()}else{errorValue="Unable to verify contact before processing.";error=true}}catch(e){error=true;errorValue=e;console.log(e)}}});async function verifyContact(fname,faddress,falias,fnote){name=fname;address=faddress;alias=falias;note=fnote;let resolvedAddr=null;const blockchain=wallet.getBlockchain();if(isEthereum(blockchain)){resolvedAddr=await blockchain.resolveName(alias)}if(resolvedAddr){address=resolvedAddr}if(!blockchain.isAddress(address)){errorValue=`Address ${address} is not a valid address. A valid toAddress is required.`;error=true;return false}return true}function handleClear(){name=store_mutate($$store_subs??={},"$form",form,store_get($$store_subs??={},"$form",form).name="");address=store_mutate($$store_subs??={},"$form",form,store_get($$store_subs??={},"$form",form).address="");alias=store_mutate($$store_subs??={},"$form",form,store_get($$store_subs??={},"$form",form).alias="");note=store_mutate($$store_subs??={},"$form",form,store_get($$store_subs??={},"$form",form).note="")}async function processContact(){try{let duplicate=false;if(contacts){if(contacts.find(element=>element.name===name)!==void 0)duplicate=true}else{contacts=[]}if(duplicate){errorValue="Unable to ADD due to name already registered.";error=true;return}let contact={id:currentlySelected.id.toString(),name:name,address:address,alias:alias,note:note,addressType:"EOA",blockchain:currentlySelected.shortcuts.blockchain,version:currentlySelected.version,createDate:dateString(),updateDate:dateString()};await decryptAndSetData(contact,store_get($$store_subs??={},"$yakklMiscStore",yakklMiscStore));setDefinedProperty(contact,"alias",alias);setDefinedProperty(contact,"note",note);contacts.push(contact);await setYakklContactsStorage(contacts);handleClear()}catch(e){errorValue=e;console.log(e);error=true}}let $$settled=true;let $$inner_payload;function $$render_inner($$payload2){$$payload2.out+=`<div${attr_class("modal",void 0,{"modal-open":error})}>`;push_element($$payload2,"div",188,0);$$payload2.out+=`<div class="modal-box relative">`;push_element($$payload2,"div",189,1);$$payload2.out+=`<h3 class="text-lg font-bold">`;push_element($$payload2,"h3",190,2);$$payload2.out+=`ERROR!</h3>`;pop_element();$$payload2.out+=` <p class="py-4">`;push_element($$payload2,"p",191,2);$$payload2.out+=`${escape_html(errorValue)}</p>`;pop_element();$$payload2.out+=` <div class="modal-action">`;push_element($$payload2,"div",192,2);$$payload2.out+=`<button class="btn">`;push_element($$payload2,"button",193,3);$$payload2.out+=`Close</button>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=` <div class="text-center min-h-[75rem]">`;push_element($$payload2,"div",198,0);$$payload2.out+=`<div class="relative w-full h-9">`;push_element($$payload2,"div",199,1);Back($$payload2,{defaultClass:"left-0 top-0 absolute",href:""});$$payload2.out+=`\x3c!----\x3e <h2 class="text-xl tracking-tight font-extrabold text-base-content">`;push_element($$payload2,"h2",201,2);$$payload2.out+=`<span class="lg:inline">`;push_element($$payload2,"span",202,3);$$payload2.out+=`Contact</span>`;pop_element();$$payload2.out+=`</h2>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=` <hr class="mb-0.5 mt-0.5"/>`;push_element($$payload2,"hr",206,1);pop_element();$$payload2.out+=` <div class="justify-center mb-4 mt-2">`;push_element($$payload2,"div",208,1);Button($$payload2,{children:prevent_snippet_stringification($$payload3=>{$$payload3.out+=`\x3c!----\x3eContact List`}),$$slots:{default:true}});$$payload2.out+=`\x3c!----\x3e `;Dropdown($$payload2,{class:"overflow-y-auto px-3 pb-3 text-sm h-44",get open(){return dropdownOpen},set open($$value){dropdownOpen=$$value;$$settled=false},children:prevent_snippet_stringification($$payload3=>{const each_array=ensure_array_like(contacts);$$payload3.out+=`\x3c!--[--\x3e`;for(let i=0,$$length=each_array.length;i<$$length;i++){let contact=each_array[i];DropdownItem($$payload3,{children:prevent_snippet_stringification($$payload4=>{$$payload4.out+=`\x3c!----\x3e${escape_html(contact.name)} <small class="text-xs text-gray-500">`;push_element($$payload4,"small",217,5);$$payload4.out+=`${escape_html(contact.address)}</small>`;pop_element()}),$$slots:{default:true}})}$$payload3.out+=`\x3c!--]--\x3e`}),$$slots:{default:true,header:$$payload3=>{$$payload3.out+=`<div slot="header" class="p-3">`;push_element($$payload3,"div",213,3);$$payload3.out+=`Contact List</div>`;pop_element()}}});$$payload2.out+=`\x3c!----\x3e</div>`;pop_element();$$payload2.out+=` <form>`;push_element($$payload2,"form",223,1);$$payload2.out+=`<div class="flex justify-center">`;push_element($$payload2,"div",224,2);$$payload2.out+=`<div class="w-full max-w-xs">`;push_element($$payload2,"div",225,3);$$payload2.out+=`<span class="mt-2 text-left text-xs text-base-content font-bold mb-1">`;push_element($$payload2,"span",226,4);$$payload2.out+=`Name:</span>`;pop_element();$$payload2.out+=` <input id="name" class="input input-bordered input-primary w-full mb-2" placeholder="Name" autocomplete="off"${attr("value",store_get($$store_subs??={},"$form",form).name)} required/>`;push_element($$payload2,"input",227,4);pop_element();$$payload2.out+=` `;if(store_get($$store_subs??={},"$errors",errors).name){$$payload2.out+="\x3c!--[--\x3e";$$payload2.out+=`<small class="text-red-600 font-bold animate-pulse">`;push_element($$payload2,"small",237,5);$$payload2.out+=`${escape_html(store_get($$store_subs??={},"$errors",errors).name)}</small>`;pop_element()}else{$$payload2.out+="\x3c!--[!--\x3e"}$$payload2.out+=`\x3c!--]--\x3e <span class="mt-2 text-left text-xs text-base-content font-bold mb-1">`;push_element($$payload2,"span",240,4);$$payload2.out+=`Crypto Address:</span>`;pop_element();$$payload2.out+=` <input id="address" class="input input-bordered input-primary w-full mb-2" placeholder="Crypto address" autocomplete="off"${attr("value",store_get($$store_subs??={},"$form",form).address)} required/>`;push_element($$payload2,"input",241,4);pop_element();$$payload2.out+=` `;if(store_get($$store_subs??={},"$errors",errors).address){$$payload2.out+="\x3c!--[--\x3e";$$payload2.out+=`<small class="text-red-600 font-bold animate-pulse">`;push_element($$payload2,"small",251,5);$$payload2.out+=`${escape_html(store_get($$store_subs??={},"$errors",errors).address)}</small>`;pop_element()}else{$$payload2.out+="\x3c!--[!--\x3e"}$$payload2.out+=`\x3c!--]--\x3e <span class="mt-2 text-left text-xs text-base-content font-bold mb-1">`;push_element($$payload2,"span",254,4);$$payload2.out+=`Alias (optional):</span>`;pop_element();$$payload2.out+=` <input id="alias" class="input input-bordered input-primary w-full mb-2" placeholder="Alias" autocomplete="off"${attr("value",store_get($$store_subs??={},"$form",form).alias)}/>`;push_element($$payload2,"input",257,4);pop_element();$$payload2.out+=` `;if(store_get($$store_subs??={},"$errors",errors).alias){$$payload2.out+="\x3c!--[--\x3e";$$payload2.out+=`<small class="text-red-600 font-bold animate-pulse">`;push_element($$payload2,"small",266,5);$$payload2.out+=`${escape_html(store_get($$store_subs??={},"$errors",errors).alias)}</small>`;pop_element()}else{$$payload2.out+="\x3c!--[!--\x3e"}$$payload2.out+=`\x3c!--]--\x3e <span class="mt-2 text-left text-xs text-base-content font-bold mb-1">`;push_element($$payload2,"span",269,4);$$payload2.out+=`Note (optional):</span>`;pop_element();$$payload2.out+=` <textarea id="note" rows="2" class="textarea textarea-primary mb-2 w-full" placeholder="Note" autocomplete="off">`;push_element($$payload2,"textarea",271,4);const $$body=escape_html(store_get($$store_subs??={},"$form",form).note);if($$body){$$payload2.out+=`${$$body}`}$$payload2.out+=`</textarea>`;pop_element();$$payload2.out+=` `;if(store_get($$store_subs??={},"$errors",errors).note){$$payload2.out+="\x3c!--[--\x3e";$$payload2.out+=`<small class="text-red-600 font-bold animate-pulse">`;push_element($$payload2,"small",281,5);$$payload2.out+=`${escape_html(store_get($$store_subs??={},"$errors",errors).note)}</small>`;pop_element()}else{$$payload2.out+="\x3c!--[!--\x3e"}$$payload2.out+=`\x3c!--]--\x3e</div>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=` <div class="mt-4 flex flex-row justify-center">`;push_element($$payload2,"div",286,2);$$payload2.out+=`<button class="flex flex-row btn btn-primary rounded-full" data-mdb-ripple="true" data-mdb-ripple-color="light">`;push_element($$payload2,"button",287,3);$$payload2.out+=`<div class="items-center align-middle">`;push_element($$payload2,"div",292,4);$$payload2.out+=`<span>`;push_element($$payload2,"span",293,5);$$payload2.out+=`+ADD</span>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=`</button>`;pop_element();$$payload2.out+=` <button class="ml-4 flex flex-row btn btn-primary rounded-full" data-mdb-ripple="true" data-mdb-ripple-color="light">`;push_element($$payload2,"button",297,3);$$payload2.out+=`<div class="inline-flex items-center align-middle">`;push_element($$payload2,"div",303,4);$$payload2.out+=`<span>`;push_element($$payload2,"span",304,5);$$payload2.out+=`Update</span>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=`</button>`;pop_element();$$payload2.out+=` <button class="ml-4 flex flex-row btn btn-primary rounded-full" data-mdb-ripple="true" data-mdb-ripple-color="light">`;push_element($$payload2,"button",308,3);$$payload2.out+=`<div class="inline-flex items-center align-middle">`;push_element($$payload2,"div",314,4);$$payload2.out+=`<span>`;push_element($$payload2,"span",315,5);$$payload2.out+=`Delete</span>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=`</button>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=` <div class="mt-4 flex flex-row justify-center">`;push_element($$payload2,"div",319,2);$$payload2.out+=`<button class="flex flex-row w-[150px] btn btn-primary rounded-full" data-mdb-ripple="true" data-mdb-ripple-color="light">`;push_element($$payload2,"button",320,3);$$payload2.out+=`<div class="items-center align-middle">`;push_element($$payload2,"div",326,4);$$payload2.out+=`<span class="text-center block w-[90px]">`;push_element($$payload2,"span",327,5);$$payload2.out+=`Clear</span>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=`</button>`;pop_element();$$payload2.out+=`</div>`;pop_element();$$payload2.out+=`</form>`;pop_element();$$payload2.out+=`</div>`;pop_element()}do{$$settled=true;$$inner_payload=copy_payload($$payload);$$render_inner($$inner_payload)}while(!$$settled);assign_payload($$payload,$$inner_payload);if($$store_subs)unsubscribe_stores($$store_subs);pop()}_page.render=function(){throw new Error("Component.render(...) is no longer valid in Svelte 5. See https://svelte.dev/docs/svelte/v5-migration-guide#Components-are-no-longer-classes for more information")};export{_page as default};
//# sourceMappingURL=_page.svelte.js.map
