import{c as check_target,l as legacy_api}from"../chunks/BXFaAXnq.js";import"../chunks/Doq7snb5.js";import{p as push,o as onMount,d as onDestroy,f as first_child,t as template_effect,a as pop,e as set,m as mutable_source,g as get,b as strict_equals,s as sibling,c as child,k as derived_safe_equal,a7 as untrack,F as FILENAME,r as reset,j as next,b8 as mutate}from"../chunks/BaS8d5lg.js";import{a as add_locations}from"../chunks/3AhEABF_.js";import{s as set_text}from"../chunks/Cmwrv3PW.js";import{i as if_block}from"../chunks/Q1yPWpQ-.js";import{e as each,i as index}from"../chunks/DraJ8LN-.js";import{a as append,f as from_html,t as text,c as comment}from"../chunks/Cm3jf07C.js";import{w as wrap_snippet}from"../chunks/d5hrMixo.js";import{r as remove_input_defaults}from"../chunks/DTBsVM-c.js";import{s as set_class}from"../chunks/DX_EEhpR.js";import{e as event,c as remove_textarea_child,b as apply}from"../chunks/DiU70Is3.js";import{b as bind_value}from"../chunks/B6q982nR.js";import{p as preventDefault}from"../chunks/Dh85oLqR.js";import{i as init}from"../chunks/D9iNYspi.js";import{a as store_get,s as setup_stores,d as store_mutate}from"../chunks/CViNpZsE.js";import{v as validate_store}from"../chunks/Dv9a3G0k.js";import{l as log_if_contains_state}from"../chunks/DZ17DrFv.js";import{x as isEncryptedData,z as decryptData,ab as dateString,aG as setYakklContactsStorage,H as yakklMiscStore,C as getYakklCurrentlySelected,a6 as getYakklContacts}from"../chunks/Cb2naUpm.js";import{c as createForm}from"../chunks/CEKklR__.js";import{c as create$3,a as create$6}from"../chunks/B4Ku5_Cd.js";import{B as Button,D as Dropdown,e as DropdownItem}from"../chunks/trmx-wka.js";import{B as Back}from"../chunks/C6td8UPf.js";import{W as WalletManager}from"../chunks/BJK8DTVo.js";import{i as isEthereum}from"../chunks/D2Cx32qo.js";async function decryptAndSetData(data,decryptionKey){if(isEncryptedData(data)){const decryptedData=await decryptData(data,decryptionKey);return decryptedData}return data}function setDefinedProperty(target,property,value){if(target&&value!==void 0&&value!==null){target[property]=value}}_page[FILENAME]="src/routes/(wallet)/contacts/+page.svelte";var root_4=add_locations(from_html(` <small class="text-xs text-gray-500"> </small>`,1),_page[FILENAME],[[217,5]]);var root_5=add_locations(from_html(`<div slot="header" class="p-3">Contact List</div>`),_page[FILENAME],[[213,3]]);var root_6=add_locations(from_html(`<small class="text-red-600 font-bold animate-pulse"> </small>`),_page[FILENAME],[[237,5]]);var root_7=add_locations(from_html(`<small class="text-red-600 font-bold animate-pulse"> </small>`),_page[FILENAME],[[251,5]]);var root_8=add_locations(from_html(`<small class="text-red-600 font-bold animate-pulse"> </small>`),_page[FILENAME],[[266,5]]);var root_9=add_locations(from_html(`<small class="text-red-600 font-bold animate-pulse"> </small>`),_page[FILENAME],[[281,5]]);var root=add_locations(from_html(`<div><div class="modal-box relative"><h3 class="text-lg font-bold">ERROR!</h3> <p class="py-4"> </p> <div class="modal-action"><button class="btn">Close</button></div></div></div> <div class="text-center min-h-[75rem]"><div class="relative w-full h-9"><!> <h2 class="text-xl tracking-tight font-extrabold text-base-content"><span class="lg:inline">Contact</span></h2></div> <hr class="mb-0.5 mt-0.5"/> <div class="justify-center mb-4 mt-2"><!> <!></div> <form><div class="flex justify-center"><div class="w-full max-w-xs"><span class="mt-2 text-left text-xs text-base-content font-bold mb-1">Name:</span> <input id="name" class="input input-bordered input-primary w-full mb-2" placeholder="Name" autocomplete="off" required/> <!> <span class="mt-2 text-left text-xs text-base-content font-bold mb-1">Crypto Address:</span> <input id="address" class="input input-bordered input-primary w-full mb-2" placeholder="Crypto address" autocomplete="off" required/> <!> <span class="mt-2 text-left text-xs text-base-content font-bold mb-1">Alias (optional):</span> <input id="alias" class="input input-bordered input-primary w-full mb-2" placeholder="Alias" autocomplete="off"/> <!> <span class="mt-2 text-left text-xs text-base-content font-bold mb-1">Note (optional):</span> <textarea id="note" rows="2" class="textarea textarea-primary mb-2 w-full" placeholder="Note" autocomplete="off"></textarea> <!></div></div> <div class="mt-4 flex flex-row justify-center"><button class="flex flex-row btn btn-primary rounded-full" data-mdb-ripple="true" data-mdb-ripple-color="light"><div class="items-center align-middle"><span>+ADD</span></div></button> <button class="ml-4 flex flex-row btn btn-primary rounded-full" data-mdb-ripple="true" data-mdb-ripple-color="light"><div class="inline-flex items-center align-middle"><span>Update</span></div></button> <button class="ml-4 flex flex-row btn btn-primary rounded-full" data-mdb-ripple="true" data-mdb-ripple-color="light"><div class="inline-flex items-center align-middle"><span>Delete</span></div></button></div> <div class="mt-4 flex flex-row justify-center"><button class="flex flex-row w-[150px] btn btn-primary rounded-full" data-mdb-ripple="true" data-mdb-ripple-color="light"><div class="items-center align-middle"><span class="text-center block w-[90px]">Clear</span></div></button></div></form></div>`,1),_page[FILENAME],[[188,0,[[189,1,[[190,2],[191,2],[192,2,[[193,3]]]]]]],[198,0,[[199,1,[[201,2,[[202,3]]]]],[206,1],[208,1],[223,1,[[224,2,[[225,3,[[226,4],[227,4],[240,4],[241,4],[254,4],[257,4],[269,4],[271,4]]]]],[286,2,[[287,3,[[292,4,[[293,5]]]]],[297,3,[[303,4,[[304,5]]]]],[308,3,[[314,4,[[315,5]]]]]]],[319,2,[[320,3,[[326,4,[[327,5]]]]]]]]]]]]);function _page($$anchor,$$props){check_target(new.target);push($$props,false,_page);const[$$stores,$$cleanup]=setup_stores();const $form=()=>(validate_store(form,"form"),store_get(form,"$form",$$stores));const $yakklMiscStore=()=>(validate_store(yakklMiscStore,"yakklMiscStore"),store_get(yakklMiscStore,"$yakklMiscStore",$$stores));const $errors=()=>(validate_store(errors,"errors"),store_get(errors,"$errors",$$stores));let wallet;let currentlySelected;let error=mutable_source(false);let errorValue=mutable_source("");let dropdownOpen=mutable_source(false);let name;let address;let alias;let note;let index$1=-1;let contacts=mutable_source([]);onMount(async()=>{handleClear();currentlySelected=await getYakklCurrentlySelected();wallet=WalletManager.getInstance(["Alchemy"],["Ethereum"],currentlySelected.shortcuts.chainId??1,"pBm4VA9q8Laz9x3bmXTNZ9m-ArxczEWk");set(contacts,await getYakklContacts());if(!get(contacts)){set(contacts,[])}});onDestroy(()=>{handleClear()});const{form:form,errors:errors,handleChange:handleChange,handleSubmit:handleSubmit}=createForm({initialValues:{name:"",address:"",alias:"",note:""},validationSchema:create$3().shape({name:create$6().required("Please enter contact name"),address:create$6().required("Please enter the crypto address of this contact").matches(/^(0x)?[0-9a-fA-F]{40}$|^.*\.eth$/,"Must be a valid address or ENS name"),alias:create$6().optional(),note:create$6().optional()}),onSubmit:async data=>{try{if(await verifyContact(data.name,data.address,data.alias,data.note)){processContact()}else{set(errorValue,"Unable to verify contact before processing.");set(error,true)}}catch(e){set(error,true);set(errorValue,e);console.log(...log_if_contains_state("log",e))}}});async function verifyContact(fname,faddress,falias,fnote){name=fname;address=faddress;alias=falias;note=fnote;let resolvedAddr=null;const blockchain=wallet.getBlockchain();if(isEthereum(blockchain)){resolvedAddr=await blockchain.resolveName(alias)}if(resolvedAddr){address=resolvedAddr}if(!blockchain.isAddress(address)){set(errorValue,`Address ${address} is not a valid address. A valid toAddress is required.`);set(error,true);return false}return true}function handleClear(){name=store_mutate(form,untrack($form).name="",untrack($form));address=store_mutate(form,untrack($form).address="",untrack($form));alias=store_mutate(form,untrack($form).alias="",untrack($form));note=store_mutate(form,untrack($form).note="",untrack($form))}function handleClick(idx){if(get(contacts)){index$1=idx;store_mutate(form,untrack($form).name=get(contacts)[index$1].name,untrack($form));store_mutate(form,untrack($form).address=get(contacts)[index$1].address,untrack($form));store_mutate(form,untrack($form).alias=strict_equals(get(contacts)[index$1].alias,void 0)?"":get(contacts)[index$1].alias,untrack($form));store_mutate(form,untrack($form).note=strict_equals(get(contacts)[index$1].note,void 0)?"":get(contacts)[index$1].note,untrack($form));set(dropdownOpen,false)}}async function handleUpdate(){try{if(index$1>=0){if(await verifyContact($form().name,$form().address,$form().alias,$form().note)){mutate(contacts,get(contacts)[index$1].name=name);mutate(contacts,get(contacts)[index$1].address=address);mutate(contacts,get(contacts)[index$1].alias=alias);mutate(contacts,get(contacts)[index$1].note=note);mutate(contacts,get(contacts)[index$1].updateDate=dateString());await setYakklContactsStorage(get(contacts));handleClear()}else{set(errorValue,"Unable to update contact.");set(error,true)}}else{set(errorValue,"Update was called but there is not a valid index.");set(error,true)}}catch(e){set(errorValue,e);set(error,true)}}async function handleDelete(){try{if(index$1>=0){get(contacts).splice(index$1,1);await setYakklContactsStorage(get(contacts));handleClear()}else{set(errorValue,"Delete was called but there is not a valid index.");set(error,true)}}catch(e){set(errorValue,e);set(error,true)}}function handleClose(){set(error,false)}async function processContact(){try{let duplicate=false;if(get(contacts)){if(strict_equals(get(contacts).find(element=>strict_equals(element.name,name)),void 0,false))duplicate=true}else{set(contacts,[])}if(duplicate){set(errorValue,"Unable to ADD due to name already registered.");set(error,true);return}let contact={id:currentlySelected.id.toString(),name:name,address:address,alias:alias,note:note,addressType:"EOA",blockchain:currentlySelected.shortcuts.blockchain,version:currentlySelected.version,createDate:dateString(),updateDate:dateString()};await decryptAndSetData(contact,$yakklMiscStore());setDefinedProperty(contact,"alias",alias);setDefinedProperty(contact,"note",note);get(contacts).push(contact);await setYakklContactsStorage(get(contacts));handleClear()}catch(e){set(errorValue,e);console.log(...log_if_contains_state("log",e));set(error,true)}}init();var fragment=root();var div=first_child(fragment);let classes;var div_1=child(div);var p=sibling(child(div_1),2);var text$1=child(p,true);reset(p);var div_2=sibling(p,2);var button=child(div_2);reset(div_2);reset(div_1);reset(div);var div_3=sibling(div,2);var div_4=child(div_3);var node=child(div_4);Back(node,{defaultClass:"left-0 top-0 absolute",href:""});next(2);reset(div_4);var div_5=sibling(div_4,4);var node_1=child(div_5);Button(node_1,{children:wrap_snippet(_page,($$anchor2,$$slotProps)=>{next();var text_1=text("Contact List");append($$anchor2,text_1)}),$$slots:{default:true}});var node_2=sibling(node_1,2);Dropdown(node_2,{class:"overflow-y-auto px-3 pb-3 text-sm h-44",get open(){return get(dropdownOpen)},set open($$value){set(dropdownOpen,$$value)},children:wrap_snippet(_page,($$anchor2,$$slotProps)=>{var fragment_1=comment();var node_3=first_child(fragment_1);each(node_3,1,()=>get(contacts),index,($$anchor3,contact,i)=>{DropdownItem($$anchor3,{$$events:{click:()=>handleClick(i)},children:wrap_snippet(_page,($$anchor4,$$slotProps2)=>{next();var fragment_3=root_4();var text_2=first_child(fragment_3);var small=sibling(text_2);var text_3=child(small,true);reset(small);template_effect(()=>{set_text(text_2,`${get(contact).name??""} `);set_text(text_3,get(contact).address)});append($$anchor4,fragment_3)}),$$slots:{default:true}})});append($$anchor2,fragment_1)}),$$slots:{default:true,header:($$anchor2,$$slotProps)=>{var div_6=root_5();append($$anchor2,div_6)}},$$legacy:true});reset(div_5);var form_1=sibling(div_5,2);var div_7=child(form_1);var div_8=child(div_7);var input=sibling(child(div_8),2);remove_input_defaults(input);var node_4=sibling(input,2);{var consequent=$$anchor2=>{var small_1=root_6();var text_4=child(small_1,true);reset(small_1);template_effect(()=>set_text(text_4,$errors().name));append($$anchor2,small_1)};if_block(node_4,$$render=>{if($errors().name)$$render(consequent)})}var input_1=sibling(node_4,4);remove_input_defaults(input_1);var node_5=sibling(input_1,2);{var consequent_1=$$anchor2=>{var small_2=root_7();var text_5=child(small_2,true);reset(small_2);template_effect(()=>set_text(text_5,$errors().address));append($$anchor2,small_2)};if_block(node_5,$$render=>{if($errors().address)$$render(consequent_1)})}var input_2=sibling(node_5,4);remove_input_defaults(input_2);var node_6=sibling(input_2,2);{var consequent_2=$$anchor2=>{var small_3=root_8();var text_6=child(small_3,true);reset(small_3);template_effect(()=>set_text(text_6,$errors().alias));append($$anchor2,small_3)};if_block(node_6,$$render=>{if($errors().alias)$$render(consequent_2)})}var textarea=sibling(node_6,4);remove_textarea_child(textarea);var node_7=sibling(textarea,2);{var consequent_3=$$anchor2=>{var small_4=root_9();var text_7=child(small_4,true);reset(small_4);template_effect(()=>set_text(text_7,$errors().note));append($$anchor2,small_4)};if_block(node_7,$$render=>{if($errors().note)$$render(consequent_3)})}reset(div_8);reset(div_7);var div_9=sibling(div_7,2);var button_1=sibling(child(div_9),2);var button_2=sibling(button_1,2);reset(div_9);var div_10=sibling(div_9,2);var button_3=child(div_10);reset(div_10);reset(form_1);reset(div_3);template_effect($0=>{classes=set_class(div,1,"modal",null,classes,$0);set_text(text$1,get(errorValue))},[()=>({"modal-open":get(error)})],derived_safe_equal);event("click",button,handleClose);bind_value(input,()=>$form().name,$$value=>store_mutate(form,untrack($form).name=$$value,untrack($form)));event("change",input,function(...$$args){apply(()=>handleChange,this,$$args,_page,[233,16])});bind_value(input_1,()=>$form().address,$$value=>store_mutate(form,untrack($form).address=$$value,untrack($form)));event("change",input_1,function(...$$args){apply(()=>handleChange,this,$$args,_page,[247,16])});bind_value(input_2,()=>$form().alias,$$value=>store_mutate(form,untrack($form).alias=$$value,untrack($form)));event("change",input_2,function(...$$args){apply(()=>handleChange,this,$$args,_page,[263,16])});bind_value(textarea,()=>$form().note,$$value=>store_mutate(form,untrack($form).note=$$value,untrack($form)));event("change",textarea,function(...$$args){apply(()=>handleChange,this,$$args,_page,[278,16])});event("click",button_1,preventDefault(()=>handleUpdate()));event("click",button_2,preventDefault(()=>handleDelete()));event("click",button_3,preventDefault(handleClear));event("submit",form_1,preventDefault(function(...$$args){apply(()=>handleSubmit,this,$$args,_page,[223,33])}));append($$anchor,fragment);var $$pop=pop({...legacy_api()});$$cleanup();return $$pop}export{_page as component};
//# sourceMappingURL=39.CzRxM8Wg.js.map
