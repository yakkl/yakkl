import{c as check_target,l as legacy_api}from"../chunks/BXFaAXnq.js";import"../chunks/Doq7snb5.js";import{p as push,o as onMount,a as pop,s as sibling,c as child,F as FILENAME,b as strict_equals,g as get,m as mutable_source,r as reset,e as set,t as template_effect,k as derived_safe_equal}from"../chunks/BaS8d5lg.js";import{a as add_locations}from"../chunks/3AhEABF_.js";import{a as append,f as from_html}from"../chunks/Cm3jf07C.js";import{s as set_text}from"../chunks/Cmwrv3PW.js";import{i as if_block}from"../chunks/Q1yPWpQ-.js";import{e as each,i as index}from"../chunks/DraJ8LN-.js";import{v as validate_store}from"../chunks/Dv9a3G0k.js";import{s as set_attribute}from"../chunks/DTBsVM-c.js";import{e as event}from"../chunks/DiU70Is3.js";import{i as init}from"../chunks/D9iNYspi.js";import{s as setup_stores,a as store_get}from"../chunks/CViNpZsE.js";import{w as writable}from"../chunks/B2gA1VsD.js";import{l as log}from"../chunks/WDN37msH.js";const eip6963Providers=writable([]);const selectedEIP6963Provider=writable(null);function requestEIP6963Providers(){window.dispatchEvent(new Event("eip6963:requestProvider"))}function selectEIP6963Provider(provider){selectedEIP6963Provider.set(provider)}EIP6963Provider[FILENAME]="src/lib/components/EIP6963Provider.svelte";var root_1=add_locations(from_html(`<p class="text-gray-600">No wallets available. Please install a compatible wallet.</p>`),EIP6963Provider[FILENAME],[[98,2]]);var root_3=add_locations(from_html(`<div class="flex items-center p-4 border border-gray-200 rounded-lg bg-white shadow-sm"><img class="w-8 h-8"/> <div class="ml-4 flex-grow"><h3 class="text-base font-medium"> </h3> <p class="text-sm text-gray-500 mt-1"> </p></div> <button class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors">Select</button></div>`),EIP6963Provider[FILENAME],[[102,4,[[103,5],[104,5,[[105,6],[106,6]]],[108,5]]]]);var root_2=add_locations(from_html(`<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 my-4"></div>`),EIP6963Provider[FILENAME],[[100,2]]);var root_5=add_locations(from_html(`<p class="text-gray-700 mt-1"> </p>`),EIP6963Provider[FILENAME],[[124,4]]);var root_6=add_locations(from_html(`<p class="text-gray-700 mt-1"> </p>`),EIP6963Provider[FILENAME],[[127,4]]);var root_7=add_locations(from_html(`<p class="text-gray-700 mt-1"> </p>`),EIP6963Provider[FILENAME],[[130,4]]);var root_4=add_locations(from_html(`<div class="mt-8 p-4 border border-gray-200 rounded-lg bg-gray-50"><h3 class="text-lg font-medium mb-2">Connected Provider</h3> <p class="text-gray-700"> </p> <!> <!> <!></div>`),EIP6963Provider[FILENAME],[[120,2,[[121,3],[122,3]]]]);var root_8=add_locations(from_html(`<div class="mt-4 p-4 bg-red-50 text-red-700 rounded"> </div>`),EIP6963Provider[FILENAME],[[136,2]]);var root$1=add_locations(from_html(`<div class="p-4 max-w-3xl mx-auto"><h2 class="text-2xl font-semibold mb-4">Available Wallets</h2> <!> <!> <!></div>`),EIP6963Provider[FILENAME],[[94,0,[[95,1]]]]);function EIP6963Provider($$anchor,$$props){check_target(new.target);push($$props,false,EIP6963Provider);const[$$stores,$$cleanup]=setup_stores();const $selectedEIP6963Provider=()=>(validate_store(selectedEIP6963Provider,"selectedEIP6963Provider"),store_get(selectedEIP6963Provider,"$selectedEIP6963Provider",$$stores));const $eip6963Providers=()=>(validate_store(eip6963Providers,"eip6963Providers"),store_get(eip6963Providers,"$eip6963Providers",$$stores));let accounts=mutable_source([]);let chainId=mutable_source(null);let networkVersion=mutable_source(null);let error=mutable_source(null);function formatChainId(chainIdHex){try{if(!chainIdHex.startsWith("0x"))return chainIdHex;const decimal=parseInt(chainIdHex,16);return`${chainIdHex} (${decimal})`}catch(e){log.error("Error formatting chainId",true,e);return chainIdHex}}async function updateProviderState(provider){try{const[initialAccounts,initialChainId,initialNetVersion]=await Promise.all([provider.provider.request({method:"eth_accounts"}),provider.provider.request({method:"eth_chainId"}),provider.provider.request({method:"net_version"})]);log.debug("Initial provider state",true,{accounts:initialAccounts,chainId:initialChainId,networkVersion:initialNetVersion});set(accounts,initialAccounts);set(chainId,initialChainId);set(networkVersion,initialNetVersion)}catch(e){log.error("Error getting initial provider state",true,e)}}async function handleSelectProvider(provider){try{log.debug("Selecting provider",true,{provider:provider.info.name});selectEIP6963Provider(provider);await updateProviderState(provider);try{const requestedAccounts=await provider.provider.request({method:"eth_requestAccounts"});log.debug("Requested accounts received",true,{accounts:requestedAccounts});set(accounts,requestedAccounts)}catch(e){log.error("Error requesting accounts",true,e)}provider.provider.on("chainChanged",newChainId=>{log.debug("Chain changed",true,{newChainId:newChainId});set(chainId,newChainId)});provider.provider.on("accountsChanged",newAccounts=>{log.debug("Accounts changed",true,{newAccounts:newAccounts});set(accounts,newAccounts)})}catch(e){set(error,e instanceof Error?e.message:"Failed to connect to provider");log.error("Error selecting provider",true,e)}}onMount(()=>{const handleAnnounce=event2=>{var _a;const provider=event2.detail;log.debug("Provider announced",true,{provider:provider.info.name});eip6963Providers.update(providers=>{const existingIndex=providers.findIndex(p=>strict_equals(p.info.uuid,provider.info.uuid));if(existingIndex>=0){providers[existingIndex]=provider}else{providers=[...providers,provider]}return providers});if(strict_equals((_a=$selectedEIP6963Provider())==null?void 0:_a.info.uuid,provider.info.uuid)){updateProviderState(provider)}};window.addEventListener("eip6963:announceProvider",handleAnnounce);requestEIP6963Providers();return()=>{window.removeEventListener("eip6963:announceProvider",handleAnnounce)}});init();var div=root$1();var node=sibling(child(div),2);{var consequent=$$anchor2=>{var p_1=root_1();append($$anchor2,p_1)};var alternate=$$anchor2=>{var div_1=root_2();each(div_1,5,$eip6963Providers,index,($$anchor3,provider)=>{var div_2=root_3();var img=child(div_2);var div_3=sibling(img,2);var h3=child(div_3);var text=child(h3,true);reset(h3);var p_2=sibling(h3,2);var text_1=child(p_2);reset(p_2);reset(div_3);var button=sibling(div_3,2);reset(div_2);template_effect(()=>{set_attribute(img,"src",get(provider).info.icon);set_attribute(img,"alt",get(provider).info.name);set_text(text,get(provider).info.name);set_text(text_1,`ID: ${get(provider).info.uuid??""}`)});event("click",button,()=>handleSelectProvider(get(provider)));append($$anchor3,div_2)});reset(div_1);append($$anchor2,div_1)};if_block(node,$$render=>{if(strict_equals($eip6963Providers().length,0))$$render(consequent);else $$render(alternate,false)})}var node_1=sibling(node,2);{var consequent_4=$$anchor2=>{var div_4=root_4();var p_3=sibling(child(div_4),2);var text_2=child(p_3);reset(p_3);var node_2=sibling(p_3,2);{var consequent_1=$$anchor3=>{var p_4=root_5();var text_3=child(p_4);reset(p_4);template_effect($0=>set_text(text_3,`Accounts: ${$0??""}`),[()=>get(accounts).join(", ")],derived_safe_equal);append($$anchor3,p_4)};if_block(node_2,$$render=>{if(get(accounts).length>0)$$render(consequent_1)})}var node_3=sibling(node_2,2);{var consequent_2=$$anchor3=>{var p_5=root_6();var text_4=child(p_5);reset(p_5);template_effect($0=>set_text(text_4,`Chain ID: ${$0??""}`),[()=>formatChainId(get(chainId))],derived_safe_equal);append($$anchor3,p_5)};if_block(node_3,$$render=>{if(get(chainId))$$render(consequent_2)})}var node_4=sibling(node_3,2);{var consequent_3=$$anchor3=>{var p_6=root_7();var text_5=child(p_6);reset(p_6);template_effect(()=>set_text(text_5,`Network Version: ${get(networkVersion)??""}`));append($$anchor3,p_6)};if_block(node_4,$$render=>{if(get(networkVersion))$$render(consequent_3)})}reset(div_4);template_effect(()=>set_text(text_2,`Name: ${$selectedEIP6963Provider().info.name??""}`));append($$anchor2,div_4)};if_block(node_1,$$render=>{if($selectedEIP6963Provider())$$render(consequent_4)})}var node_5=sibling(node_1,2);{var consequent_5=$$anchor2=>{var div_5=root_8();var text_6=child(div_5,true);reset(div_5);template_effect(()=>set_text(text_6,get(error)));append($$anchor2,div_5)};if_block(node_5,$$render=>{if(get(error))$$render(consequent_5)})}reset(div);append($$anchor,div);var $$pop=pop({...legacy_api()});$$cleanup();return $$pop}_page[FILENAME]="src/routes/(dapp)/dapp/EIP6963/+page.svelte";var root=add_locations(from_html(`<div class="container svelte-ftivgu"><h1 class="svelte-ftivgu">EIP-6963 Wallet Connection</h1> <p class="svelte-ftivgu">Connect your wallet using the EIP-6963 standard</p> <!></div>`),_page[FILENAME],[[4,0,[[5,1],[6,1]]]]);function _page($$anchor,$$props){check_target(new.target);push($$props,false,_page);var div=root();var node=sibling(child(div),4);EIP6963Provider(node,{});reset(div);append($$anchor,div);return pop({...legacy_api()})}export{_page as component};
//# sourceMappingURL=17.B0KiqF62.js.map
