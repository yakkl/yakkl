import{c as check_target,l as legacy_api}from"../chunks/BXFaAXnq.js";import"../chunks/Doq7snb5.js";import{p as push,o as onMount,d as onDestroy,t as template_effect,a as pop,k as derived_safe_equal,F as FILENAME,b as strict_equals}from"../chunks/BaS8d5lg.js";import{a as add_locations}from"../chunks/3AhEABF_.js";import{a as append,f as from_html}from"../chunks/Cm3jf07C.js";import{s as set_attribute}from"../chunks/DTBsVM-c.js";import{i as init}from"../chunks/D9iNYspi.js";import{a as browser_ext}from"../chunks/CgCfpVku.js";import{l as log,f as YAKKL_SPLASH,N as NUM_OF_SPLASH_IMAGES}from"../chunks/Cb2naUpm.js";import{w as wait}from"../chunks/BgnL0Zd7.js";_page[FILENAME]="src/routes/(splash)/popup/popup/+page.svelte";var root=add_locations(from_html(`<img alt="Splash page with logo"/>`),_page[FILENAME],[[69,0]]);function _page($$anchor,$$props){check_target(new.target);push($$props,false,_page);let port;let isPortDisconnected=false;onMount(async()=>{try{log.info("YAKKL: Splash: Attempting to connect to background script...");if(!browser_ext){log.warn("Browser extension API is unavailable.");return}port=browser_ext.runtime.connect({name:YAKKL_SPLASH});if(port){log.debug("YAKKL: Splash: Port connected.");isPortDisconnected=false;port.onMessage.addListener(m=>{if(strict_equals(m.popup,"YAKKL: Launched")){window.close()}});port.onDisconnect.addListener(()=>{isPortDisconnected=true;log.info("Port has been disconnected.")})}else{log.info("YAKKL: Splash: Port is trying again in 2 seconds...");await wait(2e3);port=browser_ext.runtime.connect({name:YAKKL_SPLASH});if(port){port.onMessage.addListener(m=>{if(strict_equals(m.popup,"YAKKL: Launched")){port.disconnect();window.close()}});port.onDisconnect.addListener(()=>{isPortDisconnected=true;log.info("Port has been disconnected.")})}else{browser_ext.runtime.reload()}}browser_ext.alarms.create("yakkl-splash-alarm",{when:Date.now()+2e3});browser_ext.alarms.onAlarm.addListener(m=>{if(port&&!isPortDisconnected)port.postMessage({popup:"YAKKL: Splash"})})}catch(e){log.error(e)}});onDestroy(()=>{try{if(port){port.disconnect()}}catch(e){log.error(e)}});function getRandomInt(max){return Math.floor(Math.random()*max)}init();var img=root();template_effect($0=>set_attribute(img,"src",`/images/splash_${$0??""}.png`),[()=>getRandomInt(NUM_OF_SPLASH_IMAGES)],derived_safe_equal);append($$anchor,img);return pop({...legacy_api()})}export{_page as component};
//# sourceMappingURL=28.wV6PP3Lk.js.map
