{"version":3,"mappings":"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","names":["computeTokenValue","token","balance","Number","price","_a","value","async","getInstances","yakklMiscStore","getMiscStore","currentlySelected","getYakklCurrentlySelected","chainId","shortcuts","wallet","apiKey","define_process_env_default","ALCHEMY_API_KEY_PROD","VITE_ALCHEMY_API_KEY_PROD","WalletManager","getInstance","getSigner","accountKey","getYakklCurrentlySelectedAccountKey","privateKey","setSigner","log","warn","provider","getProvider","signer","blockchain","getBlockchain","tokenService","TokenService","error","ConnectionType","_BackgroundManager","constructor","__publicField","this","connections","Map","messageQueue","initialize","catch","log$1","instance","browser_ext","initialized","runtime","onConnect","addListener","port","isValidConnectionType","name","handleNewConnection","restoreQueuedMessages","type","Object","values","includes","connectionInfo","connectedAt","Date","now","set","onDisconnect","handleDisconnection","processQueuedMessages","delete","hasConnections","size","hasUIConnection","has","getConnectionInfo","get","sendMessage","data","handleNoConnections","message","sendPromises","forEach","push","Promise","resolve","reject","postMessage","allSettled","handleMessageError","all","queueMessage","saveToStorage","queueError","queuedMessage","timestamp","length","MAX_QUEUE_SIZE","shift","persistQueue","storage","local","STORAGE_PREFIX","result","storedQueue","Array","isArray","filter","debug","messages","clearQueue","getQueueSize","isInitialized","BackgroundManager","MAX_RETRIES","INITIAL_RETRY_DELAY","MAX_RETRY_DELAY","state","retryCount","retryTimeout","isConnecting","calculateBackoffDelay","exponentialDelay","Math","pow","maxDelay","min","jitter","random","floor","cleanupConnection","clearTimeout","retryConnection","browserSvelte","attempts","delay","info","attempt","window","setTimeout","initializeUIConnection","connect","UI","Error","onMessage","isValidMessage","handleMessage","lastError","connectionMonitorInterval","startConnectionMonitor","setInterval","getPlatformInfo","then","stopConnectionMonitor","clearInterval","cleanup","MessageType","ACTIVE_TAB_CHANGED","isTabChangeData","handleActiveTabChange","TAB_UPDATED","handleTabUpdate","TAB_REMOVED","handleTabRemove","WINDOW_FOCUSED","isWindowFocusData","handleWindowFocus","tabId","windowId","windowType","activeTabUIStore","activeTab","url","title","favIconUrl","dateTime","toISOString","tabs","query","active","id","load","isServerSide","ext","getBrowserExt","response","getObjectFromLocalStorage","destroy","ExtensionContext","_BrowserAccessor","isInServiceWorker","self","ServiceWorkerGlobalScope","hasChromeApis","chrome","detectContext","isServiceWorker","hasExtensionApi","isWindow","isPopup","location","pathname","document","body","dataset","context","isOptions","_b","hasDevtools","devtools","isContentScript","protocol","startsWith","resolveExecutionContext","win","windows","getCurrent","err","console","browserApi","initPromise","currentContext","browser","polyfill","__vitePreload","import","__VITE_PRELOAD__","default","e","createChromeShim","getBrowser","getBrowserSync","getContext","setBrowser","hasChromeApi","apiName","sidePanel","alarms","idle","notifications","performOperation","operation","fallback","connectInfo","keys","items","remove","clear","setPanelBehavior","options","open","tabsImpl","queryInfo","tab","alarmsImpl","create","nameOrInfo","maybeInfo","wasCleared","clearAll","onAlarm","listener","removeListener","hasListener","BrowserAccessor","rest","$.rest_props","$$props","handleShare","event","preventDefault","target","currentTarget","$.strict_equals","encodeURI","handleOpenInTab","showEmergencyKit","writable","showEmergencyKitExport","showEmergencyKitImport","handleLogout","goto","PATH_LOGOUT","openExportKit","_","isProUser","$.get","openImportKit","__1","settings","$.tag","$.state","offcanvasElement","isHoveringMenu","hoverTimeout","onMount","getSettings","$.set","shouldShowProFeatures","plan","PlanType","BASIC_MEMBER","setupClickOutsideListener","onDestroy","removeEventListener","handleClickOutside","addEventListener","isOffcanvasVisible","classList","contains","isClickOutside","isNotTrigger","closest","closeOffcanvas","bootstrap","offcanvasInstance","Offcanvas","hide","handleMenuMouseEnter","handleMenuMouseLeave","$$render","consequent","alternate","consequent_1","alternate_1","$.bind_this","div","$$value","handleUniversity","initial","userName","charAt","toUpperCase","defaultClasses","$.set_attribute","img","ariaLabel","$.set_class","className","$.clsx","resetForm","profile","profileData","updateField","first","get$1","last","email","bio","website","avatarUrl","show","$.prop","onClose","onComplete","isLoading","isSaving","success","previewAvatarUrl","hasChanges","showError","errorValue","validationSchema","yup.object","shape","yup.string","required","max","matches","firstName","lastName","optional","nullable","transform","form","errors","isValid","touched","createForm","initialValues","onSubmit","saveProfile","handleFormSubmit","$isValid","$form","$.user_effect","loadProfileData","currentValues","originalValues","trim","identicon","getProfile","isEncryptedData","miscStore","$yakklMiscStore","decryptData","errorMsg","updatedProfileData","persona","updatedProfile","updateDate","encryptData","encryptError","setProfileStorage","saveError","handleClose","confirm","handleErrorClose","expression","$.derived","$.template_effect","$.set_text","text","$errors","$touched","text_1","consequent_2","text_2","consequent_3","text_3","consequent_4","text_4","consequent_5","text_5","consequent_6","text_6","consequent_7","consequent_8","consequent_9","consequent_10","toLocaleString","consequent_11","set_text","text_7","button","disabled","$.bind_value","input","$.store_mutate","$.untrack","input_1","input_2","input_3","input_4","input_5","textarea","preferences","showTestNetworks","dark","SystemTheme","SYSTEM","locale","_d","currency","_e","code","idleDelayInterval","idleAutoLock","idleAutoLockCycle","showHints","trialCountdownPinned","themeOptions","label","LIGHT","DARK","currencyOptions","localeOptions","idleDelayOptions","yup.boolean","theme","oneOf","yup.number","saveSettings","loadSettingsData","$$array","updatedSettings","setSettings","getPlanLabel","planType","YAKKL_PRO","YAKKL_PREMIUM","version","createDate","toLocaleDateString","substring","$.each","select","option","option_1_value","option_1","__value","select_1","option_2_value","option_2","select_2","option_3_value","option_3","text_8","select_3","option_4_value","option_4","text_9","text_10","$.bind_checked","trialEndDate","$.bind_select_value","addWatchAccount","newAccountForm","watchAccounts","address","alias","newAccount","toString","tags","tag","portfolioValue","lastActivity","socialScore","isActive","createdAt","accountType","category","largeTransactions","balanceChanges","socialActivity","handleComplete","__2","on_click","__3","on_click_1","__4","on_click_2","__5","on_click_3","__6","on_click_4","__7","on_click_5","__8","selectAccount","account","removeWatchAccount","on_click_7","__10","on_click_8","__11","$.proxy","selectedAccount","socialData","$.tag_proxy","supportedBlockchains","symbol","accountTypes","description","icon","loadWatchAccounts","followersCount","tradingActivity","reputationScore","recentTransactions","amount","direction","significance","influenceMetrics","copyTraders","portfolioMirrors","socialMentions","accountId","acc","addTag","removeTag","index","i","formatBalance","toFixed","getAccountTypeInfo","find","t","getActivityColor","activity","option_value","__keydown","key","$.index","$$anchor","button_6","__click","each","node_5","template_effect","text_12","slice","text_13","social","tx","text_23","text_26","toLocaleTimeString","text_22","alternate_4","text_17","alternate_5","alternate_3","alternate_2","set_class","button_1","button_2","button_3","text_28","consequent_12","alternate_6","consequent_13","openProfile","showProfileModal","openSettings","showSettingsModal","openWatchList","showWatchListModal","handleProfileComplete","handleSettingsComplete","handleWatchListComplete","handlePopout","safeLogout","browserContext","$.mutable_source","imageSRC","browserAccessor","current","registered","meta","showOffcanvasMain","element","getElementById","getOrCreateInstance","showOffcanvasProfile","handleMainMenuHover","handleMainMenuLeave","handleProfileMenuHover","handleProfileMenuLeave","SIDEPANEL","default_format","formatters","RFC1738","v","String","replace","RFC3986","is_array","hex_table","array","limit","encode","str","_defaultEncoder","charset","_kind","format","string","Symbol","prototype","call","escape","$0","parseInt","out","j","segment","arr","c","charCodeAt","join","is_buffer","obj","isBuffer","maybe_map","val","fn","mapped","hasOwnProperty","array_prefix_generators","brackets","prefix","comma","indices","repeat","push_to_array","value_or_array","apply","to_ISO","defaults","addQueryPrefix","allowDots","allowEmptyArrays","arrayFormat","charsetSentinel","delimiter","encodeDotInKeys","encoder","encodeValuesOnly","formatter","serializeDate","date","skipNulls","strictNullHandling","is_non_nullish_primitive","sentinel","inner_stringify","object","generateArrayPrefix","commaRoundTrip","sort","sideChannel","tmp_sc","step","find_flag","pos","RangeError","key_value","obj_keys","encoded_prefix","adjusted_prefix","encoded_key","key_prefix","valueSideChannel","WeakMap","normalize_stringify_options","opts","TypeError","stringify","joined","VERSION","auto","kind","fetch","FormData","File","ReadableStream","getMultipartRequestOptions","getDefaultAgent","fileFromPath","isFsReadStream","setShims","shims","MultipartBody","toStringTag","getRuntime","manuallyImported","recommendation","_fetch","_Request","_Response","_Headers","Request","Response","Headers","Blob","init","shims.kind","auto.getRuntime","OpenAIError","APIError","status","headers","super","makeMessage","request_id","param","msg","JSON","generate","errorResponse","APIConnectionError","cause","castToError","BadRequestError","AuthenticationError","PermissionDeniedError","NotFoundError","ConflictError","UnprocessableEntityError","RateLimitError","InternalServerError","APIUserAbortError","APIConnectionTimeoutError","LengthFinishReasonError","ContentFilterFinishReasonError","__classPrivateFieldSet","receiver","f","__classPrivateFieldGet","_LineDecoder_carriageReturnIndex","LineDecoder","buffer","Uint8Array","__classPrivateFieldSet$5","decode","chunk","binaryChunk","ArrayBuffer","TextEncoder","newData","lines","patternIndex","findNewlineIndex","carriage","decodeText","endIndex","preceding","line","bytes","Buffer","from","TextDecoder","textDecoder","flush","NEWLINE_CHARS","Set","NEWLINE_REGEXP","startIndex","newline","findDoubleNewlineIndex","ReadableStreamToAsyncIterable","stream","asyncIterator","reader","getReader","next","read","done","releaseLock","cancelPromise","cancel","Stream","iterator","controller","fromSSEResponse","consumed","sse","_iterSSEMessages","parse","raw","createResponseHeaders","abort","fromReadableStream","readableStream","iterLines","lineDecoder","iter","tee","left","right","teeIterator","queue","toReadableStream","start","pull","ctrl","close","enqueue","return","sseDecoder","SSEDecoder","sseChunk","iterSSEChunks","chunks","endsWith","fieldname","partition","indexOf","isResponseLike","blob","isFileLike","lastModified","isBlobLike","arrayBuffer","isUploadable","toFile","URL","split","pop","bits","getBytes","getName","parts","isView","isAsyncIterableIterator","propsForError","props","getOwnPropertyNames","map","p","getStringFromMaybeBuffer","filename","path","x","isMultipartBody","multipartFormRequestOptions","entries","addFormValue","append","file","entry","prop","_AbstractPage_client","defaultParseResponse","__streamClass","__binaryResponse","contentType","mediaType","isJSON","json","_addRequestID","defineProperty","enumerable","APIPromise","responsePromise","parseResponse","_thenUnwrap","asResponse","withResponse","parsedPromise","onfulfilled","onrejected","onfinally","finally","APIClient","baseURL","maxRetries","timeout","httpAgent","overriddenFetch","validatePositiveInteger","authHeaders","defaultHeaders","Accept","getUserAgent","getPlatformHeaders","validateHeaders","customHeaders","defaultIdempotencyKey","uuid4","methodRequest","post","patch","put","method","request","opts2","DataView","getAPIList","Page","requestAPIList","calculateContentLength","byteLength","encoded","buildRequest","inputOptions","__binaryRequest","contentLength","buildURL","minAgentTimeout","idempotencyHeader","idempotencyKey","reqHeaders","buildHeaders","req","agent","signal","applyHeadersMut","shimsKind","getHeader","trunc","prepareOptions","prepareRequest","parseHeaders","fromEntries","header","makeStatusError","remainingRetries","makeRequest","optionsInput","retriesRemaining","aborted","AbortController","fetchWithTimeout","retryRequest","responseHeaders","ok","shouldRetry","retryMessage","errText","errJSON","safeJSON","errMessage","PagePromise","isAbsoluteURL","defaultQuery","isEmptyObj","search","stringifyQuery","encodeURIComponent","ms","fetchOptions","shouldRetryHeader","timeoutMillis","retryAfterMillisHeader","timeoutMs","parseFloat","isNaN","retryAfterHeader","timeoutSeconds","calculateDefaultRetryTimeoutMillis","sleep","initialRetryDelay","maxRetryDelay","numRetries","sleepSeconds","AbstractPage","client","__classPrivateFieldSet$4","hasNextPage","getPaginatedItems","nextPageInfo","getNextPage","nextInfo","nextOptions","params","searchParams","iterPages","page","item","Proxy","toLowerCase","requestOptionsKeys","__metadata","isRequestOptions","every","k","hasOwn","getPlatformProperties","Deno","build","normalizePlatform","os","normalizeArch","arch","deno","EdgeRuntime","process","platform","browserInfo","getBrowserInfo","navigator","browserPatterns","pattern","match","exec","userAgent","major","minor","_platformHeaders","startsWithSchemeRegexp","test","n","isInteger","readEnv","env","_c","_k","targetHeaders","newHeaders","lowerKey","SENSITIVE_HEADERS","action","args","modifiedArgs","arg","modifiedArg","modifiedArg2","r","isRunningInBrowser","isHeadersProtocol","lowerCasedHeader","intercapsHeader","_m","g1","g2","toFloat32Array","base64Str","buf","Float32Array","byteOffset","BYTES_PER_ELEMENT","binaryStr","atob","len","isObj","nextPageParams","CursorPage","has_more","after","APIResource","_client","Messages","list","completionId","ChatCompletionStoreMessagesPage","Completions","arguments","MessagesAPI.Messages","retrieve","update","ChatCompletionsPage","del","Chat","completions","CompletionsAPI.Completions","Speech","Transcriptions","Core.multipartFormRequestOptions","model","Translations","Audio","transcriptions","TranscriptionsAPI.Transcriptions","translations","TranslationsAPI.Translations","speech","SpeechAPI.Speech","Batches","batchId","BatchesPage","_EventStream_instances","_EventStream_connectedPromise","_EventStream_resolveConnectedPromise","_EventStream_rejectConnectedPromise","_EventStream_endPromise","_EventStream_resolveEndPromise","_EventStream_rejectEndPromise","_EventStream_listeners","_EventStream_ended","_EventStream_errored","_EventStream_aborted","_EventStream_catchingPromiseCreated","_EventStream_handleError","EventStream","add","__classPrivateFieldSet$3","_run","executor","_emitFinal","_emit","bind","_connected","ended","errored","on","listeners","off","findIndex","l","splice","once","emitted","WeakSet","openAIError","_AssistantStream_instances","_AssistantStream_events","_AssistantStream_runStepSnapshots","_AssistantStream_messageSnapshots","_AssistantStream_messageSnapshot","_AssistantStream_finalRun","_AssistantStream_currentContentIndex","_AssistantStream_currentContent","_AssistantStream_currentToolCallIndex","_AssistantStream_currentToolCall","_AssistantStream_currentEvent","_AssistantStream_currentRunSnapshot","_AssistantStream_currentRunStepSnapshot","_AssistantStream_addEvent","_AssistantStream_endRequest","_AssistantStream_handleMessage","_AssistantStream_handleRunStep","_AssistantStream_handleEvent","_AssistantStream_accumulateRunStep","_AssistantStream_accumulateMessage","_AssistantStream_accumulateContent","_AssistantStream_handleRun","AssistantStream","pushQueue","readQueue","runner","_fromReadableStream","_addRun","createToolAssistantStream","threadId","runId","runs","_runToolAssistantStream","_createToolAssistantStream","run","submitToolOutputs","createThreadAssistantStream","thread","_threadAssistantStream","createAssistantStream","_runAssistantStream","currentEvent","currentRun","currentMessageSnapshot","currentRunStepSnapshot","finalRunSteps","finalMessages","finalRun","_createThreadAssistantStream","createAndRun","_createAssistantStream","accumulateDelta","delta","deltaValue","accValue","Core.isObj","deltaEntry","accEntry","__classPrivateFieldSet$2","accumulatedMessage","newContent","content","snapshotContent","textDelta","snapshot","image_file","currentContent","accumulatedRunStep","step_details","tool_calls","toolCall","details","__classPrivateFieldGet$3","accumulated","contentElement","Assistants","assistantId","AssistantsPage","isRunnableFunctionWithParse","isAssistantMessage","role","isFunctionMessage","isToolMessage","isAutoParsableResponseFormat","response_format","isAutoParsableTool","tool","maybeParseChatCompletion","completion","hasAutoParseableInput","choices","choice","parsed","parseChatCompletion","finish_reason","parseToolCall","refusal","parseResponseFormat","$parseRaw","inputTool","tools","function","parsed_arguments","strict","shouldParseToolCall","some","validateInputTools","_AbstractChatCompletionRunner_instances","_AbstractChatCompletionRunner_getFinalContent","_AbstractChatCompletionRunner_getFinalMessage","_AbstractChatCompletionRunner_getFinalFunctionCall","_AbstractChatCompletionRunner_getFinalFunctionCallResult","_AbstractChatCompletionRunner_calculateTotalUsage","_AbstractChatCompletionRunner_validateParams","_AbstractChatCompletionRunner_stringifyFunctionCallResult","DEFAULT_MAX_CHAT_COMPLETIONS","AbstractChatCompletionRunner","_chatCompletions","_addChatCompletion","chatCompletion","_addMessage","emit","function_call","tool_call","finalChatCompletion","finalContent","finalMessage","finalFunctionCall","finalFunctionCallResult","totalUsage","allChatCompletions","usage","_createChatCompletion","chat","_runChatCompletion","_runFunctions","restParams","singleFunctionToCall","maxChatCompletions","functionsByName","functions","parameters","rawContent","_runTools","tool_choice","inputTools","$callback","tool_call_id","ret","at","y","total","completion_tokens","prompt_tokens","total_tokens","ChatCompletionRunner","runFunctions","runTools","STR","NUM","ARR","OBJ","NULL","BOOL","NAN","INFINITY","MINUS_INFINITY","INF","SPECIAL","ATOM","COLLECTION","ALL","Allow","PartialJSON","MalformedJSON","parseJSON","jsonString","allowPartial","_parseJSON","allow","markPartialJSON","throwMalformedError","parseAny","skipBlank","parseStr","parseObj","parseArr","Infinity","NaN","parseNum","lastIndexOf","configurable","partialParse","_ChatCompletionStream_instances","_ChatCompletionStream_params","_ChatCompletionStream_choiceEventStates","_ChatCompletionStream_currentChatCompletionSnapshot","_ChatCompletionStream_beginRequest","_ChatCompletionStream_getChoiceEventState","_ChatCompletionStream_addChunk","_ChatCompletionStream_emitToolCallDoneEvent","_ChatCompletionStream_emitContentDoneEvents","_ChatCompletionStream_endRequest","_ChatCompletionStream_getAutoParseableResponseFormat","_ChatCompletionStream_accumulateChatCompletion","ChatCompletionStream","__classPrivateFieldSet$1","currentChatCompletionSnapshot","createChatCompletion","chatId","content_done","refusal_done","logprobs_content_done","logprobs_refusal_done","done_tool_calls","current_tool_call_index","choiceSnapshot","logprobs","_f","_g","_h","_i","_j","_l","__classPrivateFieldGet$1","toolCallDelta","toolCallSnapshot","_n","arguments_delta","_o","assertNever","toolCallIndex","responseFormat","finalizeChatCompletion","assign","other","created","system_fingerprint","choiceRest","messageRest","toolRest","fnRest","_x","ChatCompletionStreamingRunner","Sessions","TranscriptionSessions","Realtime","sessions","SessionsAPI.Sessions","transcriptionSessions","TranscriptionSessionsAPI.TranscriptionSessions","messageId","MessagesPage","Steps","stepId","RunStepsPage","Runs","steps","StepsAPI.Steps","include","RunsPage","createAndPoll","poll","createAndStream","beta","threads","pollIntervalMs","sleepInterval","headerInterval","headerIntervalMs","submitToolOutputsAndPoll","submitToolOutputsStream","Threads","RunsAPI.Runs","createAndRunPoll","thread_id","createAndRunStream","Beta","realtime","RealtimeAPI.Realtime","ChatAPI.Chat","assistants","AssistantsAPI.Assistants","ThreadsAPI.Threads","Content","containerId","fileId","Files","ContentAPI.Content","FileListResponsesPage","Containers","files","FilesAPI.Files","ContainerListResponsesPage","Embeddings","hasUserProvidedEncodingFormat","encoding_format","Core.debug","embeddingBase64Obj","embeddingBase64Str","embedding","Core.toFloat32Array","OutputItems","evalId","outputItemId","OutputItemListResponsesPage","outputItems","OutputItemsAPI.OutputItems","RunListResponsesPage","Evals","EvalListResponsesPage","FileObjectsPage","retrieveContent","waitForProcessing","pollInterval","maxWait","TERMINAL_STATES","Methods","Graders","validate","Alpha","graders","GradersAPI.Graders","Permissions","fineTunedModelCheckpoint","PermissionCreateResponsesPage","permissionId","Checkpoints","permissions","PermissionsAPI.Permissions","fineTuningJobId","FineTuningJobCheckpointsPage","Jobs","checkpoints","CheckpointsAPI.Checkpoints","FineTuningJobsPage","listEvents","FineTuningJobEventsPage","pause","resume","FineTuning","methods","MethodsAPI.Methods","jobs","JobsAPI.Jobs","alpha","AlphaAPI.Alpha","GraderModels","graderModels","GraderModelsAPI.GraderModels","Images","createVariation","edit","Models","ModelsPage","Moderations","maybeParseResponse","output_parsed","output","parseTextFormat","getOwnPropertyDescriptor","addOutputText","text_format","getInputToolByName","input_tools","rsp","texts","output_text","InputItems","responseId","ResponseItemsPage","_ResponseStream_instances","_ResponseStream_params","_ResponseStream_currentResponseSnapshot","_ResponseStream_finalResponse","_ResponseStream_beginRequest","_ResponseStream_addEvent","_ResponseStream_endRequest","_ResponseStream_accumulateResponse","ResponseStream","createResponse","_createOrRetrieveResponse","starting_after","responses","response_id","maybeEmit","sequence_number","output_index","content_index","parsedResponse","finalizeResponse","part","finalResponse","Responses","inputItems","InputItemsAPI.InputItems","Parts","uploadId","Uploads","PartsAPI.Parts","complete","allSettledWithThrow","promises","results","rejected","reason","vectorStoreId","VectorStoreFilesPage","fileResponse","upload","fileInfo","purpose","file_id","uploadAndPoll","FileContentResponsesPage","FileBatches","batch","listFiles","fileIds","configuredConcurrency","maxConcurrency","concurrencyLimit","fileIterator","allFileIds","processFiles","fileObj","workers","fill","file_ids","VectorStores","fileBatches","FileBatchesAPI.FileBatches","VectorStoresPage","VectorStoreSearchResponsesPage","OpenAI","Core.APIClient","Core.readEnv","organization","project","Errors.OpenAIError","dangerouslyAllowBrowser","Core.isRunningInBrowser","API.Completions","API.Chat","embeddings","API.Embeddings","API.Files","images","API.Images","audio","API.Audio","moderations","API.Moderations","models","API.Models","fineTuning","API.FineTuning","API.Graders","vectorStores","API.VectorStores","API.Beta","batches","API.Batches","uploads","API.Uploads","API.Responses","evals","API.Evals","containers","API.Containers","_options","Authorization","qs.stringify","DEFAULT_TIMEOUT","Errors.APIError","Errors.APIConnectionError","Errors.APIConnectionTimeoutError","Errors.APIUserAbortError","Errors.NotFoundError","Errors.ConflictError","Errors.RateLimitError","Errors.BadRequestError","Errors.AuthenticationError","Errors.InternalServerError","Errors.PermissionDeniedError","Errors.UnprocessableEntityError","Uploads.toFile","Uploads.fileFromPath","UploadsAPIUploads","fetchGPT4Response","prompt","getYakklGPTKeyStore","openai","apiKeyFetch","apiUrl","keyId","clearMessages","setYakklChatsStorage","showClearWarning","handlePrint","clipboard","$.store_set","yakklGPTRunningStore","ClipboardJS","$yakklGPTKeyStore","yakklGPTKeyStore","loadedMessages","getYakklChats","storeChats","messageArray","cleanMessages","sender","DEFAULT_PERSONA","dateString","yakklChatsStore","handleSendMessage","dateNow","$yakklConnectionStore","newUserMessage","formattedResponse","newBotMessage","node_2","$.html","node_4","div_3","div_5","div_6","formatTimestamp","$yakklGPTRunningStore","on_keydown","shiftKey","chatbotComponent","bind_value","Chatbot","handleBuy","showChat","classParam","showBuy","showSwap","yakklSettingsStore","fundingAddress","swapPriceProvider","swapManager","UniswapSwapManager","home","PATH_LOGIN","PATH_WELCOME","send","PATH_ETHEREUM_TRANSACTIONS_SEND","buy","swap","getFullYear","dismissAll","dismiss","notification","isLockdownActive","lockdownTimeLeft","isUrgent","timerManager","UnifiedTimerManager","messageListener","sendResponse","addNotification","delayMs","countdown","ceil","intervalId","addInterval","updateCountdown","startInterval","countdownInterval","removeNotification","notificationId","handleIdleStateChange","detail","clearAllIntervals","handleUserActivity","existing","stopInterval","removeInterval","newCountdown","hasLockdownWarning","NotificationService","clearAllAlertsEnhanced","PI","round","transition","fly","duration","$.validate_each_keys","node_3","div_14","fade","div_18","handleChange","handleSubmit","updateInitialValues","decimals","sidepanel","evmCompatible","logoURI","customDefault","isNative","isStablecoin","network","standard","isWatchOnly","portfolioIncluded","coingeckoId","exchange","exchangeSymbol","isExchangeBalance","when","is","schema","otherwise","updatedToken","quantity","lastUpdated","change","watchedAt","exchangeInfo","metadata","$$args","TokenForm","consequent_14","consequent_15","consequent_16","input_10","consequent_17","consequent_18","consequent_19","text_11","consequent_20","consequent_21","input_6","input_7","input_8","input_9","input_11","input_12","input_13","input_14","input_15","onTokenSelect","tokens","onTokenUpdate","onTokenDelete","selectedToken","showEditModal","showDeleteModal","currencyFormatter","Intl","NumberFormat","style","minimumFractionDigits","maximumFractionDigits","preciseFormatter","handleEdit","handleDelete","confirmDelete","getAnalyticsData","toProAnalytics","toBasicAnalytics","formatLargeNumber","getRiskColor","score","getRiskLevel","ul","analytics","rawBalance","balanceNumber","balanceValue","expression_1","currentPrice","proData","yieldOpportunities","apy","span_5","priceChange24h","span_6","priceChange7d","$1","span_12","socialSentiment","mentions24h","marketCap","volume24h","riskScore","technicalIndicators","rsi","percentageValue","getTokenChange","span_14","text_15","expression_3","onCopy","writeText","onEdit","onDelete","p_1","text_14","showAddModal","isBasicMember","isRefreshing","lastRefreshTime","autoRefreshInterval","BASIC_AUTO_REFRESH_INTERVAL_MS","PRO_AUTO_REFRESH_INTERVAL_MS","instances","startAutoRefresh","$yakklCombinedTokenStore","interval","refreshTokenPrices","showLoading","handleTokenSelect","handleTokenAdd","getTokenBalance","$yakklCurrentlySelectedStore","yakklTokenDataCustomStore","setYakklTokenDataCustomStorage","$yakklTokenDataCustomStore","handleTokenDelete","deletedToken","updatedTokens","handleTokenUpdate","closeModal","tokenTotals","derived","yakklCombinedTokenStore","portfolioTotal","formattedTotal","chainTotals","byChain","formatted","formattedChainTotals","reduce","handleManualRefresh","isManualRefreshing","timeSinceLastRefresh","lastManualRefresh","minInterval","refreshCooldown","cooldownInterval","$.update","showDetails","validCurrency","totalPortfolioValue","portfolioBreakdown","showTooltip","hasInitialLoad","percentFormatter","totals","$tokenTotals","breakdown","totalValue","balanceNum","tokenValue","percentage","ethPrice","$yakklPricingStore","ethBalance","formatEther","ethValue","a","b","tooltipTimeout","isHoveringTooltip","isHoveringTrigger","handleMouseEnter","handleMouseLeave","handleTooltipMouseEnter","handleTooltipMouseLeave","getTokenDisplayName","canManualRefresh","div_15","div_28","alternate_7","expression_5","expression_6","div_41","expression_8","checkPricesCallback","updateTokenPrices","updateWithCurrentlySelected","showErrorSafely","toggleDropdown","isDropdownOpen","handleNetworkTypeChange","shouldShowErrorToUser","errorMessage","networkErrors","errorCooldown","networks","NetworkType","MAINNET","explorer","TESTNET","networkLabel","addressShow","nameShow","valueFiat","showAccountsModal","showAccountImportModal","showWatchAccountModal","showContacts","showTokens","showRecv","showUpgradeModal","prevPrice","assetPriceValue","assetPrice","symbolLabel","currencyLabel","shortcutsValue","EthereumBigNumber","formattedEtherValue","isCalculatingPortfolio","portfolioCurrency","updateDisplayValues","newAssetPrice","previousAddress","isUpdatingBalance","initializationTimeout","cached","balanceCacheManager","getCachedBalance","cachedPortfolio","accountTokenCacheManager","getCachedPortfolioValue","isStale","refreshBalanceInBackground","isPortfolioValueStale","refreshPortfolioInBackground","$.effect_root","unsubscribeYakklStore","subscribe","calculateAndCachePortfolioValue","startPricingChecks","updateTokenBalances","getBalance","setYakklCurrentlySelectedStorage","updateValuePriceFiat","updatePriceForAllEntries","newPrice","accountName","truncate","stopCheckPrices","freshBalance","setCachedBalance","yakklCurrentlySelectedStore","accountTokens","getCachedTokensForAccount","tokenList","currencyCode","setCachedPortfolioValue","tokenCount","resetPriceData","qty","etherValue","fiatValue","etherValueString","newFiatValue","updatePriceDirection","handleAccounts","updatedCurrentlySelected","primary","primaryAccount","accounts","net","setChainId","encryptedData","handleContact","handleToken","handleImport","handleWatchAccountComplete","getChainId","toEtherString","$yakklAccountsStore","onCancel","$.equals","click","$$events","$$index","expression_2","popupWidth","DEFAULT_POPUP_WIDTH","popupHeight","DEFAULT_POPUP_HEIGHT","DEFAULT_TITLE","contextMenu","resize","onLine","blockContextMenu","blockWindowResize","sessionInitialized","initializeUiContext","$modal","$modalName"],"ignoreList":[17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94],"sources":["../../../../../../src/lib/common/computeTokenValue.ts","../../../../../../src/lib/common/wallet.ts","../../../../../../src/lib/managers/BackgroundManager.ts","../../../../../../src/lib/common/stores/connectionStore.ts","../../../../../../src/routes/(wallet)/+layout.ts","../../../../../../src/lib/common/shared/BrowserAccessor.ts","../../../../../../src/lib/components/Share.svelte","../../../../../../src/lib/common/stores/ui.ts","../../../../../../src/lib/components/OffcanvasMainMenu.svelte","../../../../../../src/lib/components/icons/GraduationCapButton.svelte","../../../../../../src/lib/components/Avatar.svelte","../../../../../../src/lib/components/Profile.svelte","../../../../../../src/lib/components/Settings.svelte","../../../../../../src/lib/components/Watcher.svelte","../../../../../../src/lib/components/WatchList.svelte","../../../../../../src/lib/components/OffcanvasProfileMenu.svelte","../../../../../../src/lib/components/Header.svelte","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/internal/qs/formats.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/internal/qs/utils.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/internal/qs/stringify.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/version.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/_shims/registry.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/_shims/MultipartBody.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/_shims/web-runtime.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/_shims/index.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/error.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/internal/decoders/line.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/internal/stream-utils.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/streaming.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/uploads.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/core.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/pagination.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resource.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/chat/completions/messages.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/chat/completions/completions.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/chat/chat.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/audio/speech.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/audio/transcriptions.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/audio/translations.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/audio/audio.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/batches.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/lib/EventStream.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/lib/AssistantStream.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/beta/assistants.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/lib/RunnableFunction.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/lib/chatCompletionUtils.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/lib/parser.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/lib/AbstractChatCompletionRunner.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/lib/ChatCompletionRunner.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/_vendor/partial-json-parser/parser.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/lib/ChatCompletionStream.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/lib/ChatCompletionStreamingRunner.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/beta/chat/completions.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/beta/chat/chat.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/beta/realtime/sessions.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/beta/realtime/transcription-sessions.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/beta/realtime/realtime.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/beta/threads/messages.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/beta/threads/runs/steps.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/beta/threads/runs/runs.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/beta/threads/threads.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/beta/beta.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/completions.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/containers/files/content.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/containers/files/files.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/containers/containers.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/embeddings.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/evals/runs/output-items.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/evals/runs/runs.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/evals/evals.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/files.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/fine-tuning/methods.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/fine-tuning/alpha/graders.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/fine-tuning/alpha/alpha.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/fine-tuning/checkpoints/permissions.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/fine-tuning/checkpoints/checkpoints.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/fine-tuning/jobs/checkpoints.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/fine-tuning/jobs/jobs.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/fine-tuning/fine-tuning.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/graders/grader-models.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/graders/graders.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/images.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/models.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/moderations.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/lib/ResponsesParser.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/responses/input-items.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/lib/responses/ResponseStream.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/responses/responses.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/uploads/parts.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/uploads/uploads.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/lib/Util.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/vector-stores/files.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/vector-stores/file-batches.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/resources/vector-stores/vector-stores.mjs","../../../../../../../../node_modules/.pnpm/openai@4.104.0_ws@7.5.10_bufferutil@4.0.9_utf-8-validate@5.0.10__zod@3.25.67/node_modules/openai/index.mjs","../../../../../../src/lib/api/api-gpt.ts","../../../../../../src/lib/api/apis.ts","../../../../../../src/lib/components/Chatbot.svelte","../../../../../../src/lib/components/ChatbotModal.svelte","../../../../../../src/lib/components/Buy.svelte","../../../../../../src/lib/components/Footer.svelte","../../../../../../src/lib/components/InAppNotifications.svelte","../../../../../../src/lib/components/TokenForm.svelte","../../../../../../src/lib/components/TokenListEnhanced.svelte","../../../../../../src/lib/components/TokensEnhanced.svelte","../../../../../../src/lib/common/stores/tokenTotals.ts","../../../../../../src/lib/components/icons/TokensIcon.svelte","../../../../../../src/lib/components/PortfolioTotal.svelte","../../../../../../src/lib/components/Card.svelte","../../../../../../src/routes/(wallet)/+layout.svelte"],"sourcesContent":["import type { TokenData } from './interfaces';\n\n/**\n * Computes the balance and value of a token.\n * @param token The token data object\n * @returns { balance: number, value: number }\n */\n\nexport function computeTokenValue(token: TokenData): { balance: number; value: number } {\n\tlet balance = token?.balance ? Number(token.balance) : 0; // Direct conversion\n\n\tconst price = token?.price?.price ?? 0;\n\tconst value = balance * price;\n\n\treturn { balance, value };\n}\n","import type { Blockchain } from '$lib/managers/Blockchain';\nimport type { Provider } from '$lib/managers/Provider';\nimport type { Wallet } from '$lib/managers/Wallet';\nimport WalletManager from '$lib/managers/WalletManager';\nimport { getYakklCurrentlySelectedAccountKey } from './security';\nimport { getMiscStore, getYakklCurrentlySelected } from './stores';\nimport type { Ethereum } from '$lib/managers/blockchains/evm/ethereum/Ethereum';\nimport { TokenService } from '$lib/managers/blockchains/evm/TokenService';\nimport { log } from '$lib/managers/Logger';\n\nexport async function getInstances(): Promise<\n\t[Wallet | null, Provider | null, Blockchain | null, TokenService<any> | null]\n> {\n\ttry {\n\t\tconst yakklMiscStore = getMiscStore();\n\t\tif (!yakklMiscStore) {\n\t\t\t// log.debug(\"getInstances() - Not logged in.\");\n\t\t\treturn [null, null, null, null];\n\t\t}\n\n\t\tconst currentlySelected = await getYakklCurrentlySelected();\n\t\tconst chainId = currentlySelected.shortcuts?.chainId ?? 1;\n\n\t\tlet wallet: Wallet | null = null;\n\t\tconst apiKey =\n\t\t\tprocess.env.ALCHEMY_API_KEY_PROD ||\n\t\t\tprocess.env.VITE_ALCHEMY_API_KEY_PROD ||\n\t\t\timport.meta.env.VITE_ALCHEMY_API_KEY_PROD;\n\n\t\twallet = WalletManager.getInstance(['Alchemy'], ['Ethereum'], chainId, apiKey);\n\n\t\tif (wallet) {\n\t\t\tif (!wallet.getSigner()) {\n\t\t\t\t// log.debug(\"No signer found. Retrieving account key...\");\n\t\t\t\tconst accountKey = await getYakklCurrentlySelectedAccountKey();\n\t\t\t\tif (accountKey?.privateKey) {\n\t\t\t\t\tawait wallet.setSigner(accountKey.privateKey);\n\t\t\t\t} else {\n\t\t\t\t\tlog.warn('No account key found, wallet may not be functional.');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst provider = wallet.getProvider();\n\t\t\tif (provider) {\n\t\t\t\tconst signer = wallet.getSigner();\n\t\t\t\tif (signer) {\n\t\t\t\t\tprovider.setSigner(signer);\n\t\t\t\t\t// log.debug(\"Provider signer set.\");\n\t\t\t\t}\n\t\t\t\tconst blockchain = wallet.getBlockchain() as Ethereum;\n\t\t\t\tconst tokenService = new TokenService(blockchain);\n\t\t\t\treturn [wallet, provider, blockchain, tokenService];\n\t\t\t}\n\t\t\treturn [wallet, null, null, null];\n\t\t}\n\t\treturn [null, null, null, null];\n\t} catch (error) {\n\t\tlog.error('getInstances() - Failed:', false, error);\n\t\treturn [null, null, null, null];\n\t}\n}\n","import { browser_ext } from '$lib/common/environment';\nimport { log } from '$lib/common/logger-wrapper';\nimport type { Runtime } from 'webextension-polyfill';\n\nexport interface QueuedMessage<T = unknown> {\n\ttype: string;\n\tdata: T;\n\ttimestamp: number;\n}\n\nexport interface StorageData {\n\t[key: string]: unknown;\n}\n\nexport enum ConnectionType {\n\tUI = 'ui-connection',\n\tPOPUP = 'popup-connection',\n\tCONTENT = 'content-connection'\n}\n\nexport interface ConnectionInfo {\n\ttype: ConnectionType;\n\tport: Runtime.Port;\n\tconnectedAt: number;\n}\n\nexport class BackgroundManager {\n\tprivate static instance: BackgroundManager | null = null;\n\tprivate connections: Map<string, ConnectionInfo>;\n\tprivate messageQueue: QueuedMessage[];\n\tprivate readonly MAX_QUEUE_SIZE = 100;\n\tprivate readonly STORAGE_PREFIX = 'bg_msg_';\n\tprivate initialized: boolean = false;\n\n\tprivate constructor() {\n\t\tthis.connections = new Map();\n\t\tthis.messageQueue = [];\n\t\tthis.initialize().catch((error) => {\n\t\t\tlog.error('Failed to initialize BackgroundManager:', false, error);\n\t\t});\n\t}\n\n\tpublic static getInstance(): BackgroundManager {\n\t\tif (!BackgroundManager.instance) {\n\t\t\tBackgroundManager.instance = new BackgroundManager();\n\t\t}\n\t\treturn BackgroundManager.instance;\n\t}\n\n\tprivate async initialize(): Promise<void> {\n\t\tif (!browser_ext) return;\n\t\tif (this.initialized) return;\n\n\t\ttry {\n\t\t\tbrowser_ext.runtime.onConnect.addListener((port) => {\n\t\t\t\tif (this.isValidConnectionType(port.name)) {\n\t\t\t\t\tthis.handleNewConnection(port);\n\t\t\t\t}\n\t\t\t\t// Note: Only handle specific connection types that you have defined and let the rest flow through\n\t\t\t\t// log.warn('Invalid connection type attempted:', false, { portName: port.name });\n\t\t\t\t// port.disconnect();\n\t\t\t});\n\n\t\t\tawait this.restoreQueuedMessages();\n\n\t\t\tthis.initialized = true;\n\t\t\t// log.info('BackgroundManager initialized');\n\t\t} catch (error) {\n\t\t\tlog.error('BackgroundManager initialization failed:', false, error);\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tprivate isValidConnectionType(type: string): type is ConnectionType {\n\t\treturn Object.values(ConnectionType).includes(type as ConnectionType);\n\t}\n\n\tprivate handleNewConnection(port: Runtime.Port): void {\n\t\ttry {\n\t\t\tconst connectionInfo: ConnectionInfo = {\n\t\t\t\ttype: port.name as ConnectionType,\n\t\t\t\tport,\n\t\t\t\tconnectedAt: Date.now()\n\t\t\t};\n\n\t\t\tthis.connections.set(port.name, connectionInfo);\n\t\t\t// log.debug('New connection established:', false, {\n\t\t\t//   type: port.name,\n\t\t\t//   timestamp: connectionInfo.connectedAt\n\t\t\t// });\n\n\t\t\tport.onDisconnect.addListener(() => {\n\t\t\t\tthis.handleDisconnection(port);\n\t\t\t});\n\n\t\t\t// Process queued messages for new connection\n\t\t\tthis.processQueuedMessages().catch((error) => {\n\t\t\t\tlog.error('Failed to process queued messages:', false, error);\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tlog.error('Error handling new connection:', false, error);\n\t\t}\n\t}\n\n\tprivate handleDisconnection(port: Runtime.Port): void {\n\t\ttry {\n\t\t\tthis.connections.delete(port.name);\n\t\t\t// log.debug('Connection closed:', false, { type: port.name });\n\t\t} catch (error) {\n\t\t\tlog.error('Error handling disconnection:', false, error);\n\t\t}\n\t}\n\n\tpublic hasConnections(): boolean {\n\t\treturn this.connections.size > 0;\n\t}\n\n\tpublic hasUIConnection(): boolean {\n\t\treturn this.connections.has(ConnectionType.UI);\n\t}\n\n\tpublic getConnectionInfo(type: ConnectionType): ConnectionInfo | undefined {\n\t\treturn this.connections.get(type);\n\t}\n\n\tpublic async sendMessage<T>(type: string, data: T): Promise<void> {\n\t\ttry {\n\t\t\tif (!this.hasConnections()) {\n\t\t\t\tawait this.handleNoConnections(type, data);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst message = { type, data };\n\t\t\tconst sendPromises: Promise<void>[] = [];\n\n\t\t\tthis.connections.forEach(({ port }) => {\n\t\t\t\tsendPromises.push(\n\t\t\t\t\tnew Promise<void>((resolve, reject) => {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tport.postMessage(message);\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tawait Promise.allSettled(sendPromises);\n\t\t} catch (error) {\n\t\t\tlog.error('Failed to send message:', false, error);\n\t\t\tawait this.handleMessageError(type, data, error);\n\t\t}\n\t}\n\n\tprivate async handleNoConnections<T>(type: string, data: T): Promise<void> {\n\t\ttry {\n\t\t\tawait Promise.all([this.queueMessage(type, data), this.saveToStorage(type, data)]);\n\t\t} catch (error) {\n\t\t\tlog.error('Failed to handle no connections case:', false, error);\n\t\t}\n\t}\n\n\tprivate async handleMessageError<T>(type: string, data: T, error: unknown): Promise<void> {\n\t\ttry {\n\t\t\tawait this.queueMessage(type, data);\n\t\t\tlog.error('Message queued due to error:', false, { type, error });\n\t\t} catch (queueError) {\n\t\t\tlog.error('Failed to queue message after error:', false, queueError);\n\t\t}\n\t}\n\n\tprivate async queueMessage<T>(type: string, data: T): Promise<void> {\n\t\tconst queuedMessage: QueuedMessage<T> = {\n\t\t\ttype,\n\t\t\tdata,\n\t\t\ttimestamp: Date.now()\n\t\t};\n\n\t\tthis.messageQueue.push(queuedMessage);\n\n\t\tif (this.messageQueue.length > this.MAX_QUEUE_SIZE) {\n\t\t\tthis.messageQueue.shift();\n\t\t}\n\n\t\tawait this.persistQueue();\n\t}\n\n\tprivate async persistQueue(): Promise<void> {\n\t\tif (!browser_ext) return;\n\n\t\ttry {\n\t\t\tawait browser_ext.storage.local.set({\n\t\t\t\t[`${this.STORAGE_PREFIX}queue`]: this.messageQueue\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tlog.error('Failed to persist message queue:', false, error);\n\t\t}\n\t}\n\n\tprivate async restoreQueuedMessages(): Promise<void> {\n\t\tif (!browser_ext) return;\n\n\t\ttry {\n\t\t\tconst result = await browser_ext.storage.local.get(`${this.STORAGE_PREFIX}queue`);\n\t\t\tconst storedQueue = result[`${this.STORAGE_PREFIX}queue`];\n\n\t\t\t// Type guard to ensure array of QueuedMessage\n\t\t\tif (Array.isArray(storedQueue)) {\n\t\t\t\tthis.messageQueue = storedQueue.filter((message): message is QueuedMessage => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\ttypeof message === 'object' &&\n\t\t\t\t\t\tmessage !== null &&\n\t\t\t\t\t\t'type' in message &&\n\t\t\t\t\t\t'data' in message &&\n\t\t\t\t\t\t'timestamp' in message &&\n\t\t\t\t\t\ttypeof message.type === 'string' &&\n\t\t\t\t\t\ttypeof message.timestamp === 'number'\n\t\t\t\t\t);\n\t\t\t\t});\n\n\t\t\t\t// log.debug('Restored queued messages:', false, { count: this.messageQueue.length });\n\t\t\t} else {\n\t\t\t\tthis.messageQueue = [];\n\t\t\t\tlog.debug('No valid queued messages found in storage');\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tlog.error('Failed to restore queued messages:', false, error);\n\t\t\tthis.messageQueue = []; // Ensure valid state on error\n\t\t}\n\t}\n\n\tprivate async saveToStorage<T>(type: string, data: T): Promise<void> {\n\t\tif (!browser_ext) return;\n\n\t\ttry {\n\t\t\tawait browser_ext.storage.local.set({\n\t\t\t\t[`${this.STORAGE_PREFIX}${type}`]: {\n\t\t\t\t\tdata,\n\t\t\t\t\ttimestamp: Date.now()\n\t\t\t\t}\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tlog.error('Failed to save to storage:', false, error);\n\t\t}\n\t}\n\n\tpublic async processQueuedMessages(): Promise<void> {\n\t\tif (!this.hasConnections()) {\n\t\t\t// log.debug('No connections available to process queue');\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst messages = [...this.messageQueue];\n\t\t\tthis.messageQueue = [];\n\n\t\t\tfor (const message of messages) {\n\t\t\t\tawait this.sendMessage(message.type, message.data);\n\t\t\t}\n\n\t\t\tawait this.persistQueue();\n\t\t\t// log.debug('Processed queued messages:', false, { count: messages.length });\n\t\t} catch (error) {\n\t\t\tlog.error('Failed to process queued messages:', false, error);\n\t\t}\n\t}\n\n\tpublic async clearQueue(): Promise<void> {\n\t\ttry {\n\t\t\tthis.messageQueue = [];\n\t\t\tawait this.persistQueue();\n\t\t\t// log.debug('Message queue cleared');\n\t\t} catch (error) {\n\t\t\tlog.error('Failed to clear message queue:', false, error);\n\t\t}\n\t}\n\n\tpublic getQueueSize(): number {\n\t\treturn this.messageQueue.length;\n\t}\n\n\tpublic isInitialized(): boolean {\n\t\treturn this.initialized;\n\t}\n}\n\n// Export singleton instance\nexport const backgroundManager = BackgroundManager.getInstance();\n\n// Example how to use:\n\n// +layout.ts\n// import { initializeUIConnection } from '$lib/stores/connectionStore';\n\n// export async function load() {\n//   try {\n//     await initializeUIConnection();\n//   } catch (error) {\n//     log.error('Failed to initialize UI connection:', false, error);\n//   }\n// }\n\n// +background.ts\n// browser_ext.tabs.onActivated.addListener(async (activeInfo) => {\n//   try {\n//     const tab = await browser_ext.tabs.get(activeInfo.tabId);\n//     const activeTab = {\n//       tabId: activeInfo.tabId,\n//       url: tab.url\n//     };\n\n//     await backgroundManager.sendMessage('ACTIVE_TAB_CHANGED', activeTab);\n//     log.debug('Active tab change processed:', false, activeTab);\n//   } catch (error) {\n//     log.error('Failed to handle tab activation:', false, error);\n//   }\n// });\n","import { browser_ext, browserSvelte } from '$lib/common/environment';\nimport { ConnectionType } from '$managers/BackgroundManager';\nimport { log } from '$lib/common/logger-wrapper';\nimport type { MessageTypes, TabChangeData, WindowFocusData } from '$lib/common/types';\nimport { MessageType } from '$lib/common/types';\nimport { activeTabUIStore } from '../stores';\n\ninterface ConnectionState {\n\tretryCount: number;\n\tretryTimeout?: number;\n\tisConnecting: boolean;\n}\n\nconst MAX_RETRIES = 5;\nconst INITIAL_RETRY_DELAY = 1000; // 1 second\nconst MAX_RETRY_DELAY = 32000; // 32 seconds\nconst state: ConnectionState = {\n\tretryCount: 0,\n\tretryTimeout: undefined,\n\tisConnecting: false\n};\n\nfunction calculateBackoffDelay(retryCount: number): number {\n\t// Exponential backoff with jitter\n\tconst exponentialDelay = INITIAL_RETRY_DELAY * Math.pow(2, retryCount);\n\tconst maxDelay = Math.min(exponentialDelay, MAX_RETRY_DELAY);\n\t// Add random jitter (20%)\n\tconst jitter = maxDelay * 0.2 * (Math.random() * 2 - 1);\n\treturn Math.floor(maxDelay + jitter);\n}\n\nfunction cleanupConnection() {\n\tif (state.retryTimeout) {\n\t\tclearTimeout(state.retryTimeout);\n\t\tstate.retryTimeout = undefined;\n\t}\n\tstate.isConnecting = false;\n}\n\nasync function retryConnection(): Promise<void> {\n\tif (browserSvelte) {\n\t\tif (state.retryCount >= MAX_RETRIES) {\n\t\t\tlog.error('Maximum reconnection attempts reached', true, {\n\t\t\t\tattempts: state.retryCount\n\t\t\t});\n\t\t\tcleanupConnection();\n\t\t\treturn;\n\t\t}\n\n\t\tconst delay = calculateBackoffDelay(state.retryCount);\n\t\tlog.info('Attempting to reconnect', false, {\n\t\t\tattempt: state.retryCount + 1,\n\t\t\tdelay: `${delay}ms`\n\t\t});\n\n\t\tif (typeof window !== 'undefined') {\n\t\t\tstate.retryTimeout = window.setTimeout(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tstate.retryCount++;\n\t\t\t\t\tawait initializeUIConnection();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tlog.error('Reconnection attempt failed:', false, {\n\t\t\t\t\t\tattempt: state.retryCount,\n\t\t\t\t\t\terror\n\t\t\t\t\t});\n\t\t\t\t\tawait retryConnection();\n\t\t\t\t}\n\t\t\t}, delay);\n\t\t}\n\t}\n}\n\nexport async function initializeUIConnection() {\n\t// Prevent multiple simultaneous connection attempts\n\tif (state.isConnecting) {\n\t\tlog.warn('Connection attempt already in progress');\n\t\treturn;\n\t}\n\n\ttry {\n\t\tstate.isConnecting = true;\n\t\tif (browserSvelte && browser_ext) {\n\t\t\tconst port = browser_ext.runtime.connect({ name: ConnectionType.UI });\n\n\t\t\tif (!port) {\n\t\t\t\tlog.error('Failed to establish connection with UI', true);\n\t\t\t\tthrow new Error('Connection failed');\n\t\t\t}\n\n\t\t\tport.onMessage.addListener((message: unknown) => {\n\t\t\t\ttry {\n\t\t\t\t\t// Type guard function to check if message is valid\n\t\t\t\t\tif (isValidMessage(message)) {\n\t\t\t\t\t\thandleMessage(message);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlog.warn('Invalid message format received:', false, message);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tlog.error('Error handling message:', false, error);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tport.onDisconnect.addListener(() => {\n\t\t\t\tif (browserSvelte && browser_ext) {\n\t\t\t\t\tconst error = browser_ext.runtime.lastError;\n\t\t\t\t\tlog.warn('UI connection disconnected', false, { error });\n\n\t\t\t\t\tcleanupConnection();\n\n\t\t\t\t\t// Check if extension is still available before attempting reconnect\n\t\t\t\t\tif (browser_ext && !browser_ext.runtime.lastError) {\n\t\t\t\t\t\tretryConnection().catch((error) => {\n\t\t\t\t\t\t\tlog.error('Failed to initiate reconnection:', true, error);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlog.warn('Extension context invalid, skipping reconnection');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Connection successful, reset retry count\n\t\t\tstate.retryCount = 0;\n\t\t\tstate.isConnecting = false;\n\t\t\tlog.info('UI connection established successfully');\n\t\t\treturn port;\n\t\t}\n\t} catch (error) {\n\t\tlog.error('Failed to initialize UI connection:', true, error);\n\t\tthrow error;\n\t}\n}\n\n// Optional: Add connection status monitoring\nlet connectionMonitorInterval: number;\n\nfunction startConnectionMonitor() {\n\tif (typeof window !== 'undefined') {\n\t\tconnectionMonitorInterval = window.setInterval(() => {\n\t\t\tif (!state.isConnecting && state.retryCount < MAX_RETRIES) {\n\t\t\t\tif (browserSvelte && browser_ext) {\n\t\t\t\t\tbrowser_ext.runtime\n\t\t\t\t\t\t.getPlatformInfo()\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t// Extension is responding, connection might be alive\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\tlog.warn('Connection check failed, initiating reconnect');\n\t\t\t\t\t\t\tinitializeUIConnection().catch((error) => {\n\t\t\t\t\t\t\t\tlog.error('Connection monitor reconnect failed:', false, error);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}, 30000); // Check every 30 seconds\n\t}\n}\n\nfunction stopConnectionMonitor() {\n\tif (connectionMonitorInterval) {\n\t\tclearInterval(connectionMonitorInterval);\n\t\tconnectionMonitorInterval = undefined;\n\t}\n}\n\n// Cleanup function for unmounting\nexport function cleanup() {\n\tcleanupConnection();\n\tstopConnectionMonitor();\n}\n\n// Initialize connection monitoring when the extension starts\nstartConnectionMonitor();\n\n// Do not enable this unless needed and then put a guard around it for browser_ext\n// Optional: Add cleanup logic for extension lifecycle events\n// Handle extension lifecycle events\n// browser_ext.runtime.onSuspend.addListener(() => {\n//   cleanup();\n// });\n\nfunction handleMessage(message: MessageTypes) {\n\ttry {\n\t\tlog.debug('handleMessage:[connectionStore]', false, message);\n\n\t\tswitch (message.type) {\n\t\t\tcase MessageType.ACTIVE_TAB_CHANGED:\n\t\t\t\tif (isTabChangeData(message.data)) {\n\t\t\t\t\thandleActiveTabChange(message.data);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase MessageType.TAB_UPDATED:\n\t\t\t\tif (isTabChangeData(message.data)) {\n\t\t\t\t\thandleTabUpdate(message.data);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase MessageType.TAB_REMOVED:\n\t\t\t\tif (isTabChangeData(message.data)) {\n\t\t\t\t\thandleTabRemove(null);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase MessageType.WINDOW_FOCUSED:\n\t\t\t\tif (isWindowFocusData(message.data)) {\n\t\t\t\t\thandleWindowFocus(message.data);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tlog.info('Unhandled message type. Letting it pass:', false, message.type);\n\t\t}\n\t} catch (error) {\n\t\tthrow error;\n\t}\n}\n\n// Type guard functions\nfunction isValidMessage(message: unknown): message is MessageTypes {\n\treturn (\n\t\ttypeof message === 'object' &&\n\t\tmessage !== null &&\n\t\t'type' in message &&\n\t\t'data' in message &&\n\t\ttypeof (message as MessageTypes).type === 'string'\n\t);\n}\n\nfunction isTabChangeData(data: unknown): data is TabChangeData {\n\treturn (\n\t\ttypeof data === 'object' &&\n\t\tdata !== null &&\n\t\t'tabId' in data &&\n\t\ttypeof (data as TabChangeData).tabId === 'number'\n\t);\n}\n\nfunction isWindowFocusData(data: unknown): data is WindowFocusData {\n\treturn (\n\t\ttypeof data === 'object' &&\n\t\tdata !== null &&\n\t\t'windowId' in data &&\n\t\ttypeof (data as WindowFocusData).windowId === 'number'\n\t);\n}\n\n// Handler functions with proper typing\nfunction handleActiveTabChange(data: TabChangeData) {\n\tlog.debug('handleActiveTabChange:-------------------->>>>>>>>>>', false, data);\n\n\tif (data?.windowType === 'normal') {\n\t\tactiveTabUIStore.set(data);\n\t\tlog.debug('Active tab changed:', false, data);\n\t} else {\n\t\t// log.debug('Active tab did not change (windowType should only be \"normal\"):', false, data);\n\t}\n}\n\nfunction handleTabRemove(data: TabChangeData) {\n\t// We don't need to update the active tab on tab update\n\t// if (data?.windowType === 'normal') {\n\t//   activeTabUIStore.set(data);\n\t//   log.debug('Tab updated:', false, data);\n\t// } else {\n\t// log.debug('Tab did not change (windowType should only be \"normal\"):', false, data);\n\t// }\n}\n\nfunction handleTabUpdate(data: TabChangeData | null) {\n\tactiveTabUIStore.set(data);\n\tlog.debug('Tab removed:', false, data);\n}\n\nasync function handleWindowFocus(data: WindowFocusData) {\n\ttry {\n\t\tif (!(browserSvelte && browser_ext)) return;\n\n\t\tlog.debug('handleWindowFocus:>>>>>>>>>>>>>>>>>>>>>>', false, data);\n\n\t\t// Implement window focus logic if needed\n\t\tif (data?.type === 'normal') {\n\t\t\t// This should set the active tab to the focused window if it is normal and not a popup or other type\n\t\t\tconst activeTab = {\n\t\t\t\ttabId: 0,\n\t\t\t\twindowId: data.windowId,\n\t\t\t\twindowType: data.type,\n\t\t\t\turl: '',\n\t\t\t\ttitle: '',\n\t\t\t\tfavIconUrl: '',\n\t\t\t\tdateTime: new Date().toISOString()\n\t\t\t};\n\t\t\tconst tabs = await browser_ext.tabs.query({ active: true, windowId: data.windowId });\n\t\t\tif (tabs.length > 0) {\n\t\t\t\tactiveTab.tabId = tabs[0].id ?? 0;\n\t\t\t\tactiveTab.url = tabs[0].url ?? '';\n\t\t\t\tactiveTab.title = tabs[0].title ?? '';\n\t\t\t\tactiveTab.favIconUrl = tabs[0].favIconUrl ?? '';\n\n\t\t\t\tif (activeTab.tabId > 0) {\n\t\t\t\t\tactiveTabUIStore.set(activeTab);\n\t\t\t\t\tlog.debug('Window focused changed: [connectionStore]', false, activeTab);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// NOTE: Could add logic to handle different window types...\n\t\t\t// log.debug('Window focus did not change (type should only be \"normal\"):', false, data);\n\t\t}\n\t} catch (error) {\n\t\tlog.error('Error handling window focus:', false, error);\n\t\tthrow error;\n\t}\n}\n","// export const ssr = false;\n\nimport { log } from '$lib/common/logger-wrapper';\nimport { cleanup, initializeUIConnection } from '$lib/common/stores/connectionStore';\nimport { get } from 'svelte/store';\nimport { activeTabUIStore } from '$lib/common/stores';\nimport type { GetActiveTabResponse } from '$lib/common/interfaces';\nimport { isServerSide } from '$lib/common/utils';\nimport { getBrowserExt } from '$lib/browser-polyfill-wrapper';\nimport { getObjectFromLocalStorage } from '$lib/common/storage';\n\nexport async function load() {\n\tif (isServerSide()) {\n\t\tlog.info('+layout.ts is running in SSR, skipping browser_ext usage.');\n\t\treturn {}; // Prevents execution during SSR\n\t}\n\n\ttry {\n\t\tlog.debug('/+layout.ts - Initializing UI connection...');\n\n\t\tawait initializeUIConnection();\n\t\tconst activeTab = get(activeTabUIStore);\n\t\tif (!activeTab) {\n\t\t\tconst ext = getBrowserExt();\n\t\t\tif (ext) {\n\t\t\t\ttry {\n\t\t\t\t\tconst response = (await ext.runtime.sendMessage({\n\t\t\t\t\t\ttype: 'getActiveTab'\n\t\t\t\t\t})) as GetActiveTabResponse;\n\t\t\t\t\tif (response?.activeTab) {\n\t\t\t\t\t\tactiveTabUIStore.set(response.activeTab);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlog.debug(\n\t\t\t\t\t\t\t'No active tab found, getting from local storage:',\n\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\tawait getObjectFromLocalStorage('activeTabBackground')\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tlog.debug('Active tab:', false, activeTab, response, activeTabUIStore);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tlog.error('Failed to initialize UI connection:', false, error);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlog.warn('browser_ext is not available.');\n\t\t\t}\n\t\t}\n\t} catch (error) {\n\t\tlog.error('Failed to initialize UI connection:', false, error);\n\t}\n\n\treturn {\n\t\tdestroy() {\n\t\t\tcleanup();\n\t\t}\n\t};\n}\n","// $lib/shared/BrowserAccessor.ts\nimport type { Runtime, Tabs, Alarms } from 'webextension-polyfill';\nimport { log } from '$lib/managers/Logger';\nimport type { ExtendedBrowser } from '../types/browser-extensions';\nimport { browser_ext } from '../environment';\n\n// Interfaces for local use (to avoid namespace issues)\ninterface ChromeRuntimeConnectInfo {\n\tname?: string;\n}\n// Chrome types are now imported automatically from the .d.ts file\n\n/**\n * Describes the execution context of the extension\n */\nexport enum ExtensionContext {\n\tUNKNOWN = 'unknown',\n\tBACKGROUND = 'background',\n\tPOPUP = 'popup',\n\tCONTENT_SCRIPT = 'content_script',\n\tOPTIONS = 'options',\n\tDEVTOOLS = 'devtools',\n\tSIDEPANEL = 'sidepanel'\n}\n\n/**\n * A robust utility class for accessing browser extension APIs\n * across different contexts (background, popup, etc.)\n */\nexport class BrowserAccessor {\n\tprivate static instance: BrowserAccessor;\n\tprivate browserApi: ExtendedBrowser | null = null;\n\tprivate currentContext: ExtensionContext = ExtensionContext.UNKNOWN;\n\tprivate initialized = false;\n\tprivate initPromise: Promise<ExtendedBrowser | null> | null = null;\n\t/**\n\t * Private constructor - use getInstance()\n\t */\n\tprivate constructor() {\n\t\t// Intentionally empty - initialization happens on demand\n\t}\n\n\t/**\n\t * Get the singleton instance\n\t */\n\tpublic static getInstance(): BrowserAccessor {\n\t\tif (!BrowserAccessor.instance) {\n\t\t\tBrowserAccessor.instance = new BrowserAccessor();\n\t\t}\n\t\treturn BrowserAccessor.instance;\n\t}\n\n\t/**\n\t * Check if we're in a service worker context\n\t */\n\tprivate isInServiceWorker(): boolean {\n\t\ttry {\n\t\t\t// Check if the ServiceWorkerGlobalScope exists\n\t\t\treturn (\n\t\t\t\ttypeof self !== 'undefined' &&\n\t\t\t\ttypeof (self as any).ServiceWorkerGlobalScope !== 'undefined' &&\n\t\t\t\tself instanceof (self as any).ServiceWorkerGlobalScope\n\t\t\t);\n\t\t} catch (error) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Check if Chrome APIs are available\n\t */\n\tprivate hasChromeApis(): boolean {\n\t\treturn typeof chrome !== 'undefined' && !!chrome && !!chrome.runtime;\n\t}\n\n\t/**\n\t * Detect which extension context we're running in\n\t */\n\tprivate async detectContext(): Promise<ExtensionContext> {\n\t\t// Skip if not in a browser\n\t\tif (typeof window === 'undefined' && typeof self === 'undefined') {\n\t\t\treturn ExtensionContext.UNKNOWN;\n\t\t}\n\n\t\ttry {\n\t\t\t// Check for background context - service worker\n\t\t\tconst isServiceWorker = this.isInServiceWorker();\n\n\t\t\t// Check for extension APIs\n\t\t\tconst hasExtensionApi = this.hasChromeApis();\n\n\t\t\t// For UI contexts we need to check window\n\t\t\tconst isWindow = typeof window !== 'undefined';\n\n\t\t\t// Check specific UI contexts if window exists\n\t\t\tconst isPopup =\n\t\t\t\tisWindow &&\n\t\t\t\t(window.location.pathname.includes('popup.html') ||\n\t\t\t\t\tdocument.body?.dataset.context === 'popup');\n\n\t\t\tconst isOptions =\n\t\t\t\tisWindow &&\n\t\t\t\t(window.location.pathname.includes('options.html') ||\n\t\t\t\t\tdocument.body?.dataset.context === 'options');\n\n\t\t\tconst hasDevtools =\n\t\t\t\ttypeof chrome !== 'undefined' && typeof (chrome as any).devtools !== 'undefined';\n\n\t\t\t// Content scripts run in web pages\n\t\t\tconst isContentScript =\n\t\t\t\tisWindow && hasExtensionApi && window.location.protocol.startsWith('http');\n\n\t\t\tif ((await this.resolveExecutionContext()) === 'sidepanel') {\n\t\t\t\treturn ExtensionContext.SIDEPANEL;\n\t\t\t}\n\n\t\t\tif (isServiceWorker && hasExtensionApi) {\n\t\t\t\treturn ExtensionContext.BACKGROUND;\n\t\t\t} else if (isPopup) {\n\t\t\t\treturn ExtensionContext.POPUP;\n\t\t\t} else if (isOptions) {\n\t\t\t\treturn ExtensionContext.OPTIONS;\n\t\t\t} else if (hasDevtools) {\n\t\t\t\treturn ExtensionContext.DEVTOOLS;\n\t\t\t} else if (isContentScript) {\n\t\t\t\treturn ExtensionContext.CONTENT_SCRIPT;\n\t\t\t} else if (hasExtensionApi) {\n\t\t\t\t// If we can't specifically identify, but have extension APIs\n\t\t\t\treturn ExtensionContext.POPUP; // Default to popup for UI contexts\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tlog.error('Error detecting context:', false, error);\n\t\t}\n\n\t\treturn ExtensionContext.UNKNOWN;\n\t}\n\n\tasync resolveExecutionContext(): Promise<'popup' | 'sidepanel'> {\n\t\ttry {\n\t\t\tconst win = await browser_ext.windows.getCurrent();\n\t\t\tif (!win || !win.type) {\n\t\t\t\treturn import.meta.env.VITE_YAKKL_TYPE;\n\t\t\t}\n\n\t\t\tif (win.type === 'popup') return 'popup';\n\t\t\tif (win.type === 'normal') return 'sidepanel';\n\n\t\t\treturn import.meta.env.VITE_YAKKL_TYPE;\n\t\t} catch (err) {\n\t\t\tconsole.warn('Error resolving execution context:', err);\n\t\t\treturn import.meta.env.VITE_YAKKL_TYPE;\n\t\t}\n\t}\n\n\t/**\n\t * Initialize the browser API - respects the context it's running in\n\t * Returns a promise that resolves to the browser API or null\n\t */\n\tpublic async initialize(): Promise<ExtendedBrowser | null> {\n\t\t// Return existing result if already initialized\n\t\tif (this.initialized) {\n\t\t\treturn this.browserApi;\n\t\t}\n\n\t\t// Return existing promise if already initializing\n\t\tif (this.initPromise) {\n\t\t\treturn this.initPromise;\n\t\t}\n\n\t\t// Skip if not in a browser\n\t\tif (typeof window === 'undefined' && typeof self === 'undefined') {\n\t\t\tthis.initialized = true;\n\t\t\treturn null;\n\t\t}\n\n\t\t// Create a single initialization promise\n\t\tthis.initPromise = (async () => {\n\t\t\ttry {\n\t\t\t\t// Detect which context we're in\n\t\t\t\tthis.currentContext = await this.detectContext();\n\t\t\t\tlog.info(`Initializing browser API in ${this.currentContext} context`);\n\n\t\t\t\t// Try to get browser API based on context\n\t\t\t\tif (this.currentContext !== ExtensionContext.UNKNOWN) {\n\t\t\t\t\t// First try global browser (from script tag)\n\t\t\t\t\tif (typeof window !== 'undefined' && (window as any).browser) {\n\t\t\t\t\t\tthis.browserApi = (window as any).browser as ExtendedBrowser;\n\t\t\t\t\t\tlog.info('Using global browser API from window.browser');\n\t\t\t\t\t}\n\t\t\t\t\t// Then try chrome namespace with polyfill\n\t\t\t\t\telse if (this.hasChromeApis()) {\n\t\t\t\t\t\t// In background context, we need to be careful with the polyfill\n\t\t\t\t\t\tif (this.currentContext === ExtensionContext.BACKGROUND) {\n\t\t\t\t\t\t\t// In background context, we can directly import\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tlog.info('Loaded browser API via dynamic import in background');\n\t\t\t\t\t\t\t\tconst polyfill = await import('webextension-polyfill');\n\t\t\t\t\t\t\t\tthis.browserApi = polyfill.default as ExtendedBrowser;\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\tlog.error('Failed to import polyfill in background:', false, e);\n\t\t\t\t\t\t\t\t// Fallback to chrome APIs if needed\n\t\t\t\t\t\t\t\tthis.browserApi = this.createChromeShim();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// For UI contexts, use the global or chrome\n\t\t\t\t\t\t\tthis.browserApi = (window as any).browser || this.createChromeShim();\n\t\t\t\t\t\t\tlog.info('Using global browser API or chrome shim');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!this.browserApi) {\n\t\t\t\t\tlog.warn(`No browser API available in ${this.currentContext} context`);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tlog.error('Failed to initialize browser API:', false, error);\n\t\t\t\tthis.browserApi = null;\n\t\t\t} finally {\n\t\t\t\tthis.initialized = true;\n\t\t\t\tthis.initPromise = null;\n\t\t\t}\n\n\t\t\treturn this.browserApi;\n\t\t})();\n\n\t\treturn this.initPromise;\n\t}\n\n\t/**\n\t * Get the browser API instance with lazy initialization\n\t */\n\tpublic async getBrowser(): Promise<ExtendedBrowser | null> {\n\t\tif (!this.initialized && !this.initPromise) {\n\t\t\tawait this.initialize();\n\t\t}\n\t\treturn this.browserApi;\n\t}\n\n\t/**\n\t * Get the browser API synchronously - may return null if not initialized\n\t * Consider using getBrowser() for more reliable access\n\t */\n\tpublic getBrowserSync(): ExtendedBrowser | null {\n\t\tif (!this.initialized && !this.initPromise) {\n\t\t\t// Start initialization but don't wait for it\n\t\t\tthis.initialize().catch((e) => {\n\t\t\t\tlog.error('Async initialization failed:', false, e);\n\t\t\t});\n\t\t}\n\t\treturn this.browserApi;\n\t}\n\n\t/**\n\t * Get the current extension context\n\t */\n\tpublic async getContext(): Promise<ExtensionContext> {\n\t\tif (this.currentContext === ExtensionContext.UNKNOWN) {\n\t\t\tthis.currentContext = await this.detectContext();\n\t\t}\n\t\treturn this.currentContext;\n\t}\n\n\t/**\n\t * Set the browser API explicitly (useful for testing or special contexts)\n\t */\n\tpublic setBrowser(browser: ExtendedBrowser): void {\n\t\tthis.browserApi = browser;\n\t\tthis.initialized = true;\n\t}\n\n\t/**\n\t * Check if a specific Chrome API is available\n\t */\n\tpublic hasChromeApi(apiName: string): boolean {\n\t\tif (!this.hasChromeApis()) return false;\n\n\t\tswitch (apiName) {\n\t\t\tcase 'sidePanel':\n\t\t\t\treturn typeof (chrome as any).sidePanel !== 'undefined';\n\t\t\tcase 'tabs':\n\t\t\t\treturn typeof (chrome as any).tabs !== 'undefined';\n\t\t\tcase 'alarms':\n\t\t\t\treturn typeof (chrome as any).alarms !== 'undefined';\n\t\t\tcase 'idle':\n\t\t\t\treturn typeof (chrome as any).idle !== 'undefined';\n\t\t\tcase 'notifications':\n\t\t\t\treturn typeof (chrome as any).notifications !== 'undefined';\n\t\t\tdefault:\n\t\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Perform a browser API operation safely with proper typing\n\t */\n\tpublic async performOperation<T>(\n\t\toperation: (browser: ExtendedBrowser) => Promise<T> | T,\n\t\tfallback: T\n\t): Promise<T> {\n\t\tconst browser = await this.getBrowser();\n\n\t\tif (!browser) {\n\t\t\treturn fallback;\n\t\t}\n\n\t\ttry {\n\t\t\treturn await operation(browser);\n\t\t} catch (error) {\n\t\t\tlog.error('Browser operation failed:', false, error);\n\t\t\treturn fallback;\n\t\t}\n\t}\n\n\t/**\n\t * Create a chrome API shim that mimics the browser API\n\t * This is a fallback when the polyfill isn't available\n\t */\n\tprivate createChromeShim(): ExtendedBrowser {\n\t\tif (!this.hasChromeApis()) {\n\t\t\tlog.warn('Chrome APIs not available for creating shim');\n\t\t\treturn {} as ExtendedBrowser;\n\t\t}\n\n\t\t// Create an empty object to serve as our browser implementation\n\t\tconst browser = {} as any;\n\n\t\t// Add runtime API if available\n\t\tif (chrome?.runtime) {\n\t\t\tbrowser.runtime = {\n\t\t\t\tsendMessage: (message: any): Promise<any> => {\n\t\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\tchrome.runtime.sendMessage(message, (response: any) => {\n\t\t\t\t\t\t\tif (chrome.runtime.lastError) {\n\t\t\t\t\t\t\t\treject(chrome.runtime.lastError);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tconnect: (connectInfo?: any): Runtime.Port => {\n\t\t\t\t\tconst port = chrome.runtime.connect(connectInfo as any);\n\t\t\t\t\treturn port as unknown as Runtime.Port;\n\t\t\t\t}\n\t\t\t\t// Add other runtime methods as needed\n\t\t\t};\n\n\t\t\t// Add event listeners\n\t\t\t// if (chrome.runtime.onMessage) {\n\t\t\t//   browser.runtime.onMessage = {\n\t\t\t//     addListener: chrome.runtime.onMessage.addListener.bind(chrome.runtime.onMessage),\n\t\t\t//     removeListener: chrome.runtime.onMessage.removeListener.bind(chrome.runtime.onMessage),\n\t\t\t//     hasListener: chrome.runtime.onMessage.hasListener.bind(chrome.runtime.onMessage)\n\t\t\t//   };\n\t\t\t// }\n\t\t}\n\n\t\t// Add storage API if available\n\t\tif (chrome?.storage) {\n\t\t\tbrowser.storage = {\n\t\t\t\tlocal: {\n\t\t\t\t\tget: (\n\t\t\t\t\t\tkeys: string | string[] | Record<string, any> | null\n\t\t\t\t\t): Promise<Record<string, any>> => {\n\t\t\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\t\tchrome.storage.local.get(keys as any, (result: { [key: string]: any }) => {\n\t\t\t\t\t\t\t\tif (chrome.runtime.lastError) {\n\t\t\t\t\t\t\t\t\treject(chrome.runtime.lastError);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tset: (items: Record<string, any>): Promise<void> => {\n\t\t\t\t\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\t\t\t\t\tchrome.storage.local.set(items, () => {\n\t\t\t\t\t\t\t\tif (chrome.runtime.lastError) {\n\t\t\t\t\t\t\t\t\treject(chrome.runtime.lastError);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tremove: (keys: string | string[]): Promise<void> => {\n\t\t\t\t\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\t\t\t\t\tchrome.storage.local.remove(keys, () => {\n\t\t\t\t\t\t\t\tif (chrome.runtime.lastError) {\n\t\t\t\t\t\t\t\t\treject(chrome.runtime.lastError);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tclear: (): Promise<void> => {\n\t\t\t\t\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\t\t\t\t\tchrome.storage.local.clear(() => {\n\t\t\t\t\t\t\t\tif (chrome.runtime.lastError) {\n\t\t\t\t\t\t\t\t\treject(chrome.runtime.lastError);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\t// Add sidePanel API if available\n\t\tif (chrome?.sidePanel) {\n\t\t\tbrowser.sidePanel = {\n\t\t\t\tsetPanelBehavior: (options: { openPanelOnActionClick: boolean }): Promise<void> => {\n\t\t\t\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tchrome.sidePanel.setPanelBehavior(options);\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\topen: (options: { tabId: number }): Promise<void> => {\n\t\t\t\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tchrome.sidePanel.open(options);\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\t// Add tabs API if available\n\t\tif (chrome?.tabs) {\n\t\t\t// Create a minimal tabs implementation with the methods you actually use\n\t\t\tconst tabsImpl: Partial<Tabs.Static> = {\n\t\t\t\tquery: (queryInfo: any): Promise<Tabs.Tab[]> => {\n\t\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\tchrome.tabs.query(queryInfo, (tabs) => {\n\t\t\t\t\t\t\tif (chrome.runtime.lastError) {\n\t\t\t\t\t\t\t\treject(chrome.runtime.lastError);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresolve(tabs as unknown as Tabs.Tab[]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tget: (tabId: number): Promise<Tabs.Tab> => {\n\t\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\tchrome.tabs.get(tabId, (tab) => {\n\t\t\t\t\t\t\tif (chrome.runtime.lastError) {\n\t\t\t\t\t\t\t\treject(chrome.runtime.lastError);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresolve(tab as unknown as Tabs.Tab);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tgetCurrent: (): Promise<Tabs.Tab | undefined> => {\n\t\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\tchrome.tabs.getCurrent((tab) => {\n\t\t\t\t\t\t\tif (chrome.runtime.lastError) {\n\t\t\t\t\t\t\t\treject(chrome.runtime.lastError);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresolve(tab as unknown as Tabs.Tab);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t// Add only the methods you actually use\n\t\t\t};\n\n\t\t\t// Add the implementation to the browser object\n\t\t\tbrowser.tabs = tabsImpl;\n\t\t}\n\n\t\t// Add alarms API if available\n\t\tif (chrome?.alarms) {\n\t\t\t// Create a minimal alarms implementation with the methods you actually use\n\t\t\tconst alarmsImpl: Partial<Alarms.Static> = {\n\t\t\t\t// Fix the create method to match both overloads\n\t\t\t\tcreate: function (\n\t\t\t\t\tnameOrInfo: string | Alarms.CreateAlarmInfoType,\n\t\t\t\t\tmaybeInfo?: Alarms.CreateAlarmInfoType\n\t\t\t\t): void {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (typeof nameOrInfo === 'string') {\n\t\t\t\t\t\t\t// First overload: create(name, alarmInfo)\n\t\t\t\t\t\t\tif (maybeInfo) {\n\t\t\t\t\t\t\t\tchrome.alarms.create(nameOrInfo, maybeInfo as any);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Chrome requires alarmInfo, even if empty\n\t\t\t\t\t\t\t\tchrome.alarms.create(nameOrInfo, {});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Second overload: create(alarmInfo)\n\t\t\t\t\t\t\t// Chrome requires name parameter, use empty string as default\n\t\t\t\t\t\t\tchrome.alarms.create('', nameOrInfo as any);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tlog.error('Error creating alarm:', false, error);\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tclear: (name?: string): Promise<boolean> => {\n\t\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\tchrome.alarms.clear(name, (wasCleared) => {\n\t\t\t\t\t\t\tif (chrome.runtime.lastError) {\n\t\t\t\t\t\t\t\treject(chrome.runtime.lastError);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresolve(wasCleared);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t},\n\n\t\t\t\tclearAll: (): Promise<boolean> => {\n\t\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\tchrome.alarms.clearAll((wasCleared) => {\n\t\t\t\t\t\t\tif (chrome.runtime.lastError) {\n\t\t\t\t\t\t\t\treject(chrome.runtime.lastError);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresolve(wasCleared);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t// Add only the methods you actually use\n\t\t\t};\n\n\t\t\t// Get alarm by name\n\t\t\tget: (name?: string): Promise<Alarms.Alarm | undefined> => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tif (!chrome?.alarms) {\n\t\t\t\t\t\treject(new Error('Chrome alarms API not available'));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tchrome.alarms.get(name, (alarm) => {\n\t\t\t\t\t\tif (chrome.runtime.lastError) {\n\t\t\t\t\t\t\treject(chrome.runtime.lastError);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresolve(alarm as unknown as Alarms.Alarm);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t// Get all alarms\n\t\t\tgetAll: (): Promise<Alarms.Alarm[]> => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tif (!chrome?.alarms) {\n\t\t\t\t\t\treject(new Error('Chrome alarms API not available'));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tchrome.alarms.getAll((alarms) => {\n\t\t\t\t\t\tif (chrome.runtime.lastError) {\n\t\t\t\t\t\t\treject(chrome.runtime.lastError);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresolve(alarms as unknown as Alarms.Alarm[]);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t// Create a stub for onAlarm if needed\n\t\t\tif (chrome.alarms.onAlarm) {\n\t\t\t\talarmsImpl.onAlarm = {\n\t\t\t\t\taddListener: (listener: (alarm: Alarms.Alarm) => void) => {\n\t\t\t\t\t\tchrome.alarms.onAlarm.addListener(listener as any);\n\t\t\t\t\t},\n\t\t\t\t\tremoveListener: (listener: (alarm: Alarms.Alarm) => void) => {\n\t\t\t\t\t\tchrome.alarms.onAlarm.removeListener(listener as any);\n\t\t\t\t\t},\n\t\t\t\t\thasListener: (listener: (alarm: Alarms.Alarm) => void) => {\n\t\t\t\t\t\treturn chrome.alarms.onAlarm.hasListener(listener as any);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Add the implementation to the browser object\n\t\t\tbrowser.alarms = alarmsImpl as Alarms.Static;\n\t\t}\n\n\t\t// Add other APIs as needed using the same pattern\n\n\t\tconst browser_ext = browser as ExtendedBrowser;\n\n\t\treturn browser_ext;\n\t}\n}\n","<script lang=\"ts\">\n\timport { log } from '$lib/managers/Logger';\n\timport { handleOpenInTab } from '$lib/utilities';\n\timport { Popover } from 'flowbite-svelte';\n\n\tinterface Props {\n\t\t[key: string]: any;\n\t}\n\n\tlet { ...rest }: Props = $props();\n\n\tasync function handleShare(event: MouseEvent): Promise<void> {\n\t\tevent.preventDefault(); // Modern way to prevent default\n\n\t\tconst target = event.currentTarget as HTMLElement;\n\t\tconst id = target?.dataset?.id;\n\n\t\tif (!id) {\n\t\t\tlog.error('No ID found');\n\t\t\treturn;\n\t\t}\n\n\t\tlet message: string;\n\t\tlet url: string = '';\n\n\t\tif (id === 'twitter') {\n\t\t\tmessage =\n\t\t\t\t'Spreading the love! @yakklcrypto YAKKL Smart Wallet is awesome! Their website is: https://yakkl.com and you can download the Smart Wallet at the Chrome Browser Extension store: ';\n\t\t\turl = encodeURI(\n\t\t\t\t`https://twitter.com/intent/tweet?hashtags=crypto,yakkl,bitcoin,ethereum&via=yakklcrypto&original_referer=https://yakkl.com&ref_src=YAKKL&url=https://chrome.google.com/webstore/detail/dpmfhilhjlhhakpbieclcghochdofeao/&text=${message}`\n\t\t\t);\n\t\t} else if (id === 'linkedin') {\n\t\t\tmessage =\n\t\t\t\t\"Can't wait to share the love of YAKKL Smart Wallet! Download the best Crypto Smart Wallet at (Google Chrome Store) https://chrome.google.com/webstore/detail/dpmfhilhjlhhakpbieclcghochdofeao/. The website is: https://yakkl.com.\";\n\t\t\turl = encodeURI(\n\t\t\t\t`https://www.linkedin.com/sharing/share-offsite?url=https://yakkl.com/?utm_source=linkedin&utm_medium=share&title=${message}`\n\t\t\t);\n\t\t}\n\n\t\tif (url) {\n\t\t\thandleOpenInTab(url);\n\t\t}\n\t}\n</script>\n\n<Popover\n\ttriggeredBy=\"#share\"\n\tplacement=\"bottom-start\"\n\tclass=\"w-[200px] text-sm font-normal text-gray-900 bg-white dark:text-gray-400 dark:border-gray-600 dark:bg-gray-800 z-100\"\n>\n\t<div class=\"p-1 block\">\n\t\t<div class=\"flex text-center justify-center m-2 ml-0 w-full\">\n\t\t\t<svg\n\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\tclass=\"w-6 h-6 fill-red-700 animate-pulse\"\n\t\t\t>\n\t\t\t\t<path\n\t\t\t\t\td=\"M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007.004-.003.001a.752.752 0 01-.704 0l-.003-.001z\"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t\t<p class=\"ml-1 text-sm font-bold text-center text-purple-600\">SHARE THE LOVE!</p>\n\t\t</div>\n\n\t\t<!-- Social Media Buttons -->\n\t\t<button\n\t\t\tid=\"twitter\"\n\t\t\tdata-id=\"twitter\"\n\t\t\tonclick={handleShare}\n\t\t\tclass=\"flex flex-row rounded-md ml-6 text-base font-semibold text-gray-900 dark:text-wwhite hover:bg-gray-200 w-full text-left\"\n\t\t>\n\t\t\t<svg\n\t\t\t\tviewBox=\"0 0 1200 1227\"\n\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\tclass=\"flex flex-col w-5 h-5 mt-[.1rem] mr-1 bg-black\"\n\t\t\t>\n\t\t\t\t<path\n\t\t\t\t\td=\"M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z\"\n\t\t\t\t\tfill=\"white\"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t\t<span\n\t\t\t\tclass=\"ml-3 flex flex-col text-base font-semibold text-gray-900 dark:text-base-content hover:text-slate-600 dark:hover:text-gray-900\"\n\t\t\t\t>X (twitter)</span\n\t\t\t>\n\t\t</button>\n\n\t\t<button\n\t\t\tid=\"linkedin\"\n\t\t\tdata-id=\"linkedin\"\n\t\t\tonclick={handleShare}\n\t\t\tclass=\"my-1 flex flex-row rounded-md ml-6 text-base font-semibold text-gray-900 dark:text-white hover:bg-gray-200 w-full text-left\"\n\t\t>\n\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" class=\"flex flex-col w-6 h-6\">\n\t\t\t\t<path\n\t\t\t\t\td=\"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z\"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t\t<span\n\t\t\t\tclass=\"ml-3 flex flex-col text-base font-semibold text-gray-900 dark:text-base-content hover:text-slate-600 dark:hover:text-gray-900\"\n\t\t\t\t>LinkedIn</span\n\t\t\t>\n\t\t</button>\n\t</div>\n</Popover>\n\n<!-- Share Button -->\n<!-- svelte-ignore a11y_consider_explicit_label -->\n<button\n\tid=\"share\"\n\tonclick={handleShare}\n\t{...rest}\n\tclass=\"bg-transparent border-none p-0 cursor-pointer\"\n>\n\t<svg\n\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\tviewBox=\"0 0 24 24\"\n\t\tfill=\"currentColor\"\n\t\tclass=\"w-7 h-7 fill-gray-100 hover:fill-gray-400\"\n\t>\n\t\t<path\n\t\t\tfill-rule=\"evenodd\"\n\t\t\td=\"M15.75 4.5a3 3 0 11.825 2.066l-8.421 4.679a3.002 3.002 0 010 1.51l8.421 4.679a3 3 0 11-.729 1.31l-8.421-4.678a3 3 0 110-4.132l8.421-4.679a3 3 0 01-.096-.755z\"\n\t\t\tclip-rule=\"evenodd\"\n\t\t/>\n\t</svg>\n\t<!-- <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\" stroke=\"currentColor\" class=\"w-7 h-7 fill-gray-100 hover:fill-gray-400\">\n    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5\" />\n  </svg> -->\n</button>\n","// src/lib/stores/ui.ts\nimport { writable } from 'svelte/store';\n\nexport const showEmergencyKit = writable(false);\nexport const showEmergencyKitExport = writable(false);\nexport const showEmergencyKitImport = writable(false);\n\nexport const showProfileSettingsModal = writable(false);\n","<script lang=\"ts\">\n\timport { goto } from '$app/navigation';\n\timport { PATH_LOGOUT } from '$lib/common';\n\timport {\n\t\tshowEmergencyKit,\n\t\tshowEmergencyKitExport,\n\t\tshowEmergencyKitImport\n\t} from '$lib/common/stores/ui';\n\timport { onMount, onDestroy } from 'svelte';\n\timport { getSettings } from '$lib/common/stores';\n\timport { shouldShowProFeatures } from '$lib/common/token-analytics';\n\timport { PlanType } from '$lib/common/types';\n\timport type { Settings } from '$lib/common/interfaces';\n\timport SimpleTooltip from './SimpleTooltip.svelte';\n\n\tlet settings: Settings | null = $state(null);\n\tlet isProUser = $state(false);\n\tlet offcanvasElement: HTMLElement;\n\tlet isHoveringMenu = $state(false);\n\tlet hoverTimeout: number | null = null;\n\n\tonMount(async () => {\n\t\tsettings = await getSettings();\n\t\tisProUser = shouldShowProFeatures(settings?.plan?.type || PlanType.BASIC_MEMBER);\n\t\t\n\t\t// Add click outside listener (browser only)\n\t\tif (typeof window !== 'undefined') {\n\t\t\tsetupClickOutsideListener();\n\t\t}\n\t});\n\n\tonDestroy(() => {\n\t\t// Cleanup event listeners (browser only)\n\t\tif (typeof window !== 'undefined' && typeof document !== 'undefined') {\n\t\t\tdocument.removeEventListener('click', handleClickOutside);\n\t\t}\n\t\t// Cleanup hover timeout\n\t\tif (hoverTimeout) {\n\t\t\tclearTimeout(hoverTimeout);\n\t\t}\n\t});\n\n\tfunction setupClickOutsideListener() {\n\t\tif (typeof document !== 'undefined') {\n\t\t\tdocument.addEventListener('click', handleClickOutside);\n\t\t}\n\t}\n\n\tfunction handleClickOutside(event: MouseEvent) {\n\t\tif (!offcanvasElement) return;\n\t\t\n\t\tconst target = event.target as HTMLElement;\n\t\tconst isOffcanvasVisible = offcanvasElement.classList.contains('show');\n\t\t\n\t\t// Check if click is outside the offcanvas and not on a trigger button\n\t\tconst isClickOutside = !offcanvasElement.contains(target);\n\t\tconst isNotTrigger = !target.closest('[data-bs-toggle=\"offcanvas\"][data-bs-target=\"#offcanvasMainMenu\"]');\n\t\t\n\t\tif (isOffcanvasVisible && isClickOutside && isNotTrigger) {\n\t\t\tcloseOffcanvas();\n\t\t}\n\t}\n\n\tfunction closeOffcanvas() {\n\t\tif (typeof window !== 'undefined' && window.bootstrap) {\n\t\t\tconst offcanvasInstance = window.bootstrap.Offcanvas.getInstance(offcanvasElement);\n\t\t\tif (offcanvasInstance) {\n\t\t\t\toffcanvasInstance.hide();\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction handleMenuMouseEnter() {\n\t\tisHoveringMenu = true;\n\t\tif (hoverTimeout) {\n\t\t\tclearTimeout(hoverTimeout);\n\t\t\thoverTimeout = null;\n\t\t}\n\t}\n\n\tfunction handleMenuMouseLeave() {\n\t\tisHoveringMenu = false;\n\t\t// Start timeout to close menu when mouse leaves\n\t\thoverTimeout = setTimeout(() => {\n\t\t\tcloseOffcanvas();\n\t\t}, 500) as unknown as number; // 500ms delay when leaving menu\n\t}\n\n\tfunction handleLogout() {\n\t\tgoto(PATH_LOGOUT);\n\t}\n\n\tfunction openExportKit() {\n\t\tif (!isProUser) return;\n\t\tshowEmergencyKitExport.set(true);\n\t\tshowEmergencyKitImport.set(false);\n\t\tshowEmergencyKit.set(true);\n\t}\n\n\tfunction openImportKit() {\n\t\tif (!isProUser) return;\n\t\tshowEmergencyKitExport.set(false);\n\t\tshowEmergencyKitImport.set(true);\n\t\tshowEmergencyKit.set(true);\n\t}\n</script>\n\n<div\n\tbind:this={offcanvasElement}\n\tclass=\"z-100 offcanvas offcanvas-start top-0 left-0 fixed bottom-auto flex flex-col min-w-[200px] max-w-[280px] font-sans antialiased invisible bg-clip-padding shadow-sm outline-none transition duration-300 ease-in-out border-none rounded-r-md bg-primary text-base-content\"\n\ttabindex=\"-1\"\n\tid=\"offcanvasMainMenu\"\n\taria-labelledby=\"offcanvasMainMenuLabel\"\n\trole=\"dialog\"\n\taria-modal=\"true\"\n\tonmouseenter={handleMenuMouseEnter}\n\tonmouseleave={handleMenuMouseLeave}\n>\n\t<!-- Header -->\n\t<div class=\"offcanvas-header flex items-center justify-between px-4 pt-2 pb-2 bg-primary-200\">\n\t\t<h5 class=\"offcanvas-title font-semibold\" id=\"offcanvasMainMenuLabel\">Menu</h5>\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tclass=\"text-base-content opacity-60 hover:opacity-100\"\n\t\t\tdata-bs-dismiss=\"offcanvas\"\n\t\t\taria-label=\"Close\"\n\t\t>\n\t\t\t<svg\n\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\tclass=\"w-5 h-5\"\n\t\t\t\tfill=\"none\"\n\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\tstroke=\"currentColor\"\n\t\t\t\tstroke-width=\"2\"\n\t\t\t>\n\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6 18L18 6M6 6l12 12\" />\n\t\t\t</svg>\n\t\t</button>\n\t</div>\n\n\t<hr class=\"my-1 border-base-content/20\" />\n\n\t<!-- Menu Items -->\n\t<ul class=\"px-2 space-y-1\">\n\t\t<li data-bs-dismiss={isProUser ? \"offcanvas\" : \"\"}>\n\t\t\t{#if isProUser}\n\t\t\t\t<button\n\t\t\t\t\tonclick={openExportKit}\n\t\t\t\t\tclass=\"w-full text-left px-4 py-2 rounded-md text-sm hover:bg-primary-100 transition flex items-center gap-2\"\n\t\t\t\t>\n\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t<path d=\"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t\tExport Emergency Kit\n\t\t\t\t</button>\n\t\t\t{:else}\n\t\t\t\t<SimpleTooltip content=\"Upgrade to Pro for full Emergency Kit features\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tdisabled\n\t\t\t\t\t\tclass=\"w-full text-left px-4 py-2 rounded-md text-sm text-gray-400 cursor-not-allowed flex items-center gap-2\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\tExport Emergency Kit\n\t\t\t\t\t\t<div class=\"w-3 h-3 bg-gradient-to-r from-indigo-400 to-purple-400 rounded-full flex items-center justify-center ml-auto\">\n\t\t\t\t\t\t\t<svg class=\"w-2 h-2 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n\t\t\t\t\t\t\t\t<path fill-rule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clip-rule=\"evenodd\" />\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\t\t\t\t</SimpleTooltip>\n\t\t\t{/if}\n\t\t</li>\n\t\t<li data-bs-dismiss={isProUser ? \"offcanvas\" : \"\"}>\n\t\t\t{#if isProUser}\n\t\t\t\t<button\n\t\t\t\t\tonclick={openImportKit}\n\t\t\t\t\tclass=\"w-full text-left px-4 py-2 rounded-md text-sm hover:bg-primary-100 transition flex items-center gap-2\"\n\t\t\t\t>\n\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t<path d=\"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t\tImport Emergency Kit\n\t\t\t\t</button>\n\t\t\t{:else}\n\t\t\t\t<SimpleTooltip content=\"Upgrade to Pro for full Emergency Kit features\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tdisabled\n\t\t\t\t\t\tclass=\"w-full text-left px-4 py-2 rounded-md text-sm text-gray-400 cursor-not-allowed flex items-center gap-2\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\tImport Emergency Kit\n\t\t\t\t\t\t<div class=\"w-3 h-3 bg-gradient-to-r from-indigo-400 to-purple-400 rounded-full flex items-center justify-center ml-auto\">\n\t\t\t\t\t\t\t<svg class=\"w-2 h-2 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n\t\t\t\t\t\t\t\t<path fill-rule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clip-rule=\"evenodd\" />\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\t\t\t\t</SimpleTooltip>\n\t\t\t{/if}\n\t\t</li>\n\t\t<li data-bs-dismiss=\"offcanvas\">\n\t\t\t<a\n\t\t\t\thref=\"https://yakkl.com/university/support?utm_source=yakkl&utm_medium=extension&utm_campaign=extension&utm_content=menu&utm_term=help\"\n\t\t\t\tclass=\"block px-4 py-2 rounded-md text-sm hover:bg-primary-100 transition\"\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\trel=\"noreferrer\"\n\t\t\t>\n\t\t\t\t Help Center\n\t\t\t</a>\n\t\t</li>\n\t\t<li data-bs-dismiss=\"offcanvas\">\n\t\t\t<button\n\t\t\t\tonclick={handleLogout}\n\t\t\t\tclass=\"w-full text-left px-4 py-2 rounded-md text-sm text-red-600 hover:text-red-800 hover:bg-primary-100 transition\"\n\t\t\t>\n\t\t\t\t Lock & Logout\n\t\t\t</button>\n\t\t</li>\n\t\t<li data-bs-dismiss=\"offcanvas\">\n\t\t\t<button\n\t\t\t\tonclick={handleLogout}\n\t\t\t\tclass=\"w-full text-left px-4 py-2 rounded-md text-sm hover:bg-primary-100 transition\"\n\t\t\t>\n\t\t\t\t Exit YAKKL\n\t\t\t</button>\n\t\t</li>\n\t</ul>\n\n\t<hr class=\"my-1 border-base-content/20\" />\n\n\t<div class=\"text-center py-2 bg-primary\">\n\t\t<a\n\t\t\tclass=\"text-sm font-semibold text-base-content hover:underline\"\n\t\t\thref=\"https://yakkl.com/?utm_source=yakkl&utm_medium=extension&utm_campaign=extension&utm_content=menu&utm_term=extension\"\n\t\t\ttarget=\"_blank\"\n\t\t\trel=\"noreferrer\"\n\t\t>\n\t\t\tyakkl.com\n\t\t</a>\n\t</div>\n</div>\n","<script lang=\"ts\">\n\timport { handleOpenInTab } from '$lib/utilities';\n\n\tfunction handleUniversity() {\n\t\thandleOpenInTab(\n\t\t\t'https://yakkl.com/university/support?utm_source=yakkl&utm_medium=extension&utm_campaign=extension&utm_content=university&utm_term=extension'\n\t\t);\n\t}\n</script>\n\n<button\n\tclass=\"flex items-center justify-center w-10 h-10 rounded-full backdrop-blur-sm bg-white/20 dark:bg-zinc-800/30 hover:bg-white/30 dark:hover:bg-zinc-700/50 transition\"\n\taria-label=\"YAKKL University\"\n\tonclick={() => handleUniversity()}\n>\n\t<svg\n\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\tfill=\"currentColor\"\n\t\tviewBox=\"0 0 24 24\"\n\t\tclass=\"w-5 h-5 text-white dark:text-purple-400\"\n\t>\n\t\t<path d=\"M12 2L1 7l11 5 9-4.09V17h2V7L12 2zm-1 14.74l-5-2.27v2l5 2.27 5-2.27v-2l-5 2.27z\" />\n\t</svg>\n</button>\n","<script lang=\"ts\">\n\tconst props = $props<{\n\t\tuserName?: string;\n\t\turl?: string;\n\t\tclassName?: string;\n\t\tariaLabel?: string;\n\t}>();\n\n\tconst initial = props.userName?.charAt(0)?.toUpperCase() ?? '?';\n\n\t// Default styles (can be extended or overridden by props.className)\n\tconst defaultClasses =\n\t\t'w-10 h-10 rounded-full ring-2 ring-offset-1 flex items-center justify-center text-sm font-bold uppercase bg-primary-300 text-base-content';\n</script>\n\n{#if props.url}\n\t<img\n\t\tsrc={props.url}\n\t\talt={props.ariaLabel ?? 'User avatar'}\n\t\tclass={`object-cover ${props.className ?? defaultClasses}`}\n\t\tloading=\"lazy\"\n\t/>\n{:else}\n\t<div\n\t\tclass={props.className ?? defaultClasses}\n\t\taria-label={props.ariaLabel ?? 'User avatar'}\n\t\trole=\"img\"\n\t>\n\t\t{initial}\n\t</div>\n{/if}\n","<!-- Profile.svelte -->\n<script lang=\"ts\">\n\timport { createForm } from 'svelte-forms-lib';\n\timport * as yup from 'yup';\n\timport Modal from './Modal.svelte';\n\timport Avatar from './Avatar.svelte';\n\timport ErrorNoAction from './ErrorNoAction.svelte';\n\timport { getProfile, setProfileStorage, yakklMiscStore } from '$lib/common/stores';\n\timport { log } from '$lib/common/logger-wrapper';\n\timport type { Profile, ProfileData } from '$lib/common/interfaces';\n\timport { decryptData, encryptData } from '$lib/common/encryption';\n\timport { isEncryptedData } from '$lib/common/misc';\n\timport { identicon } from '$lib/utilities';\n\n\tinterface Props {\n\t\tshow?: boolean;\n\t\tonClose?: () => void;\n\t\tonComplete?: () => void;\n\t}\n\n\tlet {\n\t\tshow = $bindable(false),\n\t\tonClose = () => (show = false),\n\t\tonComplete = () => {}\n\t}: Props = $props();\n\n\tlet profile: Profile | null = $state(null);\n\tlet profileData: ProfileData | null = $state(null);\n\tlet isLoading = $state(false);\n\tlet isSaving = $state(false);\n\tlet error = $state('');\n\tlet success = $state('');\n\tlet previewAvatarUrl = $state('');\n\tlet hasChanges = $state(false);\n\tlet showError = $state(false);\n\tlet errorValue = $state('');\n\n\t// Form validation schema\n\tconst validationSchema = yup.object().shape({\n\t\tuserName: yup\n\t\t\t.string()\n\t\t\t.required('Username is required')\n\t\t\t.min(3, 'Username must be at least 3 characters')\n\t\t\t.max(30, 'Username must be less than 30 characters')\n\t\t\t.matches(/^[a-zA-Z0-9_-]+$/, 'Username can only contain letters, numbers, underscores, and dashes'),\n\t\tfirstName: yup\n\t\t\t.string()\n\t\t\t.required('First name is required')\n\t\t\t.min(1, 'First name is required')\n\t\t\t.max(50, 'First name must be less than 50 characters'),\n\t\tlastName: yup\n\t\t\t.string()\n\t\t\t.required('Last name is required')\n\t\t\t.min(1, 'Last name is required')\n\t\t\t.max(50, 'Last name must be less than 50 characters'),\n\t\temail: yup\n\t\t\t.string()\n\t\t\t.email('Must be a valid email address')\n\t\t\t.required('Email address is required'),\n\t\tbio: yup\n\t\t\t.string()\n\t\t\t.max(500, 'Bio must be less than 500 characters')\n\t\t\t.optional(),\n\t\twebsite: yup\n\t\t\t.string()\n\t\t\t.url('Must be a valid URL')\n\t\t\t.optional()\n\t\t\t.nullable()\n\t\t\t.transform((value) => (value === '' ? null : value)),\n\t\tavatarUrl: yup\n\t\t\t.string()\n\t\t\t.url('Must be a valid URL')\n\t\t\t.optional()\n\t\t\t.nullable()\n\t\t\t.transform((value) => (value === '' ? null : value))\n\t});\n\n\t// Initialize form\n\tconst { form, errors, isValid, touched, updateField } = createForm({\n\t\tinitialValues: {\n\t\t\tuserName: '',\n\t\t\tfirstName: '',\n\t\t\tlastName: '',\n\t\t\temail: '',\n\t\t\tbio: '',\n\t\t\twebsite: '',\n\t\t\tavatarUrl: ''\n\t\t},\n\t\tvalidationSchema,\n\t\tonSubmit: async (values) => {\n\t\t\tawait saveProfile(values);\n\t\t}\n\t});\n\n\t// Custom submit handler for Svelte 5\n\tasync function handleFormSubmit(event: Event) {\n\t\tevent.preventDefault();\n\t\t\n\t\t// Validate the form\n\t\tif (!$isValid) {\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t// Call saveProfile directly with form values\n\t\tawait saveProfile($form);\n\t}\n\n\t// Load profile data on mount and when modal opens\n\t$effect(() => {\n\t\tif (show) {\n\t\t\tloadProfileData();\n\t\t}\n\t});\n\n\t// Track form changes\n\t$effect(() => {\n\t\tif (profile && profileData && !isLoading) {\n\t\t\tconst currentValues = $form;\n\t\t\t// Only track changes if form has been properly initialized\n\t\t\tconst originalValues = {\n\t\t\t\tuserName: profile.userName || '',\n\t\t\t\tfirstName: profileData.name?.first || '',\n\t\t\t\tlastName: profileData.name?.last || '',\n\t\t\t\temail: profileData.email || '',\n\t\t\t\tbio: profileData?.bio as string || '',\n\t\t\t\twebsite: profileData?.website as string || '',\n\t\t\t\tavatarUrl: profileData?.avatarUrl as string || ''\n\t\t\t};\n\n\t\t\thasChanges =\n\t\t\t\tcurrentValues.userName !== originalValues.userName ||\n\t\t\t\tcurrentValues.firstName !== originalValues.firstName ||\n\t\t\t\tcurrentValues.lastName !== originalValues.lastName ||\n\t\t\t\tcurrentValues.email !== originalValues.email ||\n\t\t\t\tcurrentValues.bio !== originalValues.bio ||\n\t\t\t\tcurrentValues.website !== originalValues.website ||\n\t\t\t\tcurrentValues.avatarUrl !== originalValues.avatarUrl;\n\n\t\t} else {\n\t\t\thasChanges = false;\n\t\t}\n\t});\n\n\t// Update preview avatar when URL changes\n\t$effect(() => {\n\t\tconst avatarUrl = $form.avatarUrl;\n\t\tif (avatarUrl && avatarUrl.trim() !== '') {\n\t\t\tpreviewAvatarUrl = avatarUrl;\n\t\t} else {\n\t\t\tpreviewAvatarUrl = profileData?.avatarUrl as string || identicon(profile?.userName || 'default');\n\t\t}\n\t});\n\n\tasync function loadProfileData() {\n\t\tisLoading = true;\n\t\terror = '';\n\n\t\ttry {\n\t\t\tprofile = await getProfile();\n\t\t\tif (!profile) {\n\t\t\t\terror = 'Profile not found';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Decrypt profile data if encrypted\n\t\t\tif (isEncryptedData(profile.data)) {\n\t\t\t\tconst miscStore = $yakklMiscStore;\n\t\t\t\tif (!miscStore) {\n\t\t\t\t\terror = 'Unable to decrypt profile data';\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tprofileData = await decryptData(profile.data, miscStore) as ProfileData;\n\t\t\t} else {\n\t\t\t\tprofileData = profile.data as ProfileData;\n\t\t\t}\n\n\t\t\t// Update form with profile data\n\t\t\tupdateField('userName', profile.userName || '');\n\t\t\tupdateField('firstName', profileData.name?.first || '');\n\t\t\tupdateField('lastName', profileData.name?.last || '');\n\t\t\tupdateField('email', profileData.email || '');\n\t\t\tupdateField('bio', profileData?.bio as string || '');\n\t\t\tupdateField('website', profileData?.website as string || '');\n\t\t\tupdateField('avatarUrl', profileData?.avatarUrl as string || '');\n\n\t\t} catch (e) {\n\t\t\tlog.error('Error loading profile data:', false, e);\n\t\t\terror = 'Failed to load profile data';\n\t\t} finally {\n\t\t\tisLoading = false;\n\t\t}\n\t}\n\n\tasync function saveProfile(values: any) {\n\n\t\tif (!profile || !profileData) {\n\t\t\terror = 'Profile data not loaded';\n\t\t\treturn;\n\t\t}\n\n\t\tisSaving = true;\n\t\terror = '';\n\t\tsuccess = '';\n\n\t\ttry {\n\t\t\tlog.info('[Profile] Starting save with values:', false, values);\n\t\t\tlog.info('[Profile] Current state:', false, {\n\t\t\t\tprofile: !!profile,\n\t\t\t\tprofileData: !!profileData,\n\t\t\t\tmiscStore: !!$yakklMiscStore\n\t\t\t});\n\n\t\t\t// Check if we can encrypt before proceeding\n\t\t\tconst miscStore = $yakklMiscStore;\n\t\t\tif (!miscStore) {\n\t\t\t\tconst errorMsg = 'Unable to encrypt profile data - missing encryption key';\n\t\t\t\tlog.error('[Profile] ' + errorMsg, false);\n\t\t\t\terror = errorMsg;\n\t\t\t\terrorValue = errorMsg;\n\t\t\t\tshowError = true;\n\t\t\t\tisSaving = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Update profile data\n\t\t\tconst updatedProfileData: ProfileData = {\n\t\t\t\t...profileData,\n\t\t\t\tname: {\n\t\t\t\t\tid: profile.id,\n\t\t\t\t\tpersona: profile.persona,\n\t\t\t\t\tfirst: values.firstName || '',\n\t\t\t\t\tlast: values.lastName || ''\n\t\t\t\t},\n\t\t\t\temail: values.email || '',\n\t\t\t\tbio: values.bio || '',\n\t\t\t\twebsite: values.website || '',\n\t\t\t\tavatarUrl: values.avatarUrl || ''\n\t\t\t};\n\n\t\t\tlog.info('[Profile] Created updated profile data:', false, updatedProfileData);\n\n\t\t\t// Update profile\n\t\t\tconst updatedProfile: Profile = {\n\t\t\t\t...profile,\n\t\t\t\tuserName: values.userName,\n\t\t\t\tdata: updatedProfileData,\n\t\t\t\tupdateDate: new Date().toISOString()\n\t\t\t};\n\n\t\t\tlog.info('[Profile] Created updated profile:', false, {\n\t\t\t\tuserName: updatedProfile.userName,\n\t\t\t\tupdateDate: updatedProfile.updateDate\n\t\t\t});\n\n\t\t\t// Encrypt the data\n\t\t\tlog.info('[Profile] Starting encryption...');\n\t\t\ttry {\n\t\t\t\tupdatedProfile.data = await encryptData(updatedProfileData, miscStore);\n\t\t\t\tlog.info('[Profile] Encryption successful');\n\t\t\t} catch (encryptError: any) {\n\t\t\t\tconst errorMsg = 'Failed to encrypt profile data: ' + encryptError.message;\n\t\t\t\tlog.error('[Profile] Encryption failed:', false, encryptError);\n\t\t\t\terror = errorMsg;\n\t\t\t\terrorValue = errorMsg;\n\t\t\t\tshowError = true;\n\t\t\t\tisSaving = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Save to storage\n\t\t\tlog.info('[Profile] Starting storage save...');\n\t\t\ttry {\n\t\t\t\tawait setProfileStorage(updatedProfile);\n\t\t\t\tlog.info('[Profile] Storage save successful');\n\t\t\t} catch (saveError: any) {\n\t\t\t\tconst errorMsg = 'Failed to save profile to storage: ' + saveError.message;\n\t\t\t\tlog.error('[Profile] Storage failed:', false, saveError);\n\t\t\t\terror = errorMsg;\n\t\t\t\terrorValue = errorMsg;\n\t\t\t\tshowError = true;\n\t\t\t\tisSaving = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Update the local profile and profileData references to reflect saved state\n\t\t\t// Keep profile.data unencrypted for local comparison purposes\n\t\t\tprofile = {\n\t\t\t\t...updatedProfile,\n\t\t\t\tdata: updatedProfileData\n\t\t\t};\n\t\t\tprofileData = updatedProfileData;\n\n\t\t\tsuccess = 'Profile updated successfully!';\n\t\t\thasChanges = false;\n\n\t\t\tlog.info('[Profile] Profile saved successfully, state updated:', false, {\n\t\t\t\thasChanges,\n\t\t\t\tprofile: profile.userName,\n\t\t\t\tprofileData: profileData.name\n\t\t\t});\n\n\t\t\t// Call completion callback\n\t\t\tonComplete();\n\n\t\t\t// Close modal with a small delay to ensure state updates complete\n\t\t\tlog.info('[Profile] Preparing to close modal after successful save');\n\t\t\t\n\t\t\t// Use setTimeout to ensure state updates are complete\n\t\t\tsetTimeout(() => {\n\t\t\t\tshow = false;\n\t\t\t\tisSaving = false;\n\t\t\t}, 100);\n\n\t\t} catch (e: any) {\n\t\t\tconst errorMsg = 'Failed to save profile changes: ' + e.message;\n\t\t\tlog.error('[Profile] Unexpected error saving profile:', false, e);\n\t\t\terror = errorMsg;\n\t\t\terrorValue = errorMsg;\n\t\t\tshowError = true;\n\t\t\tisSaving = false;\n\t\t}\n\t}\n\n\tfunction handleClose() {\n\t\tif (hasChanges) {\n\t\t\tif (confirm('You have unsaved changes. Are you sure you want to close?')) {\n\t\t\t\tshow = false;\n\t\t\t\tonClose();\n\t\t\t}\n\t\t} else {\n\t\t\tshow = false;\n\t\t\tonClose();\n\t\t}\n\t}\n\n\tfunction resetForm() {\n\t\tif (profile && profileData) {\n\t\t\tupdateField('userName', profile.userName || '');\n\t\t\tupdateField('firstName', profileData.name?.first || '');\n\t\t\tupdateField('lastName', profileData.name?.last || '');\n\t\t\tupdateField('email', profileData.email || '');\n\t\t\tupdateField('bio', profileData?.bio as string || '');\n\t\t\tupdateField('website', profileData?.website as string || '');\n\t\t\tupdateField('avatarUrl', profileData?.avatarUrl as string || '');\n\t\t}\n\t}\n\n\tfunction handleErrorClose() {\n\t\tshowError = false;\n\t\terror = '';\n\t\terrorValue = '';\n\t}\n</script>\n\n<Modal bind:show title=\"Profile\" onClose={handleClose} className=\"max-w-2xl\">\n\t<div class=\"space-y-6 p-6\">\n\t\t{#if isLoading}\n\t\t\t<div class=\"flex items-center justify-center py-8\">\n\t\t\t\t<div class=\"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600\"></div>\n\t\t\t\t<span class=\"ml-2 text-gray-600\">Loading profile...</span>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<form onsubmit={handleFormSubmit} class=\"space-y-6\">\n\t\t\t\t<!-- Avatar Section -->\n\t\t\t\t<div class=\"flex flex-col items-center space-y-4\">\n\t\t\t\t\t<div class=\"text-center\">\n\t\t\t\t\t\t<Avatar\n\t\t\t\t\t\t\turl={previewAvatarUrl}\n\t\t\t\t\t\t\tuserName={$form.firstName || $form.userName}\n\t\t\t\t\t\t\tclassName=\"w-24 h-24 rounded-full ring-4 ring-offset-2 ring-indigo-500\"\n\t\t\t\t\t\t\tariaLabel=\"Profile Avatar\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"w-full\">\n\t\t\t\t\t\t<label for=\"avatarUrl\" class=\"block text-sm font-medium text-gray-700 mb-1\">\n\t\t\t\t\t\t\tAvatar URL (optional)\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"avatarUrl\"\n\t\t\t\t\t\t\ttype=\"url\"\n\t\t\t\t\t\t\tbind:value={$form.avatarUrl}\n\t\t\t\t\t\t\tplaceholder=\"https://example.com/your-avatar.jpg\"\n\t\t\t\t\t\t\tclass=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n\t\t\t\t\t\t\tclass:border-red-500={$errors.avatarUrl && $touched.avatarUrl}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{#if $errors.avatarUrl && $touched.avatarUrl}\n\t\t\t\t\t\t\t<p class=\"mt-1 text-sm text-red-600\">{$errors.avatarUrl}</p>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Basic Information -->\n\t\t\t\t<div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label for=\"userName\" class=\"block text-sm font-medium text-gray-700 mb-1\">\n\t\t\t\t\t\t\tUsername <span class=\"text-red-500\">*</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"userName\"\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tbind:value={$form.userName}\n\t\t\t\t\t\t\tplaceholder=\"your_username\"\n\t\t\t\t\t\t\tclass=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n\t\t\t\t\t\t\tclass:border-red-500={$errors.userName && $touched.userName}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{#if $errors.userName && $touched.userName}\n\t\t\t\t\t\t\t<p class=\"mt-1 text-sm text-red-600\">{$errors.userName}</p>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label for=\"email\" class=\"block text-sm font-medium text-gray-700 mb-1\">\n\t\t\t\t\t\t\tEmail <span class=\"text-red-500\">*</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"email\"\n\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\tbind:value={$form.email}\n\t\t\t\t\t\t\tplaceholder=\"your@email.com\"\n\t\t\t\t\t\t\tclass=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n\t\t\t\t\t\t\tclass:border-red-500={$errors.email && $touched.email}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{#if $errors.email && $touched.email}\n\t\t\t\t\t\t\t<p class=\"mt-1 text-sm text-red-600\">{$errors.email}</p>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label for=\"firstName\" class=\"block text-sm font-medium text-gray-700 mb-1\">\n\t\t\t\t\t\t\tFirst Name <span class=\"text-red-500\">*</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"firstName\"\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tbind:value={$form.firstName}\n\t\t\t\t\t\t\tplaceholder=\"John\"\n\t\t\t\t\t\t\tclass=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n\t\t\t\t\t\t\tclass:border-red-500={$errors.firstName && $touched.firstName}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{#if $errors.firstName && $touched.firstName}\n\t\t\t\t\t\t\t<p class=\"mt-1 text-sm text-red-600\">{$errors.firstName}</p>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label for=\"lastName\" class=\"block text-sm font-medium text-gray-700 mb-1\">\n\t\t\t\t\t\t\tLast Name <span class=\"text-red-500\">*</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"lastName\"\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tbind:value={$form.lastName}\n\t\t\t\t\t\t\tplaceholder=\"Doe\"\n\t\t\t\t\t\t\tclass=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n\t\t\t\t\t\t\tclass:border-red-500={$errors.lastName && $touched.lastName}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{#if $errors.lastName && $touched.lastName}\n\t\t\t\t\t\t\t<p class=\"mt-1 text-sm text-red-600\">{$errors.lastName}</p>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Optional Fields -->\n\t\t\t\t<div>\n\t\t\t\t\t<label for=\"website\" class=\"block text-sm font-medium text-gray-700 mb-1\">\n\t\t\t\t\t\tWebsite (optional)\n\t\t\t\t\t</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"website\"\n\t\t\t\t\t\ttype=\"url\"\n\t\t\t\t\t\tbind:value={$form.website}\n\t\t\t\t\t\tplaceholder=\"https://your-website.com\"\n\t\t\t\t\t\tclass=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n\t\t\t\t\t\tclass:border-red-500={$errors.website && $touched.website}\n\t\t\t\t\t/>\n\t\t\t\t\t{#if $errors.website && $touched.website}\n\t\t\t\t\t\t<p class=\"mt-1 text-sm text-red-600\">{$errors.website}</p>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\n\t\t\t\t<div>\n\t\t\t\t\t<label for=\"bio\" class=\"block text-sm font-medium text-gray-700 mb-1\">\n\t\t\t\t\t\tBio (optional)\n\t\t\t\t\t</label>\n\t\t\t\t\t<textarea\n\t\t\t\t\t\tid=\"bio\"\n\t\t\t\t\t\tbind:value={$form.bio}\n\t\t\t\t\t\trows=\"3\"\n\t\t\t\t\t\tplaceholder=\"Tell us about yourself...\"\n\t\t\t\t\t\tclass=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n\t\t\t\t\t\tclass:border-red-500={$errors.bio && $touched.bio}\n\t\t\t\t\t></textarea>\n\t\t\t\t\t{#if $errors.bio && $touched.bio}\n\t\t\t\t\t\t<p class=\"mt-1 text-sm text-red-600\">{$errors.bio}</p>\n\t\t\t\t\t{/if}\n\t\t\t\t\t<p class=\"mt-1 text-sm text-gray-500\">{($form.bio || '').length}/500 characters</p>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Status Messages -->\n\t\t\t\t{#if error}\n\t\t\t\t\t<div class=\"rounded-md bg-red-50 p-4\">\n\t\t\t\t\t\t<p class=\"text-sm font-medium text-red-800\">{error}</p>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t{#if success}\n\t\t\t\t\t<div class=\"rounded-md bg-green-50 p-4\">\n\t\t\t\t\t\t<p class=\"text-sm font-medium text-green-800\">{success}</p>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<!-- Form Actions -->\n\t\t\t\t<div class=\"flex justify-between pt-5\">\n\t\t\t\t\t<button\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\tonclick={resetForm}\n\t\t\t\t\t\tclass=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\n\t\t\t\t\t\tdisabled={!hasChanges || isSaving}\n\t\t\t\t\t>\n\t\t\t\t\t\tReset\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<div class=\"flex space-x-3\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tonclick={handleClose}\n\t\t\t\t\t\t\tclass=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\n\t\t\t\t\t\t\tdisabled={isSaving}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t\tclass=\"px-4 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n\t\t\t\t\t\t\tdisabled={!$isValid || !hasChanges || isSaving}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if isSaving}\n\t\t\t\t\t\t\t\t<span class=\"flex items-center\">\n\t\t\t\t\t\t\t\t\t<div class=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n\t\t\t\t\t\t\t\t\tSaving...\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\tSave Changes\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Last Updated Info -->\n\t\t\t\t{#if profile?.updateDate}\n\t\t\t\t\t<div class=\"text-xs text-gray-500 text-center pt-2 border-t\">\n\t\t\t\t\t\tLast updated: {new Date(profile.updateDate).toLocaleString()}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</form>\n\t\t{/if}\n\t</div>\n</Modal>\n\n<ErrorNoAction\n\tbind:show={showError}\n\tvalue={errorValue}\n\ttitle=\"Profile Save Error\"\n\tonClose={handleErrorClose}\n/>\n","<!-- Settings.svelte -->\n<script lang=\"ts\">\n\timport { createForm } from 'svelte-forms-lib';\n\timport * as yup from 'yup';\n\timport Modal from './Modal.svelte';\n\timport { getSettings, setSettings, getProfile, setProfileStorage } from '$lib/common/stores';\n\timport { log } from '$lib/managers/Logger';\n\timport { onMount } from 'svelte';\n\timport type { Settings, Profile } from '$lib/common/interfaces';\n\timport { SystemTheme, PlanType } from '$lib/common/types';\n\n\tinterface Props {\n\t\tshow?: boolean;\n\t\tonClose?: () => void;\n\t\tonComplete?: () => void;\n\t}\n\n\tlet {\n\t\tshow = $bindable(false),\n\t\tonClose = () => (show = false),\n\t\tonComplete = () => {}\n\t}: Props = $props();\n\n\tlet settings: Settings | null = $state(null);\n\tlet profile: Profile | null = $state(null);\n\tlet isLoading = $state(false);\n\tlet isSaving = $state(false);\n\tlet error = $state('');\n\tlet success = $state('');\n\tlet hasChanges = $state(false);\n\n\t// Available options\n\tconst themeOptions = [\n\t\t{ value: SystemTheme.SYSTEM, label: 'System' },\n\t\t{ value: SystemTheme.LIGHT, label: 'Light' },\n\t\t{ value: SystemTheme.DARK, label: 'Dark' }\n\t];\n\n\tconst currencyOptions = [\n\t\t{ value: 'USD', label: 'US Dollar (USD)' },\n\t\t{ value: 'EUR', label: 'Euro (EUR)' },\n\t\t{ value: 'GBP', label: 'British Pound (GBP)' },\n\t\t{ value: 'JPY', label: 'Japanese Yen (JPY)' },\n\t\t{ value: 'CAD', label: 'Canadian Dollar (CAD)' },\n\t\t{ value: 'AUD', label: 'Australian Dollar (AUD)' },\n\t\t{ value: 'CHF', label: 'Swiss Franc (CHF)' },\n\t\t{ value: 'CNY', label: 'Chinese Yuan (CNY)' }\n\t];\n\n\tconst localeOptions = [\n\t\t{ value: 'en-US', label: 'English (US)' },\n\t\t{ value: 'en-GB', label: 'English (UK)' },\n\t\t{ value: 'es-ES', label: 'Spanish' },\n\t\t{ value: 'fr-FR', label: 'French' },\n\t\t{ value: 'de-DE', label: 'German' },\n\t\t{ value: 'it-IT', label: 'Italian' },\n\t\t{ value: 'pt-PT', label: 'Portuguese' },\n\t\t{ value: 'ja-JP', label: 'Japanese' },\n\t\t{ value: 'ko-KR', label: 'Korean' },\n\t\t{ value: 'zh-CN', label: 'Chinese (Simplified)' },\n\t\t{ value: 'zh-TW', label: 'Chinese (Traditional)' }\n\t];\n\n\tconst idleDelayOptions = [\n\t\t{ value: 60, label: '1 minute' },\n\t\t{ value: 300, label: '5 minutes' },\n\t\t{ value: 600, label: '10 minutes' },\n\t\t{ value: 900, label: '15 minutes' },\n\t\t{ value: 1800, label: '30 minutes' },\n\t\t{ value: 3600, label: '1 hour' },\n\t\t{ value: 0, label: 'Never' }\n\t];\n\n\t// Form validation schema\n\tconst validationSchema = yup.object().shape({\n\t\tshowTestNetworks: yup.boolean(),\n\t\ttheme: yup.string().oneOf(Object.values(SystemTheme)),\n\t\tlocale: yup.string().required('Locale is required'),\n\t\tcurrency: yup.string().required('Currency is required'),\n\t\tidleDelayInterval: yup.number().min(0, 'Idle delay must be 0 or positive'),\n\t\tidleAutoLock: yup.boolean(),\n\t\tidleAutoLockCycle: yup.number().min(60, 'Auto-lock cycle must be at least 1 minute'),\n\t\tshowHints: yup.boolean(),\n\t\ttrialCountdownPinned: yup.boolean()\n\t});\n\n\t// Initialize form\n\tconst { form, errors, isValid, touched, updateField } = createForm({\n\t\tinitialValues: {\n\t\t\tshowTestNetworks: false,\n\t\t\ttheme: SystemTheme.SYSTEM,\n\t\t\tlocale: 'en-US',\n\t\t\tcurrency: 'USD',\n\t\t\tidleDelayInterval: 300,\n\t\t\tidleAutoLock: true,\n\t\t\tidleAutoLockCycle: 180,\n\t\t\tshowHints: true,\n\t\t\ttrialCountdownPinned: false\n\t\t},\n\t\tvalidationSchema,\n\t\tonSubmit: async (values) => {\n\t\t\tawait saveSettings(values);\n\t\t}\n\t});\n\n\t// Custom submit handler for Svelte 5\n\tasync function handleFormSubmit(event: Event) {\n\t\tevent.preventDefault();\n\t\t\n\t\t// Validate the form\n\t\tif (!$isValid) {\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t// Call saveSettings directly with form values\n\t\tawait saveSettings($form);\n\t}\n\n\t// Load settings data on mount and when modal opens\n\t$effect(() => {\n\t\tif (show) {\n\t\t\tloadSettingsData();\n\t\t}\n\t});\n\n\t// Track form changes\n\t$effect(() => {\n\t\tif (settings && profile && !isLoading) {\n\t\t\tconst currentValues = $form;\n\t\t\t// Only track changes if form has been properly initialized\n\t\t\tconst originalValues = {\n\t\t\t\tshowTestNetworks: profile.preferences?.showTestNetworks ?? false,\n\t\t\t\ttheme: profile.preferences?.dark ?? SystemTheme.SYSTEM,\n\t\t\t\tlocale: profile.preferences?.locale ?? 'en-US',\n\t\t\t\tcurrency: profile.preferences?.currency?.code ?? 'USD',\n\t\t\t\tidleDelayInterval: profile.preferences?.idleDelayInterval ?? 300,\n\t\t\t\tidleAutoLock: profile.preferences?.idleAutoLock ?? true,\n\t\t\t\tidleAutoLockCycle: profile.preferences?.idleAutoLockCycle ?? 180,\n\t\t\t\tshowHints: settings.showHints ?? true,\n\t\t\t\ttrialCountdownPinned: settings.trialCountdownPinned ?? false\n\t\t\t};\n\n\t\t\thasChanges = \n\t\t\t\tcurrentValues.showTestNetworks !== originalValues.showTestNetworks ||\n\t\t\t\tcurrentValues.theme !== originalValues.theme ||\n\t\t\t\tcurrentValues.locale !== originalValues.locale ||\n\t\t\t\tcurrentValues.currency !== originalValues.currency ||\n\t\t\t\tcurrentValues.idleDelayInterval !== originalValues.idleDelayInterval ||\n\t\t\t\tcurrentValues.idleAutoLock !== originalValues.idleAutoLock ||\n\t\t\t\tcurrentValues.idleAutoLockCycle !== originalValues.idleAutoLockCycle ||\n\t\t\t\tcurrentValues.showHints !== originalValues.showHints ||\n\t\t\t\tcurrentValues.trialCountdownPinned !== originalValues.trialCountdownPinned;\n\t\t} else {\n\t\t\thasChanges = false;\n\t\t}\n\t});\n\n\tasync function loadSettingsData() {\n\t\tisLoading = true;\n\t\terror = '';\n\t\t\n\t\ttry {\n\t\t\t// Load both settings and profile (for preferences)\n\t\t\t[settings, profile] = await Promise.all([\n\t\t\t\tgetSettings(),\n\t\t\t\tgetProfile()\n\t\t\t]);\n\n\t\t\tif (!settings) {\n\t\t\t\terror = 'Settings not found';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!profile) {\n\t\t\t\terror = 'Profile not found';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Update form with current settings and preferences\n\t\t\tupdateField('showTestNetworks', profile.preferences?.showTestNetworks ?? false);\n\t\t\tupdateField('theme', profile.preferences?.dark ?? SystemTheme.SYSTEM);\n\t\t\tupdateField('locale', profile.preferences?.locale ?? 'en-US');\n\t\t\tupdateField('currency', profile.preferences?.currency?.code ?? 'USD');\n\t\t\tupdateField('idleDelayInterval', profile.preferences?.idleDelayInterval ?? 300);\n\t\t\tupdateField('idleAutoLock', profile.preferences?.idleAutoLock ?? true);\n\t\t\tupdateField('idleAutoLockCycle', profile.preferences?.idleAutoLockCycle ?? 180);\n\t\t\tupdateField('showHints', settings.showHints ?? true);\n\t\t\tupdateField('trialCountdownPinned', settings.trialCountdownPinned ?? false);\n\n\t\t} catch (e) {\n\t\t\tlog.error('Error loading settings data:', false, e);\n\t\t\terror = 'Failed to load settings data';\n\t\t} finally {\n\t\t\tisLoading = false;\n\t\t}\n\t}\n\n\tasync function saveSettings(values: any) {\n\t\tif (!settings || !profile) {\n\t\t\terror = 'Settings data not loaded';\n\t\t\treturn;\n\t\t}\n\n\t\tisSaving = true;\n\t\terror = '';\n\t\tsuccess = '';\n\n\t\ttry {\n\t\t\t// Update settings\n\t\t\tconst updatedSettings: Settings = {\n\t\t\t\t...settings,\n\t\t\t\tshowHints: values.showHints,\n\t\t\t\ttrialCountdownPinned: values.trialCountdownPinned,\n\t\t\t\tupdateDate: new Date().toISOString()\n\t\t\t};\n\n\t\t\t// Update preferences in profile\n\t\t\tconst updatedProfile: Profile = {\n\t\t\t\t...profile,\n\t\t\t\tpreferences: {\n\t\t\t\t\t...profile.preferences,\n\t\t\t\t\tshowTestNetworks: values.showTestNetworks,\n\t\t\t\t\tdark: values.theme,\n\t\t\t\t\tlocale: values.locale,\n\t\t\t\t\tcurrency: {\n\t\t\t\t\t\t...profile.preferences.currency,\n\t\t\t\t\t\tcode: values.currency\n\t\t\t\t\t},\n\t\t\t\t\tidleDelayInterval: values.idleDelayInterval,\n\t\t\t\t\tidleAutoLock: values.idleAutoLock,\n\t\t\t\t\tidleAutoLockCycle: values.idleAutoLockCycle,\n\t\t\t\t\tupdateDate: new Date().toISOString()\n\t\t\t\t},\n\t\t\t\tupdateDate: new Date().toISOString()\n\t\t\t};\n\n\t\t\t// Save both settings and profile\n\t\t\tawait Promise.all([\n\t\t\t\tsetSettings(updatedSettings),\n\t\t\t\tsetProfileStorage(updatedProfile)\n\t\t\t]);\n\n\t\t\t// Update local references to reflect saved state\n\t\t\tsettings = updatedSettings;\n\t\t\tprofile = updatedProfile;\n\n\t\t\tsuccess = 'Settings updated successfully!';\n\t\t\thasChanges = false;\n\t\t\t\n\t\t\t// Call completion callback\n\t\t\tonComplete();\n\n\t\t\t// Call completion callback\n\t\t\tonComplete();\n\n\t\t\t// Close modal with a small delay to ensure state updates complete\n\t\t\tsetTimeout(() => {\n\t\t\t\tshow = false;\n\t\t\t\tisSaving = false;\n\t\t\t}, 100);\n\n\t\t} catch (e: any) {\n\t\t\tconst errorMsg = 'Failed to save settings changes: ' + e.message;\n\t\t\tlog.error('Error saving settings:', false, e);\n\t\t\terror = errorMsg;\n\t\t\tisSaving = false;\n\t\t}\n\t}\n\n\tfunction handleClose() {\n\t\tif (hasChanges) {\n\t\t\tif (confirm('You have unsaved changes. Are you sure you want to close?')) {\n\t\t\t\tshow = false;\n\t\t\t\tonClose();\n\t\t\t}\n\t\t} else {\n\t\t\tshow = false;\n\t\t\tonClose();\n\t\t}\n\t}\n\n\tfunction resetForm() {\n\t\tif (settings && profile) {\n\t\t\tupdateField('showTestNetworks', profile.preferences?.showTestNetworks ?? false);\n\t\t\tupdateField('theme', profile.preferences?.dark ?? SystemTheme.SYSTEM);\n\t\t\tupdateField('locale', profile.preferences?.locale ?? 'en-US');\n\t\t\tupdateField('currency', profile.preferences?.currency?.code ?? 'USD');\n\t\t\tupdateField('idleDelayInterval', profile.preferences?.idleDelayInterval ?? 300);\n\t\t\tupdateField('idleAutoLock', profile.preferences?.idleAutoLock ?? true);\n\t\t\tupdateField('idleAutoLockCycle', profile.preferences?.idleAutoLockCycle ?? 180);\n\t\t\tupdateField('showHints', settings.showHints ?? true);\n\t\t\tupdateField('trialCountdownPinned', settings.trialCountdownPinned ?? false);\n\t\t}\n\t}\n\n\tfunction getPlanLabel(planType: PlanType): string {\n\t\tswitch (planType) {\n\t\t\tcase PlanType.BASIC_MEMBER:\n\t\t\t\treturn 'Basic Member';\n\t\t\tcase PlanType.YAKKL_PRO:\n\t\t\t\treturn 'YAKKL Pro';\n\t\t\tcase PlanType.YAKKL_PREMIUM:\n\t\t\t\treturn 'YAKKL Premium';\n\t\t\tdefault:\n\t\t\t\treturn 'Unknown';\n\t\t}\n\t}\n</script>\n\n<Modal bind:show title=\"Account Settings\" onClose={handleClose} className=\"max-w-2xl\">\n\t<div class=\"space-y-6 p-6\">\n\t\t{#if isLoading}\n\t\t\t<div class=\"flex items-center justify-center py-8\">\n\t\t\t\t<div class=\"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600\"></div>\n\t\t\t\t<span class=\"ml-2 text-gray-600\">Loading settings...</span>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<form onsubmit={handleFormSubmit} class=\"space-y-6\">\n\t\t\t\t<!-- Account Information (Read-only) -->\n\t\t\t\t{#if settings && profile}\n\t\t\t\t\t<div class=\"bg-gray-50 p-4 rounded-lg\">\n\t\t\t\t\t\t<h3 class=\"text-lg font-medium text-gray-900 mb-3\">Account Information</h3>\n\t\t\t\t\t\t<div class=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<span class=\"font-medium text-gray-700\">Plan:</span>\n\t\t\t\t\t\t\t\t<span class=\"ml-2 text-gray-600\">{getPlanLabel(settings.plan.type)}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<span class=\"font-medium text-gray-700\">Member since:</span>\n\t\t\t\t\t\t\t\t<span class=\"ml-2 text-gray-600\">{new Date(settings.createDate).toLocaleDateString()}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<span class=\"font-medium text-gray-700\">Profile ID:</span>\n\t\t\t\t\t\t\t\t<span class=\"ml-2 text-gray-600 font-mono text-xs\">{settings.id.substring(0, 8)}...</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<span class=\"font-medium text-gray-700\">Version:</span>\n\t\t\t\t\t\t\t\t<span class=\"ml-2 text-gray-600\">{settings.version}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<!-- Display & Theme Settings -->\n\t\t\t\t<div>\n\t\t\t\t\t<h3 class=\"text-lg font-medium text-gray-900 mb-4\">Display & Theme</h3>\n\t\t\t\t\t<div class=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label for=\"theme\" class=\"block text-sm font-medium text-gray-700 mb-1\">\n\t\t\t\t\t\t\t\tTheme\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\tid=\"theme\"\n\t\t\t\t\t\t\t\tbind:value={$form.theme}\n\t\t\t\t\t\t\t\tclass=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{#each themeOptions as option}\n\t\t\t\t\t\t\t\t\t<option value={option.value}>{option.label}</option>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tid=\"showTestNetworks\"\n\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\tbind:checked={$form.showTestNetworks}\n\t\t\t\t\t\t\t\tclass=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<label for=\"showTestNetworks\" class=\"ml-2 block text-sm text-gray-900\">\n\t\t\t\t\t\t\t\tShow test networks\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tid=\"showHints\"\n\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\tbind:checked={$form.showHints}\n\t\t\t\t\t\t\t\tclass=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<label for=\"showHints\" class=\"ml-2 block text-sm text-gray-900\">\n\t\t\t\t\t\t\t\tShow helpful hints and tips\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Localization Settings -->\n\t\t\t\t<div>\n\t\t\t\t\t<h3 class=\"text-lg font-medium text-gray-900 mb-4\">Localization</h3>\n\t\t\t\t\t<div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label for=\"locale\" class=\"block text-sm font-medium text-gray-700 mb-1\">\n\t\t\t\t\t\t\t\tLanguage <span class=\"text-red-500\">*</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\tid=\"locale\"\n\t\t\t\t\t\t\t\tbind:value={$form.locale}\n\t\t\t\t\t\t\t\tclass=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n\t\t\t\t\t\t\t\tclass:border-red-500={$errors.locale && $touched.locale}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{#each localeOptions as option}\n\t\t\t\t\t\t\t\t\t<option value={option.value}>{option.label}</option>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t{#if $errors.locale && $touched.locale}\n\t\t\t\t\t\t\t\t<p class=\"mt-1 text-sm text-red-600\">{$errors.locale}</p>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label for=\"currency\" class=\"block text-sm font-medium text-gray-700 mb-1\">\n\t\t\t\t\t\t\t\tCurrency <span class=\"text-red-500\">*</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\tid=\"currency\"\n\t\t\t\t\t\t\t\tbind:value={$form.currency}\n\t\t\t\t\t\t\t\tclass=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n\t\t\t\t\t\t\t\tclass:border-red-500={$errors.currency && $touched.currency}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{#each currencyOptions as option}\n\t\t\t\t\t\t\t\t\t<option value={option.value}>{option.label}</option>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t{#if $errors.currency && $touched.currency}\n\t\t\t\t\t\t\t\t<p class=\"mt-1 text-sm text-red-600\">{$errors.currency}</p>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Security Settings -->\n\t\t\t\t<div>\n\t\t\t\t\t<h3 class=\"text-lg font-medium text-gray-900 mb-4\">Security & Privacy</h3>\n\t\t\t\t\t<div class=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label for=\"idleDelayInterval\" class=\"block text-sm font-medium text-gray-700 mb-1\">\n\t\t\t\t\t\t\t\tAuto-lock after idle time\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\tid=\"idleDelayInterval\"\n\t\t\t\t\t\t\t\tbind:value={$form.idleDelayInterval}\n\t\t\t\t\t\t\t\tclass=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{#each idleDelayOptions as option}\n\t\t\t\t\t\t\t\t\t<option value={option.value}>{option.label}</option>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t<p class=\"mt-1 text-sm text-gray-500\">\n\t\t\t\t\t\t\t\tAutomatically lock the wallet after the specified time of inactivity\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tid=\"idleAutoLock\"\n\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\tbind:checked={$form.idleAutoLock}\n\t\t\t\t\t\t\t\tclass=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<label for=\"idleAutoLock\" class=\"ml-2 block text-sm text-gray-900\">\n\t\t\t\t\t\t\t\tEnable automatic idle lock\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{#if $form.idleAutoLock}\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<label for=\"idleAutoLockCycle\" class=\"block text-sm font-medium text-gray-700 mb-1\">\n\t\t\t\t\t\t\t\t\tAuto-lock cycle (seconds)\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tid=\"idleAutoLockCycle\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tbind:value={$form.idleAutoLockCycle}\n\t\t\t\t\t\t\t\t\tmin=\"60\"\n\t\t\t\t\t\t\t\t\tmax=\"3600\"\n\t\t\t\t\t\t\t\t\tstep=\"60\"\n\t\t\t\t\t\t\t\t\tclass=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n\t\t\t\t\t\t\t\t\tclass:border-red-500={$errors.idleAutoLockCycle && $touched.idleAutoLockCycle}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t{#if $errors.idleAutoLockCycle && $touched.idleAutoLockCycle}\n\t\t\t\t\t\t\t\t\t<p class=\"mt-1 text-sm text-red-600\">{$errors.idleAutoLockCycle}</p>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t<p class=\"mt-1 text-sm text-gray-500\">\n\t\t\t\t\t\t\t\t\tHow often to check for idle activity (minimum 60 seconds)\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Trial Settings (if applicable) -->\n\t\t\t\t{#if settings?.plan?.trialEndDate}\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h3 class=\"text-lg font-medium text-gray-900 mb-4\">Trial Settings</h3>\n\t\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tid=\"trialCountdownPinned\"\n\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\tbind:checked={$form.trialCountdownPinned}\n\t\t\t\t\t\t\t\tclass=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<label for=\"trialCountdownPinned\" class=\"ml-2 block text-sm text-gray-900\">\n\t\t\t\t\t\t\t\tPin trial countdown to top of interface\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<!-- Status Messages -->\n\t\t\t\t{#if error}\n\t\t\t\t\t<div class=\"rounded-md bg-red-50 p-4\">\n\t\t\t\t\t\t<p class=\"text-sm font-medium text-red-800\">{error}</p>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t{#if success}\n\t\t\t\t\t<div class=\"rounded-md bg-green-50 p-4\">\n\t\t\t\t\t\t<p class=\"text-sm font-medium text-green-800\">{success}</p>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<!-- Form Actions -->\n\t\t\t\t<div class=\"flex justify-between pt-5\">\n\t\t\t\t\t<button\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\tonclick={resetForm}\n\t\t\t\t\t\tclass=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\n\t\t\t\t\t\tdisabled={!hasChanges || isSaving}\n\t\t\t\t\t>\n\t\t\t\t\t\tReset\n\t\t\t\t\t</button>\n\t\t\t\t\t\n\t\t\t\t\t<div class=\"flex space-x-3\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tonclick={handleClose}\n\t\t\t\t\t\t\tclass=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\n\t\t\t\t\t\t\tdisabled={isSaving}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t\tclass=\"px-4 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n\t\t\t\t\t\t\tdisabled={!$isValid || !hasChanges || isSaving}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if isSaving}\n\t\t\t\t\t\t\t\t<span class=\"flex items-center\">\n\t\t\t\t\t\t\t\t\t<div class=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n\t\t\t\t\t\t\t\t\tSaving...\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\tSave Changes\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Last Updated Info -->\n\t\t\t\t{#if settings?.updateDate}\n\t\t\t\t\t<div class=\"text-xs text-gray-500 text-center pt-2 border-t\">\n\t\t\t\t\t\tLast updated: {new Date(settings.updateDate).toLocaleString()}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</form>\n\t\t{/if}\n\t</div>\n</Modal>","<!-- Watcher.svelte - Advanced Portfolio Tracking & Social Intelligence -->\n<script lang=\"ts\">\n\timport { onMount, onDestroy } from 'svelte';\n\timport { log } from '$lib/managers/Logger';\n\timport SimpleTooltip from './SimpleTooltip.svelte';\n\timport Modal from './Modal.svelte';\n\n\tinterface Props {\n\t\tshow: boolean;\n\t\tonClose: () => void;\n\t\tonComplete?: () => void;\n\t}\n\n\tlet { show = $bindable(), onClose, onComplete }: Props = $props();\n\n\t// Watch account data structure\n\tinterface WatchAccount {\n\t\tid: string;\n\t\taddress: string;\n\t\talias: string;\n\t\tblockchain: string;\n\t\taccountType: 'personal' | 'exchange' | 'whale' | 'institution' | 'contract';\n\t\tcategory?: string;\n\t\ttags: string[];\n\t\tbalance?: number;\n\t\tportfolioValue?: number;\n\t\tlastActivity?: Date;\n\t\tsocialScore?: number;\n\t\tisActive: boolean;\n\t\tcreatedAt: Date;\n\t\tnotifications: {\n\t\t\tlargeTransactions: boolean;\n\t\t\tbalanceChanges: boolean;\n\t\t\tsocialActivity: boolean;\n\t\t};\n\t}\n\n\t// Social intelligence data\n\tinterface SocialIntelligence {\n\t\tfollowersCount: number;\n\t\ttradingActivity: 'low' | 'medium' | 'high' | 'whale';\n\t\treputationScore: number;\n\t\trecentTransactions: {\n\t\t\tamount: number;\n\t\t\tdirection: 'in' | 'out';\n\t\t\ttimestamp: Date;\n\t\t\tsignificance: 'normal' | 'notable' | 'major';\n\t\t}[];\n\t\tinfluenceMetrics: {\n\t\t\tcopyTraders: number;\n\t\t\tportfolioMirrors: number;\n\t\t\tsocialMentions: number;\n\t\t};\n\t}\n\n\t// Component state\n\tlet watchAccounts = $state<WatchAccount[]>([]);\n\tlet selectedAccount = $state<WatchAccount | null>(null);\n\tlet socialData = $state<Map<string, SocialIntelligence>>(new Map());\n\tlet activeTab = $state<'accounts' | 'analytics' | 'social' | 'alerts'>('accounts');\n\tlet isLoading = $state(false);\n\tlet error = $state('');\n\n\t// Form state for adding new watch account\n\tlet newAccountForm = $state({\n\t\taddress: '',\n\t\talias: '',\n\t\tblockchain: 'ethereum',\n\t\taccountType: 'personal' as WatchAccount['accountType'],\n\t\tcategory: '',\n\t\ttags: [] as string[],\n\t\tnotifications: {\n\t\t\tlargeTransactions: true,\n\t\t\tbalanceChanges: false,\n\t\t\tsocialActivity: false\n\t\t}\n\t});\n\n\t// Available blockchains for watching\n\tconst supportedBlockchains = [\n\t\t{ id: 'ethereum', name: 'Ethereum', symbol: 'ETH' },\n\t\t{ id: 'bitcoin', name: 'Bitcoin', symbol: 'BTC' },\n\t\t{ id: 'polygon', name: 'Polygon', symbol: 'MATIC' },\n\t\t{ id: 'arbitrum', name: 'Arbitrum', symbol: 'ARB' },\n\t\t{ id: 'optimism', name: 'Optimism', symbol: 'OP' }\n\t];\n\n\t// Account type definitions with descriptions\n\tconst accountTypes = [\n\t\t{ \n\t\t\tid: 'personal', \n\t\t\tname: 'Personal Account', \n\t\t\tdescription: 'Individual wallet addresses you want to track',\n\t\t\ticon: ''\n\t\t},\n\t\t{ \n\t\t\tid: 'exchange', \n\t\t\tname: 'Exchange Account', \n\t\t\tdescription: 'Centralized exchange accounts for portfolio tracking',\n\t\t\ticon: ''\n\t\t},\n\t\t{ \n\t\t\tid: 'whale', \n\t\t\tname: 'Whale Watching', \n\t\t\tdescription: 'High-value accounts for social trading intelligence',\n\t\t\ticon: ''\n\t\t},\n\t\t{ \n\t\t\tid: 'institution', \n\t\t\tname: 'Institutional', \n\t\t\tdescription: 'Corporate or institutional wallet addresses',\n\t\t\ticon: ''\n\t\t},\n\t\t{ \n\t\t\tid: 'contract', \n\t\t\tname: 'Smart Contract', \n\t\t\tdescription: 'DeFi protocols and smart contract addresses',\n\t\t\ticon: ''\n\t\t}\n\t];\n\n\tonMount(async () => {\n\t\tawait loadWatchAccounts();\n\t});\n\n\tasync function loadWatchAccounts() {\n\t\ttry {\n\t\t\tisLoading = true;\n\t\t\t// TODO: Load from storage/API\n\t\t\t// For now, using mock data\n\t\t\tawait new Promise(resolve => setTimeout(resolve, 500)); // Simulate loading\n\t\t\t\n\t\t\twatchAccounts = [\n\t\t\t\t{\n\t\t\t\t\tid: '1',\n\t\t\t\t\taddress: '0x742d35cc6129c6532c742fc9d2c1b1e7c15b4c85',\n\t\t\t\t\talias: 'Vitalik Buterin',\n\t\t\t\t\tblockchain: 'ethereum',\n\t\t\t\t\taccountType: 'whale',\n\t\t\t\t\tcategory: 'Influencer',\n\t\t\t\t\ttags: ['ethereum', 'founder', 'whale'],\n\t\t\t\t\tbalance: 2500000,\n\t\t\t\t\tportfolioValue: 125000000,\n\t\t\t\t\tlastActivity: new Date(Date.now() - 3600000),\n\t\t\t\t\tsocialScore: 95,\n\t\t\t\t\tisActive: true,\n\t\t\t\t\tcreatedAt: new Date(Date.now() - 86400000 * 7),\n\t\t\t\t\tnotifications: {\n\t\t\t\t\t\tlargeTransactions: true,\n\t\t\t\t\t\tbalanceChanges: false,\n\t\t\t\t\t\tsocialActivity: true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t];\n\n\t\t\t// Load social intelligence data\n\t\t\tsocialData.set('1', {\n\t\t\t\tfollowersCount: 5200000,\n\t\t\t\ttradingActivity: 'whale',\n\t\t\t\treputationScore: 98,\n\t\t\t\trecentTransactions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tamount: 1500000,\n\t\t\t\t\t\tdirection: 'out',\n\t\t\t\t\t\ttimestamp: new Date(Date.now() - 3600000),\n\t\t\t\t\t\tsignificance: 'major'\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tinfluenceMetrics: {\n\t\t\t\t\tcopyTraders: 15000,\n\t\t\t\t\tportfolioMirrors: 8500,\n\t\t\t\t\tsocialMentions: 125000\n\t\t\t\t}\n\t\t\t});\n\n\t\t} catch (err) {\n\t\t\terror = 'Failed to load watch accounts';\n\t\t\tlog.error('Error loading watch accounts:', false, err);\n\t\t} finally {\n\t\t\tisLoading = false;\n\t\t}\n\t}\n\n\tasync function addWatchAccount() {\n\t\ttry {\n\t\t\tif (!newAccountForm.address || !newAccountForm.alias) {\n\t\t\t\terror = 'Address and alias are required';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst newAccount: WatchAccount = {\n\t\t\t\tid: Date.now().toString(),\n\t\t\t\t...newAccountForm,\n\t\t\t\ttags: newAccountForm.tags.filter(tag => tag.trim()),\n\t\t\t\tbalance: 0,\n\t\t\t\tportfolioValue: 0,\n\t\t\t\tlastActivity: new Date(),\n\t\t\t\tsocialScore: 0,\n\t\t\t\tisActive: true,\n\t\t\t\tcreatedAt: new Date()\n\t\t\t};\n\n\t\t\twatchAccounts = [...watchAccounts, newAccount];\n\n\t\t\t// Reset form\n\t\t\tnewAccountForm = {\n\t\t\t\taddress: '',\n\t\t\t\talias: '',\n\t\t\t\tblockchain: 'ethereum',\n\t\t\t\taccountType: 'personal',\n\t\t\t\tcategory: '',\n\t\t\t\ttags: [],\n\t\t\t\tnotifications: {\n\t\t\t\t\tlargeTransactions: true,\n\t\t\t\t\tbalanceChanges: false,\n\t\t\t\t\tsocialActivity: false\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// TODO: Save to storage/API\n\t\t\tlog.info('Added new watch account:', false, newAccount);\n\n\t\t} catch (err) {\n\t\t\terror = 'Failed to add watch account';\n\t\t\tlog.error('Error adding watch account:', false, err);\n\t\t}\n\t}\n\n\tfunction removeWatchAccount(accountId: string) {\n\t\twatchAccounts = watchAccounts.filter(acc => acc.id !== accountId);\n\t\tif (selectedAccount?.id === accountId) {\n\t\t\tselectedAccount = null;\n\t\t}\n\t\t// TODO: Update storage/API\n\t}\n\n\tfunction selectAccount(account: WatchAccount) {\n\t\tselectedAccount = account;\n\t\tactiveTab = 'analytics';\n\t}\n\n\tfunction addTag(tag: string) {\n\t\tif (tag.trim() && !newAccountForm.tags.includes(tag.trim())) {\n\t\t\tnewAccountForm.tags = [...newAccountForm.tags, tag.trim()];\n\t\t}\n\t}\n\n\tfunction removeTag(index: number) {\n\t\tnewAccountForm.tags = newAccountForm.tags.filter((_, i) => i !== index);\n\t}\n\n\tfunction formatBalance(value: number): string {\n\t\tif (value >= 1000000) {\n\t\t\treturn `$${(value / 1000000).toFixed(2)}M`;\n\t\t}\n\t\tif (value >= 1000) {\n\t\t\treturn `$${(value / 1000).toFixed(1)}K`;\n\t\t}\n\t\treturn `$${value.toFixed(2)}`;\n\t}\n\n\tfunction getAccountTypeInfo(type: string) {\n\t\treturn accountTypes.find(t => t.id === type) || accountTypes[0];\n\t}\n\n\tfunction getActivityColor(activity: string): string {\n\t\tswitch (activity) {\n\t\t\tcase 'whale': return 'text-purple-600 bg-purple-100';\n\t\t\tcase 'high': return 'text-red-600 bg-red-100';\n\t\t\tcase 'medium': return 'text-orange-600 bg-orange-100';\n\t\t\tcase 'low': return 'text-green-600 bg-green-100';\n\t\t\tdefault: return 'text-gray-600 bg-gray-100';\n\t\t}\n\t}\n\n\tfunction handleClose() {\n\t\terror = '';\n\t\tselectedAccount = null;\n\t\tactiveTab = 'accounts';\n\t\tonClose();\n\t}\n\n\tfunction handleComplete() {\n\t\tonComplete?.();\n\t\thandleClose();\n\t}\n</script>\n\n{#if show}\n\t<Modal \n\t\ttitle=\"Watcher - Portfolio Tracking & Social Intelligence\" \n\t\tshow={true} \n\t\tonClose={handleClose}\n\t\tsize=\"xl\"\n\t>\n\t\t{#snippet body()}\n\t\t\t<div class=\"flex h-[600px]\">\n\t\t\t\t<!-- Sidebar Navigation -->\n\t\t\t\t<div class=\"w-48 bg-gray-50 border-r border-gray-200 p-4\">\n\t\t\t\t\t<nav class=\"space-y-2\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tonclick={() => activeTab = 'accounts'}\n\t\t\t\t\t\t\tclass=\"w-full text-left px-3 py-2 rounded-md text-sm font-medium transition-colors {activeTab === 'accounts' ? 'bg-indigo-100 text-indigo-700' : 'text-gray-600 hover:bg-gray-100'}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t Watch Accounts\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tonclick={() => activeTab = 'analytics'}\n\t\t\t\t\t\t\tclass=\"w-full text-left px-3 py-2 rounded-md text-sm font-medium transition-colors {activeTab === 'analytics' ? 'bg-indigo-100 text-indigo-700' : 'text-gray-600 hover:bg-gray-100'}\"\n\t\t\t\t\t\t\tdisabled={!selectedAccount}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t Analytics\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tonclick={() => activeTab = 'social'}\n\t\t\t\t\t\t\tclass=\"w-full text-left px-3 py-2 rounded-md text-sm font-medium transition-colors {activeTab === 'social' ? 'bg-indigo-100 text-indigo-700' : 'text-gray-600 hover:bg-gray-100'}\"\n\t\t\t\t\t\t\tdisabled={!selectedAccount}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t Social Intel\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tonclick={() => activeTab = 'alerts'}\n\t\t\t\t\t\t\tclass=\"w-full text-left px-3 py-2 rounded-md text-sm font-medium transition-colors {activeTab === 'alerts' ? 'bg-indigo-100 text-indigo-700' : 'text-gray-600 hover:bg-gray-100'}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t Alerts\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</nav>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Main Content -->\n\t\t\t\t<div class=\"flex-1 p-6\">\n\t\t\t\t\t{#if error}\n\t\t\t\t\t\t<div class=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-md\">\n\t\t\t\t\t\t\t<p class=\"text-red-700 text-sm\">{error}</p>\n\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\tonclick={() => error = ''}\n\t\t\t\t\t\t\t\tclass=\"text-red-600 hover:text-red-800 text-xs underline mt-1\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tDismiss\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if activeTab === 'accounts'}\n\t\t\t\t\t\t<!-- Watch Accounts Management -->\n\t\t\t\t\t\t<div class=\"space-y-6\">\n\t\t\t\t\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t<h3 class=\"text-lg font-semibold text-gray-900\">Watch Accounts</h3>\n\t\t\t\t\t\t\t\t<span class=\"text-sm text-gray-500\">{watchAccounts.length} accounts</span>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<!-- Add New Account Form -->\n\t\t\t\t\t\t\t<div class=\"bg-gray-50 p-4 rounded-lg\">\n\t\t\t\t\t\t\t\t<h4 class=\"font-medium text-gray-900 mb-3\">Add New Watch Account</h4>\n\t\t\t\t\t\t\t\t<div class=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<label for=\"watcher-address\" class=\"block text-sm font-medium text-gray-700 mb-1\">Address</label>\n\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\tid=\"watcher-address\"\n\t\t\t\t\t\t\t\t\t\t\tbind:value={newAccountForm.address}\n\t\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"0x... or wallet address\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<label for=\"watcher-alias\" class=\"block text-sm font-medium text-gray-700 mb-1\">Alias</label>\n\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\tid=\"watcher-alias\"\n\t\t\t\t\t\t\t\t\t\t\tbind:value={newAccountForm.alias}\n\t\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"Display name\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<label for=\"watcher-blockchain\" class=\"block text-sm font-medium text-gray-700 mb-1\">Blockchain</label>\n\t\t\t\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\t\t\t\tid=\"watcher-blockchain\"\n\t\t\t\t\t\t\t\t\t\t\tbind:value={newAccountForm.blockchain}\n\t\t\t\t\t\t\t\t\t\t\tclass=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{#each supportedBlockchains as blockchain}\n\t\t\t\t\t\t\t\t\t\t\t\t<option value={blockchain.id}>{blockchain.name} ({blockchain.symbol})</option>\n\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<label for=\"watcher-account-type\" class=\"block text-sm font-medium text-gray-700 mb-1\">Account Type</label>\n\t\t\t\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\t\t\t\tid=\"watcher-account-type\"\n\t\t\t\t\t\t\t\t\t\t\tbind:value={newAccountForm.accountType}\n\t\t\t\t\t\t\t\t\t\t\tclass=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{#each accountTypes as type}\n\t\t\t\t\t\t\t\t\t\t\t\t<option value={type.id}>{type.icon} {type.name}</option>\n\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"mt-4 flex gap-2\">\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\tid=\"watcher-tags\"\n\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"Add tags (press Enter)\"\n\t\t\t\t\t\t\t\t\t\taria-label=\"Add tags for the watch account\"\n\t\t\t\t\t\t\t\t\t\tclass=\"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n\t\t\t\t\t\t\t\t\t\tonkeydown={(e) => {\n\t\t\t\t\t\t\t\t\t\t\tif (e.key === 'Enter') {\n\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\taddTag(e.currentTarget.value);\n\t\t\t\t\t\t\t\t\t\t\t\te.currentTarget.value = '';\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tonclick={addWatchAccount}\n\t\t\t\t\t\t\t\t\t\tclass=\"px-4 py-2 bg-indigo-600 text-white rounded-md text-sm hover:bg-indigo-700 transition-colors\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tAdd Account\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{#if newAccountForm.tags.length > 0}\n\t\t\t\t\t\t\t\t\t<div class=\"mt-2 flex flex-wrap gap-1\">\n\t\t\t\t\t\t\t\t\t\t{#each newAccountForm.tags as tag, index}\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"inline-flex items-center gap-1 px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t{tag}\n\t\t\t\t\t\t\t\t\t\t\t\t<button onclick={() => removeTag(index)} class=\"text-indigo-500 hover:text-indigo-700\"></button>\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<!-- Watch Accounts List -->\n\t\t\t\t\t\t\t<div class=\"space-y-3\">\n\t\t\t\t\t\t\t\t{#if isLoading}\n\t\t\t\t\t\t\t\t\t<div class=\"flex justify-center py-8\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"animate-spin rounded-full h-8 w-8 border-2 border-indigo-500 border-t-transparent\"></div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{:else if watchAccounts.length === 0}\n\t\t\t\t\t\t\t\t\t<div class=\"text-center py-8 text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t<p>No watch accounts added yet</p>\n\t\t\t\t\t\t\t\t\t\t<p class=\"text-sm\">Add accounts above to start tracking portfolios and social activity</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t{#each watchAccounts as account}\n\t\t\t\t\t\t\t\t\t\t<div class=\"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"text-2xl\">{getAccountTypeInfo(account.accountType).icon}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"font-medium text-gray-900\">{account.alias}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"text-sm text-gray-500 font-mono\">{account.address.slice(0, 10)}...{account.address.slice(-8)}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-2 mt-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs\">{account.blockchain}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs\">{getAccountTypeInfo(account.accountType).name}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{#each account.tags as tag}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-xs\">{tag}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"text-right\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#if account.portfolioValue}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"font-semibold text-gray-900\">{formatBalance(account.portfolioValue)}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#if account.socialScore}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"text-sm text-gray-500\">Social: {account.socialScore}/100</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex gap-2 mt-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<SimpleTooltip content=\"View analytics\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick={() => selectAccount(account)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"px-3 py-1 bg-indigo-100 text-indigo-700 rounded text-xs hover:bg-indigo-200\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAnalyze\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</SimpleTooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<SimpleTooltip content=\"Remove account\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick={() => removeWatchAccount(account.id)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"px-3 py-1 bg-red-100 text-red-700 rounded text-xs hover:bg-red-200\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tRemove\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</SimpleTooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t{:else if activeTab === 'analytics' && selectedAccount}\n\t\t\t\t\t\t<!-- Analytics View -->\n\t\t\t\t\t\t<div class=\"space-y-6\">\n\t\t\t\t\t\t\t<div class=\"flex items-center gap-3\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tonclick={() => activeTab = 'accounts'}\n\t\t\t\t\t\t\t\t\tclass=\"text-indigo-600 hover:text-indigo-800\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t Back\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<h3 class=\"text-lg font-semibold text-gray-900\">Analytics: {selectedAccount.alias}</h3>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\"grid grid-cols-3 gap-4\">\n\t\t\t\t\t\t\t\t<div class=\"bg-gradient-to-r from-blue-500 to-blue-600 p-4 rounded-lg text-white\">\n\t\t\t\t\t\t\t\t\t<div class=\"text-sm opacity-90\">Portfolio Value</div>\n\t\t\t\t\t\t\t\t\t<div class=\"text-2xl font-bold\">{formatBalance(selectedAccount.portfolioValue || 0)}</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"bg-gradient-to-r from-green-500 to-green-600 p-4 rounded-lg text-white\">\n\t\t\t\t\t\t\t\t\t<div class=\"text-sm opacity-90\">Social Score</div>\n\t\t\t\t\t\t\t\t\t<div class=\"text-2xl font-bold\">{selectedAccount.socialScore || 0}/100</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"bg-gradient-to-r from-purple-500 to-purple-600 p-4 rounded-lg text-white\">\n\t\t\t\t\t\t\t\t\t<div class=\"text-sm opacity-90\">Account Type</div>\n\t\t\t\t\t\t\t\t\t<div class=\"text-lg font-semibold\">{getAccountTypeInfo(selectedAccount.accountType).name}</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\"text-center py-12 text-gray-500\">\n\t\t\t\t\t\t\t\t<p> Advanced portfolio analytics coming soon</p>\n\t\t\t\t\t\t\t\t<p class=\"text-sm\">Balance trends, transaction analysis, and performance metrics</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t{:else if activeTab === 'social' && selectedAccount}\n\t\t\t\t\t\t<!-- Social Intelligence View -->\n\t\t\t\t\t\t<div class=\"space-y-6\">\n\t\t\t\t\t\t\t<div class=\"flex items-center gap-3\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tonclick={() => activeTab = 'accounts'}\n\t\t\t\t\t\t\t\t\tclass=\"text-indigo-600 hover:text-indigo-800\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t Back\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<h3 class=\"text-lg font-semibold text-gray-900\">Social Intelligence: {selectedAccount.alias}</h3>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{#if socialData.has(selectedAccount.id)}\n\t\t\t\t\t\t\t\t{@const social = socialData.get(selectedAccount.id)}\n\t\t\t\t\t\t\t\t<div class=\"grid grid-cols-2 gap-6\">\n\t\t\t\t\t\t\t\t\t<div class=\"space-y-4\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"bg-white border border-gray-200 rounded-lg p-4\">\n\t\t\t\t\t\t\t\t\t\t\t<h4 class=\"font-medium text-gray-900 mb-3\">Influence Metrics</h4>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-sm text-gray-600\">Copy Traders</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"font-medium\">{social.influenceMetrics.copyTraders.toLocaleString()}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-sm text-gray-600\">Portfolio Mirrors</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"font-medium\">{social.influenceMetrics.portfolioMirrors.toLocaleString()}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-sm text-gray-600\">Social Mentions</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"font-medium\">{social.influenceMetrics.socialMentions.toLocaleString()}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t<div class=\"bg-white border border-gray-200 rounded-lg p-4\">\n\t\t\t\t\t\t\t\t\t\t\t<h4 class=\"font-medium text-gray-900 mb-3\">Trading Activity</h4>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"px-2 py-1 rounded text-sm font-medium {getActivityColor(social.tradingActivity)}\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{social.tradingActivity.toUpperCase()}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-sm text-gray-600\">activity level</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"mt-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-sm text-gray-600\">Reputation Score: </span>\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"font-medium\">{social.reputationScore}/100</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class=\"space-y-4\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"bg-white border border-gray-200 rounded-lg p-4\">\n\t\t\t\t\t\t\t\t\t\t\t<h4 class=\"font-medium text-gray-900 mb-3\">Recent Activity</h4>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"space-y-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t{#each social.recentTransactions as tx}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center justify-between p-2 bg-gray-50 rounded\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-lg\">{tx.direction === 'in' ? '' : ''}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"font-medium text-sm\">{formatBalance(tx.amount)}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"text-xs text-gray-500\">{tx.timestamp.toLocaleTimeString()}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"px-2 py-1 bg-orange-100 text-orange-700 rounded text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tx.significance}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<div class=\"text-center py-12 text-gray-500\">\n\t\t\t\t\t\t\t\t\t<p> Social intelligence data not available</p>\n\t\t\t\t\t\t\t\t\t<p class=\"text-sm\">Connect social data sources to see influence metrics</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t{:else if activeTab === 'alerts'}\n\t\t\t\t\t\t<!-- Alerts Configuration -->\n\t\t\t\t\t\t<div class=\"space-y-6\">\n\t\t\t\t\t\t\t<h3 class=\"text-lg font-semibold text-gray-900\">Alert Configuration</h3>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<div class=\"text-center py-12 text-gray-500\">\n\t\t\t\t\t\t\t\t<p> Smart alerts coming soon</p>\n\t\t\t\t\t\t\t\t<p class=\"text-sm\">Large transactions, social activity, and portfolio changes</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/snippet}\n\n\t\t{#snippet footer()}\n\t\t\t<div class=\"flex justify-between\">\n\t\t\t\t<div class=\"text-sm text-gray-500\">\n\t\t\t\t\t{#if activeTab === 'accounts'}\n\t\t\t\t\t\tPro feature: Advanced portfolio tracking & social intelligence\n\t\t\t\t\t{:else if selectedAccount}\n\t\t\t\t\t\tAnalyzing: {selectedAccount.alias}\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"flex gap-3\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tonclick={handleClose}\n\t\t\t\t\t\tclass=\"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50\"\n\t\t\t\t\t>\n\t\t\t\t\t\tClose\n\t\t\t\t\t</button>\n\t\t\t\t\t{#if activeTab === 'accounts'}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tonclick={handleComplete}\n\t\t\t\t\t\t\tclass=\"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tSave Changes\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/snippet}\n\t</Modal>\n{/if}","<!-- WatchList.svelte - Legacy wrapper for new Watcher component -->\n<script lang=\"ts\">\n\timport Watcher from './Watcher.svelte';\n\n\tinterface Props {\n\t\tshow?: boolean;\n\t\tonClose?: () => void;\n\t\tonComplete?: () => void;\n\t}\n\n\tlet {\n\t\tshow = $bindable(false),\n\t\tonClose = () => (show = false),\n\t\tonComplete = () => {}\n\t}: Props = $props();\n</script>\n\n<!-- Use the new advanced Watcher component -->\n<Watcher\n\tbind:show={show}\n\tonClose={onClose}\n\tonComplete={onComplete}\n/>","<script lang=\"ts\">\n\timport { goto } from '$app/navigation';\n\timport { PATH_LOGOUT } from '$lib/common';\n\timport { showProfileSettingsModal } from '$lib/common/stores/ui';\n\timport Avatar from './Avatar.svelte';\n\timport Profile from './Profile.svelte';\n\timport Settings from './Settings.svelte';\n\timport WatchList from './WatchList.svelte';\n\timport SimpleTooltip from './SimpleTooltip.svelte';\n\timport { onMount, onDestroy } from 'svelte';\n\timport { getSettings } from '$lib/common/stores';\n\timport { shouldShowProFeatures } from '$lib/common/token-analytics';\n\timport { PlanType } from '$lib/common/types';\n\timport type { Settings } from '$lib/common/interfaces';\n\n\tconst props = $props<{\n\t\tuserName?: string;\n\t\tavatarUrl?: string;\n\t}>();\n\n\tlet showProfileModal = $state(false);\n\tlet showSettingsModal = $state(false);\n\tlet showWatchListModal = $state(false);\n\tlet offcanvasElement: HTMLElement;\n\tlet isHoveringMenu = $state(false);\n\tlet hoverTimeout: number | null = null;\n\tlet settings: Settings | null = null;\n\tlet isProUser = $state(false);\n\n\tonMount(async () => {\n\t\t// Load settings to check membership\n\t\tsettings = await getSettings();\n\t\tisProUser = shouldShowProFeatures(settings?.plan?.type || PlanType.BASIC_MEMBER);\n\n\t\t// Add click outside listener (browser only)\n\t\tif (typeof window !== 'undefined') {\n\t\t\tsetupClickOutsideListener();\n\t\t}\n\t});\n\n\tonDestroy(() => {\n\t\t// Cleanup event listeners (browser only)\n\t\tif (typeof window !== 'undefined' && typeof document !== 'undefined') {\n\t\t\tdocument.removeEventListener('click', handleClickOutside);\n\t\t}\n\t\t// Cleanup hover timeout\n\t\tif (hoverTimeout) {\n\t\t\tclearTimeout(hoverTimeout);\n\t\t}\n\t});\n\n\tfunction setupClickOutsideListener() {\n\t\tif (typeof document !== 'undefined') {\n\t\t\tdocument.addEventListener('click', handleClickOutside);\n\t\t}\n\t}\n\n\tfunction handleClickOutside(event: MouseEvent) {\n\t\tif (!offcanvasElement) return;\n\t\t\n\t\tconst target = event.target as HTMLElement;\n\t\tconst isOffcanvasVisible = offcanvasElement.classList.contains('show');\n\t\t\n\t\t// Check if click is outside the offcanvas and not on a trigger button\n\t\tconst isClickOutside = !offcanvasElement.contains(target);\n\t\tconst isNotTrigger = !target.closest('[data-bs-toggle=\"offcanvas\"][data-bs-target=\"#offcanvasProfileMenu\"]');\n\t\t\n\t\tif (isOffcanvasVisible && isClickOutside && isNotTrigger) {\n\t\t\tcloseOffcanvas();\n\t\t}\n\t}\n\n\tfunction closeOffcanvas() {\n\t\tif (typeof window !== 'undefined' && window.bootstrap) {\n\t\t\tconst offcanvasInstance = window.bootstrap.Offcanvas.getInstance(offcanvasElement);\n\t\t\tif (offcanvasInstance) {\n\t\t\t\toffcanvasInstance.hide();\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction handleMenuMouseEnter() {\n\t\tisHoveringMenu = true;\n\t\tif (hoverTimeout) {\n\t\t\tclearTimeout(hoverTimeout);\n\t\t\thoverTimeout = null;\n\t\t}\n\t}\n\n\tfunction handleMenuMouseLeave() {\n\t\tisHoveringMenu = false;\n\t\t// Start timeout to close menu when mouse leaves\n\t\thoverTimeout = setTimeout(() => {\n\t\t\tcloseOffcanvas();\n\t\t}, 500) as unknown as number; // 500ms delay when leaving menu\n\t}\n\n\tfunction handleLogout() {\n\t\tgoto(PATH_LOGOUT);\n\t}\n\n\tfunction openProfile() {\n\t\tshowProfileModal = true;\n\t}\n\n\tfunction openSettings() {\n\t\tshowSettingsModal = true;\n\t}\n\n\tfunction openWatchList() {\n\t\tif (!isProUser) return;\n\t\tshowWatchListModal = true;\n\t}\n\n\tfunction handleProfileComplete() {\n\t\t// Refresh page or update stores as needed\n\t\tshowProfileModal = false;\n\t}\n\n\tfunction handleSettingsComplete() {\n\t\t// Refresh page or update stores as needed\n\t\tshowSettingsModal = false;\n\t}\n\n\tfunction handleWatchListComplete() {\n\t\t// Refresh page or update stores as needed\n\t\tshowWatchListModal = false;\n\t}\n</script>\n\n<div\n\tbind:this={offcanvasElement}\n\tclass=\"z-100 offcanvas offcanvas-end top-0 right-0 fixed bottom-auto flex flex-col min-w-[200px] max-w-[280px] font-sans antialiased invisible bg-clip-padding shadow-sm outline-none transition duration-300 ease-in-out border-none rounded-l-md bg-primary text-base-content\"\n\ttabindex=\"-1\"\n\tid=\"offcanvasProfileMenu\"\n\taria-labelledby=\"offcanvasProfileMenuLabel\"\n\trole=\"dialog\"\n\taria-modal=\"true\"\n\tonmouseenter={handleMenuMouseEnter}\n\tonmouseleave={handleMenuMouseLeave}\n>\n\t<!-- Header -->\n\t<div class=\"offcanvas-header flex items-center justify-between px-4 pt-2 pb-2 bg-primary-200\">\n\t\t<h5 class=\"offcanvas-title font-semibold\" id=\"offcanvasProfileMenuLabel\">Profile</h5>\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tclass=\"text-base-content opacity-60 hover:opacity-100\"\n\t\t\tdata-bs-dismiss=\"offcanvas\"\n\t\t\taria-label=\"Close\"\n\t\t>\n\t\t\t<svg\n\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\tclass=\"w-5 h-5\"\n\t\t\t\tfill=\"none\"\n\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\tstroke=\"currentColor\"\n\t\t\t\tstroke-width=\"2\"\n\t\t\t>\n\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6 18L18 6M6 6l12 12\" />\n\t\t\t</svg>\n\t\t</button>\n\t</div>\n\n\t<hr class=\"my-1 border-base-content/20\" />\n\n\t<!-- User Info -->\n\t<div class=\"flex items-center gap-3 px-4 py-3\">\n\t\t<Avatar\n\t\t\turl={props.avatarUrl}\n\t\t\tariaLabel=\"Profile\"\n\t\t\tclassName=\"w-10 h-10 rounded-full ring-2 ring-offset-1\"\n\t\t/>\n\t\t<div class=\"text-sm font-semibold\">{props.userName ?? 'Anonymous Yakker'}</div>\n\t</div>\n\n\t<hr class=\"my-1 border-base-content/20\" />\n\n\t<!-- Menu Items -->\n\t<ul class=\"px-2 space-y-1\">\n\t\t<li data-bs-dismiss=\"offcanvas\">\n\t\t\t<button\n\t\t\t\tonclick={openProfile}\n\t\t\t\tclass=\"w-full text-left px-4 py-2 rounded-md text-sm hover:bg-primary-100 transition\"\n\t\t\t>\n\t\t\t\t Profile\n\t\t\t</button>\n\t\t</li>\n\t\t<li data-bs-dismiss=\"offcanvas\">\n\t\t\t<button\n\t\t\t\tonclick={openSettings}\n\t\t\t\tclass=\"w-full text-left px-4 py-2 rounded-md text-sm hover:bg-primary-100 transition\"\n\t\t\t>\n\t\t\t\t Account Settings\n\t\t\t</button>\n\t\t</li>\n\t\t<li data-bs-dismiss={isProUser ? \"offcanvas\" : \"\"}>\n\t\t\t{#if isProUser}\n\t\t\t\t<button\n\t\t\t\t\tonclick={openWatchList}\n\t\t\t\t\tclass=\"w-full text-left px-4 py-2 rounded-md text-sm hover:bg-primary-100 transition flex items-center gap-2\"\n\t\t\t\t>\n\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t<path d=\"M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9M12,4.5C17,4.5 21.27,7.61 23,12C21.27,16.39 17,19.5 12,19.5C7,19.5 2.73,16.39 1,12C2.73,7.61 7,4.5 12,4.5M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7Z\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t\tWatch Accounts\n\t\t\t\t</button>\n\t\t\t{:else}\n\t\t\t\t<SimpleTooltip content=\"Upgrade to Pro for portfolio tracking, whale watching, and social trading intelligence\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tdisabled\n\t\t\t\t\t\tclass=\"w-full text-left px-4 py-2 rounded-md text-sm text-gray-400 cursor-not-allowed flex items-center gap-2\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path d=\"M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9M12,4.5C17,4.5 21.27,7.61 23,12C21.27,16.39 17,19.5 12,19.5C7,19.5 2.73,16.39 1,12C2.73,7.61 7,4.5 12,4.5M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7Z\"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\tWatch Accounts\n\t\t\t\t\t\t<div class=\"w-3 h-3 bg-gradient-to-r from-indigo-400 to-purple-400 rounded-full flex items-center justify-center ml-auto\">\n\t\t\t\t\t\t\t<svg class=\"w-2 h-2 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n\t\t\t\t\t\t\t\t<path fill-rule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clip-rule=\"evenodd\" />\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\t\t\t\t</SimpleTooltip>\n\t\t\t{/if}\n\t\t</li>\n\t\t<li data-bs-dismiss=\"offcanvas\">\n\t\t\t<button\n\t\t\t\tonclick={handleLogout}\n\t\t\t\tclass=\"w-full text-left px-4 py-2 rounded-md text-sm text-red-600 hover:text-red-800 hover:bg-primary-100 transition\"\n\t\t\t>\n\t\t\t\t Logout\n\t\t\t</button>\n\t\t</li>\n\t</ul>\n\n\t<hr class=\"my-1 border-base-content/20\" />\n\n\t<div class=\"text-center py-2 bg-primary\">\n\t\t<a\n\t\t\tclass=\"text-sm font-semibold text-base-content hover:underline\"\n\t\t\thref=\"https://yakkl.com/?utm_source=yakkl&utm_medium=extension&utm_campaign=extension&utm_content=profile&utm_term=extension\"\n\t\t\ttarget=\"_blank\"\n\t\t\trel=\"noreferrer\"\n\t\t>\n\t\t\tyakkl.com\n\t\t</a>\n\t</div>\n</div>\n\n<!-- Profile and Settings Modals -->\n<Profile\n\tbind:show={showProfileModal}\n\tonComplete={handleProfileComplete}\n\tonClose={() => (showProfileModal = false)}\n/>\n\n<Settings\n\tbind:show={showSettingsModal}\n\tonComplete={handleSettingsComplete}\n\tonClose={() => (showSettingsModal = false)}\n/>\n\n<WatchList\n\tbind:show={showWatchListModal}\n\tonComplete={handleWatchListComplete}\n\tonClose={() => (showWatchListModal = false)}\n/>\n","<script lang=\"ts\">\n\timport { onMount } from 'svelte';\n\timport { identicon } from '$lib/utilities';\n\timport { getYakklCurrentlySelected, getProfile, getSettings } from '$lib/common/stores';\n\timport { safeLogout } from '$lib/common/safeNavigate';\n\timport { ExtensionContext } from '$lib/common/shared/BrowserAccessor';\n\timport { browser_ext, browserSvelte } from '$lib/common/environment';\n\timport { BrowserAccessor } from '$lib/common/shared/BrowserAccessor';\n\timport Share from '$lib/components/Share.svelte';\n\timport ImageBar from '$lib/components/ImageBar.svelte';\n\timport PlanBadge from '$lib/components/PlanBadge.svelte';\n\timport OffcanvasMainMenu from './OffcanvasMainMenu.svelte';\n\timport GraduationCapButton from './icons/GraduationCapButton.svelte';\n\timport { log } from '$lib/managers/Logger';\n\timport SimpleTooltip from './SimpleTooltip.svelte';\n\timport OffcanvasProfileMenu from './OffcanvasProfileMenu.svelte';\n\timport Avatar from './Avatar.svelte';\n\timport { goto } from '$app/navigation';\n\timport type { Profile, Settings, ProfileData } from '$lib/common/interfaces';\n\timport { decryptData } from '$lib/common/encryption';\n\timport { isEncryptedData } from '$lib/common/misc';\n\timport { yakklMiscStore } from '$lib/common/stores';\n\timport { get } from 'svelte/store';\n\n\tlet browserContext: ExtensionContext;\n\tlet address = '';\n\tlet imageSRC = '';\n\tlet userName = '';\n\tlet avatarUrl = '';\n\tlet browserAccessor = BrowserAccessor.getInstance();\n\n\tlet hoverTimeoutMain: number | null = null;\n\tlet hoverTimeoutProfile: number | null = null;\n\n\tonMount(async () => {\n\t\ttry {\n\t\t\tbrowserContext = await browserAccessor.getContext();\n\t\t\tconst current = await getYakklCurrentlySelected();\n\t\t\taddress = current.shortcuts.address;\n\t\t\timageSRC = identicon(address || 'default');\n\n\t\t\t// Get profile data for username and avatar\n\t\t\tconst profile = await getProfile();\n\t\t\tif (profile) {\n\t\t\t\tuserName = profile.userName || 'Anonymous Yakker';\n\n\t\t\t\t// Check if profile data is encrypted and decrypt if needed\n\t\t\t\tlet profileData: ProfileData;\n\t\t\t\tif (isEncryptedData(profile.data)) {\n\t\t\t\t\tconst miscStore = get(yakklMiscStore);\n\t\t\t\t\tif (miscStore) {\n\t\t\t\t\t\tprofileData = await decryptData(profile.data, miscStore) as ProfileData;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tprofileData = { name: { first: '', last: '' }, email: '', registered: {} } as ProfileData;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tprofileData = profile.data as ProfileData;\n\t\t\t\t}\n\n\t\t\t\t// Set avatar URL - could be from profile data or fallback to identicon\n\t\t\t\tavatarUrl = (profileData.meta as any)?.avatarUrl || imageSRC;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tlog.warn('Error loading profile data in Header:', false, e);\n\t\t\tuserName = 'Anonymous Yakker';\n\t\t\tavatarUrl = imageSRC;\n\t\t}\n\t});\n\n\tfunction handlePopout() {\n\t\tif (browserSvelte) {\n\t\t\tbrowser_ext.runtime.sendMessage({ type: 'popout' });\n\t\t\tsafeLogout();\n\t\t}\n\t}\n\n\tfunction showOffcanvasMain() {\n\t\tif (typeof window !== 'undefined' && (window as any).bootstrap) {\n\t\t\tconst element = document.getElementById('offcanvasMainMenu');\n\t\t\tif (element) {\n\t\t\t\tconst offcanvasInstance = (window as any).bootstrap.Offcanvas.getOrCreateInstance(element);\n\t\t\t\toffcanvasInstance.show();\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction hideOffcanvasMain() {\n\t\tif (typeof window !== 'undefined' && (window as any).bootstrap) {\n\t\t\tconst element = document.getElementById('offcanvasMainMenu');\n\t\t\tif (element) {\n\t\t\t\tconst offcanvasInstance = (window as any).bootstrap.Offcanvas.getInstance(element);\n\t\t\t\tif (offcanvasInstance) {\n\t\t\t\t\toffcanvasInstance.hide();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction showOffcanvasProfile() {\n\t\tif (typeof window !== 'undefined' && (window as any).bootstrap) {\n\t\t\tconst element = document.getElementById('offcanvasProfileMenu');\n\t\t\tif (element) {\n\t\t\t\tconst offcanvasInstance = (window as any).bootstrap.Offcanvas.getOrCreateInstance(element);\n\t\t\t\toffcanvasInstance.show();\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction hideOffcanvasProfile() {\n\t\tif (typeof window !== 'undefined' && (window as any).bootstrap) {\n\t\t\tconst element = document.getElementById('offcanvasProfileMenu');\n\t\t\tif (element) {\n\t\t\t\tconst offcanvasInstance = (window as any).bootstrap.Offcanvas.getInstance(element);\n\t\t\t\tif (offcanvasInstance) {\n\t\t\t\t\toffcanvasInstance.hide();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction handleMainMenuHover() {\n\t\tif (hoverTimeoutMain) {\n\t\t\tclearTimeout(hoverTimeoutMain);\n\t\t\thoverTimeoutMain = null;\n\t\t}\n\t\t// Small delay to prevent immediate showing on quick mouse movements\n\t\tsetTimeout(() => {\n\t\t\tshowOffcanvasMain();\n\t\t}, 100);\n\t}\n\n\tfunction handleMainMenuLeave() {\n\t\t// Don't set timeout here, let the menu handle its own timeout\n\t}\n\n\tfunction handleProfileMenuHover() {\n\t\tif (hoverTimeoutProfile) {\n\t\t\tclearTimeout(hoverTimeoutProfile);\n\t\t\thoverTimeoutProfile = null;\n\t\t}\n\t\t// Small delay to prevent immediate showing on quick mouse movements\n\t\tsetTimeout(() => {\n\t\t\tshowOffcanvasProfile();\n\t\t}, 100);\n\t}\n\n\tfunction handleProfileMenuLeave() {\n\t\t// Don't set timeout here, let the menu handle its own timeout\n\t}\n</script>\n\n<ImageBar>\n\t<nav class=\"grid grid-cols-[1fr,2fr,1fr] items-center w-full py-2 px-2 gap-0\">\n\t\t<!-- Left Icon -->\n\t\t<div class=\"flex items-center justify-start gap-4\">\n\t\t\t<SimpleTooltip content=\"Open the main menu\" position=\"right\">\n\t\t\t\t<a\n\t\t\t\t\tdata-bs-toggle=\"offcanvas\"\n\t\t\t\t\thref=\"#offcanvasMainMenu\"\n\t\t\t\t\taria-controls=\"offcanvasMainMenu\"\n\t\t\t\t\trole=\"button\"\n\t\t\t\t\taria-label=\"Menu\"\n\t\t\t\t\tonmouseenter={handleMainMenuHover}\n\t\t\t\t\tonmouseleave={handleMainMenuLeave}\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tclass=\"w-7 h-7 fill-gray-100 hover:fill-gray-400\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\td=\"M3 5.25a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 5.25zm0 4.5A.75.75 0 013.75 9h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 9.75zm0 4.5a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75a.75.75 0 01-.75-.75zm0 4.5a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75a.75.75 0 01-.75-.75z\"\n\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</a>\n\t\t\t</SimpleTooltip>\n\t\t\t<SimpleTooltip content=\"YAKKL University\" position=\"bottom\">\n\t\t\t\t<GraduationCapButton />\n\t\t\t</SimpleTooltip>\n\t\t\t<!-- New Wallet Demo Button -->\n\t\t\t<SimpleTooltip content=\"Preview new wallet design\" position=\"bottom\">\n\t\t\t\t<button\n\t\t\t\t\tonclick={() => goto('/preview2')}\n\t\t\t\t\tclass=\"flex items-center justify-center w-8 h-8 bg-gradient-to-r from-purple-500 to-indigo-600 rounded-full shadow-md hover:from-purple-600 hover:to-indigo-700 transition-all\"\n\t\t\t\t\taria-label=\"Preview new design\"\n\t\t\t\t>\n\t\t\t\t\t<svg class=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\" />\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t</SimpleTooltip>\n\t\t</div>\n\n\t\t<!-- Center Badge -->\n\t\t<div class=\"flex items-center justify-center\">\n\t\t\t<PlanBadge />\n\t\t</div>\n\n\t\t<!-- Right Icons -->\n\t\t<div class=\"flex items-center justify-end gap-4\">\n\t\t\t<Share />\n\t\t\t{#if browserContext === ExtensionContext.SIDEPANEL}\n\t\t\t\t<button onclick={handlePopout} aria-label=\"Popout\">\n\t\t\t\t\t<!-- popout icon -->\n\t\t\t\t</button>\n\t\t\t{:else}\n\t\t\t\t<SimpleTooltip content=\"Open the profile menu\" position=\"bottom\">\n\t\t\t\t\t<a\n\t\t\t\t\t\tdata-bs-toggle=\"offcanvas\"\n\t\t\t\t\t\thref=\"#offcanvasProfileMenu\"\n\t\t\t\t\t\taria-controls=\"offcanvasProfileMenu\"\n\t\t\t\t\t\trole=\"button\"\n\t\t\t\t\t\taria-label=\"Menu\"\n\t\t\t\t\t\tonmouseenter={handleProfileMenuHover}\n\t\t\t\t\t\tonmouseleave={handleProfileMenuLeave}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Avatar\n\t\t\t\t\t\t\turl={avatarUrl}\n\t\t\t\t\t\t\tuserName={userName}\n\t\t\t\t\t\t\tariaLabel=\"Profile\"\n\t\t\t\t\t\t\tclassName=\"w-8 h-8 rounded-full ring-2 ring-offset-1\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</a>\n\t\t\t\t</SimpleTooltip>\n\t\t\t{/if}\n\t\t</div>\n\t</nav>\n</ImageBar>\n\n<OffcanvasMainMenu />\n\n<OffcanvasProfileMenu {userName} {avatarUrl} />\n","export const default_format = 'RFC3986';\nexport const formatters = {\n    RFC1738: (v) => String(v).replace(/%20/g, '+'),\n    RFC3986: (v) => String(v),\n};\nexport const RFC1738 = 'RFC1738';\nexport const RFC3986 = 'RFC3986';\n//# sourceMappingURL=formats.mjs.map","import { RFC1738 } from \"./formats.mjs\";\nconst has = Object.prototype.hasOwnProperty;\nconst is_array = Array.isArray;\nconst hex_table = (() => {\n    const array = [];\n    for (let i = 0; i < 256; ++i) {\n        array.push('%' + ((i < 16 ? '0' : '') + i.toString(16)).toUpperCase());\n    }\n    return array;\n})();\nfunction compact_queue(queue) {\n    while (queue.length > 1) {\n        const item = queue.pop();\n        if (!item)\n            continue;\n        const obj = item.obj[item.prop];\n        if (is_array(obj)) {\n            const compacted = [];\n            for (let j = 0; j < obj.length; ++j) {\n                if (typeof obj[j] !== 'undefined') {\n                    compacted.push(obj[j]);\n                }\n            }\n            // @ts-ignore\n            item.obj[item.prop] = compacted;\n        }\n    }\n}\nfunction array_to_object(source, options) {\n    const obj = options && options.plainObjects ? Object.create(null) : {};\n    for (let i = 0; i < source.length; ++i) {\n        if (typeof source[i] !== 'undefined') {\n            obj[i] = source[i];\n        }\n    }\n    return obj;\n}\nexport function merge(target, source, options = {}) {\n    if (!source) {\n        return target;\n    }\n    if (typeof source !== 'object') {\n        if (is_array(target)) {\n            target.push(source);\n        }\n        else if (target && typeof target === 'object') {\n            if ((options && (options.plainObjects || options.allowPrototypes)) ||\n                !has.call(Object.prototype, source)) {\n                target[source] = true;\n            }\n        }\n        else {\n            return [target, source];\n        }\n        return target;\n    }\n    if (!target || typeof target !== 'object') {\n        return [target].concat(source);\n    }\n    let mergeTarget = target;\n    if (is_array(target) && !is_array(source)) {\n        // @ts-ignore\n        mergeTarget = array_to_object(target, options);\n    }\n    if (is_array(target) && is_array(source)) {\n        source.forEach(function (item, i) {\n            if (has.call(target, i)) {\n                const targetItem = target[i];\n                if (targetItem && typeof targetItem === 'object' && item && typeof item === 'object') {\n                    target[i] = merge(targetItem, item, options);\n                }\n                else {\n                    target.push(item);\n                }\n            }\n            else {\n                target[i] = item;\n            }\n        });\n        return target;\n    }\n    return Object.keys(source).reduce(function (acc, key) {\n        const value = source[key];\n        if (has.call(acc, key)) {\n            acc[key] = merge(acc[key], value, options);\n        }\n        else {\n            acc[key] = value;\n        }\n        return acc;\n    }, mergeTarget);\n}\nexport function assign_single_source(target, source) {\n    return Object.keys(source).reduce(function (acc, key) {\n        acc[key] = source[key];\n        return acc;\n    }, target);\n}\nexport function decode(str, _, charset) {\n    const strWithoutPlus = str.replace(/\\+/g, ' ');\n    if (charset === 'iso-8859-1') {\n        // unescape never throws, no try...catch needed:\n        return strWithoutPlus.replace(/%[0-9a-f]{2}/gi, unescape);\n    }\n    // utf-8\n    try {\n        return decodeURIComponent(strWithoutPlus);\n    }\n    catch (e) {\n        return strWithoutPlus;\n    }\n}\nconst limit = 1024;\nexport const encode = (str, _defaultEncoder, charset, _kind, format) => {\n    // This code was originally written by Brian White for the io.js core querystring library.\n    // It has been adapted here for stricter adherence to RFC 3986\n    if (str.length === 0) {\n        return str;\n    }\n    let string = str;\n    if (typeof str === 'symbol') {\n        string = Symbol.prototype.toString.call(str);\n    }\n    else if (typeof str !== 'string') {\n        string = String(str);\n    }\n    if (charset === 'iso-8859-1') {\n        return escape(string).replace(/%u[0-9a-f]{4}/gi, function ($0) {\n            return '%26%23' + parseInt($0.slice(2), 16) + '%3B';\n        });\n    }\n    let out = '';\n    for (let j = 0; j < string.length; j += limit) {\n        const segment = string.length >= limit ? string.slice(j, j + limit) : string;\n        const arr = [];\n        for (let i = 0; i < segment.length; ++i) {\n            let c = segment.charCodeAt(i);\n            if (c === 0x2d || // -\n                c === 0x2e || // .\n                c === 0x5f || // _\n                c === 0x7e || // ~\n                (c >= 0x30 && c <= 0x39) || // 0-9\n                (c >= 0x41 && c <= 0x5a) || // a-z\n                (c >= 0x61 && c <= 0x7a) || // A-Z\n                (format === RFC1738 && (c === 0x28 || c === 0x29)) // ( )\n            ) {\n                arr[arr.length] = segment.charAt(i);\n                continue;\n            }\n            if (c < 0x80) {\n                arr[arr.length] = hex_table[c];\n                continue;\n            }\n            if (c < 0x800) {\n                arr[arr.length] = hex_table[0xc0 | (c >> 6)] + hex_table[0x80 | (c & 0x3f)];\n                continue;\n            }\n            if (c < 0xd800 || c >= 0xe000) {\n                arr[arr.length] =\n                    hex_table[0xe0 | (c >> 12)] + hex_table[0x80 | ((c >> 6) & 0x3f)] + hex_table[0x80 | (c & 0x3f)];\n                continue;\n            }\n            i += 1;\n            c = 0x10000 + (((c & 0x3ff) << 10) | (segment.charCodeAt(i) & 0x3ff));\n            arr[arr.length] =\n                hex_table[0xf0 | (c >> 18)] +\n                    hex_table[0x80 | ((c >> 12) & 0x3f)] +\n                    hex_table[0x80 | ((c >> 6) & 0x3f)] +\n                    hex_table[0x80 | (c & 0x3f)];\n        }\n        out += arr.join('');\n    }\n    return out;\n};\nexport function compact(value) {\n    const queue = [{ obj: { o: value }, prop: 'o' }];\n    const refs = [];\n    for (let i = 0; i < queue.length; ++i) {\n        const item = queue[i];\n        // @ts-ignore\n        const obj = item.obj[item.prop];\n        const keys = Object.keys(obj);\n        for (let j = 0; j < keys.length; ++j) {\n            const key = keys[j];\n            const val = obj[key];\n            if (typeof val === 'object' && val !== null && refs.indexOf(val) === -1) {\n                queue.push({ obj: obj, prop: key });\n                refs.push(val);\n            }\n        }\n    }\n    compact_queue(queue);\n    return value;\n}\nexport function is_regexp(obj) {\n    return Object.prototype.toString.call(obj) === '[object RegExp]';\n}\nexport function is_buffer(obj) {\n    if (!obj || typeof obj !== 'object') {\n        return false;\n    }\n    return !!(obj.constructor && obj.constructor.isBuffer && obj.constructor.isBuffer(obj));\n}\nexport function combine(a, b) {\n    return [].concat(a, b);\n}\nexport function maybe_map(val, fn) {\n    if (is_array(val)) {\n        const mapped = [];\n        for (let i = 0; i < val.length; i += 1) {\n            mapped.push(fn(val[i]));\n        }\n        return mapped;\n    }\n    return fn(val);\n}\n//# sourceMappingURL=utils.mjs.map","import { encode, is_buffer, maybe_map } from \"./utils.mjs\";\nimport { default_format, formatters } from \"./formats.mjs\";\nconst has = Object.prototype.hasOwnProperty;\nconst array_prefix_generators = {\n    brackets(prefix) {\n        return String(prefix) + '[]';\n    },\n    comma: 'comma',\n    indices(prefix, key) {\n        return String(prefix) + '[' + key + ']';\n    },\n    repeat(prefix) {\n        return String(prefix);\n    },\n};\nconst is_array = Array.isArray;\nconst push = Array.prototype.push;\nconst push_to_array = function (arr, value_or_array) {\n    push.apply(arr, is_array(value_or_array) ? value_or_array : [value_or_array]);\n};\nconst to_ISO = Date.prototype.toISOString;\nconst defaults = {\n    addQueryPrefix: false,\n    allowDots: false,\n    allowEmptyArrays: false,\n    arrayFormat: 'indices',\n    charset: 'utf-8',\n    charsetSentinel: false,\n    delimiter: '&',\n    encode: true,\n    encodeDotInKeys: false,\n    encoder: encode,\n    encodeValuesOnly: false,\n    format: default_format,\n    formatter: formatters[default_format],\n    /** @deprecated */\n    indices: false,\n    serializeDate(date) {\n        return to_ISO.call(date);\n    },\n    skipNulls: false,\n    strictNullHandling: false,\n};\nfunction is_non_nullish_primitive(v) {\n    return (typeof v === 'string' ||\n        typeof v === 'number' ||\n        typeof v === 'boolean' ||\n        typeof v === 'symbol' ||\n        typeof v === 'bigint');\n}\nconst sentinel = {};\nfunction inner_stringify(object, prefix, generateArrayPrefix, commaRoundTrip, allowEmptyArrays, strictNullHandling, skipNulls, encodeDotInKeys, encoder, filter, sort, allowDots, serializeDate, format, formatter, encodeValuesOnly, charset, sideChannel) {\n    let obj = object;\n    let tmp_sc = sideChannel;\n    let step = 0;\n    let find_flag = false;\n    while ((tmp_sc = tmp_sc.get(sentinel)) !== void undefined && !find_flag) {\n        // Where object last appeared in the ref tree\n        const pos = tmp_sc.get(object);\n        step += 1;\n        if (typeof pos !== 'undefined') {\n            if (pos === step) {\n                throw new RangeError('Cyclic object value');\n            }\n            else {\n                find_flag = true; // Break while\n            }\n        }\n        if (typeof tmp_sc.get(sentinel) === 'undefined') {\n            step = 0;\n        }\n    }\n    if (typeof filter === 'function') {\n        obj = filter(prefix, obj);\n    }\n    else if (obj instanceof Date) {\n        obj = serializeDate?.(obj);\n    }\n    else if (generateArrayPrefix === 'comma' && is_array(obj)) {\n        obj = maybe_map(obj, function (value) {\n            if (value instanceof Date) {\n                return serializeDate?.(value);\n            }\n            return value;\n        });\n    }\n    if (obj === null) {\n        if (strictNullHandling) {\n            return encoder && !encodeValuesOnly ?\n                // @ts-expect-error\n                encoder(prefix, defaults.encoder, charset, 'key', format)\n                : prefix;\n        }\n        obj = '';\n    }\n    if (is_non_nullish_primitive(obj) || is_buffer(obj)) {\n        if (encoder) {\n            const key_value = encodeValuesOnly ? prefix\n                // @ts-expect-error\n                : encoder(prefix, defaults.encoder, charset, 'key', format);\n            return [\n                formatter?.(key_value) +\n                    '=' +\n                    // @ts-expect-error\n                    formatter?.(encoder(obj, defaults.encoder, charset, 'value', format)),\n            ];\n        }\n        return [formatter?.(prefix) + '=' + formatter?.(String(obj))];\n    }\n    const values = [];\n    if (typeof obj === 'undefined') {\n        return values;\n    }\n    let obj_keys;\n    if (generateArrayPrefix === 'comma' && is_array(obj)) {\n        // we need to join elements in\n        if (encodeValuesOnly && encoder) {\n            // @ts-expect-error values only\n            obj = maybe_map(obj, encoder);\n        }\n        obj_keys = [{ value: obj.length > 0 ? obj.join(',') || null : void undefined }];\n    }\n    else if (is_array(filter)) {\n        obj_keys = filter;\n    }\n    else {\n        const keys = Object.keys(obj);\n        obj_keys = sort ? keys.sort(sort) : keys;\n    }\n    const encoded_prefix = encodeDotInKeys ? String(prefix).replace(/\\./g, '%2E') : String(prefix);\n    const adjusted_prefix = commaRoundTrip && is_array(obj) && obj.length === 1 ? encoded_prefix + '[]' : encoded_prefix;\n    if (allowEmptyArrays && is_array(obj) && obj.length === 0) {\n        return adjusted_prefix + '[]';\n    }\n    for (let j = 0; j < obj_keys.length; ++j) {\n        const key = obj_keys[j];\n        const value = \n        // @ts-ignore\n        typeof key === 'object' && typeof key.value !== 'undefined' ? key.value : obj[key];\n        if (skipNulls && value === null) {\n            continue;\n        }\n        // @ts-ignore\n        const encoded_key = allowDots && encodeDotInKeys ? key.replace(/\\./g, '%2E') : key;\n        const key_prefix = is_array(obj) ?\n            typeof generateArrayPrefix === 'function' ?\n                generateArrayPrefix(adjusted_prefix, encoded_key)\n                : adjusted_prefix\n            : adjusted_prefix + (allowDots ? '.' + encoded_key : '[' + encoded_key + ']');\n        sideChannel.set(object, step);\n        const valueSideChannel = new WeakMap();\n        valueSideChannel.set(sentinel, sideChannel);\n        push_to_array(values, inner_stringify(value, key_prefix, generateArrayPrefix, commaRoundTrip, allowEmptyArrays, strictNullHandling, skipNulls, encodeDotInKeys, \n        // @ts-ignore\n        generateArrayPrefix === 'comma' && encodeValuesOnly && is_array(obj) ? null : encoder, filter, sort, allowDots, serializeDate, format, formatter, encodeValuesOnly, charset, valueSideChannel));\n    }\n    return values;\n}\nfunction normalize_stringify_options(opts = defaults) {\n    if (typeof opts.allowEmptyArrays !== 'undefined' && typeof opts.allowEmptyArrays !== 'boolean') {\n        throw new TypeError('`allowEmptyArrays` option can only be `true` or `false`, when provided');\n    }\n    if (typeof opts.encodeDotInKeys !== 'undefined' && typeof opts.encodeDotInKeys !== 'boolean') {\n        throw new TypeError('`encodeDotInKeys` option can only be `true` or `false`, when provided');\n    }\n    if (opts.encoder !== null && typeof opts.encoder !== 'undefined' && typeof opts.encoder !== 'function') {\n        throw new TypeError('Encoder has to be a function.');\n    }\n    const charset = opts.charset || defaults.charset;\n    if (typeof opts.charset !== 'undefined' && opts.charset !== 'utf-8' && opts.charset !== 'iso-8859-1') {\n        throw new TypeError('The charset option must be either utf-8, iso-8859-1, or undefined');\n    }\n    let format = default_format;\n    if (typeof opts.format !== 'undefined') {\n        if (!has.call(formatters, opts.format)) {\n            throw new TypeError('Unknown format option provided.');\n        }\n        format = opts.format;\n    }\n    const formatter = formatters[format];\n    let filter = defaults.filter;\n    if (typeof opts.filter === 'function' || is_array(opts.filter)) {\n        filter = opts.filter;\n    }\n    let arrayFormat;\n    if (opts.arrayFormat && opts.arrayFormat in array_prefix_generators) {\n        arrayFormat = opts.arrayFormat;\n    }\n    else if ('indices' in opts) {\n        arrayFormat = opts.indices ? 'indices' : 'repeat';\n    }\n    else {\n        arrayFormat = defaults.arrayFormat;\n    }\n    if ('commaRoundTrip' in opts && typeof opts.commaRoundTrip !== 'boolean') {\n        throw new TypeError('`commaRoundTrip` must be a boolean, or absent');\n    }\n    const allowDots = typeof opts.allowDots === 'undefined' ?\n        !!opts.encodeDotInKeys === true ?\n            true\n            : defaults.allowDots\n        : !!opts.allowDots;\n    return {\n        addQueryPrefix: typeof opts.addQueryPrefix === 'boolean' ? opts.addQueryPrefix : defaults.addQueryPrefix,\n        // @ts-ignore\n        allowDots: allowDots,\n        allowEmptyArrays: typeof opts.allowEmptyArrays === 'boolean' ? !!opts.allowEmptyArrays : defaults.allowEmptyArrays,\n        arrayFormat: arrayFormat,\n        charset: charset,\n        charsetSentinel: typeof opts.charsetSentinel === 'boolean' ? opts.charsetSentinel : defaults.charsetSentinel,\n        commaRoundTrip: !!opts.commaRoundTrip,\n        delimiter: typeof opts.delimiter === 'undefined' ? defaults.delimiter : opts.delimiter,\n        encode: typeof opts.encode === 'boolean' ? opts.encode : defaults.encode,\n        encodeDotInKeys: typeof opts.encodeDotInKeys === 'boolean' ? opts.encodeDotInKeys : defaults.encodeDotInKeys,\n        encoder: typeof opts.encoder === 'function' ? opts.encoder : defaults.encoder,\n        encodeValuesOnly: typeof opts.encodeValuesOnly === 'boolean' ? opts.encodeValuesOnly : defaults.encodeValuesOnly,\n        filter: filter,\n        format: format,\n        formatter: formatter,\n        serializeDate: typeof opts.serializeDate === 'function' ? opts.serializeDate : defaults.serializeDate,\n        skipNulls: typeof opts.skipNulls === 'boolean' ? opts.skipNulls : defaults.skipNulls,\n        // @ts-ignore\n        sort: typeof opts.sort === 'function' ? opts.sort : null,\n        strictNullHandling: typeof opts.strictNullHandling === 'boolean' ? opts.strictNullHandling : defaults.strictNullHandling,\n    };\n}\nexport function stringify(object, opts = {}) {\n    let obj = object;\n    const options = normalize_stringify_options(opts);\n    let obj_keys;\n    let filter;\n    if (typeof options.filter === 'function') {\n        filter = options.filter;\n        obj = filter('', obj);\n    }\n    else if (is_array(options.filter)) {\n        filter = options.filter;\n        obj_keys = filter;\n    }\n    const keys = [];\n    if (typeof obj !== 'object' || obj === null) {\n        return '';\n    }\n    const generateArrayPrefix = array_prefix_generators[options.arrayFormat];\n    const commaRoundTrip = generateArrayPrefix === 'comma' && options.commaRoundTrip;\n    if (!obj_keys) {\n        obj_keys = Object.keys(obj);\n    }\n    if (options.sort) {\n        obj_keys.sort(options.sort);\n    }\n    const sideChannel = new WeakMap();\n    for (let i = 0; i < obj_keys.length; ++i) {\n        const key = obj_keys[i];\n        if (options.skipNulls && obj[key] === null) {\n            continue;\n        }\n        push_to_array(keys, inner_stringify(obj[key], key, \n        // @ts-expect-error\n        generateArrayPrefix, commaRoundTrip, options.allowEmptyArrays, options.strictNullHandling, options.skipNulls, options.encodeDotInKeys, options.encode ? options.encoder : null, options.filter, options.sort, options.allowDots, options.serializeDate, options.format, options.formatter, options.encodeValuesOnly, options.charset, sideChannel));\n    }\n    const joined = keys.join(options.delimiter);\n    let prefix = options.addQueryPrefix === true ? '?' : '';\n    if (options.charsetSentinel) {\n        if (options.charset === 'iso-8859-1') {\n            // encodeURIComponent('&#10003;'), the \"numeric entity\" representation of a checkmark\n            prefix += 'utf8=%26%2310003%3B&';\n        }\n        else {\n            // encodeURIComponent('')\n            prefix += 'utf8=%E2%9C%93&';\n        }\n    }\n    return joined.length > 0 ? prefix + joined : '';\n}\n//# sourceMappingURL=stringify.mjs.map","export const VERSION = '4.104.0'; // x-release-please-version\n//# sourceMappingURL=version.mjs.map","export let auto = false;\nexport let kind = undefined;\nexport let fetch = undefined;\nexport let Request = undefined;\nexport let Response = undefined;\nexport let Headers = undefined;\nexport let FormData = undefined;\nexport let Blob = undefined;\nexport let File = undefined;\nexport let ReadableStream = undefined;\nexport let getMultipartRequestOptions = undefined;\nexport let getDefaultAgent = undefined;\nexport let fileFromPath = undefined;\nexport let isFsReadStream = undefined;\nexport function setShims(shims, options = { auto: false }) {\n    if (auto) {\n        throw new Error(`you must \\`import 'openai/shims/${shims.kind}'\\` before importing anything else from openai`);\n    }\n    if (kind) {\n        throw new Error(`can't \\`import 'openai/shims/${shims.kind}'\\` after \\`import 'openai/shims/${kind}'\\``);\n    }\n    auto = options.auto;\n    kind = shims.kind;\n    fetch = shims.fetch;\n    Request = shims.Request;\n    Response = shims.Response;\n    Headers = shims.Headers;\n    FormData = shims.FormData;\n    Blob = shims.Blob;\n    File = shims.File;\n    ReadableStream = shims.ReadableStream;\n    getMultipartRequestOptions = shims.getMultipartRequestOptions;\n    getDefaultAgent = shims.getDefaultAgent;\n    fileFromPath = shims.fileFromPath;\n    isFsReadStream = shims.isFsReadStream;\n}\n//# sourceMappingURL=registry.mjs.map","/**\n * Disclaimer: modules in _shims aren't intended to be imported by SDK users.\n */\nexport class MultipartBody {\n    constructor(body) {\n        this.body = body;\n    }\n    get [Symbol.toStringTag]() {\n        return 'MultipartBody';\n    }\n}\n//# sourceMappingURL=MultipartBody.mjs.map","import { MultipartBody } from \"./MultipartBody.mjs\";\nexport function getRuntime({ manuallyImported } = {}) {\n    const recommendation = manuallyImported ?\n        `You may need to use polyfills`\n        : `Add one of these imports before your first \\`import  from 'openai'\\`:\n- \\`import 'openai/shims/node'\\` (if you're running on Node)\n- \\`import 'openai/shims/web'\\` (otherwise)\n`;\n    let _fetch, _Request, _Response, _Headers;\n    try {\n        // @ts-ignore\n        _fetch = fetch;\n        // @ts-ignore\n        _Request = Request;\n        // @ts-ignore\n        _Response = Response;\n        // @ts-ignore\n        _Headers = Headers;\n    }\n    catch (error) {\n        throw new Error(`this environment is missing the following Web Fetch API type: ${error.message}. ${recommendation}`);\n    }\n    return {\n        kind: 'web',\n        fetch: _fetch,\n        Request: _Request,\n        Response: _Response,\n        Headers: _Headers,\n        FormData: \n        // @ts-ignore\n        typeof FormData !== 'undefined' ? FormData : (class FormData {\n            // @ts-ignore\n            constructor() {\n                throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${recommendation}`);\n            }\n        }),\n        Blob: typeof Blob !== 'undefined' ? Blob : (class Blob {\n            constructor() {\n                throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${recommendation}`);\n            }\n        }),\n        File: \n        // @ts-ignore\n        typeof File !== 'undefined' ? File : (class File {\n            // @ts-ignore\n            constructor() {\n                throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${recommendation}`);\n            }\n        }),\n        ReadableStream: \n        // @ts-ignore\n        typeof ReadableStream !== 'undefined' ? ReadableStream : (class ReadableStream {\n            // @ts-ignore\n            constructor() {\n                throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${recommendation}`);\n            }\n        }),\n        getMultipartRequestOptions: async (\n        // @ts-ignore\n        form, opts) => ({\n            ...opts,\n            body: new MultipartBody(form),\n        }),\n        getDefaultAgent: (url) => undefined,\n        fileFromPath: () => {\n            throw new Error('The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads');\n        },\n        isFsReadStream: (value) => false,\n    };\n}\n//# sourceMappingURL=web-runtime.mjs.map","/**\n * Disclaimer: modules in _shims aren't intended to be imported by SDK users.\n */\nimport * as shims from './registry.mjs';\nimport * as auto from 'openai/_shims/auto/runtime';\nexport const init = () => {\n  if (!shims.kind) shims.setShims(auto.getRuntime(), { auto: true });\n};\nexport * from './registry.mjs';\n\ninit();\n","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { castToError } from \"./core.mjs\";\nexport class OpenAIError extends Error {\n}\nexport class APIError extends OpenAIError {\n    constructor(status, error, message, headers) {\n        super(`${APIError.makeMessage(status, error, message)}`);\n        this.status = status;\n        this.headers = headers;\n        this.request_id = headers?.['x-request-id'];\n        this.error = error;\n        const data = error;\n        this.code = data?.['code'];\n        this.param = data?.['param'];\n        this.type = data?.['type'];\n    }\n    static makeMessage(status, error, message) {\n        const msg = error?.message ?\n            typeof error.message === 'string' ?\n                error.message\n                : JSON.stringify(error.message)\n            : error ? JSON.stringify(error)\n                : message;\n        if (status && msg) {\n            return `${status} ${msg}`;\n        }\n        if (status) {\n            return `${status} status code (no body)`;\n        }\n        if (msg) {\n            return msg;\n        }\n        return '(no status code or body)';\n    }\n    static generate(status, errorResponse, message, headers) {\n        if (!status || !headers) {\n            return new APIConnectionError({ message, cause: castToError(errorResponse) });\n        }\n        const error = errorResponse?.['error'];\n        if (status === 400) {\n            return new BadRequestError(status, error, message, headers);\n        }\n        if (status === 401) {\n            return new AuthenticationError(status, error, message, headers);\n        }\n        if (status === 403) {\n            return new PermissionDeniedError(status, error, message, headers);\n        }\n        if (status === 404) {\n            return new NotFoundError(status, error, message, headers);\n        }\n        if (status === 409) {\n            return new ConflictError(status, error, message, headers);\n        }\n        if (status === 422) {\n            return new UnprocessableEntityError(status, error, message, headers);\n        }\n        if (status === 429) {\n            return new RateLimitError(status, error, message, headers);\n        }\n        if (status >= 500) {\n            return new InternalServerError(status, error, message, headers);\n        }\n        return new APIError(status, error, message, headers);\n    }\n}\nexport class APIUserAbortError extends APIError {\n    constructor({ message } = {}) {\n        super(undefined, undefined, message || 'Request was aborted.', undefined);\n    }\n}\nexport class APIConnectionError extends APIError {\n    constructor({ message, cause }) {\n        super(undefined, undefined, message || 'Connection error.', undefined);\n        // in some environments the 'cause' property is already declared\n        // @ts-ignore\n        if (cause)\n            this.cause = cause;\n    }\n}\nexport class APIConnectionTimeoutError extends APIConnectionError {\n    constructor({ message } = {}) {\n        super({ message: message ?? 'Request timed out.' });\n    }\n}\nexport class BadRequestError extends APIError {\n}\nexport class AuthenticationError extends APIError {\n}\nexport class PermissionDeniedError extends APIError {\n}\nexport class NotFoundError extends APIError {\n}\nexport class ConflictError extends APIError {\n}\nexport class UnprocessableEntityError extends APIError {\n}\nexport class RateLimitError extends APIError {\n}\nexport class InternalServerError extends APIError {\n}\nexport class LengthFinishReasonError extends OpenAIError {\n    constructor() {\n        super(`Could not parse response content as the length limit was reached`);\n    }\n}\nexport class ContentFilterFinishReasonError extends OpenAIError {\n    constructor() {\n        super(`Could not parse response content as the request was rejected by the content filter`);\n    }\n}\n//# sourceMappingURL=error.mjs.map","var __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _LineDecoder_carriageReturnIndex;\nimport { OpenAIError } from \"../../error.mjs\";\n/**\n * A re-implementation of httpx's `LineDecoder` in Python that handles incrementally\n * reading lines from text.\n *\n * https://github.com/encode/httpx/blob/920333ea98118e9cf617f246905d7b202510941c/httpx/_decoders.py#L258\n */\nexport class LineDecoder {\n    constructor() {\n        _LineDecoder_carriageReturnIndex.set(this, void 0);\n        this.buffer = new Uint8Array();\n        __classPrivateFieldSet(this, _LineDecoder_carriageReturnIndex, null, \"f\");\n    }\n    decode(chunk) {\n        if (chunk == null) {\n            return [];\n        }\n        const binaryChunk = chunk instanceof ArrayBuffer ? new Uint8Array(chunk)\n            : typeof chunk === 'string' ? new TextEncoder().encode(chunk)\n                : chunk;\n        let newData = new Uint8Array(this.buffer.length + binaryChunk.length);\n        newData.set(this.buffer);\n        newData.set(binaryChunk, this.buffer.length);\n        this.buffer = newData;\n        const lines = [];\n        let patternIndex;\n        while ((patternIndex = findNewlineIndex(this.buffer, __classPrivateFieldGet(this, _LineDecoder_carriageReturnIndex, \"f\"))) != null) {\n            if (patternIndex.carriage && __classPrivateFieldGet(this, _LineDecoder_carriageReturnIndex, \"f\") == null) {\n                // skip until we either get a corresponding `\\n`, a new `\\r` or nothing\n                __classPrivateFieldSet(this, _LineDecoder_carriageReturnIndex, patternIndex.index, \"f\");\n                continue;\n            }\n            // we got double \\r or \\rtext\\n\n            if (__classPrivateFieldGet(this, _LineDecoder_carriageReturnIndex, \"f\") != null &&\n                (patternIndex.index !== __classPrivateFieldGet(this, _LineDecoder_carriageReturnIndex, \"f\") + 1 || patternIndex.carriage)) {\n                lines.push(this.decodeText(this.buffer.slice(0, __classPrivateFieldGet(this, _LineDecoder_carriageReturnIndex, \"f\") - 1)));\n                this.buffer = this.buffer.slice(__classPrivateFieldGet(this, _LineDecoder_carriageReturnIndex, \"f\"));\n                __classPrivateFieldSet(this, _LineDecoder_carriageReturnIndex, null, \"f\");\n                continue;\n            }\n            const endIndex = __classPrivateFieldGet(this, _LineDecoder_carriageReturnIndex, \"f\") !== null ? patternIndex.preceding - 1 : patternIndex.preceding;\n            const line = this.decodeText(this.buffer.slice(0, endIndex));\n            lines.push(line);\n            this.buffer = this.buffer.slice(patternIndex.index);\n            __classPrivateFieldSet(this, _LineDecoder_carriageReturnIndex, null, \"f\");\n        }\n        return lines;\n    }\n    decodeText(bytes) {\n        if (bytes == null)\n            return '';\n        if (typeof bytes === 'string')\n            return bytes;\n        // Node:\n        if (typeof Buffer !== 'undefined') {\n            if (bytes instanceof Buffer) {\n                return bytes.toString();\n            }\n            if (bytes instanceof Uint8Array) {\n                return Buffer.from(bytes).toString();\n            }\n            throw new OpenAIError(`Unexpected: received non-Uint8Array (${bytes.constructor.name}) stream chunk in an environment with a global \"Buffer\" defined, which this library assumes to be Node. Please report this error.`);\n        }\n        // Browser\n        if (typeof TextDecoder !== 'undefined') {\n            if (bytes instanceof Uint8Array || bytes instanceof ArrayBuffer) {\n                this.textDecoder ?? (this.textDecoder = new TextDecoder('utf8'));\n                return this.textDecoder.decode(bytes);\n            }\n            throw new OpenAIError(`Unexpected: received non-Uint8Array/ArrayBuffer (${bytes.constructor.name}) in a web platform. Please report this error.`);\n        }\n        throw new OpenAIError(`Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.`);\n    }\n    flush() {\n        if (!this.buffer.length) {\n            return [];\n        }\n        return this.decode('\\n');\n    }\n}\n_LineDecoder_carriageReturnIndex = new WeakMap();\n// prettier-ignore\nLineDecoder.NEWLINE_CHARS = new Set(['\\n', '\\r']);\nLineDecoder.NEWLINE_REGEXP = /\\r\\n|[\\n\\r]/g;\n/**\n * This function searches the buffer for the end patterns, (\\r or \\n)\n * and returns an object with the index preceding the matched newline and the\n * index after the newline char. `null` is returned if no new line is found.\n *\n * ```ts\n * findNewLineIndex('abc\\ndef') -> { preceding: 2, index: 3 }\n * ```\n */\nfunction findNewlineIndex(buffer, startIndex) {\n    const newline = 0x0a; // \\n\n    const carriage = 0x0d; // \\r\n    for (let i = startIndex ?? 0; i < buffer.length; i++) {\n        if (buffer[i] === newline) {\n            return { preceding: i, index: i + 1, carriage: false };\n        }\n        if (buffer[i] === carriage) {\n            return { preceding: i, index: i + 1, carriage: true };\n        }\n    }\n    return null;\n}\nexport function findDoubleNewlineIndex(buffer) {\n    // This function searches the buffer for the end patterns (\\r\\r, \\n\\n, \\r\\n\\r\\n)\n    // and returns the index right after the first occurrence of any pattern,\n    // or -1 if none of the patterns are found.\n    const newline = 0x0a; // \\n\n    const carriage = 0x0d; // \\r\n    for (let i = 0; i < buffer.length - 1; i++) {\n        if (buffer[i] === newline && buffer[i + 1] === newline) {\n            // \\n\\n\n            return i + 2;\n        }\n        if (buffer[i] === carriage && buffer[i + 1] === carriage) {\n            // \\r\\r\n            return i + 2;\n        }\n        if (buffer[i] === carriage &&\n            buffer[i + 1] === newline &&\n            i + 3 < buffer.length &&\n            buffer[i + 2] === carriage &&\n            buffer[i + 3] === newline) {\n            // \\r\\n\\r\\n\n            return i + 4;\n        }\n    }\n    return -1;\n}\n//# sourceMappingURL=line.mjs.map","/**\n * Most browsers don't yet have async iterable support for ReadableStream,\n * and Node has a very different way of reading bytes from its \"ReadableStream\".\n *\n * This polyfill was pulled from https://github.com/MattiasBuelens/web-streams-polyfill/pull/122#issuecomment-1627354490\n */\nexport function ReadableStreamToAsyncIterable(stream) {\n    if (stream[Symbol.asyncIterator])\n        return stream;\n    const reader = stream.getReader();\n    return {\n        async next() {\n            try {\n                const result = await reader.read();\n                if (result?.done)\n                    reader.releaseLock(); // release lock when stream becomes closed\n                return result;\n            }\n            catch (e) {\n                reader.releaseLock(); // release lock when stream becomes errored\n                throw e;\n            }\n        },\n        async return() {\n            const cancelPromise = reader.cancel();\n            reader.releaseLock();\n            await cancelPromise;\n            return { done: true, value: undefined };\n        },\n        [Symbol.asyncIterator]() {\n            return this;\n        },\n    };\n}\n//# sourceMappingURL=stream-utils.mjs.map","import { ReadableStream } from \"./_shims/index.mjs\";\nimport { OpenAIError } from \"./error.mjs\";\nimport { findDoubleNewlineIndex, LineDecoder } from \"./internal/decoders/line.mjs\";\nimport { ReadableStreamToAsyncIterable } from \"./internal/stream-utils.mjs\";\nimport { createResponseHeaders } from \"./core.mjs\";\nimport { APIError } from \"./error.mjs\";\nexport class Stream {\n    constructor(iterator, controller) {\n        this.iterator = iterator;\n        this.controller = controller;\n    }\n    static fromSSEResponse(response, controller) {\n        let consumed = false;\n        async function* iterator() {\n            if (consumed) {\n                throw new Error('Cannot iterate over a consumed stream, use `.tee()` to split the stream.');\n            }\n            consumed = true;\n            let done = false;\n            try {\n                for await (const sse of _iterSSEMessages(response, controller)) {\n                    if (done)\n                        continue;\n                    if (sse.data.startsWith('[DONE]')) {\n                        done = true;\n                        continue;\n                    }\n                    if (sse.event === null ||\n                        sse.event.startsWith('response.') ||\n                        sse.event.startsWith('transcript.')) {\n                        let data;\n                        try {\n                            data = JSON.parse(sse.data);\n                        }\n                        catch (e) {\n                            console.error(`Could not parse message into JSON:`, sse.data);\n                            console.error(`From chunk:`, sse.raw);\n                            throw e;\n                        }\n                        if (data && data.error) {\n                            throw new APIError(undefined, data.error, undefined, createResponseHeaders(response.headers));\n                        }\n                        yield data;\n                    }\n                    else {\n                        let data;\n                        try {\n                            data = JSON.parse(sse.data);\n                        }\n                        catch (e) {\n                            console.error(`Could not parse message into JSON:`, sse.data);\n                            console.error(`From chunk:`, sse.raw);\n                            throw e;\n                        }\n                        // TODO: Is this where the error should be thrown?\n                        if (sse.event == 'error') {\n                            throw new APIError(undefined, data.error, data.message, undefined);\n                        }\n                        yield { event: sse.event, data: data };\n                    }\n                }\n                done = true;\n            }\n            catch (e) {\n                // If the user calls `stream.controller.abort()`, we should exit without throwing.\n                if (e instanceof Error && e.name === 'AbortError')\n                    return;\n                throw e;\n            }\n            finally {\n                // If the user `break`s, abort the ongoing request.\n                if (!done)\n                    controller.abort();\n            }\n        }\n        return new Stream(iterator, controller);\n    }\n    /**\n     * Generates a Stream from a newline-separated ReadableStream\n     * where each item is a JSON value.\n     */\n    static fromReadableStream(readableStream, controller) {\n        let consumed = false;\n        async function* iterLines() {\n            const lineDecoder = new LineDecoder();\n            const iter = ReadableStreamToAsyncIterable(readableStream);\n            for await (const chunk of iter) {\n                for (const line of lineDecoder.decode(chunk)) {\n                    yield line;\n                }\n            }\n            for (const line of lineDecoder.flush()) {\n                yield line;\n            }\n        }\n        async function* iterator() {\n            if (consumed) {\n                throw new Error('Cannot iterate over a consumed stream, use `.tee()` to split the stream.');\n            }\n            consumed = true;\n            let done = false;\n            try {\n                for await (const line of iterLines()) {\n                    if (done)\n                        continue;\n                    if (line)\n                        yield JSON.parse(line);\n                }\n                done = true;\n            }\n            catch (e) {\n                // If the user calls `stream.controller.abort()`, we should exit without throwing.\n                if (e instanceof Error && e.name === 'AbortError')\n                    return;\n                throw e;\n            }\n            finally {\n                // If the user `break`s, abort the ongoing request.\n                if (!done)\n                    controller.abort();\n            }\n        }\n        return new Stream(iterator, controller);\n    }\n    [Symbol.asyncIterator]() {\n        return this.iterator();\n    }\n    /**\n     * Splits the stream into two streams which can be\n     * independently read from at different speeds.\n     */\n    tee() {\n        const left = [];\n        const right = [];\n        const iterator = this.iterator();\n        const teeIterator = (queue) => {\n            return {\n                next: () => {\n                    if (queue.length === 0) {\n                        const result = iterator.next();\n                        left.push(result);\n                        right.push(result);\n                    }\n                    return queue.shift();\n                },\n            };\n        };\n        return [\n            new Stream(() => teeIterator(left), this.controller),\n            new Stream(() => teeIterator(right), this.controller),\n        ];\n    }\n    /**\n     * Converts this stream to a newline-separated ReadableStream of\n     * JSON stringified values in the stream\n     * which can be turned back into a Stream with `Stream.fromReadableStream()`.\n     */\n    toReadableStream() {\n        const self = this;\n        let iter;\n        const encoder = new TextEncoder();\n        return new ReadableStream({\n            async start() {\n                iter = self[Symbol.asyncIterator]();\n            },\n            async pull(ctrl) {\n                try {\n                    const { value, done } = await iter.next();\n                    if (done)\n                        return ctrl.close();\n                    const bytes = encoder.encode(JSON.stringify(value) + '\\n');\n                    ctrl.enqueue(bytes);\n                }\n                catch (err) {\n                    ctrl.error(err);\n                }\n            },\n            async cancel() {\n                await iter.return?.();\n            },\n        });\n    }\n}\nexport async function* _iterSSEMessages(response, controller) {\n    if (!response.body) {\n        controller.abort();\n        throw new OpenAIError(`Attempted to iterate over a response with no body`);\n    }\n    const sseDecoder = new SSEDecoder();\n    const lineDecoder = new LineDecoder();\n    const iter = ReadableStreamToAsyncIterable(response.body);\n    for await (const sseChunk of iterSSEChunks(iter)) {\n        for (const line of lineDecoder.decode(sseChunk)) {\n            const sse = sseDecoder.decode(line);\n            if (sse)\n                yield sse;\n        }\n    }\n    for (const line of lineDecoder.flush()) {\n        const sse = sseDecoder.decode(line);\n        if (sse)\n            yield sse;\n    }\n}\n/**\n * Given an async iterable iterator, iterates over it and yields full\n * SSE chunks, i.e. yields when a double new-line is encountered.\n */\nasync function* iterSSEChunks(iterator) {\n    let data = new Uint8Array();\n    for await (const chunk of iterator) {\n        if (chunk == null) {\n            continue;\n        }\n        const binaryChunk = chunk instanceof ArrayBuffer ? new Uint8Array(chunk)\n            : typeof chunk === 'string' ? new TextEncoder().encode(chunk)\n                : chunk;\n        let newData = new Uint8Array(data.length + binaryChunk.length);\n        newData.set(data);\n        newData.set(binaryChunk, data.length);\n        data = newData;\n        let patternIndex;\n        while ((patternIndex = findDoubleNewlineIndex(data)) !== -1) {\n            yield data.slice(0, patternIndex);\n            data = data.slice(patternIndex);\n        }\n    }\n    if (data.length > 0) {\n        yield data;\n    }\n}\nclass SSEDecoder {\n    constructor() {\n        this.event = null;\n        this.data = [];\n        this.chunks = [];\n    }\n    decode(line) {\n        if (line.endsWith('\\r')) {\n            line = line.substring(0, line.length - 1);\n        }\n        if (!line) {\n            // empty line and we didn't previously encounter any messages\n            if (!this.event && !this.data.length)\n                return null;\n            const sse = {\n                event: this.event,\n                data: this.data.join('\\n'),\n                raw: this.chunks,\n            };\n            this.event = null;\n            this.data = [];\n            this.chunks = [];\n            return sse;\n        }\n        this.chunks.push(line);\n        if (line.startsWith(':')) {\n            return null;\n        }\n        let [fieldname, _, value] = partition(line, ':');\n        if (value.startsWith(' ')) {\n            value = value.substring(1);\n        }\n        if (fieldname === 'event') {\n            this.event = value;\n        }\n        else if (fieldname === 'data') {\n            this.data.push(value);\n        }\n        return null;\n    }\n}\nfunction partition(str, delimiter) {\n    const index = str.indexOf(delimiter);\n    if (index !== -1) {\n        return [str.substring(0, index), delimiter, str.substring(index + delimiter.length)];\n    }\n    return [str, '', ''];\n}\n//# sourceMappingURL=streaming.mjs.map","import { FormData, File, getMultipartRequestOptions, isFsReadStream, } from \"./_shims/index.mjs\";\nexport { fileFromPath } from \"./_shims/index.mjs\";\nexport const isResponseLike = (value) => value != null &&\n    typeof value === 'object' &&\n    typeof value.url === 'string' &&\n    typeof value.blob === 'function';\nexport const isFileLike = (value) => value != null &&\n    typeof value === 'object' &&\n    typeof value.name === 'string' &&\n    typeof value.lastModified === 'number' &&\n    isBlobLike(value);\n/**\n * The BlobLike type omits arrayBuffer() because @types/node-fetch@^2.6.4 lacks it; but this check\n * adds the arrayBuffer() method type because it is available and used at runtime\n */\nexport const isBlobLike = (value) => value != null &&\n    typeof value === 'object' &&\n    typeof value.size === 'number' &&\n    typeof value.type === 'string' &&\n    typeof value.text === 'function' &&\n    typeof value.slice === 'function' &&\n    typeof value.arrayBuffer === 'function';\nexport const isUploadable = (value) => {\n    return isFileLike(value) || isResponseLike(value) || isFsReadStream(value);\n};\n/**\n * Helper for creating a {@link File} to pass to an SDK upload method from a variety of different data formats\n * @param value the raw content of the file.  Can be an {@link Uploadable}, {@link BlobLikePart}, or {@link AsyncIterable} of {@link BlobLikePart}s\n * @param {string=} name the name of the file. If omitted, toFile will try to determine a file name from bits if possible\n * @param {Object=} options additional properties\n * @param {string=} options.type the MIME type of the content\n * @param {number=} options.lastModified the last modified timestamp\n * @returns a {@link File} with the given properties\n */\nexport async function toFile(value, name, options) {\n    // If it's a promise, resolve it.\n    value = await value;\n    // If we've been given a `File` we don't need to do anything\n    if (isFileLike(value)) {\n        return value;\n    }\n    if (isResponseLike(value)) {\n        const blob = await value.blob();\n        name || (name = new URL(value.url).pathname.split(/[\\\\/]/).pop() ?? 'unknown_file');\n        // we need to convert the `Blob` into an array buffer because the `Blob` class\n        // that `node-fetch` defines is incompatible with the web standard which results\n        // in `new File` interpreting it as a string instead of binary data.\n        const data = isBlobLike(blob) ? [(await blob.arrayBuffer())] : [blob];\n        return new File(data, name, options);\n    }\n    const bits = await getBytes(value);\n    name || (name = getName(value) ?? 'unknown_file');\n    if (!options?.type) {\n        const type = bits[0]?.type;\n        if (typeof type === 'string') {\n            options = { ...options, type };\n        }\n    }\n    return new File(bits, name, options);\n}\nasync function getBytes(value) {\n    let parts = [];\n    if (typeof value === 'string' ||\n        ArrayBuffer.isView(value) || // includes Uint8Array, Buffer, etc.\n        value instanceof ArrayBuffer) {\n        parts.push(value);\n    }\n    else if (isBlobLike(value)) {\n        parts.push(await value.arrayBuffer());\n    }\n    else if (isAsyncIterableIterator(value) // includes Readable, ReadableStream, etc.\n    ) {\n        for await (const chunk of value) {\n            parts.push(chunk); // TODO, consider validating?\n        }\n    }\n    else {\n        throw new Error(`Unexpected data type: ${typeof value}; constructor: ${value?.constructor\n            ?.name}; props: ${propsForError(value)}`);\n    }\n    return parts;\n}\nfunction propsForError(value) {\n    const props = Object.getOwnPropertyNames(value);\n    return `[${props.map((p) => `\"${p}\"`).join(', ')}]`;\n}\nfunction getName(value) {\n    return (getStringFromMaybeBuffer(value.name) ||\n        getStringFromMaybeBuffer(value.filename) ||\n        // For fs.ReadStream\n        getStringFromMaybeBuffer(value.path)?.split(/[\\\\/]/).pop());\n}\nconst getStringFromMaybeBuffer = (x) => {\n    if (typeof x === 'string')\n        return x;\n    if (typeof Buffer !== 'undefined' && x instanceof Buffer)\n        return String(x);\n    return undefined;\n};\nconst isAsyncIterableIterator = (value) => value != null && typeof value === 'object' && typeof value[Symbol.asyncIterator] === 'function';\nexport const isMultipartBody = (body) => body && typeof body === 'object' && body.body && body[Symbol.toStringTag] === 'MultipartBody';\n/**\n * Returns a multipart/form-data request if any part of the given request body contains a File / Blob value.\n * Otherwise returns the request as is.\n */\nexport const maybeMultipartFormRequestOptions = async (opts) => {\n    if (!hasUploadableValue(opts.body))\n        return opts;\n    const form = await createForm(opts.body);\n    return getMultipartRequestOptions(form, opts);\n};\nexport const multipartFormRequestOptions = async (opts) => {\n    const form = await createForm(opts.body);\n    return getMultipartRequestOptions(form, opts);\n};\nexport const createForm = async (body) => {\n    const form = new FormData();\n    await Promise.all(Object.entries(body || {}).map(([key, value]) => addFormValue(form, key, value)));\n    return form;\n};\nconst hasUploadableValue = (value) => {\n    if (isUploadable(value))\n        return true;\n    if (Array.isArray(value))\n        return value.some(hasUploadableValue);\n    if (value && typeof value === 'object') {\n        for (const k in value) {\n            if (hasUploadableValue(value[k]))\n                return true;\n        }\n    }\n    return false;\n};\nconst addFormValue = async (form, key, value) => {\n    if (value === undefined)\n        return;\n    if (value == null) {\n        throw new TypeError(`Received null for \"${key}\"; to pass null in FormData, you must use the string 'null'`);\n    }\n    // TODO: make nested formats configurable\n    if (typeof value === 'string' || typeof value === 'number' || typeof value === 'boolean') {\n        form.append(key, String(value));\n    }\n    else if (isUploadable(value)) {\n        const file = await toFile(value);\n        form.append(key, file);\n    }\n    else if (Array.isArray(value)) {\n        await Promise.all(value.map((entry) => addFormValue(form, key + '[]', entry)));\n    }\n    else if (typeof value === 'object') {\n        await Promise.all(Object.entries(value).map(([name, prop]) => addFormValue(form, `${key}[${name}]`, prop)));\n    }\n    else {\n        throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${value} instead`);\n    }\n};\n//# sourceMappingURL=uploads.mjs.map","var __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _AbstractPage_client;\nimport { VERSION } from \"./version.mjs\";\nimport { Stream } from \"./streaming.mjs\";\nimport { OpenAIError, APIError, APIConnectionError, APIConnectionTimeoutError, APIUserAbortError, } from \"./error.mjs\";\nimport { kind as shimsKind, getDefaultAgent, fetch, init, } from \"./_shims/index.mjs\";\n// try running side effects outside of _shims/index to workaround https://github.com/vercel/next.js/issues/76881\ninit();\nimport { isBlobLike, isMultipartBody } from \"./uploads.mjs\";\nexport { maybeMultipartFormRequestOptions, multipartFormRequestOptions, createForm, } from \"./uploads.mjs\";\nasync function defaultParseResponse(props) {\n    const { response } = props;\n    if (props.options.stream) {\n        debug('response', response.status, response.url, response.headers, response.body);\n        // Note: there is an invariant here that isn't represented in the type system\n        // that if you set `stream: true` the response type must also be `Stream<T>`\n        if (props.options.__streamClass) {\n            return props.options.__streamClass.fromSSEResponse(response, props.controller);\n        }\n        return Stream.fromSSEResponse(response, props.controller);\n    }\n    // fetch refuses to read the body when the status code is 204.\n    if (response.status === 204) {\n        return null;\n    }\n    if (props.options.__binaryResponse) {\n        return response;\n    }\n    const contentType = response.headers.get('content-type');\n    const mediaType = contentType?.split(';')[0]?.trim();\n    const isJSON = mediaType?.includes('application/json') || mediaType?.endsWith('+json');\n    if (isJSON) {\n        const json = await response.json();\n        debug('response', response.status, response.url, response.headers, json);\n        return _addRequestID(json, response);\n    }\n    const text = await response.text();\n    debug('response', response.status, response.url, response.headers, text);\n    // TODO handle blob, arraybuffer, other content types, etc.\n    return text;\n}\nfunction _addRequestID(value, response) {\n    if (!value || typeof value !== 'object' || Array.isArray(value)) {\n        return value;\n    }\n    return Object.defineProperty(value, '_request_id', {\n        value: response.headers.get('x-request-id'),\n        enumerable: false,\n    });\n}\n/**\n * A subclass of `Promise` providing additional helper methods\n * for interacting with the SDK.\n */\nexport class APIPromise extends Promise {\n    constructor(responsePromise, parseResponse = defaultParseResponse) {\n        super((resolve) => {\n            // this is maybe a bit weird but this has to be a no-op to not implicitly\n            // parse the response body; instead .then, .catch, .finally are overridden\n            // to parse the response\n            resolve(null);\n        });\n        this.responsePromise = responsePromise;\n        this.parseResponse = parseResponse;\n    }\n    _thenUnwrap(transform) {\n        return new APIPromise(this.responsePromise, async (props) => _addRequestID(transform(await this.parseResponse(props), props), props.response));\n    }\n    /**\n     * Gets the raw `Response` instance instead of parsing the response\n     * data.\n     *\n     * If you want to parse the response body but still get the `Response`\n     * instance, you can use {@link withResponse()}.\n     *\n     *  Getting the wrong TypeScript type for `Response`?\n     * Try setting `\"moduleResolution\": \"NodeNext\"` if you can,\n     * or add one of these imports before your first `import  from 'openai'`:\n     * - `import 'openai/shims/node'` (if you're running on Node)\n     * - `import 'openai/shims/web'` (otherwise)\n     */\n    asResponse() {\n        return this.responsePromise.then((p) => p.response);\n    }\n    /**\n     * Gets the parsed response data, the raw `Response` instance and the ID of the request,\n     * returned via the X-Request-ID header which is useful for debugging requests and reporting\n     * issues to OpenAI.\n     *\n     * If you just want to get the raw `Response` instance without parsing it,\n     * you can use {@link asResponse()}.\n     *\n     *\n     *  Getting the wrong TypeScript type for `Response`?\n     * Try setting `\"moduleResolution\": \"NodeNext\"` if you can,\n     * or add one of these imports before your first `import  from 'openai'`:\n     * - `import 'openai/shims/node'` (if you're running on Node)\n     * - `import 'openai/shims/web'` (otherwise)\n     */\n    async withResponse() {\n        const [data, response] = await Promise.all([this.parse(), this.asResponse()]);\n        return { data, response, request_id: response.headers.get('x-request-id') };\n    }\n    parse() {\n        if (!this.parsedPromise) {\n            this.parsedPromise = this.responsePromise.then(this.parseResponse);\n        }\n        return this.parsedPromise;\n    }\n    then(onfulfilled, onrejected) {\n        return this.parse().then(onfulfilled, onrejected);\n    }\n    catch(onrejected) {\n        return this.parse().catch(onrejected);\n    }\n    finally(onfinally) {\n        return this.parse().finally(onfinally);\n    }\n}\nexport class APIClient {\n    constructor({ baseURL, maxRetries = 2, timeout = 600000, // 10 minutes\n    httpAgent, fetch: overriddenFetch, }) {\n        this.baseURL = baseURL;\n        this.maxRetries = validatePositiveInteger('maxRetries', maxRetries);\n        this.timeout = validatePositiveInteger('timeout', timeout);\n        this.httpAgent = httpAgent;\n        this.fetch = overriddenFetch ?? fetch;\n    }\n    authHeaders(opts) {\n        return {};\n    }\n    /**\n     * Override this to add your own default headers, for example:\n     *\n     *  {\n     *    ...super.defaultHeaders(),\n     *    Authorization: 'Bearer 123',\n     *  }\n     */\n    defaultHeaders(opts) {\n        return {\n            Accept: 'application/json',\n            'Content-Type': 'application/json',\n            'User-Agent': this.getUserAgent(),\n            ...getPlatformHeaders(),\n            ...this.authHeaders(opts),\n        };\n    }\n    /**\n     * Override this to add your own headers validation:\n     */\n    validateHeaders(headers, customHeaders) { }\n    defaultIdempotencyKey() {\n        return `stainless-node-retry-${uuid4()}`;\n    }\n    get(path, opts) {\n        return this.methodRequest('get', path, opts);\n    }\n    post(path, opts) {\n        return this.methodRequest('post', path, opts);\n    }\n    patch(path, opts) {\n        return this.methodRequest('patch', path, opts);\n    }\n    put(path, opts) {\n        return this.methodRequest('put', path, opts);\n    }\n    delete(path, opts) {\n        return this.methodRequest('delete', path, opts);\n    }\n    methodRequest(method, path, opts) {\n        return this.request(Promise.resolve(opts).then(async (opts) => {\n            const body = opts && isBlobLike(opts?.body) ? new DataView(await opts.body.arrayBuffer())\n                : opts?.body instanceof DataView ? opts.body\n                    : opts?.body instanceof ArrayBuffer ? new DataView(opts.body)\n                        : opts && ArrayBuffer.isView(opts?.body) ? new DataView(opts.body.buffer)\n                            : opts?.body;\n            return { method, path, ...opts, body };\n        }));\n    }\n    getAPIList(path, Page, opts) {\n        return this.requestAPIList(Page, { method: 'get', path, ...opts });\n    }\n    calculateContentLength(body) {\n        if (typeof body === 'string') {\n            if (typeof Buffer !== 'undefined') {\n                return Buffer.byteLength(body, 'utf8').toString();\n            }\n            if (typeof TextEncoder !== 'undefined') {\n                const encoder = new TextEncoder();\n                const encoded = encoder.encode(body);\n                return encoded.length.toString();\n            }\n        }\n        else if (ArrayBuffer.isView(body)) {\n            return body.byteLength.toString();\n        }\n        return null;\n    }\n    buildRequest(inputOptions, { retryCount = 0 } = {}) {\n        const options = { ...inputOptions };\n        const { method, path, query, headers: headers = {} } = options;\n        const body = ArrayBuffer.isView(options.body) || (options.__binaryRequest && typeof options.body === 'string') ?\n            options.body\n            : isMultipartBody(options.body) ? options.body.body\n                : options.body ? JSON.stringify(options.body, null, 2)\n                    : null;\n        const contentLength = this.calculateContentLength(body);\n        const url = this.buildURL(path, query);\n        if ('timeout' in options)\n            validatePositiveInteger('timeout', options.timeout);\n        options.timeout = options.timeout ?? this.timeout;\n        const httpAgent = options.httpAgent ?? this.httpAgent ?? getDefaultAgent(url);\n        const minAgentTimeout = options.timeout + 1000;\n        if (typeof httpAgent?.options?.timeout === 'number' &&\n            minAgentTimeout > (httpAgent.options.timeout ?? 0)) {\n            // Allow any given request to bump our agent active socket timeout.\n            // This may seem strange, but leaking active sockets should be rare and not particularly problematic,\n            // and without mutating agent we would need to create more of them.\n            // This tradeoff optimizes for performance.\n            httpAgent.options.timeout = minAgentTimeout;\n        }\n        if (this.idempotencyHeader && method !== 'get') {\n            if (!inputOptions.idempotencyKey)\n                inputOptions.idempotencyKey = this.defaultIdempotencyKey();\n            headers[this.idempotencyHeader] = inputOptions.idempotencyKey;\n        }\n        const reqHeaders = this.buildHeaders({ options, headers, contentLength, retryCount });\n        const req = {\n            method,\n            ...(body && { body: body }),\n            headers: reqHeaders,\n            ...(httpAgent && { agent: httpAgent }),\n            // @ts-ignore node-fetch uses a custom AbortSignal type that is\n            // not compatible with standard web types\n            signal: options.signal ?? null,\n        };\n        return { req, url, timeout: options.timeout };\n    }\n    buildHeaders({ options, headers, contentLength, retryCount, }) {\n        const reqHeaders = {};\n        if (contentLength) {\n            reqHeaders['content-length'] = contentLength;\n        }\n        const defaultHeaders = this.defaultHeaders(options);\n        applyHeadersMut(reqHeaders, defaultHeaders);\n        applyHeadersMut(reqHeaders, headers);\n        // let builtin fetch set the Content-Type for multipart bodies\n        if (isMultipartBody(options.body) && shimsKind !== 'node') {\n            delete reqHeaders['content-type'];\n        }\n        // Don't set theses headers if they were already set or removed through default headers or by the caller.\n        // We check `defaultHeaders` and `headers`, which can contain nulls, instead of `reqHeaders` to account\n        // for the removal case.\n        if (getHeader(defaultHeaders, 'x-stainless-retry-count') === undefined &&\n            getHeader(headers, 'x-stainless-retry-count') === undefined) {\n            reqHeaders['x-stainless-retry-count'] = String(retryCount);\n        }\n        if (getHeader(defaultHeaders, 'x-stainless-timeout') === undefined &&\n            getHeader(headers, 'x-stainless-timeout') === undefined &&\n            options.timeout) {\n            reqHeaders['x-stainless-timeout'] = String(Math.trunc(options.timeout / 1000));\n        }\n        this.validateHeaders(reqHeaders, headers);\n        return reqHeaders;\n    }\n    /**\n     * Used as a callback for mutating the given `FinalRequestOptions` object.\n     */\n    async prepareOptions(options) { }\n    /**\n     * Used as a callback for mutating the given `RequestInit` object.\n     *\n     * This is useful for cases where you want to add certain headers based off of\n     * the request properties, e.g. `method` or `url`.\n     */\n    async prepareRequest(request, { url, options }) { }\n    parseHeaders(headers) {\n        return (!headers ? {}\n            : Symbol.iterator in headers ?\n                Object.fromEntries(Array.from(headers).map((header) => [...header]))\n                : { ...headers });\n    }\n    makeStatusError(status, error, message, headers) {\n        return APIError.generate(status, error, message, headers);\n    }\n    request(options, remainingRetries = null) {\n        return new APIPromise(this.makeRequest(options, remainingRetries));\n    }\n    async makeRequest(optionsInput, retriesRemaining) {\n        const options = await optionsInput;\n        const maxRetries = options.maxRetries ?? this.maxRetries;\n        if (retriesRemaining == null) {\n            retriesRemaining = maxRetries;\n        }\n        await this.prepareOptions(options);\n        const { req, url, timeout } = this.buildRequest(options, { retryCount: maxRetries - retriesRemaining });\n        await this.prepareRequest(req, { url, options });\n        debug('request', url, options, req.headers);\n        if (options.signal?.aborted) {\n            throw new APIUserAbortError();\n        }\n        const controller = new AbortController();\n        const response = await this.fetchWithTimeout(url, req, timeout, controller).catch(castToError);\n        if (response instanceof Error) {\n            if (options.signal?.aborted) {\n                throw new APIUserAbortError();\n            }\n            if (retriesRemaining) {\n                return this.retryRequest(options, retriesRemaining);\n            }\n            if (response.name === 'AbortError') {\n                throw new APIConnectionTimeoutError();\n            }\n            throw new APIConnectionError({ cause: response });\n        }\n        const responseHeaders = createResponseHeaders(response.headers);\n        if (!response.ok) {\n            if (retriesRemaining && this.shouldRetry(response)) {\n                const retryMessage = `retrying, ${retriesRemaining} attempts remaining`;\n                debug(`response (error; ${retryMessage})`, response.status, url, responseHeaders);\n                return this.retryRequest(options, retriesRemaining, responseHeaders);\n            }\n            const errText = await response.text().catch((e) => castToError(e).message);\n            const errJSON = safeJSON(errText);\n            const errMessage = errJSON ? undefined : errText;\n            const retryMessage = retriesRemaining ? `(error; no more retries left)` : `(error; not retryable)`;\n            debug(`response (error; ${retryMessage})`, response.status, url, responseHeaders, errMessage);\n            const err = this.makeStatusError(response.status, errJSON, errMessage, responseHeaders);\n            throw err;\n        }\n        return { response, options, controller };\n    }\n    requestAPIList(Page, options) {\n        const request = this.makeRequest(options, null);\n        return new PagePromise(this, request, Page);\n    }\n    buildURL(path, query) {\n        const url = isAbsoluteURL(path) ?\n            new URL(path)\n            : new URL(this.baseURL + (this.baseURL.endsWith('/') && path.startsWith('/') ? path.slice(1) : path));\n        const defaultQuery = this.defaultQuery();\n        if (!isEmptyObj(defaultQuery)) {\n            query = { ...defaultQuery, ...query };\n        }\n        if (typeof query === 'object' && query && !Array.isArray(query)) {\n            url.search = this.stringifyQuery(query);\n        }\n        return url.toString();\n    }\n    stringifyQuery(query) {\n        return Object.entries(query)\n            .filter(([_, value]) => typeof value !== 'undefined')\n            .map(([key, value]) => {\n            if (typeof value === 'string' || typeof value === 'number' || typeof value === 'boolean') {\n                return `${encodeURIComponent(key)}=${encodeURIComponent(value)}`;\n            }\n            if (value === null) {\n                return `${encodeURIComponent(key)}=`;\n            }\n            throw new OpenAIError(`Cannot stringify type ${typeof value}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`);\n        })\n            .join('&');\n    }\n    async fetchWithTimeout(url, init, ms, controller) {\n        const { signal, ...options } = init || {};\n        if (signal)\n            signal.addEventListener('abort', () => controller.abort());\n        const timeout = setTimeout(() => controller.abort(), ms);\n        const fetchOptions = {\n            signal: controller.signal,\n            ...options,\n        };\n        if (fetchOptions.method) {\n            // Custom methods like 'patch' need to be uppercased\n            // See https://github.com/nodejs/undici/issues/2294\n            fetchOptions.method = fetchOptions.method.toUpperCase();\n        }\n        return (\n        // use undefined this binding; fetch errors if bound to something else in browser/cloudflare\n        this.fetch.call(undefined, url, fetchOptions).finally(() => {\n            clearTimeout(timeout);\n        }));\n    }\n    shouldRetry(response) {\n        // Note this is not a standard header.\n        const shouldRetryHeader = response.headers.get('x-should-retry');\n        // If the server explicitly says whether or not to retry, obey.\n        if (shouldRetryHeader === 'true')\n            return true;\n        if (shouldRetryHeader === 'false')\n            return false;\n        // Retry on request timeouts.\n        if (response.status === 408)\n            return true;\n        // Retry on lock timeouts.\n        if (response.status === 409)\n            return true;\n        // Retry on rate limits.\n        if (response.status === 429)\n            return true;\n        // Retry internal errors.\n        if (response.status >= 500)\n            return true;\n        return false;\n    }\n    async retryRequest(options, retriesRemaining, responseHeaders) {\n        let timeoutMillis;\n        // Note the `retry-after-ms` header may not be standard, but is a good idea and we'd like proactive support for it.\n        const retryAfterMillisHeader = responseHeaders?.['retry-after-ms'];\n        if (retryAfterMillisHeader) {\n            const timeoutMs = parseFloat(retryAfterMillisHeader);\n            if (!Number.isNaN(timeoutMs)) {\n                timeoutMillis = timeoutMs;\n            }\n        }\n        // About the Retry-After header: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Retry-After\n        const retryAfterHeader = responseHeaders?.['retry-after'];\n        if (retryAfterHeader && !timeoutMillis) {\n            const timeoutSeconds = parseFloat(retryAfterHeader);\n            if (!Number.isNaN(timeoutSeconds)) {\n                timeoutMillis = timeoutSeconds * 1000;\n            }\n            else {\n                timeoutMillis = Date.parse(retryAfterHeader) - Date.now();\n            }\n        }\n        // If the API asks us to wait a certain amount of time (and it's a reasonable amount),\n        // just do what it says, but otherwise calculate a default\n        if (!(timeoutMillis && 0 <= timeoutMillis && timeoutMillis < 60 * 1000)) {\n            const maxRetries = options.maxRetries ?? this.maxRetries;\n            timeoutMillis = this.calculateDefaultRetryTimeoutMillis(retriesRemaining, maxRetries);\n        }\n        await sleep(timeoutMillis);\n        return this.makeRequest(options, retriesRemaining - 1);\n    }\n    calculateDefaultRetryTimeoutMillis(retriesRemaining, maxRetries) {\n        const initialRetryDelay = 0.5;\n        const maxRetryDelay = 8.0;\n        const numRetries = maxRetries - retriesRemaining;\n        // Apply exponential backoff, but not more than the max.\n        const sleepSeconds = Math.min(initialRetryDelay * Math.pow(2, numRetries), maxRetryDelay);\n        // Apply some jitter, take up to at most 25 percent of the retry time.\n        const jitter = 1 - Math.random() * 0.25;\n        return sleepSeconds * jitter * 1000;\n    }\n    getUserAgent() {\n        return `${this.constructor.name}/JS ${VERSION}`;\n    }\n}\nexport class AbstractPage {\n    constructor(client, response, body, options) {\n        _AbstractPage_client.set(this, void 0);\n        __classPrivateFieldSet(this, _AbstractPage_client, client, \"f\");\n        this.options = options;\n        this.response = response;\n        this.body = body;\n    }\n    hasNextPage() {\n        const items = this.getPaginatedItems();\n        if (!items.length)\n            return false;\n        return this.nextPageInfo() != null;\n    }\n    async getNextPage() {\n        const nextInfo = this.nextPageInfo();\n        if (!nextInfo) {\n            throw new OpenAIError('No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.');\n        }\n        const nextOptions = { ...this.options };\n        if ('params' in nextInfo && typeof nextOptions.query === 'object') {\n            nextOptions.query = { ...nextOptions.query, ...nextInfo.params };\n        }\n        else if ('url' in nextInfo) {\n            const params = [...Object.entries(nextOptions.query || {}), ...nextInfo.url.searchParams.entries()];\n            for (const [key, value] of params) {\n                nextInfo.url.searchParams.set(key, value);\n            }\n            nextOptions.query = undefined;\n            nextOptions.path = nextInfo.url.toString();\n        }\n        return await __classPrivateFieldGet(this, _AbstractPage_client, \"f\").requestAPIList(this.constructor, nextOptions);\n    }\n    async *iterPages() {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        let page = this;\n        yield page;\n        while (page.hasNextPage()) {\n            page = await page.getNextPage();\n            yield page;\n        }\n    }\n    async *[(_AbstractPage_client = new WeakMap(), Symbol.asyncIterator)]() {\n        for await (const page of this.iterPages()) {\n            for (const item of page.getPaginatedItems()) {\n                yield item;\n            }\n        }\n    }\n}\n/**\n * This subclass of Promise will resolve to an instantiated Page once the request completes.\n *\n * It also implements AsyncIterable to allow auto-paginating iteration on an unawaited list call, eg:\n *\n *    for await (const item of client.items.list()) {\n *      console.log(item)\n *    }\n */\nexport class PagePromise extends APIPromise {\n    constructor(client, request, Page) {\n        super(request, async (props) => new Page(client, props.response, await defaultParseResponse(props), props.options));\n    }\n    /**\n     * Allow auto-paginating iteration on an unawaited list call, eg:\n     *\n     *    for await (const item of client.items.list()) {\n     *      console.log(item)\n     *    }\n     */\n    async *[Symbol.asyncIterator]() {\n        const page = await this;\n        for await (const item of page) {\n            yield item;\n        }\n    }\n}\nexport const createResponseHeaders = (headers) => {\n    return new Proxy(Object.fromEntries(\n    // @ts-ignore\n    headers.entries()), {\n        get(target, name) {\n            const key = name.toString();\n            return target[key.toLowerCase()] || target[key];\n        },\n    });\n};\n// This is required so that we can determine if a given object matches the RequestOptions\n// type at runtime. While this requires duplication, it is enforced by the TypeScript\n// compiler such that any missing / extraneous keys will cause an error.\nconst requestOptionsKeys = {\n    method: true,\n    path: true,\n    query: true,\n    body: true,\n    headers: true,\n    maxRetries: true,\n    stream: true,\n    timeout: true,\n    httpAgent: true,\n    signal: true,\n    idempotencyKey: true,\n    __metadata: true,\n    __binaryRequest: true,\n    __binaryResponse: true,\n    __streamClass: true,\n};\nexport const isRequestOptions = (obj) => {\n    return (typeof obj === 'object' &&\n        obj !== null &&\n        !isEmptyObj(obj) &&\n        Object.keys(obj).every((k) => hasOwn(requestOptionsKeys, k)));\n};\nconst getPlatformProperties = () => {\n    if (typeof Deno !== 'undefined' && Deno.build != null) {\n        return {\n            'X-Stainless-Lang': 'js',\n            'X-Stainless-Package-Version': VERSION,\n            'X-Stainless-OS': normalizePlatform(Deno.build.os),\n            'X-Stainless-Arch': normalizeArch(Deno.build.arch),\n            'X-Stainless-Runtime': 'deno',\n            'X-Stainless-Runtime-Version': typeof Deno.version === 'string' ? Deno.version : Deno.version?.deno ?? 'unknown',\n        };\n    }\n    if (typeof EdgeRuntime !== 'undefined') {\n        return {\n            'X-Stainless-Lang': 'js',\n            'X-Stainless-Package-Version': VERSION,\n            'X-Stainless-OS': 'Unknown',\n            'X-Stainless-Arch': `other:${EdgeRuntime}`,\n            'X-Stainless-Runtime': 'edge',\n            'X-Stainless-Runtime-Version': process.version,\n        };\n    }\n    // Check if Node.js\n    if (Object.prototype.toString.call(typeof process !== 'undefined' ? process : 0) === '[object process]') {\n        return {\n            'X-Stainless-Lang': 'js',\n            'X-Stainless-Package-Version': VERSION,\n            'X-Stainless-OS': normalizePlatform(process.platform),\n            'X-Stainless-Arch': normalizeArch(process.arch),\n            'X-Stainless-Runtime': 'node',\n            'X-Stainless-Runtime-Version': process.version,\n        };\n    }\n    const browserInfo = getBrowserInfo();\n    if (browserInfo) {\n        return {\n            'X-Stainless-Lang': 'js',\n            'X-Stainless-Package-Version': VERSION,\n            'X-Stainless-OS': 'Unknown',\n            'X-Stainless-Arch': 'unknown',\n            'X-Stainless-Runtime': `browser:${browserInfo.browser}`,\n            'X-Stainless-Runtime-Version': browserInfo.version,\n        };\n    }\n    // TODO add support for Cloudflare workers, etc.\n    return {\n        'X-Stainless-Lang': 'js',\n        'X-Stainless-Package-Version': VERSION,\n        'X-Stainless-OS': 'Unknown',\n        'X-Stainless-Arch': 'unknown',\n        'X-Stainless-Runtime': 'unknown',\n        'X-Stainless-Runtime-Version': 'unknown',\n    };\n};\n// Note: modified from https://github.com/JS-DevTools/host-environment/blob/b1ab79ecde37db5d6e163c050e54fe7d287d7c92/src/isomorphic.browser.ts\nfunction getBrowserInfo() {\n    if (typeof navigator === 'undefined' || !navigator) {\n        return null;\n    }\n    // NOTE: The order matters here!\n    const browserPatterns = [\n        { key: 'edge', pattern: /Edge(?:\\W+(\\d+)\\.(\\d+)(?:\\.(\\d+))?)?/ },\n        { key: 'ie', pattern: /MSIE(?:\\W+(\\d+)\\.(\\d+)(?:\\.(\\d+))?)?/ },\n        { key: 'ie', pattern: /Trident(?:.*rv\\:(\\d+)\\.(\\d+)(?:\\.(\\d+))?)?/ },\n        { key: 'chrome', pattern: /Chrome(?:\\W+(\\d+)\\.(\\d+)(?:\\.(\\d+))?)?/ },\n        { key: 'firefox', pattern: /Firefox(?:\\W+(\\d+)\\.(\\d+)(?:\\.(\\d+))?)?/ },\n        { key: 'safari', pattern: /(?:Version\\W+(\\d+)\\.(\\d+)(?:\\.(\\d+))?)?(?:\\W+Mobile\\S*)?\\W+Safari/ },\n    ];\n    // Find the FIRST matching browser\n    for (const { key, pattern } of browserPatterns) {\n        const match = pattern.exec(navigator.userAgent);\n        if (match) {\n            const major = match[1] || 0;\n            const minor = match[2] || 0;\n            const patch = match[3] || 0;\n            return { browser: key, version: `${major}.${minor}.${patch}` };\n        }\n    }\n    return null;\n}\nconst normalizeArch = (arch) => {\n    // Node docs:\n    // - https://nodejs.org/api/process.html#processarch\n    // Deno docs:\n    // - https://doc.deno.land/deno/stable/~/Deno.build\n    if (arch === 'x32')\n        return 'x32';\n    if (arch === 'x86_64' || arch === 'x64')\n        return 'x64';\n    if (arch === 'arm')\n        return 'arm';\n    if (arch === 'aarch64' || arch === 'arm64')\n        return 'arm64';\n    if (arch)\n        return `other:${arch}`;\n    return 'unknown';\n};\nconst normalizePlatform = (platform) => {\n    // Node platforms:\n    // - https://nodejs.org/api/process.html#processplatform\n    // Deno platforms:\n    // - https://doc.deno.land/deno/stable/~/Deno.build\n    // - https://github.com/denoland/deno/issues/14799\n    platform = platform.toLowerCase();\n    // NOTE: this iOS check is untested and may not work\n    // Node does not work natively on IOS, there is a fork at\n    // https://github.com/nodejs-mobile/nodejs-mobile\n    // however it is unknown at the time of writing how to detect if it is running\n    if (platform.includes('ios'))\n        return 'iOS';\n    if (platform === 'android')\n        return 'Android';\n    if (platform === 'darwin')\n        return 'MacOS';\n    if (platform === 'win32')\n        return 'Windows';\n    if (platform === 'freebsd')\n        return 'FreeBSD';\n    if (platform === 'openbsd')\n        return 'OpenBSD';\n    if (platform === 'linux')\n        return 'Linux';\n    if (platform)\n        return `Other:${platform}`;\n    return 'Unknown';\n};\nlet _platformHeaders;\nconst getPlatformHeaders = () => {\n    return (_platformHeaders ?? (_platformHeaders = getPlatformProperties()));\n};\nexport const safeJSON = (text) => {\n    try {\n        return JSON.parse(text);\n    }\n    catch (err) {\n        return undefined;\n    }\n};\n// https://url.spec.whatwg.org/#url-scheme-string\nconst startsWithSchemeRegexp = /^[a-z][a-z0-9+.-]*:/i;\nconst isAbsoluteURL = (url) => {\n    return startsWithSchemeRegexp.test(url);\n};\nexport const sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));\nconst validatePositiveInteger = (name, n) => {\n    if (typeof n !== 'number' || !Number.isInteger(n)) {\n        throw new OpenAIError(`${name} must be an integer`);\n    }\n    if (n < 0) {\n        throw new OpenAIError(`${name} must be a positive integer`);\n    }\n    return n;\n};\nexport const castToError = (err) => {\n    if (err instanceof Error)\n        return err;\n    if (typeof err === 'object' && err !== null) {\n        try {\n            return new Error(JSON.stringify(err));\n        }\n        catch { }\n    }\n    return new Error(err);\n};\nexport const ensurePresent = (value) => {\n    if (value == null)\n        throw new OpenAIError(`Expected a value to be given but received ${value} instead.`);\n    return value;\n};\n/**\n * Read an environment variable.\n *\n * Trims beginning and trailing whitespace.\n *\n * Will return undefined if the environment variable doesn't exist or cannot be accessed.\n */\nexport const readEnv = (env) => {\n    if (typeof process !== 'undefined') {\n        return process.env?.[env]?.trim() ?? undefined;\n    }\n    if (typeof Deno !== 'undefined') {\n        return Deno.env?.get?.(env)?.trim();\n    }\n    return undefined;\n};\nexport const coerceInteger = (value) => {\n    if (typeof value === 'number')\n        return Math.round(value);\n    if (typeof value === 'string')\n        return parseInt(value, 10);\n    throw new OpenAIError(`Could not coerce ${value} (type: ${typeof value}) into a number`);\n};\nexport const coerceFloat = (value) => {\n    if (typeof value === 'number')\n        return value;\n    if (typeof value === 'string')\n        return parseFloat(value);\n    throw new OpenAIError(`Could not coerce ${value} (type: ${typeof value}) into a number`);\n};\nexport const coerceBoolean = (value) => {\n    if (typeof value === 'boolean')\n        return value;\n    if (typeof value === 'string')\n        return value === 'true';\n    return Boolean(value);\n};\nexport const maybeCoerceInteger = (value) => {\n    if (value === undefined) {\n        return undefined;\n    }\n    return coerceInteger(value);\n};\nexport const maybeCoerceFloat = (value) => {\n    if (value === undefined) {\n        return undefined;\n    }\n    return coerceFloat(value);\n};\nexport const maybeCoerceBoolean = (value) => {\n    if (value === undefined) {\n        return undefined;\n    }\n    return coerceBoolean(value);\n};\n// https://stackoverflow.com/a/34491287\nexport function isEmptyObj(obj) {\n    if (!obj)\n        return true;\n    for (const _k in obj)\n        return false;\n    return true;\n}\n// https://eslint.org/docs/latest/rules/no-prototype-builtins\nexport function hasOwn(obj, key) {\n    return Object.prototype.hasOwnProperty.call(obj, key);\n}\n/**\n * Copies headers from \"newHeaders\" onto \"targetHeaders\",\n * using lower-case for all properties,\n * ignoring any keys with undefined values,\n * and deleting any keys with null values.\n */\nfunction applyHeadersMut(targetHeaders, newHeaders) {\n    for (const k in newHeaders) {\n        if (!hasOwn(newHeaders, k))\n            continue;\n        const lowerKey = k.toLowerCase();\n        if (!lowerKey)\n            continue;\n        const val = newHeaders[k];\n        if (val === null) {\n            delete targetHeaders[lowerKey];\n        }\n        else if (val !== undefined) {\n            targetHeaders[lowerKey] = val;\n        }\n    }\n}\nconst SENSITIVE_HEADERS = new Set(['authorization', 'api-key']);\nexport function debug(action, ...args) {\n    if (typeof process !== 'undefined' && process?.env?.['DEBUG'] === 'true') {\n        const modifiedArgs = args.map((arg) => {\n            if (!arg) {\n                return arg;\n            }\n            // Check for sensitive headers in request body 'headers' object\n            if (arg['headers']) {\n                // clone so we don't mutate\n                const modifiedArg = { ...arg, headers: { ...arg['headers'] } };\n                for (const header in arg['headers']) {\n                    if (SENSITIVE_HEADERS.has(header.toLowerCase())) {\n                        modifiedArg['headers'][header] = 'REDACTED';\n                    }\n                }\n                return modifiedArg;\n            }\n            let modifiedArg = null;\n            // Check for sensitive headers in headers object\n            for (const header in arg) {\n                if (SENSITIVE_HEADERS.has(header.toLowerCase())) {\n                    // avoid making a copy until we need to\n                    modifiedArg ?? (modifiedArg = { ...arg });\n                    modifiedArg[header] = 'REDACTED';\n                }\n            }\n            return modifiedArg ?? arg;\n        });\n        console.log(`OpenAI:DEBUG:${action}`, ...modifiedArgs);\n    }\n}\n/**\n * https://stackoverflow.com/a/2117523\n */\nconst uuid4 = () => {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n        const r = (Math.random() * 16) | 0;\n        const v = c === 'x' ? r : (r & 0x3) | 0x8;\n        return v.toString(16);\n    });\n};\nexport const isRunningInBrowser = () => {\n    return (\n    // @ts-ignore\n    typeof window !== 'undefined' &&\n        // @ts-ignore\n        typeof window.document !== 'undefined' &&\n        // @ts-ignore\n        typeof navigator !== 'undefined');\n};\nexport const isHeadersProtocol = (headers) => {\n    return typeof headers?.get === 'function';\n};\nexport const getRequiredHeader = (headers, header) => {\n    const foundHeader = getHeader(headers, header);\n    if (foundHeader === undefined) {\n        throw new Error(`Could not find ${header} header`);\n    }\n    return foundHeader;\n};\nexport const getHeader = (headers, header) => {\n    const lowerCasedHeader = header.toLowerCase();\n    if (isHeadersProtocol(headers)) {\n        // to deal with the case where the header looks like Stainless-Event-Id\n        const intercapsHeader = header[0]?.toUpperCase() +\n            header.substring(1).replace(/([^\\w])(\\w)/g, (_m, g1, g2) => g1 + g2.toUpperCase());\n        for (const key of [header, lowerCasedHeader, header.toUpperCase(), intercapsHeader]) {\n            const value = headers.get(key);\n            if (value) {\n                return value;\n            }\n        }\n    }\n    for (const [key, value] of Object.entries(headers)) {\n        if (key.toLowerCase() === lowerCasedHeader) {\n            if (Array.isArray(value)) {\n                if (value.length <= 1)\n                    return value[0];\n                console.warn(`Received ${value.length} entries for the ${header} header, using the first entry.`);\n                return value[0];\n            }\n            return value;\n        }\n    }\n    return undefined;\n};\n/**\n * Encodes a string to Base64 format.\n */\nexport const toBase64 = (str) => {\n    if (!str)\n        return '';\n    if (typeof Buffer !== 'undefined') {\n        return Buffer.from(str).toString('base64');\n    }\n    if (typeof btoa !== 'undefined') {\n        return btoa(str);\n    }\n    throw new OpenAIError('Cannot generate b64 string; Expected `Buffer` or `btoa` to be defined');\n};\n/**\n * Converts a Base64 encoded string to a Float32Array.\n * @param base64Str - The Base64 encoded string.\n * @returns An Array of numbers interpreted as Float32 values.\n */\nexport const toFloat32Array = (base64Str) => {\n    if (typeof Buffer !== 'undefined') {\n        // for Node.js environment\n        const buf = Buffer.from(base64Str, 'base64');\n        return Array.from(new Float32Array(buf.buffer, buf.byteOffset, buf.length / Float32Array.BYTES_PER_ELEMENT));\n    }\n    else {\n        // for legacy web platform APIs\n        const binaryStr = atob(base64Str);\n        const len = binaryStr.length;\n        const bytes = new Uint8Array(len);\n        for (let i = 0; i < len; i++) {\n            bytes[i] = binaryStr.charCodeAt(i);\n        }\n        return Array.from(new Float32Array(bytes.buffer));\n    }\n};\nexport function isObj(obj) {\n    return obj != null && typeof obj === 'object' && !Array.isArray(obj);\n}\n//# sourceMappingURL=core.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { AbstractPage } from \"./core.mjs\";\n/**\n * Note: no pagination actually occurs yet, this is for forwards-compatibility.\n */\nexport class Page extends AbstractPage {\n    constructor(client, response, body, options) {\n        super(client, response, body, options);\n        this.data = body.data || [];\n        this.object = body.object;\n    }\n    getPaginatedItems() {\n        return this.data ?? [];\n    }\n    // @deprecated Please use `nextPageInfo()` instead\n    /**\n     * This page represents a response that isn't actually paginated at the API level\n     * so there will never be any next page params.\n     */\n    nextPageParams() {\n        return null;\n    }\n    nextPageInfo() {\n        return null;\n    }\n}\nexport class CursorPage extends AbstractPage {\n    constructor(client, response, body, options) {\n        super(client, response, body, options);\n        this.data = body.data || [];\n        this.has_more = body.has_more || false;\n    }\n    getPaginatedItems() {\n        return this.data ?? [];\n    }\n    hasNextPage() {\n        if (this.has_more === false) {\n            return false;\n        }\n        return super.hasNextPage();\n    }\n    // @deprecated Please use `nextPageInfo()` instead\n    nextPageParams() {\n        const info = this.nextPageInfo();\n        if (!info)\n            return null;\n        if ('params' in info)\n            return info.params;\n        const params = Object.fromEntries(info.url.searchParams);\n        if (!Object.keys(params).length)\n            return null;\n        return params;\n    }\n    nextPageInfo() {\n        const data = this.getPaginatedItems();\n        if (!data.length) {\n            return null;\n        }\n        const id = data[data.length - 1]?.id;\n        if (!id) {\n            return null;\n        }\n        return { params: { after: id } };\n    }\n}\n//# sourceMappingURL=pagination.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nexport class APIResource {\n    constructor(client) {\n        this._client = client;\n    }\n}\n//# sourceMappingURL=resource.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../resource.mjs\";\nimport { isRequestOptions } from \"../../../core.mjs\";\nimport { ChatCompletionStoreMessagesPage } from \"./completions.mjs\";\nexport class Messages extends APIResource {\n    list(completionId, query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.list(completionId, {}, query);\n        }\n        return this._client.getAPIList(`/chat/completions/${completionId}/messages`, ChatCompletionStoreMessagesPage, { query, ...options });\n    }\n}\nexport { ChatCompletionStoreMessagesPage };\n//# sourceMappingURL=messages.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../resource.mjs\";\nimport { isRequestOptions } from \"../../../core.mjs\";\nimport * as MessagesAPI from \"./messages.mjs\";\nimport { Messages } from \"./messages.mjs\";\nimport { CursorPage } from \"../../../pagination.mjs\";\nexport class Completions extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.messages = new MessagesAPI.Messages(this._client);\n    }\n    create(body, options) {\n        return this._client.post('/chat/completions', { body, ...options, stream: body.stream ?? false });\n    }\n    /**\n     * Get a stored chat completion. Only Chat Completions that have been created with\n     * the `store` parameter set to `true` will be returned.\n     *\n     * @example\n     * ```ts\n     * const chatCompletion =\n     *   await client.chat.completions.retrieve('completion_id');\n     * ```\n     */\n    retrieve(completionId, options) {\n        return this._client.get(`/chat/completions/${completionId}`, options);\n    }\n    /**\n     * Modify a stored chat completion. Only Chat Completions that have been created\n     * with the `store` parameter set to `true` can be modified. Currently, the only\n     * supported modification is to update the `metadata` field.\n     *\n     * @example\n     * ```ts\n     * const chatCompletion = await client.chat.completions.update(\n     *   'completion_id',\n     *   { metadata: { foo: 'string' } },\n     * );\n     * ```\n     */\n    update(completionId, body, options) {\n        return this._client.post(`/chat/completions/${completionId}`, { body, ...options });\n    }\n    list(query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.list({}, query);\n        }\n        return this._client.getAPIList('/chat/completions', ChatCompletionsPage, { query, ...options });\n    }\n    /**\n     * Delete a stored chat completion. Only Chat Completions that have been created\n     * with the `store` parameter set to `true` can be deleted.\n     *\n     * @example\n     * ```ts\n     * const chatCompletionDeleted =\n     *   await client.chat.completions.del('completion_id');\n     * ```\n     */\n    del(completionId, options) {\n        return this._client.delete(`/chat/completions/${completionId}`, options);\n    }\n}\nexport class ChatCompletionsPage extends CursorPage {\n}\nexport class ChatCompletionStoreMessagesPage extends CursorPage {\n}\nCompletions.ChatCompletionsPage = ChatCompletionsPage;\nCompletions.Messages = Messages;\n//# sourceMappingURL=completions.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../resource.mjs\";\nimport * as CompletionsAPI from \"./completions/completions.mjs\";\nimport { ChatCompletionsPage, Completions, } from \"./completions/completions.mjs\";\nexport class Chat extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.completions = new CompletionsAPI.Completions(this._client);\n    }\n}\nChat.Completions = Completions;\nChat.ChatCompletionsPage = ChatCompletionsPage;\n//# sourceMappingURL=chat.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../resource.mjs\";\nexport class Speech extends APIResource {\n    /**\n     * Generates audio from the input text.\n     *\n     * @example\n     * ```ts\n     * const speech = await client.audio.speech.create({\n     *   input: 'input',\n     *   model: 'string',\n     *   voice: 'ash',\n     * });\n     *\n     * const content = await speech.blob();\n     * console.log(content);\n     * ```\n     */\n    create(body, options) {\n        return this._client.post('/audio/speech', {\n            body,\n            ...options,\n            headers: { Accept: 'application/octet-stream', ...options?.headers },\n            __binaryResponse: true,\n        });\n    }\n}\n//# sourceMappingURL=speech.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../resource.mjs\";\nimport * as Core from \"../../core.mjs\";\nexport class Transcriptions extends APIResource {\n    create(body, options) {\n        return this._client.post('/audio/transcriptions', Core.multipartFormRequestOptions({\n            body,\n            ...options,\n            stream: body.stream ?? false,\n            __metadata: { model: body.model },\n        }));\n    }\n}\n//# sourceMappingURL=transcriptions.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../resource.mjs\";\nimport * as Core from \"../../core.mjs\";\nexport class Translations extends APIResource {\n    create(body, options) {\n        return this._client.post('/audio/translations', Core.multipartFormRequestOptions({ body, ...options, __metadata: { model: body.model } }));\n    }\n}\n//# sourceMappingURL=translations.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../resource.mjs\";\nimport * as SpeechAPI from \"./speech.mjs\";\nimport { Speech } from \"./speech.mjs\";\nimport * as TranscriptionsAPI from \"./transcriptions.mjs\";\nimport { Transcriptions, } from \"./transcriptions.mjs\";\nimport * as TranslationsAPI from \"./translations.mjs\";\nimport { Translations, } from \"./translations.mjs\";\nexport class Audio extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.transcriptions = new TranscriptionsAPI.Transcriptions(this._client);\n        this.translations = new TranslationsAPI.Translations(this._client);\n        this.speech = new SpeechAPI.Speech(this._client);\n    }\n}\nAudio.Transcriptions = Transcriptions;\nAudio.Translations = Translations;\nAudio.Speech = Speech;\n//# sourceMappingURL=audio.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../resource.mjs\";\nimport { isRequestOptions } from \"../core.mjs\";\nimport { CursorPage } from \"../pagination.mjs\";\nexport class Batches extends APIResource {\n    /**\n     * Creates and executes a batch from an uploaded file of requests\n     */\n    create(body, options) {\n        return this._client.post('/batches', { body, ...options });\n    }\n    /**\n     * Retrieves a batch.\n     */\n    retrieve(batchId, options) {\n        return this._client.get(`/batches/${batchId}`, options);\n    }\n    list(query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.list({}, query);\n        }\n        return this._client.getAPIList('/batches', BatchesPage, { query, ...options });\n    }\n    /**\n     * Cancels an in-progress batch. The batch will be in status `cancelling` for up to\n     * 10 minutes, before changing to `cancelled`, where it will have partial results\n     * (if any) available in the output file.\n     */\n    cancel(batchId, options) {\n        return this._client.post(`/batches/${batchId}/cancel`, options);\n    }\n}\nexport class BatchesPage extends CursorPage {\n}\nBatches.BatchesPage = BatchesPage;\n//# sourceMappingURL=batches.mjs.map","var __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _EventStream_instances, _EventStream_connectedPromise, _EventStream_resolveConnectedPromise, _EventStream_rejectConnectedPromise, _EventStream_endPromise, _EventStream_resolveEndPromise, _EventStream_rejectEndPromise, _EventStream_listeners, _EventStream_ended, _EventStream_errored, _EventStream_aborted, _EventStream_catchingPromiseCreated, _EventStream_handleError;\nimport { APIUserAbortError, OpenAIError } from \"../error.mjs\";\nexport class EventStream {\n    constructor() {\n        _EventStream_instances.add(this);\n        this.controller = new AbortController();\n        _EventStream_connectedPromise.set(this, void 0);\n        _EventStream_resolveConnectedPromise.set(this, () => { });\n        _EventStream_rejectConnectedPromise.set(this, () => { });\n        _EventStream_endPromise.set(this, void 0);\n        _EventStream_resolveEndPromise.set(this, () => { });\n        _EventStream_rejectEndPromise.set(this, () => { });\n        _EventStream_listeners.set(this, {});\n        _EventStream_ended.set(this, false);\n        _EventStream_errored.set(this, false);\n        _EventStream_aborted.set(this, false);\n        _EventStream_catchingPromiseCreated.set(this, false);\n        __classPrivateFieldSet(this, _EventStream_connectedPromise, new Promise((resolve, reject) => {\n            __classPrivateFieldSet(this, _EventStream_resolveConnectedPromise, resolve, \"f\");\n            __classPrivateFieldSet(this, _EventStream_rejectConnectedPromise, reject, \"f\");\n        }), \"f\");\n        __classPrivateFieldSet(this, _EventStream_endPromise, new Promise((resolve, reject) => {\n            __classPrivateFieldSet(this, _EventStream_resolveEndPromise, resolve, \"f\");\n            __classPrivateFieldSet(this, _EventStream_rejectEndPromise, reject, \"f\");\n        }), \"f\");\n        // Don't let these promises cause unhandled rejection errors.\n        // we will manually cause an unhandled rejection error later\n        // if the user hasn't registered any error listener or called\n        // any promise-returning method.\n        __classPrivateFieldGet(this, _EventStream_connectedPromise, \"f\").catch(() => { });\n        __classPrivateFieldGet(this, _EventStream_endPromise, \"f\").catch(() => { });\n    }\n    _run(executor) {\n        // Unfortunately if we call `executor()` immediately we get runtime errors about\n        // references to `this` before the `super()` constructor call returns.\n        setTimeout(() => {\n            executor().then(() => {\n                this._emitFinal();\n                this._emit('end');\n            }, __classPrivateFieldGet(this, _EventStream_instances, \"m\", _EventStream_handleError).bind(this));\n        }, 0);\n    }\n    _connected() {\n        if (this.ended)\n            return;\n        __classPrivateFieldGet(this, _EventStream_resolveConnectedPromise, \"f\").call(this);\n        this._emit('connect');\n    }\n    get ended() {\n        return __classPrivateFieldGet(this, _EventStream_ended, \"f\");\n    }\n    get errored() {\n        return __classPrivateFieldGet(this, _EventStream_errored, \"f\");\n    }\n    get aborted() {\n        return __classPrivateFieldGet(this, _EventStream_aborted, \"f\");\n    }\n    abort() {\n        this.controller.abort();\n    }\n    /**\n     * Adds the listener function to the end of the listeners array for the event.\n     * No checks are made to see if the listener has already been added. Multiple calls passing\n     * the same combination of event and listener will result in the listener being added, and\n     * called, multiple times.\n     * @returns this ChatCompletionStream, so that calls can be chained\n     */\n    on(event, listener) {\n        const listeners = __classPrivateFieldGet(this, _EventStream_listeners, \"f\")[event] || (__classPrivateFieldGet(this, _EventStream_listeners, \"f\")[event] = []);\n        listeners.push({ listener });\n        return this;\n    }\n    /**\n     * Removes the specified listener from the listener array for the event.\n     * off() will remove, at most, one instance of a listener from the listener array. If any single\n     * listener has been added multiple times to the listener array for the specified event, then\n     * off() must be called multiple times to remove each instance.\n     * @returns this ChatCompletionStream, so that calls can be chained\n     */\n    off(event, listener) {\n        const listeners = __classPrivateFieldGet(this, _EventStream_listeners, \"f\")[event];\n        if (!listeners)\n            return this;\n        const index = listeners.findIndex((l) => l.listener === listener);\n        if (index >= 0)\n            listeners.splice(index, 1);\n        return this;\n    }\n    /**\n     * Adds a one-time listener function for the event. The next time the event is triggered,\n     * this listener is removed and then invoked.\n     * @returns this ChatCompletionStream, so that calls can be chained\n     */\n    once(event, listener) {\n        const listeners = __classPrivateFieldGet(this, _EventStream_listeners, \"f\")[event] || (__classPrivateFieldGet(this, _EventStream_listeners, \"f\")[event] = []);\n        listeners.push({ listener, once: true });\n        return this;\n    }\n    /**\n     * This is similar to `.once()`, but returns a Promise that resolves the next time\n     * the event is triggered, instead of calling a listener callback.\n     * @returns a Promise that resolves the next time given event is triggered,\n     * or rejects if an error is emitted.  (If you request the 'error' event,\n     * returns a promise that resolves with the error).\n     *\n     * Example:\n     *\n     *   const message = await stream.emitted('message') // rejects if the stream errors\n     */\n    emitted(event) {\n        return new Promise((resolve, reject) => {\n            __classPrivateFieldSet(this, _EventStream_catchingPromiseCreated, true, \"f\");\n            if (event !== 'error')\n                this.once('error', reject);\n            this.once(event, resolve);\n        });\n    }\n    async done() {\n        __classPrivateFieldSet(this, _EventStream_catchingPromiseCreated, true, \"f\");\n        await __classPrivateFieldGet(this, _EventStream_endPromise, \"f\");\n    }\n    _emit(event, ...args) {\n        // make sure we don't emit any events after end\n        if (__classPrivateFieldGet(this, _EventStream_ended, \"f\")) {\n            return;\n        }\n        if (event === 'end') {\n            __classPrivateFieldSet(this, _EventStream_ended, true, \"f\");\n            __classPrivateFieldGet(this, _EventStream_resolveEndPromise, \"f\").call(this);\n        }\n        const listeners = __classPrivateFieldGet(this, _EventStream_listeners, \"f\")[event];\n        if (listeners) {\n            __classPrivateFieldGet(this, _EventStream_listeners, \"f\")[event] = listeners.filter((l) => !l.once);\n            listeners.forEach(({ listener }) => listener(...args));\n        }\n        if (event === 'abort') {\n            const error = args[0];\n            if (!__classPrivateFieldGet(this, _EventStream_catchingPromiseCreated, \"f\") && !listeners?.length) {\n                Promise.reject(error);\n            }\n            __classPrivateFieldGet(this, _EventStream_rejectConnectedPromise, \"f\").call(this, error);\n            __classPrivateFieldGet(this, _EventStream_rejectEndPromise, \"f\").call(this, error);\n            this._emit('end');\n            return;\n        }\n        if (event === 'error') {\n            // NOTE: _emit('error', error) should only be called from #handleError().\n            const error = args[0];\n            if (!__classPrivateFieldGet(this, _EventStream_catchingPromiseCreated, \"f\") && !listeners?.length) {\n                // Trigger an unhandled rejection if the user hasn't registered any error handlers.\n                // If you are seeing stack traces here, make sure to handle errors via either:\n                // - runner.on('error', () => ...)\n                // - await runner.done()\n                // - await runner.finalChatCompletion()\n                // - etc.\n                Promise.reject(error);\n            }\n            __classPrivateFieldGet(this, _EventStream_rejectConnectedPromise, \"f\").call(this, error);\n            __classPrivateFieldGet(this, _EventStream_rejectEndPromise, \"f\").call(this, error);\n            this._emit('end');\n        }\n    }\n    _emitFinal() { }\n}\n_EventStream_connectedPromise = new WeakMap(), _EventStream_resolveConnectedPromise = new WeakMap(), _EventStream_rejectConnectedPromise = new WeakMap(), _EventStream_endPromise = new WeakMap(), _EventStream_resolveEndPromise = new WeakMap(), _EventStream_rejectEndPromise = new WeakMap(), _EventStream_listeners = new WeakMap(), _EventStream_ended = new WeakMap(), _EventStream_errored = new WeakMap(), _EventStream_aborted = new WeakMap(), _EventStream_catchingPromiseCreated = new WeakMap(), _EventStream_instances = new WeakSet(), _EventStream_handleError = function _EventStream_handleError(error) {\n    __classPrivateFieldSet(this, _EventStream_errored, true, \"f\");\n    if (error instanceof Error && error.name === 'AbortError') {\n        error = new APIUserAbortError();\n    }\n    if (error instanceof APIUserAbortError) {\n        __classPrivateFieldSet(this, _EventStream_aborted, true, \"f\");\n        return this._emit('abort', error);\n    }\n    if (error instanceof OpenAIError) {\n        return this._emit('error', error);\n    }\n    if (error instanceof Error) {\n        const openAIError = new OpenAIError(error.message);\n        // @ts-ignore\n        openAIError.cause = error;\n        return this._emit('error', openAIError);\n    }\n    return this._emit('error', new OpenAIError(String(error)));\n};\n//# sourceMappingURL=EventStream.mjs.map","var __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar _AssistantStream_instances, _AssistantStream_events, _AssistantStream_runStepSnapshots, _AssistantStream_messageSnapshots, _AssistantStream_messageSnapshot, _AssistantStream_finalRun, _AssistantStream_currentContentIndex, _AssistantStream_currentContent, _AssistantStream_currentToolCallIndex, _AssistantStream_currentToolCall, _AssistantStream_currentEvent, _AssistantStream_currentRunSnapshot, _AssistantStream_currentRunStepSnapshot, _AssistantStream_addEvent, _AssistantStream_endRequest, _AssistantStream_handleMessage, _AssistantStream_handleRunStep, _AssistantStream_handleEvent, _AssistantStream_accumulateRunStep, _AssistantStream_accumulateMessage, _AssistantStream_accumulateContent, _AssistantStream_handleRun;\nimport * as Core from \"../core.mjs\";\nimport { Stream } from \"../streaming.mjs\";\nimport { APIUserAbortError, OpenAIError } from \"../error.mjs\";\nimport { EventStream } from \"./EventStream.mjs\";\nexport class AssistantStream extends EventStream {\n    constructor() {\n        super(...arguments);\n        _AssistantStream_instances.add(this);\n        //Track all events in a single list for reference\n        _AssistantStream_events.set(this, []);\n        //Used to accumulate deltas\n        //We are accumulating many types so the value here is not strict\n        _AssistantStream_runStepSnapshots.set(this, {});\n        _AssistantStream_messageSnapshots.set(this, {});\n        _AssistantStream_messageSnapshot.set(this, void 0);\n        _AssistantStream_finalRun.set(this, void 0);\n        _AssistantStream_currentContentIndex.set(this, void 0);\n        _AssistantStream_currentContent.set(this, void 0);\n        _AssistantStream_currentToolCallIndex.set(this, void 0);\n        _AssistantStream_currentToolCall.set(this, void 0);\n        //For current snapshot methods\n        _AssistantStream_currentEvent.set(this, void 0);\n        _AssistantStream_currentRunSnapshot.set(this, void 0);\n        _AssistantStream_currentRunStepSnapshot.set(this, void 0);\n    }\n    [(_AssistantStream_events = new WeakMap(), _AssistantStream_runStepSnapshots = new WeakMap(), _AssistantStream_messageSnapshots = new WeakMap(), _AssistantStream_messageSnapshot = new WeakMap(), _AssistantStream_finalRun = new WeakMap(), _AssistantStream_currentContentIndex = new WeakMap(), _AssistantStream_currentContent = new WeakMap(), _AssistantStream_currentToolCallIndex = new WeakMap(), _AssistantStream_currentToolCall = new WeakMap(), _AssistantStream_currentEvent = new WeakMap(), _AssistantStream_currentRunSnapshot = new WeakMap(), _AssistantStream_currentRunStepSnapshot = new WeakMap(), _AssistantStream_instances = new WeakSet(), Symbol.asyncIterator)]() {\n        const pushQueue = [];\n        const readQueue = [];\n        let done = false;\n        //Catch all for passing along all events\n        this.on('event', (event) => {\n            const reader = readQueue.shift();\n            if (reader) {\n                reader.resolve(event);\n            }\n            else {\n                pushQueue.push(event);\n            }\n        });\n        this.on('end', () => {\n            done = true;\n            for (const reader of readQueue) {\n                reader.resolve(undefined);\n            }\n            readQueue.length = 0;\n        });\n        this.on('abort', (err) => {\n            done = true;\n            for (const reader of readQueue) {\n                reader.reject(err);\n            }\n            readQueue.length = 0;\n        });\n        this.on('error', (err) => {\n            done = true;\n            for (const reader of readQueue) {\n                reader.reject(err);\n            }\n            readQueue.length = 0;\n        });\n        return {\n            next: async () => {\n                if (!pushQueue.length) {\n                    if (done) {\n                        return { value: undefined, done: true };\n                    }\n                    return new Promise((resolve, reject) => readQueue.push({ resolve, reject })).then((chunk) => (chunk ? { value: chunk, done: false } : { value: undefined, done: true }));\n                }\n                const chunk = pushQueue.shift();\n                return { value: chunk, done: false };\n            },\n            return: async () => {\n                this.abort();\n                return { value: undefined, done: true };\n            },\n        };\n    }\n    static fromReadableStream(stream) {\n        const runner = new AssistantStream();\n        runner._run(() => runner._fromReadableStream(stream));\n        return runner;\n    }\n    async _fromReadableStream(readableStream, options) {\n        const signal = options?.signal;\n        if (signal) {\n            if (signal.aborted)\n                this.controller.abort();\n            signal.addEventListener('abort', () => this.controller.abort());\n        }\n        this._connected();\n        const stream = Stream.fromReadableStream(readableStream, this.controller);\n        for await (const event of stream) {\n            __classPrivateFieldGet(this, _AssistantStream_instances, \"m\", _AssistantStream_addEvent).call(this, event);\n        }\n        if (stream.controller.signal?.aborted) {\n            throw new APIUserAbortError();\n        }\n        return this._addRun(__classPrivateFieldGet(this, _AssistantStream_instances, \"m\", _AssistantStream_endRequest).call(this));\n    }\n    toReadableStream() {\n        const stream = new Stream(this[Symbol.asyncIterator].bind(this), this.controller);\n        return stream.toReadableStream();\n    }\n    static createToolAssistantStream(threadId, runId, runs, params, options) {\n        const runner = new AssistantStream();\n        runner._run(() => runner._runToolAssistantStream(threadId, runId, runs, params, {\n            ...options,\n            headers: { ...options?.headers, 'X-Stainless-Helper-Method': 'stream' },\n        }));\n        return runner;\n    }\n    async _createToolAssistantStream(run, threadId, runId, params, options) {\n        const signal = options?.signal;\n        if (signal) {\n            if (signal.aborted)\n                this.controller.abort();\n            signal.addEventListener('abort', () => this.controller.abort());\n        }\n        const body = { ...params, stream: true };\n        const stream = await run.submitToolOutputs(threadId, runId, body, {\n            ...options,\n            signal: this.controller.signal,\n        });\n        this._connected();\n        for await (const event of stream) {\n            __classPrivateFieldGet(this, _AssistantStream_instances, \"m\", _AssistantStream_addEvent).call(this, event);\n        }\n        if (stream.controller.signal?.aborted) {\n            throw new APIUserAbortError();\n        }\n        return this._addRun(__classPrivateFieldGet(this, _AssistantStream_instances, \"m\", _AssistantStream_endRequest).call(this));\n    }\n    static createThreadAssistantStream(params, thread, options) {\n        const runner = new AssistantStream();\n        runner._run(() => runner._threadAssistantStream(params, thread, {\n            ...options,\n            headers: { ...options?.headers, 'X-Stainless-Helper-Method': 'stream' },\n        }));\n        return runner;\n    }\n    static createAssistantStream(threadId, runs, params, options) {\n        const runner = new AssistantStream();\n        runner._run(() => runner._runAssistantStream(threadId, runs, params, {\n            ...options,\n            headers: { ...options?.headers, 'X-Stainless-Helper-Method': 'stream' },\n        }));\n        return runner;\n    }\n    currentEvent() {\n        return __classPrivateFieldGet(this, _AssistantStream_currentEvent, \"f\");\n    }\n    currentRun() {\n        return __classPrivateFieldGet(this, _AssistantStream_currentRunSnapshot, \"f\");\n    }\n    currentMessageSnapshot() {\n        return __classPrivateFieldGet(this, _AssistantStream_messageSnapshot, \"f\");\n    }\n    currentRunStepSnapshot() {\n        return __classPrivateFieldGet(this, _AssistantStream_currentRunStepSnapshot, \"f\");\n    }\n    async finalRunSteps() {\n        await this.done();\n        return Object.values(__classPrivateFieldGet(this, _AssistantStream_runStepSnapshots, \"f\"));\n    }\n    async finalMessages() {\n        await this.done();\n        return Object.values(__classPrivateFieldGet(this, _AssistantStream_messageSnapshots, \"f\"));\n    }\n    async finalRun() {\n        await this.done();\n        if (!__classPrivateFieldGet(this, _AssistantStream_finalRun, \"f\"))\n            throw Error('Final run was not received.');\n        return __classPrivateFieldGet(this, _AssistantStream_finalRun, \"f\");\n    }\n    async _createThreadAssistantStream(thread, params, options) {\n        const signal = options?.signal;\n        if (signal) {\n            if (signal.aborted)\n                this.controller.abort();\n            signal.addEventListener('abort', () => this.controller.abort());\n        }\n        const body = { ...params, stream: true };\n        const stream = await thread.createAndRun(body, { ...options, signal: this.controller.signal });\n        this._connected();\n        for await (const event of stream) {\n            __classPrivateFieldGet(this, _AssistantStream_instances, \"m\", _AssistantStream_addEvent).call(this, event);\n        }\n        if (stream.controller.signal?.aborted) {\n            throw new APIUserAbortError();\n        }\n        return this._addRun(__classPrivateFieldGet(this, _AssistantStream_instances, \"m\", _AssistantStream_endRequest).call(this));\n    }\n    async _createAssistantStream(run, threadId, params, options) {\n        const signal = options?.signal;\n        if (signal) {\n            if (signal.aborted)\n                this.controller.abort();\n            signal.addEventListener('abort', () => this.controller.abort());\n        }\n        const body = { ...params, stream: true };\n        const stream = await run.create(threadId, body, { ...options, signal: this.controller.signal });\n        this._connected();\n        for await (const event of stream) {\n            __classPrivateFieldGet(this, _AssistantStream_instances, \"m\", _AssistantStream_addEvent).call(this, event);\n        }\n        if (stream.controller.signal?.aborted) {\n            throw new APIUserAbortError();\n        }\n        return this._addRun(__classPrivateFieldGet(this, _AssistantStream_instances, \"m\", _AssistantStream_endRequest).call(this));\n    }\n    static accumulateDelta(acc, delta) {\n        for (const [key, deltaValue] of Object.entries(delta)) {\n            if (!acc.hasOwnProperty(key)) {\n                acc[key] = deltaValue;\n                continue;\n            }\n            let accValue = acc[key];\n            if (accValue === null || accValue === undefined) {\n                acc[key] = deltaValue;\n                continue;\n            }\n            // We don't accumulate these special properties\n            if (key === 'index' || key === 'type') {\n                acc[key] = deltaValue;\n                continue;\n            }\n            // Type-specific accumulation logic\n            if (typeof accValue === 'string' && typeof deltaValue === 'string') {\n                accValue += deltaValue;\n            }\n            else if (typeof accValue === 'number' && typeof deltaValue === 'number') {\n                accValue += deltaValue;\n            }\n            else if (Core.isObj(accValue) && Core.isObj(deltaValue)) {\n                accValue = this.accumulateDelta(accValue, deltaValue);\n            }\n            else if (Array.isArray(accValue) && Array.isArray(deltaValue)) {\n                if (accValue.every((x) => typeof x === 'string' || typeof x === 'number')) {\n                    accValue.push(...deltaValue); // Use spread syntax for efficient addition\n                    continue;\n                }\n                for (const deltaEntry of deltaValue) {\n                    if (!Core.isObj(deltaEntry)) {\n                        throw new Error(`Expected array delta entry to be an object but got: ${deltaEntry}`);\n                    }\n                    const index = deltaEntry['index'];\n                    if (index == null) {\n                        console.error(deltaEntry);\n                        throw new Error('Expected array delta entry to have an `index` property');\n                    }\n                    if (typeof index !== 'number') {\n                        throw new Error(`Expected array delta entry \\`index\\` property to be a number but got ${index}`);\n                    }\n                    const accEntry = accValue[index];\n                    if (accEntry == null) {\n                        accValue.push(deltaEntry);\n                    }\n                    else {\n                        accValue[index] = this.accumulateDelta(accEntry, deltaEntry);\n                    }\n                }\n                continue;\n            }\n            else {\n                throw Error(`Unhandled record type: ${key}, deltaValue: ${deltaValue}, accValue: ${accValue}`);\n            }\n            acc[key] = accValue;\n        }\n        return acc;\n    }\n    _addRun(run) {\n        return run;\n    }\n    async _threadAssistantStream(params, thread, options) {\n        return await this._createThreadAssistantStream(thread, params, options);\n    }\n    async _runAssistantStream(threadId, runs, params, options) {\n        return await this._createAssistantStream(runs, threadId, params, options);\n    }\n    async _runToolAssistantStream(threadId, runId, runs, params, options) {\n        return await this._createToolAssistantStream(runs, threadId, runId, params, options);\n    }\n}\n_AssistantStream_addEvent = function _AssistantStream_addEvent(event) {\n    if (this.ended)\n        return;\n    __classPrivateFieldSet(this, _AssistantStream_currentEvent, event, \"f\");\n    __classPrivateFieldGet(this, _AssistantStream_instances, \"m\", _AssistantStream_handleEvent).call(this, event);\n    switch (event.event) {\n        case 'thread.created':\n            //No action on this event.\n            break;\n        case 'thread.run.created':\n        case 'thread.run.queued':\n        case 'thread.run.in_progress':\n        case 'thread.run.requires_action':\n        case 'thread.run.completed':\n        case 'thread.run.incomplete':\n        case 'thread.run.failed':\n        case 'thread.run.cancelling':\n        case 'thread.run.cancelled':\n        case 'thread.run.expired':\n            __classPrivateFieldGet(this, _AssistantStream_instances, \"m\", _AssistantStream_handleRun).call(this, event);\n            break;\n        case 'thread.run.step.created':\n        case 'thread.run.step.in_progress':\n        case 'thread.run.step.delta':\n        case 'thread.run.step.completed':\n        case 'thread.run.step.failed':\n        case 'thread.run.step.cancelled':\n        case 'thread.run.step.expired':\n            __classPrivateFieldGet(this, _AssistantStream_instances, \"m\", _AssistantStream_handleRunStep).call(this, event);\n            break;\n        case 'thread.message.created':\n        case 'thread.message.in_progress':\n        case 'thread.message.delta':\n        case 'thread.message.completed':\n        case 'thread.message.incomplete':\n            __classPrivateFieldGet(this, _AssistantStream_instances, \"m\", _AssistantStream_handleMessage).call(this, event);\n            break;\n        case 'error':\n            //This is included for completeness, but errors are processed in the SSE event processing so this should not occur\n            throw new Error('Encountered an error event in event processing - errors should be processed earlier');\n        default:\n            assertNever(event);\n    }\n}, _AssistantStream_endRequest = function _AssistantStream_endRequest() {\n    if (this.ended) {\n        throw new OpenAIError(`stream has ended, this shouldn't happen`);\n    }\n    if (!__classPrivateFieldGet(this, _AssistantStream_finalRun, \"f\"))\n        throw Error('Final run has not been received');\n    return __classPrivateFieldGet(this, _AssistantStream_finalRun, \"f\");\n}, _AssistantStream_handleMessage = function _AssistantStream_handleMessage(event) {\n    const [accumulatedMessage, newContent] = __classPrivateFieldGet(this, _AssistantStream_instances, \"m\", _AssistantStream_accumulateMessage).call(this, event, __classPrivateFieldGet(this, _AssistantStream_messageSnapshot, \"f\"));\n    __classPrivateFieldSet(this, _AssistantStream_messageSnapshot, accumulatedMessage, \"f\");\n    __classPrivateFieldGet(this, _AssistantStream_messageSnapshots, \"f\")[accumulatedMessage.id] = accumulatedMessage;\n    for (const content of newContent) {\n        const snapshotContent = accumulatedMessage.content[content.index];\n        if (snapshotContent?.type == 'text') {\n            this._emit('textCreated', snapshotContent.text);\n        }\n    }\n    switch (event.event) {\n        case 'thread.message.created':\n            this._emit('messageCreated', event.data);\n            break;\n        case 'thread.message.in_progress':\n            break;\n        case 'thread.message.delta':\n            this._emit('messageDelta', event.data.delta, accumulatedMessage);\n            if (event.data.delta.content) {\n                for (const content of event.data.delta.content) {\n                    //If it is text delta, emit a text delta event\n                    if (content.type == 'text' && content.text) {\n                        let textDelta = content.text;\n                        let snapshot = accumulatedMessage.content[content.index];\n                        if (snapshot && snapshot.type == 'text') {\n                            this._emit('textDelta', textDelta, snapshot.text);\n                        }\n                        else {\n                            throw Error('The snapshot associated with this text delta is not text or missing');\n                        }\n                    }\n                    if (content.index != __classPrivateFieldGet(this, _AssistantStream_currentContentIndex, \"f\")) {\n                        //See if we have in progress content\n                        if (__classPrivateFieldGet(this, _AssistantStream_currentContent, \"f\")) {\n                            switch (__classPrivateFieldGet(this, _AssistantStream_currentContent, \"f\").type) {\n                                case 'text':\n                                    this._emit('textDone', __classPrivateFieldGet(this, _AssistantStream_currentContent, \"f\").text, __classPrivateFieldGet(this, _AssistantStream_messageSnapshot, \"f\"));\n                                    break;\n                                case 'image_file':\n                                    this._emit('imageFileDone', __classPrivateFieldGet(this, _AssistantStream_currentContent, \"f\").image_file, __classPrivateFieldGet(this, _AssistantStream_messageSnapshot, \"f\"));\n                                    break;\n                            }\n                        }\n                        __classPrivateFieldSet(this, _AssistantStream_currentContentIndex, content.index, \"f\");\n                    }\n                    __classPrivateFieldSet(this, _AssistantStream_currentContent, accumulatedMessage.content[content.index], \"f\");\n                }\n            }\n            break;\n        case 'thread.message.completed':\n        case 'thread.message.incomplete':\n            //We emit the latest content we were working on on completion (including incomplete)\n            if (__classPrivateFieldGet(this, _AssistantStream_currentContentIndex, \"f\") !== undefined) {\n                const currentContent = event.data.content[__classPrivateFieldGet(this, _AssistantStream_currentContentIndex, \"f\")];\n                if (currentContent) {\n                    switch (currentContent.type) {\n                        case 'image_file':\n                            this._emit('imageFileDone', currentContent.image_file, __classPrivateFieldGet(this, _AssistantStream_messageSnapshot, \"f\"));\n                            break;\n                        case 'text':\n                            this._emit('textDone', currentContent.text, __classPrivateFieldGet(this, _AssistantStream_messageSnapshot, \"f\"));\n                            break;\n                    }\n                }\n            }\n            if (__classPrivateFieldGet(this, _AssistantStream_messageSnapshot, \"f\")) {\n                this._emit('messageDone', event.data);\n            }\n            __classPrivateFieldSet(this, _AssistantStream_messageSnapshot, undefined, \"f\");\n    }\n}, _AssistantStream_handleRunStep = function _AssistantStream_handleRunStep(event) {\n    const accumulatedRunStep = __classPrivateFieldGet(this, _AssistantStream_instances, \"m\", _AssistantStream_accumulateRunStep).call(this, event);\n    __classPrivateFieldSet(this, _AssistantStream_currentRunStepSnapshot, accumulatedRunStep, \"f\");\n    switch (event.event) {\n        case 'thread.run.step.created':\n            this._emit('runStepCreated', event.data);\n            break;\n        case 'thread.run.step.delta':\n            const delta = event.data.delta;\n            if (delta.step_details &&\n                delta.step_details.type == 'tool_calls' &&\n                delta.step_details.tool_calls &&\n                accumulatedRunStep.step_details.type == 'tool_calls') {\n                for (const toolCall of delta.step_details.tool_calls) {\n                    if (toolCall.index == __classPrivateFieldGet(this, _AssistantStream_currentToolCallIndex, \"f\")) {\n                        this._emit('toolCallDelta', toolCall, accumulatedRunStep.step_details.tool_calls[toolCall.index]);\n                    }\n                    else {\n                        if (__classPrivateFieldGet(this, _AssistantStream_currentToolCall, \"f\")) {\n                            this._emit('toolCallDone', __classPrivateFieldGet(this, _AssistantStream_currentToolCall, \"f\"));\n                        }\n                        __classPrivateFieldSet(this, _AssistantStream_currentToolCallIndex, toolCall.index, \"f\");\n                        __classPrivateFieldSet(this, _AssistantStream_currentToolCall, accumulatedRunStep.step_details.tool_calls[toolCall.index], \"f\");\n                        if (__classPrivateFieldGet(this, _AssistantStream_currentToolCall, \"f\"))\n                            this._emit('toolCallCreated', __classPrivateFieldGet(this, _AssistantStream_currentToolCall, \"f\"));\n                    }\n                }\n            }\n            this._emit('runStepDelta', event.data.delta, accumulatedRunStep);\n            break;\n        case 'thread.run.step.completed':\n        case 'thread.run.step.failed':\n        case 'thread.run.step.cancelled':\n        case 'thread.run.step.expired':\n            __classPrivateFieldSet(this, _AssistantStream_currentRunStepSnapshot, undefined, \"f\");\n            const details = event.data.step_details;\n            if (details.type == 'tool_calls') {\n                if (__classPrivateFieldGet(this, _AssistantStream_currentToolCall, \"f\")) {\n                    this._emit('toolCallDone', __classPrivateFieldGet(this, _AssistantStream_currentToolCall, \"f\"));\n                    __classPrivateFieldSet(this, _AssistantStream_currentToolCall, undefined, \"f\");\n                }\n            }\n            this._emit('runStepDone', event.data, accumulatedRunStep);\n            break;\n        case 'thread.run.step.in_progress':\n            break;\n    }\n}, _AssistantStream_handleEvent = function _AssistantStream_handleEvent(event) {\n    __classPrivateFieldGet(this, _AssistantStream_events, \"f\").push(event);\n    this._emit('event', event);\n}, _AssistantStream_accumulateRunStep = function _AssistantStream_accumulateRunStep(event) {\n    switch (event.event) {\n        case 'thread.run.step.created':\n            __classPrivateFieldGet(this, _AssistantStream_runStepSnapshots, \"f\")[event.data.id] = event.data;\n            return event.data;\n        case 'thread.run.step.delta':\n            let snapshot = __classPrivateFieldGet(this, _AssistantStream_runStepSnapshots, \"f\")[event.data.id];\n            if (!snapshot) {\n                throw Error('Received a RunStepDelta before creation of a snapshot');\n            }\n            let data = event.data;\n            if (data.delta) {\n                const accumulated = AssistantStream.accumulateDelta(snapshot, data.delta);\n                __classPrivateFieldGet(this, _AssistantStream_runStepSnapshots, \"f\")[event.data.id] = accumulated;\n            }\n            return __classPrivateFieldGet(this, _AssistantStream_runStepSnapshots, \"f\")[event.data.id];\n        case 'thread.run.step.completed':\n        case 'thread.run.step.failed':\n        case 'thread.run.step.cancelled':\n        case 'thread.run.step.expired':\n        case 'thread.run.step.in_progress':\n            __classPrivateFieldGet(this, _AssistantStream_runStepSnapshots, \"f\")[event.data.id] = event.data;\n            break;\n    }\n    if (__classPrivateFieldGet(this, _AssistantStream_runStepSnapshots, \"f\")[event.data.id])\n        return __classPrivateFieldGet(this, _AssistantStream_runStepSnapshots, \"f\")[event.data.id];\n    throw new Error('No snapshot available');\n}, _AssistantStream_accumulateMessage = function _AssistantStream_accumulateMessage(event, snapshot) {\n    let newContent = [];\n    switch (event.event) {\n        case 'thread.message.created':\n            //On creation the snapshot is just the initial message\n            return [event.data, newContent];\n        case 'thread.message.delta':\n            if (!snapshot) {\n                throw Error('Received a delta with no existing snapshot (there should be one from message creation)');\n            }\n            let data = event.data;\n            //If this delta does not have content, nothing to process\n            if (data.delta.content) {\n                for (const contentElement of data.delta.content) {\n                    if (contentElement.index in snapshot.content) {\n                        let currentContent = snapshot.content[contentElement.index];\n                        snapshot.content[contentElement.index] = __classPrivateFieldGet(this, _AssistantStream_instances, \"m\", _AssistantStream_accumulateContent).call(this, contentElement, currentContent);\n                    }\n                    else {\n                        snapshot.content[contentElement.index] = contentElement;\n                        // This is a new element\n                        newContent.push(contentElement);\n                    }\n                }\n            }\n            return [snapshot, newContent];\n        case 'thread.message.in_progress':\n        case 'thread.message.completed':\n        case 'thread.message.incomplete':\n            //No changes on other thread events\n            if (snapshot) {\n                return [snapshot, newContent];\n            }\n            else {\n                throw Error('Received thread message event with no existing snapshot');\n            }\n    }\n    throw Error('Tried to accumulate a non-message event');\n}, _AssistantStream_accumulateContent = function _AssistantStream_accumulateContent(contentElement, currentContent) {\n    return AssistantStream.accumulateDelta(currentContent, contentElement);\n}, _AssistantStream_handleRun = function _AssistantStream_handleRun(event) {\n    __classPrivateFieldSet(this, _AssistantStream_currentRunSnapshot, event.data, \"f\");\n    switch (event.event) {\n        case 'thread.run.created':\n            break;\n        case 'thread.run.queued':\n            break;\n        case 'thread.run.in_progress':\n            break;\n        case 'thread.run.requires_action':\n        case 'thread.run.cancelled':\n        case 'thread.run.failed':\n        case 'thread.run.completed':\n        case 'thread.run.expired':\n            __classPrivateFieldSet(this, _AssistantStream_finalRun, event.data, \"f\");\n            if (__classPrivateFieldGet(this, _AssistantStream_currentToolCall, \"f\")) {\n                this._emit('toolCallDone', __classPrivateFieldGet(this, _AssistantStream_currentToolCall, \"f\"));\n                __classPrivateFieldSet(this, _AssistantStream_currentToolCall, undefined, \"f\");\n            }\n            break;\n        case 'thread.run.cancelling':\n            break;\n    }\n};\nfunction assertNever(_x) { }\n//# sourceMappingURL=AssistantStream.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../resource.mjs\";\nimport { isRequestOptions } from \"../../core.mjs\";\nimport { CursorPage } from \"../../pagination.mjs\";\nimport { AssistantStream } from \"../../lib/AssistantStream.mjs\";\nexport class Assistants extends APIResource {\n    /**\n     * Create an assistant with a model and instructions.\n     *\n     * @example\n     * ```ts\n     * const assistant = await client.beta.assistants.create({\n     *   model: 'gpt-4o',\n     * });\n     * ```\n     */\n    create(body, options) {\n        return this._client.post('/assistants', {\n            body,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Retrieves an assistant.\n     *\n     * @example\n     * ```ts\n     * const assistant = await client.beta.assistants.retrieve(\n     *   'assistant_id',\n     * );\n     * ```\n     */\n    retrieve(assistantId, options) {\n        return this._client.get(`/assistants/${assistantId}`, {\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Modifies an assistant.\n     *\n     * @example\n     * ```ts\n     * const assistant = await client.beta.assistants.update(\n     *   'assistant_id',\n     * );\n     * ```\n     */\n    update(assistantId, body, options) {\n        return this._client.post(`/assistants/${assistantId}`, {\n            body,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    list(query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.list({}, query);\n        }\n        return this._client.getAPIList('/assistants', AssistantsPage, {\n            query,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Delete an assistant.\n     *\n     * @example\n     * ```ts\n     * const assistantDeleted = await client.beta.assistants.del(\n     *   'assistant_id',\n     * );\n     * ```\n     */\n    del(assistantId, options) {\n        return this._client.delete(`/assistants/${assistantId}`, {\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n}\nexport class AssistantsPage extends CursorPage {\n}\nAssistants.AssistantsPage = AssistantsPage;\n//# sourceMappingURL=assistants.mjs.map","export function isRunnableFunctionWithParse(fn) {\n    return typeof fn.parse === 'function';\n}\n/**\n * This is helper class for passing a `function` and `parse` where the `function`\n * argument type matches the `parse` return type.\n *\n * @deprecated - please use ParsingToolFunction instead.\n */\nexport class ParsingFunction {\n    constructor(input) {\n        this.function = input.function;\n        this.parse = input.parse;\n        this.parameters = input.parameters;\n        this.description = input.description;\n        this.name = input.name;\n    }\n}\n/**\n * This is helper class for passing a `function` and `parse` where the `function`\n * argument type matches the `parse` return type.\n */\nexport class ParsingToolFunction {\n    constructor(input) {\n        this.type = 'function';\n        this.function = input;\n    }\n}\n//# sourceMappingURL=RunnableFunction.mjs.map","export const isAssistantMessage = (message) => {\n    return message?.role === 'assistant';\n};\nexport const isFunctionMessage = (message) => {\n    return message?.role === 'function';\n};\nexport const isToolMessage = (message) => {\n    return message?.role === 'tool';\n};\nexport function isPresent(obj) {\n    return obj != null;\n}\n//# sourceMappingURL=chatCompletionUtils.mjs.map","import { ContentFilterFinishReasonError, LengthFinishReasonError, OpenAIError } from \"../error.mjs\";\nexport function makeParseableResponseFormat(response_format, parser) {\n    const obj = { ...response_format };\n    Object.defineProperties(obj, {\n        $brand: {\n            value: 'auto-parseable-response-format',\n            enumerable: false,\n        },\n        $parseRaw: {\n            value: parser,\n            enumerable: false,\n        },\n    });\n    return obj;\n}\nexport function makeParseableTextFormat(response_format, parser) {\n    const obj = { ...response_format };\n    Object.defineProperties(obj, {\n        $brand: {\n            value: 'auto-parseable-response-format',\n            enumerable: false,\n        },\n        $parseRaw: {\n            value: parser,\n            enumerable: false,\n        },\n    });\n    return obj;\n}\nexport function isAutoParsableResponseFormat(response_format) {\n    return response_format?.['$brand'] === 'auto-parseable-response-format';\n}\nexport function makeParseableTool(tool, { parser, callback, }) {\n    const obj = { ...tool };\n    Object.defineProperties(obj, {\n        $brand: {\n            value: 'auto-parseable-tool',\n            enumerable: false,\n        },\n        $parseRaw: {\n            value: parser,\n            enumerable: false,\n        },\n        $callback: {\n            value: callback,\n            enumerable: false,\n        },\n    });\n    return obj;\n}\nexport function isAutoParsableTool(tool) {\n    return tool?.['$brand'] === 'auto-parseable-tool';\n}\nexport function maybeParseChatCompletion(completion, params) {\n    if (!params || !hasAutoParseableInput(params)) {\n        return {\n            ...completion,\n            choices: completion.choices.map((choice) => ({\n                ...choice,\n                message: {\n                    ...choice.message,\n                    parsed: null,\n                    ...(choice.message.tool_calls ?\n                        {\n                            tool_calls: choice.message.tool_calls,\n                        }\n                        : undefined),\n                },\n            })),\n        };\n    }\n    return parseChatCompletion(completion, params);\n}\nexport function parseChatCompletion(completion, params) {\n    const choices = completion.choices.map((choice) => {\n        if (choice.finish_reason === 'length') {\n            throw new LengthFinishReasonError();\n        }\n        if (choice.finish_reason === 'content_filter') {\n            throw new ContentFilterFinishReasonError();\n        }\n        return {\n            ...choice,\n            message: {\n                ...choice.message,\n                ...(choice.message.tool_calls ?\n                    {\n                        tool_calls: choice.message.tool_calls?.map((toolCall) => parseToolCall(params, toolCall)) ?? undefined,\n                    }\n                    : undefined),\n                parsed: choice.message.content && !choice.message.refusal ?\n                    parseResponseFormat(params, choice.message.content)\n                    : null,\n            },\n        };\n    });\n    return { ...completion, choices };\n}\nfunction parseResponseFormat(params, content) {\n    if (params.response_format?.type !== 'json_schema') {\n        return null;\n    }\n    if (params.response_format?.type === 'json_schema') {\n        if ('$parseRaw' in params.response_format) {\n            const response_format = params.response_format;\n            return response_format.$parseRaw(content);\n        }\n        return JSON.parse(content);\n    }\n    return null;\n}\nfunction parseToolCall(params, toolCall) {\n    const inputTool = params.tools?.find((inputTool) => inputTool.function?.name === toolCall.function.name);\n    return {\n        ...toolCall,\n        function: {\n            ...toolCall.function,\n            parsed_arguments: isAutoParsableTool(inputTool) ? inputTool.$parseRaw(toolCall.function.arguments)\n                : inputTool?.function.strict ? JSON.parse(toolCall.function.arguments)\n                    : null,\n        },\n    };\n}\nexport function shouldParseToolCall(params, toolCall) {\n    if (!params) {\n        return false;\n    }\n    const inputTool = params.tools?.find((inputTool) => inputTool.function?.name === toolCall.function.name);\n    return isAutoParsableTool(inputTool) || inputTool?.function.strict || false;\n}\nexport function hasAutoParseableInput(params) {\n    if (isAutoParsableResponseFormat(params.response_format)) {\n        return true;\n    }\n    return (params.tools?.some((t) => isAutoParsableTool(t) || (t.type === 'function' && t.function.strict === true)) ?? false);\n}\nexport function validateInputTools(tools) {\n    for (const tool of tools ?? []) {\n        if (tool.type !== 'function') {\n            throw new OpenAIError(`Currently only \\`function\\` tool types support auto-parsing; Received \\`${tool.type}\\``);\n        }\n        if (tool.function.strict !== true) {\n            throw new OpenAIError(`The \\`${tool.function.name}\\` tool is not marked with \\`strict: true\\`. Only strict function tools can be auto-parsed`);\n        }\n    }\n}\n//# sourceMappingURL=parser.mjs.map","var __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _AbstractChatCompletionRunner_instances, _AbstractChatCompletionRunner_getFinalContent, _AbstractChatCompletionRunner_getFinalMessage, _AbstractChatCompletionRunner_getFinalFunctionCall, _AbstractChatCompletionRunner_getFinalFunctionCallResult, _AbstractChatCompletionRunner_calculateTotalUsage, _AbstractChatCompletionRunner_validateParams, _AbstractChatCompletionRunner_stringifyFunctionCallResult;\nimport { OpenAIError } from \"../error.mjs\";\nimport { isRunnableFunctionWithParse, } from \"./RunnableFunction.mjs\";\nimport { isAssistantMessage, isFunctionMessage, isToolMessage } from \"./chatCompletionUtils.mjs\";\nimport { EventStream } from \"./EventStream.mjs\";\nimport { isAutoParsableTool, parseChatCompletion } from \"../lib/parser.mjs\";\nconst DEFAULT_MAX_CHAT_COMPLETIONS = 10;\nexport class AbstractChatCompletionRunner extends EventStream {\n    constructor() {\n        super(...arguments);\n        _AbstractChatCompletionRunner_instances.add(this);\n        this._chatCompletions = [];\n        this.messages = [];\n    }\n    _addChatCompletion(chatCompletion) {\n        this._chatCompletions.push(chatCompletion);\n        this._emit('chatCompletion', chatCompletion);\n        const message = chatCompletion.choices[0]?.message;\n        if (message)\n            this._addMessage(message);\n        return chatCompletion;\n    }\n    _addMessage(message, emit = true) {\n        if (!('content' in message))\n            message.content = null;\n        this.messages.push(message);\n        if (emit) {\n            this._emit('message', message);\n            if ((isFunctionMessage(message) || isToolMessage(message)) && message.content) {\n                // Note, this assumes that {role: 'tool', content: } is always the result of a call of tool of type=function.\n                this._emit('functionCallResult', message.content);\n            }\n            else if (isAssistantMessage(message) && message.function_call) {\n                this._emit('functionCall', message.function_call);\n            }\n            else if (isAssistantMessage(message) && message.tool_calls) {\n                for (const tool_call of message.tool_calls) {\n                    if (tool_call.type === 'function') {\n                        this._emit('functionCall', tool_call.function);\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * @returns a promise that resolves with the final ChatCompletion, or rejects\n     * if an error occurred or the stream ended prematurely without producing a ChatCompletion.\n     */\n    async finalChatCompletion() {\n        await this.done();\n        const completion = this._chatCompletions[this._chatCompletions.length - 1];\n        if (!completion)\n            throw new OpenAIError('stream ended without producing a ChatCompletion');\n        return completion;\n    }\n    /**\n     * @returns a promise that resolves with the content of the final ChatCompletionMessage, or rejects\n     * if an error occurred or the stream ended prematurely without producing a ChatCompletionMessage.\n     */\n    async finalContent() {\n        await this.done();\n        return __classPrivateFieldGet(this, _AbstractChatCompletionRunner_instances, \"m\", _AbstractChatCompletionRunner_getFinalContent).call(this);\n    }\n    /**\n     * @returns a promise that resolves with the the final assistant ChatCompletionMessage response,\n     * or rejects if an error occurred or the stream ended prematurely without producing a ChatCompletionMessage.\n     */\n    async finalMessage() {\n        await this.done();\n        return __classPrivateFieldGet(this, _AbstractChatCompletionRunner_instances, \"m\", _AbstractChatCompletionRunner_getFinalMessage).call(this);\n    }\n    /**\n     * @returns a promise that resolves with the content of the final FunctionCall, or rejects\n     * if an error occurred or the stream ended prematurely without producing a ChatCompletionMessage.\n     */\n    async finalFunctionCall() {\n        await this.done();\n        return __classPrivateFieldGet(this, _AbstractChatCompletionRunner_instances, \"m\", _AbstractChatCompletionRunner_getFinalFunctionCall).call(this);\n    }\n    async finalFunctionCallResult() {\n        await this.done();\n        return __classPrivateFieldGet(this, _AbstractChatCompletionRunner_instances, \"m\", _AbstractChatCompletionRunner_getFinalFunctionCallResult).call(this);\n    }\n    async totalUsage() {\n        await this.done();\n        return __classPrivateFieldGet(this, _AbstractChatCompletionRunner_instances, \"m\", _AbstractChatCompletionRunner_calculateTotalUsage).call(this);\n    }\n    allChatCompletions() {\n        return [...this._chatCompletions];\n    }\n    _emitFinal() {\n        const completion = this._chatCompletions[this._chatCompletions.length - 1];\n        if (completion)\n            this._emit('finalChatCompletion', completion);\n        const finalMessage = __classPrivateFieldGet(this, _AbstractChatCompletionRunner_instances, \"m\", _AbstractChatCompletionRunner_getFinalMessage).call(this);\n        if (finalMessage)\n            this._emit('finalMessage', finalMessage);\n        const finalContent = __classPrivateFieldGet(this, _AbstractChatCompletionRunner_instances, \"m\", _AbstractChatCompletionRunner_getFinalContent).call(this);\n        if (finalContent)\n            this._emit('finalContent', finalContent);\n        const finalFunctionCall = __classPrivateFieldGet(this, _AbstractChatCompletionRunner_instances, \"m\", _AbstractChatCompletionRunner_getFinalFunctionCall).call(this);\n        if (finalFunctionCall)\n            this._emit('finalFunctionCall', finalFunctionCall);\n        const finalFunctionCallResult = __classPrivateFieldGet(this, _AbstractChatCompletionRunner_instances, \"m\", _AbstractChatCompletionRunner_getFinalFunctionCallResult).call(this);\n        if (finalFunctionCallResult != null)\n            this._emit('finalFunctionCallResult', finalFunctionCallResult);\n        if (this._chatCompletions.some((c) => c.usage)) {\n            this._emit('totalUsage', __classPrivateFieldGet(this, _AbstractChatCompletionRunner_instances, \"m\", _AbstractChatCompletionRunner_calculateTotalUsage).call(this));\n        }\n    }\n    async _createChatCompletion(client, params, options) {\n        const signal = options?.signal;\n        if (signal) {\n            if (signal.aborted)\n                this.controller.abort();\n            signal.addEventListener('abort', () => this.controller.abort());\n        }\n        __classPrivateFieldGet(this, _AbstractChatCompletionRunner_instances, \"m\", _AbstractChatCompletionRunner_validateParams).call(this, params);\n        const chatCompletion = await client.chat.completions.create({ ...params, stream: false }, { ...options, signal: this.controller.signal });\n        this._connected();\n        return this._addChatCompletion(parseChatCompletion(chatCompletion, params));\n    }\n    async _runChatCompletion(client, params, options) {\n        for (const message of params.messages) {\n            this._addMessage(message, false);\n        }\n        return await this._createChatCompletion(client, params, options);\n    }\n    async _runFunctions(client, params, options) {\n        const role = 'function';\n        const { function_call = 'auto', stream, ...restParams } = params;\n        const singleFunctionToCall = typeof function_call !== 'string' && function_call?.name;\n        const { maxChatCompletions = DEFAULT_MAX_CHAT_COMPLETIONS } = options || {};\n        const functionsByName = {};\n        for (const f of params.functions) {\n            functionsByName[f.name || f.function.name] = f;\n        }\n        const functions = params.functions.map((f) => ({\n            name: f.name || f.function.name,\n            parameters: f.parameters,\n            description: f.description,\n        }));\n        for (const message of params.messages) {\n            this._addMessage(message, false);\n        }\n        for (let i = 0; i < maxChatCompletions; ++i) {\n            const chatCompletion = await this._createChatCompletion(client, {\n                ...restParams,\n                function_call,\n                functions,\n                messages: [...this.messages],\n            }, options);\n            const message = chatCompletion.choices[0]?.message;\n            if (!message) {\n                throw new OpenAIError(`missing message in ChatCompletion response`);\n            }\n            if (!message.function_call)\n                return;\n            const { name, arguments: args } = message.function_call;\n            const fn = functionsByName[name];\n            if (!fn) {\n                const content = `Invalid function_call: ${JSON.stringify(name)}. Available options are: ${functions\n                    .map((f) => JSON.stringify(f.name))\n                    .join(', ')}. Please try again`;\n                this._addMessage({ role, name, content });\n                continue;\n            }\n            else if (singleFunctionToCall && singleFunctionToCall !== name) {\n                const content = `Invalid function_call: ${JSON.stringify(name)}. ${JSON.stringify(singleFunctionToCall)} requested. Please try again`;\n                this._addMessage({ role, name, content });\n                continue;\n            }\n            let parsed;\n            try {\n                parsed = isRunnableFunctionWithParse(fn) ? await fn.parse(args) : args;\n            }\n            catch (error) {\n                this._addMessage({\n                    role,\n                    name,\n                    content: error instanceof Error ? error.message : String(error),\n                });\n                continue;\n            }\n            // @ts-expect-error it can't rule out `never` type.\n            const rawContent = await fn.function(parsed, this);\n            const content = __classPrivateFieldGet(this, _AbstractChatCompletionRunner_instances, \"m\", _AbstractChatCompletionRunner_stringifyFunctionCallResult).call(this, rawContent);\n            this._addMessage({ role, name, content });\n            if (singleFunctionToCall)\n                return;\n        }\n    }\n    async _runTools(client, params, options) {\n        const role = 'tool';\n        const { tool_choice = 'auto', stream, ...restParams } = params;\n        const singleFunctionToCall = typeof tool_choice !== 'string' && tool_choice?.function?.name;\n        const { maxChatCompletions = DEFAULT_MAX_CHAT_COMPLETIONS } = options || {};\n        // TODO(someday): clean this logic up\n        const inputTools = params.tools.map((tool) => {\n            if (isAutoParsableTool(tool)) {\n                if (!tool.$callback) {\n                    throw new OpenAIError('Tool given to `.runTools()` that does not have an associated function');\n                }\n                return {\n                    type: 'function',\n                    function: {\n                        function: tool.$callback,\n                        name: tool.function.name,\n                        description: tool.function.description || '',\n                        parameters: tool.function.parameters,\n                        parse: tool.$parseRaw,\n                        strict: true,\n                    },\n                };\n            }\n            return tool;\n        });\n        const functionsByName = {};\n        for (const f of inputTools) {\n            if (f.type === 'function') {\n                functionsByName[f.function.name || f.function.function.name] = f.function;\n            }\n        }\n        const tools = 'tools' in params ?\n            inputTools.map((t) => t.type === 'function' ?\n                {\n                    type: 'function',\n                    function: {\n                        name: t.function.name || t.function.function.name,\n                        parameters: t.function.parameters,\n                        description: t.function.description,\n                        strict: t.function.strict,\n                    },\n                }\n                : t)\n            : undefined;\n        for (const message of params.messages) {\n            this._addMessage(message, false);\n        }\n        for (let i = 0; i < maxChatCompletions; ++i) {\n            const chatCompletion = await this._createChatCompletion(client, {\n                ...restParams,\n                tool_choice,\n                tools,\n                messages: [...this.messages],\n            }, options);\n            const message = chatCompletion.choices[0]?.message;\n            if (!message) {\n                throw new OpenAIError(`missing message in ChatCompletion response`);\n            }\n            if (!message.tool_calls?.length) {\n                return;\n            }\n            for (const tool_call of message.tool_calls) {\n                if (tool_call.type !== 'function')\n                    continue;\n                const tool_call_id = tool_call.id;\n                const { name, arguments: args } = tool_call.function;\n                const fn = functionsByName[name];\n                if (!fn) {\n                    const content = `Invalid tool_call: ${JSON.stringify(name)}. Available options are: ${Object.keys(functionsByName)\n                        .map((name) => JSON.stringify(name))\n                        .join(', ')}. Please try again`;\n                    this._addMessage({ role, tool_call_id, content });\n                    continue;\n                }\n                else if (singleFunctionToCall && singleFunctionToCall !== name) {\n                    const content = `Invalid tool_call: ${JSON.stringify(name)}. ${JSON.stringify(singleFunctionToCall)} requested. Please try again`;\n                    this._addMessage({ role, tool_call_id, content });\n                    continue;\n                }\n                let parsed;\n                try {\n                    parsed = isRunnableFunctionWithParse(fn) ? await fn.parse(args) : args;\n                }\n                catch (error) {\n                    const content = error instanceof Error ? error.message : String(error);\n                    this._addMessage({ role, tool_call_id, content });\n                    continue;\n                }\n                // @ts-expect-error it can't rule out `never` type.\n                const rawContent = await fn.function(parsed, this);\n                const content = __classPrivateFieldGet(this, _AbstractChatCompletionRunner_instances, \"m\", _AbstractChatCompletionRunner_stringifyFunctionCallResult).call(this, rawContent);\n                this._addMessage({ role, tool_call_id, content });\n                if (singleFunctionToCall) {\n                    return;\n                }\n            }\n        }\n        return;\n    }\n}\n_AbstractChatCompletionRunner_instances = new WeakSet(), _AbstractChatCompletionRunner_getFinalContent = function _AbstractChatCompletionRunner_getFinalContent() {\n    return __classPrivateFieldGet(this, _AbstractChatCompletionRunner_instances, \"m\", _AbstractChatCompletionRunner_getFinalMessage).call(this).content ?? null;\n}, _AbstractChatCompletionRunner_getFinalMessage = function _AbstractChatCompletionRunner_getFinalMessage() {\n    let i = this.messages.length;\n    while (i-- > 0) {\n        const message = this.messages[i];\n        if (isAssistantMessage(message)) {\n            const { function_call, ...rest } = message;\n            // TODO: support audio here\n            const ret = {\n                ...rest,\n                content: message.content ?? null,\n                refusal: message.refusal ?? null,\n            };\n            if (function_call) {\n                ret.function_call = function_call;\n            }\n            return ret;\n        }\n    }\n    throw new OpenAIError('stream ended without producing a ChatCompletionMessage with role=assistant');\n}, _AbstractChatCompletionRunner_getFinalFunctionCall = function _AbstractChatCompletionRunner_getFinalFunctionCall() {\n    for (let i = this.messages.length - 1; i >= 0; i--) {\n        const message = this.messages[i];\n        if (isAssistantMessage(message) && message?.function_call) {\n            return message.function_call;\n        }\n        if (isAssistantMessage(message) && message?.tool_calls?.length) {\n            return message.tool_calls.at(-1)?.function;\n        }\n    }\n    return;\n}, _AbstractChatCompletionRunner_getFinalFunctionCallResult = function _AbstractChatCompletionRunner_getFinalFunctionCallResult() {\n    for (let i = this.messages.length - 1; i >= 0; i--) {\n        const message = this.messages[i];\n        if (isFunctionMessage(message) && message.content != null) {\n            return message.content;\n        }\n        if (isToolMessage(message) &&\n            message.content != null &&\n            typeof message.content === 'string' &&\n            this.messages.some((x) => x.role === 'assistant' &&\n                x.tool_calls?.some((y) => y.type === 'function' && y.id === message.tool_call_id))) {\n            return message.content;\n        }\n    }\n    return;\n}, _AbstractChatCompletionRunner_calculateTotalUsage = function _AbstractChatCompletionRunner_calculateTotalUsage() {\n    const total = {\n        completion_tokens: 0,\n        prompt_tokens: 0,\n        total_tokens: 0,\n    };\n    for (const { usage } of this._chatCompletions) {\n        if (usage) {\n            total.completion_tokens += usage.completion_tokens;\n            total.prompt_tokens += usage.prompt_tokens;\n            total.total_tokens += usage.total_tokens;\n        }\n    }\n    return total;\n}, _AbstractChatCompletionRunner_validateParams = function _AbstractChatCompletionRunner_validateParams(params) {\n    if (params.n != null && params.n > 1) {\n        throw new OpenAIError('ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.');\n    }\n}, _AbstractChatCompletionRunner_stringifyFunctionCallResult = function _AbstractChatCompletionRunner_stringifyFunctionCallResult(rawContent) {\n    return (typeof rawContent === 'string' ? rawContent\n        : rawContent === undefined ? 'undefined'\n            : JSON.stringify(rawContent));\n};\n//# sourceMappingURL=AbstractChatCompletionRunner.mjs.map","import { AbstractChatCompletionRunner, } from \"./AbstractChatCompletionRunner.mjs\";\nimport { isAssistantMessage } from \"./chatCompletionUtils.mjs\";\nexport class ChatCompletionRunner extends AbstractChatCompletionRunner {\n    /** @deprecated - please use `runTools` instead. */\n    static runFunctions(client, params, options) {\n        const runner = new ChatCompletionRunner();\n        const opts = {\n            ...options,\n            headers: { ...options?.headers, 'X-Stainless-Helper-Method': 'runFunctions' },\n        };\n        runner._run(() => runner._runFunctions(client, params, opts));\n        return runner;\n    }\n    static runTools(client, params, options) {\n        const runner = new ChatCompletionRunner();\n        const opts = {\n            ...options,\n            headers: { ...options?.headers, 'X-Stainless-Helper-Method': 'runTools' },\n        };\n        runner._run(() => runner._runTools(client, params, opts));\n        return runner;\n    }\n    _addMessage(message, emit = true) {\n        super._addMessage(message, emit);\n        if (isAssistantMessage(message) && message.content) {\n            this._emit('content', message.content);\n        }\n    }\n}\n//# sourceMappingURL=ChatCompletionRunner.mjs.map","const STR = 0b000000001;\nconst NUM = 0b000000010;\nconst ARR = 0b000000100;\nconst OBJ = 0b000001000;\nconst NULL = 0b000010000;\nconst BOOL = 0b000100000;\nconst NAN = 0b001000000;\nconst INFINITY = 0b010000000;\nconst MINUS_INFINITY = 0b100000000;\nconst INF = INFINITY | MINUS_INFINITY;\nconst SPECIAL = NULL | BOOL | INF | NAN;\nconst ATOM = STR | NUM | SPECIAL;\nconst COLLECTION = ARR | OBJ;\nconst ALL = ATOM | COLLECTION;\nconst Allow = {\n    STR,\n    NUM,\n    ARR,\n    OBJ,\n    NULL,\n    BOOL,\n    NAN,\n    INFINITY,\n    MINUS_INFINITY,\n    INF,\n    SPECIAL,\n    ATOM,\n    COLLECTION,\n    ALL,\n};\n// The JSON string segment was unable to be parsed completely\nclass PartialJSON extends Error {\n}\nclass MalformedJSON extends Error {\n}\n/**\n * Parse incomplete JSON\n * @param {string} jsonString Partial JSON to be parsed\n * @param {number} allowPartial Specify what types are allowed to be partial, see {@link Allow} for details\n * @returns The parsed JSON\n * @throws {PartialJSON} If the JSON is incomplete (related to the `allow` parameter)\n * @throws {MalformedJSON} If the JSON is malformed\n */\nfunction parseJSON(jsonString, allowPartial = Allow.ALL) {\n    if (typeof jsonString !== 'string') {\n        throw new TypeError(`expecting str, got ${typeof jsonString}`);\n    }\n    if (!jsonString.trim()) {\n        throw new Error(`${jsonString} is empty`);\n    }\n    return _parseJSON(jsonString.trim(), allowPartial);\n}\nconst _parseJSON = (jsonString, allow) => {\n    const length = jsonString.length;\n    let index = 0;\n    const markPartialJSON = (msg) => {\n        throw new PartialJSON(`${msg} at position ${index}`);\n    };\n    const throwMalformedError = (msg) => {\n        throw new MalformedJSON(`${msg} at position ${index}`);\n    };\n    const parseAny = () => {\n        skipBlank();\n        if (index >= length)\n            markPartialJSON('Unexpected end of input');\n        if (jsonString[index] === '\"')\n            return parseStr();\n        if (jsonString[index] === '{')\n            return parseObj();\n        if (jsonString[index] === '[')\n            return parseArr();\n        if (jsonString.substring(index, index + 4) === 'null' ||\n            (Allow.NULL & allow && length - index < 4 && 'null'.startsWith(jsonString.substring(index)))) {\n            index += 4;\n            return null;\n        }\n        if (jsonString.substring(index, index + 4) === 'true' ||\n            (Allow.BOOL & allow && length - index < 4 && 'true'.startsWith(jsonString.substring(index)))) {\n            index += 4;\n            return true;\n        }\n        if (jsonString.substring(index, index + 5) === 'false' ||\n            (Allow.BOOL & allow && length - index < 5 && 'false'.startsWith(jsonString.substring(index)))) {\n            index += 5;\n            return false;\n        }\n        if (jsonString.substring(index, index + 8) === 'Infinity' ||\n            (Allow.INFINITY & allow && length - index < 8 && 'Infinity'.startsWith(jsonString.substring(index)))) {\n            index += 8;\n            return Infinity;\n        }\n        if (jsonString.substring(index, index + 9) === '-Infinity' ||\n            (Allow.MINUS_INFINITY & allow &&\n                1 < length - index &&\n                length - index < 9 &&\n                '-Infinity'.startsWith(jsonString.substring(index)))) {\n            index += 9;\n            return -Infinity;\n        }\n        if (jsonString.substring(index, index + 3) === 'NaN' ||\n            (Allow.NAN & allow && length - index < 3 && 'NaN'.startsWith(jsonString.substring(index)))) {\n            index += 3;\n            return NaN;\n        }\n        return parseNum();\n    };\n    const parseStr = () => {\n        const start = index;\n        let escape = false;\n        index++; // skip initial quote\n        while (index < length && (jsonString[index] !== '\"' || (escape && jsonString[index - 1] === '\\\\'))) {\n            escape = jsonString[index] === '\\\\' ? !escape : false;\n            index++;\n        }\n        if (jsonString.charAt(index) == '\"') {\n            try {\n                return JSON.parse(jsonString.substring(start, ++index - Number(escape)));\n            }\n            catch (e) {\n                throwMalformedError(String(e));\n            }\n        }\n        else if (Allow.STR & allow) {\n            try {\n                return JSON.parse(jsonString.substring(start, index - Number(escape)) + '\"');\n            }\n            catch (e) {\n                // SyntaxError: Invalid escape sequence\n                return JSON.parse(jsonString.substring(start, jsonString.lastIndexOf('\\\\')) + '\"');\n            }\n        }\n        markPartialJSON('Unterminated string literal');\n    };\n    const parseObj = () => {\n        index++; // skip initial brace\n        skipBlank();\n        const obj = {};\n        try {\n            while (jsonString[index] !== '}') {\n                skipBlank();\n                if (index >= length && Allow.OBJ & allow)\n                    return obj;\n                const key = parseStr();\n                skipBlank();\n                index++; // skip colon\n                try {\n                    const value = parseAny();\n                    Object.defineProperty(obj, key, { value, writable: true, enumerable: true, configurable: true });\n                }\n                catch (e) {\n                    if (Allow.OBJ & allow)\n                        return obj;\n                    else\n                        throw e;\n                }\n                skipBlank();\n                if (jsonString[index] === ',')\n                    index++; // skip comma\n            }\n        }\n        catch (e) {\n            if (Allow.OBJ & allow)\n                return obj;\n            else\n                markPartialJSON(\"Expected '}' at end of object\");\n        }\n        index++; // skip final brace\n        return obj;\n    };\n    const parseArr = () => {\n        index++; // skip initial bracket\n        const arr = [];\n        try {\n            while (jsonString[index] !== ']') {\n                arr.push(parseAny());\n                skipBlank();\n                if (jsonString[index] === ',') {\n                    index++; // skip comma\n                }\n            }\n        }\n        catch (e) {\n            if (Allow.ARR & allow) {\n                return arr;\n            }\n            markPartialJSON(\"Expected ']' at end of array\");\n        }\n        index++; // skip final bracket\n        return arr;\n    };\n    const parseNum = () => {\n        if (index === 0) {\n            if (jsonString === '-' && Allow.NUM & allow)\n                markPartialJSON(\"Not sure what '-' is\");\n            try {\n                return JSON.parse(jsonString);\n            }\n            catch (e) {\n                if (Allow.NUM & allow) {\n                    try {\n                        if ('.' === jsonString[jsonString.length - 1])\n                            return JSON.parse(jsonString.substring(0, jsonString.lastIndexOf('.')));\n                        return JSON.parse(jsonString.substring(0, jsonString.lastIndexOf('e')));\n                    }\n                    catch (e) { }\n                }\n                throwMalformedError(String(e));\n            }\n        }\n        const start = index;\n        if (jsonString[index] === '-')\n            index++;\n        while (jsonString[index] && !',]}'.includes(jsonString[index]))\n            index++;\n        if (index == length && !(Allow.NUM & allow))\n            markPartialJSON('Unterminated number literal');\n        try {\n            return JSON.parse(jsonString.substring(start, index));\n        }\n        catch (e) {\n            if (jsonString.substring(start, index) === '-' && Allow.NUM & allow)\n                markPartialJSON(\"Not sure what '-' is\");\n            try {\n                return JSON.parse(jsonString.substring(start, jsonString.lastIndexOf('e')));\n            }\n            catch (e) {\n                throwMalformedError(String(e));\n            }\n        }\n    };\n    const skipBlank = () => {\n        while (index < length && ' \\n\\r\\t'.includes(jsonString[index])) {\n            index++;\n        }\n    };\n    return parseAny();\n};\n// using this function with malformed JSON is undefined behavior\nconst partialParse = (input) => parseJSON(input, Allow.ALL ^ Allow.NUM);\nexport { partialParse, PartialJSON, MalformedJSON };\n//# sourceMappingURL=parser.mjs.map","var __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _ChatCompletionStream_instances, _ChatCompletionStream_params, _ChatCompletionStream_choiceEventStates, _ChatCompletionStream_currentChatCompletionSnapshot, _ChatCompletionStream_beginRequest, _ChatCompletionStream_getChoiceEventState, _ChatCompletionStream_addChunk, _ChatCompletionStream_emitToolCallDoneEvent, _ChatCompletionStream_emitContentDoneEvents, _ChatCompletionStream_endRequest, _ChatCompletionStream_getAutoParseableResponseFormat, _ChatCompletionStream_accumulateChatCompletion;\nimport { OpenAIError, APIUserAbortError, LengthFinishReasonError, ContentFilterFinishReasonError, } from \"../error.mjs\";\nimport { AbstractChatCompletionRunner, } from \"./AbstractChatCompletionRunner.mjs\";\nimport { Stream } from \"../streaming.mjs\";\nimport { hasAutoParseableInput, isAutoParsableResponseFormat, isAutoParsableTool, maybeParseChatCompletion, shouldParseToolCall, } from \"../lib/parser.mjs\";\nimport { partialParse } from \"../_vendor/partial-json-parser/parser.mjs\";\nexport class ChatCompletionStream extends AbstractChatCompletionRunner {\n    constructor(params) {\n        super();\n        _ChatCompletionStream_instances.add(this);\n        _ChatCompletionStream_params.set(this, void 0);\n        _ChatCompletionStream_choiceEventStates.set(this, void 0);\n        _ChatCompletionStream_currentChatCompletionSnapshot.set(this, void 0);\n        __classPrivateFieldSet(this, _ChatCompletionStream_params, params, \"f\");\n        __classPrivateFieldSet(this, _ChatCompletionStream_choiceEventStates, [], \"f\");\n    }\n    get currentChatCompletionSnapshot() {\n        return __classPrivateFieldGet(this, _ChatCompletionStream_currentChatCompletionSnapshot, \"f\");\n    }\n    /**\n     * Intended for use on the frontend, consuming a stream produced with\n     * `.toReadableStream()` on the backend.\n     *\n     * Note that messages sent to the model do not appear in `.on('message')`\n     * in this context.\n     */\n    static fromReadableStream(stream) {\n        const runner = new ChatCompletionStream(null);\n        runner._run(() => runner._fromReadableStream(stream));\n        return runner;\n    }\n    static createChatCompletion(client, params, options) {\n        const runner = new ChatCompletionStream(params);\n        runner._run(() => runner._runChatCompletion(client, { ...params, stream: true }, { ...options, headers: { ...options?.headers, 'X-Stainless-Helper-Method': 'stream' } }));\n        return runner;\n    }\n    async _createChatCompletion(client, params, options) {\n        super._createChatCompletion;\n        const signal = options?.signal;\n        if (signal) {\n            if (signal.aborted)\n                this.controller.abort();\n            signal.addEventListener('abort', () => this.controller.abort());\n        }\n        __classPrivateFieldGet(this, _ChatCompletionStream_instances, \"m\", _ChatCompletionStream_beginRequest).call(this);\n        const stream = await client.chat.completions.create({ ...params, stream: true }, { ...options, signal: this.controller.signal });\n        this._connected();\n        for await (const chunk of stream) {\n            __classPrivateFieldGet(this, _ChatCompletionStream_instances, \"m\", _ChatCompletionStream_addChunk).call(this, chunk);\n        }\n        if (stream.controller.signal?.aborted) {\n            throw new APIUserAbortError();\n        }\n        return this._addChatCompletion(__classPrivateFieldGet(this, _ChatCompletionStream_instances, \"m\", _ChatCompletionStream_endRequest).call(this));\n    }\n    async _fromReadableStream(readableStream, options) {\n        const signal = options?.signal;\n        if (signal) {\n            if (signal.aborted)\n                this.controller.abort();\n            signal.addEventListener('abort', () => this.controller.abort());\n        }\n        __classPrivateFieldGet(this, _ChatCompletionStream_instances, \"m\", _ChatCompletionStream_beginRequest).call(this);\n        this._connected();\n        const stream = Stream.fromReadableStream(readableStream, this.controller);\n        let chatId;\n        for await (const chunk of stream) {\n            if (chatId && chatId !== chunk.id) {\n                // A new request has been made.\n                this._addChatCompletion(__classPrivateFieldGet(this, _ChatCompletionStream_instances, \"m\", _ChatCompletionStream_endRequest).call(this));\n            }\n            __classPrivateFieldGet(this, _ChatCompletionStream_instances, \"m\", _ChatCompletionStream_addChunk).call(this, chunk);\n            chatId = chunk.id;\n        }\n        if (stream.controller.signal?.aborted) {\n            throw new APIUserAbortError();\n        }\n        return this._addChatCompletion(__classPrivateFieldGet(this, _ChatCompletionStream_instances, \"m\", _ChatCompletionStream_endRequest).call(this));\n    }\n    [(_ChatCompletionStream_params = new WeakMap(), _ChatCompletionStream_choiceEventStates = new WeakMap(), _ChatCompletionStream_currentChatCompletionSnapshot = new WeakMap(), _ChatCompletionStream_instances = new WeakSet(), _ChatCompletionStream_beginRequest = function _ChatCompletionStream_beginRequest() {\n        if (this.ended)\n            return;\n        __classPrivateFieldSet(this, _ChatCompletionStream_currentChatCompletionSnapshot, undefined, \"f\");\n    }, _ChatCompletionStream_getChoiceEventState = function _ChatCompletionStream_getChoiceEventState(choice) {\n        let state = __classPrivateFieldGet(this, _ChatCompletionStream_choiceEventStates, \"f\")[choice.index];\n        if (state) {\n            return state;\n        }\n        state = {\n            content_done: false,\n            refusal_done: false,\n            logprobs_content_done: false,\n            logprobs_refusal_done: false,\n            done_tool_calls: new Set(),\n            current_tool_call_index: null,\n        };\n        __classPrivateFieldGet(this, _ChatCompletionStream_choiceEventStates, \"f\")[choice.index] = state;\n        return state;\n    }, _ChatCompletionStream_addChunk = function _ChatCompletionStream_addChunk(chunk) {\n        if (this.ended)\n            return;\n        const completion = __classPrivateFieldGet(this, _ChatCompletionStream_instances, \"m\", _ChatCompletionStream_accumulateChatCompletion).call(this, chunk);\n        this._emit('chunk', chunk, completion);\n        for (const choice of chunk.choices) {\n            const choiceSnapshot = completion.choices[choice.index];\n            if (choice.delta.content != null &&\n                choiceSnapshot.message?.role === 'assistant' &&\n                choiceSnapshot.message?.content) {\n                this._emit('content', choice.delta.content, choiceSnapshot.message.content);\n                this._emit('content.delta', {\n                    delta: choice.delta.content,\n                    snapshot: choiceSnapshot.message.content,\n                    parsed: choiceSnapshot.message.parsed,\n                });\n            }\n            if (choice.delta.refusal != null &&\n                choiceSnapshot.message?.role === 'assistant' &&\n                choiceSnapshot.message?.refusal) {\n                this._emit('refusal.delta', {\n                    delta: choice.delta.refusal,\n                    snapshot: choiceSnapshot.message.refusal,\n                });\n            }\n            if (choice.logprobs?.content != null && choiceSnapshot.message?.role === 'assistant') {\n                this._emit('logprobs.content.delta', {\n                    content: choice.logprobs?.content,\n                    snapshot: choiceSnapshot.logprobs?.content ?? [],\n                });\n            }\n            if (choice.logprobs?.refusal != null && choiceSnapshot.message?.role === 'assistant') {\n                this._emit('logprobs.refusal.delta', {\n                    refusal: choice.logprobs?.refusal,\n                    snapshot: choiceSnapshot.logprobs?.refusal ?? [],\n                });\n            }\n            const state = __classPrivateFieldGet(this, _ChatCompletionStream_instances, \"m\", _ChatCompletionStream_getChoiceEventState).call(this, choiceSnapshot);\n            if (choiceSnapshot.finish_reason) {\n                __classPrivateFieldGet(this, _ChatCompletionStream_instances, \"m\", _ChatCompletionStream_emitContentDoneEvents).call(this, choiceSnapshot);\n                if (state.current_tool_call_index != null) {\n                    __classPrivateFieldGet(this, _ChatCompletionStream_instances, \"m\", _ChatCompletionStream_emitToolCallDoneEvent).call(this, choiceSnapshot, state.current_tool_call_index);\n                }\n            }\n            for (const toolCall of choice.delta.tool_calls ?? []) {\n                if (state.current_tool_call_index !== toolCall.index) {\n                    __classPrivateFieldGet(this, _ChatCompletionStream_instances, \"m\", _ChatCompletionStream_emitContentDoneEvents).call(this, choiceSnapshot);\n                    // new tool call started, the previous one is done\n                    if (state.current_tool_call_index != null) {\n                        __classPrivateFieldGet(this, _ChatCompletionStream_instances, \"m\", _ChatCompletionStream_emitToolCallDoneEvent).call(this, choiceSnapshot, state.current_tool_call_index);\n                    }\n                }\n                state.current_tool_call_index = toolCall.index;\n            }\n            for (const toolCallDelta of choice.delta.tool_calls ?? []) {\n                const toolCallSnapshot = choiceSnapshot.message.tool_calls?.[toolCallDelta.index];\n                if (!toolCallSnapshot?.type) {\n                    continue;\n                }\n                if (toolCallSnapshot?.type === 'function') {\n                    this._emit('tool_calls.function.arguments.delta', {\n                        name: toolCallSnapshot.function?.name,\n                        index: toolCallDelta.index,\n                        arguments: toolCallSnapshot.function.arguments,\n                        parsed_arguments: toolCallSnapshot.function.parsed_arguments,\n                        arguments_delta: toolCallDelta.function?.arguments ?? '',\n                    });\n                }\n                else {\n                    assertNever(toolCallSnapshot?.type);\n                }\n            }\n        }\n    }, _ChatCompletionStream_emitToolCallDoneEvent = function _ChatCompletionStream_emitToolCallDoneEvent(choiceSnapshot, toolCallIndex) {\n        const state = __classPrivateFieldGet(this, _ChatCompletionStream_instances, \"m\", _ChatCompletionStream_getChoiceEventState).call(this, choiceSnapshot);\n        if (state.done_tool_calls.has(toolCallIndex)) {\n            // we've already fired the done event\n            return;\n        }\n        const toolCallSnapshot = choiceSnapshot.message.tool_calls?.[toolCallIndex];\n        if (!toolCallSnapshot) {\n            throw new Error('no tool call snapshot');\n        }\n        if (!toolCallSnapshot.type) {\n            throw new Error('tool call snapshot missing `type`');\n        }\n        if (toolCallSnapshot.type === 'function') {\n            const inputTool = __classPrivateFieldGet(this, _ChatCompletionStream_params, \"f\")?.tools?.find((tool) => tool.type === 'function' && tool.function.name === toolCallSnapshot.function.name);\n            this._emit('tool_calls.function.arguments.done', {\n                name: toolCallSnapshot.function.name,\n                index: toolCallIndex,\n                arguments: toolCallSnapshot.function.arguments,\n                parsed_arguments: isAutoParsableTool(inputTool) ? inputTool.$parseRaw(toolCallSnapshot.function.arguments)\n                    : inputTool?.function.strict ? JSON.parse(toolCallSnapshot.function.arguments)\n                        : null,\n            });\n        }\n        else {\n            assertNever(toolCallSnapshot.type);\n        }\n    }, _ChatCompletionStream_emitContentDoneEvents = function _ChatCompletionStream_emitContentDoneEvents(choiceSnapshot) {\n        const state = __classPrivateFieldGet(this, _ChatCompletionStream_instances, \"m\", _ChatCompletionStream_getChoiceEventState).call(this, choiceSnapshot);\n        if (choiceSnapshot.message.content && !state.content_done) {\n            state.content_done = true;\n            const responseFormat = __classPrivateFieldGet(this, _ChatCompletionStream_instances, \"m\", _ChatCompletionStream_getAutoParseableResponseFormat).call(this);\n            this._emit('content.done', {\n                content: choiceSnapshot.message.content,\n                parsed: responseFormat ? responseFormat.$parseRaw(choiceSnapshot.message.content) : null,\n            });\n        }\n        if (choiceSnapshot.message.refusal && !state.refusal_done) {\n            state.refusal_done = true;\n            this._emit('refusal.done', { refusal: choiceSnapshot.message.refusal });\n        }\n        if (choiceSnapshot.logprobs?.content && !state.logprobs_content_done) {\n            state.logprobs_content_done = true;\n            this._emit('logprobs.content.done', { content: choiceSnapshot.logprobs.content });\n        }\n        if (choiceSnapshot.logprobs?.refusal && !state.logprobs_refusal_done) {\n            state.logprobs_refusal_done = true;\n            this._emit('logprobs.refusal.done', { refusal: choiceSnapshot.logprobs.refusal });\n        }\n    }, _ChatCompletionStream_endRequest = function _ChatCompletionStream_endRequest() {\n        if (this.ended) {\n            throw new OpenAIError(`stream has ended, this shouldn't happen`);\n        }\n        const snapshot = __classPrivateFieldGet(this, _ChatCompletionStream_currentChatCompletionSnapshot, \"f\");\n        if (!snapshot) {\n            throw new OpenAIError(`request ended without sending any chunks`);\n        }\n        __classPrivateFieldSet(this, _ChatCompletionStream_currentChatCompletionSnapshot, undefined, \"f\");\n        __classPrivateFieldSet(this, _ChatCompletionStream_choiceEventStates, [], \"f\");\n        return finalizeChatCompletion(snapshot, __classPrivateFieldGet(this, _ChatCompletionStream_params, \"f\"));\n    }, _ChatCompletionStream_getAutoParseableResponseFormat = function _ChatCompletionStream_getAutoParseableResponseFormat() {\n        const responseFormat = __classPrivateFieldGet(this, _ChatCompletionStream_params, \"f\")?.response_format;\n        if (isAutoParsableResponseFormat(responseFormat)) {\n            return responseFormat;\n        }\n        return null;\n    }, _ChatCompletionStream_accumulateChatCompletion = function _ChatCompletionStream_accumulateChatCompletion(chunk) {\n        var _a, _b, _c, _d;\n        let snapshot = __classPrivateFieldGet(this, _ChatCompletionStream_currentChatCompletionSnapshot, \"f\");\n        const { choices, ...rest } = chunk;\n        if (!snapshot) {\n            snapshot = __classPrivateFieldSet(this, _ChatCompletionStream_currentChatCompletionSnapshot, {\n                ...rest,\n                choices: [],\n            }, \"f\");\n        }\n        else {\n            Object.assign(snapshot, rest);\n        }\n        for (const { delta, finish_reason, index, logprobs = null, ...other } of chunk.choices) {\n            let choice = snapshot.choices[index];\n            if (!choice) {\n                choice = snapshot.choices[index] = { finish_reason, index, message: {}, logprobs, ...other };\n            }\n            if (logprobs) {\n                if (!choice.logprobs) {\n                    choice.logprobs = Object.assign({}, logprobs);\n                }\n                else {\n                    const { content, refusal, ...rest } = logprobs;\n                    assertIsEmpty(rest);\n                    Object.assign(choice.logprobs, rest);\n                    if (content) {\n                        (_a = choice.logprobs).content ?? (_a.content = []);\n                        choice.logprobs.content.push(...content);\n                    }\n                    if (refusal) {\n                        (_b = choice.logprobs).refusal ?? (_b.refusal = []);\n                        choice.logprobs.refusal.push(...refusal);\n                    }\n                }\n            }\n            if (finish_reason) {\n                choice.finish_reason = finish_reason;\n                if (__classPrivateFieldGet(this, _ChatCompletionStream_params, \"f\") && hasAutoParseableInput(__classPrivateFieldGet(this, _ChatCompletionStream_params, \"f\"))) {\n                    if (finish_reason === 'length') {\n                        throw new LengthFinishReasonError();\n                    }\n                    if (finish_reason === 'content_filter') {\n                        throw new ContentFilterFinishReasonError();\n                    }\n                }\n            }\n            Object.assign(choice, other);\n            if (!delta)\n                continue; // Shouldn't happen; just in case.\n            const { content, refusal, function_call, role, tool_calls, ...rest } = delta;\n            assertIsEmpty(rest);\n            Object.assign(choice.message, rest);\n            if (refusal) {\n                choice.message.refusal = (choice.message.refusal || '') + refusal;\n            }\n            if (role)\n                choice.message.role = role;\n            if (function_call) {\n                if (!choice.message.function_call) {\n                    choice.message.function_call = function_call;\n                }\n                else {\n                    if (function_call.name)\n                        choice.message.function_call.name = function_call.name;\n                    if (function_call.arguments) {\n                        (_c = choice.message.function_call).arguments ?? (_c.arguments = '');\n                        choice.message.function_call.arguments += function_call.arguments;\n                    }\n                }\n            }\n            if (content) {\n                choice.message.content = (choice.message.content || '') + content;\n                if (!choice.message.refusal && __classPrivateFieldGet(this, _ChatCompletionStream_instances, \"m\", _ChatCompletionStream_getAutoParseableResponseFormat).call(this)) {\n                    choice.message.parsed = partialParse(choice.message.content);\n                }\n            }\n            if (tool_calls) {\n                if (!choice.message.tool_calls)\n                    choice.message.tool_calls = [];\n                for (const { index, id, type, function: fn, ...rest } of tool_calls) {\n                    const tool_call = ((_d = choice.message.tool_calls)[index] ?? (_d[index] = {}));\n                    Object.assign(tool_call, rest);\n                    if (id)\n                        tool_call.id = id;\n                    if (type)\n                        tool_call.type = type;\n                    if (fn)\n                        tool_call.function ?? (tool_call.function = { name: fn.name ?? '', arguments: '' });\n                    if (fn?.name)\n                        tool_call.function.name = fn.name;\n                    if (fn?.arguments) {\n                        tool_call.function.arguments += fn.arguments;\n                        if (shouldParseToolCall(__classPrivateFieldGet(this, _ChatCompletionStream_params, \"f\"), tool_call)) {\n                            tool_call.function.parsed_arguments = partialParse(tool_call.function.arguments);\n                        }\n                    }\n                }\n            }\n        }\n        return snapshot;\n    }, Symbol.asyncIterator)]() {\n        const pushQueue = [];\n        const readQueue = [];\n        let done = false;\n        this.on('chunk', (chunk) => {\n            const reader = readQueue.shift();\n            if (reader) {\n                reader.resolve(chunk);\n            }\n            else {\n                pushQueue.push(chunk);\n            }\n        });\n        this.on('end', () => {\n            done = true;\n            for (const reader of readQueue) {\n                reader.resolve(undefined);\n            }\n            readQueue.length = 0;\n        });\n        this.on('abort', (err) => {\n            done = true;\n            for (const reader of readQueue) {\n                reader.reject(err);\n            }\n            readQueue.length = 0;\n        });\n        this.on('error', (err) => {\n            done = true;\n            for (const reader of readQueue) {\n                reader.reject(err);\n            }\n            readQueue.length = 0;\n        });\n        return {\n            next: async () => {\n                if (!pushQueue.length) {\n                    if (done) {\n                        return { value: undefined, done: true };\n                    }\n                    return new Promise((resolve, reject) => readQueue.push({ resolve, reject })).then((chunk) => (chunk ? { value: chunk, done: false } : { value: undefined, done: true }));\n                }\n                const chunk = pushQueue.shift();\n                return { value: chunk, done: false };\n            },\n            return: async () => {\n                this.abort();\n                return { value: undefined, done: true };\n            },\n        };\n    }\n    toReadableStream() {\n        const stream = new Stream(this[Symbol.asyncIterator].bind(this), this.controller);\n        return stream.toReadableStream();\n    }\n}\nfunction finalizeChatCompletion(snapshot, params) {\n    const { id, choices, created, model, system_fingerprint, ...rest } = snapshot;\n    const completion = {\n        ...rest,\n        id,\n        choices: choices.map(({ message, finish_reason, index, logprobs, ...choiceRest }) => {\n            if (!finish_reason) {\n                throw new OpenAIError(`missing finish_reason for choice ${index}`);\n            }\n            const { content = null, function_call, tool_calls, ...messageRest } = message;\n            const role = message.role; // this is what we expect; in theory it could be different which would make our types a slight lie but would be fine.\n            if (!role) {\n                throw new OpenAIError(`missing role for choice ${index}`);\n            }\n            if (function_call) {\n                const { arguments: args, name } = function_call;\n                if (args == null) {\n                    throw new OpenAIError(`missing function_call.arguments for choice ${index}`);\n                }\n                if (!name) {\n                    throw new OpenAIError(`missing function_call.name for choice ${index}`);\n                }\n                return {\n                    ...choiceRest,\n                    message: {\n                        content,\n                        function_call: { arguments: args, name },\n                        role,\n                        refusal: message.refusal ?? null,\n                    },\n                    finish_reason,\n                    index,\n                    logprobs,\n                };\n            }\n            if (tool_calls) {\n                return {\n                    ...choiceRest,\n                    index,\n                    finish_reason,\n                    logprobs,\n                    message: {\n                        ...messageRest,\n                        role,\n                        content,\n                        refusal: message.refusal ?? null,\n                        tool_calls: tool_calls.map((tool_call, i) => {\n                            const { function: fn, type, id, ...toolRest } = tool_call;\n                            const { arguments: args, name, ...fnRest } = fn || {};\n                            if (id == null) {\n                                throw new OpenAIError(`missing choices[${index}].tool_calls[${i}].id\\n${str(snapshot)}`);\n                            }\n                            if (type == null) {\n                                throw new OpenAIError(`missing choices[${index}].tool_calls[${i}].type\\n${str(snapshot)}`);\n                            }\n                            if (name == null) {\n                                throw new OpenAIError(`missing choices[${index}].tool_calls[${i}].function.name\\n${str(snapshot)}`);\n                            }\n                            if (args == null) {\n                                throw new OpenAIError(`missing choices[${index}].tool_calls[${i}].function.arguments\\n${str(snapshot)}`);\n                            }\n                            return { ...toolRest, id, type, function: { ...fnRest, name, arguments: args } };\n                        }),\n                    },\n                };\n            }\n            return {\n                ...choiceRest,\n                message: { ...messageRest, content, role, refusal: message.refusal ?? null },\n                finish_reason,\n                index,\n                logprobs,\n            };\n        }),\n        created,\n        model,\n        object: 'chat.completion',\n        ...(system_fingerprint ? { system_fingerprint } : {}),\n    };\n    return maybeParseChatCompletion(completion, params);\n}\nfunction str(x) {\n    return JSON.stringify(x);\n}\n/**\n * Ensures the given argument is an empty object, useful for\n * asserting that all known properties on an object have been\n * destructured.\n */\nfunction assertIsEmpty(obj) {\n    return;\n}\nfunction assertNever(_x) { }\n//# sourceMappingURL=ChatCompletionStream.mjs.map","import { ChatCompletionStream } from \"./ChatCompletionStream.mjs\";\nexport class ChatCompletionStreamingRunner extends ChatCompletionStream {\n    static fromReadableStream(stream) {\n        const runner = new ChatCompletionStreamingRunner(null);\n        runner._run(() => runner._fromReadableStream(stream));\n        return runner;\n    }\n    /** @deprecated - please use `runTools` instead. */\n    static runFunctions(client, params, options) {\n        const runner = new ChatCompletionStreamingRunner(null);\n        const opts = {\n            ...options,\n            headers: { ...options?.headers, 'X-Stainless-Helper-Method': 'runFunctions' },\n        };\n        runner._run(() => runner._runFunctions(client, params, opts));\n        return runner;\n    }\n    static runTools(client, params, options) {\n        const runner = new ChatCompletionStreamingRunner(\n        // @ts-expect-error TODO these types are incompatible\n        params);\n        const opts = {\n            ...options,\n            headers: { ...options?.headers, 'X-Stainless-Helper-Method': 'runTools' },\n        };\n        runner._run(() => runner._runTools(client, params, opts));\n        return runner;\n    }\n}\n//# sourceMappingURL=ChatCompletionStreamingRunner.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../resource.mjs\";\nimport { ChatCompletionRunner } from \"../../../lib/ChatCompletionRunner.mjs\";\nimport { ChatCompletionStreamingRunner, } from \"../../../lib/ChatCompletionStreamingRunner.mjs\";\nimport { ChatCompletionStream } from \"../../../lib/ChatCompletionStream.mjs\";\nimport { parseChatCompletion, validateInputTools } from \"../../../lib/parser.mjs\";\nexport { ChatCompletionStreamingRunner, } from \"../../../lib/ChatCompletionStreamingRunner.mjs\";\nexport { ParsingFunction, ParsingToolFunction, } from \"../../../lib/RunnableFunction.mjs\";\nexport { ChatCompletionStream } from \"../../../lib/ChatCompletionStream.mjs\";\nexport { ChatCompletionRunner, } from \"../../../lib/ChatCompletionRunner.mjs\";\nexport class Completions extends APIResource {\n    parse(body, options) {\n        validateInputTools(body.tools);\n        return this._client.chat.completions\n            .create(body, {\n            ...options,\n            headers: {\n                ...options?.headers,\n                'X-Stainless-Helper-Method': 'beta.chat.completions.parse',\n            },\n        })\n            ._thenUnwrap((completion) => parseChatCompletion(completion, body));\n    }\n    runFunctions(body, options) {\n        if (body.stream) {\n            return ChatCompletionStreamingRunner.runFunctions(this._client, body, options);\n        }\n        return ChatCompletionRunner.runFunctions(this._client, body, options);\n    }\n    runTools(body, options) {\n        if (body.stream) {\n            return ChatCompletionStreamingRunner.runTools(this._client, body, options);\n        }\n        return ChatCompletionRunner.runTools(this._client, body, options);\n    }\n    /**\n     * Creates a chat completion stream\n     */\n    stream(body, options) {\n        return ChatCompletionStream.createChatCompletion(this._client, body, options);\n    }\n}\n//# sourceMappingURL=completions.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../resource.mjs\";\nimport * as CompletionsAPI from \"./completions.mjs\";\nexport class Chat extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.completions = new CompletionsAPI.Completions(this._client);\n    }\n}\n(function (Chat) {\n    Chat.Completions = CompletionsAPI.Completions;\n})(Chat || (Chat = {}));\n//# sourceMappingURL=chat.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../resource.mjs\";\nexport class Sessions extends APIResource {\n    /**\n     * Create an ephemeral API token for use in client-side applications with the\n     * Realtime API. Can be configured with the same session parameters as the\n     * `session.update` client event.\n     *\n     * It responds with a session object, plus a `client_secret` key which contains a\n     * usable ephemeral API token that can be used to authenticate browser clients for\n     * the Realtime API.\n     *\n     * @example\n     * ```ts\n     * const session =\n     *   await client.beta.realtime.sessions.create();\n     * ```\n     */\n    create(body, options) {\n        return this._client.post('/realtime/sessions', {\n            body,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n}\n//# sourceMappingURL=sessions.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../resource.mjs\";\nexport class TranscriptionSessions extends APIResource {\n    /**\n     * Create an ephemeral API token for use in client-side applications with the\n     * Realtime API specifically for realtime transcriptions. Can be configured with\n     * the same session parameters as the `transcription_session.update` client event.\n     *\n     * It responds with a session object, plus a `client_secret` key which contains a\n     * usable ephemeral API token that can be used to authenticate browser clients for\n     * the Realtime API.\n     *\n     * @example\n     * ```ts\n     * const transcriptionSession =\n     *   await client.beta.realtime.transcriptionSessions.create();\n     * ```\n     */\n    create(body, options) {\n        return this._client.post('/realtime/transcription_sessions', {\n            body,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n}\n//# sourceMappingURL=transcription-sessions.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../resource.mjs\";\nimport * as SessionsAPI from \"./sessions.mjs\";\nimport { Sessions, } from \"./sessions.mjs\";\nimport * as TranscriptionSessionsAPI from \"./transcription-sessions.mjs\";\nimport { TranscriptionSessions, } from \"./transcription-sessions.mjs\";\nexport class Realtime extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.sessions = new SessionsAPI.Sessions(this._client);\n        this.transcriptionSessions = new TranscriptionSessionsAPI.TranscriptionSessions(this._client);\n    }\n}\nRealtime.Sessions = Sessions;\nRealtime.TranscriptionSessions = TranscriptionSessions;\n//# sourceMappingURL=realtime.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../resource.mjs\";\nimport { isRequestOptions } from \"../../../core.mjs\";\nimport { CursorPage } from \"../../../pagination.mjs\";\n/**\n * @deprecated The Assistants API is deprecated in favor of the Responses API\n */\nexport class Messages extends APIResource {\n    /**\n     * Create a message.\n     *\n     * @deprecated The Assistants API is deprecated in favor of the Responses API\n     */\n    create(threadId, body, options) {\n        return this._client.post(`/threads/${threadId}/messages`, {\n            body,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Retrieve a message.\n     *\n     * @deprecated The Assistants API is deprecated in favor of the Responses API\n     */\n    retrieve(threadId, messageId, options) {\n        return this._client.get(`/threads/${threadId}/messages/${messageId}`, {\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Modifies a message.\n     *\n     * @deprecated The Assistants API is deprecated in favor of the Responses API\n     */\n    update(threadId, messageId, body, options) {\n        return this._client.post(`/threads/${threadId}/messages/${messageId}`, {\n            body,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    list(threadId, query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.list(threadId, {}, query);\n        }\n        return this._client.getAPIList(`/threads/${threadId}/messages`, MessagesPage, {\n            query,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Deletes a message.\n     *\n     * @deprecated The Assistants API is deprecated in favor of the Responses API\n     */\n    del(threadId, messageId, options) {\n        return this._client.delete(`/threads/${threadId}/messages/${messageId}`, {\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n}\nexport class MessagesPage extends CursorPage {\n}\nMessages.MessagesPage = MessagesPage;\n//# sourceMappingURL=messages.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../../resource.mjs\";\nimport { isRequestOptions } from \"../../../../core.mjs\";\nimport { CursorPage } from \"../../../../pagination.mjs\";\n/**\n * @deprecated The Assistants API is deprecated in favor of the Responses API\n */\nexport class Steps extends APIResource {\n    retrieve(threadId, runId, stepId, query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.retrieve(threadId, runId, stepId, {}, query);\n        }\n        return this._client.get(`/threads/${threadId}/runs/${runId}/steps/${stepId}`, {\n            query,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    list(threadId, runId, query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.list(threadId, runId, {}, query);\n        }\n        return this._client.getAPIList(`/threads/${threadId}/runs/${runId}/steps`, RunStepsPage, {\n            query,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n}\nexport class RunStepsPage extends CursorPage {\n}\nSteps.RunStepsPage = RunStepsPage;\n//# sourceMappingURL=steps.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../../resource.mjs\";\nimport { isRequestOptions } from \"../../../../core.mjs\";\nimport { AssistantStream } from \"../../../../lib/AssistantStream.mjs\";\nimport { sleep } from \"../../../../core.mjs\";\nimport * as StepsAPI from \"./steps.mjs\";\nimport { RunStepsPage, Steps, } from \"./steps.mjs\";\nimport { CursorPage } from \"../../../../pagination.mjs\";\n/**\n * @deprecated The Assistants API is deprecated in favor of the Responses API\n */\nexport class Runs extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.steps = new StepsAPI.Steps(this._client);\n    }\n    create(threadId, params, options) {\n        const { include, ...body } = params;\n        return this._client.post(`/threads/${threadId}/runs`, {\n            query: { include },\n            body,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n            stream: params.stream ?? false,\n        });\n    }\n    /**\n     * Retrieves a run.\n     *\n     * @deprecated The Assistants API is deprecated in favor of the Responses API\n     */\n    retrieve(threadId, runId, options) {\n        return this._client.get(`/threads/${threadId}/runs/${runId}`, {\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Modifies a run.\n     *\n     * @deprecated The Assistants API is deprecated in favor of the Responses API\n     */\n    update(threadId, runId, body, options) {\n        return this._client.post(`/threads/${threadId}/runs/${runId}`, {\n            body,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    list(threadId, query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.list(threadId, {}, query);\n        }\n        return this._client.getAPIList(`/threads/${threadId}/runs`, RunsPage, {\n            query,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Cancels a run that is `in_progress`.\n     *\n     * @deprecated The Assistants API is deprecated in favor of the Responses API\n     */\n    cancel(threadId, runId, options) {\n        return this._client.post(`/threads/${threadId}/runs/${runId}/cancel`, {\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * A helper to create a run an poll for a terminal state. More information on Run\n     * lifecycles can be found here:\n     * https://platform.openai.com/docs/assistants/how-it-works/runs-and-run-steps\n     */\n    async createAndPoll(threadId, body, options) {\n        const run = await this.create(threadId, body, options);\n        return await this.poll(threadId, run.id, options);\n    }\n    /**\n     * Create a Run stream\n     *\n     * @deprecated use `stream` instead\n     */\n    createAndStream(threadId, body, options) {\n        return AssistantStream.createAssistantStream(threadId, this._client.beta.threads.runs, body, options);\n    }\n    /**\n     * A helper to poll a run status until it reaches a terminal state. More\n     * information on Run lifecycles can be found here:\n     * https://platform.openai.com/docs/assistants/how-it-works/runs-and-run-steps\n     */\n    async poll(threadId, runId, options) {\n        const headers = { ...options?.headers, 'X-Stainless-Poll-Helper': 'true' };\n        if (options?.pollIntervalMs) {\n            headers['X-Stainless-Custom-Poll-Interval'] = options.pollIntervalMs.toString();\n        }\n        while (true) {\n            const { data: run, response } = await this.retrieve(threadId, runId, {\n                ...options,\n                headers: { ...options?.headers, ...headers },\n            }).withResponse();\n            switch (run.status) {\n                //If we are in any sort of intermediate state we poll\n                case 'queued':\n                case 'in_progress':\n                case 'cancelling':\n                    let sleepInterval = 5000;\n                    if (options?.pollIntervalMs) {\n                        sleepInterval = options.pollIntervalMs;\n                    }\n                    else {\n                        const headerInterval = response.headers.get('openai-poll-after-ms');\n                        if (headerInterval) {\n                            const headerIntervalMs = parseInt(headerInterval);\n                            if (!isNaN(headerIntervalMs)) {\n                                sleepInterval = headerIntervalMs;\n                            }\n                        }\n                    }\n                    await sleep(sleepInterval);\n                    break;\n                //We return the run in any terminal state.\n                case 'requires_action':\n                case 'incomplete':\n                case 'cancelled':\n                case 'completed':\n                case 'failed':\n                case 'expired':\n                    return run;\n            }\n        }\n    }\n    /**\n     * Create a Run stream\n     */\n    stream(threadId, body, options) {\n        return AssistantStream.createAssistantStream(threadId, this._client.beta.threads.runs, body, options);\n    }\n    submitToolOutputs(threadId, runId, body, options) {\n        return this._client.post(`/threads/${threadId}/runs/${runId}/submit_tool_outputs`, {\n            body,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n            stream: body.stream ?? false,\n        });\n    }\n    /**\n     * A helper to submit a tool output to a run and poll for a terminal run state.\n     * More information on Run lifecycles can be found here:\n     * https://platform.openai.com/docs/assistants/how-it-works/runs-and-run-steps\n     */\n    async submitToolOutputsAndPoll(threadId, runId, body, options) {\n        const run = await this.submitToolOutputs(threadId, runId, body, options);\n        return await this.poll(threadId, run.id, options);\n    }\n    /**\n     * Submit the tool outputs from a previous run and stream the run to a terminal\n     * state. More information on Run lifecycles can be found here:\n     * https://platform.openai.com/docs/assistants/how-it-works/runs-and-run-steps\n     */\n    submitToolOutputsStream(threadId, runId, body, options) {\n        return AssistantStream.createToolAssistantStream(threadId, runId, this._client.beta.threads.runs, body, options);\n    }\n}\nexport class RunsPage extends CursorPage {\n}\nRuns.RunsPage = RunsPage;\nRuns.Steps = Steps;\nRuns.RunStepsPage = RunStepsPage;\n//# sourceMappingURL=runs.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../resource.mjs\";\nimport { isRequestOptions } from \"../../../core.mjs\";\nimport { AssistantStream } from \"../../../lib/AssistantStream.mjs\";\nimport * as MessagesAPI from \"./messages.mjs\";\nimport { Messages, MessagesPage, } from \"./messages.mjs\";\nimport * as RunsAPI from \"./runs/runs.mjs\";\nimport { Runs, RunsPage, } from \"./runs/runs.mjs\";\n/**\n * @deprecated The Assistants API is deprecated in favor of the Responses API\n */\nexport class Threads extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.runs = new RunsAPI.Runs(this._client);\n        this.messages = new MessagesAPI.Messages(this._client);\n    }\n    create(body = {}, options) {\n        if (isRequestOptions(body)) {\n            return this.create({}, body);\n        }\n        return this._client.post('/threads', {\n            body,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Retrieves a thread.\n     *\n     * @deprecated The Assistants API is deprecated in favor of the Responses API\n     */\n    retrieve(threadId, options) {\n        return this._client.get(`/threads/${threadId}`, {\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Modifies a thread.\n     *\n     * @deprecated The Assistants API is deprecated in favor of the Responses API\n     */\n    update(threadId, body, options) {\n        return this._client.post(`/threads/${threadId}`, {\n            body,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Delete a thread.\n     *\n     * @deprecated The Assistants API is deprecated in favor of the Responses API\n     */\n    del(threadId, options) {\n        return this._client.delete(`/threads/${threadId}`, {\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    createAndRun(body, options) {\n        return this._client.post('/threads/runs', {\n            body,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n            stream: body.stream ?? false,\n        });\n    }\n    /**\n     * A helper to create a thread, start a run and then poll for a terminal state.\n     * More information on Run lifecycles can be found here:\n     * https://platform.openai.com/docs/assistants/how-it-works/runs-and-run-steps\n     */\n    async createAndRunPoll(body, options) {\n        const run = await this.createAndRun(body, options);\n        return await this.runs.poll(run.thread_id, run.id, options);\n    }\n    /**\n     * Create a thread and stream the run back\n     */\n    createAndRunStream(body, options) {\n        return AssistantStream.createThreadAssistantStream(body, this._client.beta.threads, options);\n    }\n}\nThreads.Runs = Runs;\nThreads.RunsPage = RunsPage;\nThreads.Messages = Messages;\nThreads.MessagesPage = MessagesPage;\n//# sourceMappingURL=threads.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../resource.mjs\";\nimport * as AssistantsAPI from \"./assistants.mjs\";\nimport * as ChatAPI from \"./chat/chat.mjs\";\nimport { Assistants, AssistantsPage, } from \"./assistants.mjs\";\nimport * as RealtimeAPI from \"./realtime/realtime.mjs\";\nimport { Realtime, } from \"./realtime/realtime.mjs\";\nimport * as ThreadsAPI from \"./threads/threads.mjs\";\nimport { Threads, } from \"./threads/threads.mjs\";\nimport { Chat } from \"./chat/chat.mjs\";\nexport class Beta extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.realtime = new RealtimeAPI.Realtime(this._client);\n        this.chat = new ChatAPI.Chat(this._client);\n        this.assistants = new AssistantsAPI.Assistants(this._client);\n        this.threads = new ThreadsAPI.Threads(this._client);\n    }\n}\nBeta.Realtime = Realtime;\nBeta.Assistants = Assistants;\nBeta.AssistantsPage = AssistantsPage;\nBeta.Threads = Threads;\n//# sourceMappingURL=beta.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../resource.mjs\";\nexport class Completions extends APIResource {\n    create(body, options) {\n        return this._client.post('/completions', { body, ...options, stream: body.stream ?? false });\n    }\n}\n//# sourceMappingURL=completions.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../resource.mjs\";\nexport class Content extends APIResource {\n    /**\n     * Retrieve Container File Content\n     */\n    retrieve(containerId, fileId, options) {\n        return this._client.get(`/containers/${containerId}/files/${fileId}/content`, {\n            ...options,\n            headers: { Accept: 'application/binary', ...options?.headers },\n            __binaryResponse: true,\n        });\n    }\n}\n//# sourceMappingURL=content.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../resource.mjs\";\nimport { isRequestOptions } from \"../../../core.mjs\";\nimport * as Core from \"../../../core.mjs\";\nimport * as ContentAPI from \"./content.mjs\";\nimport { Content } from \"./content.mjs\";\nimport { CursorPage } from \"../../../pagination.mjs\";\nexport class Files extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.content = new ContentAPI.Content(this._client);\n    }\n    /**\n     * Create a Container File\n     *\n     * You can send either a multipart/form-data request with the raw file content, or\n     * a JSON request with a file ID.\n     */\n    create(containerId, body, options) {\n        return this._client.post(`/containers/${containerId}/files`, Core.multipartFormRequestOptions({ body, ...options }));\n    }\n    /**\n     * Retrieve Container File\n     */\n    retrieve(containerId, fileId, options) {\n        return this._client.get(`/containers/${containerId}/files/${fileId}`, options);\n    }\n    list(containerId, query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.list(containerId, {}, query);\n        }\n        return this._client.getAPIList(`/containers/${containerId}/files`, FileListResponsesPage, {\n            query,\n            ...options,\n        });\n    }\n    /**\n     * Delete Container File\n     */\n    del(containerId, fileId, options) {\n        return this._client.delete(`/containers/${containerId}/files/${fileId}`, {\n            ...options,\n            headers: { Accept: '*/*', ...options?.headers },\n        });\n    }\n}\nexport class FileListResponsesPage extends CursorPage {\n}\nFiles.FileListResponsesPage = FileListResponsesPage;\nFiles.Content = Content;\n//# sourceMappingURL=files.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../resource.mjs\";\nimport { isRequestOptions } from \"../../core.mjs\";\nimport * as FilesAPI from \"./files/files.mjs\";\nimport { FileListResponsesPage, Files, } from \"./files/files.mjs\";\nimport { CursorPage } from \"../../pagination.mjs\";\nexport class Containers extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.files = new FilesAPI.Files(this._client);\n    }\n    /**\n     * Create Container\n     */\n    create(body, options) {\n        return this._client.post('/containers', { body, ...options });\n    }\n    /**\n     * Retrieve Container\n     */\n    retrieve(containerId, options) {\n        return this._client.get(`/containers/${containerId}`, options);\n    }\n    list(query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.list({}, query);\n        }\n        return this._client.getAPIList('/containers', ContainerListResponsesPage, { query, ...options });\n    }\n    /**\n     * Delete Container\n     */\n    del(containerId, options) {\n        return this._client.delete(`/containers/${containerId}`, {\n            ...options,\n            headers: { Accept: '*/*', ...options?.headers },\n        });\n    }\n}\nexport class ContainerListResponsesPage extends CursorPage {\n}\nContainers.ContainerListResponsesPage = ContainerListResponsesPage;\nContainers.Files = Files;\nContainers.FileListResponsesPage = FileListResponsesPage;\n//# sourceMappingURL=containers.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../resource.mjs\";\nimport * as Core from \"../core.mjs\";\nexport class Embeddings extends APIResource {\n    /**\n     * Creates an embedding vector representing the input text.\n     *\n     * @example\n     * ```ts\n     * const createEmbeddingResponse =\n     *   await client.embeddings.create({\n     *     input: 'The quick brown fox jumped over the lazy dog',\n     *     model: 'text-embedding-3-small',\n     *   });\n     * ```\n     */\n    create(body, options) {\n        const hasUserProvidedEncodingFormat = !!body.encoding_format;\n        // No encoding_format specified, defaulting to base64 for performance reasons\n        // See https://github.com/openai/openai-node/pull/1312\n        let encoding_format = hasUserProvidedEncodingFormat ? body.encoding_format : 'base64';\n        if (hasUserProvidedEncodingFormat) {\n            Core.debug('Request', 'User defined encoding_format:', body.encoding_format);\n        }\n        const response = this._client.post('/embeddings', {\n            body: {\n                ...body,\n                encoding_format: encoding_format,\n            },\n            ...options,\n        });\n        // if the user specified an encoding_format, return the response as-is\n        if (hasUserProvidedEncodingFormat) {\n            return response;\n        }\n        // in this stage, we are sure the user did not specify an encoding_format\n        // and we defaulted to base64 for performance reasons\n        // we are sure then that the response is base64 encoded, let's decode it\n        // the returned result will be a float32 array since this is OpenAI API's default encoding\n        Core.debug('response', 'Decoding base64 embeddings to float32 array');\n        return response._thenUnwrap((response) => {\n            if (response && response.data) {\n                response.data.forEach((embeddingBase64Obj) => {\n                    const embeddingBase64Str = embeddingBase64Obj.embedding;\n                    embeddingBase64Obj.embedding = Core.toFloat32Array(embeddingBase64Str);\n                });\n            }\n            return response;\n        });\n    }\n}\n//# sourceMappingURL=embeddings.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../resource.mjs\";\nimport { isRequestOptions } from \"../../../core.mjs\";\nimport { CursorPage } from \"../../../pagination.mjs\";\nexport class OutputItems extends APIResource {\n    /**\n     * Get an evaluation run output item by ID.\n     */\n    retrieve(evalId, runId, outputItemId, options) {\n        return this._client.get(`/evals/${evalId}/runs/${runId}/output_items/${outputItemId}`, options);\n    }\n    list(evalId, runId, query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.list(evalId, runId, {}, query);\n        }\n        return this._client.getAPIList(`/evals/${evalId}/runs/${runId}/output_items`, OutputItemListResponsesPage, { query, ...options });\n    }\n}\nexport class OutputItemListResponsesPage extends CursorPage {\n}\nOutputItems.OutputItemListResponsesPage = OutputItemListResponsesPage;\n//# sourceMappingURL=output-items.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../resource.mjs\";\nimport { isRequestOptions } from \"../../../core.mjs\";\nimport * as OutputItemsAPI from \"./output-items.mjs\";\nimport { OutputItemListResponsesPage, OutputItems, } from \"./output-items.mjs\";\nimport { CursorPage } from \"../../../pagination.mjs\";\nexport class Runs extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.outputItems = new OutputItemsAPI.OutputItems(this._client);\n    }\n    /**\n     * Kicks off a new run for a given evaluation, specifying the data source, and what\n     * model configuration to use to test. The datasource will be validated against the\n     * schema specified in the config of the evaluation.\n     */\n    create(evalId, body, options) {\n        return this._client.post(`/evals/${evalId}/runs`, { body, ...options });\n    }\n    /**\n     * Get an evaluation run by ID.\n     */\n    retrieve(evalId, runId, options) {\n        return this._client.get(`/evals/${evalId}/runs/${runId}`, options);\n    }\n    list(evalId, query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.list(evalId, {}, query);\n        }\n        return this._client.getAPIList(`/evals/${evalId}/runs`, RunListResponsesPage, { query, ...options });\n    }\n    /**\n     * Delete an eval run.\n     */\n    del(evalId, runId, options) {\n        return this._client.delete(`/evals/${evalId}/runs/${runId}`, options);\n    }\n    /**\n     * Cancel an ongoing evaluation run.\n     */\n    cancel(evalId, runId, options) {\n        return this._client.post(`/evals/${evalId}/runs/${runId}`, options);\n    }\n}\nexport class RunListResponsesPage extends CursorPage {\n}\nRuns.RunListResponsesPage = RunListResponsesPage;\nRuns.OutputItems = OutputItems;\nRuns.OutputItemListResponsesPage = OutputItemListResponsesPage;\n//# sourceMappingURL=runs.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../resource.mjs\";\nimport { isRequestOptions } from \"../../core.mjs\";\nimport * as RunsAPI from \"./runs/runs.mjs\";\nimport { RunListResponsesPage, Runs, } from \"./runs/runs.mjs\";\nimport { CursorPage } from \"../../pagination.mjs\";\nexport class Evals extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.runs = new RunsAPI.Runs(this._client);\n    }\n    /**\n     * Create the structure of an evaluation that can be used to test a model's\n     * performance. An evaluation is a set of testing criteria and the config for a\n     * data source, which dictates the schema of the data used in the evaluation. After\n     * creating an evaluation, you can run it on different models and model parameters.\n     * We support several types of graders and datasources. For more information, see\n     * the [Evals guide](https://platform.openai.com/docs/guides/evals).\n     */\n    create(body, options) {\n        return this._client.post('/evals', { body, ...options });\n    }\n    /**\n     * Get an evaluation by ID.\n     */\n    retrieve(evalId, options) {\n        return this._client.get(`/evals/${evalId}`, options);\n    }\n    /**\n     * Update certain properties of an evaluation.\n     */\n    update(evalId, body, options) {\n        return this._client.post(`/evals/${evalId}`, { body, ...options });\n    }\n    list(query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.list({}, query);\n        }\n        return this._client.getAPIList('/evals', EvalListResponsesPage, { query, ...options });\n    }\n    /**\n     * Delete an evaluation.\n     */\n    del(evalId, options) {\n        return this._client.delete(`/evals/${evalId}`, options);\n    }\n}\nexport class EvalListResponsesPage extends CursorPage {\n}\nEvals.EvalListResponsesPage = EvalListResponsesPage;\nEvals.Runs = Runs;\nEvals.RunListResponsesPage = RunListResponsesPage;\n//# sourceMappingURL=evals.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../resource.mjs\";\nimport { isRequestOptions } from \"../core.mjs\";\nimport { sleep } from \"../core.mjs\";\nimport { APIConnectionTimeoutError } from \"../error.mjs\";\nimport * as Core from \"../core.mjs\";\nimport { CursorPage } from \"../pagination.mjs\";\nexport class Files extends APIResource {\n    /**\n     * Upload a file that can be used across various endpoints. Individual files can be\n     * up to 512 MB, and the size of all files uploaded by one organization can be up\n     * to 100 GB.\n     *\n     * The Assistants API supports files up to 2 million tokens and of specific file\n     * types. See the\n     * [Assistants Tools guide](https://platform.openai.com/docs/assistants/tools) for\n     * details.\n     *\n     * The Fine-tuning API only supports `.jsonl` files. The input also has certain\n     * required formats for fine-tuning\n     * [chat](https://platform.openai.com/docs/api-reference/fine-tuning/chat-input) or\n     * [completions](https://platform.openai.com/docs/api-reference/fine-tuning/completions-input)\n     * models.\n     *\n     * The Batch API only supports `.jsonl` files up to 200 MB in size. The input also\n     * has a specific required\n     * [format](https://platform.openai.com/docs/api-reference/batch/request-input).\n     *\n     * Please [contact us](https://help.openai.com/) if you need to increase these\n     * storage limits.\n     */\n    create(body, options) {\n        return this._client.post('/files', Core.multipartFormRequestOptions({ body, ...options }));\n    }\n    /**\n     * Returns information about a specific file.\n     */\n    retrieve(fileId, options) {\n        return this._client.get(`/files/${fileId}`, options);\n    }\n    list(query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.list({}, query);\n        }\n        return this._client.getAPIList('/files', FileObjectsPage, { query, ...options });\n    }\n    /**\n     * Delete a file.\n     */\n    del(fileId, options) {\n        return this._client.delete(`/files/${fileId}`, options);\n    }\n    /**\n     * Returns the contents of the specified file.\n     */\n    content(fileId, options) {\n        return this._client.get(`/files/${fileId}/content`, {\n            ...options,\n            headers: { Accept: 'application/binary', ...options?.headers },\n            __binaryResponse: true,\n        });\n    }\n    /**\n     * Returns the contents of the specified file.\n     *\n     * @deprecated The `.content()` method should be used instead\n     */\n    retrieveContent(fileId, options) {\n        return this._client.get(`/files/${fileId}/content`, options);\n    }\n    /**\n     * Waits for the given file to be processed, default timeout is 30 mins.\n     */\n    async waitForProcessing(id, { pollInterval = 5000, maxWait = 30 * 60 * 1000 } = {}) {\n        const TERMINAL_STATES = new Set(['processed', 'error', 'deleted']);\n        const start = Date.now();\n        let file = await this.retrieve(id);\n        while (!file.status || !TERMINAL_STATES.has(file.status)) {\n            await sleep(pollInterval);\n            file = await this.retrieve(id);\n            if (Date.now() - start > maxWait) {\n                throw new APIConnectionTimeoutError({\n                    message: `Giving up on waiting for file ${id} to finish processing after ${maxWait} milliseconds.`,\n                });\n            }\n        }\n        return file;\n    }\n}\nexport class FileObjectsPage extends CursorPage {\n}\nFiles.FileObjectsPage = FileObjectsPage;\n//# sourceMappingURL=files.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../resource.mjs\";\nexport class Methods extends APIResource {\n}\n//# sourceMappingURL=methods.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../resource.mjs\";\nexport class Graders extends APIResource {\n    /**\n     * Run a grader.\n     *\n     * @example\n     * ```ts\n     * const response = await client.fineTuning.alpha.graders.run({\n     *   grader: {\n     *     input: 'input',\n     *     name: 'name',\n     *     operation: 'eq',\n     *     reference: 'reference',\n     *     type: 'string_check',\n     *   },\n     *   model_sample: 'model_sample',\n     *   reference_answer: 'string',\n     * });\n     * ```\n     */\n    run(body, options) {\n        return this._client.post('/fine_tuning/alpha/graders/run', { body, ...options });\n    }\n    /**\n     * Validate a grader.\n     *\n     * @example\n     * ```ts\n     * const response =\n     *   await client.fineTuning.alpha.graders.validate({\n     *     grader: {\n     *       input: 'input',\n     *       name: 'name',\n     *       operation: 'eq',\n     *       reference: 'reference',\n     *       type: 'string_check',\n     *     },\n     *   });\n     * ```\n     */\n    validate(body, options) {\n        return this._client.post('/fine_tuning/alpha/graders/validate', { body, ...options });\n    }\n}\n//# sourceMappingURL=graders.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../resource.mjs\";\nimport * as GradersAPI from \"./graders.mjs\";\nimport { Graders, } from \"./graders.mjs\";\nexport class Alpha extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.graders = new GradersAPI.Graders(this._client);\n    }\n}\nAlpha.Graders = Graders;\n//# sourceMappingURL=alpha.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../resource.mjs\";\nimport { isRequestOptions } from \"../../../core.mjs\";\nimport { Page } from \"../../../pagination.mjs\";\nexport class Permissions extends APIResource {\n    /**\n     * **NOTE:** Calling this endpoint requires an [admin API key](../admin-api-keys).\n     *\n     * This enables organization owners to share fine-tuned models with other projects\n     * in their organization.\n     *\n     * @example\n     * ```ts\n     * // Automatically fetches more pages as needed.\n     * for await (const permissionCreateResponse of client.fineTuning.checkpoints.permissions.create(\n     *   'ft:gpt-4o-mini-2024-07-18:org:weather:B7R9VjQd',\n     *   { project_ids: ['string'] },\n     * )) {\n     *   // ...\n     * }\n     * ```\n     */\n    create(fineTunedModelCheckpoint, body, options) {\n        return this._client.getAPIList(`/fine_tuning/checkpoints/${fineTunedModelCheckpoint}/permissions`, PermissionCreateResponsesPage, { body, method: 'post', ...options });\n    }\n    retrieve(fineTunedModelCheckpoint, query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.retrieve(fineTunedModelCheckpoint, {}, query);\n        }\n        return this._client.get(`/fine_tuning/checkpoints/${fineTunedModelCheckpoint}/permissions`, {\n            query,\n            ...options,\n        });\n    }\n    /**\n     * **NOTE:** This endpoint requires an [admin API key](../admin-api-keys).\n     *\n     * Organization owners can use this endpoint to delete a permission for a\n     * fine-tuned model checkpoint.\n     *\n     * @example\n     * ```ts\n     * const permission =\n     *   await client.fineTuning.checkpoints.permissions.del(\n     *     'ft:gpt-4o-mini-2024-07-18:org:weather:B7R9VjQd',\n     *     'cp_zc4Q7MP6XxulcVzj4MZdwsAB',\n     *   );\n     * ```\n     */\n    del(fineTunedModelCheckpoint, permissionId, options) {\n        return this._client.delete(`/fine_tuning/checkpoints/${fineTunedModelCheckpoint}/permissions/${permissionId}`, options);\n    }\n}\n/**\n * Note: no pagination actually occurs yet, this is for forwards-compatibility.\n */\nexport class PermissionCreateResponsesPage extends Page {\n}\nPermissions.PermissionCreateResponsesPage = PermissionCreateResponsesPage;\n//# sourceMappingURL=permissions.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../resource.mjs\";\nimport * as PermissionsAPI from \"./permissions.mjs\";\nimport { PermissionCreateResponsesPage, Permissions, } from \"./permissions.mjs\";\nexport class Checkpoints extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.permissions = new PermissionsAPI.Permissions(this._client);\n    }\n}\nCheckpoints.Permissions = Permissions;\nCheckpoints.PermissionCreateResponsesPage = PermissionCreateResponsesPage;\n//# sourceMappingURL=checkpoints.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../resource.mjs\";\nimport { isRequestOptions } from \"../../../core.mjs\";\nimport { CursorPage } from \"../../../pagination.mjs\";\nexport class Checkpoints extends APIResource {\n    list(fineTuningJobId, query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.list(fineTuningJobId, {}, query);\n        }\n        return this._client.getAPIList(`/fine_tuning/jobs/${fineTuningJobId}/checkpoints`, FineTuningJobCheckpointsPage, { query, ...options });\n    }\n}\nexport class FineTuningJobCheckpointsPage extends CursorPage {\n}\nCheckpoints.FineTuningJobCheckpointsPage = FineTuningJobCheckpointsPage;\n//# sourceMappingURL=checkpoints.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../../resource.mjs\";\nimport { isRequestOptions } from \"../../../core.mjs\";\nimport * as CheckpointsAPI from \"./checkpoints.mjs\";\nimport { Checkpoints, FineTuningJobCheckpointsPage, } from \"./checkpoints.mjs\";\nimport { CursorPage } from \"../../../pagination.mjs\";\nexport class Jobs extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.checkpoints = new CheckpointsAPI.Checkpoints(this._client);\n    }\n    /**\n     * Creates a fine-tuning job which begins the process of creating a new model from\n     * a given dataset.\n     *\n     * Response includes details of the enqueued job including job status and the name\n     * of the fine-tuned models once complete.\n     *\n     * [Learn more about fine-tuning](https://platform.openai.com/docs/guides/fine-tuning)\n     *\n     * @example\n     * ```ts\n     * const fineTuningJob = await client.fineTuning.jobs.create({\n     *   model: 'gpt-4o-mini',\n     *   training_file: 'file-abc123',\n     * });\n     * ```\n     */\n    create(body, options) {\n        return this._client.post('/fine_tuning/jobs', { body, ...options });\n    }\n    /**\n     * Get info about a fine-tuning job.\n     *\n     * [Learn more about fine-tuning](https://platform.openai.com/docs/guides/fine-tuning)\n     *\n     * @example\n     * ```ts\n     * const fineTuningJob = await client.fineTuning.jobs.retrieve(\n     *   'ft-AF1WoRqd3aJAHsqc9NY7iL8F',\n     * );\n     * ```\n     */\n    retrieve(fineTuningJobId, options) {\n        return this._client.get(`/fine_tuning/jobs/${fineTuningJobId}`, options);\n    }\n    list(query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.list({}, query);\n        }\n        return this._client.getAPIList('/fine_tuning/jobs', FineTuningJobsPage, { query, ...options });\n    }\n    /**\n     * Immediately cancel a fine-tune job.\n     *\n     * @example\n     * ```ts\n     * const fineTuningJob = await client.fineTuning.jobs.cancel(\n     *   'ft-AF1WoRqd3aJAHsqc9NY7iL8F',\n     * );\n     * ```\n     */\n    cancel(fineTuningJobId, options) {\n        return this._client.post(`/fine_tuning/jobs/${fineTuningJobId}/cancel`, options);\n    }\n    listEvents(fineTuningJobId, query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.listEvents(fineTuningJobId, {}, query);\n        }\n        return this._client.getAPIList(`/fine_tuning/jobs/${fineTuningJobId}/events`, FineTuningJobEventsPage, {\n            query,\n            ...options,\n        });\n    }\n    /**\n     * Pause a fine-tune job.\n     *\n     * @example\n     * ```ts\n     * const fineTuningJob = await client.fineTuning.jobs.pause(\n     *   'ft-AF1WoRqd3aJAHsqc9NY7iL8F',\n     * );\n     * ```\n     */\n    pause(fineTuningJobId, options) {\n        return this._client.post(`/fine_tuning/jobs/${fineTuningJobId}/pause`, options);\n    }\n    /**\n     * Resume a fine-tune job.\n     *\n     * @example\n     * ```ts\n     * const fineTuningJob = await client.fineTuning.jobs.resume(\n     *   'ft-AF1WoRqd3aJAHsqc9NY7iL8F',\n     * );\n     * ```\n     */\n    resume(fineTuningJobId, options) {\n        return this._client.post(`/fine_tuning/jobs/${fineTuningJobId}/resume`, options);\n    }\n}\nexport class FineTuningJobsPage extends CursorPage {\n}\nexport class FineTuningJobEventsPage extends CursorPage {\n}\nJobs.FineTuningJobsPage = FineTuningJobsPage;\nJobs.FineTuningJobEventsPage = FineTuningJobEventsPage;\nJobs.Checkpoints = Checkpoints;\nJobs.FineTuningJobCheckpointsPage = FineTuningJobCheckpointsPage;\n//# sourceMappingURL=jobs.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../resource.mjs\";\nimport * as MethodsAPI from \"./methods.mjs\";\nimport { Methods, } from \"./methods.mjs\";\nimport * as AlphaAPI from \"./alpha/alpha.mjs\";\nimport { Alpha } from \"./alpha/alpha.mjs\";\nimport * as CheckpointsAPI from \"./checkpoints/checkpoints.mjs\";\nimport { Checkpoints } from \"./checkpoints/checkpoints.mjs\";\nimport * as JobsAPI from \"./jobs/jobs.mjs\";\nimport { FineTuningJobEventsPage, FineTuningJobsPage, Jobs, } from \"./jobs/jobs.mjs\";\nexport class FineTuning extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.methods = new MethodsAPI.Methods(this._client);\n        this.jobs = new JobsAPI.Jobs(this._client);\n        this.checkpoints = new CheckpointsAPI.Checkpoints(this._client);\n        this.alpha = new AlphaAPI.Alpha(this._client);\n    }\n}\nFineTuning.Methods = Methods;\nFineTuning.Jobs = Jobs;\nFineTuning.FineTuningJobsPage = FineTuningJobsPage;\nFineTuning.FineTuningJobEventsPage = FineTuningJobEventsPage;\nFineTuning.Checkpoints = Checkpoints;\nFineTuning.Alpha = Alpha;\n//# sourceMappingURL=fine-tuning.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../resource.mjs\";\nexport class GraderModels extends APIResource {\n}\n//# sourceMappingURL=grader-models.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../resource.mjs\";\nimport * as GraderModelsAPI from \"./grader-models.mjs\";\nimport { GraderModels, } from \"./grader-models.mjs\";\nexport class Graders extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.graderModels = new GraderModelsAPI.GraderModels(this._client);\n    }\n}\nGraders.GraderModels = GraderModels;\n//# sourceMappingURL=graders.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../resource.mjs\";\nimport * as Core from \"../core.mjs\";\nexport class Images extends APIResource {\n    /**\n     * Creates a variation of a given image. This endpoint only supports `dall-e-2`.\n     *\n     * @example\n     * ```ts\n     * const imagesResponse = await client.images.createVariation({\n     *   image: fs.createReadStream('otter.png'),\n     * });\n     * ```\n     */\n    createVariation(body, options) {\n        return this._client.post('/images/variations', Core.multipartFormRequestOptions({ body, ...options }));\n    }\n    /**\n     * Creates an edited or extended image given one or more source images and a\n     * prompt. This endpoint only supports `gpt-image-1` and `dall-e-2`.\n     *\n     * @example\n     * ```ts\n     * const imagesResponse = await client.images.edit({\n     *   image: fs.createReadStream('path/to/file'),\n     *   prompt: 'A cute baby sea otter wearing a beret',\n     * });\n     * ```\n     */\n    edit(body, options) {\n        return this._client.post('/images/edits', Core.multipartFormRequestOptions({ body, ...options }));\n    }\n    /**\n     * Creates an image given a prompt.\n     * [Learn more](https://platform.openai.com/docs/guides/images).\n     *\n     * @example\n     * ```ts\n     * const imagesResponse = await client.images.generate({\n     *   prompt: 'A cute baby sea otter',\n     * });\n     * ```\n     */\n    generate(body, options) {\n        return this._client.post('/images/generations', { body, ...options });\n    }\n}\n//# sourceMappingURL=images.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../resource.mjs\";\nimport { Page } from \"../pagination.mjs\";\nexport class Models extends APIResource {\n    /**\n     * Retrieves a model instance, providing basic information about the model such as\n     * the owner and permissioning.\n     */\n    retrieve(model, options) {\n        return this._client.get(`/models/${model}`, options);\n    }\n    /**\n     * Lists the currently available models, and provides basic information about each\n     * one such as the owner and availability.\n     */\n    list(options) {\n        return this._client.getAPIList('/models', ModelsPage, options);\n    }\n    /**\n     * Delete a fine-tuned model. You must have the Owner role in your organization to\n     * delete a model.\n     */\n    del(model, options) {\n        return this._client.delete(`/models/${model}`, options);\n    }\n}\n/**\n * Note: no pagination actually occurs yet, this is for forwards-compatibility.\n */\nexport class ModelsPage extends Page {\n}\nModels.ModelsPage = ModelsPage;\n//# sourceMappingURL=models.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../resource.mjs\";\nexport class Moderations extends APIResource {\n    /**\n     * Classifies if text and/or image inputs are potentially harmful. Learn more in\n     * the [moderation guide](https://platform.openai.com/docs/guides/moderation).\n     */\n    create(body, options) {\n        return this._client.post('/moderations', { body, ...options });\n    }\n}\n//# sourceMappingURL=moderations.mjs.map","import { OpenAIError } from \"../error.mjs\";\nimport { isAutoParsableResponseFormat } from \"../lib/parser.mjs\";\nexport function maybeParseResponse(response, params) {\n    if (!params || !hasAutoParseableInput(params)) {\n        return {\n            ...response,\n            output_parsed: null,\n            output: response.output.map((item) => {\n                if (item.type === 'function_call') {\n                    return {\n                        ...item,\n                        parsed_arguments: null,\n                    };\n                }\n                if (item.type === 'message') {\n                    return {\n                        ...item,\n                        content: item.content.map((content) => ({\n                            ...content,\n                            parsed: null,\n                        })),\n                    };\n                }\n                else {\n                    return item;\n                }\n            }),\n        };\n    }\n    return parseResponse(response, params);\n}\nexport function parseResponse(response, params) {\n    const output = response.output.map((item) => {\n        if (item.type === 'function_call') {\n            return {\n                ...item,\n                parsed_arguments: parseToolCall(params, item),\n            };\n        }\n        if (item.type === 'message') {\n            const content = item.content.map((content) => {\n                if (content.type === 'output_text') {\n                    return {\n                        ...content,\n                        parsed: parseTextFormat(params, content.text),\n                    };\n                }\n                return content;\n            });\n            return {\n                ...item,\n                content,\n            };\n        }\n        return item;\n    });\n    const parsed = Object.assign({}, response, { output });\n    if (!Object.getOwnPropertyDescriptor(response, 'output_text')) {\n        addOutputText(parsed);\n    }\n    Object.defineProperty(parsed, 'output_parsed', {\n        enumerable: true,\n        get() {\n            for (const output of parsed.output) {\n                if (output.type !== 'message') {\n                    continue;\n                }\n                for (const content of output.content) {\n                    if (content.type === 'output_text' && content.parsed !== null) {\n                        return content.parsed;\n                    }\n                }\n            }\n            return null;\n        },\n    });\n    return parsed;\n}\nfunction parseTextFormat(params, content) {\n    if (params.text?.format?.type !== 'json_schema') {\n        return null;\n    }\n    if ('$parseRaw' in params.text?.format) {\n        const text_format = params.text?.format;\n        return text_format.$parseRaw(content);\n    }\n    return JSON.parse(content);\n}\nexport function hasAutoParseableInput(params) {\n    if (isAutoParsableResponseFormat(params.text?.format)) {\n        return true;\n    }\n    return false;\n}\nexport function makeParseableResponseTool(tool, { parser, callback, }) {\n    const obj = { ...tool };\n    Object.defineProperties(obj, {\n        $brand: {\n            value: 'auto-parseable-tool',\n            enumerable: false,\n        },\n        $parseRaw: {\n            value: parser,\n            enumerable: false,\n        },\n        $callback: {\n            value: callback,\n            enumerable: false,\n        },\n    });\n    return obj;\n}\nexport function isAutoParsableTool(tool) {\n    return tool?.['$brand'] === 'auto-parseable-tool';\n}\nfunction getInputToolByName(input_tools, name) {\n    return input_tools.find((tool) => tool.type === 'function' && tool.name === name);\n}\nfunction parseToolCall(params, toolCall) {\n    const inputTool = getInputToolByName(params.tools ?? [], toolCall.name);\n    return {\n        ...toolCall,\n        ...toolCall,\n        parsed_arguments: isAutoParsableTool(inputTool) ? inputTool.$parseRaw(toolCall.arguments)\n            : inputTool?.strict ? JSON.parse(toolCall.arguments)\n                : null,\n    };\n}\nexport function shouldParseToolCall(params, toolCall) {\n    if (!params) {\n        return false;\n    }\n    const inputTool = getInputToolByName(params.tools ?? [], toolCall.name);\n    return isAutoParsableTool(inputTool) || inputTool?.strict || false;\n}\nexport function validateInputTools(tools) {\n    for (const tool of tools ?? []) {\n        if (tool.type !== 'function') {\n            throw new OpenAIError(`Currently only \\`function\\` tool types support auto-parsing; Received \\`${tool.type}\\``);\n        }\n        if (tool.function.strict !== true) {\n            throw new OpenAIError(`The \\`${tool.function.name}\\` tool is not marked with \\`strict: true\\`. Only strict function tools can be auto-parsed`);\n        }\n    }\n}\nexport function addOutputText(rsp) {\n    const texts = [];\n    for (const output of rsp.output) {\n        if (output.type !== 'message') {\n            continue;\n        }\n        for (const content of output.content) {\n            if (content.type === 'output_text') {\n                texts.push(content.text);\n            }\n        }\n    }\n    rsp.output_text = texts.join('');\n}\n//# sourceMappingURL=ResponsesParser.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../resource.mjs\";\nimport { isRequestOptions } from \"../../core.mjs\";\nimport { ResponseItemsPage } from \"./responses.mjs\";\nexport class InputItems extends APIResource {\n    list(responseId, query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.list(responseId, {}, query);\n        }\n        return this._client.getAPIList(`/responses/${responseId}/input_items`, ResponseItemsPage, {\n            query,\n            ...options,\n        });\n    }\n}\nexport { ResponseItemsPage };\n//# sourceMappingURL=input-items.mjs.map","var __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _ResponseStream_instances, _ResponseStream_params, _ResponseStream_currentResponseSnapshot, _ResponseStream_finalResponse, _ResponseStream_beginRequest, _ResponseStream_addEvent, _ResponseStream_endRequest, _ResponseStream_accumulateResponse;\nimport { APIUserAbortError, OpenAIError } from \"../../error.mjs\";\nimport { EventStream } from \"../EventStream.mjs\";\nimport { maybeParseResponse } from \"../ResponsesParser.mjs\";\nexport class ResponseStream extends EventStream {\n    constructor(params) {\n        super();\n        _ResponseStream_instances.add(this);\n        _ResponseStream_params.set(this, void 0);\n        _ResponseStream_currentResponseSnapshot.set(this, void 0);\n        _ResponseStream_finalResponse.set(this, void 0);\n        __classPrivateFieldSet(this, _ResponseStream_params, params, \"f\");\n    }\n    static createResponse(client, params, options) {\n        const runner = new ResponseStream(params);\n        runner._run(() => runner._createOrRetrieveResponse(client, params, {\n            ...options,\n            headers: { ...options?.headers, 'X-Stainless-Helper-Method': 'stream' },\n        }));\n        return runner;\n    }\n    async _createOrRetrieveResponse(client, params, options) {\n        const signal = options?.signal;\n        if (signal) {\n            if (signal.aborted)\n                this.controller.abort();\n            signal.addEventListener('abort', () => this.controller.abort());\n        }\n        __classPrivateFieldGet(this, _ResponseStream_instances, \"m\", _ResponseStream_beginRequest).call(this);\n        let stream;\n        let starting_after = null;\n        if ('response_id' in params) {\n            stream = await client.responses.retrieve(params.response_id, { stream: true }, { ...options, signal: this.controller.signal, stream: true });\n            starting_after = params.starting_after ?? null;\n        }\n        else {\n            stream = await client.responses.create({ ...params, stream: true }, { ...options, signal: this.controller.signal });\n        }\n        this._connected();\n        for await (const event of stream) {\n            __classPrivateFieldGet(this, _ResponseStream_instances, \"m\", _ResponseStream_addEvent).call(this, event, starting_after);\n        }\n        if (stream.controller.signal?.aborted) {\n            throw new APIUserAbortError();\n        }\n        return __classPrivateFieldGet(this, _ResponseStream_instances, \"m\", _ResponseStream_endRequest).call(this);\n    }\n    [(_ResponseStream_params = new WeakMap(), _ResponseStream_currentResponseSnapshot = new WeakMap(), _ResponseStream_finalResponse = new WeakMap(), _ResponseStream_instances = new WeakSet(), _ResponseStream_beginRequest = function _ResponseStream_beginRequest() {\n        if (this.ended)\n            return;\n        __classPrivateFieldSet(this, _ResponseStream_currentResponseSnapshot, undefined, \"f\");\n    }, _ResponseStream_addEvent = function _ResponseStream_addEvent(event, starting_after) {\n        if (this.ended)\n            return;\n        const maybeEmit = (name, event) => {\n            if (starting_after == null || event.sequence_number > starting_after) {\n                this._emit(name, event);\n            }\n        };\n        const response = __classPrivateFieldGet(this, _ResponseStream_instances, \"m\", _ResponseStream_accumulateResponse).call(this, event);\n        maybeEmit('event', event);\n        switch (event.type) {\n            case 'response.output_text.delta': {\n                const output = response.output[event.output_index];\n                if (!output) {\n                    throw new OpenAIError(`missing output at index ${event.output_index}`);\n                }\n                if (output.type === 'message') {\n                    const content = output.content[event.content_index];\n                    if (!content) {\n                        throw new OpenAIError(`missing content at index ${event.content_index}`);\n                    }\n                    if (content.type !== 'output_text') {\n                        throw new OpenAIError(`expected content to be 'output_text', got ${content.type}`);\n                    }\n                    maybeEmit('response.output_text.delta', {\n                        ...event,\n                        snapshot: content.text,\n                    });\n                }\n                break;\n            }\n            case 'response.function_call_arguments.delta': {\n                const output = response.output[event.output_index];\n                if (!output) {\n                    throw new OpenAIError(`missing output at index ${event.output_index}`);\n                }\n                if (output.type === 'function_call') {\n                    maybeEmit('response.function_call_arguments.delta', {\n                        ...event,\n                        snapshot: output.arguments,\n                    });\n                }\n                break;\n            }\n            default:\n                maybeEmit(event.type, event);\n                break;\n        }\n    }, _ResponseStream_endRequest = function _ResponseStream_endRequest() {\n        if (this.ended) {\n            throw new OpenAIError(`stream has ended, this shouldn't happen`);\n        }\n        const snapshot = __classPrivateFieldGet(this, _ResponseStream_currentResponseSnapshot, \"f\");\n        if (!snapshot) {\n            throw new OpenAIError(`request ended without sending any events`);\n        }\n        __classPrivateFieldSet(this, _ResponseStream_currentResponseSnapshot, undefined, \"f\");\n        const parsedResponse = finalizeResponse(snapshot, __classPrivateFieldGet(this, _ResponseStream_params, \"f\"));\n        __classPrivateFieldSet(this, _ResponseStream_finalResponse, parsedResponse, \"f\");\n        return parsedResponse;\n    }, _ResponseStream_accumulateResponse = function _ResponseStream_accumulateResponse(event) {\n        let snapshot = __classPrivateFieldGet(this, _ResponseStream_currentResponseSnapshot, \"f\");\n        if (!snapshot) {\n            if (event.type !== 'response.created') {\n                throw new OpenAIError(`When snapshot hasn't been set yet, expected 'response.created' event, got ${event.type}`);\n            }\n            snapshot = __classPrivateFieldSet(this, _ResponseStream_currentResponseSnapshot, event.response, \"f\");\n            return snapshot;\n        }\n        switch (event.type) {\n            case 'response.output_item.added': {\n                snapshot.output.push(event.item);\n                break;\n            }\n            case 'response.content_part.added': {\n                const output = snapshot.output[event.output_index];\n                if (!output) {\n                    throw new OpenAIError(`missing output at index ${event.output_index}`);\n                }\n                if (output.type === 'message') {\n                    output.content.push(event.part);\n                }\n                break;\n            }\n            case 'response.output_text.delta': {\n                const output = snapshot.output[event.output_index];\n                if (!output) {\n                    throw new OpenAIError(`missing output at index ${event.output_index}`);\n                }\n                if (output.type === 'message') {\n                    const content = output.content[event.content_index];\n                    if (!content) {\n                        throw new OpenAIError(`missing content at index ${event.content_index}`);\n                    }\n                    if (content.type !== 'output_text') {\n                        throw new OpenAIError(`expected content to be 'output_text', got ${content.type}`);\n                    }\n                    content.text += event.delta;\n                }\n                break;\n            }\n            case 'response.function_call_arguments.delta': {\n                const output = snapshot.output[event.output_index];\n                if (!output) {\n                    throw new OpenAIError(`missing output at index ${event.output_index}`);\n                }\n                if (output.type === 'function_call') {\n                    output.arguments += event.delta;\n                }\n                break;\n            }\n            case 'response.completed': {\n                __classPrivateFieldSet(this, _ResponseStream_currentResponseSnapshot, event.response, \"f\");\n                break;\n            }\n        }\n        return snapshot;\n    }, Symbol.asyncIterator)]() {\n        const pushQueue = [];\n        const readQueue = [];\n        let done = false;\n        this.on('event', (event) => {\n            const reader = readQueue.shift();\n            if (reader) {\n                reader.resolve(event);\n            }\n            else {\n                pushQueue.push(event);\n            }\n        });\n        this.on('end', () => {\n            done = true;\n            for (const reader of readQueue) {\n                reader.resolve(undefined);\n            }\n            readQueue.length = 0;\n        });\n        this.on('abort', (err) => {\n            done = true;\n            for (const reader of readQueue) {\n                reader.reject(err);\n            }\n            readQueue.length = 0;\n        });\n        this.on('error', (err) => {\n            done = true;\n            for (const reader of readQueue) {\n                reader.reject(err);\n            }\n            readQueue.length = 0;\n        });\n        return {\n            next: async () => {\n                if (!pushQueue.length) {\n                    if (done) {\n                        return { value: undefined, done: true };\n                    }\n                    return new Promise((resolve, reject) => readQueue.push({ resolve, reject })).then((event) => (event ? { value: event, done: false } : { value: undefined, done: true }));\n                }\n                const event = pushQueue.shift();\n                return { value: event, done: false };\n            },\n            return: async () => {\n                this.abort();\n                return { value: undefined, done: true };\n            },\n        };\n    }\n    /**\n     * @returns a promise that resolves with the final Response, or rejects\n     * if an error occurred or the stream ended prematurely without producing a REsponse.\n     */\n    async finalResponse() {\n        await this.done();\n        const response = __classPrivateFieldGet(this, _ResponseStream_finalResponse, \"f\");\n        if (!response)\n            throw new OpenAIError('stream ended without producing a ChatCompletion');\n        return response;\n    }\n}\nfunction finalizeResponse(snapshot, params) {\n    return maybeParseResponse(snapshot, params);\n}\n//# sourceMappingURL=ResponseStream.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { parseResponse, addOutputText, } from \"../../lib/ResponsesParser.mjs\";\nimport { APIResource } from \"../../resource.mjs\";\nimport * as InputItemsAPI from \"./input-items.mjs\";\nimport { InputItems } from \"./input-items.mjs\";\nimport { ResponseStream } from \"../../lib/responses/ResponseStream.mjs\";\nimport { CursorPage } from \"../../pagination.mjs\";\nexport class Responses extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.inputItems = new InputItemsAPI.InputItems(this._client);\n    }\n    create(body, options) {\n        return this._client.post('/responses', { body, ...options, stream: body.stream ?? false })._thenUnwrap((rsp) => {\n            if ('object' in rsp && rsp.object === 'response') {\n                addOutputText(rsp);\n            }\n            return rsp;\n        });\n    }\n    retrieve(responseId, query = {}, options) {\n        return this._client.get(`/responses/${responseId}`, {\n            query,\n            ...options,\n            stream: query?.stream ?? false,\n        });\n    }\n    /**\n     * Deletes a model response with the given ID.\n     *\n     * @example\n     * ```ts\n     * await client.responses.del(\n     *   'resp_677efb5139a88190b512bc3fef8e535d',\n     * );\n     * ```\n     */\n    del(responseId, options) {\n        return this._client.delete(`/responses/${responseId}`, {\n            ...options,\n            headers: { Accept: '*/*', ...options?.headers },\n        });\n    }\n    parse(body, options) {\n        return this._client.responses\n            .create(body, options)\n            ._thenUnwrap((response) => parseResponse(response, body));\n    }\n    /**\n     * Creates a model response stream\n     */\n    stream(body, options) {\n        return ResponseStream.createResponse(this._client, body, options);\n    }\n    /**\n     * Cancels a model response with the given ID. Only responses created with the\n     * `background` parameter set to `true` can be cancelled.\n     * [Learn more](https://platform.openai.com/docs/guides/background).\n     *\n     * @example\n     * ```ts\n     * await client.responses.cancel(\n     *   'resp_677efb5139a88190b512bc3fef8e535d',\n     * );\n     * ```\n     */\n    cancel(responseId, options) {\n        return this._client.post(`/responses/${responseId}/cancel`, {\n            ...options,\n            headers: { Accept: '*/*', ...options?.headers },\n        });\n    }\n}\nexport class ResponseItemsPage extends CursorPage {\n}\nResponses.InputItems = InputItems;\n//# sourceMappingURL=responses.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../resource.mjs\";\nimport * as Core from \"../../core.mjs\";\nexport class Parts extends APIResource {\n    /**\n     * Adds a\n     * [Part](https://platform.openai.com/docs/api-reference/uploads/part-object) to an\n     * [Upload](https://platform.openai.com/docs/api-reference/uploads/object) object.\n     * A Part represents a chunk of bytes from the file you are trying to upload.\n     *\n     * Each Part can be at most 64 MB, and you can add Parts until you hit the Upload\n     * maximum of 8 GB.\n     *\n     * It is possible to add multiple Parts in parallel. You can decide the intended\n     * order of the Parts when you\n     * [complete the Upload](https://platform.openai.com/docs/api-reference/uploads/complete).\n     */\n    create(uploadId, body, options) {\n        return this._client.post(`/uploads/${uploadId}/parts`, Core.multipartFormRequestOptions({ body, ...options }));\n    }\n}\n//# sourceMappingURL=parts.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../resource.mjs\";\nimport * as PartsAPI from \"./parts.mjs\";\nimport { Parts } from \"./parts.mjs\";\nexport class Uploads extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.parts = new PartsAPI.Parts(this._client);\n    }\n    /**\n     * Creates an intermediate\n     * [Upload](https://platform.openai.com/docs/api-reference/uploads/object) object\n     * that you can add\n     * [Parts](https://platform.openai.com/docs/api-reference/uploads/part-object) to.\n     * Currently, an Upload can accept at most 8 GB in total and expires after an hour\n     * after you create it.\n     *\n     * Once you complete the Upload, we will create a\n     * [File](https://platform.openai.com/docs/api-reference/files/object) object that\n     * contains all the parts you uploaded. This File is usable in the rest of our\n     * platform as a regular File object.\n     *\n     * For certain `purpose` values, the correct `mime_type` must be specified. Please\n     * refer to documentation for the\n     * [supported MIME types for your use case](https://platform.openai.com/docs/assistants/tools/file-search#supported-files).\n     *\n     * For guidance on the proper filename extensions for each purpose, please follow\n     * the documentation on\n     * [creating a File](https://platform.openai.com/docs/api-reference/files/create).\n     */\n    create(body, options) {\n        return this._client.post('/uploads', { body, ...options });\n    }\n    /**\n     * Cancels the Upload. No Parts may be added after an Upload is cancelled.\n     */\n    cancel(uploadId, options) {\n        return this._client.post(`/uploads/${uploadId}/cancel`, options);\n    }\n    /**\n     * Completes the\n     * [Upload](https://platform.openai.com/docs/api-reference/uploads/object).\n     *\n     * Within the returned Upload object, there is a nested\n     * [File](https://platform.openai.com/docs/api-reference/files/object) object that\n     * is ready to use in the rest of the platform.\n     *\n     * You can specify the order of the Parts by passing in an ordered list of the Part\n     * IDs.\n     *\n     * The number of bytes uploaded upon completion must match the number of bytes\n     * initially specified when creating the Upload object. No Parts may be added after\n     * an Upload is completed.\n     */\n    complete(uploadId, body, options) {\n        return this._client.post(`/uploads/${uploadId}/complete`, { body, ...options });\n    }\n}\nUploads.Parts = Parts;\n//# sourceMappingURL=uploads.mjs.map","/**\n * Like `Promise.allSettled()` but throws an error if any promises are rejected.\n */\nexport const allSettledWithThrow = async (promises) => {\n    const results = await Promise.allSettled(promises);\n    const rejected = results.filter((result) => result.status === 'rejected');\n    if (rejected.length) {\n        for (const result of rejected) {\n            console.error(result.reason);\n        }\n        throw new Error(`${rejected.length} promise(s) failed - see the above errors`);\n    }\n    // Note: TS was complaining about using `.filter().map()` here for some reason\n    const values = [];\n    for (const result of results) {\n        if (result.status === 'fulfilled') {\n            values.push(result.value);\n        }\n    }\n    return values;\n};\n//# sourceMappingURL=Util.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../resource.mjs\";\nimport { sleep, isRequestOptions } from \"../../core.mjs\";\nimport { CursorPage, Page } from \"../../pagination.mjs\";\nexport class Files extends APIResource {\n    /**\n     * Create a vector store file by attaching a\n     * [File](https://platform.openai.com/docs/api-reference/files) to a\n     * [vector store](https://platform.openai.com/docs/api-reference/vector-stores/object).\n     */\n    create(vectorStoreId, body, options) {\n        return this._client.post(`/vector_stores/${vectorStoreId}/files`, {\n            body,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Retrieves a vector store file.\n     */\n    retrieve(vectorStoreId, fileId, options) {\n        return this._client.get(`/vector_stores/${vectorStoreId}/files/${fileId}`, {\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Update attributes on a vector store file.\n     */\n    update(vectorStoreId, fileId, body, options) {\n        return this._client.post(`/vector_stores/${vectorStoreId}/files/${fileId}`, {\n            body,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    list(vectorStoreId, query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.list(vectorStoreId, {}, query);\n        }\n        return this._client.getAPIList(`/vector_stores/${vectorStoreId}/files`, VectorStoreFilesPage, {\n            query,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Delete a vector store file. This will remove the file from the vector store but\n     * the file itself will not be deleted. To delete the file, use the\n     * [delete file](https://platform.openai.com/docs/api-reference/files/delete)\n     * endpoint.\n     */\n    del(vectorStoreId, fileId, options) {\n        return this._client.delete(`/vector_stores/${vectorStoreId}/files/${fileId}`, {\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Attach a file to the given vector store and wait for it to be processed.\n     */\n    async createAndPoll(vectorStoreId, body, options) {\n        const file = await this.create(vectorStoreId, body, options);\n        return await this.poll(vectorStoreId, file.id, options);\n    }\n    /**\n     * Wait for the vector store file to finish processing.\n     *\n     * Note: this will return even if the file failed to process, you need to check\n     * file.last_error and file.status to handle these cases\n     */\n    async poll(vectorStoreId, fileId, options) {\n        const headers = { ...options?.headers, 'X-Stainless-Poll-Helper': 'true' };\n        if (options?.pollIntervalMs) {\n            headers['X-Stainless-Custom-Poll-Interval'] = options.pollIntervalMs.toString();\n        }\n        while (true) {\n            const fileResponse = await this.retrieve(vectorStoreId, fileId, {\n                ...options,\n                headers,\n            }).withResponse();\n            const file = fileResponse.data;\n            switch (file.status) {\n                case 'in_progress':\n                    let sleepInterval = 5000;\n                    if (options?.pollIntervalMs) {\n                        sleepInterval = options.pollIntervalMs;\n                    }\n                    else {\n                        const headerInterval = fileResponse.response.headers.get('openai-poll-after-ms');\n                        if (headerInterval) {\n                            const headerIntervalMs = parseInt(headerInterval);\n                            if (!isNaN(headerIntervalMs)) {\n                                sleepInterval = headerIntervalMs;\n                            }\n                        }\n                    }\n                    await sleep(sleepInterval);\n                    break;\n                case 'failed':\n                case 'completed':\n                    return file;\n            }\n        }\n    }\n    /**\n     * Upload a file to the `files` API and then attach it to the given vector store.\n     *\n     * Note the file will be asynchronously processed (you can use the alternative\n     * polling helper method to wait for processing to complete).\n     */\n    async upload(vectorStoreId, file, options) {\n        const fileInfo = await this._client.files.create({ file: file, purpose: 'assistants' }, options);\n        return this.create(vectorStoreId, { file_id: fileInfo.id }, options);\n    }\n    /**\n     * Add a file to a vector store and poll until processing is complete.\n     */\n    async uploadAndPoll(vectorStoreId, file, options) {\n        const fileInfo = await this.upload(vectorStoreId, file, options);\n        return await this.poll(vectorStoreId, fileInfo.id, options);\n    }\n    /**\n     * Retrieve the parsed contents of a vector store file.\n     */\n    content(vectorStoreId, fileId, options) {\n        return this._client.getAPIList(`/vector_stores/${vectorStoreId}/files/${fileId}/content`, FileContentResponsesPage, { ...options, headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers } });\n    }\n}\nexport class VectorStoreFilesPage extends CursorPage {\n}\n/**\n * Note: no pagination actually occurs yet, this is for forwards-compatibility.\n */\nexport class FileContentResponsesPage extends Page {\n}\nFiles.VectorStoreFilesPage = VectorStoreFilesPage;\nFiles.FileContentResponsesPage = FileContentResponsesPage;\n//# sourceMappingURL=files.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../resource.mjs\";\nimport { isRequestOptions } from \"../../core.mjs\";\nimport { sleep } from \"../../core.mjs\";\nimport { allSettledWithThrow } from \"../../lib/Util.mjs\";\nimport { VectorStoreFilesPage } from \"./files.mjs\";\nexport class FileBatches extends APIResource {\n    /**\n     * Create a vector store file batch.\n     */\n    create(vectorStoreId, body, options) {\n        return this._client.post(`/vector_stores/${vectorStoreId}/file_batches`, {\n            body,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Retrieves a vector store file batch.\n     */\n    retrieve(vectorStoreId, batchId, options) {\n        return this._client.get(`/vector_stores/${vectorStoreId}/file_batches/${batchId}`, {\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Cancel a vector store file batch. This attempts to cancel the processing of\n     * files in this batch as soon as possible.\n     */\n    cancel(vectorStoreId, batchId, options) {\n        return this._client.post(`/vector_stores/${vectorStoreId}/file_batches/${batchId}/cancel`, {\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Create a vector store batch and poll until all files have been processed.\n     */\n    async createAndPoll(vectorStoreId, body, options) {\n        const batch = await this.create(vectorStoreId, body);\n        return await this.poll(vectorStoreId, batch.id, options);\n    }\n    listFiles(vectorStoreId, batchId, query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.listFiles(vectorStoreId, batchId, {}, query);\n        }\n        return this._client.getAPIList(`/vector_stores/${vectorStoreId}/file_batches/${batchId}/files`, VectorStoreFilesPage, { query, ...options, headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers } });\n    }\n    /**\n     * Wait for the given file batch to be processed.\n     *\n     * Note: this will return even if one of the files failed to process, you need to\n     * check batch.file_counts.failed_count to handle this case.\n     */\n    async poll(vectorStoreId, batchId, options) {\n        const headers = { ...options?.headers, 'X-Stainless-Poll-Helper': 'true' };\n        if (options?.pollIntervalMs) {\n            headers['X-Stainless-Custom-Poll-Interval'] = options.pollIntervalMs.toString();\n        }\n        while (true) {\n            const { data: batch, response } = await this.retrieve(vectorStoreId, batchId, {\n                ...options,\n                headers,\n            }).withResponse();\n            switch (batch.status) {\n                case 'in_progress':\n                    let sleepInterval = 5000;\n                    if (options?.pollIntervalMs) {\n                        sleepInterval = options.pollIntervalMs;\n                    }\n                    else {\n                        const headerInterval = response.headers.get('openai-poll-after-ms');\n                        if (headerInterval) {\n                            const headerIntervalMs = parseInt(headerInterval);\n                            if (!isNaN(headerIntervalMs)) {\n                                sleepInterval = headerIntervalMs;\n                            }\n                        }\n                    }\n                    await sleep(sleepInterval);\n                    break;\n                case 'failed':\n                case 'cancelled':\n                case 'completed':\n                    return batch;\n            }\n        }\n    }\n    /**\n     * Uploads the given files concurrently and then creates a vector store file batch.\n     *\n     * The concurrency limit is configurable using the `maxConcurrency` parameter.\n     */\n    async uploadAndPoll(vectorStoreId, { files, fileIds = [] }, options) {\n        if (files == null || files.length == 0) {\n            throw new Error(`No \\`files\\` provided to process. If you've already uploaded files you should use \\`.createAndPoll()\\` instead`);\n        }\n        const configuredConcurrency = options?.maxConcurrency ?? 5;\n        // We cap the number of workers at the number of files (so we don't start any unnecessary workers)\n        const concurrencyLimit = Math.min(configuredConcurrency, files.length);\n        const client = this._client;\n        const fileIterator = files.values();\n        const allFileIds = [...fileIds];\n        // This code is based on this design. The libraries don't accommodate our environment limits.\n        // https://stackoverflow.com/questions/40639432/what-is-the-best-way-to-limit-concurrency-when-using-es6s-promise-all\n        async function processFiles(iterator) {\n            for (let item of iterator) {\n                const fileObj = await client.files.create({ file: item, purpose: 'assistants' }, options);\n                allFileIds.push(fileObj.id);\n            }\n        }\n        // Start workers to process results\n        const workers = Array(concurrencyLimit).fill(fileIterator).map(processFiles);\n        // Wait for all processing to complete.\n        await allSettledWithThrow(workers);\n        return await this.createAndPoll(vectorStoreId, {\n            file_ids: allFileIds,\n        });\n    }\n}\nexport { VectorStoreFilesPage };\n//# sourceMappingURL=file-batches.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nimport { APIResource } from \"../../resource.mjs\";\nimport { isRequestOptions } from \"../../core.mjs\";\nimport * as FileBatchesAPI from \"./file-batches.mjs\";\nimport { FileBatches, } from \"./file-batches.mjs\";\nimport * as FilesAPI from \"./files.mjs\";\nimport { FileContentResponsesPage, Files, VectorStoreFilesPage, } from \"./files.mjs\";\nimport { CursorPage, Page } from \"../../pagination.mjs\";\nexport class VectorStores extends APIResource {\n    constructor() {\n        super(...arguments);\n        this.files = new FilesAPI.Files(this._client);\n        this.fileBatches = new FileBatchesAPI.FileBatches(this._client);\n    }\n    /**\n     * Create a vector store.\n     */\n    create(body, options) {\n        return this._client.post('/vector_stores', {\n            body,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Retrieves a vector store.\n     */\n    retrieve(vectorStoreId, options) {\n        return this._client.get(`/vector_stores/${vectorStoreId}`, {\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Modifies a vector store.\n     */\n    update(vectorStoreId, body, options) {\n        return this._client.post(`/vector_stores/${vectorStoreId}`, {\n            body,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    list(query = {}, options) {\n        if (isRequestOptions(query)) {\n            return this.list({}, query);\n        }\n        return this._client.getAPIList('/vector_stores', VectorStoresPage, {\n            query,\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Delete a vector store.\n     */\n    del(vectorStoreId, options) {\n        return this._client.delete(`/vector_stores/${vectorStoreId}`, {\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n    /**\n     * Search a vector store for relevant chunks based on a query and file attributes\n     * filter.\n     */\n    search(vectorStoreId, body, options) {\n        return this._client.getAPIList(`/vector_stores/${vectorStoreId}/search`, VectorStoreSearchResponsesPage, {\n            body,\n            method: 'post',\n            ...options,\n            headers: { 'OpenAI-Beta': 'assistants=v2', ...options?.headers },\n        });\n    }\n}\nexport class VectorStoresPage extends CursorPage {\n}\n/**\n * Note: no pagination actually occurs yet, this is for forwards-compatibility.\n */\nexport class VectorStoreSearchResponsesPage extends Page {\n}\nVectorStores.VectorStoresPage = VectorStoresPage;\nVectorStores.VectorStoreSearchResponsesPage = VectorStoreSearchResponsesPage;\nVectorStores.Files = Files;\nVectorStores.VectorStoreFilesPage = VectorStoreFilesPage;\nVectorStores.FileContentResponsesPage = FileContentResponsesPage;\nVectorStores.FileBatches = FileBatches;\n//# sourceMappingURL=vector-stores.mjs.map","// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.\nvar _a;\nimport * as qs from \"./internal/qs/index.mjs\";\nimport * as Core from \"./core.mjs\";\nimport * as Errors from \"./error.mjs\";\nimport * as Pagination from \"./pagination.mjs\";\nimport * as Uploads from \"./uploads.mjs\";\nimport * as API from \"./resources/index.mjs\";\nimport { Batches, BatchesPage, } from \"./resources/batches.mjs\";\nimport { Completions, } from \"./resources/completions.mjs\";\nimport { Embeddings, } from \"./resources/embeddings.mjs\";\nimport { FileObjectsPage, Files, } from \"./resources/files.mjs\";\nimport { Images, } from \"./resources/images.mjs\";\nimport { Models, ModelsPage } from \"./resources/models.mjs\";\nimport { Moderations, } from \"./resources/moderations.mjs\";\nimport { Audio } from \"./resources/audio/audio.mjs\";\nimport { Beta } from \"./resources/beta/beta.mjs\";\nimport { Chat } from \"./resources/chat/chat.mjs\";\nimport { ContainerListResponsesPage, Containers, } from \"./resources/containers/containers.mjs\";\nimport { EvalListResponsesPage, Evals, } from \"./resources/evals/evals.mjs\";\nimport { FineTuning } from \"./resources/fine-tuning/fine-tuning.mjs\";\nimport { Graders } from \"./resources/graders/graders.mjs\";\nimport { Responses } from \"./resources/responses/responses.mjs\";\nimport { Uploads as UploadsAPIUploads, } from \"./resources/uploads/uploads.mjs\";\nimport { VectorStoreSearchResponsesPage, VectorStores, VectorStoresPage, } from \"./resources/vector-stores/vector-stores.mjs\";\nimport { ChatCompletionsPage, } from \"./resources/chat/completions/completions.mjs\";\n/**\n * API Client for interfacing with the OpenAI API.\n */\nexport class OpenAI extends Core.APIClient {\n    /**\n     * API Client for interfacing with the OpenAI API.\n     *\n     * @param {string | undefined} [opts.apiKey=process.env['OPENAI_API_KEY'] ?? undefined]\n     * @param {string | null | undefined} [opts.organization=process.env['OPENAI_ORG_ID'] ?? null]\n     * @param {string | null | undefined} [opts.project=process.env['OPENAI_PROJECT_ID'] ?? null]\n     * @param {string} [opts.baseURL=process.env['OPENAI_BASE_URL'] ?? https://api.openai.com/v1] - Override the default base URL for the API.\n     * @param {number} [opts.timeout=10 minutes] - The maximum amount of time (in milliseconds) the client will wait for a response before timing out.\n     * @param {number} [opts.httpAgent] - An HTTP agent used to manage HTTP(s) connections.\n     * @param {Core.Fetch} [opts.fetch] - Specify a custom `fetch` function implementation.\n     * @param {number} [opts.maxRetries=2] - The maximum number of times the client will retry a request.\n     * @param {Core.Headers} opts.defaultHeaders - Default headers to include with every request to the API.\n     * @param {Core.DefaultQuery} opts.defaultQuery - Default query parameters to include with every request to the API.\n     * @param {boolean} [opts.dangerouslyAllowBrowser=false] - By default, client-side use of this library is not allowed, as it risks exposing your secret API credentials to attackers.\n     */\n    constructor({ baseURL = Core.readEnv('OPENAI_BASE_URL'), apiKey = Core.readEnv('OPENAI_API_KEY'), organization = Core.readEnv('OPENAI_ORG_ID') ?? null, project = Core.readEnv('OPENAI_PROJECT_ID') ?? null, ...opts } = {}) {\n        if (apiKey === undefined) {\n            throw new Errors.OpenAIError(\"The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).\");\n        }\n        const options = {\n            apiKey,\n            organization,\n            project,\n            ...opts,\n            baseURL: baseURL || `https://api.openai.com/v1`,\n        };\n        if (!options.dangerouslyAllowBrowser && Core.isRunningInBrowser()) {\n            throw new Errors.OpenAIError(\"It looks like you're running in a browser-like environment.\\n\\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\\nIf you understand the risks and have appropriate mitigations in place,\\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\\n\\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\\n\\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\\n\");\n        }\n        super({\n            baseURL: options.baseURL,\n            timeout: options.timeout ?? 600000 /* 10 minutes */,\n            httpAgent: options.httpAgent,\n            maxRetries: options.maxRetries,\n            fetch: options.fetch,\n        });\n        this.completions = new API.Completions(this);\n        this.chat = new API.Chat(this);\n        this.embeddings = new API.Embeddings(this);\n        this.files = new API.Files(this);\n        this.images = new API.Images(this);\n        this.audio = new API.Audio(this);\n        this.moderations = new API.Moderations(this);\n        this.models = new API.Models(this);\n        this.fineTuning = new API.FineTuning(this);\n        this.graders = new API.Graders(this);\n        this.vectorStores = new API.VectorStores(this);\n        this.beta = new API.Beta(this);\n        this.batches = new API.Batches(this);\n        this.uploads = new API.Uploads(this);\n        this.responses = new API.Responses(this);\n        this.evals = new API.Evals(this);\n        this.containers = new API.Containers(this);\n        this._options = options;\n        this.apiKey = apiKey;\n        this.organization = organization;\n        this.project = project;\n    }\n    defaultQuery() {\n        return this._options.defaultQuery;\n    }\n    defaultHeaders(opts) {\n        return {\n            ...super.defaultHeaders(opts),\n            'OpenAI-Organization': this.organization,\n            'OpenAI-Project': this.project,\n            ...this._options.defaultHeaders,\n        };\n    }\n    authHeaders(opts) {\n        return { Authorization: `Bearer ${this.apiKey}` };\n    }\n    stringifyQuery(query) {\n        return qs.stringify(query, { arrayFormat: 'brackets' });\n    }\n}\n_a = OpenAI;\nOpenAI.OpenAI = _a;\nOpenAI.DEFAULT_TIMEOUT = 600000; // 10 minutes\nOpenAI.OpenAIError = Errors.OpenAIError;\nOpenAI.APIError = Errors.APIError;\nOpenAI.APIConnectionError = Errors.APIConnectionError;\nOpenAI.APIConnectionTimeoutError = Errors.APIConnectionTimeoutError;\nOpenAI.APIUserAbortError = Errors.APIUserAbortError;\nOpenAI.NotFoundError = Errors.NotFoundError;\nOpenAI.ConflictError = Errors.ConflictError;\nOpenAI.RateLimitError = Errors.RateLimitError;\nOpenAI.BadRequestError = Errors.BadRequestError;\nOpenAI.AuthenticationError = Errors.AuthenticationError;\nOpenAI.InternalServerError = Errors.InternalServerError;\nOpenAI.PermissionDeniedError = Errors.PermissionDeniedError;\nOpenAI.UnprocessableEntityError = Errors.UnprocessableEntityError;\nOpenAI.toFile = Uploads.toFile;\nOpenAI.fileFromPath = Uploads.fileFromPath;\nOpenAI.Completions = Completions;\nOpenAI.Chat = Chat;\nOpenAI.ChatCompletionsPage = ChatCompletionsPage;\nOpenAI.Embeddings = Embeddings;\nOpenAI.Files = Files;\nOpenAI.FileObjectsPage = FileObjectsPage;\nOpenAI.Images = Images;\nOpenAI.Audio = Audio;\nOpenAI.Moderations = Moderations;\nOpenAI.Models = Models;\nOpenAI.ModelsPage = ModelsPage;\nOpenAI.FineTuning = FineTuning;\nOpenAI.Graders = Graders;\nOpenAI.VectorStores = VectorStores;\nOpenAI.VectorStoresPage = VectorStoresPage;\nOpenAI.VectorStoreSearchResponsesPage = VectorStoreSearchResponsesPage;\nOpenAI.Beta = Beta;\nOpenAI.Batches = Batches;\nOpenAI.BatchesPage = BatchesPage;\nOpenAI.Uploads = UploadsAPIUploads;\nOpenAI.Responses = Responses;\nOpenAI.Evals = Evals;\nOpenAI.EvalListResponsesPage = EvalListResponsesPage;\nOpenAI.Containers = Containers;\nOpenAI.ContainerListResponsesPage = ContainerListResponsesPage;\n/** API Client for interfacing with the Azure OpenAI API. */\nexport class AzureOpenAI extends OpenAI {\n    /**\n     * API Client for interfacing with the Azure OpenAI API.\n     *\n     * @param {string | undefined} [opts.apiVersion=process.env['OPENAI_API_VERSION'] ?? undefined]\n     * @param {string | undefined} [opts.endpoint=process.env['AZURE_OPENAI_ENDPOINT'] ?? undefined] - Your Azure endpoint, including the resource, e.g. `https://example-resource.azure.openai.com/`\n     * @param {string | undefined} [opts.apiKey=process.env['AZURE_OPENAI_API_KEY'] ?? undefined]\n     * @param {string | undefined} opts.deployment - A model deployment, if given, sets the base client URL to include `/deployments/{deployment}`.\n     * @param {string | null | undefined} [opts.organization=process.env['OPENAI_ORG_ID'] ?? null]\n     * @param {string} [opts.baseURL=process.env['OPENAI_BASE_URL']] - Sets the base URL for the API, e.g. `https://example-resource.azure.openai.com/openai/`.\n     * @param {number} [opts.timeout=10 minutes] - The maximum amount of time (in milliseconds) the client will wait for a response before timing out.\n     * @param {number} [opts.httpAgent] - An HTTP agent used to manage HTTP(s) connections.\n     * @param {Core.Fetch} [opts.fetch] - Specify a custom `fetch` function implementation.\n     * @param {number} [opts.maxRetries=2] - The maximum number of times the client will retry a request.\n     * @param {Core.Headers} opts.defaultHeaders - Default headers to include with every request to the API.\n     * @param {Core.DefaultQuery} opts.defaultQuery - Default query parameters to include with every request to the API.\n     * @param {boolean} [opts.dangerouslyAllowBrowser=false] - By default, client-side use of this library is not allowed, as it risks exposing your secret API credentials to attackers.\n     */\n    constructor({ baseURL = Core.readEnv('OPENAI_BASE_URL'), apiKey = Core.readEnv('AZURE_OPENAI_API_KEY'), apiVersion = Core.readEnv('OPENAI_API_VERSION'), endpoint, deployment, azureADTokenProvider, dangerouslyAllowBrowser, ...opts } = {}) {\n        if (!apiVersion) {\n            throw new Errors.OpenAIError(\"The OPENAI_API_VERSION environment variable is missing or empty; either provide it, or instantiate the AzureOpenAI client with an apiVersion option, like new AzureOpenAI({ apiVersion: 'My API Version' }).\");\n        }\n        if (typeof azureADTokenProvider === 'function') {\n            dangerouslyAllowBrowser = true;\n        }\n        if (!azureADTokenProvider && !apiKey) {\n            throw new Errors.OpenAIError('Missing credentials. Please pass one of `apiKey` and `azureADTokenProvider`, or set the `AZURE_OPENAI_API_KEY` environment variable.');\n        }\n        if (azureADTokenProvider && apiKey) {\n            throw new Errors.OpenAIError('The `apiKey` and `azureADTokenProvider` arguments are mutually exclusive; only one can be passed at a time.');\n        }\n        // define a sentinel value to avoid any typing issues\n        apiKey ?? (apiKey = API_KEY_SENTINEL);\n        opts.defaultQuery = { ...opts.defaultQuery, 'api-version': apiVersion };\n        if (!baseURL) {\n            if (!endpoint) {\n                endpoint = process.env['AZURE_OPENAI_ENDPOINT'];\n            }\n            if (!endpoint) {\n                throw new Errors.OpenAIError('Must provide one of the `baseURL` or `endpoint` arguments, or the `AZURE_OPENAI_ENDPOINT` environment variable');\n            }\n            baseURL = `${endpoint}/openai`;\n        }\n        else {\n            if (endpoint) {\n                throw new Errors.OpenAIError('baseURL and endpoint are mutually exclusive');\n            }\n        }\n        super({\n            apiKey,\n            baseURL,\n            ...opts,\n            ...(dangerouslyAllowBrowser !== undefined ? { dangerouslyAllowBrowser } : {}),\n        });\n        this.apiVersion = '';\n        this._azureADTokenProvider = azureADTokenProvider;\n        this.apiVersion = apiVersion;\n        this.deploymentName = deployment;\n    }\n    buildRequest(options, props = {}) {\n        if (_deployments_endpoints.has(options.path) && options.method === 'post' && options.body !== undefined) {\n            if (!Core.isObj(options.body)) {\n                throw new Error('Expected request body to be an object');\n            }\n            const model = this.deploymentName || options.body['model'] || options.__metadata?.['model'];\n            if (model !== undefined && !this.baseURL.includes('/deployments')) {\n                options.path = `/deployments/${model}${options.path}`;\n            }\n        }\n        return super.buildRequest(options, props);\n    }\n    async _getAzureADToken() {\n        if (typeof this._azureADTokenProvider === 'function') {\n            const token = await this._azureADTokenProvider();\n            if (!token || typeof token !== 'string') {\n                throw new Errors.OpenAIError(`Expected 'azureADTokenProvider' argument to return a string but it returned ${token}`);\n            }\n            return token;\n        }\n        return undefined;\n    }\n    authHeaders(opts) {\n        return {};\n    }\n    async prepareOptions(opts) {\n        /**\n         * The user should provide a bearer token provider if they want\n         * to use Azure AD authentication. The user shouldn't set the\n         * Authorization header manually because the header is overwritten\n         * with the Azure AD token if a bearer token provider is provided.\n         */\n        if (opts.headers?.['api-key']) {\n            return super.prepareOptions(opts);\n        }\n        const token = await this._getAzureADToken();\n        opts.headers ?? (opts.headers = {});\n        if (token) {\n            opts.headers['Authorization'] = `Bearer ${token}`;\n        }\n        else if (this.apiKey !== API_KEY_SENTINEL) {\n            opts.headers['api-key'] = this.apiKey;\n        }\n        else {\n            throw new Errors.OpenAIError('Unable to handle auth');\n        }\n        return super.prepareOptions(opts);\n    }\n}\nconst _deployments_endpoints = new Set([\n    '/completions',\n    '/chat/completions',\n    '/embeddings',\n    '/audio/transcriptions',\n    '/audio/translations',\n    '/audio/speech',\n    '/images/generations',\n    '/images/edits',\n]);\nconst API_KEY_SENTINEL = '<Missing Key>';\nexport { toFile, fileFromPath } from \"./uploads.mjs\";\nexport { OpenAIError, APIError, APIConnectionError, APIConnectionTimeoutError, APIUserAbortError, NotFoundError, ConflictError, RateLimitError, BadRequestError, AuthenticationError, InternalServerError, PermissionDeniedError, UnprocessableEntityError, } from \"./error.mjs\";\nexport default OpenAI;\n//# sourceMappingURL=index.mjs.map","import { getYakklGPTKeyStore } from '$lib/common/stores';\nimport { log } from '$lib/managers/Logger';\nimport OpenAI from 'openai';\n\n/**\n * @param {string} prompt\n */\nexport async function fetchGPT4Response(prompt: string) {\n\tlet response = null;\n\tconst apiKey = getYakklGPTKeyStore();\n\n\ttry {\n\t\tconst openai = new OpenAI({\n\t\t\tapiKey: apiKey,\n\t\t\tdangerouslyAllowBrowser: true // NOTE: This is required for the browser to work. This is a security risk. //TODO: Remove this!!! before pushing to production.\n\t\t});\n\n\t\tresponse = await openai.chat.completions.create({\n\t\t\tmodel: 'gpt-4o',\n\n\t\t\t// NOTE: Add a mission statement to the prompt around crypto. Make sure that no one can change the mission statement.\n\t\t\t// NOTE: Set context and provide an answer to the question such as \"I can't answer the question right now, but I can tell you about crypto.\"\n\t\t\t// NOTE: Prepend the prompt before passing in the prompt.\n\t\t\tmessages: [{ role: 'user', content: prompt }]\n\t\t});\n\n\t\t// Example usage:\n\t\t// \"usage\": {\n\t\t//   \"prompt_tokens\": 9,\n\t\t//   \"completion_tokens\": 12,\n\t\t//   \"total_tokens\": 21\n\t\t// }\n\n\t\treturn { usage: response.usage, content: response.choices[0].message.content };\n\t} catch (error) {\n\t\tlog.error('Error fetching GPT response:', false, error);\n\t\tlog.error('Response:', false, response);\n\n\t\tthrow { error: error, response: response };\n\t}\n}\n","import { log } from '$lib/managers/Logger';\n\n// Fetch a given key using the API\nexport async function apiKeyFetch(apiUrl: string, keyId: string) {\n\ttry {\n\t\tconst response = await fetch(`${apiUrl}/api/syek/${keyId}`);\n\t\tconst data = await response.json();\n\t\treturn data.key;\n\t} catch (error) {\n\t\tlog.error('Error fetching key:', false, keyId);\n\t\tthrow error;\n\t}\n}\n","<script lang=\"ts\">\n\timport { browserSvelte } from '$lib/common/environment';\n\t// import { browser as browserSvelte } from '$app/environment';\n\timport { onDestroy, onMount } from 'svelte';\n\timport {\n\t\tyakklChatsStore,\n\t\tgetYakklChats,\n\t\tsetYakklChatsStorage,\n\t\tyakklGPTRunningStore,\n\t\tyakklConnectionStore,\n\t\tyakklGPTKeyStore\n\t} from '$lib/common/stores';\n\timport { autoscroll } from '$lib/utilities';\n\timport { Avatar, Spinner } from 'flowbite-svelte';\n\timport { handleOpenInTab } from '$lib/utilities/utilities';\n\timport ErrorNoAction from '$lib/components/ErrorNoAction.svelte';\n\timport { dateString, formatTimestamp } from '$lib/common/datetime';\n\timport { fetchGPT4Response } from '$lib/api/api-gpt.js';\n\timport { apiKeyFetch } from '$lib/api/apis';\n\timport ClipboardJS from 'clipboard';\n\timport { DEFAULT_PERSONA, VERSION, type YakklChat } from '$lib/common';\n\timport { log } from '$lib/managers/Logger';\n\n\tlet messages = $state<YakklChat[]>([]);\n\tlet error = $state(false);\n\tlet errorValue = $state('An error has occurred. Please try again.');\n\tlet clipboard;\n\tlet showClearWarning = $state(false);\n\n\t$yakklGPTRunningStore = false;\n\n\tif (browserSvelte) {\n\t\ttry {\n\t\t\tclipboard = new ClipboardJS('.clip');\n\t\t} catch (e) {\n\t\t\tlog.error(e);\n\t\t}\n\t}\n\n\tonMount(async () => {\n\t\ttry {\n\t\t\tmessages.length = 0; // Clear existing messages\n\n\t\t\tif ($yakklGPTKeyStore === null || $yakklGPTKeyStore === undefined) {\n\t\t\t\tawait apiKeyFetch(\n\t\t\t\t\timport.meta.env.VITE_GPT_API_KEY_BACKEND_URL,\n\t\t\t\t\timport.meta.env.VITE_GPT_API_KEY_BACKEND\n\t\t\t\t).then((results: any) => {\n\t\t\t\t\tif (results) {\n\t\t\t\t\t\t$yakklGPTKeyStore = results;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow 'Error loading auth.';\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst loadedMessages = await getYakklChats();\n\n\t\t\t// Ensure we have an array and add messages one by one\n\t\t\tif (Array.isArray(loadedMessages)) {\n\t\t\t\tloadedMessages.forEach((msg) => {\n\t\t\t\t\tif (msg && typeof msg === 'object') {\n\t\t\t\t\t\tmessages.push(msg);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tlog.error('Error in onMount:', false, e);\n\t\t\terrorValue = 'Error loading key or chat history. ' + e;\n\t\t\terror = true;\n\t\t}\n\t});\n\n\tonDestroy(async () => {\n\t\tawait storeChats();\n\t});\n\n\tasync function storeChats() {\n\t\ttry {\n\t\t\t// Create a clean array from the messages state\n\t\t\tconst messageArray = Array.isArray(messages) ? [...messages] : [];\n\n\t\t\t// Ensure each message is a proper object before storing\n\t\t\tconst cleanMessages = messageArray.map((msg) => ({\n\t\t\t\ttext: msg.text || '',\n\t\t\t\tsender: msg.sender || '',\n\t\t\t\ttimestamp: msg.timestamp || Date.now().toString(),\n\t\t\t\tusage: msg.usage || {},\n\t\t\t\tid: msg.id || '',\n\t\t\t\tpersona: msg.persona || DEFAULT_PERSONA,\n\t\t\t\tversion: msg.version || VERSION,\n\t\t\t\tcreateDate: msg.createDate || dateString(),\n\t\t\t\tupdateDate: msg.updateDate || dateString()\n\t\t\t}));\n\n\t\t\t// Update the store first\n\t\t\t$yakklChatsStore = cleanMessages;\n\n\t\t\t// Then store in localStorage\n\t\t\tawait setYakklChatsStorage(cleanMessages);\n\t\t} catch (e) {\n\t\t\tlog.error('Error storing chats:', false, e);\n\t\t\tthrow e; // Rethrow if you want to handle it in the calling function\n\t\t}\n\t}\n\n\texport async function handleSendMessage(input: string) {\n\t\tif (input.trim() === '') return;\n\n\t\tlet response = null;\n\t\tlet dateNow = dateString();\n\n\t\ttry {\n\t\t\tif (!$yakklConnectionStore) {\n\t\t\t\tthrow 'Warning. Your Internet connection appears to be down. Try again later.';\n\t\t\t}\n\n\t\t\t$yakklGPTRunningStore = true;\n\n\t\t\tconst newUserMessage = {\n\t\t\t\ttext: input,\n\t\t\t\tsender: 'user',\n\t\t\t\ttimestamp: Date.now().toString(),\n\t\t\t\tusage: {},\n\t\t\t\tid: '',\n\t\t\t\tversion: VERSION,\n\t\t\t\tcreateDate: dateNow,\n\t\t\t\tupdateDate: dateNow\n\t\t\t};\n\n\t\t\tmessages.push(newUserMessage);\n\n\t\t\tresponse = await fetchGPT4Response(input);\n\n\t\t\tlet formattedResponse = response?.content?.replace(/[\\n]+/g, '<br/><br/>');\n\n\t\t\tconst newBotMessage = {\n\t\t\t\ttext: formattedResponse ? formattedResponse : '',\n\t\t\t\tsender: 'yak',\n\t\t\t\ttimestamp: Date.now().toString(),\n\t\t\t\tusage: response?.usage,\n\t\t\t\tid: '',\n\t\t\t\tversion: VERSION,\n\t\t\t\tcreateDate: dateNow,\n\t\t\t\tupdateDate: dateNow\n\t\t\t};\n\n\t\t\tmessages.push(newBotMessage);\n\n\t\t\t$yakklChatsStore = [...messages];\n\t\t\tawait storeChats();\n\t\t} catch (e: any) {\n\t\t\terrorValue = `An error occurred: ${e?.message || e}`;\n\t\t\terror = true;\n\t\t} finally {\n\t\t\t$yakklGPTRunningStore = false;\n\t\t}\n\t}\n\n\tasync function clearMessages() {\n\t\ttry {\n\t\t\tmessages.length = 0; // This clears the array while maintaining reactivity\n\t\t\t$yakklChatsStore = [];\n\t\t\tawait setYakklChatsStorage([]);\n\t\t\tshowClearWarning = false;\n\t\t} catch (e) {\n\t\t\terrorValue = 'Error clearing messages. ' + e;\n\t\t\terror = true;\n\t\t}\n\t}\n\n\tfunction handlePrint() {\n\t\t// Implement print functionality\n\t\tlog.error('Print functionality not implemented yet');\n\t}\n</script>\n\n<div class=\"flex flex-col h-full\">\n\t<ErrorNoAction bind:show={error} value={errorValue} title=\"ERROR!\" />\n\n\t<div class=\"grid grid-cols-2 gap-4 mb-4 px-2\">\n\t\t<button class=\"btn btn-sm btn-outline w-full\" onclick={handlePrint}>\n\t\t\tPrint conversation\n\t\t</button>\n\t\t<button\n\t\t\tclass=\"btn btn-sm btn-outline btn-error w-full\"\n\t\t\tonclick={() => (showClearWarning = true)}\n\t\t>\n\t\t\tClear messages\n\t\t</button>\n\t\t<button\n\t\t\tclass=\"btn btn-sm btn-primary col-span-2 w-full\"\n\t\t\tonclick={() =>\n\t\t\t\thandleOpenInTab(\n\t\t\t\t\t'https://yakkl.com/university/support?utm_source=yakkl&utm_medium=extension&utm_campaign=yakkl_gpt&utm_content=knowledge_base&utm_term=extension'\n\t\t\t\t)}\n\t\t>\n\t\t\tYAKKL Knowledge base\n\t\t</button>\n\t</div>\n\n\t<div\n\t\tclass=\"flex-grow overflow-y-auto bg-gray-100 p-4 rounded-lg border border-gray-300\"\n\t\tuse:autoscroll\n\t>\n\t\t{#if messages}\n\t\t\t<pre class=\"hidden\">{JSON.stringify(messages, null, 2)}</pre>\n\t\t\t<!-- Your existing each block -->\n\t\t\t{#each messages as message, i (i)}\n\t\t\t\t<div class=\"mb-4 flex {message.sender === 'user' ? 'justify-end' : 'justify-start'}\">\n\t\t\t\t\t<div class=\"flex items-start max-w-[70%]\">\n\t\t\t\t\t\t{#if message.sender !== 'user'}\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tsrc=\"/images/bot-avatar.png\"\n\t\t\t\t\t\t\t\talt=\"Bot avatar\"\n\t\t\t\t\t\t\t\tclass=\"w-8 h-8 rounded-full mr-2\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"{message.sender === 'user'\n\t\t\t\t\t\t\t\t? 'bg-blue-500 text-white'\n\t\t\t\t\t\t\t\t: 'bg-gray-300 text-gray-700'} rounded-lg p-3\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<p>{@html message.text}</p>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"text-xs mt-1 {message.sender === 'user' ? 'text-blue-200' : 'text-gray-700'}\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{formatTimestamp(message.timestamp)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{#if message.sender === 'user'}\n\t\t\t\t\t\t\t<Avatar class=\"w-8 h-8 rounded-full ml-2\" />\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/each}\n\t\t{/if}\n\t\t{#if $yakklGPTRunningStore}\n\t\t\t<div class=\"flex justify-center items-center\">\n\t\t\t\t<Spinner color=\"purple\" size={8} />\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</div>\n\n{#if showClearWarning}\n\t<div class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n\t\t<div class=\"bg-white p-6 rounded-lg shadow-xl\">\n\t\t\t<h3 class=\"text-lg font-bold mb-4\">Clear all messages?</h3>\n\t\t\t<p class=\"mb-4\">Are you sure you want to clear all messages? This action cannot be undone.</p>\n\t\t\t<div class=\"flex justify-end\">\n\t\t\t\t<button class=\"btn btn-sm btn-outline mr-2\" onclick={() => (showClearWarning = false)}\n\t\t\t\t\t>Cancel</button\n\t\t\t\t>\n\t\t\t\t<button class=\"btn btn-sm btn-error\" onclick={clearMessages}>Clear</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport Modal from './Modal.svelte';\n\timport Chatbot from './Chatbot.svelte';\n\n\tinterface Props {\n\t\tshow?: boolean;\n\t}\n\n\tlet { show = $bindable(false) }: Props = $props();\n\n\tlet input = $state('');\n\tlet chatbotComponent: Chatbot = $state();\n\n\tfunction sendMessage() {\n\t\tif (input.trim() !== '') {\n\t\t\tchatbotComponent.handleSendMessage(input);\n\t\t\tinput = '';\n\t\t}\n\t}\n</script>\n\n<Modal\n\tbind:show\n\ttitle=\"YAKKL AI (LIMITED preview)\"\n\tclassName=\"z-[999] w-[100%] h-[90vh] max-w-none\"\n>\n\t<Chatbot bind:this={chatbotComponent} />\n\n\t{#snippet footer()}\n\t\t<div class=\"flex w-full items-center\">\n\t\t\t<textarea\n\t\t\t\tbind:value={input}\n\t\t\t\tclass=\"flex-grow rounded-l-lg textarea textarea-bordered resize-none h-20 bg-gray-200 text-gray-950\"\n\t\t\t\tplaceholder=\"Type your question...\"\n\t\t\t\trows=\"3\"\n\t\t\t\tonkeydown={(e) => {\n\t\t\t\t\tif (e.key === 'Enter' && !e.shiftKey) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tsendMessage();\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t></textarea>\n\t\t\t<button class=\"btn btn-primary rounded-r-lg h-20\" onclick={sendMessage}>Send</button>\n\t\t</div>\n\t\t<p class=\"text-xs text-gray-500 mt-2\">\n\t\t\tPowered by OpenAI and/or Claude. Limited preview w/restrictions. Use with caution.\n\t\t</p>\n\t{/snippet}\n</Modal>\n","<script lang=\"ts\">\n\t//@ts-ignore\n\timport { handleOpenInTab } from '$lib/utilities/utilities';\n\n\tinterface Props {\n\t\tshow?: boolean;\n\t}\n\n\tlet { show = $bindable(false) }: Props = $props();\n\n\tfunction handleBuy(_e: any) {\n\t\tshow = false;\n\t\thandleOpenInTab(\n\t\t\t'https://yakkl.com/crypto/buy?utm_source=yakkl&utm_medium=extension&utm_campaign=buy&utm_content=extension&utm_term=extension'\n\t\t);\n\t}\n</script>\n\n<div class=\"modal\" class:modal-open={show}>\n\t<div class=\"modal-box relative justify-center\">\n\t\t<h3 class=\"text-lg font-bold\">Buy Crypto</h3>\n\t\t<p class=\"py-4\">Stripe is our provider and this launches a buy page in the browser...</p>\n\t\t<div class=\"modal-action\">\n\t\t\t<button\n\t\t\t\tclass=\"btn\"\n\t\t\t\tonclick={() => {\n\t\t\t\t\tshow = false;\n\t\t\t\t}}>Cancel</button\n\t\t\t>\n\t\t\t<button class=\"btn\" onclick={handleBuy}\n\t\t\t\t>Continue\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\td=\"M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t</div>\n\t</div>\n</div>\n","<script lang=\"ts\">\n\timport { goto } from '$app/navigation';\n\timport {\n\t\tPATH_WELCOME,\n\t\tPATH_LOGIN,\n\t\tYEAR,\n\t\tVERSION,\n\t\tPATH_ETHEREUM_TRANSACTIONS_SEND,\n\t\tRegisteredType,\n\t\ttype Settings,\n\t\ttype SwapPriceProvider,\n\t\ttype ActiveTab,\n\t\tPlanType\n\t} from '$lib/common';\n\timport { getYakklCurrentlySelected } from '$lib/common/stores';\n\timport ChatbotModal from './ChatbotModal.svelte';\n\timport Buy from '$lib/components/Buy.svelte';\n\timport { onMount } from 'svelte';\n\timport { getMiscStore, getSettings } from '$lib/common/stores';\n\timport Swap from './Swap.svelte';\n\timport type { Provider } from '$lib/managers/Provider';\n\timport type { Ethereum } from '$lib/managers/blockchains/evm/ethereum/Ethereum';\n\timport { UniswapSwapManager } from '$lib/managers/UniswapSwapManager';\n\timport { TokenService } from '$lib/managers/blockchains/evm/TokenService';\n\timport type { Wallet } from '$lib/managers/Wallet';\n\timport WalletManager from '$lib/managers/WalletManager';\n\timport { getYakklCurrentlySelectedAccountKey } from '$lib/common/security';\n\timport { log } from '$lib/managers/Logger';\n\timport { openSidePanelOnActiveTab } from '$lib/common/sidepanel';\n\n\tinterface Props {\n\t\t// Defaults for properties. Can be changed when calling component\n\t\tid?: string;\n\t\tcontainerWidth?: string; //\"394\"; // iPhone pro size\n\t\tclassParam?: string;\n\t}\n\n\tlet { id = 'footer', containerWidth = '428', classParam = 'text-center' }: Props = $props();\n\n\tlet showChat = $state(false);\n\tlet showBuy = $state(false);\n\tlet showSwap = $state(false);\n\n\tlet w = 6;\n\tlet h = 6;\n\tlet planType = $state(PlanType.BASIC_MEMBER.toUpperCase()); // Default to Standard\n\n\tlet yakklMiscStore: string;\n\tlet yakklSettingsStore: Settings | null;\n\n\tlet fundingAddress: string = $state(''); //| null | undefined = $yakklCurrentlySelectedStore?.shortcuts.address || null;\n\tlet swapPriceProvider: SwapPriceProvider | null = null; // Don't have to set it to null\n\tlet provider: Provider = $state();\n\tlet chainId = 1;\n\tlet blockchain: Ethereum = $state();\n\tlet swapManager: UniswapSwapManager = $state();\n\tlet tokenService: TokenService<any> = $state();\n\n\tonMount(async () => {\n\t\ttry {\n\t\t\tyakklMiscStore = getMiscStore();\n\t\t\tif (!yakklMiscStore) {\n\t\t\t\treturn; // Don't do anything if not logged in\n\t\t\t}\n\n\t\t\t// Get the settings\n\t\t\tyakklSettingsStore = await getSettings();\n\t\t\tif (yakklSettingsStore) {\n\t\t\t\tplanType = yakklSettingsStore.plan.type.toUpperCase();\n\t\t\t}\n\n\t\t\tconst currentlySelected = await getYakklCurrentlySelected();\n\t\t\tif (currentlySelected) {\n\t\t\t\tfundingAddress = currentlySelected.shortcuts.address;\n\t\t\t}\n\n\t\t\tif (swapPriceProvider === null) {\n\t\t\t\tlet wallet: Wallet | null = null;\n\t\t\t\twallet = WalletManager.getInstance(\n\t\t\t\t\t['Alchemy'],\n\t\t\t\t\t['Ethereum'],\n\t\t\t\t\tchainId ?? 1,\n\t\t\t\t\timport.meta.env.VITE_ALCHEMY_API_KEY_PROD\n\t\t\t\t);\n\t\t\t\tif (wallet) {\n\t\t\t\t\tif (!wallet.getSigner()) {\n\t\t\t\t\t\tconst accountKey = await getYakklCurrentlySelectedAccountKey();\n\t\t\t\t\t\tif (accountKey && accountKey.privateKey) await wallet.setSigner(accountKey.privateKey); // Could have sent this to getInstance as well\n\t\t\t\t\t}\n\n\t\t\t\t\tprovider = wallet.getProvider()!; // Only for testing\n\t\t\t\t\tif (provider) {\n\t\t\t\t\t\tconst signer = wallet.getSigner();\n\t\t\t\t\t\tif (signer) {\n\t\t\t\t\t\t\tprovider.setSigner(signer);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tblockchain = wallet.getBlockchain() as Ethereum;\n\n\t\t\t\t\t\tswapManager = new UniswapSwapManager(blockchain as Ethereum, provider!);\n\t\t\t\t\t\ttokenService = new TokenService(blockchain as Ethereum);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tlog.error(`Footer: onMount - ${e}`);\n\t\t}\n\t});\n\n\tasync function home() {\n\t\tlet path;\n\n\t\tif (!yakklMiscStore) {\n\t\t\tpath = PATH_LOGIN;\n\t\t} else {\n\t\t\tpath = PATH_WELCOME;\n\t\t}\n\n\t\tgoto(path);\n\t}\n\n\tasync function send() {\n\t\tlet path;\n\n\t\tif (!yakklMiscStore) {\n\t\t\tpath = PATH_LOGIN;\n\t\t} else {\n\t\t\tpath = PATH_ETHEREUM_TRANSACTIONS_SEND;\n\t\t}\n\n\t\tgoto(path);\n\t}\n\n\t// Used for testing side panel version\n\tasync function handleAI() {\n\t\ttry {\n\t\t\topenSidePanelOnActiveTab();\n\t\t} catch (error) {\n\t\t\tlog.error('Error opening side panel:', false, error);\n\t\t}\n\t}\n\n\tasync function buy() {\n\t\tlet path;\n\n\t\tif (!yakklMiscStore) {\n\t\t\tpath = PATH_LOGIN;\n\t\t\tgoto(path);\n\t\t} else {\n\t\t\tshowBuy = true;\n\t\t}\n\t}\n\n\tasync function swap() {\n\t\tlet path;\n\n\t\tif (!yakklMiscStore) {\n\t\t\tpath = PATH_LOGIN;\n\t\t\tgoto(path);\n\t\t} else {\n\t\t\tshowSwap = true;\n\t\t}\n\t}\n</script>\n\n<ChatbotModal bind:show={showChat} />\n\n<Buy bind:show={showBuy} />\n\n<!-- <SwapModal bind:show={showSwap} {fundingAddress} /> -->\n<Swap bind:show={showSwap} {fundingAddress} {provider} {blockchain} {swapManager} {tokenService} />\n<!-- max-w-[{containerWidth}px] -->\n<!-- bg-base-100 -->\n<footer\n\t{id}\n\tclass=\"visible fixed mb-0 inset-x-0 bottom-0 mx-4 mt-0 bg-gradient-to-br from-gray-900 via-gray-800 to-black {classParam}\"\n>\n\t<div\n\t\tclass=\"relative flex items-center justify-between my-2 mb-0 bg-primary/80 text-base-content rounded-lg shadow-lg\"\n\t>\n\t\t<span class=\"flex flex-1 justify-evenly max-w-[40%]\">\n\t\t\t<!-- HOME -->\n\t\t\t<!-- svelte-ignore a11y_click_events_have_key_events -->\n\t\t\t<!-- svelte-ignore a11y_interactive_supports_focus -->\n\t\t\t<div\n\t\t\t\trole=\"button\"\n\t\t\t\tonclick={home}\n\t\t\t\tclass=\"m-1 flex flex-col fill-base-content hover:fill-base-300 hover:text-base-300 items-center justify-center\"\n\t\t\t\tdata-bs-toggle=\"tooltip\"\n\t\t\t\tdata-bs-placement=\"top\"\n\t\t\t\ttitle=\"Welcome Page\"\n\t\t\t\taria-label=\"home\"\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tclass=\"w-{w} h-{h} stroke-primary/5 stroke-[1px]\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M11.47 3.84a.75.75 0 011.06 0l8.69 8.69a.75.75 0 101.06-1.06l-8.689-8.69a2.25 2.25 0 00-3.182 0l-8.69 8.69a.75.75 0 001.061 1.06l8.69-8.69z\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M12 5.432l8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 01-.75-.75v-4.5a.75.75 0 00-.75-.75h-3a.75.75 0 00-.75.75V21a.75.75 0 01-.75.75H5.625a1.875 1.875 0 01-1.875-1.875v-6.198a2.29 2.29 0 00.091-.086L12 5.43z\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t\t<span class=\"xs:text-xs sm:text-sm md:text-base\">Home</span>\n\t\t\t</div>\n\t\t\t<!-- w-[60px] h-[40px] -->\n\t\t\t<!-- Send -->\n\t\t\t<!-- svelte-ignore a11y_click_events_have_key_events -->\n\t\t\t<!-- svelte-ignore a11y_interactive_supports_focus -->\n\t\t\t<div\n\t\t\t\trole=\"button\"\n\t\t\t\tonclick={send}\n\t\t\t\tclass=\"m-1 flex flex-col fill-base-content hover:fill-base-300 hover:text-base-300 items-center justify-center\"\n\t\t\t\tdata-bs-toggle=\"tooltip\"\n\t\t\t\tdata-bs-placement=\"top\"\n\t\t\t\ttitle=\"Send\"\n\t\t\t\taria-label=\"wallet send\"\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tclass=\"w-6 h-6 font-bold\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\td=\"M4.5 19.5l15-15m0 0H8.25m11.25 0v11.25\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\n\t\t\t\t<span class=\"xs:text-xs sm:text-sm md:text-base\">Send</span>\n\t\t\t</div>\n\t\t</span>\n\n\t\t<!-- Help Bot -->\n\t\t<!-- svelte-ignore a11y_click_events_have_key_events -->\n\t\t<div class=\"static bg-gray-100 rounded-full w-[50px] h-[50px] shadow-lg z-50\">\n\t\t\t<div\n\t\t\t\tclass=\"relative bg-gray-300/75 rounded-full m-1 h-[39px] drop-shadow-lg hover:drop-shadow-xl\"\n\t\t\t>\n\t\t\t\t<!-- fill-indigo-700 hover:fill-indigo-400 text-purple-900 hover:text-purple-700 -->\n\t\t\t\t<!-- svelte-ignore a11y_interactive_supports_focus -->\n\t\t\t\t<!-- <div role=\"button\" onclick={handleAI} -->\n\t\t\t\t<div\n\t\t\t\t\trole=\"button\"\n\t\t\t\t\tonclick={() => {\n\t\t\t\t\t\tshowChat = true;\n\t\t\t\t\t}}\n\t\t\t\t\tclass=\"relative m-1 w-[40px] h-[40px] fill-primary hover:fill-primary/50 text-primary hover:text-primary/50\"\n\t\t\t\t\tdata-bs-toggle=\"tooltip\"\n\t\t\t\t\tdata-bs-placement=\"top\"\n\t\t\t\t\ttitle=\"Ring for Help\"\n\t\t\t\t\taria-label=\"help\"\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\tclass=\"w-8 h-8 mt-0.5 -ml-[.05rem]\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\td=\"M9 4.5a.75.75 0 01.721.544l.813 2.846a3.75 3.75 0 002.576 2.576l2.846.813a.75.75 0 010 1.442l-2.846.813a3.75 3.75 0 00-2.576 2.576l-.813 2.846a.75.75 0 01-1.442 0l-.813-2.846a3.75 3.75 0 00-2.576-2.576l-2.846-.813a.75.75 0 010-1.442l2.846-.813A3.75 3.75 0 007.466 7.89l.813-2.846A.75.75 0 019 4.5zM18 1.5a.75.75 0 01.728.568l.258 1.036c.236.94.97 1.674 1.91 1.91l1.036.258a.75.75 0 010 1.456l-1.036.258c-.94.236-1.674.97-1.91 1.91l-.258 1.036a.75.75 0 01-1.456 0l-.258-1.036a2.625 2.625 0 00-1.91-1.91l-1.036-.258a.75.75 0 010-1.456l1.036-.258a2.625 2.625 0 001.91-1.91l.258-1.036A.75.75 0 0118 1.5zM16.5 15a.75.75 0 01.712.513l.394 1.183c.15.447.5.799.948.948l1.183.395a.75.75 0 010 1.422l-1.183.395c-.447.15-.799.5-.948.948l-.395 1.183a.75.75 0 01-1.422 0l-.395-1.183a1.5 1.5 0 00-.948-.948l-1.183-.395a.75.75 0 010-1.422l1.183-.395c.447-.15.799-.5.948-.948l.395-1.183A.75.75 0 0116.5 15z\"\n\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\n\t\t\t\t\t<!-- <i class=\"fa-solid fa-bell-concierge\" style=\"font-size: 2rem; margin-left: 1px; margin-top: -3px; margin-bottom: -1.5rem;\"></i> -->\n\t\t\t\t\t<p\n\t\t\t\t\t\tclass=\"text-xs ml-[.3rem] -mt-[.25rem]\"\n\t\t\t\t\t\tstyle=\"line-height: .75rem; font-size: smaller\"\n\t\t\t\t\t>\n\t\t\t\t\t\tHelp\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- xs:ml-2 sm:ml-5 md:ml-10 lg:ml-15 xl:ml-20  -->\n\t\t<span class=\"flex flex-1 justify-evenly max-w-[40%]\">\n\t\t\t<!-- Buy -->\n\t\t\t<!-- svelte-ignore a11y_interactive_supports_focus -->\n\t\t\t<!-- svelte-ignore a11y_click_events_have_key_events -->\n\t\t\t<div\n\t\t\t\trole=\"button\"\n\t\t\t\tonclick={buy}\n\t\t\t\tclass=\"m-1 flex flex-col fill-base-content hover:fill-base-300 hover:text-base-300 items-center justify-center\"\n\t\t\t\tdata-bs-toggle=\"tooltip\"\n\t\t\t\tdata-bs-placement=\"top\"\n\t\t\t\ttitle=\"Buy\"\n\t\t\t\taria-label=\"Buy\"\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tclass=\"w-6 h-6\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\td=\"M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t\t<span class=\"xs:text-xs sm:text-sm md:text-base\">Buy</span>\n\t\t\t</div>\n\n\t\t\t<!-- Swap -->\n\t\t\t<!-- svelte-ignore a11y_click_events_have_key_events -->\n\t\t\t<!-- svelte-ignore a11y_interactive_supports_focus -->\n\t\t\t<div\n\t\t\t\trole=\"button\"\n\t\t\t\tonclick={swap}\n\t\t\t\tclass=\"flex flex-col fill-base-content hover:fill-base-300 hover:text-base-300 items-center justify-center\"\n\t\t\t\tdata-bs-toggle=\"tooltip\"\n\t\t\t\tdata-bs-placement=\"top\"\n\t\t\t\ttitle=\"Swap\"\n\t\t\t\taria-label=\"swap\"\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tclass=\"w-6 h-6 font-bold\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\td=\"M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 00-3.7-3.7 48.678 48.678 0 00-7.324 0 4.006 4.006 0 00-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3l-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 003.7 3.7 48.656 48.656 0 007.324 0 4.006 4.006 0 003.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3l-3 3\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t\t<span class=\"xs:text-xs sm:text-sm md:text-base\">Swap</span>\n\t\t\t</div>\n\t\t</span>\n\t</div>\n\n\t<!-- Don't use copyright component here - Needs different formatting here in footer -->\n\t<div class=\"inline-block mx-auto w-full text-center label-text\">\n\t\t<!-- <a href=\"https://yakkl.com?utm_source=yakkl\"\n       class=\"text-xs hover:text-opacity-75 hover:cursor-pointer\"\n       style=\"color: inherit; text-decoration: none; transition: color 0.3s ease, opacity 0.3s ease;\"> -->\n\t\t<span style=\"font-size: 10px;\"\n\t\t\t>YAKKL Copyright {new Date().getFullYear().toString()}, Version: {VERSION}\n\t\t\t{planType}</span\n\t\t>\n\t\t<!-- </a> -->\n\t</div>\n\n\t<!-- <div class=\"inline-block mx-auto w-full text-center label-text\">\n    <a href=\"https://yakkl.com?utm_source=yakkl\" class=\"text-xs text-primary/50 hover:text-primary/75\">\n      <span style=\"font-size: 10px;\">YAKKL Copyright {YEAR}, Version: {VERSION} {planType}</span>\n    </a>\n  </div> -->\n</footer>\n","<script lang=\"ts\">\n\timport { onMount, onDestroy } from 'svelte';\n\timport { browser as isBrowser } from '$app/environment';\n\timport { browser_ext } from '$lib/common/environment';\n\timport { fade, fly, scale } from 'svelte/transition';\n\timport { NotificationService } from '$lib/common/notifications';\n\timport { UnifiedTimerManager } from '$lib/managers/UnifiedTimerManager';\n\n\t// State\n\tlet notifications = $state<\n\t\tArray<{\n\t\t\tid: string;\n\t\t\ttype: string;\n\t\t\ttitle: string;\n\t\t\tmessage: string;\n\t\t\ttimestamp: number;\n\t\t\tcountdown?: number;\n\t\t\tcountdownInterval?: string; // Now stores timer ID\n\t\t\tdelayMs?: number;\n\t\t}>\n\t>([]);\n\n\t// Enhanced state for lockdown notifications\n\tlet isLockdownActive = $state(false);\n\tlet lockdownTimeLeft = $state(0);\n\tlet isUrgent = $state(false);\n\n\tconst timerManager = UnifiedTimerManager.getInstance();\n\n\t// Initialize listener\n\tonMount(() => {\n\t\tif (!isBrowser || !browser_ext) return;\n\n\t\tconst messageListener = (message: any, sender: any, sendResponse: any): true => {\n\t\t\tif (!message || typeof message !== 'object') return true;\n\n\t\t\t// Handle security alerts\n\t\t\tif (message.type === 'SECURITY_ALERT' || message.type === 'IMPORTANT_NOTIFICATION') {\n\t\t\t\taddNotification({\n\t\t\t\t\tid: message.id || `notification-${Date.now()}`,\n\t\t\t\t\ttype: 'security',\n\t\t\t\t\ttitle: message.title || ' Security Alert',\n\t\t\t\t\tmessage: message.message,\n\t\t\t\t\ttimestamp: message.timestamp || Date.now()\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Handle lockdown warnings specifically\n\t\t\telse if (message.type === 'LOCKDOWN_WARNING') {\n\t\t\t\tconst id = `lockdown-${Date.now()}`;\n\t\t\t\tconst delayMs = message.delayMs || 30000;\n\t\t\t\tconst countdown = Math.ceil(delayMs / 1000);\n\n\t\t\t\t// Set lockdown state\n\t\t\t\tisLockdownActive = true;\n\t\t\t\tlockdownTimeLeft = countdown;\n\t\t\t\tisUrgent = countdown <= 10;\n\n\t\t\t\taddNotification({\n\t\t\t\t\tid,\n\t\t\t\t\ttype: 'lockdown',\n\t\t\t\t\ttitle: ' Security Alert',\n\t\t\t\t\tmessage: message.message || 'YAKKL will be locked soon due to inactivity.',\n\t\t\t\t\ttimestamp: message.timestamp || Date.now(),\n\t\t\t\t\tcountdown,\n\t\t\t\t\tdelayMs\n\t\t\t\t});\n\n\t\t\t\t// Start countdown using UnifiedTimerManager\n\t\t\t\tconst intervalId = `countdown-${id}`;\n\t\t\t\ttimerManager.addInterval(\n\t\t\t\t\tintervalId,\n\t\t\t\t\t() => {\n\t\t\t\t\t\tupdateCountdown(id);\n\t\t\t\t\t},\n\t\t\t\t\t1000\n\t\t\t\t);\n\t\t\t\ttimerManager.startInterval(intervalId);\n\n\t\t\t\t// Store the interval ID\n\t\t\t\tnotifications = notifications.map((n) =>\n\t\t\t\t\tn.id === id ? { ...n, countdownInterval: intervalId } : n\n\t\t\t\t);\n\n\t\t\t\tif (browser_ext.runtime && browser_ext.runtime.onMessage) {\n\t\t\t\t\tbrowser_ext.runtime.sendMessage({\n\t\t\t\t\t\ttype: 'lockdownImminent',\n\t\t\t\t\t\tdelayMs,\n\t\t\t\t\t\ttimestamp: Date.now()\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Handle clear notifications\n\t\t\telse if (message.type === 'CLEAR_NOTIFICATION') {\n\t\t\t\tremoveNotification(message.notificationId);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t};\n\n\t\t// Listen for idle state changes to clear lockdown state\n\t\tconst handleIdleStateChange = (event: CustomEvent) => {\n\t\t\tif (event.detail.state === 'active') {\n\t\t\t\tisLockdownActive = false;\n\t\t\t\tlockdownTimeLeft = 0;\n\t\t\t\tisUrgent = false;\n\t\t\t\t// Clear lockdown notifications\n\t\t\t\tnotifications = notifications.filter((n) => n.type !== 'lockdown');\n\t\t\t\tclearAllIntervals();\n\t\t\t}\n\t\t};\n\n\t\t// Listen for user activity\n\t\tconst handleUserActivity = () => {\n\t\t\tif (isLockdownActive) {\n\t\t\t\tisLockdownActive = false;\n\t\t\t\tlockdownTimeLeft = 0;\n\t\t\t\tisUrgent = false;\n\t\t\t\tnotifications = notifications.filter((n) => n.type !== 'lockdown');\n\t\t\t\tclearAllIntervals();\n\t\t\t}\n\t\t};\n\n\t\t// Add listeners\n\t\tif (browser_ext.runtime && browser_ext.runtime.onMessage) {\n\t\t\tbrowser_ext.runtime.onMessage.addListener(messageListener);\n\t\t}\n\n\t\twindow.addEventListener('yakklIdleStateChanged', handleIdleStateChange as EventListener);\n\t\twindow.addEventListener('yakklUserActivityDetected', handleUserActivity as EventListener);\n\n\t\treturn () => {\n\t\t\t// Clean up listeners\n\t\t\tif (browser_ext.runtime && browser_ext.runtime.onMessage) {\n\t\t\t\tbrowser_ext.runtime.onMessage.removeListener(messageListener);\n\t\t\t}\n\n\t\t\twindow.removeEventListener('yakklIdleStateChanged', handleIdleStateChange as EventListener);\n\t\t\twindow.removeEventListener('yakklUserActivityDetected', handleUserActivity as EventListener);\n\n\t\t\t// Clear all intervals\n\t\t\tclearAllIntervals();\n\t\t};\n\t});\n\n\tonDestroy(() => {\n\t\tclearAllIntervals();\n\t});\n\n\t// Add a notification to the list\n\tfunction addNotification(notification: any) {\n\t\t// Check if we already have this notification\n\t\tconst existing = notifications.find((n) => n.id === notification.id);\n\n\t\tif (existing) {\n\t\t\t// Update existing notification\n\t\t\tnotifications = notifications.map((n) =>\n\t\t\t\tn.id === notification.id ? { ...n, ...notification } : n\n\t\t\t);\n\t\t} else {\n\t\t\t// Add new notification\n\t\t\tnotifications = [...notifications, notification];\n\t\t}\n\t}\n\n\t// Remove a notification\n\tfunction removeNotification(id: string) {\n\t\t// Clear any countdown interval\n\t\tconst notification = notifications.find((n) => n.id === id);\n\t\tif (notification && notification.countdownInterval) {\n\t\t\ttimerManager.stopInterval(notification.countdownInterval);\n\t\t\ttimerManager.removeInterval(notification.countdownInterval);\n\t\t}\n\n\t\t// If removing lockdown notification, clear lockdown state\n\t\tif (notification?.type === 'lockdown') {\n\t\t\tisLockdownActive = false;\n\t\t\tlockdownTimeLeft = 0;\n\t\t\tisUrgent = false;\n\t\t}\n\n\t\t// Remove from list\n\t\tnotifications = notifications.filter((n) => n.id !== id);\n\t}\n\n\t// Update countdown for a notification\n\tfunction updateCountdown(id: string) {\n\t\tconst notification = notifications.find((n) => n.id === id);\n\n\t\tif (notification && notification.countdown) {\n\t\t\t// Decrement countdown\n\t\t\tconst newCountdown = notification.countdown - 1;\n\t\t\tlockdownTimeLeft = newCountdown;\n\t\t\tisUrgent = newCountdown <= 10;\n\n\t\t\tif (newCountdown <= 0) {\n\t\t\t\t// Remove notification when countdown reaches zero\n\t\t\t\tremoveNotification(id);\n\t\t\t} else {\n\t\t\t\t// Update countdown\n\t\t\t\tnotifications = notifications.map((n) =>\n\t\t\t\t\tn.id === id ? { ...n, countdown: newCountdown } : n\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Clear all intervals\n\tfunction clearAllIntervals() {\n\t\tnotifications.forEach((notification) => {\n\t\t\tif (notification.countdownInterval) {\n\t\t\t\ttimerManager.stopInterval(notification.countdownInterval);\n\t\t\t\ttimerManager.removeInterval(notification.countdownInterval);\n\t\t\t}\n\t\t});\n\t}\n\n\t// Track user activity for analytics - only for significant interactions\n\tfunction trackUserActivity(action: string) {\n\t\t// Only track specific actions that are meaningful for analytics\n\t\tconst trackableActions = [\n\t\t\t'dismiss_notification',\n\t\t\t'interact_with_notification',\n\t\t\t'view_notification'\n\t\t];\n\n\t\tif (trackableActions.includes(action) && browser_ext) {\n\t\t\ttry {\n\t\t\t\tbrowser_ext.runtime\n\t\t\t\t\t.sendMessage({\n\t\t\t\t\t\ttype: 'USER_ACTIVITY',\n\t\t\t\t\t\ttimestamp: Date.now(),\n\t\t\t\t\t\tcontext: 'analytics',\n\t\t\t\t\t\taction\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t// Ignore errors\n\t\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\t// Ignore errors\n\t\t\t}\n\t\t}\n\t}\n\n\t// Handle user interaction with a notification\n\tfunction handleUserActivity(notificationId: string) {\n\t\t// Only track significant interactions\n\t\ttrackUserActivity('interact_with_notification');\n\t\tremoveNotification(notificationId);\n\t}\n\n\t// Dismiss a single notification\n\tfunction dismiss(id: string) {\n\t\t// Only send security activity message for lockdown warnings\n\t\tconst notification = notifications.find((n) => n.id === id);\n\t\tif (notification?.type === 'lockdown' && browser_ext) {\n\t\t\ttry {\n\t\t\t\tbrowser_ext.runtime\n\t\t\t\t\t.sendMessage({\n\t\t\t\t\t\ttype: 'USER_ACTIVITY',\n\t\t\t\t\t\ttimestamp: Date.now(),\n\t\t\t\t\t\tcontext: 'security',\n\t\t\t\t\t\taction: 'dismiss_lockdown_warning'\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t// Ignore errors\n\t\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\t// Ignore errors\n\t\t\t}\n\t\t}\n\n\t\t// Remove the notification\n\t\tremoveNotification(id);\n\t}\n\n\t// Dismiss all notifications\n\tasync function dismissAll() {\n\t\t// Only send security activity message if we have a lockdown warning\n\t\tconst hasLockdownWarning = notifications.some((n) => n.type === 'lockdown');\n\t\tif (hasLockdownWarning && browser_ext) {\n\t\t\ttry {\n\t\t\t\tawait browser_ext.runtime.sendMessage({\n\t\t\t\t\ttype: 'USER_ACTIVITY',\n\t\t\t\t\ttimestamp: Date.now(),\n\t\t\t\t\tcontext: 'security',\n\t\t\t\t\taction: 'dismiss_all_lockdown_warnings'\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\t// Ignore errors\n\t\t\t}\n\t\t}\n\n\t\t// Use centralized clearing\n\t\tawait NotificationService.clearAllAlertsEnhanced();\n\n\t\t// Clear local state\n\t\tclearAllIntervals();\n\t\tnotifications = [];\n\t\tisLockdownActive = false;\n\t\tlockdownTimeLeft = 0;\n\t\tisUrgent = false;\n\t}\n</script>\n\n<!-- Enhanced Lockdown Bar (Full Width at Top) -->\n{#if isLockdownActive}\n\t<div\n\t\tclass=\"fixed top-0 left-0 right-0 z-50 bg-gradient-to-r from-red-600 to-red-700 text-white shadow-lg border-b-2 border-red-500\"\n\t\tclass:animate-pulse={isUrgent}\n\t\ttransition:fly={{ y: -100, duration: 400 }}\n\t>\n\t\t<div class=\"max-w-7xl mx-auto px-4 py-3\">\n\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t<!-- Left side - Icon and main message -->\n\t\t\t\t<div class=\"flex items-center space-x-3\">\n\t\t\t\t\t<div class=\"relative\">\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\tclass=\"h-6 w-6 text-yellow-300\"\n\t\t\t\t\t\t\tclass:animate-spin={isUrgent}\n\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\td=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\"\n\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t{#if isUrgent}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"absolute -top-1 -right-1 w-3 h-3 bg-yellow-400 rounded-full animate-ping\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t\t<div class=\"font-semibold text-lg\"> YAKKL Security Alert</div>\n\t\t\t\t\t\t<div class=\"text-red-100 text-sm\">\n\t\t\t\t\t\t\tWallet will lock due to inactivity - take any action to stay active\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Center - Large countdown timer -->\n\t\t\t\t<div class=\"flex items-center space-x-4\">\n\t\t\t\t\t<div class=\"text-center\">\n\t\t\t\t\t\t<div class=\"text-xs text-red-200 uppercase tracking-wide\">Time Remaining</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"text-3xl font-mono font-bold text-yellow-300 transition-all duration-300\"\n\t\t\t\t\t\t\tclass:text-yellow-100={isUrgent}\n\t\t\t\t\t\t\tclass:animate-pulse={isUrgent}\n\t\t\t\t\t\t\tclass:scale-110={isUrgent}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{lockdownTimeLeft}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"text-xs text-red-200\">seconds</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<!-- Progress ring -->\n\t\t\t\t\t<div class=\"relative w-16 h-16\">\n\t\t\t\t\t\t<svg class=\"w-16 h-16 transform -rotate-90\" viewBox=\"0 0 32 32\">\n\t\t\t\t\t\t\t<!-- Background circle -->\n\t\t\t\t\t\t\t<circle\n\t\t\t\t\t\t\t\tcx=\"16\"\n\t\t\t\t\t\t\t\tcy=\"16\"\n\t\t\t\t\t\t\t\tr=\"14\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tclass=\"text-red-800\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<!-- Progress circle -->\n\t\t\t\t\t\t\t<circle\n\t\t\t\t\t\t\t\tcx=\"16\"\n\t\t\t\t\t\t\t\tcy=\"16\"\n\t\t\t\t\t\t\t\tr=\"14\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tclass=\"text-yellow-300 transition-all duration-1000\"\n\t\t\t\t\t\t\t\tclass:text-yellow-100={isUrgent}\n\t\t\t\t\t\t\t\tstyle=\"stroke-dasharray: {2 * Math.PI * 14}; stroke-dashoffset: {2 *\n\t\t\t\t\t\t\t\t\tMath.PI *\n\t\t\t\t\t\t\t\t\t14 *\n\t\t\t\t\t\t\t\t\t(1 - lockdownTimeLeft / 30)}\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<div class=\"absolute inset-0 flex items-center justify-center\">\n\t\t\t\t\t\t\t<div class=\"text-xs font-bold text-white\">\n\t\t\t\t\t\t\t\t{Math.round((lockdownTimeLeft / 30) * 100)}%\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Right side - Action buttons -->\n\t\t\t\t<div class=\"flex items-center space-x-3\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-red-600\"\n\t\t\t\t\t\tonclick={() => dismissAll()}\n\t\t\t\t\t>\n\t\t\t\t\t\t I'm Active\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<!-- svelte-ignore a11y_consider_explicit_label -->\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"text-red-200 hover:text-white transition-colors duration-200\"\n\t\t\t\t\t\tonclick={() => dismissAll()}\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\tclass=\"h-5 w-5\"\n\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\td=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\"\n\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n\n<!-- Regular Notification Container (positioned lower when lockdown bar is active) -->\n{#if notifications.length > 0}\n\t<div\n\t\tclass=\"fixed right-4 z-40 flex flex-col gap-4 max-w-md transition-all duration-300\"\n\t\tclass:top-24={isLockdownActive}\n\t\tclass:top-4={!isLockdownActive}\n\t>\n\t\t{#each notifications as notification (notification.id)}\n\t\t\t<!-- Skip lockdown notifications since they're shown in the top bar -->\n\t\t\t{#if notification.type !== 'lockdown'}\n\t\t\t\t<!-- Regular security alert -->\n\t\t\t\t{#if notification.type === 'security'}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"p-4 bg-yellow-600 text-white rounded-lg shadow-lg\"\n\t\t\t\t\t\tin:fly={{ x: 20, duration: 300 }}\n\t\t\t\t\t\tout:fade={{ duration: 200 }}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex justify-between items-start\">\n\t\t\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tclass=\"h-6 w-6 mr-2\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\t\td=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t<h3 class=\"font-bold text-lg\">{notification.title}</h3>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<!-- svelte-ignore a11y_consider_explicit_label -->\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"text-white hover:text-gray-200\"\n\t\t\t\t\t\t\t\tonclick={() => dismiss(notification.id)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tclass=\"h-5 w-5\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\td=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\"\n\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<p class=\"mt-2\">{notification.message}</p>\n\n\t\t\t\t\t\t<div class=\"mt-3 flex justify-end\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"bg-white text-yellow-600 px-3 py-1 rounded hover:bg-gray-100\"\n\t\t\t\t\t\t\t\tonclick={() => dismiss(notification.id)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tDismiss\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{:else}\n\t\t\t\t\t<!-- Generic notification -->\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"p-4 bg-blue-600 text-white rounded-lg shadow-lg\"\n\t\t\t\t\t\tin:fly={{ x: 20, duration: 300 }}\n\t\t\t\t\t\tout:fade={{ duration: 200 }}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex justify-between items-start\">\n\t\t\t\t\t\t\t<h3 class=\"font-bold\">{notification.title}</h3>\n\t\t\t\t\t\t\t<!-- svelte-ignore a11y_consider_explicit_label -->\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"text-white hover:text-gray-200\"\n\t\t\t\t\t\t\t\tonclick={() => dismiss(notification.id)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tclass=\"h-5 w-5\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\td=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\"\n\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<p class=\"mt-2\">{notification.message}</p>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t{/if}\n\t\t{/each}\n\n\t\t<!-- Dismiss all button (only show if multiple non-lockdown notifications) -->\n\t\t{#if notifications.filter((n) => n.type !== 'lockdown').length > 1}\n\t\t\t<button\n\t\t\t\tclass=\"self-end bg-gray-700 text-white px-3 py-1 rounded hover:bg-gray-600 text-sm\"\n\t\t\t\tonclick={dismissAll}\n\t\t\t>\n\t\t\t\tDismiss All\n\t\t\t</button>\n\t\t{/if}\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { createForm } from 'svelte-forms-lib';\n\timport * as yup from 'yup';\n\timport Modal from './Modal.svelte';\n\timport { VERSION, type TokenData } from '$lib/common';\n\timport { log } from '$lib/managers/Logger';\n\timport Tooltip from './Tooltip.svelte';\n\n\tinterface Props {\n\t\tshow?: boolean;\n\t\ttoken?: TokenData | null;\n\t\tclassName?: string;\n\t\tonSubmit?: (token: TokenData) => void;\n\t}\n\n\tlet { show = $bindable(false), token = null, className = 'z-[999]', onSubmit }: Props = $props();\n\n\tconst { form, errors, handleChange, handleSubmit, updateInitialValues } = createForm({\n\t\tinitialValues: {\n\t\t\taddress: '',\n\t\t\tname: '',\n\t\t\talias: '',\n\t\t\tsymbol: '',\n\t\t\tdecimals: 18,\n\t\t\tchainId: 1,\n\t\t\tsidepanel: true,\n\t\t\tevmCompatible: true,\n\t\t\tlogoURI: '',\n\t\t\turl: '',\n\t\t\tcustomDefault: 'custom',\n\t\t\tisNative: false,\n\t\t\tisStablecoin: false,\n\t\t\tdescription: '',\n\t\t\t// Enhanced fields for multi-blockchain support\n\t\t\tblockchain: 'ethereum',\n\t\t\tnetwork: 'mainnet',\n\t\t\tstandard: 'ERC20',\n\t\t\tisWatchOnly: false,\n\t\t\tportfolioIncluded: true,\n\t\t\tcoingeckoId: '',\n\t\t\twebsite: '',\n\t\t\texchange: '',\n\t\t\texchangeSymbol: '',\n\t\t\tisExchangeBalance: false\n\t\t},\n\t\tvalidationSchema: yup.object().shape({\n\t\t\taddress: yup.string().required('Please enter a token address'),\n\t\t\tname: yup.string().required('Please enter a token name'),\n\t\t\talias: yup.string().optional(),\n\t\t\tsymbol: yup.string().required('Please enter a token symbol'),\n\t\t\tdecimals: yup.number().required('Please enter the token decimals'),\n\t\t\tchainId: yup.number().when('blockchain', {\n\t\t\t\tis: (val: string) => ['ethereum', 'polygon', 'arbitrum', 'optimism', 'base'].includes(val),\n\t\t\t\tthen: (schema) => schema.required('Please enter the chain ID'),\n\t\t\t\totherwise: (schema) => schema.optional()\n\t\t\t}),\n\t\t\tblockchain: yup.string().required('Please select a blockchain'),\n\t\t\tnetwork: yup.string().required('Please select a network'),\n\t\t\tstandard: yup.string().required('Please select a token standard'),\n\t\t\tsidepanel: yup.boolean().optional().default(true),\n\t\t\tevmCompatible: yup.boolean().optional().default(true),\n\t\t\tlogoURI: yup.string().url('Must be a valid URL').optional().nullable(),\n\t\t\turl: yup.string().url('Must be a valid URL').optional().nullable(),\n\t\t\twebsite: yup.string().url('Must be a valid URL').optional().nullable(),\n\t\t\tcoingeckoId: yup.string().optional(),\n\t\t\texchange: yup.string().optional(),\n\t\t\texchangeSymbol: yup.string().optional(),\n\t\t\tisWatchOnly: yup.boolean().optional().default(false),\n\t\t\tportfolioIncluded: yup.boolean().optional().default(true),\n\t\t\tisExchangeBalance: yup.boolean().optional().default(false)\n\t\t}),\n\t\tonSubmit: (values) => {\n\t\t\ttry {\n\t\t\t\tconst updatedToken: TokenData = {\n\t\t\t\t\t...values,\n\t\t\t\t\tsidepanel: values.sidepanel ?? true,\n\t\t\t\t\tevmCompatible: values.evmCompatible ?? (values.blockchain === 'ethereum' || values.standard === 'ERC20'),\n\t\t\t\t\tcustomDefault: 'custom', // Ensure customDefault is always 'custom'\n\t\t\t\t\tsymbol: values.symbol.toUpperCase(), // Ensure symbol is always uppercase\n\t\t\t\t\tbalance: token?.balance ?? 0n,\n\t\t\t\t\tquantity: token?.quantity ?? 0,\n\t\t\t\t\tprice: {\n\t\t\t\t\t\tprice: 0,\n\t\t\t\t\t\tisNative: false,\n\t\t\t\t\t\tprovider: '',\n\t\t\t\t\t\tlastUpdated: new Date(),\n\t\t\t\t\t\tchainId: token?.chainId ?? values.chainId ?? 1,\n\t\t\t\t\t\tcurrency: '',\n\t\t\t\t\t\tstatus: token?.price?.status ?? 0,\n\t\t\t\t\t\tmessage: token?.price?.message ?? ''\n\t\t\t\t\t},\n\t\t\t\t\tchange: token?.change ?? [],\n\t\t\t\t\tvalue: token?.value ?? 0,\n\t\t\t\t\ttags: token?.tags ?? [],\n\t\t\t\t\tversion: token?.version ?? VERSION,\n\t\t\t\t\t// Enhanced multi-blockchain fields\n\t\t\t\t\tblockchain: values.blockchain,\n\t\t\t\t\tnetwork: values.network,\n\t\t\t\t\tstandard: values.standard,\n\t\t\t\t\tisWatchOnly: values.isWatchOnly,\n\t\t\t\t\tportfolioIncluded: values.portfolioIncluded,\n\t\t\t\t\twatchedAt: token?.watchedAt ?? new Date().toISOString(),\n\t\t\t\t\texchangeInfo: values.isExchangeBalance ? {\n\t\t\t\t\t\texchange: values.exchange,\n\t\t\t\t\t\texchangeSymbol: values.exchangeSymbol || values.symbol,\n\t\t\t\t\t\tisExchangeBalance: values.isExchangeBalance\n\t\t\t\t\t} : undefined,\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\tcoingeckoId: values.coingeckoId || undefined,\n\t\t\t\t\t\twebsite: values.website || undefined,\n\t\t\t\t\t\tlastUpdated: new Date().toISOString()\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tonSubmit(updatedToken);\n\t\t\t\tresetForm();\n\t\t\t\tshow = false;\n\t\t\t} catch (error) {\n\t\t\t\tlog.error('TokenForm: Error:', false, error);\n\t\t\t}\n\t\t}\n\t});\n\n\tfunction resetForm() {\n\t\tupdateInitialValues({\n\t\t\taddress: '',\n\t\t\tname: '',\n\t\t\talias: '',\n\t\t\tsymbol: '',\n\t\t\tdecimals: 18,\n\t\t\tchainId: 1,\n\t\t\tsidepanel: true,\n\t\t\tevmCompatible: true,\n\t\t\tlogoURI: '',\n\t\t\turl: '',\n\t\t\tcustomDefault: 'custom',\n\t\t\tisNative: false,\n\t\t\tisStablecoin: false,\n\t\t\tdescription: '',\n\t\t\t// Enhanced fields for multi-blockchain support\n\t\t\tblockchain: 'ethereum',\n\t\t\tnetwork: 'mainnet',\n\t\t\tstandard: 'ERC20',\n\t\t\tisWatchOnly: false,\n\t\t\tportfolioIncluded: true,\n\t\t\tcoingeckoId: '',\n\t\t\twebsite: '',\n\t\t\texchange: '',\n\t\t\texchangeSymbol: '',\n\t\t\tisExchangeBalance: false\n\t\t});\n\t}\n\n\t$effect(() => {\n\t\tif (token) {\n\t\t\tupdateInitialValues({\n\t\t\t\taddress: token.address,\n\t\t\t\tname: token.name,\n\t\t\t\talias: token.alias ?? '',\n\t\t\t\tsymbol: token.symbol,\n\t\t\t\tdecimals: token.decimals,\n\t\t\t\tchainId: token.chainId ?? 1,\n\t\t\t\tsidepanel: token.sidepanel ?? true,\n\t\t\t\tevmCompatible: token.evmCompatible ?? true,\n\t\t\t\tlogoURI: token.logoURI ?? '',\n\t\t\t\turl: token.url ?? '',\n\t\t\t\tcustomDefault: 'custom',\n\t\t\t\tisNative: token.isNative ?? false,\n\t\t\t\tisStablecoin: token.isStablecoin ?? false,\n\t\t\t\tdescription: token.description ?? '',\n\t\t\t\t// Enhanced fields\n\t\t\t\tblockchain: token.blockchain ?? 'ethereum',\n\t\t\t\tnetwork: token.network ?? 'mainnet',\n\t\t\t\tstandard: token.standard ?? 'ERC20',\n\t\t\t\tisWatchOnly: token.isWatchOnly ?? false,\n\t\t\t\tportfolioIncluded: token.portfolioIncluded ?? true,\n\t\t\t\tcoingeckoId: token.metadata?.coingeckoId ?? '',\n\t\t\t\twebsite: token.metadata?.website ?? '',\n\t\t\t\texchange: token.exchangeInfo?.exchange ?? '',\n\t\t\t\texchangeSymbol: token.exchangeInfo?.exchangeSymbol ?? '',\n\t\t\t\tisExchangeBalance: token.exchangeInfo?.isExchangeBalance ?? false\n\t\t\t});\n\t\t}\n\t});\n</script>\n\n<Modal bind:show title={token ? 'Edit Token' : 'Add Token'}>\n\t<form onsubmit={handleSubmit} class=\"space-y-4 p-6\">\n\t\t<div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<label for=\"name\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-200\"\n\t\t\t\t\t>Name <span class=\"text-red-500\">*</span></label\n\t\t\t\t>\n\t\t\t\t<Tooltip content=\"The full name of the token (e.g., Ethereum, Bitcoin)\">\n\t\t\t\t\t<span class=\"text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t</Tooltip>\n\t\t\t</div>\n\t\t\t<input\n\t\t\t\ttype=\"text\"\n\t\t\t\tid=\"name\"\n\t\t\t\trequired\n\t\t\t\tplaceholder=\"Enter the token name\"\n\t\t\t\tclass=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800\"\n\t\t\t\tbind:value={$form.name}\n\t\t\t\tonchange={handleChange}\n\t\t\t/>\n\t\t\t{#if $errors.name}\n\t\t\t\t<p class=\"mt-2 text-sm text-red-600\">{$errors.name}</p>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<label for=\"address\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-200\"\n\t\t\t\t\t>Address <span class=\"text-red-500\">*</span></label\n\t\t\t\t>\n\t\t\t\t<Tooltip content=\"The contract address of the token on the blockchain\">\n\t\t\t\t\t<span class=\"text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t</Tooltip>\n\t\t\t</div>\n\t\t\t<input\n\t\t\t\ttype=\"text\"\n\t\t\t\tid=\"address\"\n\t\t\t\trequired\n\t\t\t\tplaceholder=\"Enter the token contract address\"\n\t\t\t\tclass=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focusring:indigo-500 sm:text-sm text-gray-800\"\n\t\t\t\tbind:value={$form.address}\n\t\t\t\tonchange={handleChange}\n\t\t\t/>\n\t\t\t{#if $errors.address}\n\t\t\t\t<p class=\"mt-2 text-sm text-red-600\">{$errors.address}</p>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<label for=\"alias\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-200\"\n\t\t\t\t\t>Alias</label\n\t\t\t\t>\n\t\t\t\t<Tooltip content=\"An optional alias for the token (e.g., ENS name)\">\n\t\t\t\t\t<span class=\"text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t</Tooltip>\n\t\t\t</div>\n\t\t\t<input\n\t\t\t\ttype=\"text\"\n\t\t\t\tid=\"alias\"\n\t\t\t\tplaceholder=\"Enter an alias like an ENS (optional)\"\n\t\t\t\tclass=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800\"\n\t\t\t\tbind:value={$form.alias}\n\t\t\t\tonchange={handleChange}\n\t\t\t/>\n\t\t\t{#if $errors.alias}\n\t\t\t\t<p class=\"mt-2 text-sm text-red-600\">{$errors.alias}</p>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<label for=\"symbol\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-200\"\n\t\t\t\t\t>Symbol <span class=\"text-red-500\">*</span></label\n\t\t\t\t>\n\t\t\t\t<Tooltip content=\"The token's ticker symbol (e.g., ETH, BTC)\">\n\t\t\t\t\t<span class=\"text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t</Tooltip>\n\t\t\t</div>\n\t\t\t<input\n\t\t\t\ttype=\"text\"\n\t\t\t\tid=\"symbol\"\n\t\t\t\trequired\n\t\t\t\tplaceholder=\"Enter the token symbol\"\n\t\t\t\tclass=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focusring:indigo-500 sm:text-sm text-gray-800\"\n\t\t\t\tbind:value={$form.symbol}\n\t\t\t\tonchange={handleChange}\n\t\t\t/>\n\t\t\t{#if $errors.symbol}\n\t\t\t\t<p class=\"mt-2 text-sm text-red-600\">{$errors.symbol}</p>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<label for=\"decimals\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-200\"\n\t\t\t\t\t>Decimals <span class=\"text-red-500\">*</span></label\n\t\t\t\t>\n\t\t\t\t<Tooltip\n\t\t\t\t\tcontent=\"The number of decimal places the token uses (e.g., 18 for most ERC20 tokens)\"\n\t\t\t\t>\n\t\t\t\t\t<span class=\"text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t</Tooltip>\n\t\t\t</div>\n\t\t\t<input\n\t\t\t\ttype=\"number\"\n\t\t\t\tid=\"decimals\"\n\t\t\t\tstep=\"1\"\n\t\t\t\trequired\n\t\t\t\tplaceholder=\"Enter the decimals token uses\"\n\t\t\t\tclass=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focusring:indigo-500 sm:text-sm text-gray-800\"\n\t\t\t\tbind:value={$form.decimals}\n\t\t\t\tonchange={handleChange}\n\t\t\t/>\n\t\t\t{#if $errors.decimals}\n\t\t\t\t<p class=\"mt-2 text-sm text-red-600\">{$errors.decimals}</p>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<!-- Blockchain and Network Selection -->\n\t\t<div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n\t\t\t<div>\n\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t<label for=\"blockchain\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-200\"\n\t\t\t\t\t\t>Blockchain <span class=\"text-red-500\">*</span></label\n\t\t\t\t\t>\n\t\t\t\t\t<Tooltip content=\"The blockchain network this token exists on\">\n\t\t\t\t\t\t<span class=\"text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\t\t\t\t<select\n\t\t\t\t\tid=\"blockchain\"\n\t\t\t\t\tbind:value={$form.blockchain}\n\t\t\t\t\tonchange={handleChange}\n\t\t\t\t\tclass=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800\"\n\t\t\t\t>\n\t\t\t\t\t<option value=\"ethereum\">Ethereum</option>\n\t\t\t\t\t<option value=\"solana\">Solana</option>\n\t\t\t\t\t<option value=\"bitcoin\">Bitcoin</option>\n\t\t\t\t\t<option value=\"cosmos\">Cosmos</option>\n\t\t\t\t\t<option value=\"polygon\">Polygon</option>\n\t\t\t\t\t<option value=\"arbitrum\">Arbitrum</option>\n\t\t\t\t\t<option value=\"optimism\">Optimism</option>\n\t\t\t\t\t<option value=\"base\">Base</option>\n\t\t\t\t\t<option value=\"avalanche\">Avalanche</option>\n\t\t\t\t\t<option value=\"bsc\">Binance Smart Chain</option>\n\t\t\t\t</select>\n\t\t\t\t{#if $errors.blockchain}\n\t\t\t\t\t<p class=\"mt-2 text-sm text-red-600\">{$errors.blockchain}</p>\n\t\t\t\t{/if}\n\t\t\t</div>\n\n\t\t\t<div>\n\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t<label for=\"network\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-200\"\n\t\t\t\t\t\t>Network <span class=\"text-red-500\">*</span></label\n\t\t\t\t\t>\n\t\t\t\t\t<Tooltip content=\"The specific network (mainnet, testnet, etc.)\">\n\t\t\t\t\t\t<span class=\"text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\t\t\t\t<select\n\t\t\t\t\tid=\"network\"\n\t\t\t\t\tbind:value={$form.network}\n\t\t\t\t\tonchange={handleChange}\n\t\t\t\t\tclass=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800\"\n\t\t\t\t>\n\t\t\t\t\t{#if $form.blockchain === 'ethereum'}\n\t\t\t\t\t\t<option value=\"mainnet\">Mainnet</option>\n\t\t\t\t\t\t<option value=\"sepolia\">Sepolia Testnet</option>\n\t\t\t\t\t\t<option value=\"goerli\">Goerli Testnet</option>\n\t\t\t\t\t{:else if $form.blockchain === 'solana'}\n\t\t\t\t\t\t<option value=\"mainnet-beta\">Mainnet Beta</option>\n\t\t\t\t\t\t<option value=\"testnet\">Testnet</option>\n\t\t\t\t\t\t<option value=\"devnet\">Devnet</option>\n\t\t\t\t\t{:else if $form.blockchain === 'bitcoin'}\n\t\t\t\t\t\t<option value=\"mainnet\">Mainnet</option>\n\t\t\t\t\t\t<option value=\"testnet\">Testnet</option>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<option value=\"mainnet\">Mainnet</option>\n\t\t\t\t\t\t<option value=\"testnet\">Testnet</option>\n\t\t\t\t\t{/if}\n\t\t\t\t</select>\n\t\t\t\t{#if $errors.network}\n\t\t\t\t\t<p class=\"mt-2 text-sm text-red-600\">{$errors.network}</p>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n\t\t\t<div>\n\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t<label for=\"standard\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-200\"\n\t\t\t\t\t\t>Token Standard <span class=\"text-red-500\">*</span></label\n\t\t\t\t\t>\n\t\t\t\t\t<Tooltip content=\"The token standard (ERC20, SPL, etc.)\">\n\t\t\t\t\t\t<span class=\"text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\t\t\t\t<select\n\t\t\t\t\tid=\"standard\"\n\t\t\t\t\tbind:value={$form.standard}\n\t\t\t\t\tonchange={handleChange}\n\t\t\t\t\tclass=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800\"\n\t\t\t\t>\n\t\t\t\t\t{#if $form.blockchain === 'ethereum' || $form.blockchain === 'polygon' || $form.blockchain === 'arbitrum' || $form.blockchain === 'optimism' || $form.blockchain === 'base'}\n\t\t\t\t\t\t<option value=\"ERC20\">ERC20</option>\n\t\t\t\t\t\t<option value=\"ERC721\">ERC721 (NFT)</option>\n\t\t\t\t\t\t<option value=\"ERC1155\">ERC1155</option>\n\t\t\t\t\t{:else if $form.blockchain === 'solana'}\n\t\t\t\t\t\t<option value=\"SPL\">SPL Token</option>\n\t\t\t\t\t\t<option value=\"NFT\">Solana NFT</option>\n\t\t\t\t\t{:else if $form.blockchain === 'bitcoin'}\n\t\t\t\t\t\t<option value=\"BRC20\">BRC20</option>\n\t\t\t\t\t\t<option value=\"RUNES\">Runes</option>\n\t\t\t\t\t{:else if $form.blockchain === 'cosmos'}\n\t\t\t\t\t\t<option value=\"CW20\">CW20</option>\n\t\t\t\t\t\t<option value=\"IBC\">IBC Token</option>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<option value=\"NATIVE\">Native Token</option>\n\t\t\t\t\t\t<option value=\"CUSTOM\">Custom</option>\n\t\t\t\t\t{/if}\n\t\t\t\t</select>\n\t\t\t\t{#if $errors.standard}\n\t\t\t\t\t<p class=\"mt-2 text-sm text-red-600\">{$errors.standard}</p>\n\t\t\t\t{/if}\n\t\t\t</div>\n\n\t\t\t{#if ['ethereum', 'polygon', 'arbitrum', 'optimism', 'base', 'bsc', 'avalanche'].includes($form.blockchain)}\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t<label for=\"chainid\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-200\"\n\t\t\t\t\t\t\t>Chain ID <span class=\"text-red-500\">*</span></label\n\t\t\t\t\t\t>\n\t\t\t\t\t\t<Tooltip content=\"The ID of the blockchain network (e.g., 1 for Ethereum Mainnet)\">\n\t\t\t\t\t\t\t<span class=\"text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\tid=\"chainid\"\n\t\t\t\t\t\tstep=\"1\"\n\t\t\t\t\t\trequired\n\t\t\t\t\t\tplaceholder=\"Enter the chain ID\"\n\t\t\t\t\t\tclass=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800\"\n\t\t\t\t\t\tbind:value={$form.chainId}\n\t\t\t\t\t\tonchange={handleChange}\n\t\t\t\t\t/>\n\t\t\t\t\t{#if $errors.chainId}\n\t\t\t\t\t\t<p class=\"mt-2 text-sm text-red-600\">{$errors.chainId}</p>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<!-- Watch and Portfolio Options -->\n\t\t<div class=\"space-y-4 p-4 bg-gray-50 rounded-lg\">\n\t\t\t<h3 class=\"text-sm font-medium text-gray-900\">Token Options</h3>\n\t\t\t\n\t\t\t<div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\tid=\"isWatchOnly\"\n\t\t\t\t\t\tbind:checked={$form.isWatchOnly}\n\t\t\t\t\t\tonchange={handleChange}\n\t\t\t\t\t\tclass=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n\t\t\t\t\t/>\n\t\t\t\t\t<label for=\"isWatchOnly\" class=\"ml-2 block text-sm text-gray-900\">\n\t\t\t\t\t\tWatch-only (track price but no transactions)\n\t\t\t\t\t</label>\n\t\t\t\t\t<Tooltip content=\"Enable this for tokens you want to track but can't transact with\">\n\t\t\t\t\t\t<span class=\"ml-1 text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\tid=\"portfolioIncluded\"\n\t\t\t\t\t\tbind:checked={$form.portfolioIncluded}\n\t\t\t\t\t\tonchange={handleChange}\n\t\t\t\t\t\tclass=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n\t\t\t\t\t/>\n\t\t\t\t\t<label for=\"portfolioIncluded\" class=\"ml-2 block text-sm text-gray-900\">\n\t\t\t\t\t\tInclude in portfolio total\n\t\t\t\t\t</label>\n\t\t\t\t\t<Tooltip content=\"Include this token's value in your total portfolio calculation\">\n\t\t\t\t\t\t<span class=\"ml-1 text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\tid=\"sidepanel\"\n\t\t\t\t\t\tbind:checked={$form.sidepanel}\n\t\t\t\t\t\tonchange={handleChange}\n\t\t\t\t\t\tclass=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n\t\t\t\t\t/>\n\t\t\t\t\t<label for=\"sidepanel\" class=\"ml-2 block text-sm text-gray-900\">\n\t\t\t\t\t\tShow in sidepanel\n\t\t\t\t\t</label>\n\t\t\t\t\t<Tooltip content=\"Show this token in the sidepanel view\">\n\t\t\t\t\t\t<span class=\"ml-1 text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\tid=\"isExchangeBalance\"\n\t\t\t\t\t\tbind:checked={$form.isExchangeBalance}\n\t\t\t\t\t\tonchange={handleChange}\n\t\t\t\t\t\tclass=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n\t\t\t\t\t/>\n\t\t\t\t\t<label for=\"isExchangeBalance\" class=\"ml-2 block text-sm text-gray-900\">\n\t\t\t\t\t\tExchange balance\n\t\t\t\t\t</label>\n\t\t\t\t\t<Tooltip content=\"This represents a balance on a centralized exchange\">\n\t\t\t\t\t\t<span class=\"ml-1 text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- Exchange Information (conditional) -->\n\t\t{#if $form.isExchangeBalance}\n\t\t\t<div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t<label for=\"exchange\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-200\">\n\t\t\t\t\t\t\tExchange\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<Tooltip content=\"Which exchange this balance is on\">\n\t\t\t\t\t\t\t<span class=\"text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t\t<select\n\t\t\t\t\t\tid=\"exchange\"\n\t\t\t\t\t\tbind:value={$form.exchange}\n\t\t\t\t\t\tonchange={handleChange}\n\t\t\t\t\t\tclass=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<option value=\"\">Select Exchange</option>\n\t\t\t\t\t\t<option value=\"binance\">Binance</option>\n\t\t\t\t\t\t<option value=\"coinbase\">Coinbase</option>\n\t\t\t\t\t\t<option value=\"kraken\">Kraken</option>\n\t\t\t\t\t\t<option value=\"okx\">OKX</option>\n\t\t\t\t\t\t<option value=\"bybit\">Bybit</option>\n\t\t\t\t\t\t<option value=\"kucoin\">KuCoin</option>\n\t\t\t\t\t\t<option value=\"gemini\">Gemini</option>\n\t\t\t\t\t\t<option value=\"other\">Other</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t<label for=\"exchangeSymbol\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-200\">\n\t\t\t\t\t\t\tExchange Symbol\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<Tooltip content=\"Symbol used on the exchange (may differ from token symbol)\">\n\t\t\t\t\t\t\t<span class=\"text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tid=\"exchangeSymbol\"\n\t\t\t\t\t\tplaceholder=\"Exchange-specific symbol\"\n\t\t\t\t\t\tclass=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800\"\n\t\t\t\t\t\tbind:value={$form.exchangeSymbol}\n\t\t\t\t\t\tonchange={handleChange}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t<!-- Additional Metadata -->\n\t\t<div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n\t\t\t<div>\n\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t<label for=\"coingeckoId\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-200\">\n\t\t\t\t\t\tCoinGecko ID\n\t\t\t\t\t</label>\n\t\t\t\t\t<Tooltip content=\"CoinGecko API identifier for price tracking\">\n\t\t\t\t\t\t<span class=\"text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\t\t\t\t<input\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tid=\"coingeckoId\"\n\t\t\t\t\tplaceholder=\"e.g., bitcoin, ethereum\"\n\t\t\t\t\tclass=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800\"\n\t\t\t\t\tbind:value={$form.coingeckoId}\n\t\t\t\t\tonchange={handleChange}\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div>\n\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t<label for=\"website\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-200\">\n\t\t\t\t\t\tWebsite\n\t\t\t\t\t</label>\n\t\t\t\t\t<Tooltip content=\"Official website URL\">\n\t\t\t\t\t\t<span class=\"text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\t\t\t\t<input\n\t\t\t\t\ttype=\"url\"\n\t\t\t\t\tid=\"website\"\n\t\t\t\t\tplaceholder=\"https://example.com\"\n\t\t\t\t\tclass=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800\"\n\t\t\t\t\tbind:value={$form.website}\n\t\t\t\t\tonchange={handleChange}\n\t\t\t\t/>\n\t\t\t\t{#if $errors.website}\n\t\t\t\t\t<p class=\"mt-2 text-sm text-red-600\">{$errors.website}</p>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<label\n\t\t\t\t\tfor=\"evmCompatible\"\n\t\t\t\t\tclass=\"block text-sm font-medium text-gray-700 dark:text-gray-200\">EVM compatible</label\n\t\t\t\t>\n\t\t\t\t<Tooltip content=\"Whether this token follows the Ethereum Virtual Machine standard\">\n\t\t\t\t\t<span class=\"text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t</Tooltip>\n\t\t\t</div>\n\t\t\t<input\n\t\t\t\ttype=\"checkbox\"\n\t\t\t\tid=\"evmCompatible\"\n\t\t\t\tbind:checked={$form.evmCompatible}\n\t\t\t\tonchange={handleChange}\n\t\t\t/>\n\t\t\t{#if $errors.evmCompatible}\n\t\t\t\t<p class=\"mt-2 text-sm text-red-600\">{$errors.evmCompatible}</p>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<label for=\"logoURI\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-200\"\n\t\t\t\t\t>Logo URI</label\n\t\t\t\t>\n\t\t\t\t<Tooltip content=\"URL to the token's logo image (should be a direct link to an image)\">\n\t\t\t\t\t<span class=\"text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t</Tooltip>\n\t\t\t</div>\n\t\t\t<input\n\t\t\t\ttype=\"text\"\n\t\t\t\tid=\"logoURI\"\n\t\t\t\tplaceholder=\"Enter the URL (https://...) for the logo\"\n\t\t\t\tclass=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800\"\n\t\t\t\tbind:value={$form.logoURI}\n\t\t\t\tonchange={handleChange}\n\t\t\t/>\n\t\t\t{#if $errors.logoURI}\n\t\t\t\t<p class=\"mt-2 text-sm text-red-600\">{$errors.logoURI}</p>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<label for=\"url\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-200\"\n\t\t\t\t\t>URL</label\n\t\t\t\t>\n\t\t\t\t<Tooltip content=\"URL to the token's explorer or website (optional)\">\n\t\t\t\t\t<span class=\"text-gray-400 hover:text-gray-600 cursor-help\"></span>\n\t\t\t\t</Tooltip>\n\t\t\t</div>\n\t\t\t<input\n\t\t\t\ttype=\"text\"\n\t\t\t\tid=\"url\"\n\t\t\t\tplaceholder=\"Optional:Enter the URL (https://...) for the token\"\n\t\t\t\tclass=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800\"\n\t\t\t\tbind:value={$form.url}\n\t\t\t\tonchange={handleChange}\n\t\t\t/>\n\t\t\t{#if $errors.url}\n\t\t\t\t<p class=\"mt-2 text-sm text-red-600\">{$errors.url}</p>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<div class=\"pt-5\">\n\t\t\t<div class=\"flex justify-end space-x-4\">\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2\"\n\t\t\t\t\tonclick={() => (show = false)}>Cancel</button\n\t\t\t\t>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2\"\n\t\t\t\t\tonclick={resetForm}>Reset</button\n\t\t\t\t>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\tclass=\"rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2\"\n\t\t\t\t\t>Save</button\n\t\t\t\t>\n\t\t\t</div>\n\t\t</div>\n\t</form>\n</Modal>\n","<!-- TokenListEnhanced.svelte - Membership-aware token display -->\n<script lang=\"ts\">\n\timport type { TokenData, Settings } from '$lib/common';\n\timport { PlanType } from '$lib/common/types';\n\timport { getSettings } from '$lib/common/stores';\n\timport { \n\t\ttoBasicAnalytics, \n\t\ttoProAnalytics, \n\t\tshouldShowProFeatures,\n\t\ttype BasicTokenAnalytics,\n\t\ttype ProTokenAnalytics \n\t} from '$lib/common/token-analytics';\n\timport TokenForm from './TokenForm.svelte';\n\timport Confirmation from './Confirmation.svelte';\n\timport EditControls from './EditControls.svelte';\n\timport SimpleTooltip from './SimpleTooltip.svelte';\n\timport { getTokenChange } from '$lib/utilities/utilities';\n\timport { onMount } from 'svelte';\n\n\tinterface Props {\n\t\ttokens?: TokenData[];\n\t\tonTokenSelect?: (token: TokenData) => void;\n\t\tonTokenUpdate?: (token: TokenData) => void;\n\t\tonTokenDelete?: (token: TokenData) => void;\n\t}\n\n\tlet {\n\t\ttokens = [],\n\t\tonTokenSelect = () => {},\n\t\tonTokenUpdate = () => {},\n\t\tonTokenDelete = () => {}\n\t}: Props = $props();\n\n\tlet selectedToken: TokenData | null = $state(null);\n\tlet showEditModal = $state(false);\n\tlet showDeleteModal = $state(false);\n\tlet settings: Settings | null = $state(null);\n\tlet isProUser = $state(false);\n\n\t// Currency formatter for USD values\n\tconst currencyFormatter = new Intl.NumberFormat('en-US', {\n\t\tstyle: 'currency',\n\t\tcurrency: 'USD',\n\t\tminimumFractionDigits: 2,\n\t\tmaximumFractionDigits: 2\n\t});\n\n\t// Formatter for precise values (shows more decimals)\n\tconst preciseFormatter = new Intl.NumberFormat('en-US', {\n\t\tstyle: 'currency',\n\t\tcurrency: 'USD',\n\t\tminimumFractionDigits: 2,\n\t\tmaximumFractionDigits: 8\n\t});\n\n\t// Percentage formatter\n\tconst percentFormatter = new Intl.NumberFormat('en-US', {\n\t\tstyle: 'percent',\n\t\tminimumFractionDigits: 1,\n\t\tmaximumFractionDigits: 1\n\t});\n\n\tonMount(async () => {\n\t\tsettings = await getSettings();\n\t\tisProUser = shouldShowProFeatures(settings?.plan?.type || PlanType.BASIC_MEMBER);\n\t});\n\n\tfunction handleEdit(token: TokenData) {\n\t\tselectedToken = token;\n\t\tshowEditModal = true;\n\t}\n\n\tfunction handleDelete(token: TokenData) {\n\t\tif (token?.customDefault === 'custom') {\n\t\t\tselectedToken = token;\n\t\t\tshowDeleteModal = true;\n\t\t}\n\t}\n\n\tfunction confirmDelete() {\n\t\tif (selectedToken && selectedToken?.customDefault === 'custom') {\n\t\t\tonTokenDelete(selectedToken);\n\t\t\tshowDeleteModal = false;\n\t\t\tselectedToken = null;\n\t\t}\n\t}\n\n\tfunction getAnalyticsData(token: TokenData) {\n\t\treturn isProUser ? toProAnalytics(token) : toBasicAnalytics(token);\n\t}\n\n\tfunction formatLargeNumber(value: number): string {\n\t\tif (value >= 1e9) return `$${(value / 1e9).toFixed(2)}B`;\n\t\tif (value >= 1e6) return `$${(value / 1e6).toFixed(2)}M`;\n\t\tif (value >= 1e3) return `$${(value / 1e3).toFixed(2)}K`;\n\t\treturn currencyFormatter.format(value);\n\t}\n\n\tfunction getRiskColor(score: number): string {\n\t\tif (score <= 3) return 'text-green-600 bg-green-100';\n\t\tif (score <= 6) return 'text-yellow-600 bg-yellow-100';\n\t\treturn 'text-red-600 bg-red-100';\n\t}\n\n\tfunction getRiskLevel(score: number): string {\n\t\tif (score <= 3) return 'Low';\n\t\tif (score <= 6) return 'Medium';\n\t\treturn 'High';\n\t}\n</script>\n\n<ul class=\"overflow-hidden\">\n\t{#each tokens as token}\n\t\t{@const analytics = getAnalyticsData(token)}\n\t\t<li class=\"mb-3 relative overflow-hidden\">\n\t\t\t<button\n\t\t\t\tclass=\"w-full flex items-start rounded-lg p-3 transition-colors duration-200 overflow-hidden {token?.customDefault === 'custom'\n\t\t\t\t\t? 'bg-emerald-50 hover:bg-emerald-100 border border-emerald-200'\n\t\t\t\t\t: token?.sidepanel\n\t\t\t\t\t\t? 'bg-blue-50 hover:bg-blue-100 border border-blue-200'\n\t\t\t\t\t\t: 'bg-gray-50 hover:bg-gray-100 border border-gray-200'}\"\n\t\t\t\tonclick={() => onTokenSelect(token)}\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"w-6 h-6 flex items-center justify-center rounded-full {token?.customDefault === 'custom'\n\t\t\t\t\t\t? 'bg-emerald-500'\n\t\t\t\t\t\t: token?.sidepanel\n\t\t\t\t\t\t\t? 'bg-blue-500'\n\t\t\t\t\t\t\t: 'bg-gray-500'} text-white mr-3 shrink-0\"\n\t\t\t\t>\n\t\t\t\t\t{#if token?.logoURI}\n\t\t\t\t\t\t<img src={token.logoURI} alt={token.symbol} class=\"w-6 h-6 rounded-full\" />\n\t\t\t\t\t{:else if token?.customDefault === 'custom'}\n\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"w-3 h-3\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n\t\t\t\t\t\t\t<path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z\" clip-rule=\"evenodd\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"w-3 h-3\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n\t\t\t\t\t\t\t<path fill-rule=\"evenodd\" d=\"M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732L14.146 12.8l-1.179 4.456a1 1 0 01-1.934 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732L9.854 7.2l1.179-4.456A1 1 0 0112 2z\" clip-rule=\"evenodd\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div class=\"flex-1 min-w-0 overflow-hidden\">\n\t\t\t\t\t<div class=\"flex items-center justify-between mb-1\">\n\t\t\t\t\t\t<div class=\"flex items-center space-x-2\">\n\t\t\t\t\t\t\t<h3 class=\"text-sm font-semibold text-gray-800\">\n\t\t\t\t\t\t\t\t{token?.customDefault === 'custom' ? 'CUSTOM TOKEN' : 'COMMON TOKEN'}\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t{#if token?.sidepanel}\n\t\t\t\t\t\t\t\t<span class=\"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded-full\">Visible</span>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{#if token?.customDefault === 'custom'}\n\t\t\t\t\t\t\t\t<span class=\"text-xs px-2 py-1 bg-emerald-100 text-emerald-700 rounded-full\">Custom</span>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{#if !isProUser}\n\t\t\t\t\t\t\t\t<SimpleTooltip content=\"Upgrade to Pro for advanced analytics\">\n\t\t\t\t\t\t\t\t\t<span class=\"text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded-full cursor-help\">Basic</span>\n\t\t\t\t\t\t\t\t</SimpleTooltip>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<!-- Token Name and Symbol -->\n\t\t\t\t\t<p class=\"text-sm font-medium text-gray-700 truncate mb-1\" title={token.name}>\n\t\t\t\t\t\t{token.name} ({token.symbol})\n\t\t\t\t\t</p>\n\t\t\t\t\t\n\t\t\t\t\t<!-- Basic Info - Shown to all users -->\n\t\t\t\t\t<div class=\"flex items-center space-x-4 mb-2\">\n\t\t\t\t\t\t{#if analytics.balance}\n\t\t\t\t\t\t\t{@const rawBalance = typeof analytics.balance === 'bigint' ? Number(analytics.balance) / Math.pow(10, analytics.decimals || 18) : Number(analytics.balance)}\n\t\t\t\t\t\t\t{@const balanceNumber = isNaN(rawBalance) ? 0 : rawBalance}\n\t\t\t\t\t\t\t{@const balanceValue = analytics.value}\n\t\t\t\t\t\t\t<SimpleTooltip content={`${balanceNumber.toFixed(8)} ${analytics.symbol}  ${preciseFormatter.format(balanceValue)}`}>\n\t\t\t\t\t\t\t\t<span class=\"text-xs text-gray-600 font-medium cursor-help\" title=\"Token Balance\">\n\t\t\t\t\t\t\t\t\tBalance: {balanceNumber.toFixed(4)} {balanceValue > 0 ? ` ${currencyFormatter.format(balanceValue)}` : ''}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</SimpleTooltip>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\n\t\t\t\t\t\t{#if analytics.currentPrice > 0}\n\t\t\t\t\t\t\t<SimpleTooltip content={preciseFormatter.format(analytics.currentPrice)}>\n\t\t\t\t\t\t\t\t<span class=\"text-xs px-2 py-1 bg-green-100 text-green-700 rounded-full cursor-help\">\n\t\t\t\t\t\t\t\t\t{analytics.currentPrice < 0.01 ? '~< $0.01' : currencyFormatter.format(analytics.currentPrice)}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</SimpleTooltip>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<!-- Pro Features - Advanced Analytics -->\n\t\t\t\t\t{#if isProUser && 'priceChange24h' in analytics}\n\t\t\t\t\t\t{@const proData = analytics as ProTokenAnalytics}\n\t\t\t\t\t\t<div class=\"space-y-2 mb-2\">\n\t\t\t\t\t\t\t<!-- Price Changes -->\n\t\t\t\t\t\t\t<div class=\"flex items-center space-x-2\">\n\t\t\t\t\t\t\t\t<span class=\"text-xs px-2 py-1 rounded-full {proData.priceChange24h >= 0 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}\">\n\t\t\t\t\t\t\t\t\t24h: {proData.priceChange24h >= 0 ? '+' : ''}{proData.priceChange24h.toFixed(2)}%\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class=\"text-xs px-2 py-1 rounded-full {proData.priceChange7d >= 0 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}\">\n\t\t\t\t\t\t\t\t\t7d: {proData.priceChange7d >= 0 ? '+' : ''}{proData.priceChange7d.toFixed(2)}%\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<!-- Market Data -->\n\t\t\t\t\t\t\t<div class=\"flex items-center space-x-2 text-xs text-gray-500\">\n\t\t\t\t\t\t\t\t<span title=\"Market Cap\">MC: {formatLargeNumber(proData.marketCap)}</span>\n\t\t\t\t\t\t\t\t<span title=\"24h Volume\">Vol: {formatLargeNumber(proData.volume24h)}</span>\n\t\t\t\t\t\t\t\t<span title=\"Risk Score\" class=\"px-2 py-1 rounded-full {getRiskColor(proData.riskScore)}\">\n\t\t\t\t\t\t\t\t\tRisk: {getRiskLevel(proData.riskScore)}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<!-- Technical Indicators -->\n\t\t\t\t\t\t\t<div class=\"flex items-center space-x-2 text-xs\">\n\t\t\t\t\t\t\t\t<span class=\"px-2 py-1 bg-purple-100 text-purple-700 rounded-full\" title=\"RSI\">\n\t\t\t\t\t\t\t\t\tRSI: {proData.technicalIndicators.rsi.toFixed(0)}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t{#if proData.yieldOpportunities.length > 0}\n\t\t\t\t\t\t\t\t\t<SimpleTooltip content={`${proData.yieldOpportunities.length} yield opportunities available`}>\n\t\t\t\t\t\t\t\t\t\t<span class=\"px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full cursor-help\">\n\t\t\t\t\t\t\t\t\t\t\tMax APY: {Math.max(...proData.yieldOpportunities.map(y => y.apy)).toFixed(1)}%\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</SimpleTooltip>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<!-- Social Sentiment -->\n\t\t\t\t\t\t\t<div class=\"flex items-center space-x-2 text-xs\">\n\t\t\t\t\t\t\t\t<span class=\"px-2 py-1 rounded-full {proData.socialSentiment.score > 0 ? 'bg-green-100 text-green-700' : proData.socialSentiment.score < 0 ? 'bg-red-100 text-red-700' : 'bg-gray-100 text-gray-700'}\">\n\t\t\t\t\t\t\t\t\tSentiment: {proData.socialSentiment.score > 0 ? 'Positive' : proData.socialSentiment.score < 0 ? 'Negative' : 'Neutral'}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class=\"text-gray-500\" title=\"Mentions in 24h\">\n\t\t\t\t\t\t\t\t\t{proData.socialSentiment.mentions24h} mentions\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{:else if token.change}\n\t\t\t\t\t\t<!-- Basic users still see basic price change -->\n\t\t\t\t\t\t{@const percentageValue = getTokenChange(token.change, '24h')}\n\t\t\t\t\t\t{#if percentageValue !== null}\n\t\t\t\t\t\t\t<div class=\"mb-2\">\n\t\t\t\t\t\t\t\t<span class=\"text-xs px-2 py-1 rounded-full {percentageValue >= 0 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}\">\n\t\t\t\t\t\t\t\t\t24h: {percentageValue >= 0 ? '+' : ''}{percentageValue.toFixed(2)}%\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t<!-- Address -->\n\t\t\t\t\t<p class=\"text-xs text-gray-500 font-mono truncate mb-2\" title={token.address}>\n\t\t\t\t\t\t{token.address}\n\t\t\t\t\t</p>\n\n\t\t\t\t\t<!-- Decimals Badge -->\n\t\t\t\t\t{#if token.decimals}\n\t\t\t\t\t\t<div class=\"flex items-center space-x-2\">\n\t\t\t\t\t\t\t<span class=\"text-xs px-2 py-1 bg-purple-100 text-purple-700 rounded-full\">\n\t\t\t\t\t\t\t\t{token.decimals} decimals\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t<!-- Pro Feature Badges -->\n\t\t\t\t\t{#if !isProUser}\n\t\t\t\t\t\t<div class=\"mt-2 p-2 bg-amber-50 border border-amber-200 rounded\">\n\t\t\t\t\t\t\t<div class=\"text-xs text-amber-800\">\n\t\t\t\t\t\t\t\t<span class=\"font-medium\"> Pro Insights Available:</span>\n\t\t\t\t\t\t\t\tAdvanced analytics, yield opportunities, risk analysis, and more\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</button>\n\t\t\t\n\t\t\t<EditControls\n\t\t\t\tonCopy={() => navigator.clipboard.writeText(token.address)}\n\t\t\t\tonEdit={() => handleEdit(token)}\n\t\t\t\tonDelete={() => handleDelete(token)}\n\t\t\t\tcontrols={token?.customDefault === 'custom' ? ['copy', 'edit', 'delete'] : ['copy', 'edit']}\n\t\t\t\thasBalance={token.balance && Number(token.balance) > 0}\n\t\t\t/>\n\t\t</li>\n\t{/each}\n</ul>\n\n<TokenForm bind:show={showEditModal} token={selectedToken} onSubmit={onTokenUpdate} />\n\n<Confirmation\n\tbind:show={showDeleteModal}\n\tonConfirm={confirmDelete}\n\ttitle=\"Delete Token\"\n\tmessage=\"Are you sure you want to delete this token? This action cannot be undone.\"\n/>","<!-- TokensEnhanced.svelte -->\n<script lang=\"ts\">\n\timport {\n\t\tsetYakklTokenDataCustomStorage,\n\t\tyakklCombinedTokenStore,\n\t\tyakklCurrentlySelectedStore,\n\t\tyakklTokenDataCustomStore,\n\t\tgetSettings\n\t} from '$lib/common/stores';\n\timport { getInstances, type TokenData, type Settings } from '$lib/common';\n\timport { PlanType } from '$lib/common/types';\n\timport Modal from './Modal.svelte';\n\timport TokenListEnhanced from './TokenListEnhanced.svelte';\n\timport TokenForm from './TokenForm.svelte';\n\timport SimpleTooltip from './SimpleTooltip.svelte';\n\timport { onMount, onDestroy } from 'svelte';\n\timport type { TokenService } from '$lib/managers/blockchains/evm/TokenService';\n\timport type { Provider } from '$lib/managers/Provider';\n\timport { getTokenBalance } from '$lib/utilities/balanceUtils';\n\timport { log } from '$lib/managers/Logger';\n\n\tinterface Props {\n\t\tshow?: boolean;\n\t\tonTokenSelect?: (token: TokenData) => void;\n\t\tclassName?: string;\n\t}\n\n\tlet { show = $bindable(false), onTokenSelect = null, className = 'z-[899]' }: Props = $props();\n\n\tlet showAddModal = $state(false);\n\tlet tokens = $state<TokenData[]>([]); // Combined tokens for display\n\tlet provider: Provider | null = null;\n\tlet tokenService: TokenService<any> | null = null;\n\tlet settings: Settings | null = null;\n\tlet isBasicMember = $state(true);\n\tlet isRefreshing = $state(false);\n\tlet lastRefreshTime = $state<Date | null>(null);\n\tlet autoRefreshInterval: number | null = null;\n\t\n\tconst BASIC_AUTO_REFRESH_INTERVAL_MS = 300000; // 5 minutes for Basic members\n\tconst PRO_AUTO_REFRESH_INTERVAL_MS = 30000; // 30 seconds for Pro members\n\n\t// Load settings to check membership\n\tonMount(async () => {\n\t\tsettings = await getSettings();\n\t\tisBasicMember = settings?.plan?.type === PlanType.BASIC_MEMBER;\n\t\t\n\t\t// Setup instances\n\t\tconst instances = await getInstances();\n\t\tif (instances.length > 0) {\n\t\t\tprovider = instances[1];\n\t\t\ttokenService = instances[3];\n\t\t}\n\n\t\t// Setup auto-refresh for all members (different intervals)\n\t\tstartAutoRefresh();\n\t});\n\n\tonDestroy(() => {\n\t\tif (autoRefreshInterval) {\n\t\t\tclearInterval(autoRefreshInterval);\n\t\t}\n\t});\n\n\t// Subscribe to the combined token store for display\n\t$effect(() => {\n\t\ttokens = $yakklCombinedTokenStore; // Reactive combined store\n\t});\n\n\t// No cooldown needed since we have automatic refresh for all members\n\n\tfunction startAutoRefresh() {\n\t\tif (autoRefreshInterval) return;\n\t\t\n\t\tconst interval = isBasicMember ? BASIC_AUTO_REFRESH_INTERVAL_MS : PRO_AUTO_REFRESH_INTERVAL_MS;\n\t\t\n\t\tautoRefreshInterval = setInterval(async () => {\n\t\t\tif (!isRefreshing) {\n\t\t\t\tawait refreshTokenPrices(false);\n\t\t\t}\n\t\t}, interval) as unknown as number;\n\t}\n\n\tasync function refreshTokenPrices(showLoading = true) {\n\t\tif (isRefreshing) return;\n\t\t\n\t\tif (showLoading) {\n\t\t\tisRefreshing = true;\n\t\t}\n\n\t\ttry {\n\t\t\t// Here you would call your price update service\n\t\t\t// For now, we'll simulate the refresh\n\t\t\tlog.info('Refreshing token prices...', false);\n\t\t\t\n\t\t\t// Simulate API call delay\n\t\t\tawait new Promise(resolve => setTimeout(resolve, 1000));\n\t\t\t\n\t\t\t// In a real implementation, you would:\n\t\t\t// 1. Fetch updated prices from your price service\n\t\t\t// 2. Update the token store with new prices\n\t\t\t// 3. Update balances if needed\n\t\t\t\n\t\t\tlastRefreshTime = new Date();\n\t\t} catch (error) {\n\t\t\tlog.error('Error refreshing token prices:', false, error);\n\t\t} finally {\n\t\t\tisRefreshing = false;\n\t\t}\n\t}\n\n\tfunction handleTokenSelect(selectedToken: TokenData) {\n\t\tif (onTokenSelect !== null) {\n\t\t\tonTokenSelect(selectedToken);\n\t\t}\n\t\tshow = false;\n\t}\n\n\tasync function handleTokenAdd(token: TokenData) {\n\t\tif (token?.customDefault === 'custom') {\n\t\t\tconst balance = await getTokenBalance(\n\t\t\t\ttoken,\n\t\t\t\t$yakklCurrentlySelectedStore.shortcuts.address,\n\t\t\t\tprovider,\n\t\t\t\ttokenService\n\t\t\t);\n\t\t\ttoken.balance = balance;\n\t\t\tyakklTokenDataCustomStore.update((tokens) => [...tokens, token]);\n\t\t\tsetYakklTokenDataCustomStorage($yakklTokenDataCustomStore);\n\t\t}\n\t\tshowAddModal = false;\n\t}\n\n\tfunction handleTokenDelete(deletedToken: TokenData) {\n\t\tyakklTokenDataCustomStore.update((tokens) => {\n\t\t\tconst updatedTokens = tokens.filter((t) => t.address !== deletedToken.address);\n\t\t\tsetYakklTokenDataCustomStorage(updatedTokens);\n\t\t\treturn updatedTokens;\n\t\t});\n\t}\n\n\tfunction handleTokenUpdate(updatedToken: TokenData) {\n\t\tyakklTokenDataCustomStore.update((tokens) => {\n\t\t\tconst updatedTokens = tokens.map((t) =>\n\t\t\t\tt.address === updatedToken.address ? updatedToken : t\n\t\t\t);\n\t\t\tlog.info('updatedTokens', false, updatedTokens);\n\t\t\tsetYakklTokenDataCustomStorage(updatedTokens);\n\t\t\treturn updatedTokens;\n\t\t});\n\t}\n\n\n\tfunction closeModal() {\n\t\tshow = false;\n\t}\n</script>\n\n<Modal\n\tbind:show\n\ttitle=\"All Tokens\"\n\tdescription=\"View and manage your tokens\"\n\tonClose={closeModal}\n\t{className}\n>\n\t<div class=\"p-4\">\n\t\t<!-- Header with auto-refresh status -->\n\t\t<div class=\"flex items-center justify-between mb-4\">\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<h3 class=\"text-lg font-semibold text-gray-800\">Token Portfolio</h3>\n\t\t\t\t<div class=\"flex items-center gap-1\">\n\t\t\t\t\t<div class=\"w-2 h-2 bg-green-600 rounded-full animate-pulse\"></div>\n\t\t\t\t\t<span class=\"text-xs text-gray-500\">\n\t\t\t\t\t\tAuto-refresh {isBasicMember ? '(5min)' : '(live)'}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\n\t\t\t{#if isBasicMember}\n\t\t\t\t<SimpleTooltip content=\"Upgrade for real-time price updates and advanced analytics\">\n\t\t\t\t\t<a\n\t\t\t\t\t\thref=\"#upgrade\"\n\t\t\t\t\t\tclass=\"text-xs text-indigo-600 hover:text-indigo-700 font-medium flex items-center gap-1\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg class=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n\t\t\t\t\t\t\t<path fill-rule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clip-rule=\"evenodd\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\tUpgrade for live prices\n\t\t\t\t\t</a>\n\t\t\t\t</SimpleTooltip>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t{#if tokens.length > 0}\n\t\t\t<!-- Enhanced token list with Basic vs Pro features -->\n\t\t\t<div class=\"space-y-3 mb-4 max-h-96 overflow-y-auto\">\n\t\t\t\t<TokenListEnhanced\n\t\t\t\t\t{tokens}\n\t\t\t\t\tonTokenSelect={handleTokenSelect}\n\t\t\t\t\tonTokenUpdate={handleTokenUpdate}\n\t\t\t\t\tonTokenDelete={handleTokenDelete}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\n\t\t\t<!-- Token count -->\n\t\t\t<div class=\"text-sm text-gray-500 text-center mb-4\">\n\t\t\t\tShowing all {tokens.length} token{tokens.length === 1 ? '' : 's'}\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<!-- Empty state -->\n\t\t\t<div class=\"text-center py-12\">\n\t\t\t\t<div class=\"w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-green-100 to-emerald-100 rounded-full flex items-center justify-center\">\n\t\t\t\t\t<svg class=\"w-8 h-8 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t\t<h3 class=\"text-lg font-semibold text-gray-700 mb-2\">No Tokens Found</h3>\n\t\t\t\t<p class=\"text-gray-500 mb-6\">Add tokens to start tracking your portfolio</p>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t<!-- Action buttons and info -->\n\t\t<div class=\"border-t border-gray-200 pt-4\">\n\t\t\t<button\n\t\t\t\tonclick={() => {\n\t\t\t\t\tshowAddModal = true;\n\t\t\t\t\tshow = false;\n\t\t\t\t}}\n\t\t\t\tclass=\"w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg flex items-center justify-center space-x-2\"\n\t\t\t>\n\t\t\t\t<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\" />\n\t\t\t\t</svg>\n\t\t\t\t<span>Add Custom Token</span>\n\t\t\t</button>\n\t\t\t\n\t\t\t{#if isBasicMember}\n\t\t\t\t<div class=\"mt-3 p-3 bg-amber-50 rounded-lg border border-amber-200\">\n\t\t\t\t\t<div class=\"flex items-start\">\n\t\t\t\t\t\t<div class=\"flex-shrink-0\">\n\t\t\t\t\t\t\t<svg class=\"w-4 h-4 text-amber-600 mt-0.5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n\t\t\t\t\t\t\t\t<path fill-rule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\" />\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ml-2\">\n\t\t\t\t\t\t\t<p class=\"text-xs text-amber-800 font-medium\">\n\t\t\t\t\t\t\t\tManual refresh only - Upgrade to YAKKL Pro for:\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<ul class=\"text-xs text-amber-700 mt-1 space-y-0.5\">\n\t\t\t\t\t\t\t\t<li> Automatic price updates with full analytics</li>\n\t\t\t\t\t\t\t\t<li> Real-time portfolio tracking</li>\n\t\t\t\t\t\t\t\t<li> Advanced token insights</li>\n\t\t\t\t\t\t\t\t<li> Priority support</li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{:else}\n\t\t\t\t<div class=\"mt-3 p-3 bg-green-50 rounded-lg border border-green-200\">\n\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t<div class=\"flex-shrink-0\">\n\t\t\t\t\t\t\t<svg class=\"w-4 h-4 text-green-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n\t\t\t\t\t\t\t\t<path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\" />\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ml-2\">\n\t\t\t\t\t\t\t<p class=\"text-xs text-green-800\">\n\t\t\t\t\t\t\t\tEnjoying automatic price updates and full token analytics\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n</Modal>\n\n<TokenForm bind:show={showAddModal} onSubmit={handleTokenAdd} />","import { derived, type Readable } from 'svelte/store';\nimport { yakklCombinedTokenStore } from '$lib/common/stores';\nimport { log } from '$lib/managers/Logger';\nimport { DEBUG_ALL_LOGS } from '../constants';\nimport { computeTokenValue } from '$lib/common/computeTokenValue'; // Utility function to ensure accurate calculations\n\n// Type definition for the store value\nexport type TokenTotals = {\n\tportfolioTotal: number;\n\tformattedTotal: string;\n\tchainTotals: {\n\t\tbyChain: Record<number, number>;\n\t\tformatted: Record<string, string>;\n\t};\n};\n\n// Debugging flag (set to true when troubleshooting)\nconst DEBUG_LOGS = DEBUG_ALL_LOGS;\n\nexport const tokenTotals: Readable<TokenTotals> = derived(\n\tyakklCombinedTokenStore,\n\t(tokens, set) => {\n\t\tif (!tokens || tokens.length === 0) {\n\t\t\tlog.warn('No tokens found in yakklCombinedTokenStore. Skipping calculations.');\n\t\t\tset({\n\t\t\t\tportfolioTotal: 0,\n\t\t\t\tformattedTotal: '-------',\n\t\t\t\tchainTotals: { byChain: {}, formatted: {} }\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tlet portfolioTotal = 0;\n\t\tconst chainTotals: Record<number, number> = {};\n\n\t\t// Process all tokens\n\t\ttokens.forEach((token) => {\n\t\t\tif (!token) return;\n\n\t\t\tconst { value } = computeTokenValue(token); // Compute accurate token value\n\t\t\tportfolioTotal += value;\n\n\t\t\tconst chainId = token.chainId ?? -1; // Default to -1 if undefined\n\t\t\tchainTotals[chainId] = (chainTotals[chainId] ?? 0) + value;\n\t\t});\n\n\t\t// Format portfolio total\n\t\tconst formattedTotal =\n\t\t\tportfolioTotal > 0\n\t\t\t\t? new Intl.NumberFormat('en-US', {\n\t\t\t\t\t\tstyle: 'currency',\n\t\t\t\t\t\tcurrency: 'USD',\n\t\t\t\t\t\tminimumFractionDigits: 2,\n\t\t\t\t\t\tmaximumFractionDigits: 2\n\t\t\t\t\t}).format(portfolioTotal)\n\t\t\t\t: '-------';\n\n\t\t// Format totals per blockchain\n\t\tconst formattedChainTotals = Object.entries(chainTotals).reduce(\n\t\t\t(acc, [chainId, total]) => {\n\t\t\t\tacc[chainId] =\n\t\t\t\t\ttotal > 0\n\t\t\t\t\t\t? new Intl.NumberFormat('en-US', {\n\t\t\t\t\t\t\t\tstyle: 'currency',\n\t\t\t\t\t\t\t\tcurrency: 'USD',\n\t\t\t\t\t\t\t\tminimumFractionDigits: 2,\n\t\t\t\t\t\t\t\tmaximumFractionDigits: 2\n\t\t\t\t\t\t\t}).format(total)\n\t\t\t\t\t\t: '-------';\n\t\t\t\treturn acc;\n\t\t\t},\n\t\t\t{} as Record<string, string>\n\t\t);\n\n\t\t// Update store\n\t\tset({\n\t\t\tportfolioTotal,\n\t\t\tformattedTotal,\n\t\t\tchainTotals: {\n\t\t\t\tbyChain: chainTotals,\n\t\t\t\tformatted: formattedChainTotals\n\t\t\t}\n\t\t});\n\t},\n\t{\n\t\t// Initial Value\n\t\tportfolioTotal: 0,\n\t\tformattedTotal: '-------',\n\t\tchainTotals: { byChain: {}, formatted: {} }\n\t}\n);\n","<script lang=\"ts\">\n\tinterface Props {\n\t\tclassName?: string;\n\t}\n\n\tlet { className = 'w-6 h-6' }: Props = $props();\n</script>\n\n<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\" stroke=\"currentColor\" class={className}>\n  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125\" />\n</svg>\n","<!-- PortfolioTotal.svelte -->\n<script lang=\"ts\">\n\timport { onMount, onDestroy } from 'svelte';\n\timport { yakklCombinedTokenStore, yakklCurrentlySelectedStore, yakklPricingStore, getSettings } from '$lib/common/stores';\n\timport { shouldShowProFeatures } from '$lib/common/token-analytics';\n\timport { tokenTotals } from '$lib/common/stores/tokenTotals';\n\timport type { TokenData, Settings } from '$lib/common/interfaces';\n\timport { PlanType } from '$lib/common/types';\n\timport { formatEther } from '$lib/utilities/utilities';\n\timport { log } from '$lib/managers/Logger';\n\timport ProtectedValue from './ProtectedValue.svelte';\n\timport SimpleTooltip from './SimpleTooltip.svelte';\n\n\tinterface Props {\n\t\tclassName?: string;\n\t\tshowDetails?: boolean;\n\t\tcurrency?: string;\n\t}\n\n\tlet {\n\t\tclassName = '',\n\t\tshowDetails = false,\n\t\tcurrency = 'USD'\n\t}: Props = $props();\n\n\t// Ensure currency is always a valid code\n\tlet validCurrency = $derived(currency && currency.length === 3 ? currency : 'USD');\n\n\tlet totalPortfolioValue = $state(0);\n\tlet portfolioBreakdown = $state<Array<{token: TokenData, value: number, percentage: number}>>([]);\n\tlet isCalculating = $state(false);\n\tlet showTooltip = $state(false);\n\tlet error = $state('');\n\tlet lastUpdated = $state('');\n\tlet settings: Settings | null = null;\n\tlet isBasicMember = $state(true);\n\tlet hasInitialLoad = $state(false);\n\n\t// Currency formatter - use reactive statement to handle currency changes\n\tlet currencyFormatter = $state<Intl.NumberFormat>();\n\n\t$effect(() => {\n\t\ttry {\n\t\t\tcurrencyFormatter = new Intl.NumberFormat('en-US', {\n\t\t\t\tstyle: 'currency',\n\t\t\t\tcurrency: validCurrency,\n\t\t\t\tminimumFractionDigits: 2,\n\t\t\t\tmaximumFractionDigits: 2\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tlog.warn('[PortfolioTotal] Invalid currency code, falling back to USD:', false, { currency: validCurrency, error });\n\t\t\tcurrencyFormatter = new Intl.NumberFormat('en-US', {\n\t\t\t\tstyle: 'currency',\n\t\t\t\tcurrency: 'USD',\n\t\t\t\tminimumFractionDigits: 2,\n\t\t\t\tmaximumFractionDigits: 2\n\t\t\t});\n\t\t}\n\t});\n\n\t// Percentage formatter\n\tconst percentFormatter = new Intl.NumberFormat('en-US', {\n\t\tstyle: 'percent',\n\t\tminimumFractionDigits: 1,\n\t\tmaximumFractionDigits: 1\n\t});\n\n\t// Auto-refresh interval\n\tlet refreshInterval: number | null = null;\n\n\t// Use the same reactive tokenTotals store as Card.svelte\n\t$effect(() => {\n\t\tconst totals = $tokenTotals;\n\t\ttotalPortfolioValue = totals.portfolioTotal;\n\t\t\n\t\t// Create breakdown from current tokens for tooltip\n\t\tconst tokens = $yakklCombinedTokenStore;\n\t\tif (tokens && tokens.length > 0) {\n\t\t\tconst breakdown: Array<{token: TokenData, value: number, percentage: number}> = [];\n\t\t\tlet totalValue = totals.portfolioTotal;\n\n\t\t\ttokens.forEach(token => {\n\t\t\t\tif (token.balance && token.price?.price) {\n\t\t\t\t\tlet balanceNum: number;\n\t\t\t\t\tif (typeof token.balance === 'bigint') {\n\t\t\t\t\t\tbalanceNum = Number(token.balance) / Math.pow(10, token.decimals || 18);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbalanceNum = Number(token.balance);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tconst tokenValue = balanceNum * token.price.price;\n\t\t\t\t\tif (tokenValue > 0) {\n\t\t\t\t\t\tbreakdown.push({\n\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t\tvalue: tokenValue,\n\t\t\t\t\t\t\tpercentage: totalValue > 0 ? tokenValue / totalValue : 0\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Add native ETH if exists\n\t\t\tconst currentlySelected = $yakklCurrentlySelectedStore;\n\t\t\tconst ethPrice = $yakklPricingStore?.price || 0;\n\t\t\tif (currentlySelected?.shortcuts?.quantity && ethPrice > 0) {\n\t\t\t\tconst ethBalance = parseFloat(formatEther(currentlySelected.shortcuts.quantity));\n\t\t\t\tconst ethValue = ethBalance * ethPrice;\n\t\t\t\tif (ethValue > 0) {\n\t\t\t\t\tbreakdown.push({\n\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\tname: 'Ethereum',\n\t\t\t\t\t\t\tsymbol: 'ETH',\n\t\t\t\t\t\t\taddress: '0x0000000000000000000000000000000000000000',\n\t\t\t\t\t\t\tdecimals: 18,\n\t\t\t\t\t\t\tchainId: 1,\n\t\t\t\t\t\t\tbalance: currentlySelected.shortcuts.quantity,\n\t\t\t\t\t\t\tprice: { price: ethPrice, provider: 'pricing-store', lastUpdated: new Date(), chainId: 1 },\n\t\t\t\t\t\t\tportfolioIncluded: true,\n\t\t\t\t\t\t\tblockchain: 'ethereum',\n\t\t\t\t\t\t\tisNative: true\n\t\t\t\t\t\t} as TokenData,\n\t\t\t\t\t\tvalue: ethValue,\n\t\t\t\t\t\tpercentage: totalValue > 0 ? ethValue / totalValue : 0\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbreakdown.sort((a, b) => b.value - a.value);\n\t\t\tportfolioBreakdown = breakdown;\n\t\t}\n\t\t\n\t\tlastUpdated = new Date().toLocaleTimeString();\n\t\thasInitialLoad = true;\n\t});\n\n\tonMount(async () => {\n\t\t// Load settings to check membership\n\t\tsettings = await getSettings();\n\t\tisBasicMember = !shouldShowProFeatures(settings?.plan?.type || PlanType.BASIC_MEMBER);\n\t});\n\n\tonDestroy(() => {\n\t\tif (refreshInterval) {\n\t\t\tclearInterval(refreshInterval);\n\t\t}\n\t\tif (tooltipTimeout) {\n\t\t\tclearTimeout(tooltipTimeout);\n\t\t}\n\t});\n\n\t// Portfolio now updates reactively via tokenTotals store\n\n\tlet tooltipTimeout: number | null = null;\n\tlet isHoveringTooltip = $state(false);\n\tlet isHoveringTrigger = $state(false);\n\tlet isManualRefreshing = $state(false);\n\tlet lastManualRefresh = $state(0);\n\tlet refreshCooldown = $state(0);\n\n\t// Show tooltip when hovering over trigger\n\t$effect(() => {\n\t\tif (isHoveringTrigger) {\n\t\t\tshowTooltip = true;\n\t\t}\n\t});\n\n\t// Hide tooltip when not hovering over either trigger or tooltip\n\t$effect(() => {\n\t\tif (!isHoveringTrigger && !isHoveringTooltip) {\n\t\t\t// Small delay to allow smooth transition between elements\n\t\t\tif (tooltipTimeout) clearTimeout(tooltipTimeout);\n\t\t\ttooltipTimeout = setTimeout(() => {\n\t\t\t\tshowTooltip = false;\n\t\t\t}, 50) as unknown as number;\n\t\t} else if (tooltipTimeout) {\n\t\t\tclearTimeout(tooltipTimeout);\n\t\t\ttooltipTimeout = null;\n\t\t}\n\t});\n\n\tfunction handleMouseEnter() {\n\t\tisHoveringTrigger = true;\n\t}\n\n\tfunction handleMouseLeave() {\n\t\tisHoveringTrigger = false;\n\t}\n\n\tfunction handleTooltipMouseEnter() {\n\t\tisHoveringTooltip = true;\n\t}\n\n\tfunction handleTooltipMouseLeave() {\n\t\tisHoveringTooltip = false;\n\t}\n\n\tfunction getTokenDisplayName(token: TokenData): string {\n\t\tif (token.isNative) {\n\t\t\treturn token.name;\n\t\t}\n\t\treturn token.alias || token.name;\n\t}\n\n\t// Manual refresh with debouncing (Pro users only)\n\tasync function handleManualRefresh() {\n\t\tif (!isBasicMember && !isManualRefreshing) {\n\t\t\tconst now = Date.now();\n\t\t\tconst timeSinceLastRefresh = now - lastManualRefresh;\n\t\t\tconst minInterval = 15000; // 15 seconds minimum between manual refreshes\n\n\t\t\tif (timeSinceLastRefresh < minInterval) {\n\t\t\t\trefreshCooldown = Math.ceil((minInterval - timeSinceLastRefresh) / 1000);\n\t\t\t\tconst cooldownInterval = setInterval(() => {\n\t\t\t\t\trefreshCooldown--;\n\t\t\t\t\tif (refreshCooldown <= 0) {\n\t\t\t\t\t\tclearInterval(cooldownInterval);\n\t\t\t\t\t}\n\t\t\t\t}, 1000);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tisManualRefreshing = true;\n\t\t\tlastManualRefresh = now;\n\t\t\t\n\t\t\ttry {\n\t\t\t\t// Force refresh of token data\n\t\t\t\t// This would trigger a refresh of yakklCombinedTokenStore and pricing data\n\t\t\t\tlog.debug('Manual portfolio refresh triggered', false);\n\t\t\t\t\n\t\t\t\t// Simulate refresh time\n\t\t\t\tawait new Promise(resolve => setTimeout(resolve, 1000));\n\t\t\t\t\n\t\t\t\t// The reactive tokenTotals store will automatically update\n\t\t\t\tlastUpdated = new Date().toLocaleTimeString();\n\t\t\t\t\n\t\t\t} catch (error) {\n\t\t\t\tlog.error('Manual refresh failed:', false, error);\n\t\t\t} finally {\n\t\t\t\tisManualRefreshing = false;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Check if manual refresh is available\n\tconst canManualRefresh = $derived(() => {\n\t\tif (isBasicMember || isManualRefreshing) return false;\n\t\tconst timeSinceLastRefresh = Date.now() - lastManualRefresh;\n\t\treturn timeSinceLastRefresh >= 15000; // 15 seconds cooldown\n\t});\n</script>\n\n<div class=\"relative inline-block {className}\">\n\t<!-- Main Portfolio Display -->\n\t<div\n\t\tclass=\"group cursor-pointer\"\n\t\trole=\"button\"\n\t\ttabindex=\"0\"\n\t\tonmouseenter={handleMouseEnter}\n\t\tonmouseleave={handleMouseLeave}\n\t\tonfocus={handleMouseEnter}\n\t\tonblur={handleMouseLeave}\n\t>\n\t\t<div class=\"flex items-center gap-2 p-3 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105\">\n\t\t\t<!-- Portfolio Icon -->\n\t\t\t<div class=\"flex-shrink-0\">\n\t\t\t\t<svg class=\"w-5 h-5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1\"></path>\n\t\t\t\t</svg>\n\t\t\t</div>\n\n\t\t\t<!-- Portfolio Value -->\n\t\t\t<div class=\"flex-1 min-w-0\">\n\t\t\t\t<div class=\"text-white text-sm font-medium opacity-90\">Total Portfolio</div>\n\t\t\t\t<div class=\"text-white text-lg font-bold\">\n\t\t\t\t\t{#if isCalculating}\n\t\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<div class=\"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent\"></div>\n\t\t\t\t\t\t\t<span class=\"text-sm\">Calculating...</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{:else if error}\n\t\t\t\t\t\t<span class=\"text-red-200 text-sm\">Error</span>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<ProtectedValue\n\t\t\t\t\t\t\tvalue={currencyFormatter ? currencyFormatter.format(totalPortfolioValue) : `$${totalPortfolioValue.toFixed(2)}`}\n\t\t\t\t\t\t\tplaceholder=\"*****\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<!-- Auto-refresh indicator -->\n\t\t\t{#if hasInitialLoad && !isCalculating}\n\t\t\t\t<div class=\"flex-shrink-0\">\n\t\t\t\t\t<SimpleTooltip content={isBasicMember ? \"Auto-refreshes every 5 minutes\" : \"Auto-refreshes every minute\"}>\n\t\t\t\t\t\t<div class=\"text-white/80 p-1 flex items-center gap-1\">\n\t\t\t\t\t\t\t<div class=\"w-2 h-2 bg-green-400 rounded-full animate-pulse\"></div>\n\t\t\t\t\t\t\t<span class=\"text-xs\">Auto</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</SimpleTooltip>\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t<!-- Last Updated Indicator -->\n\t\t\t{#if lastUpdated && !isCalculating}\n\t\t\t\t<div class=\"flex-shrink-0 text-white text-xs opacity-75\">\n\t\t\t\t\t{lastUpdated}\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t<!-- Manual Refresh Button (Pro users only) -->\n\t\t\t{#if !isBasicMember}\n\t\t\t\t<div class=\"flex-shrink-0\">\n\t\t\t\t\t<SimpleTooltip content={refreshCooldown > 0 ? `Wait ${refreshCooldown}s before next refresh` : canManualRefresh ? \"Manual refresh (Pro feature)\" : \"Refreshing...\"}>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tonclick={handleManualRefresh}\n\t\t\t\t\t\t\tdisabled={!canManualRefresh}\n\t\t\t\t\t\t\tclass=\"p-1 text-white/80 hover:text-white hover:bg-white/10 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if isManualRefreshing}\n\t\t\t\t\t\t\t\t<div class=\"animate-spin w-3 h-3 border border-white border-t-transparent rounded-full\"></div>\n\t\t\t\t\t\t\t{:else if refreshCooldown > 0}\n\t\t\t\t\t\t\t\t<span class=\"text-xs font-medium\">{refreshCooldown}</span>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</SimpleTooltip>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n\n\t<!-- Detailed Tooltip -->\n\t{#if showTooltip && portfolioBreakdown.length > 0}\n\t\t<div \n\t\t\tclass=\"absolute z-50 w-80 p-4 mt-2 bg-white rounded-lg shadow-xl border border-gray-200 left-0 top-full\"\n\t\t\trole=\"tooltip\"\n\t\t\taria-label=\"Portfolio breakdown details\"\n\t\t\tonmouseenter={handleTooltipMouseEnter}\n\t\t\tonmouseleave={handleTooltipMouseLeave}\n\t\t>\n\t\t\t<div class=\"space-y-3\">\n\t\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t\t<h3 class=\"text-lg font-semibold text-gray-900\">Portfolio Breakdown</h3>\n\t\t\t\t\t<span class=\"text-sm text-gray-500\">Updated: {lastUpdated}</span>\n\t\t\t\t</div>\n\n\t\t\t\t{#if error}\n\t\t\t\t\t<div class=\"text-red-600 text-sm\">{error}</div>\n\t\t\t\t{:else if isBasicMember}\n\t\t\t\t\t<!-- Basic Member: Show all tokens with values only (no percentages or analytics) -->\n\t\t\t\t\t<div class=\"space-y-2 max-h-60 overflow-y-auto\">\n\t\t\t\t\t\t{#each portfolioBreakdown as item}\n\t\t\t\t\t\t\t<div class=\"flex items-center justify-between p-2 bg-gray-50 rounded\">\n\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-3\">\n\t\t\t\t\t\t\t\t\t{#if item.token.logoURI}\n\t\t\t\t\t\t\t\t\t\t<img src={item.token.logoURI} alt={item.token.symbol} class=\"w-6 h-6 rounded-full\" />\n\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t<div class=\"w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center text-xs font-bold text-gray-600\">\n\t\t\t\t\t\t\t\t\t\t\t{item.token.symbol.charAt(0)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"font-medium text-gray-900\">{item.token.symbol}</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"text-sm text-gray-500\">{getTokenDisplayName(item.token)}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"text-right\">\n\t\t\t\t\t\t\t\t\t<div class=\"font-medium text-gray-900\">\n\t\t\t\t\t\t\t\t\t\t<ProtectedValue\n\t\t\t\t\t\t\t\t\t\t\tvalue={currencyFormatter ? currencyFormatter.format(item.value) : `$${item.value.toFixed(2)}`}\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"*****\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"text-sm text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t<!-- Skeleton with question mark for Basic users -->\n\t\t\t\t\t\t\t\t\t\t<SimpleTooltip content=\"Upgrade to Pro to see portfolio percentages, yield opportunities, and advanced analytics\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-1 cursor-help\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"w-8 h-3 bg-gray-200 rounded animate-pulse\"></div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"w-3 h-3 bg-gradient-to-r from-indigo-400 to-purple-400 rounded-full flex items-center justify-center hover:from-indigo-500 hover:to-purple-500 transition-colors\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<svg class=\"w-2 h-2 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path fill-rule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clip-rule=\"evenodd\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</SimpleTooltip>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<!-- Total for Basic users -->\n\t\t\t\t\t<div class=\"pt-2 border-t border-gray-200\">\n\t\t\t\t\t\t<div class=\"flex justify-between items-center mb-2\">\n\t\t\t\t\t\t\t<span class=\"font-semibold text-gray-900\">Total</span>\n\t\t\t\t\t\t\t<span class=\"font-bold text-lg text-gray-900\">\n\t\t\t\t\t\t\t\t<ProtectedValue\n\t\t\t\t\t\t\t\t\tvalue={currencyFormatter ? currencyFormatter.format(totalPortfolioValue) : `$${totalPortfolioValue.toFixed(2)}`}\n\t\t\t\t\t\t\t\t\tplaceholder=\"*****\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div class=\"p-3 bg-gradient-to-r from-indigo-50 to-purple-50 border border-indigo-200 rounded-lg\">\n\t\t\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<svg class=\"w-4 h-4 text-indigo-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n\t\t\t\t\t\t\t\t\t<path fill-rule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clip-rule=\"evenodd\" />\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t<div class=\"text-xs\">\n\t\t\t\t\t\t\t\t\t<div class=\"font-medium text-indigo-900\">Upgrade for full analytics</div>\n\t\t\t\t\t\t\t\t\t<div class=\"text-indigo-700\">Portfolio percentages, yield opportunities, risk analysis & more</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{:else}\n\t\t\t\t\t<!-- Pro Member: Show full breakdown -->\n\t\t\t\t\t<div class=\"space-y-2 max-h-60 overflow-y-auto\">\n\t\t\t\t\t\t{#each portfolioBreakdown as item}\n\t\t\t\t\t\t\t<div class=\"flex items-center justify-between p-2 bg-gray-50 rounded\">\n\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-3\">\n\t\t\t\t\t\t\t\t\t{#if item.token.logoURI}\n\t\t\t\t\t\t\t\t\t\t<img src={item.token.logoURI} alt={item.token.symbol} class=\"w-6 h-6 rounded-full\" />\n\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t<div class=\"w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center text-xs font-bold text-gray-600\">\n\t\t\t\t\t\t\t\t\t\t\t{item.token.symbol.charAt(0)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"font-medium text-gray-900\">{item.token.symbol}</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"text-sm text-gray-500\">{getTokenDisplayName(item.token)}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"text-right\">\n\t\t\t\t\t\t\t\t\t<div class=\"font-medium text-gray-900\">\n\t\t\t\t\t\t\t\t\t\t<ProtectedValue\n\t\t\t\t\t\t\t\t\t\t\tvalue={currencyFormatter ? currencyFormatter.format(item.value) : `$${item.value.toFixed(2)}`}\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"*****\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"text-sm text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t<ProtectedValue\n\t\t\t\t\t\t\t\t\t\t\tvalue={percentFormatter.format(item.percentage)}\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"****\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"pt-2 border-t border-gray-200\">\n\t\t\t\t\t\t<div class=\"flex justify-between items-center\">\n\t\t\t\t\t\t\t<span class=\"font-semibold text-gray-900\">Total</span>\n\t\t\t\t\t\t\t<span class=\"font-bold text-lg text-gray-900\">\n\t\t\t\t\t\t\t\t<ProtectedValue\n\t\t\t\t\t\t\t\t\tvalue={currencyFormatter ? currencyFormatter.format(totalPortfolioValue) : `$${totalPortfolioValue.toFixed(2)}`}\n\t\t\t\t\t\t\t\t\tplaceholder=\"*****\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"text-sm text-gray-500 mt-1\">\n\t\t\t\t\t\t\t{portfolioBreakdown.length} asset{portfolioBreakdown.length === 1 ? '' : 's'} included\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n\n\t<!-- Optional detailed view -->\n\t{#if showDetails}\n\t\t<div class=\"mt-4 space-y-2\">\n\t\t\t{#each portfolioBreakdown as item}\n\t\t\t\t<div class=\"flex items-center justify-between p-2 bg-gray-100 rounded\">\n\t\t\t\t\t<span class=\"font-medium\">{item.token.symbol}</span>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t<ProtectedValue\n\t\t\t\t\t\t\tvalue={currencyFormatter ? currencyFormatter.format(item.value) : `$${item.value.toFixed(2)}`}\n\t\t\t\t\t\t\tplaceholder=\"*****\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t{/each}\n\t\t</div>\n\t{/if}\n</div>\n\n<style>\n\t/* Custom animations */\n\t@keyframes pulse-glow {\n\t\t0%, 100% {\n\t\t\tbox-shadow: 0 0 5px rgba(99, 102, 241, 0.3);\n\t\t}\n\t\t50% {\n\t\t\tbox-shadow: 0 0 20px rgba(99, 102, 241, 0.6), 0 0 30px rgba(99, 102, 241, 0.3);\n\t\t}\n\t}\n\n\t.group:hover {\n\t\tanimation: pulse-glow 2s infinite;\n\t}\n</style>\n","<script lang=\"ts\">\n\timport { goto } from '$app/navigation';\n\timport { SpeedDial, SpeedDialButton } from 'flowbite-svelte';\n\timport {\n\t\tyakklPricingStore,\n\t\tsetYakklCurrentlySelectedStorage,\n\t\tgetYakklCurrentlySelected,\n\t\tgetMiscStore,\n\t\tyakklMiscStore,\n\t\tyakklCurrentlySelectedStore,\n\t\tyakklAccountsStore,\n\t\tyakklCombinedTokenStore\n\t} from '$lib/common/stores';\n\timport { PATH_LOGOUT } from '$lib/common/constants';\n\timport { onDestroy, onMount } from 'svelte';\n\timport { truncate } from '$lib/utilities/utilities';\n\timport { encryptData, decryptData } from '$lib/common/encryption';\n\timport { checkPricesCallback, startPricingChecks, stopCheckPrices } from '$lib/tokens/prices';\n\timport ErrorNoAction from '$lib/components/ErrorNoAction.svelte';\n\timport {\n\t\tNetworkType,\n\t\tgetInstances,\n\t\tisEncryptedData,\n\t\ttype CurrentlySelectedData,\n\t\ttype Network,\n\t\ttype TokenData,\n\t\ttype YakklAccount,\n\t\ttype YakklWatch\n\t} from '$lib/common';\n\timport type { BigNumberish } from '$lib/common/bignumber';\n\timport { Wallet } from '$lib/managers/Wallet';\n\timport { EthereumBigNumber } from '$lib/common/bignumber-ethereum';\n\timport Accounts from './Accounts.svelte';\n\timport Contacts from './Contacts.svelte';\n\timport TokensEnhanced from './TokensEnhanced.svelte';\n\timport Receive from './Receive.svelte';\n\timport ImportPrivateKey from './ImportPrivateKey.svelte';\n\timport ImportWatchAccount from './ImportWatchAccount.svelte';\n\timport Upgrade from './Upgrade.svelte';\n\timport type { Blockchain } from '$lib/managers/Blockchain';\n\timport type { TokenService } from '$lib/managers/blockchains/evm/TokenService';\n\timport type { Provider } from '$lib/managers/Provider';\n\timport type { Settings } from '$lib/common/interfaces';\n\timport EyeIcon from './icons/EyeIcon.svelte';\n\timport ProtectedValue from './ProtectedValue.svelte';\n\timport { tokenTotals } from '$lib/common/stores/tokenTotals'; // Used to display portfolio value in html below\n\timport { browserSvelte, browser_ext } from '$lib/common/environment';\n\timport { log } from '$lib/managers/Logger';\n\timport Copy from './Copy.svelte';\n\timport { updateTokenPrices } from '$lib/common/tokenPriceManager';\n\timport { getSettings } from '$lib/common/stores';\n\timport { PlanType, RegisteredType } from '$lib/common/types';\n\timport { balanceCacheManager } from '$lib/managers/BalanceCacheManager';\n\timport { accountTokenCacheManager } from '$lib/managers/AccountTokenCacheManager';\n\timport SkeletonBalance from './SkeletonBalance.svelte';\n\timport TokensIcon from './icons/TokensIcon.svelte';\n\timport PortfolioTotal from './PortfolioTotal.svelte';\n\timport SimpleTooltip from './SimpleTooltip.svelte';\n\timport { shouldShowProFeatures } from '$lib/common/token-analytics';\n\n\t// Helper function to determine if an error should be shown to the user\n\tfunction shouldShowErrorToUser(error: any): boolean {\n\t\tconst errorMessage = error?.message || error?.toString() || '';\n\n\t\t// Network/API errors that should be handled silently\n\t\tconst networkErrors = [\n\t\t\t'missing response',\n\t\t\t'timeout',\n\t\t\t'TIMEOUT',\n\t\t\t'SERVER_ERROR',\n\t\t\t'NETWORK_ERROR',\n\t\t\t'Failed to fetch',\n\t\t\t'fetch',\n\t\t\t'Connection failed',\n\t\t\t'Request timeout',\n\t\t\t'eth_getBalance',\n\t\t\t'call revert exception',\n\t\t\t'alchemy.com',\n\t\t\t'infura.io',\n\t\t\t'requestBody',\n\t\t\t'serverError',\n\t\t\t'code=SERVER_ERROR',\n\t\t\t'version=web/',\n\t\t\t'JsonRpcError',\n\t\t\t'RPC Error'\n\t\t];\n\n\t\treturn !networkErrors.some((pattern) =>\n\t\t\terrorMessage.toLowerCase().includes(pattern.toLowerCase())\n\t\t);\n\t}\n\n\t// Safely show an error with cooldown to prevent loops\n\tfunction showErrorSafely(errorMsg: any): void {\n\t\tif (errorCooldown) return; // Don't show if in cooldown\n\n\t\tif (shouldShowErrorToUser(errorMsg)) {\n\t\t\terrorValue = errorMsg as string;\n\t\t\terror = true;\n\n\t\t\t// Set cooldown to prevent rapid successive errors\n\t\t\terrorCooldown = true;\n\t\t\tsetTimeout(() => {\n\t\t\t\terrorCooldown = false;\n\t\t\t}, 3000); // 3 second cooldown\n\t\t}\n\t}\n\n\t// Manual refresh with debouncing (Pro users only)\n\tasync function handleManualRefresh() {\n\t\tif (isProUser && !isManualRefreshing) {\n\t\t\tconst now = Date.now();\n\t\t\tconst timeSinceLastRefresh = now - lastManualRefresh;\n\t\t\tconst minInterval = 15000; // 15 seconds minimum between manual refreshes\n\n\t\t\tif (timeSinceLastRefresh < minInterval) {\n\t\t\t\trefreshCooldown = Math.ceil((minInterval - timeSinceLastRefresh) / 1000);\n\t\t\t\tconst cooldownInterval = setInterval(() => {\n\t\t\t\t\trefreshCooldown--;\n\t\t\t\t\tif (refreshCooldown <= 0) {\n\t\t\t\t\t\tclearInterval(cooldownInterval);\n\t\t\t\t\t}\n\t\t\t\t}, 1000);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tisManualRefreshing = true;\n\t\t\tlastManualRefresh = now;\n\t\t\t\n\t\t\ttry {\n\t\t\t\tlog.debug('Manual Card refresh triggered', false);\n\t\t\t\t\n\t\t\t\t// Force refresh of token data and prices\n\t\t\t\tawait checkPricesCallback();\n\t\t\t\tawait updateTokenPrices();\n\t\t\t\t\n\t\t\t\t// Refresh balance and account data\n\t\t\t\tawait updateWithCurrentlySelected();\n\t\t\t\t\n\t\t\t} catch (error) {\n\t\t\t\tlog.error('Manual Card refresh failed:', false, error);\n\t\t\t\tshowErrorSafely('Failed to refresh data');\n\t\t\t} finally {\n\t\t\t\tisManualRefreshing = false;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Check if manual refresh is available\n\tconst canManualRefresh = $derived(() => {\n\t\tif (!isProUser || isManualRefreshing) return false;\n\t\tconst timeSinceLastRefresh = Date.now() - lastManualRefresh;\n\t\treturn timeSinceLastRefresh >= 15000; // 15 seconds cooldown\n\t});\n\n\tinterface Props {\n\t\tid?: string;\n\t}\n\n\tlet { id = 'card' }: Props = $props();\n\n\tlet wallet: Wallet | null = null;\n\tlet provider: Provider | null = null;\n\tlet blockchain: Blockchain | null = null;\n\tlet tokenService: TokenService<any> | null = null;\n\n\t// Pull this from the store later\n\tlet networks: Network[] = [\n\t\t{\n\t\t\tblockchain: 'Ethereum',\n\t\t\tname: 'Mainnet',\n\t\t\tchainId: 1,\n\t\t\tsymbol: 'ETH',\n\t\t\ttype: NetworkType.MAINNET,\n\t\t\texplorer: 'https://etherscan.io',\n\t\t\tdecimals: 18\n\t\t},\n\t\t{\n\t\t\tblockchain: 'Ethereum',\n\t\t\tname: 'Sepolia',\n\t\t\tchainId: 11155111,\n\t\t\tsymbol: 'ETH',\n\t\t\ttype: NetworkType.TESTNET,\n\t\t\texplorer: 'https://sepolia.etherscan.io',\n\t\t\tdecimals: 18\n\t\t}\n\t];\n\n\tlet network: Network = $state(networks[0]);\n\tlet networkLabel = $state('Mainnet');\n\tlet addressShow: string = $state('Loading...');\n\tlet address: string = $state('');\n\tlet name: string = $state('Loading...');\n\tlet nameShow: string = $state('Loading...');\n\tlet valueFiat = $state('0.00');\n\tlet showAccountsModal = $state(false);\n\tlet showAccountImportModal = $state(false);\n\tlet showWatchAccountModal = $state(false);\n\tlet showContacts = $state(false);\n\tlet showTokens = $state(false);\n\tlet showRecv = $state(false);\n\tlet showUpgradeModal = $state(false);\n\n\tlet price: number = 0;\n\tlet prevPrice: number = 0;\n\tlet direction: string = $state('fl');\n\tlet showTestNetworks = true;\n\tlet error = $state(false);\n\tlet errorValue: string = $state('');\n\tlet errorCooldown = $state(false); // Prevent rapid error modal loops\n\tlet assetPriceValue: BigNumberish = $state(0n);\n\tlet assetPrice: string = $state('');\n\tlet card = 'background_gradient_2.png'; //'ethereum-background.png';\n\n\t// Use reactive store instead of one-time value\n\tlet symbolLabel: string = $state('');\n\t\n\t// Pro user check and manual refresh state\n\tlet isProUser = $state(false);\n\tlet isManualRefreshing = $state(false);\n\tlet lastManualRefresh = $state(0);\n\tlet refreshCooldown = $state(0);\n\tlet currencyLabel: string = $state('');\n\tlet currency: Intl.NumberFormat = $state();\n\tlet shortcutsValue: EthereumBigNumber = $state(EthereumBigNumber.from(0)); // .quantity is the amount of a given token the address holds\n\tlet chainId: number = $state(1);\n\tlet formattedEtherValue: string = $state('');\n\tlet isDropdownOpen = $state(false);\n\n\tlet tokens: TokenData[] = [];\n\tlet isCalculatingPortfolio = $state(false);\n\tlet portfolioValue = $state<string>('-----');\n\tlet portfolioCurrency = $state<string>('USD');\n\n\tlet settings = $state<Settings | null>(null);\n\tlet planType = $state<PlanType>(PlanType.BASIC_MEMBER);\n\n\t$effect(() => {\n\t\t(async () => {\n\t\t\tif (!isInitialized || !$yakklPricingStore || !$yakklMiscStore) return;\n\n\t\t\tif ($yakklPricingStore.price === $yakklPricingStore.prevPrice) {\n\t\t\t\tlog.info('Price has not changed.');\n\t\t\t\treturn; // No change\n\t\t\t}\n\t\t\tprice = $yakklPricingStore.price ?? 0;\n\t\t\tconst prevPrice = $yakklPricingStore.prevPrice ?? 0;\n\t\t\tlog.info('Price changed:', false, price, prevPrice);\n\t\t\tif (price) {\n\t\t\t\tif (price !== prevPrice) {\n\t\t\t\t\t// Update display values when price changes - don't fetch new balance to prevent loops\n\t\t\t\t\tawait updateWithCurrentlySelected();\n\t\t\t\t\tupdateDisplayValues(); // Calculate and update fiat values with new price\n\t\t\t\t}\n\t\t\t}\n\t\t})();\n\t});\n\n\t$effect(() => {\n\t\tif (!isInitialized || !assetPriceValue) return;\n\n\t\tconst newAssetPrice = currency ? currency.format(Number(assetPriceValue)) : '0.00';\n\t\tif (assetPrice !== newAssetPrice) {\n\t\t\tassetPrice = newAssetPrice; // Only update if the value changes\n\t\t}\n\t});\n\n\t$effect(() => {\n\t\tif (!isInitialized || address) return;\n\n\t\taddress = $yakklCurrentlySelectedStore?.shortcuts?.address ?? '';\n\t});\n\n\t// Track previous address to prevent unnecessary updates\n\tlet previousAddress = $state<string>('');\n\tlet isUpdatingBalance = $state(false);\n\tlet isInitialized = $state(false);\n\tlet initializationTimeout: number | null = null;\n\tlet updateDebounceTimeout: number | null = null;\n\n\t// React to changes in currently selected account\n\t$effect(() => {\n\t\tif (!isInitialized || !$yakklCurrentlySelectedStore || !$yakklMiscStore) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst address = $yakklCurrentlySelectedStore.shortcuts.address;\n\n\t\t// Only update if address actually changed\n\t\tif (address === previousAddress) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Skip all updates during initialization to prevent loops\n\t\tif (!isInitialized) {\n\t\t\treturn;\n\t\t}\n\n\t\tlog.info('[Card] Currently selected account changed, updating card display');\n\t\tpreviousAddress = address;\n\n\t\t// Clear any pending updates to prevent rapid successive calls\n\t\tif (updateDebounceTimeout) {\n\t\t\tclearTimeout(updateDebounceTimeout);\n\t\t}\n\n\t\t// First, load cached data immediately for instant display\n\t\tconst cached = balanceCacheManager.getCachedBalance(address);\n\n\t\tif (cached) {\n\t\t\tlog.info('[Card] Loading cached balance for immediate display');\n\t\t\t// Don't modify the store directly to prevent loops - just update display\n\t\t\tshortcutsValue = EthereumBigNumber.from(cached.balance);\n\t\t\tupdateWithCurrentlySelected();\n\t\t\tupdateDisplayValues(); // Calculate display values with cached balance\n\t\t} else {\n\t\t\t// No cache, update with current store values\n\t\t\tupdateWithCurrentlySelected();\n\t\t\tupdateDisplayValues(); // Calculate display values with current balance\n\t\t}\n\n\t\t// Load cached portfolio value immediately\n\t\tconst cachedPortfolio = accountTokenCacheManager.getCachedPortfolioValue(address);\n\t\tif (cachedPortfolio) {\n\t\t\tportfolioValue = currency\n\t\t\t\t? currency.format(cachedPortfolio.value)\n\t\t\t\t: cachedPortfolio.value.toFixed(2);\n\t\t\tportfolioCurrency = cachedPortfolio.currency;\n\t\t\tlog.debug('[Card] Loaded cached portfolio value:', false, {\n\t\t\t\tvalue: cachedPortfolio.value,\n\t\t\t\tcurrency: cachedPortfolio.currency\n\t\t\t});\n\t\t} else {\n\t\t\t// No cached portfolio, start with loading state\n\t\t\tisCalculatingPortfolio = true;\n\t\t\tportfolioValue = '-----';\n\t\t}\n\n\t\t// Then refresh balance in background if needed\n\t\tif (!cached || balanceCacheManager.isStale(address)) {\n\t\t\tlog.info('[Card] Refreshing balance in background');\n\t\t\trefreshBalanceInBackground();\n\t\t}\n\n\t\t// Refresh portfolio if stale or missing\n\t\tif (!cachedPortfolio || accountTokenCacheManager.isPortfolioValueStale(address)) {\n\t\t\tlog.info('[Card] Refreshing portfolio value in background');\n\t\t\trefreshPortfolioInBackground();\n\t\t}\n\t});\n\n\t$effect.root(() => {\n\t\t// Subscribe to token store updates\n\t\tconst unsubscribeYakklStore = yakklCombinedTokenStore.subscribe((updatedTokens = []) => {\n\t\t\ttokens = updatedTokens; // Only keep the latest tokens up to date\n\n\t\t\t// Only recalculate portfolio if initialized and conditions are met\n\t\t\tif (\n\t\t\t\t!isInitialized ||\n\t\t\t\t!$yakklMiscStore ||\n\t\t\t\t!$yakklCurrentlySelectedStore?.shortcuts?.address ||\n\t\t\t\tupdatedTokens.length === 0 ||\n\t\t\t\tisCalculatingPortfolio\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Debounce portfolio calculations to prevent rapid successive calls\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (isInitialized && !isCalculatingPortfolio) {\n\t\t\t\t\tcalculateAndCachePortfolioValue(\n\t\t\t\t\t\t$yakklCurrentlySelectedStore.shortcuts.address,\n\t\t\t\t\t\tupdatedTokens\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t});\n\n\t\treturn () => {\n\t\t\tunsubscribeYakklStore();\n\t\t};\n\t});\n\n\tonMount(async () => {\n\t\ttry {\n\t\t\tlog.info('[Card] Component mounting...');\n\n\t\t\t// Load settings to check membership\n\t\t\tsettings = await getSettings();\n\t\t\tisProUser = shouldShowProFeatures(settings?.plan?.type || PlanType.BASIC_MEMBER);\n\n\t\t\tif (browserSvelte) {\n\t\t\t\tawait browser_ext.runtime.sendMessage({ type: 'clientReady' }); // Safeguard to ensure the client is ready before sending messages\n\n\t\t\t\t// Add message listener for YAKKL_ACCOUNT\n\t\t\t\t// Come back to this later - this is more cosmetic and not needed for now.\n\t\t\t\t// browser_ext.runtime.onMessage.addListener((message: unknown, sender, sendResponse) => {\n\t\t\t\t//   log.info('YAKKL_ACCOUNT message received', false, message);\n\t\t\t\t//   const typedMessage = message as { type: string; data: YakklAccount };\n\t\t\t\t//   if (typedMessage.type === 'YAKKL_ACCOUNT' && typedMessage.data) {\n\t\t\t\t//     handleAccounts(typedMessage.data);\n\t\t\t\t//     sendResponse({ success: true });\n\t\t\t\t//     log.info('YAKKL_ACCOUNT message sent', false, { success: true });\n\t\t\t\t//   }\n\t\t\t\t//   return true;\n\t\t\t\t// });\n\n\t\t\t\tstartPricingChecks();\n\t\t\t\tawait updateTokenPrices(); // Initial token price update\n\n\t\t\t\t// toastStatus = false;\n\t\t\t\tif (!$yakklCurrentlySelectedStore)\n\t\t\t\t\tyakklCurrentlySelectedStore.set(await getYakklCurrentlySelected());\n\t\t\t\t// Note: yakklMiscStore will be set during authentication via setMiscStore()\n\n\t\t\t\tif ($yakklCurrentlySelectedStore) {\n\t\t\t\t\tconst currentlySelected = $yakklCurrentlySelectedStore;\n\t\t\t\t\tcurrentlySelected.shortcuts.networks = networks;\n\n\t\t\t\t\tcurrencyLabel = currentlySelected.preferences.currency.code ?? 'USD';\n\t\t\t\t\tcurrency = new Intl.NumberFormat('en-US', { style: 'currency', currency: currencyLabel });\n\t\t\t\t\tsymbolLabel = currentlySelected.shortcuts.symbol ?? 'ETH';\n\t\t\t\t\tchainId = currentlySelected.shortcuts.network.chainId ?? 1;\n\n\t\t\t\t\tconst instances = await getInstances();\n\t\t\t\t\tif (instances.length > 0) {\n\t\t\t\t\t\twallet = instances[0];\n\t\t\t\t\t\tprovider = instances[1];\n\t\t\t\t\t\tblockchain = instances[2];\n\t\t\t\t\t\ttokenService = instances[3];\n\n\t\t\t\t\t\tif (wallet && provider && blockchain && tokenService) {\n\t\t\t\t\t\t\ttokenService.updateTokenBalances(currentlySelected.shortcuts.address);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// These are for the initial load and the intervals take over after this\n\t\t\t\t\tconst val = await getBalance(\n\t\t\t\t\t\tcurrentlySelected.shortcuts.network.chainId,\n\t\t\t\t\t\tcurrentlySelected.shortcuts.address\n\t\t\t\t\t);\n\t\t\t\t\tcurrentlySelected.shortcuts.quantity = val ?? 0n;\n\t\t\t\t\tcheckPricesCallback(); // Simple onetime price update for initial load - NOTE: Do not move this up any higher in the code or it will cause a loop. shortcuts.quantity is used in the updateValuePriceFiat function\n\n\t\t\t\t\tawait setYakklCurrentlySelectedStorage(currentlySelected); // This updates the store and local storage\n\n\t\t\t\t\t// Update display immediately\n\t\t\t\t\tupdateWithCurrentlySelected();\n\n\t\t\t\t\tif ($yakklCurrentlySelectedStore.shortcuts.quantity) {\n\t\t\t\t\t\tawait updateValuePriceFiat();\n\t\t\t\t\t\tupdateDisplayValues(); // Ensure display values are calculated\n\t\t\t\t\t}\n\t\t\t\t\t// updateUpgradeButton();\n\t\t\t\t}\n\n\t\t\t\tsettings = await getSettings();\n\t\t\t\tif (settings) {\n\t\t\t\t\tplanType = settings.plan.type as PlanType;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Initialize reactive effects after a short delay to prevent loops during load\n\t\t\tinitializationTimeout = setTimeout(() => {\n\t\t\t\t// Set the previous address to current address to prevent initial trigger\n\t\t\t\tif ($yakklCurrentlySelectedStore?.shortcuts?.address) {\n\t\t\t\t\tpreviousAddress = $yakklCurrentlySelectedStore.shortcuts.address;\n\t\t\t\t}\n\n\t\t\t\tisInitialized = true;\n\t\t\t\tlog.debug('[Card] Reactive effects initialized');\n\t\t\t}, 500) as unknown as number;\n\t\t} catch (e) {\n\t\t\tlog.warn(`onMount: ${e}`);\n\t\t}\n\t});\n\n\t// Effect to update cache when price changes\n\t$effect(() => {\n\t\tif (!isInitialized || !$yakklMiscStore) return;\n\n\t\tconst currentPrice = $yakklPricingStore?.price;\n\t\tif (currentPrice && currentPrice > 0) {\n\t\t\t// Update all cached entries with new price\n\t\t\tbalanceCacheManager.updatePriceForAllEntries(currentPrice);\n\t\t\tlog.debug('[Card] Price changed, updated all cached entries:', false, {\n\t\t\t\tnewPrice: currentPrice\n\t\t\t});\n\t\t}\n\t});\n\n\tasync function updateWithCurrentlySelected() {\n\t\ttry {\n\t\t\tconst { address, accountName, network, quantity } = $yakklCurrentlySelectedStore.shortcuts;\n\n\t\t\taddressShow = truncate(address, 6) + address.substring(address.length - 4);\n\t\t\tname = accountName;\n\t\t\tnameShow = truncate(accountName, 20);\n\t\t\tnetworkLabel = $yakklCurrentlySelectedStore.shortcuts.network.name ?? network.name;\n\t\t\tassetPriceValue = $yakklPricingStore?.price ?? 0;\n\t\t\tcurrencyLabel = $yakklCurrentlySelectedStore.preferences.currency.code ?? 'USD';\n\n\t\t\tshortcutsValue = EthereumBigNumber.from(quantity) ?? EthereumBigNumber.from(0); // .quantity is the amount of a given token the address holds\n\t\t\tchainId = network?.chainId ?? 1;\n\t\t} catch (e) {\n\t\t\tlog.warn(e);\n\t\t}\n\t}\n\n\tonDestroy(async () => {\n\t\tif (initializationTimeout) {\n\t\t\tclearTimeout(initializationTimeout);\n\t\t}\n\t\tif (updateDebounceTimeout) {\n\t\t\tclearTimeout(updateDebounceTimeout);\n\t\t}\n\t\tif ($yakklCurrentlySelectedStore) {\n\t\t\tawait setYakklCurrentlySelectedStorage($yakklCurrentlySelectedStore);\n\t\t}\n\t\tstopCheckPrices();\n\t});\n\n\tfunction toggleDropdown() {\n\t\tisDropdownOpen = !isDropdownOpen;\n\t}\n\n\tasync function refreshBalanceInBackground() {\n\t\ttry {\n\t\t\tif (!$yakklCurrentlySelectedStore || !wallet || isUpdatingBalance) return;\n\n\t\t\tisUpdatingBalance = true;\n\t\t\tconst address = $yakklCurrentlySelectedStore.shortcuts.address;\n\t\t\tconst chainId = $yakklCurrentlySelectedStore.shortcuts.network.chainId;\n\n\t\t\t// Get fresh balance\n\t\t\tconst freshBalance = await getBalance(chainId, address);\n\t\t\tif (freshBalance && freshBalance !== $yakklCurrentlySelectedStore.shortcuts.quantity) {\n\t\t\t\t// Update cache\n\t\t\t\tbalanceCacheManager.setCachedBalance(address, freshBalance, $yakklPricingStore?.price ?? 0);\n\n\t\t\t\t// Update store using .update() method to prevent direct mutation\n\t\t\t\tyakklCurrentlySelectedStore.update((current) => ({\n\t\t\t\t\t...current,\n\t\t\t\t\tshortcuts: { ...current.shortcuts, quantity: freshBalance }\n\t\t\t\t}));\n\n\t\t\t\t// Update display without calling updateValuePriceFiat to prevent loop\n\t\t\t\tupdateWithCurrentlySelected();\n\n\t\t\t\tlog.info('[Card] Background balance refresh completed');\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tlog.warn('[Card] Background balance refresh failed:', false, error);\n\t\t\t// Don't show errors for background refreshes\n\t\t} finally {\n\t\t\tisUpdatingBalance = false;\n\t\t}\n\t}\n\n\tasync function refreshPortfolioInBackground() {\n\t\ttry {\n\t\t\tif (!$yakklCurrentlySelectedStore) return;\n\n\t\t\tconst address = $yakklCurrentlySelectedStore.shortcuts.address;\n\t\t\tisCalculatingPortfolio = true;\n\n\t\t\t// Get current tokens for this account (from cache or fresh)\n\t\t\tlet accountTokens = accountTokenCacheManager.getCachedTokensForAccount(address);\n\n\t\t\tif (!accountTokens || accountTokens.length === 0) {\n\t\t\t\t// Fall back to current tokens if no cached account-specific tokens\n\t\t\t\taccountTokens = tokens;\n\t\t\t}\n\n\t\t\tawait calculateAndCachePortfolioValue(address, accountTokens);\n\t\t} catch (error) {\n\t\t\tlog.warn('[Card] Background portfolio refresh failed:', false, error);\n\t\t\tisCalculatingPortfolio = false;\n\t\t\tportfolioValue = '-----';\n\t\t}\n\t}\n\n\tasync function calculateAndCachePortfolioValue(\n\t\taddress: string,\n\t\ttokenList: TokenData[]\n\t): Promise<void> {\n\t\ttry {\n\t\t\tisCalculatingPortfolio = true;\n\t\t\tlet totalValue = 0;\n\n\t\t\t// Calculate total portfolio value\n\t\t\tfor (const token of tokenList) {\n\t\t\t\tif (token.balance && token.price?.price) {\n\t\t\t\t\tlet balanceNum: number;\n\n\t\t\t\t\tif (typeof token.balance === 'bigint') {\n\t\t\t\t\t\t// Convert from wei to token units\n\t\t\t\t\t\tbalanceNum = Number(token.balance) / Math.pow(10, token.decimals || 18);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbalanceNum = Number(token.balance);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst tokenValue = balanceNum * token.price.price;\n\t\t\t\t\ttotalValue += tokenValue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Add native token value (ETH balance)\n\t\t\tif ($yakklCurrentlySelectedStore?.shortcuts?.quantity && $yakklPricingStore?.price) {\n\t\t\t\tconst ethValue =\n\t\t\t\t\tparseFloat(formatEther($yakklCurrentlySelectedStore.shortcuts.quantity)) *\n\t\t\t\t\t$yakklPricingStore.price;\n\t\t\t\ttotalValue += ethValue;\n\t\t\t}\n\n\t\t\t// Cache the portfolio value\n\t\t\tconst currencyCode = $yakklCurrentlySelectedStore?.preferences?.currency?.code ?? 'USD';\n\t\t\taccountTokenCacheManager.setCachedPortfolioValue(address, totalValue, currencyCode);\n\n\t\t\t// Update display\n\t\t\tportfolioValue = currency ? currency.format(totalValue) : totalValue.toFixed(2);\n\t\t\tportfolioCurrency = currencyCode;\n\t\t\tisCalculatingPortfolio = false;\n\n\t\t\tlog.info('[Card] Portfolio value calculated and cached:', false, {\n\t\t\t\taddress,\n\t\t\t\tvalue: totalValue,\n\t\t\t\tcurrency: currencyCode,\n\t\t\t\ttokenCount: tokenList.length\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tlog.warn('[Card] Error calculating portfolio value:', false, error);\n\t\t\tisCalculatingPortfolio = false;\n\t\t\tportfolioValue = '-----';\n\t\t}\n\t}\n\n\tasync function updateValuePriceFiat(): Promise<void> {\n\t\ttry {\n\t\t\tif (!$yakklCurrentlySelectedStore || isUpdatingBalance) {\n\t\t\t\tlog.warn('No currently selected account or already updating balance.');\n\t\t\t\tresetPriceData();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tisUpdatingBalance = true;\n\t\t\tlet { address, quantity, network } = $yakklCurrentlySelectedStore.shortcuts;\n\n\t\t\t// Avoid unnecessary balance fetch\n\t\t\tconst qty = await getBalance(network.chainId, address);\n\t\t\tif ($yakklCurrentlySelectedStore.shortcuts.quantity !== qty) {\n\t\t\t\t// Update the quantity field directly, not value to avoid loop\n\t\t\t\tyakklCurrentlySelectedStore.update((current) => ({\n\t\t\t\t\t...current,\n\t\t\t\t\tshortcuts: { ...current.shortcuts, quantity: qty ?? 0n }\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\t// Update cache with new balance and current price\n\t\t\tif (qty && $yakklPricingStore?.price) {\n\t\t\t\tbalanceCacheManager.setCachedBalance(address, qty, $yakklPricingStore.price);\n\t\t\t\tlog.info('[Card] Updated cache with new balance/price:', false, {\n\t\t\t\t\taddress,\n\t\t\t\t\tbalance: qty.toString(),\n\t\t\t\t\tprice: $yakklPricingStore.price\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Update fiat and ether values only if necessary\n\t\t\tconst price = EthereumBigNumber.from($yakklPricingStore?.price ?? 0);\n\t\t\tif ($yakklCurrentlySelectedStore.shortcuts.quantity !== price) {\n\t\t\t\tconst etherValue = parseFloat(\n\t\t\t\t\tformatEther($yakklCurrentlySelectedStore.shortcuts.quantity ?? 0n)\n\t\t\t\t);\n\n\t\t\t\tif (!isNaN(etherValue) && $yakklPricingStore?.price) {\n\t\t\t\t\tconst fiatValue = etherValue * $yakklPricingStore.price;\n\t\t\t\t\tconst etherValueString = etherValue.toFixed(5);\n\t\t\t\t\tif (formattedEtherValue !== etherValueString) {\n\t\t\t\t\t\tformattedEtherValue = etherValueString;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst newFiatValue = currency ? currency.format(fiatValue) : '0.00';\n\t\t\t\t\tif (valueFiat !== newFiatValue) {\n\t\t\t\t\t\tvalueFiat = newFiatValue;\n\t\t\t\t\t}\n\n\t\t\t\t\tupdatePriceDirection($yakklPricingStore.price);\n\t\t\t\t} else {\n\t\t\t\t\tresetPriceData();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlog.info('updateValuePriceFiat - Value NOT updated.');\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tlog.warn('Error in updateValuePriceFiat:', false, error);\n\t\t\tresetPriceData();\n\t\t} finally {\n\t\t\tisUpdatingBalance = false;\n\t\t}\n\t}\n\n\tfunction setDefaultsForZeroAddress() {\n\t\ttry {\n\t\t\t// Dont want to trigger reactivity if the value is zero unless the previous value was something other than 0\n\t\t\tif (yakklCurrentlySelectedStore && $yakklCurrentlySelectedStore.shortcuts?.quantity !== 0n) {\n\t\t\t\tyakklCurrentlySelectedStore.update((current) => ({\n\t\t\t\t\t...current,\n\t\t\t\t\tshortcuts: { ...current.shortcuts, value: EthereumBigNumber.from(0) }\n\t\t\t\t}));\n\t\t\t}\n\t\t\tresetPriceData();\n\t\t} catch (e) {\n\t\t\tlog.warn(e);\n\t\t}\n\t}\n\n\tfunction updatePriceDirection(newPrice: number) {\n\t\tif (prevPrice > newPrice) {\n\t\t\tdirection = 'dn'; // down\n\t\t} else if (prevPrice < newPrice) {\n\t\t\tdirection = 'up'; // up\n\t\t} else {\n\t\t\tdirection = 'fl'; // flat\n\t\t}\n\t\tprevPrice = newPrice;\n\t}\n\n\tfunction resetPriceData() {\n\t\tvalueFiat = '0.00';\n\t\tformattedEtherValue = '0.00000';\n\t\tdirection = 'fl'; // flat\n\t}\n\n\t// Calculate display values without fetching fresh data (safe for reactive contexts)\n\tfunction updateDisplayValues() {\n\t\ttry {\n\t\t\tif (!$yakklCurrentlySelectedStore || !$yakklPricingStore?.price) {\n\t\t\t\tresetPriceData();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst quantity = $yakklCurrentlySelectedStore.shortcuts.quantity ?? 0n;\n\t\t\tconst etherValue = parseFloat(formatEther(quantity));\n\n\t\t\tif (!isNaN(etherValue) && $yakklPricingStore?.price) {\n\t\t\t\tconst fiatValue = etherValue * $yakklPricingStore.price;\n\t\t\t\tconst etherValueString = etherValue.toFixed(5);\n\n\t\t\t\tif (formattedEtherValue !== etherValueString) {\n\t\t\t\t\tformattedEtherValue = etherValueString;\n\t\t\t\t}\n\n\t\t\t\tconst newFiatValue = currency ? currency.format(fiatValue) : '0.00';\n\t\t\t\tif (valueFiat !== newFiatValue) {\n\t\t\t\t\tvalueFiat = newFiatValue;\n\t\t\t\t}\n\n\t\t\t\tupdatePriceDirection($yakklPricingStore.price);\n\t\t\t} else {\n\t\t\t\tresetPriceData();\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tlog.warn('Error in updateDisplayValues:', false, error);\n\t\t\tresetPriceData();\n\t\t}\n\t}\n\n\tasync function handleAccounts(account: YakklAccount): Promise<void> {\n\t\ttry {\n\t\t\tif (!account) {\n\t\t\t\tlog.warn('Account is not defined.');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet updatedCurrentlySelected = $yakklCurrentlySelectedStore;\n\n\t\t\tif (updatedCurrentlySelected && isEncryptedData(updatedCurrentlySelected.data)) {\n\t\t\t\tif (!$yakklMiscStore) {\n\t\t\t\t\tlog.warn('Cannot decrypt data: yakklMiscStore is not available');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tupdatedCurrentlySelected.data = (await decryptData(\n\t\t\t\t\tupdatedCurrentlySelected.data,\n\t\t\t\t\t$yakklMiscStore\n\t\t\t\t)) as CurrentlySelectedData;\n\t\t\t}\n\n\t\t\t// Try to get cached balance first, fallback to fresh fetch\n\t\t\tlet balance: bigint;\n\t\t\tconst cached = balanceCacheManager.getCachedBalance(account.address);\n\t\t\tif (cached) {\n\t\t\t\tbalance = cached.balance;\n\t\t\t\tlog.info('[Card] Using cached balance for account selection:', false, {\n\t\t\t\t\taddress: account.address,\n\t\t\t\t\tbalance: balance.toString()\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\ttry {\n\t\t\t\t\tbalance = await getBalance(chainId ?? 1, account.address);\n\t\t\t\t\tlog.info('[Card] Fetched fresh balance for account selection:', false, {\n\t\t\t\t\t\taddress: account.address,\n\t\t\t\t\t\tbalance: balance.toString()\n\t\t\t\t\t});\n\t\t\t\t} catch (error) {\n\t\t\t\t\tlog.warn('[Card] Failed to get balance, using 0:', false, error);\n\t\t\t\t\tbalance = 0n;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!$yakklMiscStore) {\n\t\t\t\tlog.warn('Cannot encrypt data: yakklMiscStore is not available');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tupdatedCurrentlySelected = {\n\t\t\t\t...updatedCurrentlySelected,\n\t\t\t\tshortcuts: {\n\t\t\t\t\t...updatedCurrentlySelected.shortcuts,\n\t\t\t\t\taccountType: account.accountType,\n\t\t\t\t\taddress: account.address,\n\t\t\t\t\tprimary: account.primaryAccount,\n\t\t\t\t\taccountName: account.name,\n\t\t\t\t\tquantity: balance ?? EthereumBigNumber.from(0)\n\t\t\t\t},\n\t\t\t\tdata: await encryptData(\n\t\t\t\t\t{\n\t\t\t\t\t\t...updatedCurrentlySelected?.data,\n\t\t\t\t\t\taccount\n\t\t\t\t\t},\n\t\t\t\t\t$yakklMiscStore\n\t\t\t\t)\n\t\t\t};\n\n\t\t\tawait setYakklCurrentlySelectedStorage(updatedCurrentlySelected);\n\n\t\t\t// Send state change message for account update\n\t\t\tif (browserSvelte) {\n\t\t\t\tbrowser_ext.runtime\n\t\t\t\t\t.sendMessage({\n\t\t\t\t\t\ttype: 'YAKKL_STATE_CHANGE',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\taddress: account.address,\n\t\t\t\t\t\t\taccounts: [account.address]\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error: Error) => {\n\t\t\t\t\t\tlog.warn('Error sending account change message', true, error);\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Update price and UI\n\t\t\tawait updateWithCurrentlySelected();\n\t\t\tawait updateValuePriceFiat();\n\t\t\tif (wallet && provider && blockchain && tokenService) {\n\t\t\t\tawait tokenService.updateTokenBalances($yakklCurrentlySelectedStore.shortcuts.address);\n\t\t\t}\n\n\t\t\t// Explicitly close the modal after successful account selection\n\t\t\tshowAccountsModal = false;\n\t\t} catch (error) {\n\t\t\tlog.warn('Error in handleAccounts:', false, error);\n\t\t\tshowAccountsModal = false;\n\t\t}\n\t}\n\n\tasync function handleNetworkTypeChange(net: Network) {\n\t\ttry {\n\t\t\tif ($yakklCurrentlySelectedStore) {\n\t\t\t\tisDropdownOpen = false;\n\t\t\t\tif (net.chainId === $yakklCurrentlySelectedStore.shortcuts.chainId) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst currentlySelected = $yakklCurrentlySelectedStore;\n\n\t\t\t\t// Update store using .update() method to prevent direct mutation\n\t\t\t\tyakklCurrentlySelectedStore.update((current) => ({\n\t\t\t\t\t...current,\n\t\t\t\t\tshortcuts: {\n\t\t\t\t\t\t...current.shortcuts,\n\t\t\t\t\t\tchainId: net.chainId,\n\t\t\t\t\t\tnetwork: net\n\t\t\t\t\t}\n\t\t\t\t}));\n\n\t\t\t\tchainId = net.chainId;\n\t\t\t\tnetwork = net;\n\n\t\t\t\tif (wallet) await wallet.setChainId(chainId);\n\n\t\t\t\tdirection = 'fl';\n\t\t\t\tcurrentlySelected.shortcuts.symbol = network.symbol;\n\t\t\t\tcurrentlySelected.shortcuts.type = network.type.toString();\n\n\t\t\t\tconst qty = await getBalance(chainId, currentlySelected.shortcuts.address);\n\t\t\t\tcurrentlySelected.shortcuts.quantity = qty ?? 0n;\n\n\t\t\t\tif (!isEncryptedData(currentlySelected.data)) {\n\t\t\t\t\tif ($yakklMiscStore) {\n\t\t\t\t\t\tconst encryptedData = await encryptData(currentlySelected.data, $yakklMiscStore);\n\t\t\t\t\t\tcurrentlySelected.data = encryptedData;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tawait setYakklCurrentlySelectedStorage(currentlySelected);\n\t\t\t\tawait updateValuePriceFiat();\n\t\t\t\tif (wallet && provider && blockchain && tokenService) {\n\t\t\t\t\ttokenService.updateTokenBalances($yakklCurrentlySelectedStore.shortcuts.address);\n\t\t\t\t}\n\n\t\t\t\t// Send state change message for chain ID update\n\t\t\t\tif (browserSvelte) {\n\t\t\t\t\tbrowser_ext.runtime\n\t\t\t\t\t\t.sendMessage({\n\t\t\t\t\t\t\ttype: 'YAKKL_STATE_CHANGE',\n\t\t\t\t\t\t\tdata: { chainId: net.chainId }\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((error: Error) => {\n\t\t\t\t\t\t\tlog.warn('Error sending chain change message', true, error);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Close the dropdown\n\t\t\t\tisDropdownOpen = false;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tlog.warn('[Card] Network change error:', false, e);\n\n\t\t\t// Use safe error display method\n\t\t\tshowErrorSafely(e);\n\n\t\t\t// Reset dropdown state on any error\n\t\t\tisDropdownOpen = false;\n\t\t}\n\t}\n\n\tasync function handleContact() {\n\t\ttry {\n\t\t\tshowAccountImportModal = false;\n\t\t\tupdateValuePriceFiat();\n\t\t} catch (e) {\n\t\t\tlog.warn(e);\n\t\t}\n\t}\n\n\tasync function handleToken() {\n\t\ttry {\n\t\t\tshowAccountImportModal = false; // ?????????\n\t\t\tupdateValuePriceFiat();\n\t\t} catch (e) {\n\t\t\tlog.warn(e);\n\t\t}\n\t}\n\n\tasync function handleImport() {\n\t\ttry {\n\t\t\tlog.info('handleImport - Not implemented');\n\t\t} catch (e) {\n\t\t\tlog.warn(e);\n\t\t}\n\t}\n\n\tasync function handleWatchAccountComplete() {\n\t\t// Reload assets and prices when a watch account is added\n\t\tlog.info('Watch account added');\n\n\t\t// Refresh the portfolio calculation\n\t\tif (wallet && provider && blockchain && tokenService) {\n\t\t\tawait tokenService.updateTokenBalances($yakklCurrentlySelectedStore.shortcuts.address);\n\t\t}\n\n\t\tshowWatchAccountModal = false;\n\t}\n\n\t// Gets the ether balance for the given address\n\tasync function getBalance(chainId: number, address: string): Promise<bigint | null> {\n\t\ttry {\n\t\t\tif (chainId && wallet) {\n\t\t\t\tif (wallet.getChainId() !== chainId) {\n\t\t\t\t\tawait wallet.setChainId(chainId);\n\t\t\t\t}\n\t\t\t\tconst val = await wallet.getBalance(address);\n\n\t\t\t\t// Update cache with fetched balance\n\t\t\t\tif (val !== null && $yakklPricingStore?.price) {\n\t\t\t\t\tbalanceCacheManager.setCachedBalance(address, val, $yakklPricingStore.price);\n\t\t\t\t\tlog.debug('[Card] Updated cache in getBalance:', false, {\n\t\t\t\t\t\taddress,\n\t\t\t\t\t\tbalance: val.toString()\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn val;\n\t\t\t}\n\t\t\treturn null;\n\t\t} catch (e) {\n\t\t\tlog.warn('[Card] Balance fetch error:', false, e);\n\n\t\t\t// Use safe error display method\n\t\t\tshowErrorSafely(e);\n\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tfunction formatEther(value: BigNumberish): string {\n\t\ttry {\n\t\t\tconst val = EthereumBigNumber.from(value);\n\t\t\t// Convert from Wei to Ether and get string representation\n\t\t\treturn val.toEtherString();\n\t\t} catch (e) {\n\t\t\tlog.warn(e);\n\t\t\treturn '0.00000';\n\t\t}\n\t}\n\n\t// Handle error modal close with extended cooldown\n\tfunction handleErrorClose(): void {\n\t\terror = false;\n\t\terrorValue = '';\n\n\t\t// Set extended cooldown when user manually closes\n\t\terrorCooldown = true;\n\t\tsetTimeout(() => {\n\t\t\terrorCooldown = false;\n\t\t}, 10000); // 10 second cooldown after manual close\n\t}\n</script>\n\n<ErrorNoAction bind:show={error} value={errorValue} title=\"ERROR!\" onClose={handleErrorClose} />\n\n{#await $yakklAccountsStore}\n\t<p>o_o</p>\n{:then _}\n\t{#if $yakklAccountsStore != undefined}\n\t\t<Accounts\n\t\t\tbind:show={showAccountsModal}\n\t\t\tonAccountSelect={handleAccounts}\n\t\t\tonClose={() => (showAccountsModal = false)}\n\t\t\tclassName=\"text-gray-600\"\n\t\t/>\n\t\t<Contacts bind:show={showContacts} onContactSelect={handleContact} />\n\t\t<TokensEnhanced bind:show={showTokens} onTokenSelect={handleToken} />\n\t\t<Receive bind:show={showRecv} {address} />\n\t\t<ImportPrivateKey\n\t\t\tbind:show={showAccountImportModal}\n\t\t\tonComplete={handleImport}\n\t\t\tclassName=\"text-gray-600 z-[999]\"\n\t\t/>\n\t\t<ImportWatchAccount\n\t\t\tbind:show={showWatchAccountModal}\n\t\t\tonComplete={handleWatchAccountComplete}\n\t\t\tonCancel={() => (showWatchAccountModal = false)}\n\t\t\tclassName=\"text-gray-600 z-[999]\"\n\t\t/>\n\t\t<Upgrade\n\t\t\tbind:show={showUpgradeModal}\n\t\t\tonClose={() => (showUpgradeModal = false)}\n\t\t\tonCancel={() => (showUpgradeModal = false)}\n\t\t/>\n\t{/if}\n{/await}\n\n<div class=\"visible print:hidden relative top-0 mx-2\">\n\t<div\n\t\tstyle=\"z-index: 4; background-image: url('/images/{card}'); \"\n\t\tclass=\"visible print:hidden relative m-2 ml-0 mr-0 h-[261px] rounded-xl\"\n\t>\n\t\t<div class=\"grid grid-rows-5 gap-1 h-full\">\n\t\t\t<div class=\"absolute left-4 bottom-1\">\n\t\t\t\t<span class=\"text-gray-100 text-md\">Asset Market Price:</span>\n\t\t\t\t<span class=\"ml-2 text-gray-100 text-md\">{assetPrice} {currencyLabel}</span>\n\t\t\t</div>\n\n\t\t\t<SpeedDial\n\t\t\t\tdefaultClass=\"absolute right-1 bottom-1 z-10 bg-primary rounded-full\"\n\t\t\t\tpill={false}\n\t\t\t\ttooltip=\"none\"\n\t\t\t\tplacement=\"bottom\"\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\tclass=\"w-8 h-8\"\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t><path\n\t\t\t\t\t\td=\"M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z\"\n\t\t\t\t\t></path></svg\n\t\t\t\t>\n\t\t\t\t<SpeedDialButton\n\t\t\t\t\tname=\"Accounts\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tshowAccountsModal = true;\n\t\t\t\t\t}}\n\t\t\t\t\tclass=\"w-16\"\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\tclass=\"w-6 h-6\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\td=\"M6 4.75A.75.75 0 016.75 4h10.5a.75.75 0 010 1.5H6.75A.75.75 0 016 4.75zM6 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H6.75A.75.75 0 016 10zm0 5.25a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H6.75a.75.75 0 01-.75-.75zM1.99 4.75a1 1 0 011-1H3a1 1 0 011 1v.01a1 1 0 01-1 1h-.01a1 1 0 01-1-1v-.01zM1.99 15.25a1 1 0 011-1H3a1 1 0 011 1v.01a1 1 0 01-1 1h-.01a1 1 0 01-1-1v-.01zM1.99 10a1 1 0 011-1H3a1 1 0 011 1v.01a1 1 0 01-1 1h-.01a1 1 0 01-1-1V10z\"\n\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</SpeedDialButton>\n\t\t\t\t<SpeedDialButton\n\t\t\t\t\tname=\"Contacts\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tshowContacts = true;\n\t\t\t\t\t}}\n\t\t\t\t\tclass=\"w-16\"\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\tclass=\"w-6 h-6\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\td=\"M6 4.75A.75.75 0 016.75 4h10.5a.75.75 0 010 1.5H6.75A.75.75 0 016 4.75zM6 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H6.75A.75.75 0 016 10zm0 5.25a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H6.75a.75.75 0 01-.75-.75zM1.99 4.75a1 1 0 011-1H3a1 1 0 011 1v.01a1 1 0 01-1 1h-.01a1 1 0 01-1-1v-.01zM1.99 15.25a1 1 0 011-1H3a1 1 0 011 1v.01a1 1 0 01-1 1h-.01a1 1 0 01-1-1v-.01zM1.99 10a1 1 0 011-1H3a1 1 0 011 1v.01a1 1 0 01-1 1h-.01a1 1 0 01-1-1V10z\"\n\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</SpeedDialButton>\n\t\t\t\t<SpeedDialButton\n\t\t\t\t\tname=\"Tokens\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tshowTokens = true;\n\t\t\t\t\t}}\n\t\t\t\t\tclass=\"w-16\"\n\t\t\t\t>\n\t\t\t\t\t<TokensIcon />\n\t\t\t\t\t<!-- <svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\tclass=\"w-6 h-6\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\td=\"M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg> -->\n\t\t\t\t</SpeedDialButton>\n\t\t\t\t<SpeedDialButton\n\t\t\t\t\tname=\"Receive\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tshowRecv = true;\n\t\t\t\t\t}}\n\t\t\t\t\tclass=\"w-16\"\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tclass=\"w-6 h-6\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\td=\"M3 4.875C3 3.839 3.84 3 4.875 3h4.5c1.036 0 1.875.84 1.875 1.875v4.5c0 1.036-.84 1.875-1.875 1.875h-4.5A1.875 1.875 0 013 9.375v-4.5zM4.875 4.5a.375.375 0 00-.375.375v4.5c0 .207.168.375.375.375h4.5a.375.375 0 00.375-.375v-4.5a.375.375 0 00-.375-.375h-4.5zm7.875.375c0-1.036.84-1.875 1.875-1.875h4.5C20.16 3 21 3.84 21 4.875v4.5c0 1.036-.84 1.875-1.875 1.875h-4.5a1.875 1.875 0 01-1.875-1.875v-4.5zm1.875-.375a.375.375 0 00-.375.375v4.5c0 .207.168.375.375.375h4.5a.375.375 0 00.375-.375v-4.5a.375.375 0 00-.375-.375h-4.5zM6 6.75A.75.75 0 016.75 6h.75a.75.75 0 01.75.75v.75a.75.75 0 01-.75.75h-.75A.75.75 0 016 7.5v-.75zm9.75 0A.75.75 0 0116.5 6h.75a.75.75 0 01.75.75v.75a.75.75 0 01-.75.75h-.75a.75.75 0 01-.75-.75v-.75zM3 14.625c0-1.036.84-1.875 1.875-1.875h4.5c1.036 0 1.875.84 1.875 1.875v4.5c0 1.035-.84 1.875-1.875 1.875h-4.5A1.875 1.875 0 013 19.125v-4.5zm1.875-.375a.375.375 0 00-.375.375v4.5c0 .207.168.375.375.375h4.5a.375.375 0 00.375-.375v-4.5a.375.375 0 00-.375-.375h-4.5zm7.875-.75a.75.75 0 01.75-.75h.75a.75.75 0 01.75.75v.75a.75.75 0 01-.75.75h-.75a.75.75 0 01-.75-.75v-.75zm6 0a.75.75 0 01.75-.75h.75a.75.75 0 01.75.75v.75a.75.75 0 01-.75.75h-.75a.75.75 0 01-.75-.75v-.75zM6 16.5a.75.75 0 01.75-.75h.75a.75.75 0 01.75.75v.75a.75.75 0 01-.75.75h-.75a.75.75 0 01-.75-.75v-.75zm9.75 0a.75.75 0 01.75-.75h.75a.75.75 0 01.75.75v.75a.75.75 0 01-.75.75h-.75a.75.75 0 01-.75-.75v-.75zm-3 3a.75.75 0 01.75-.75h.75a.75.75 0 01.75.75v.75a.75.75 0 01-.75.75h-.75a.75.75 0 01-.75-.75v-.75zm6 0a.75.75 0 01.75-.75h.75a.75.75 0 01.75.75v.75a.75.75 0 01-.75.75h-.75a.75.75 0 01-.75-.75v-.75z\"\n\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</SpeedDialButton>\n\t\t\t\t<SpeedDialButton\n\t\t\t\t\tname=\"Import Account\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tshowAccountImportModal = true;\n\t\t\t\t\t}}\n\t\t\t\t\tclass=\"w-16\"\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tclass=\"w-6 h-6\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\td=\"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</SpeedDialButton>\n\t\t\t\t<SpeedDialButton\n\t\t\t\t\tname=\"Upgrade\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tshowUpgradeModal = true;\n\t\t\t\t\t}}\n\t\t\t\t\tclass=\"w-16\"\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\tclass=\"w-6 h-6\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\td=\"M10 2a.75.75 0 01.75.75v5.59l1.95-2.1a.75.75 0 111.1 1.02l-3.25 3.5a.75.75 0 01-1.1 0L6.2 7.26a.75.75 0 111.1-1.02l1.95 2.1V2.75A.75.75 0 0110 2z\"\n\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\td=\"M10 18a.75.75 0 01-.75-.75v-5.59l-1.95 2.1a.75.75 0 11-1.1-1.02l3.25-3.5a.75.75 0 011.1 0l3.25 3.5a.75.75 0 11-1.1 1.02l-1.95-2.1v5.59a.75.75 0 01-.75.75z\"\n\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</SpeedDialButton>\n\t\t\t\t<SpeedDialButton name=\"Lock/Exit\" on:click={() => goto(PATH_LOGOUT)} class=\"w-16\">\n\t\t\t\t\t<svg\n\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tclass=\"w-6 h-6\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\td=\"M3 4.25A2.25 2.25 0 015.25 2h5.5A2.25 2.25 0 0113 4.25v2a.75.75 0 01-1.5 0v-2a.75.75 0 00-.75-.75h-5.5a.75.75 0 00-.75.75v11.5c0 .414.336.75.75.75h5.5a.75.75 0 00.75-.75v-2a.75.75 0 011.5 0v2A2.25 2.25 0 0110.75 18h-5.5A2.25 2.25 0 013 15.75V4.25z\"\n\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\td=\"M19 10a.75.75 0 00-.75-.75H8.704l1.048-.943a.75.75 0 10-1.004-1.114l-2.5 2.25a.75.75 0 000 1.114l2.5 2.25a.75.75 0 101.004-1.114l-1.048-.943h9.546A.75.75 0 0019 10z\"\n\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</SpeedDialButton>\n\t\t\t</SpeedDial>\n\n\t\t\t<nav\n\t\t\t\t{id}\n\t\t\t\tclass=\"print:hidden visible relative row-span-1 inset-x-0 navbar navbar-expand-sm p-2 flex items-center w-full justify-between\"\n\t\t\t>\n\t\t\t\t<div class=\"flex justify-between w-full items-center\">\n\t\t\t\t\t<span class=\"text-gray-100 text-center dark:text-white text-4xl ml-2 -mt-6 font-bold\">\n\t\t\t\t\t\t{$yakklCurrentlySelectedStore &&\n\t\t\t\t\t\t\t$yakklCurrentlySelectedStore.shortcuts.network.blockchain}\n\t\t\t\t\t</span>\n\t\t\t\t\t{#if showTestNetworks}\n\t\t\t\t\t\t<span class=\"flex h-6\">\n\t\t\t\t\t\t\t<div class=\"dropdown dropdown-bottom relative\">\n\t\t\t\t\t\t\t\t{#if networkLabel.toLowerCase() === 'mainnet'}\n\t\t\t\t\t\t\t\t\t<!-- svelte-ignore a11y_click_events_have_key_events -->\n\t\t\t\t\t\t\t\t\t<!-- svelte-ignore a11y_no_noninteractive_element_interactions -->\n\t\t\t\t\t\t\t\t\t<!-- svelte-ignore a11y_label_has_associated_control -->\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tonclick={toggleDropdown}\n\t\t\t\t\t\t\t\t\t\tclass=\"w-28 px-3 py-1 bg-red-800/80 text-white font-medium text-xs leading-tight uppercase rounded-full shadow-md hover:bg-red-700 hover:shadow-lg focus:bg-red-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-red-800 active:shadow-lg active:text-white transition duration-150 ease-in-out flex items-center whitespace-nowrap\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tLIVE-{networkLabel}\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t<!-- svelte-ignore a11y_click_events_have_key_events -->\n\t\t\t\t\t\t\t\t\t<!-- svelte-ignore a11y_no_noninteractive_element_interactions -->\n\t\t\t\t\t\t\t\t\t<!-- svelte-ignore a11y_label_has_associated_control -->\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tonclick={toggleDropdown}\n\t\t\t\t\t\t\t\t\t\tclass=\"w-28 px-3 py-1 bg-green-800/80 text-white font-medium text-xs leading-tight uppercase rounded-full shadow-md hover:bg-green-700 hover:shadow-lg focus:bg-green-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-green-800 active:shadow-lg active:text-white transition duration-150 ease-in-out flex items-center whitespace-nowrap\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tTest-{networkLabel}\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t{#if isDropdownOpen}\n\t\t\t\t\t\t\t\t\t<ul\n\t\t\t\t\t\t\t\t\t\tclass=\"absolute top-full left-0 dropdown-content menu bg-opacity-70 text-base z-50 float-left py-2 list-none text-left rounded-lg shadow-lg mt-1 m-0 bg-clip-padding border-none bg-gray-800\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{#each networks as network}\n\t\t\t\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- svelte-ignore a11y_click_events_have_key_events -->\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- svelte-ignore a11y_no_static_element_interactions -->\n\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\trole=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttabindex=\"0\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"dropdown-item text-sm py-2 px-4 font-normal w-full whitespace-nowrap bg-transparent text-gray-300 hover:bg-gray-500 hover:text-white focus:text-white focus:bg-gray-700\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonclick={() => handleNetworkTypeChange(network)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#if network.type === NetworkType.MAINNET}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tLIVE-{network.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tTestnet-{network.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<span class=\"flex h-6\">\n\t\t\t\t\t\t\t<!-- svelte-ignore a11y_label_has_associated_control -->\n\t\t\t\t\t\t\t<label\n\t\t\t\t\t\t\t\tclass=\"w-28 px-3 py-1 bg-red-800/80 text-white font-medium text-xs leading-tight uppercase rounded-full shadow-md hover:bg-red-700 hover:shadow-lg focus:bg-red-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-red-800 active:shadow-lg active:text-white transition duration-150 ease-in-out flex items-center whitespace-nowrap\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tLIVE-{networkLabel}\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</nav>\n\n\t\t\t<div class=\"ml-4\">\n\t\t\t\t<div class=\"row-span-2 -mt-4\">\n\t\t\t\t\t<p class=\"text-gray-100 dark:text-white text-lg\">Account:</p>\n\t\t\t\t\t<p\n\t\t\t\t\t\tclass=\"text-gray-100 dark:text-white text-lg ml-4 -mt-1\"\n\t\t\t\t\t\tdata-bs-toggle=\"tooltip\"\n\t\t\t\t\t\tdata-bs-placement=\"top\"\n\t\t\t\t\t\ttitle={name}\n\t\t\t\t\t>\n\t\t\t\t\t\tName: <span class=\"uppercase ml-5\">{nameShow}</span>\n\t\t\t\t\t</p>\n\t\t\t\t\t<p\n\t\t\t\t\t\tclass=\"text-gray-100 dark:text-white text-lg ml-4 -mt-2\"\n\t\t\t\t\t\tdata-bs-toggle=\"tooltip\"\n\t\t\t\t\t\tdata-bs-placement=\"top\"\n\t\t\t\t\t\ttitle={address}\n\t\t\t\t\t>\n\t\t\t\t\t\tNumber: <span class=\"ml-1\">{addressShow}</span>\n\t\t\t\t\t\t<Copy target={{ value: address }} />\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 opacity-25 -z-10\"\n\t\t\t\t>\n\t\t\t\t\t{#if symbolLabel}\n\t\t\t\t\t\t<svg width=\"60\" height=\"60\" fill=\"none\" viewBox=\"0 0 60 60\">\n\t\t\t\t\t\t\t<g clip-path=\"url(#j)\">\n\t\t\t\t\t\t\t\t<rect width=\"60\" height=\"60\" rx=\"30\" fill=\"#987DE8\" />\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\td=\"m15.48 28.367 11.966-19.3c1.174-1.892 3.927-1.892 5.1 0l11.97 19.306a6 6 0 0 1 .9 3.142v.028a6 6 0 0 1-1.154 3.56L33.227 50.208c-1.599 2.188-4.864 2.188-6.461 0L15.733 35.095a6 6 0 0 1-1.154-3.538v-.029a6 6 0 0 1 .9-3.161Z\"\n\t\t\t\t\t\t\t\t\tfill=\"#fff\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M30.84 10.112a.992.992 0 0 0-.844-.464V24.5l12.598 5.53c.081-.466-.001-.963-.27-1.398L30.84 10.112Z\"\n\t\t\t\t\t\t\t\t\tfill=\"#643CDD\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M29.996 9.648a.991.991 0 0 0-.845.465l-11.489 18.53a1.991 1.991 0 0 0-.264 1.387l12.598-5.53V9.648Z\"\n\t\t\t\t\t\t\t\t\tfill=\"#BDADEB\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M29.996 50.544a.994.994 0 0 0 .808-.41l11.235-15.38c.307-.434-.193-.988-.658-.72L31.49 39.71a2.998 2.998 0 0 1-1.494.398v10.437Z\"\n\t\t\t\t\t\t\t\t\tfill=\"#643CDD\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M17.966 34.762 29.19 50.134c.2.274.503.41.807.41V40.108a2.998 2.998 0 0 1-1.493-.398l-9.884-5.676c-.468-.27-.971.292-.653.728Z\"\n\t\t\t\t\t\t\t\t\tfill=\"#BDADEB\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M42.594 30.03 29.996 24.5v13.138a3 3 0 0 0 1.495-.399l10.149-5.83c.525-.31.856-.823.954-1.38Z\"\n\t\t\t\t\t\t\t\t\tfill=\"#401AB3\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M29.996 37.638V24.462l-12.598 5.566c.098.564.437 1.083.974 1.392l10.13 5.82c.462.265.978.398 1.494.398Z\"\n\t\t\t\t\t\t\t\t\tfill=\"#7C5AE2\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t<rect class=\"help-img-highlight\" x=\".5\" y=\".5\" width=\"59\" height=\"59\" rx=\"29.5\" />\n\t\t\t\t\t\t\t<defs>\n\t\t\t\t\t\t\t\t<clipPath id=\"j\"><rect width=\"60\" height=\"60\" rx=\"30\" fill=\"#fff\" /></clipPath>\n\t\t\t\t\t\t\t</defs>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"flex text-xl justify-center mt-4 text-gray-100 dark:text-white row-span-1\">\n\t\t\t\t\t<span\n\t\t\t\t\t\tdata-bs-toggle=\"tooltip\"\n\t\t\t\t\t\tdata-bs-placement=\"top\"\n\t\t\t\t\t\ttitle={shortcutsValue.toEtherString()}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ProtectedValue value={formattedEtherValue} placeholder=\"*******\" />\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\"ml-2\">{symbolLabel}</span>\n\t\t\t\t\t<div class=\"relative flex items-center gap-2\">\n\t\t\t\t\t\t<EyeIcon />\n\t\t\t\t\t\t\n\t\t\t\t\t\t<!-- Manual Refresh Button (Pro users only) -->\n\t\t\t\t\t\t{#if isProUser}\n\t\t\t\t\t\t\t<SimpleTooltip content={refreshCooldown > 0 ? `Wait ${refreshCooldown}s before next refresh` : canManualRefresh ? \"Manual refresh (Pro feature)\" : \"Refreshing...\"}>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tonclick={handleManualRefresh}\n\t\t\t\t\t\t\t\t\tdisabled={!canManualRefresh}\n\t\t\t\t\t\t\t\t\tclass=\"p-1 text-white/80 hover:text-white hover:bg-white/10 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{#if isManualRefreshing}\n\t\t\t\t\t\t\t\t\t\t<div class=\"animate-spin w-4 h-4 border border-white border-t-transparent rounded-full\"></div>\n\t\t\t\t\t\t\t\t\t{:else if refreshCooldown > 0}\n\t\t\t\t\t\t\t\t\t\t<span class=\"text-xs font-medium\">{refreshCooldown}</span>\n\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</SimpleTooltip>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\"flex justify-center text-lg text-gray-100 dark:text-white -mt-1 row-span-1 -ml-[2.3rem]\"\n\t\t\t\t>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t{#if direction === 'up'}\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tclass=\"w-6 h-6 fill-green-500 font-bold\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\td=\"M11.47 2.47a.75.75 0 011.06 0l3.75 3.75a.75.75 0 01-1.06 1.06l-2.47-2.47V21a.75.75 0 01-1.5 0V4.81L8.78 7.28a.75.75 0 01-1.06-1.06l3.75-3.75z\"\n\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t{:else if direction === 'dn'}\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tclass=\"w-6 h-6 fill-red-500 font-bold\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\td=\"M12 2.25a.75.75 0 01.75.75v16.19l2.47-2.47a.75.75 0 111.06 1.06l-3.75 3.75a.75.75 0 01-1.06 0l-3.75-3.75a.75.75 0 111.06-1.06l2.47 2.47V3a.75.75 0 01.75-.75z\"\n\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</span>\n\t\t\t\t\t<ProtectedValue value={valueFiat} placeholder=\"*******\" />\n\t\t\t\t\t<span class=\"ml-2\">{currencyLabel}</span>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\"flex justify-center text-lg text-gray-100 dark:text-white mt-2 row-span-1\"\n\t\t\t\t\tstyle=\"max-width: 300px; overflow-x: auto; white-space: nowrap;\"\n\t\t\t\t>\n\t\t\t\t\t<span>Account Portfolio: </span>\n\t\t\t\t\t{#if isCalculatingPortfolio}\n\t\t\t\t\t\t<span class=\"ml-2\">\n\t\t\t\t\t\t\t<SkeletonBalance className=\"inline-block\" showLabel={false} />\n\t\t\t\t\t\t</span>\n\t\t\t\t\t{:else if portfolioValue === '-----' || portfolioValue === '$0.00'}\n\t\t\t\t\t\t<span class=\"ml-2 text-gray-400\">-----</span>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<span class=\"ml-2\"><ProtectedValue value={portfolioValue} placeholder=\"*******\" /></span\n\t\t\t\t\t\t>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Enhanced Portfolio Total with Rollover -->\n\t\t\t\t<div class=\"flex justify-center mt-3 row-span-1\">\n\t\t\t\t\t<PortfolioTotal className=\"transform scale-90\" currency={currencyLabel || 'USD'} />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<!-- Card stack look -->\n\t<div\n\t\tstyle=\"z-index: 1;\"\n\t\tclass=\"grid right-[18.5px] left-[18.5px] bottom-[5px] h-[10px] absolute rounded bg-secondary text-accent-content place-content-center\"\n\t></div>\n\t<div\n\t\tstyle=\"z-index: 0;\"\n\t\tclass=\"grid right-[27px] left-[27px] bottom-[2.5px] h-[10px] absolute rounded bg-accent text-secondary-content place-content-center\"\n\t></div>\n</div>\n","<script lang=\"ts\">\n\timport { onMount } from 'svelte';\n\timport { sessionInitialized } from '$lib/common/stores';\n\timport { DEFAULT_POPUP_HEIGHT, DEFAULT_TITLE, DEFAULT_POPUP_WIDTH } from '$lib/common';\n\timport Header from '$components/Header.svelte';\n\timport Footer from '$components/Footer.svelte';\n\timport { blockContextMenu, blockWindowResize } from '$lib/utilities';\n\timport ErrorNoAction from '$lib/components/ErrorNoAction.svelte';\n\n\t// Global error filtering function\n\tfunction shouldShowErrorToUser(error: any): boolean {\n\t\tconst errorMessage = error?.message || error?.toString() || '';\n\n\t\t// Network/API errors that should be handled silently\n\t\tconst networkErrors = [\n\t\t\t'missing response',\n\t\t\t'timeout',\n\t\t\t'TIMEOUT',\n\t\t\t'SERVER_ERROR',\n\t\t\t'NETWORK_ERROR',\n\t\t\t'Failed to fetch',\n\t\t\t'fetch',\n\t\t\t'Connection failed',\n\t\t\t'Request timeout',\n\t\t\t'eth_getBalance',\n\t\t\t'call revert exception',\n\t\t\t'alchemy.com',\n\t\t\t'infura.io',\n\t\t\t'requestBody',\n\t\t\t'serverError',\n\t\t\t'code=SERVER_ERROR',\n\t\t\t'version=web/',\n\t\t\t'JsonRpcError',\n\t\t\t'RPC Error',\n\t\t\t'getBalance',\n\t\t\t'Balance fetch'\n\t\t];\n\n\t\treturn !networkErrors.some((pattern) =>\n\t\t\terrorMessage.toLowerCase().includes(pattern.toLowerCase())\n\t\t);\n\t}\n\timport { browserSvelte, browser_ext } from '$lib/common/environment';\n\timport { log } from '$lib/common/logger-wrapper';\n\timport { initializeUiContext } from '$lib/common/messaging';\n\timport InAppNotifications from '$lib/components/InAppNotifications.svelte';\n\timport SecurityWarningEnhanced from '$lib/components/SecurityWarningEnhanced.svelte';\n\timport Card from '$lib/components/Card.svelte';\n\timport { yakklMiscStore } from '$lib/common/stores';\n\timport TrialCountdown from '$lib/components/TrialCountdown.svelte';\n\timport Upgrade from '$lib/components/Upgrade.svelte';\n\timport { modal, modalName, closeModal } from '$lib/common/stores/modal';\n\n\tinterface Props {\n\t\tchildren?: import('svelte').Snippet;\n\t}\n\n\tlet { children }: Props = $props();\n\n\t// Use reactive store subscription instead of a one-time value\n\n\t// UI State\n\tlet popupWidth: number = $state(DEFAULT_POPUP_WIDTH);\n\tlet popupHeight: number = DEFAULT_POPUP_HEIGHT;\n\tlet title: string = $state(DEFAULT_TITLE);\n\tlet contextMenu: boolean = $state(false);\n\tlet resize: boolean = $state(false);\n\tlet error: boolean = $state(false);\n\tlet errorValue: string = $state('');\n\tlet errorCooldown: boolean = $state(false);\n\tlet maxHeightClass: string = $state('max-h-[448px]');\n\n\t// Effect: Handle Internet Connection Status\n\t$effect(() => {\n\t\tif (browserSvelte && !navigator.onLine) {\n\t\t\tlog.warn('Internet connection is offline');\n\t\t\terrorValue =\n\t\t\t\t'It appears your Internet connection is offline. YAKKL needs access to the Internet to obtain current market prices and gas fees. A number of areas will either not function or work in a limited capacity. Thank you!';\n\t\t\terror = true;\n\t\t} else {\n\t\t\terror = false;\n\t\t}\n\t});\n\n\t// Effect: Manage Debug Mode and Blocking Features\n\t$effect(() => {\n\t\tif (process.env.DEV_MODE || process.env.NODE_ENV === 'development') {\n\t\t\tcontextMenu = true;\n\t\t\tresize = true;\n\t\t}\n\n\t\tif (!contextMenu) blockContextMenu();\n\t\tif (!resize) blockWindowResize(popupWidth, popupHeight);\n\t});\n\n\tonMount(async () => {\n\t\ttry {\n\t\t\tlog.debug('+layout.svelte (wallet level) - onMount');\n\t\t\t// Reset session initialization state when app first loads\n\t\t\tsessionInitialized.set(false);\n\n\t\t\tif (browser_ext) {\n\t\t\t\tawait initializeUiContext(browser_ext);\n\t\t\t}\n\n\t\t\t// Global error handlers to prevent network errors from reaching user\n\t\t\twindow.addEventListener('error', (event) => {\n\t\t\t\tconst error = event.error;\n\t\t\t\tif (error && !shouldShowErrorToUser(error)) {\n\t\t\t\t\tlog.warn('[Global] Suppressed network error from user:', false, error);\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\twindow.addEventListener('unhandledrejection', (event) => {\n\t\t\t\tconst error = event.reason;\n\t\t\t\tif (error && !shouldShowErrorToUser(error)) {\n\t\t\t\t\tlog.warn('[Global] Suppressed network rejection from user:', false, error);\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tlog.error('+layout.svelte (wallet level) - onMount:', false, error);\n\t\t}\n\t});\n</script>\n\n<svelte:head>\n\t<title>{title}</title>\n</svelte:head>\n\n<SecurityWarningEnhanced />\n<ErrorNoAction bind:show={error} title=\"Error\" value={errorValue} />\n\n<div\n\tid=\"wrapper\"\n\tclass=\"w-[{popupWidth}px] max-w-[{popupWidth}px] rounded-md flex flex-col bg-gradient-to-br from-gray-900 via-gray-800 to-black min-h-screen transition-opacity duration-500 animate-fade-in overflow-hidden\"\n>\n\t<!-- containerWidth={popupWidth} /> -->\n\t<Header />\n\n\t{#if $yakklMiscStore}\n\t\t<Card />\n\t{:else}\n\t\t<!-- Debug: Card not showing because yakklMiscStore is falsy -->\n\t\t<div class=\"text-xs text-gray-500 p-2\">Card loading...</div>\n\t{/if}\n\n\t<div class=\"min-h-[40rem] mx-2 overflow-hidden\">\n\t\t<div class=\"relative mt-1 overflow-hidden\">\n\t\t\t<!-- rounded-xl overflow-y-auto bg-base-100 border-2 border-stone-700 border-r-stone-700/75 border-b-slate-700/75 -->\n\t\t\t<main class=\"p-2 {maxHeightClass} overflow-y-auto overflow-x-hidden\">\n\t\t\t\t{@render children?.()}\n\t\t\t</main>\n\t\t</div>\n\t</div>\n\n\t<Footer containerWidth={popupWidth.toString()} />\n</div>\n\n<InAppNotifications />\n\n<TrialCountdown />\n<Upgrade show={$modal && $modalName === 'upgrade'} onClose={closeModal} onCancel={closeModal} />\n"],"file":"app/immutable/nodes/6.DzOW3OcY.js"}