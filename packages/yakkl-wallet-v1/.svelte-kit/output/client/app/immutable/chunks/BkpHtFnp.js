import{c as check_target,l as legacy_api}from"./BXFaAXnq.js";import{p as push,h as tag,i as state,ae as proxy,ay as user_effect,g as get,o as onMount,d as onDestroy,f as first_child,a as pop,b as strict_equals,e as set,F as FILENAME,c as child,s as sibling,j as next,r as reset,t as template_effect}from"./BaS8d5lg.js";import{a as add_locations}from"./3AhEABF_.js";import{s as set_text}from"./Cmwrv3PW.js";import{i as if_block}from"./Q1yPWpQ-.js";import{c as comment,a as append,f as from_html}from"./Cm3jf07C.js";import{d as delegate}from"./DiU70Is3.js";import{s as set_class}from"./DX_EEhpR.js";import{s as set_style}from"./D1JcdFy3.js";import{t as transition,b as scale,f as fade}from"./DevLwR0m.js";import{p as prop}from"./BYboeQtC.js";import{l as log_if_contains_state}from"./DZ17DrFv.js";import{N as NotificationService}from"./Bmr6hs4q.js";import{a as browser_ext}from"./CgCfpVku.js";import{hideSecurityWarning,securityWarningStore}from"./ByX4oUvk.js";import{l as log}from"./Cb2naUpm.js";import{UnifiedTimerManager}from"./z-nmOEXa.js";import{c as createCountdownTimer}from"./Ch-onVly.js";function bounceOut(t){const a=4/11;const b=8/11;const c=9/10;const ca=4356/361;const cb=35442/1805;const cc=16061/1805;const t2=t*t;return t<a?7.5625*t2:t<b?9.075*t2-9.9*t+3.4:t<c?ca*t2-cb*t+cc:10.8*t*t-20.52*t+10.72}function bounceIn(t){return 1-bounceOut(1-t)}SecurityWarningEnhanced[FILENAME]="src/lib/components/SecurityWarningEnhanced.svelte";var root_2=add_locations(from_html(`<div class="absolute -top-3 -right-3 bg-yellow-400 text-red-900 px-3 py-1 rounded-full text-sm font-bold animate-ping shadow-lg">URGENT!</div>`),SecurityWarningEnhanced[FILENAME],[[242,4]]);var root_1=add_locations(from_html(`<div class="fixed inset-0 z-50 flex items-start justify-center pt-4"><div></div> <div role="alert" aria-live="assertive"><!> <div class="flex items-center justify-center space-x-4 mb-6"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg> <div class="text-center"><h2 class="text-2xl font-bold">üö® SECURITY WARNING</h2> <p class="text-red-200 text-sm mt-1">Immediate attention required</p></div></div> <div class="text-center mb-6"><div class="text-sm text-red-200 mb-3">Wallet will lock due to inactivity in:</div> <div> </div> <div class="text-base text-red-200 font-semibold">seconds</div></div> <div class="w-full bg-red-800 rounded-full h-3 mb-6 shadow-inner"><div></div></div> <div class="flex space-x-4 mb-4"><button class="flex-1 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white px-6 py-4 rounded-lg font-bold text-lg transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-500/50 shadow-lg">‚úÖ I'm Here - Stay Active</button> <button class="bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white px-6 py-4 rounded-lg font-bold transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-red-500/50 shadow-lg">üîí Lock Now</button></div> <div class="text-center"><div class="text-xs text-red-200 mb-2">Click anywhere on this warning or press any key to stay active</div> <div class="text-xs text-red-300 opacity-75">Your extension badge is also showing the countdown</div></div></div></div>`),SecurityWarningEnhanced[FILENAME],[[219,1,[[224,2],[231,2,[[250,3,[[251,4,[[258,5]]],[264,4,[[265,5],[266,5]]]]],[271,3,[[272,4],[273,4],[281,4]]],[285,3,[[286,4]]],[298,3,[[299,4],[307,4]]],[317,3,[[318,4],[321,4]]]]]]]]);function SecurityWarningEnhanced($$anchor,$$props){check_target(new.target);push($$props,true,SecurityWarningEnhanced);let warningTime=prop($$props,"warningTime",3,30),onComplete=prop($$props,"onComplete",7,()=>{});let timeLeft=tag(state(proxy(warningTime())),"timeLeft");let countdownTimer=null;let show=tag(state(false),"show");let isUrgent=tag(state(false),"isUrgent");let originalTitle="";let isCleaningUp=tag(state(false),"isCleaningUp");let timerManager=UnifiedTimerManager.getInstance();let unsubscribe;async function triggerLockdown(){if(get(isCleaningUp))return;try{log.info("üîí [SecurityWarningEnhanced] Triggering lockdown");set(isCleaningUp,true);cleanup();if(browser_ext){await browser_ext.runtime.sendMessage({type:"lockdown",reason:"idle-timeout"})}await NotificationService.clearAllAlertsEnhanced();hideSecurityWarning();onComplete()()}catch(error){console.error(...log_if_contains_state("error","Failed to trigger lockdown:",error))}finally{set(isCleaningUp,false)}}function cleanup(){if(countdownTimer){countdownTimer.destroy();countdownTimer=null}timerManager.stopTimeout("title-flash");timerManager.removeTimeout("title-flash");if(strict_equals(typeof window,"undefined",false)){const audioContext=window.__yakklAudioContext;if(audioContext&&strict_equals(audioContext.state,"closed",false)){audioContext.close().catch(()=>{});window.__yakklAudioContext=null}}if(originalTitle&&document.title.includes("üö® URGENT")){document.title=originalTitle;originalTitle=""}removeListeners()}function startCountdown(){log.info("‚è∞ [SecurityWarningEnhanced] Starting countdown from",false,get(timeLeft));cleanup();originalTitle=document.title;countdownTimer=createCountdownTimer("security-warning-enhanced",get(timeLeft),remaining=>{set(timeLeft,remaining,true);log.debug("‚è±Ô∏è [SecurityWarningEnhanced] Time left:",false,get(timeLeft));set(isUrgent,get(timeLeft)<=10);if(get(timeLeft)<=15&&!timerManager.isTimeoutRunning("title-flash")&&!document.title.includes("üö® URGENT")){startTitleFlash()}if(strict_equals(get(timeLeft),5)){playFinalWarningSound()}},triggerLockdown);countdownTimer.start();log.info("‚úÖ [SecurityWarningEnhanced] Countdown started")}function startTitleFlash(){if(timerManager.isTimeoutRunning("title-flash")||!originalTitle)return;log.info("‚ö° [SecurityWarningEnhanced] Starting title flash");let flashCount=0;const flashFunction=()=>{if(flashCount>=20){timerManager.stopTimeout("title-flash");timerManager.removeTimeout("title-flash");if(originalTitle){document.title=originalTitle}return}const flashTitle=strict_equals(flashCount%2,0)?"üö® URGENT: Security Warning!":originalTitle;document.title=flashTitle;flashCount++;timerManager.addTimeout("title-flash",flashFunction,500);timerManager.startTimeout("title-flash")};timerManager.addTimeout("title-flash",flashFunction,500);timerManager.startTimeout("title-flash")}function stopCountdown(){log.info("‚èπÔ∏è [SecurityWarningEnhanced] Stopping countdown");cleanup()}function playFinalWarningSound(){try{if(strict_equals(typeof window,"undefined",false)&&window.AudioContext){const audioContext=new(window.AudioContext||window.webkitAudioContext);for(let i=0;i<3;i++){setTimeout(()=>{try{const oscillator=audioContext.createOscillator();const gainNode=audioContext.createGain();oscillator.connect(gainNode);gainNode.connect(audioContext.destination);oscillator.frequency.setValueAtTime(1200,audioContext.currentTime);gainNode.gain.setValueAtTime(.4,audioContext.currentTime);gainNode.gain.exponentialRampToValueAtTime(.01,audioContext.currentTime+.3);oscillator.start(audioContext.currentTime);oscillator.stop(audioContext.currentTime+.3)}catch(e){log.debug("Audio beep failed in final warning:",false,e)}},i*400)}setTimeout(()=>{audioContext.close().catch(()=>{})},2e3)}}catch(error){console.warn(...log_if_contains_state("warn","Failed to play final warning sound:",error))}}function handleUserActivity(){if(get(isCleaningUp))return;log.info("üëÜ [SecurityWarningEnhanced] User activity detected - canceling warning");set(isCleaningUp,true);try{cleanup();hideSecurityWarning();if(browser_ext){browser_ext.runtime.sendMessage({type:"USER_ACTIVITY",timestamp:Date.now(),context:"security",action:"security_warning_interaction"}).catch(()=>{})}NotificationService.clearAllAlertsEnhanced().catch(error=>{log.warn("Error clearing enhanced alerts from SecurityWarning:",false,error)})}catch(error){log.error("Error in handleUserActivity:",false,error)}finally{set(isCleaningUp,false)}}function addListeners(){if(strict_equals(typeof window,"undefined"))return;window.addEventListener("mousemove",handleUserActivity,{once:true,passive:true});window.addEventListener("keydown",handleUserActivity,{once:true,passive:true});window.addEventListener("click",handleUserActivity,{once:true,passive:true});window.addEventListener("focus",handleUserActivity,{once:true,passive:true});log.debug("‚úÖ [SecurityWarningEnhanced] Activity listeners added")}function removeListeners(){if(strict_equals(typeof window,"undefined"))return;window.removeEventListener("mousemove",handleUserActivity);window.removeEventListener("keydown",handleUserActivity);window.removeEventListener("click",handleUserActivity);window.removeEventListener("focus",handleUserActivity);log.debug("‚úÖ [SecurityWarningEnhanced] Activity listeners removed")}user_effect(()=>{if(get(show)&&!get(isCleaningUp)){addListeners()}else{removeListeners()}});onMount(()=>{log.info("üöÄ [SecurityWarningEnhanced] Component mounted");unsubscribe=securityWarningStore.subscribe(state2=>{log.info("üì¢ [SecurityWarningEnhanced] Store state changed:",false,state2);if(state2.show&&!get(show)&&!get(isCleaningUp)){set(show,true);set(timeLeft,state2.warningTime,true);if(state2.onComplete){onComplete(state2.onComplete)}startCountdown()}else if(!state2.show&&get(show)){set(show,false);stopCountdown()}});if(get(show)&&strict_equals(typeof window,"undefined",false)){window.focus()}});onDestroy(()=>{log.info("üî• [SecurityWarningEnhanced] Component destroyed - performing cleanup");cleanup();if(unsubscribe){unsubscribe()}});var fragment=comment();var node=first_child(fragment);{var consequent_1=$$anchor2=>{var div=root_1();var div_1=child(div);let classes;var div_2=sibling(div_1,2);var node_1=child(div_2);{var consequent=$$anchor3=>{var div_3=root_2();append($$anchor3,div_3)};if_block(node_1,$$render=>{if(get(isUrgent))$$render(consequent)})}var div_4=sibling(node_1,2);var svg=child(div_4);set_class(svg,0,"h-10 w-10 text-yellow-300",null,{},{"animate-pulse":true});next(2);reset(div_4);var div_5=sibling(div_4,2);var div_6=sibling(child(div_5),2);let classes_1;var text=child(div_6,true);reset(div_6);next(2);reset(div_5);var div_7=sibling(div_5,2);var div_8=child(div_7);let classes_2;reset(div_7);var div_9=sibling(div_7,2);var button=child(div_9);button.__click=handleUserActivity;var button_1=sibling(button,2);button_1.__click=triggerLockdown;reset(div_9);next(2);reset(div_2);reset(div);template_effect(($0,$1,$2)=>{classes=set_class(div_1,1,"fixed inset-0 bg-red-900/70 backdrop-blur-md",null,classes,$0);set_style(div_1,`animation-duration: ${get(isUrgent)?"0.5s":"2s"}`);set_class(div_2,1,`relative bg-gradient-to-br from-red-900 to-red-800 border-2 border-red-400 text-white p-6 rounded-xl shadow-2xl max-w-lg mx-4 ${get(isUrgent)?"animate-bounce shadow-red-500/50":""}`);set_style(div_2,`box-shadow: ${get(isUrgent)?"0 0 30px rgba(239, 68, 68, 0.5)":""}`);classes_1=set_class(div_6,1,"text-6xl font-mono font-bold text-yellow-300 mb-3 transition-all duration-300",null,classes_1,$1);set_text(text,get(timeLeft));classes_2=set_class(div_8,1,"h-3 rounded-full transition-all duration-1000 shadow-sm",null,classes_2,$2);set_style(div_8,`width: ${get(timeLeft)/warningTime()*100}%`);button.disabled=get(isCleaningUp);button_1.disabled=get(isCleaningUp)},[()=>({"animate-pulse":get(isUrgent)}),()=>({"text-red-300":get(isUrgent),"animate-pulse":get(isUrgent),"scale-110":get(isUrgent)}),()=>({"bg-gradient-to-r":!get(isUrgent),"from-yellow-400":!get(isUrgent),"to-yellow-300":!get(isUrgent),"bg-red-400":get(isUrgent),"animate-pulse":get(isUrgent)})]);transition(3,div_2,()=>scale,()=>({duration:400,easing:bounceIn}));transition(3,div,()=>fade,()=>({duration:300}));append($$anchor2,div)};if_block(node,$$render=>{if(get(show))$$render(consequent_1)})}append($$anchor,fragment);return pop({...legacy_api()})}delegate(["click"]);export{SecurityWarningEnhanced as S};
//# sourceMappingURL=BkpHtFnp.js.map
