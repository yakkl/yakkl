import{c as check_target,l as legacy_api}from"./BXFaAXnq.js";import{p as push,ay as user_effect,c as child,s as sibling,r as reset,j as next,t as template_effect,a7 as untrack,g as get,u as user_derived,a as pop,F as FILENAME,f as first_child,b as strict_equals,h as tag,i as state,ae as proxy,e as set,aC as tag_proxy,o as onMount,d as onDestroy}from"./BaS8d5lg.js";import{a as add_locations}from"./3AhEABF_.js";import{a as append,f as from_html,c as comment}from"./Cm3jf07C.js";import{c as create_ownership_validator}from"./COgMMZ9C.js";import{P as ProtectedValue,v as validate_snippet_args}from"./BWLEmBJs.js";import{i as if_block}from"./Q1yPWpQ-.js";import{w as wrap_snippet}from"./d5hrMixo.js";import{s as set_class}from"./DX_EEhpR.js";import{p as prop}from"./BYboeQtC.js";import{a as store_get,d as store_mutate,s as setup_stores,b as store_set}from"./CViNpZsE.js";import{v as validate_store}from"./Dv9a3G0k.js";import{aw as AccountTypeCategory,$ as yakklPricingStore,a8 as yakklSettingsStore,aL as yakklAccountsStore,Z as yakklCurrentlySelectedStore,az as setYakklAccountsStorage,ax as setYakklPrimaryAccountsStorage,ab as dateString,aM as yakklPrimaryAccountsStore,O as YAKKL_ZERO_ADDRESS,ak as setYakklCurrentlySelectedStorage,l as log$1}from"./Cb2naUpm.js";import{M as Modal}from"./UU1vCwIM.js";import{s as set_text}from"./Cmwrv3PW.js";import{e as each,i as index}from"./DraJ8LN-.js";import{r as remove_input_defaults,a as set_value,s as set_attribute}from"./DTBsVM-c.js";import{d as delegate,b as apply,c as remove_textarea_child,e as event}from"./DiU70Is3.js";import{b as bind_value}from"./B6q982nR.js";import{c as createForm}from"./CEKklR__.js";import"./Doq7snb5.js";import{C as ClipboardIcon,E as EditControls}from"./BELG66li.js";import{c as create$3,a as create$6}from"./B4Ku5_Cd.js";import"./BWiVuumU.js";import{S as SkeletonBalance}from"./3fXJKFcU.js";import{l as log_if_contains_state}from"./DZ17DrFv.js";import{W as WalletManager}from"./BJK8DTVo.js";import{l as log}from"./WDN37msH.js";import{g as get$1}from"./B2gA1VsD.js";import{balanceCacheManager}from"./DpKLkluw.js";import{o as openModal}from"./CZPMS86D.js";import"./CgCfpVku.js";import{UnifiedTimerManager}from"./z-nmOEXa.js";import{t as timeoutClipboard}from"./CnIbzB-6.js";import"./Dw28gLPr.js";import"./D-aJ6pD4.js";AccountForm[FILENAME]="src/lib/components/AccountForm.svelte";var on_click$1=(_,copyAddress,account)=>{var _a;return copyAddress(((_a=account())==null?void 0:_a.address)||"")};var root_2$4=add_locations(from_html(`<p class="mt-2 text-sm text-red-600"> </p>`),AccountForm[FILENAME],[[87,4]]);var root_3$5=add_locations(from_html(`<p class="mt-2 text-sm text-red-600"> </p>`),AccountForm[FILENAME],[[100,4]]);var root_4$1=add_locations(from_html(`<p class="mt-2 text-sm text-red-600"> </p>`),AccountForm[FILENAME],[[113,4]]);var on_click_1=(__1,show)=>show(false);var root_1$6=add_locations(from_html(`<form class="space-y-4 p-6"><div><label class="block text-sm font-medium text-gray-700">Address</label> <div class="mt-1 flex items-center"><input type="text" class="flex-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800 bg-gray-100 cursor-not-allowed" disabled/> <button type="button" class="ml-2 inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"><!></button></div></div> <div><label for="name" class="block text-sm font-medium text-gray-700">Name</label> <input type="text" id="name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800"/> <!></div> <div><label for="alias" class="block text-sm font-medium text-gray-700">Alias</label> <input type="text" id="alias" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800"/> <!></div> <div><label for="description" class="block text-sm font-medium text-gray-700">Description</label> <textarea id="description" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800"></textarea> <!></div> <div class="pt-5"><div class="flex justify-end space-x-4"><button type="button" class="rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">Cancel</button> <button type="button" class="rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">Reset</button> <button type="submit" class="rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">Save</button></div></div></form>`),AccountForm[FILENAME],[[56,1,[[57,2,[[59,3],[60,3,[[61,4],[67,4]]]]],[77,2,[[78,3],[79,3]]],[90,2,[[91,3],[92,3]]],[103,2,[[104,3],[105,3]]],[116,2,[[117,3,[[118,4],[123,4],[128,4]]]]]]]]);function AccountForm($$anchor,$$props){check_target(new.target);push($$props,true,AccountForm);var $$ownership_validator=create_ownership_validator($$props);const[$$stores,$$cleanup]=setup_stores();const $form=()=>(validate_store(form,"form"),store_get(form,"$form",$$stores));const $errors=()=>(validate_store(errors,"errors"),store_get(errors,"$errors",$$stores));let show=prop($$props,"show",15,false),account=prop($$props,"account",3,null),onSubmit=prop($$props,"onSubmit",3,()=>{});const{form:form,errors:errors,handleChange:handleChange,handleSubmit:handleSubmit,updateInitialValues:updateInitialValues}=createForm({initialValues:{name:"",alias:"",description:""},validationSchema:create$3().shape({name:create$6().required("Please enter an account name"),alias:create$6().optional(),description:create$6().optional()}),onSubmit:values=>{if(account()){const updatedAccount={...account(),name:values.name,alias:values.alias,description:values.description};onSubmit()(updatedAccount)}show(false)}});function resetForm(){updateInitialValues({name:"",alias:"",description:""})}function copyAddress(address){navigator.clipboard.writeText(address)}user_effect(()=>{if(account()){updateInitialValues({name:account().name,alias:account().alias||"",description:account().description||""})}else{resetForm()}});const expression=user_derived(()=>account()?"Edit Account":"Add Account");{$$ownership_validator.binding("show",Modal,show);Modal($$anchor,{get title(){return get(expression)},get show(){return show()},set show($$value){show($$value)},children:wrap_snippet(AccountForm,($$anchor2,$$slotProps)=>{var form_1=root_1$6();var div=child(form_1);var div_1=sibling(child(div),2);var input=child(div_1);remove_input_defaults(input);var button=sibling(input,2);button.__click=[on_click$1,copyAddress,account];var node=child(button);ClipboardIcon(node,{class:"h-4 w-4"});reset(button);reset(div_1);reset(div);var div_2=sibling(div,2);var input_1=sibling(child(div_2),2);remove_input_defaults(input_1);input_1.__change=function(...$$args){apply(()=>handleChange,this,$$args,AccountForm,[84,14])};var node_1=sibling(input_1,2);{var consequent=$$anchor3=>{var p=root_2$4();var text=child(p,true);reset(p);template_effect(()=>set_text(text,$errors().name));append($$anchor3,p)};if_block(node_1,$$render=>{if($errors().name)$$render(consequent)})}reset(div_2);var div_3=sibling(div_2,2);var input_2=sibling(child(div_3),2);remove_input_defaults(input_2);input_2.__change=function(...$$args){apply(()=>handleChange,this,$$args,AccountForm,[97,14])};var node_2=sibling(input_2,2);{var consequent_1=$$anchor3=>{var p_1=root_3$5();var text_1=child(p_1,true);reset(p_1);template_effect(()=>set_text(text_1,$errors().alias));append($$anchor3,p_1)};if_block(node_2,$$render=>{if($errors().alias)$$render(consequent_1)})}reset(div_3);var div_4=sibling(div_3,2);var textarea=sibling(child(div_4),2);remove_textarea_child(textarea);textarea.__change=function(...$$args){apply(()=>handleChange,this,$$args,AccountForm,[110,14])};var node_3=sibling(textarea,2);{var consequent_2=$$anchor3=>{var p_2=root_4$1();var text_2=child(p_2,true);reset(p_2);template_effect(()=>set_text(text_2,$errors().description));append($$anchor3,p_2)};if_block(node_3,$$render=>{if($errors().description)$$render(consequent_2)})}reset(div_4);var div_5=sibling(div_4,2);var div_6=child(div_5);var button_1=child(div_6);button_1.__click=[on_click_1,show];var button_2=sibling(button_1,2);button_2.__click=resetForm;next(2);reset(div_6);reset(div_5);reset(form_1);template_effect(()=>{var _a;return set_value(input,((_a=account())==null?void 0:_a.address)||"")});event("submit",form_1,function(...$$args){apply(()=>handleSubmit,this,$$args,AccountForm,[56,17])});bind_value(input_1,()=>$form().name,$$value=>store_mutate(form,untrack($form).name=$$value,untrack($form)));bind_value(input_2,()=>$form().alias,$$value=>store_mutate(form,untrack($form).alias=$$value,untrack($form)));bind_value(textarea,()=>$form().description,$$value=>store_mutate(form,untrack($form).description=$$value,untrack($form)));append($$anchor2,form_1)}),$$slots:{default:true}})}var $$pop=pop({...legacy_api()});$$cleanup();return $$pop}delegate(["click","change"]);BalanceIndicator[FILENAME]="src/lib/components/BalanceIndicator.svelte";var root_3$4=add_locations(from_html(`<div class="flex items-center space-x-1"><span class="text-xs text-red-500">Error loading</span> <button class="text-xs text-blue-500 hover:text-blue-700 underline">Retry</button></div> <span class="text-xs text-gray-400">--</span>`,1),BalanceIndicator[FILENAME],[[35,3,[[36,4],[37,4]]],[41,3]]);var root_5=add_locations(from_html(`<div class="w-3 h-3 border border-blue-400 border-t-transparent rounded-full animate-spin"></div>`),BalanceIndicator[FILENAME],[[48,5]]);var root_7$1=add_locations(from_html(`<div title="Data may be outdated"><svg class="w-3 h-3 text-orange-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg></div>`),BalanceIndicator[FILENAME],[[52,5,[[53,6,[[54,7]]]]]]);var root_9$1=add_locations(from_html(`<div title="Cached data"><svg class="w-3 h-3 text-green-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg></div>`),BalanceIndicator[FILENAME],[[62,5,[[63,6,[[64,7]]]]]]);var root_4=add_locations(from_html(`<div class="flex items-center space-x-1"><span class="text-sm font-semibold text-gray-900"><!></span> <!></div> <span class="text-sm font-semibold text-gray-900"><!></span>`,1),BalanceIndicator[FILENAME],[[43,3,[[44,4]]],[73,3]]);var root_10=add_locations(from_html(`<div class="flex justify-end"><span class="text-xs text-gray-400"> </span></div>`),BalanceIndicator[FILENAME],[[81,2,[[82,3]]]]);var root$3=add_locations(from_html(`<div class="mt-2 space-y-1"><div class="flex items-center justify-between"><!></div> <!></div>`),BalanceIndicator[FILENAME],[[29,0,[[31,1]]]]);function BalanceIndicator($$anchor,$$props){check_target(new.target);push($$props,true,BalanceIndicator);let isLoading=prop($$props,"isLoading",3,false),loadingError=prop($$props,"loadingError",3,null),isCached=prop($$props,"isCached",3,false),isStale=prop($$props,"isStale",3,false),lastUpdated=prop($$props,"lastUpdated",3,null),quantityFormatted=prop($$props,"quantityFormatted",3,""),totalValueFormatted=prop($$props,"totalValueFormatted",3,""),onRetry=prop($$props,"onRetry",3,()=>{});function formatLastUpdated(date){if(!date)return"";const now=new Date;const diffMs=now.getTime()-date.getTime();const diffMins=Math.floor(diffMs/(1e3*60));if(diffMins<1)return"just now";if(diffMins<60)return`${diffMins}m ago`;const diffHours=Math.floor(diffMins/60);if(diffHours<24)return`${diffHours}h ago`;const diffDays=Math.floor(diffHours/24);return`${diffDays}d ago`}var div=root$3();var div_1=child(div);var node=child(div_1);{var consequent=$$anchor2=>{SkeletonBalance($$anchor2,{showLabel:false,className:"h-4"})};var alternate=($$anchor2,$$elseif)=>{{var consequent_1=$$anchor3=>{var fragment_1=root_3$4();var div_2=first_child(fragment_1);var button=sibling(child(div_2),2);button.__click=function(...$$args){apply(onRetry,this,$$args,BalanceIndicator,[37,81])};reset(div_2);next(2);append($$anchor3,fragment_1)};var alternate_1=$$anchor3=>{var fragment_2=root_4();var div_3=first_child(fragment_2);var span=child(div_3);var node_1=child(span);const expression=user_derived(()=>`${quantityFormatted()} ETH`);ProtectedValue(node_1,{get value(){return get(expression)},placeholder:"******* ETH"});reset(span);var node_2=sibling(span,2);{var consequent_2=$$anchor4=>{var div_4=root_5();append($$anchor4,div_4)};var alternate_2=($$anchor4,$$elseif2)=>{{var consequent_3=$$anchor5=>{var div_5=root_7$1();append($$anchor5,div_5)};var alternate_3=($$anchor5,$$elseif3)=>{{var consequent_4=$$anchor6=>{var div_6=root_9$1();append($$anchor6,div_6)};if_block($$anchor5,$$render=>{if(isCached())$$render(consequent_4)},$$elseif3)}};if_block($$anchor4,$$render=>{if(isStale())$$render(consequent_3);else $$render(alternate_3,false)},$$elseif2)}};if_block(node_2,$$render=>{if(isLoading())$$render(consequent_2);else $$render(alternate_2,false)})}reset(div_3);var span_1=sibling(div_3,2);var node_3=child(span_1);ProtectedValue(node_3,{get value(){return totalValueFormatted()},placeholder:"*****"});reset(span_1);append($$anchor3,fragment_2)};if_block($$anchor2,$$render=>{if(loadingError())$$render(consequent_1);else $$render(alternate_1,false)},$$elseif)}};if_block(node,$$render=>{if(isLoading()&&!isCached())$$render(consequent);else $$render(alternate,false)})}reset(div_1);var node_4=sibling(div_1,2);{var consequent_5=$$anchor2=>{var div_7=root_10();var span_2=child(div_7);var text=child(span_2);reset(span_2);reset(div_7);template_effect(($0,$1)=>{set_attribute(span_2,"title",`Last updated: ${$0??""}`);set_text(text,`Updated ${$1??""}`)},[()=>lastUpdated().toLocaleString(),()=>formatLastUpdated(lastUpdated())]);append($$anchor2,div_7)};if_block(node_4,$$render=>{if(lastUpdated()&&(isStale()||isCached()))$$render(consequent_5)})}reset(div);append($$anchor,div);return pop({...legacy_api()})}delegate(["click"]);RestrictedAccountDisplay[FILENAME]="src/lib/components/RestrictedAccountDisplay.svelte";var root_2$3=add_locations(from_html(`<div class="flex items-start rounded-lg p-3 bg-gray-50 border border-gray-200 overflow-hidden"><div><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg></div> <div class="flex-1 min-w-0 overflow-hidden"><div class="flex items-center justify-between mb-1"><h5 class="text-sm font-medium text-gray-700 truncate"> </h5></div> <p class="text-xs text-gray-600 truncate"> </p> <p class="text-xs text-gray-400 mt-1 font-mono truncate"> </p> <div class="flex items-center justify-between mt-2"><div class="text-xs text-gray-500"><span class="bg-gray-200 rounded px-2 py-1">••• ETH</span></div> <div class="text-xs text-gray-500"><span class="bg-gray-200 rounded px-2 py-1">$•••</span></div></div></div></div>`),RestrictedAccountDisplay[FILENAME],[[19,4,[[22,5,[[30,6,[[36,7]]]]],[43,5,[[44,6,[[45,7]]],[53,6],[54,6],[57,6,[[58,7,[[59,8]]],[61,7,[[62,8]]]]]]]]]]);var root_3$3=add_locations(from_html(`<div class="text-center py-2 text-xs text-gray-400"> </div>`),RestrictedAccountDisplay[FILENAME],[[70,4]]);var root_1$5=add_locations(from_html(`<div class="mt-4 border-t border-gray-200 pt-4"><div class="text-center mb-3"><h4 class="text-sm font-medium text-gray-600 mb-1"> </h4> <p class="text-xs text-gray-500">Upgrade to view all your accounts</p></div> <div class="space-y-2 filter blur-sm opacity-50 pointer-events-none overflow-hidden"><!> <!></div> <div class="mt-4 text-center"><button class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white text-sm font-medium rounded-lg hover:from-purple-700 hover:to-blue-700 transition-all duration-200 transform hover:scale-105 shadow-lg"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg> Upgrade to View All Accounts</button> <p class="text-xs text-gray-500 mt-2">Basic members can view up to 3 accounts</p></div></div>`),RestrictedAccountDisplay[FILENAME],[[8,1,[[9,2,[[10,3],[13,3]]],[17,2],[77,2,[[78,3,[[82,4,[[83,5]]]]],[93,3]]]]]]);function RestrictedAccountDisplay($$anchor,$$props){check_target(new.target);push($$props,true,RestrictedAccountDisplay);let onUpgrade=prop($$props,"onUpgrade",3,()=>{});var fragment=comment();var node=first_child(fragment);{var consequent_1=$$anchor2=>{var div=root_1$5();var div_1=child(div);var h4=child(div_1);var text=child(h4);reset(h4);next(2);reset(div_1);var div_2=sibling(div_1,2);var node_1=child(div_2);each(node_1,17,()=>$$props.accounts.slice(0,2),index,($$anchor3,account)=>{var div_3=root_2$3();var div_4=child(div_3);var div_5=sibling(div_4,2);var div_6=child(div_5);var h5=child(div_6);var text_1=child(h5,true);reset(h5);reset(div_6);var p=sibling(div_6,2);var text_2=child(p,true);reset(p);var p_1=sibling(p,2);var text_3=child(p_1);reset(p_1);next(2);reset(div_5);reset(div_3);template_effect(($0,$1)=>{set_class(div_4,1,`w-6 h-6 flex items-center justify-center rounded-full ${strict_equals(get(account).accountType,AccountTypeCategory.PRIMARY)?"bg-purple-400":strict_equals(get(account).accountType,AccountTypeCategory.SUB)?"bg-blue-400":"bg-green-400"} text-white mr-3 shrink-0`);set_text(text_1,strict_equals(get(account).accountType,AccountTypeCategory.PRIMARY)?"PORTFOLIO":strict_equals(get(account).accountType,AccountTypeCategory.SUB)?"SUB-PORTFOLIO":"IMPORTED");set_attribute(p,"title",get(account).name);set_text(text_2,get(account).name);set_attribute(p_1,"title",get(account).address);set_text(text_3,`${$0??""}...${$1??""}`)},[()=>get(account).address.slice(0,6),()=>get(account).address.slice(-4)]);append($$anchor3,div_3)});var node_2=sibling(node_1,2);{var consequent=$$anchor3=>{var div_7=root_3$3();var text_4=child(div_7);reset(div_7);template_effect(()=>set_text(text_4,`... and ${$$props.accounts.length-2} more`));append($$anchor3,div_7)};if_block(node_2,$$render=>{if($$props.accounts.length>2)$$render(consequent)})}reset(div_2);var div_8=sibling(div_2,2);var button=child(div_8);button.__click=function(...$$args){apply(onUpgrade,this,$$args,RestrictedAccountDisplay,[80,13])};next(2);reset(div_8);reset(div);template_effect(()=>set_text(text,`${$$props.accounts.length??""} More Account${$$props.accounts.length>1?"s":""} Available`));append($$anchor2,div)};if_block(node,$$render=>{if($$props.accounts.length>0)$$render(consequent_1)})}append($$anchor,fragment);return pop({...legacy_api()})}delegate(["click"]);SubAccountIndicator[FILENAME]="src/lib/components/SubAccountIndicator.svelte";var root_1$4=add_locations(from_html(`<div><div class="relative"><svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg> <div class="absolute -top-1 -right-1 bg-blue-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center font-bold"> </div></div> <span class="text-xs text-blue-600 font-medium"> </span></div>`),SubAccountIndicator[FILENAME],[[16,1,[[18,2,[[19,3,[[20,4]]],[29,3]]],[37,2]]]]);function SubAccountIndicator($$anchor,$$props){check_target(new.target);push($$props,true,SubAccountIndicator);let className=prop($$props,"className",3,"");const subAccounts=tag(user_derived(()=>()=>{if(strict_equals($$props.primaryAccount.accountType,AccountTypeCategory.PRIMARY,false)){return[]}return $$props.allAccounts.filter(account=>{var _a;return strict_equals(account.accountType,AccountTypeCategory.SUB)&&strict_equals((_a=account.primaryAccount)==null?void 0:_a.address,$$props.primaryAccount.address)})}),"subAccounts");const subAccountCount=tag(user_derived(()=>get(subAccounts)().length),"subAccountCount");var fragment=comment();var node=first_child(fragment);{var consequent=$$anchor2=>{var div=root_1$4();var div_1=child(div);var div_2=sibling(child(div_1),2);var text=child(div_2,true);reset(div_2);reset(div_1);var span=sibling(div_1,2);var text_1=child(span);reset(span);reset(div);template_effect(()=>{set_class(div,1,`flex items-center space-x-1 ${className()??""}`);set_text(text,get(subAccountCount));set_text(text_1,`${get(subAccountCount)??""} sub-account${get(subAccountCount)>1?"s":""}`)});append($$anchor2,div)};if_block(node,$$render=>{if(get(subAccountCount)>0)$$render(consequent)})}append($$anchor,fragment);return pop({...legacy_api()})}EnhancedDeleteConfirmation[FILENAME]="src/lib/components/EnhancedDeleteConfirmation.svelte";function handleConfirm(__1,onConfirm,show){onConfirm()();show(false)}function handleCancel(__2,onCancel,show){onCancel()();show(false)}var root_3$2=add_locations(from_html(`<span class="text-xs text-gray-500">(Sub-account)</span>`),EnhancedDeleteConfirmation[FILENAME],[[237,11]]);var root_6=add_locations(from_html(`<div class="text-xs text-red-500">Error loading</div>`),EnhancedDeleteConfirmation[FILENAME],[[250,10]]);var root_7=add_locations(from_html(`<div class="text-sm font-semibold text-gray-900"> </div> <div class="text-xs text-gray-600"> </div>`,1),EnhancedDeleteConfirmation[FILENAME],[[252,10],[255,10]]);var root_2$2=add_locations(from_html(`<div><div><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg></div> <div class="flex-1 min-w-0"><div class="flex items-center justify-between"><div><p class="text-sm font-medium text-gray-900"> <!></p> <p class="text-xs text-gray-500 font-mono"> </p></div> <div class="text-right"><!></div></div></div></div>`),EnhancedDeleteConfirmation[FILENAME],[[201,5,[[207,6,[[213,7,[[221,8]]]]],[231,6,[[232,7,[[233,8,[[234,9],[240,9]]],[246,8]]]]]]]]);var root_8=add_locations(from_html(`<div class="border-t border-gray-200 pt-3"><div class="flex justify-between items-center"><span class="font-medium text-gray-900">Total Value:</span> <span class="text-lg font-bold text-red-600"> </span></div></div>`),EnhancedDeleteConfirmation[FILENAME],[[268,4,[[269,5,[[270,6],[271,6]]]]]]);var root_9=add_locations(from_html(`<div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg"><div class="flex items-start space-x-2"><svg class="w-5 h-5 text-yellow-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg> <div><p class="text-sm font-medium text-yellow-800">Warning: Accounts contain cryptocurrency</p> <p class="text-sm text-yellow-700 mt-1">Please transfer all funds to another account before deleting. You will lose access to\n\t\t\t\t\t\t\tthese funds permanently.</p></div></div></div>`),EnhancedDeleteConfirmation[FILENAME],[[281,3,[[282,4,[[283,5,[[289,6]]],[296,5,[[297,6],[300,6]]]]]]]]);var root_1$3=add_locations(from_html(`<div class="p-6 space-y-4"><div class="flex items-center space-x-3 p-4 bg-red-50 border border-red-200 rounded-lg"><div class="flex-shrink-0"><svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg></div> <div><h3 class="text-lg font-semibold text-red-800"> </h3> <p class="text-sm text-red-600"> </p></div></div> <div class="space-y-3"><h4 class="font-medium text-gray-900"> </h4> <div class="bg-gray-50 rounded-lg p-4 space-y-3"></div> <!></div> <!> <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200"><button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Cancel</button> <button type="button" class="px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed"> </button></div></div>`),EnhancedDeleteConfirmation[FILENAME],[[168,1,[[170,2,[[171,3,[[172,4,[[173,5]]]]],[181,3,[[182,4],[185,4]]]]],[194,2,[[195,3],[199,3]]],[310,2,[[311,3],[318,3]]]]]]);function EnhancedDeleteConfirmation($$anchor,$$props){check_target(new.target);push($$props,true,EnhancedDeleteConfirmation);var $$ownership_validator=create_ownership_validator($$props);let show=prop($$props,"show",15,false),account=prop($$props,"account",3,null),allAccounts=prop($$props,"allAccounts",19,()=>[]),onConfirm=prop($$props,"onConfirm",3,()=>{}),onCancel=prop($$props,"onCancel",3,()=>{}),onLoadBalance=prop($$props,"onLoadBalance",3,async()=>0n);let accountsWithBalances=tag(state(proxy([])),"accountsWithBalances");let totalValue=tag(state(0),"totalValue");let loading=tag(state(false),"loading");const currency=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2});function getAffectedAccounts(){if(!account())return[];if(strict_equals(account().accountType,AccountTypeCategory.PRIMARY)){const subAccounts=allAccounts().filter(a=>{var _a;return strict_equals(a.accountType,AccountTypeCategory.SUB)&&strict_equals((_a=a.primaryAccount)==null?void 0:_a.address,account().address)});return[account(),...subAccounts]}return[account()]}function shouldShowErrorToUser2(error){const errorMessage=(error==null?void 0:error.message)||(error==null?void 0:error.toString())||"";const networkErrors=["missing response","timeout","TIMEOUT","SERVER_ERROR","NETWORK_ERROR","Failed to fetch","fetch","Connection failed","Request timeout","eth_getBalance","call revert exception","alchemy.com","infura.io","requestBody","serverError","code=SERVER_ERROR","version=web/","JsonRpcError","RPC Error","getBalance","Balance fetch","Balance loading timeout"];return!networkErrors.some(pattern=>errorMessage.toLowerCase().includes(pattern.toLowerCase()))}async function loadBalances(){const affectedAccounts=getAffectedAccounts();if(strict_equals(affectedAccounts.length,0)){set(loading,false);return}set(loading,true);set(accountsWithBalances,affectedAccounts.map(acc=>({account:acc,balance:0n,balanceFormatted:"0.000000",valueFormatted:currency.format(0),isLoading:true,error:null})),true);const balancePromises=get(accountsWithBalances).map(async(item,index2)=>{try{const balancePromise=onLoadBalance()(item.account.address);const timeoutPromise=new Promise((_,reject)=>{setTimeout(()=>reject(new Error("Balance loading timeout")),3e3)});const balance=await Promise.race([balancePromise,timeoutPromise]);const balanceNum=Number(balance)/1e18;const balanceFormatted=balanceNum.toFixed(6);const value=balanceNum*3e3;const valueFormatted=currency.format(value);get(accountsWithBalances)[index2]={...item,balance:balance,balanceFormatted:balanceFormatted,valueFormatted:valueFormatted,isLoading:false,error:null};set(accountsWithBalances,[...get(accountsWithBalances)],true)}catch(error){if(shouldShowErrorToUser2(error)){console.error(...log_if_contains_state("error","[EnhancedDeleteConfirmation] Balance loading error:",error))}get(accountsWithBalances)[index2]={...item,isLoading:false,error:"Unable to load"};set(accountsWithBalances,[...get(accountsWithBalances)],true)}});try{await Promise.race([Promise.all(balancePromises),new Promise((_,reject)=>{setTimeout(()=>reject(new Error("Overall timeout")),5e3)})])}catch(error){console.warn("[EnhancedDeleteConfirmation] Balance loading timed out, proceeding with available data")}set(totalValue,get(accountsWithBalances).reduce((sum,item)=>{if(!item.error&&!item.isLoading){const value=Number(item.balance)/1e18*3e3;return sum+value}return sum},0),true);set(loading,false)}function resetState(){set(accountsWithBalances,[],true);set(totalValue,0);set(loading,false)}user_effect(()=>{if(show()&&account()){loadBalances()}else if(!show()){resetState()}});function getAccountIcon(accountType){switch(accountType){case AccountTypeCategory.PRIMARY:return"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10";case AccountTypeCategory.SUB:return"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2";default:return"M12 11c0 3.517-1.009 6.799-2.753 9.571m-3.44-2.04l.054-.09A13.916 13.916 0 008 11a4 4 0 118 0c0 1.017-.07 2.019-.203 3m-2.118 6.844A21.88 21.88 0 0015.171 17m3.839 1.132c.645-2.266.99-4.659.99-7.132A8 8 0 008 4.07M3 15.364c.64-1.319 1-2.8 1-4.364 0-1.457.39-2.823 1.07-4"}}const isPrimaryAccountWithSubs=tag(user_derived(()=>()=>{var _a;return strict_equals((_a=account())==null?void 0:_a.accountType,AccountTypeCategory.PRIMARY)&&get(accountsWithBalances).length>1}),"isPrimaryAccountWithSubs");{$$ownership_validator.binding("show",Modal,show);Modal($$anchor,{title:"Delete Account Confirmation",className:"z-[900]",get show(){return show()},set show($$value){show($$value)},children:wrap_snippet(EnhancedDeleteConfirmation,($$anchor2,$$slotProps)=>{var div=root_1$3();var div_1=child(div);var div_2=sibling(child(div_1),2);var h3=child(div_2);var text=child(h3,true);reset(h3);var p=sibling(h3,2);var text_1=child(p);reset(p);reset(div_2);reset(div_1);var div_3=sibling(div_1,2);var h4=child(div_3);var text_2=child(h4,true);reset(h4);var div_4=sibling(h4,2);each(div_4,21,()=>get(accountsWithBalances),index,($$anchor3,item)=>{var div_5=root_2$2();var div_6=child(div_5);var svg=child(div_6);var path=child(svg);reset(svg);reset(div_6);var div_7=sibling(div_6,2);var div_8=child(div_7);var div_9=child(div_8);var p_1=child(div_9);var text_3=child(p_1);var node=sibling(text_3);{var consequent=$$anchor4=>{var span=root_3$2();append($$anchor4,span)};if_block(node,$$render=>{if(strict_equals(get(item).account.accountType,AccountTypeCategory.SUB))$$render(consequent)})}reset(p_1);var p_2=sibling(p_1,2);var text_4=child(p_2);reset(p_2);reset(div_9);var div_10=sibling(div_9,2);var node_1=child(div_10);{var consequent_1=$$anchor4=>{SkeletonBalance($$anchor4,{showLabel:false,className:"w-16"})};var alternate=($$anchor4,$$elseif)=>{{var consequent_2=$$anchor5=>{var div_11=root_6();append($$anchor5,div_11)};var alternate_1=$$anchor5=>{var fragment_2=root_7();var div_12=first_child(fragment_2);var text_5=child(div_12);reset(div_12);var div_13=sibling(div_12,2);var text_6=child(div_13,true);reset(div_13);template_effect(()=>{set_text(text_5,`${get(item).balanceFormatted??""} ETH`);set_text(text_6,get(item).valueFormatted)});append($$anchor5,fragment_2)};if_block($$anchor4,$$render=>{if(get(item).error)$$render(consequent_2);else $$render(alternate_1,false)},$$elseif)}};if_block(node_1,$$render=>{if(get(item).isLoading)$$render(consequent_1);else $$render(alternate,false)})}reset(div_10);reset(div_8);reset(div_7);reset(div_5);template_effect(($0,$1,$2)=>{set_class(div_5,1,`flex items-start space-x-3 ${strict_equals(get(item).account.accountType,AccountTypeCategory.SUB)?"ml-6 border-l-2 border-blue-200 pl-4":""}`);set_class(div_6,1,`flex-shrink-0 w-8 h-8 rounded-full ${strict_equals(get(item).account.accountType,AccountTypeCategory.PRIMARY)?"bg-purple-100":"bg-blue-100"} flex items-center justify-center`);set_class(svg,0,`w-4 h-4 ${strict_equals(get(item).account.accountType,AccountTypeCategory.PRIMARY)?"text-purple-600":"text-blue-600"}`);set_attribute(path,"d",$0);set_text(text_3,`${get(item).account.name??""} `);set_text(text_4,`${$1??""}...${$2??""}`)},[()=>getAccountIcon(get(item).account.accountType),()=>get(item).account.address.slice(0,6),()=>get(item).account.address.slice(-4)]);append($$anchor3,div_5)});reset(div_4);var node_2=sibling(div_4,2);{var consequent_3=$$anchor3=>{var div_14=root_8();var div_15=child(div_14);var span_1=sibling(child(div_15),2);var text_7=child(span_1,true);reset(span_1);reset(div_15);reset(div_14);template_effect($0=>set_text(text_7,$0),[()=>currency.format(get(totalValue))]);append($$anchor3,div_14)};if_block(node_2,$$render=>{if(!get(loading)&&get(totalValue)>0)$$render(consequent_3)})}reset(div_3);var node_3=sibling(div_3,2);{var consequent_4=$$anchor3=>{var div_16=root_9();append($$anchor3,div_16)};if_block(node_3,$$render=>{if(get(totalValue)>0&&!get(loading))$$render(consequent_4)})}var div_17=sibling(node_3,2);var button=child(div_17);button.__click=[handleCancel,onCancel,show];var button_1=sibling(button,2);button_1.__click=[handleConfirm,onConfirm,show];var text_8=child(button_1,true);reset(button_1);reset(div_17);reset(div);template_effect(()=>{set_text(text,get(isPrimaryAccountWithSubs)?"Delete Primary Account & Sub-Accounts":"Delete Account");set_text(text_1,`This action cannot be undone and will permanently delete the account${get(isPrimaryAccountWithSubs)?"s":""}.`);set_text(text_2,get(isPrimaryAccountWithSubs)?"Accounts to be deleted:":"Account to be deleted:");button_1.disabled=get(loading);set_text(text_8,get(loading)?"Loading...":`Delete Account${get(isPrimaryAccountWithSubs)?"s":""}`)});append($$anchor2,div)}),$$slots:{default:true}})}return pop({...legacy_api()})}delegate(["click"]);function shouldShowErrorToUser(error){const errorMessage=(error==null?void 0:error.message)||(error==null?void 0:error.toString())||"";const networkErrors=["missing response","timeout","TIMEOUT","SERVER_ERROR","NETWORK_ERROR","Failed to fetch","fetch","Connection failed","Request timeout","eth_getBalance","call revert exception","alchemy.com","infura.io","requestBody","serverError","code=SERVER_ERROR","version=web/","JsonRpcError","RPC Error","getBalance","Balance fetch"];return!networkErrors.some(pattern=>errorMessage.toLowerCase().includes(pattern.toLowerCase()))}function collectAccountDataProgressive(accounts,wallet,onUpdate){var _a;const price=((_a=get$1(yakklPricingStore))==null?void 0:_a.price)??0;const currency=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2});const initialData=accounts.map(account=>{const cached=balanceCacheManager.getCachedBalance(account.address);if(cached){const quantityFormatted=(Number(cached.balance)/1e18).toFixed(6);const totalValue=Number(cached.balance)/1e18*price;const totalValueFormatted=currency.format(totalValue);const isStale=balanceCacheManager.isStale(account.address);return{account:account,quantity:cached.balance,quantityFormatted:quantityFormatted,totalValue:totalValue,totalValueFormatted:totalValueFormatted,isLoading:false,lastUpdated:new Date(cached.timestamp),loadingError:null,isCached:true,isStale:isStale}}else{return{account:account,quantity:0n,quantityFormatted:"0.000000",totalValue:0,totalValueFormatted:currency.format(0),isLoading:true,lastUpdated:null,loadingError:null,isCached:false,isStale:false}}});const loadingPromises=initialData.map(async(accountData,index2)=>{const veryStale=accountData.lastUpdated&&Date.now()-accountData.lastUpdated.getTime()>10*60*1e3;if(!veryStale&&accountData.isCached){return}try{if(!accountData.isCached){accountData.isLoading=true;onUpdate([...initialData])}const balancePromise=wallet.getBalance(accountData.account.address);const timeoutPromise=new Promise((_,reject)=>{setTimeout(()=>reject(new Error("Balance fetch timeout")),8e3)});const quantity=await Promise.race([balancePromise,timeoutPromise]);balanceCacheManager.setCachedBalance(accountData.account.address,quantity,price);const quantityFormatted=(Number(quantity)/1e18).toFixed(6);const totalValue=Number(quantity)/1e18*price;const totalValueFormatted=currency.format(totalValue);initialData[index2]={...accountData,quantity:quantity,quantityFormatted:quantityFormatted,totalValue:totalValue,totalValueFormatted:totalValueFormatted,isLoading:false,lastUpdated:new Date,loadingError:null,isCached:false,isStale:false};onUpdate([...initialData])}catch(error){if(shouldShowErrorToUser(error)){log.warn(`[collectAccountDataProgressive] Failed to load balance for ${accountData.account.address}:`,false,error)}const errorMessage=error instanceof Error?error.message:"Failed to load balance";const isTimeout=errorMessage.includes("timeout")||errorMessage.includes("TIMEOUT");const displayError=isTimeout?accountData.isCached?null:"Network slow, using cached data":"Network error";initialData[index2]={...accountData,isLoading:false,loadingError:displayError};onUpdate([...initialData])}});Promise.all(loadingPromises).then(()=>{balanceCacheManager.cleanupExpired()});return initialData}function createAccountDataWithRestrictions(accounts,membershipLevel,maxAccountsForBasic=3){const isBasicMember=membershipLevel==="basic_member";if(!isBasicMember||accounts.length<=maxAccountsForBasic){return{visibleAccounts:accounts,restrictedAccounts:[],isRestricted:false}}return{visibleAccounts:accounts.slice(0,maxAccountsForBasic),restrictedAccounts:accounts.slice(maxAccountsForBasic),isRestricted:true}}AccountListing[FILENAME]="src/lib/components/AccountListing.svelte";var on_click=(_,onAccountSelect,data)=>onAccountSelect()(get(data).account);var root_3$1=add_locations(from_html(`<span class="text-xs text-gray-500 mb-1 block truncate"> </span>`),AccountListing[FILENAME],[[388,6]]);var root_1$2=add_locations(from_html(`<li class="mb-3 relative overflow-hidden"><button><div><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg></div> <div class="flex-1 min-w-0 overflow-hidden"><div class="flex items-center justify-between mb-1"><div class="flex items-center space-x-2"><h3 class="text-sm font-semibold text-gray-800"> </h3> <!></div></div> <p class="text-sm font-medium text-gray-700 truncate mb-1"> </p> <!> <p class="text-xs text-gray-500 font-mono truncate mb-2"> </p> <!></div></button> <!></li>`),AccountListing[FILENAME],[[333,2,[[334,3,[[343,4,[[351,5,[[357,6]]]]],[364,4,[[365,5,[[366,6,[[367,7]]]]],[384,5],[394,5]]]]]]]]);var root$2=add_locations(from_html(`<ul class="overflow-hidden"></ul> <!> <!> <!>`,1),AccountListing[FILENAME],[[331,0]]);function AccountListing($$anchor,$$props){check_target(new.target);push($$props,true,AccountListing);var $$ownership_validator=create_ownership_validator($$props);const[$$stores,$$cleanup]=setup_stores();const $yakklSettingsStore=()=>(validate_store(yakklSettingsStore,"yakklSettingsStore"),store_get(yakklSettingsStore,"$yakklSettingsStore",$$stores));const $yakklPricingStore=()=>(validate_store(yakklPricingStore,"yakklPricingStore"),store_get(yakklPricingStore,"$yakklPricingStore",$$stores));const $yakklAccountsStore=()=>(validate_store(yakklAccountsStore,"yakklAccountsStore"),store_get(yakklAccountsStore,"$yakklAccountsStore",$$stores));const $yakklCurrentlySelectedStore=()=>(validate_store(yakklCurrentlySelectedStore,"yakklCurrentlySelectedStore"),store_get(yakklCurrentlySelectedStore,"$yakklCurrentlySelectedStore",$$stores));const $yakklPrimaryAccountsStore=()=>(validate_store(yakklPrimaryAccountsStore,"yakklPrimaryAccountsStore"),store_get(yakklPrimaryAccountsStore,"$yakklPrimaryAccountsStore",$$stores));let accounts=prop($$props,"accounts",31,()=>tag_proxy(proxy([]),"accounts")),onAccountSelect=prop($$props,"onAccountSelect",3,()=>{}),onUpgrade=prop($$props,"onUpgrade",3,()=>{});let editMode=tag(state(false),"editMode");let showEnhancedDeleteModal=tag(state(false),"showEnhancedDeleteModal");let selectedAccount=tag(state(null),"selectedAccount");let wallet=tag(state(null),"wallet");let accountData=tag(state(proxy([])),"accountData");let visibleAccounts=tag(state(proxy([])),"visibleAccounts");let restrictedAccounts=tag(state(proxy([])),"restrictedAccounts");let isRestricted=tag(state(false),"isRestricted");let loadDataTimeout=null;let isLoadingData=tag(state(false),"isLoadingData");let isInitialized=tag(state(false),"isInitialized");let initializationTimeout=null;let lastProcessedAccountsHash=tag(state(""),"lastProcessedAccountsHash");function handleAccountDataUpdate(data){set(accountData,data,true)}function retryBalance(accountAddress){if(!get(wallet))return;const accountIndex=get(accountData).findIndex(data=>strict_equals(data.account.address,accountAddress));if(strict_equals(accountIndex,-1))return;balanceCacheManager.clearCachedBalance(accountAddress);loadAccountData()}function loadAccountDataDebounced(){if(loadDataTimeout){clearTimeout(loadDataTimeout)}if(get(isLoadingData)||!get(wallet)||strict_equals(get(visibleAccounts).length,0)){if(!get(wallet)||strict_equals(get(visibleAccounts).length,0)){set(accountData,[],true)}return}loadDataTimeout=setTimeout(()=>{loadAccountData()},300)}function loadAccountData(){if(!get(wallet)||strict_equals(get(visibleAccounts).length,0)){set(accountData,[],true);return}if(get(isLoadingData)){log.debug("[AccountListing] Already loading data, skipping");return}set(isLoadingData,true);log.info("[AccountListing] Starting progressive balance loading for accounts:",false,{accountCount:get(visibleAccounts).length,addresses:get(visibleAccounts).map(a=>a.address)});try{set(accountData,collectAccountDataProgressive(get(visibleAccounts),get(wallet),data=>{handleAccountDataUpdate(data);set(isLoadingData,false)}),true)}catch(error){log.error("[AccountListing] Error loading account data:",false,error);set(isLoadingData,false)}}user_effect(()=>{var _a;if(accounts().length>0&&$yakklSettingsStore()){const currentAccountsHash=accounts().map(a=>a.address).join(",");if(strict_equals(currentAccountsHash,get(lastProcessedAccountsHash),false)){set(lastProcessedAccountsHash,currentAccountsHash,true);const membershipLevel=((_a=$yakklSettingsStore().plan)==null?void 0:_a.type)||"basic_member";const restrictions=createAccountDataWithRestrictions(accounts(),membershipLevel,3);set(visibleAccounts,restrictions.visibleAccounts,true);set(restrictedAccounts,restrictions.restrictedAccounts,true);set(isRestricted,restrictions.isRestricted,true);log.info("[AccountListing] Account restrictions applied:",false,{membershipLevel:membershipLevel,totalAccounts:accounts().length,visibleAccounts:get(visibleAccounts).length,restrictedAccounts:get(restrictedAccounts).length,isRestricted:get(isRestricted)})}}});user_effect(()=>{if(!get(isInitialized)||!get(wallet)||!$yakklPricingStore()||strict_equals(get(visibleAccounts).length,0)){return}const priceChange=Math.abs(($yakklPricingStore().price-$yakklPricingStore().prevPrice)/$yakklPricingStore().prevPrice);if(priceChange>.05){log.info("[AccountListing] Major price change detected, reloading account data");loadAccountDataDebounced()}});user_effect(()=>{if(!get(isInitialized)||!get(wallet)||strict_equals(get(visibleAccounts).length,0)){return}loadAccountDataDebounced()});onMount(()=>{if(!accounts().length){accounts($yakklAccountsStore())}set(wallet,WalletManager.getInstance(["Alchemy"],["Ethereum"],$yakklCurrentlySelectedStore().shortcuts.chainId??1,"pBm4VA9q8Laz9x3bmXTNZ9m-ArxczEWk"),true);const addresses=accounts().map(a=>a.address);const preloaded=balanceCacheManager.preloadBalances(addresses);log.info(`[AccountListing] Preloaded ${preloaded.size} balances from cache`);initializationTimeout=setTimeout(()=>{set(isInitialized,true);log.debug("[AccountListing] Reactive effects initialized")},500)});onDestroy(()=>{if(loadDataTimeout){clearTimeout(loadDataTimeout);loadDataTimeout=null}if(initializationTimeout){clearTimeout(initializationTimeout);initializationTimeout=null}});function handleEdit(account){set(selectedAccount,account,true);set(editMode,true)}function handleDelete(account){set(selectedAccount,account,true);set(showEnhancedDeleteModal,true)}async function confirmDelete(){var _a;if(get(selectedAccount)){if(strict_equals(get(selectedAccount).accountType,AccountTypeCategory.PRIMARY)){let subAccounts=accounts().filter(a=>{var _a2;return strict_equals((_a2=a.primaryAccount)==null?void 0:_a2.address,get(selectedAccount).address)});subAccounts.forEach(subAccount=>{const index2=accounts().findIndex(a=>strict_equals(a.address,subAccount.address));if(strict_equals(index2,-1,false)){accounts().splice(index2,1)}})}accounts(accounts().filter(a=>strict_equals(a.address,get(selectedAccount).address,false)));setYakklAccountsStorage(accounts());store_set(yakklAccountsStore,accounts());if(strict_equals(get(selectedAccount).accountType,AccountTypeCategory.PRIMARY)){let primaryAccounts=$yakklPrimaryAccountsStore().filter(a=>strict_equals(a.address,get(selectedAccount).address,false));setYakklPrimaryAccountsStorage(primaryAccounts);set(selectedAccount,null)}else{if(strict_equals(get(selectedAccount).address,$yakklCurrentlySelectedStore().shortcuts.address)){set(selectedAccount,(_a=get(selectedAccount).primaryAccount)==null?void 0:_a.account,true);onAccountSelect()(get(selectedAccount))}}set(showEnhancedDeleteModal,false)}}function shouldShowErrorToUser2(error){const errorMessage=(error==null?void 0:error.message)||(error==null?void 0:error.toString())||"";const networkErrors=["missing response","timeout","TIMEOUT","SERVER_ERROR","NETWORK_ERROR","Failed to fetch","fetch","Connection failed","Request timeout","eth_getBalance","call revert exception","alchemy.com","infura.io","requestBody","serverError","code=SERVER_ERROR","version=web/","JsonRpcError","RPC Error","getBalance","Balance fetch"];return!networkErrors.some(pattern=>errorMessage.toLowerCase().includes(pattern.toLowerCase()))}function updateAccount(updatedAccount){const index2=accounts().findIndex(a=>strict_equals(a.address,updatedAccount.address));if(strict_equals(index2,-1,false)){$$ownership_validator.mutation("accounts",["accounts",index2],accounts(accounts()[index2]={...updatedAccount,updateDate:dateString()},true),269,4);if(strict_equals(updatedAccount.accountType,AccountTypeCategory.PRIMARY)){updatePrimaryAndSubAccounts(updatedAccount)}setYakklAccountsStorage(accounts());store_set(yakklAccountsStore,accounts());set(selectedAccount,updatedAccount,true)}set(editMode,false)}function updatePrimaryAndSubAccounts(updatedPrimaryAccount){let primaryAccount=$yakklPrimaryAccountsStore().find(a=>strict_equals(a.address,updatedPrimaryAccount.address));if(primaryAccount){primaryAccount.name=updatedPrimaryAccount.name;primaryAccount.updateDate=dateString();setYakklPrimaryAccountsStorage($yakklPrimaryAccountsStore())}let subAccounts=accounts().filter(a=>{var _a;return strict_equals((_a=a.primaryAccount)==null?void 0:_a.address,updatedPrimaryAccount.address)});subAccounts.forEach(subAccount=>{const index2=accounts().findIndex(a=>strict_equals(a.address,subAccount.address));if(strict_equals(index2,-1,false)){$$ownership_validator.mutation("accounts",["accounts",index2,"primaryAccount","name"],accounts(accounts()[index2].primaryAccount.name=updatedPrimaryAccount.name,true),294,6);$$ownership_validator.mutation("accounts",["accounts",index2,"primaryAccount","updateDate"],accounts(accounts()[index2].primaryAccount.updateDate=dateString(),true),295,6)}})}function handleCopy(account){navigator.clipboard.writeText(account.address)}async function loadBalanceForDelete(address){const cached=balanceCacheManager.getCachedBalance(address);if(cached){log.info(`[AccountListing] Using cached balance for delete confirmation: ${address}`);return cached.balance}const accountDataItem=get(accountData).find(data=>strict_equals(data.account.address,address));if(accountDataItem&&!accountDataItem.isLoading&&!accountDataItem.loadingError){log.info(`[AccountListing] Using accountData balance for delete confirmation: ${address}`);return accountDataItem.quantity}if(!get(wallet))return 0n;try{const balance=await get(wallet).getBalance(address);log.info(`[AccountListing] Fetched fresh balance for delete confirmation: ${address}`);return balance}catch(error){if(shouldShowErrorToUser2(error)){log.warn(`[AccountListing] Failed to load balance for delete confirmation: ${address}`,false,error)}return 0n}}var fragment=root$2();var ul=first_child(fragment);each(ul,21,()=>get(accountData),index,($$anchor2,data)=>{var li=root_1$2();var button=child(li);button.__click=[on_click,onAccountSelect,data];var div=child(button);var div_1=sibling(div,2);var div_2=child(div_1);var div_3=child(div_2);var h3=child(div_3);var text=child(h3,true);reset(h3);var node=sibling(h3,2);{var consequent=$$anchor3=>{SubAccountIndicator($$anchor3,{get primaryAccount(){return get(data).account},get allAccounts(){return accounts()},className:"ml-1"})};if_block(node,$$render=>{if(strict_equals(get(data).account.accountType,AccountTypeCategory.PRIMARY))$$render(consequent)})}reset(div_3);reset(div_2);var p=sibling(div_2,2);var text_1=child(p,true);reset(p);var node_1=sibling(p,2);{var consequent_1=$$anchor3=>{var span=root_3$1();var text_2=child(span);reset(span);template_effect(()=>{var _a,_b;set_attribute(span,"title",`Derived from ${((_a=get(data).account.primaryAccount)==null?void 0:_a.name)??""}`);set_text(text_2,`Derived from ${((_b=get(data).account.primaryAccount)==null?void 0:_b.name)??""}`)});append($$anchor3,span)};if_block(node_1,$$render=>{if(strict_equals(get(data).account.accountType,AccountTypeCategory.SUB))$$render(consequent_1)})}var p_1=sibling(node_1,2);var text_3=child(p_1,true);reset(p_1);var node_2=sibling(p_1,2);BalanceIndicator(node_2,{get isLoading(){return get(data).isLoading},get loadingError(){return get(data).loadingError},get isCached(){return get(data).isCached},get isStale(){return get(data).isStale},get lastUpdated(){return get(data).lastUpdated},get quantityFormatted(){return get(data).quantityFormatted},get totalValueFormatted(){return get(data).totalValueFormatted},onRetry:()=>retryBalance(get(data).account.address)});reset(div_1);reset(button);var node_3=sibling(button,2);const expression=user_derived(()=>get(data).quantity>0n);EditControls(node_3,{onEdit:()=>handleEdit(get(data).account),onDelete:()=>handleDelete(get(data).account),onCopy:()=>handleCopy(get(data).account),controls:["copy","edit","delete"],get hasBalance(){return get(expression)}});reset(li);template_effect(()=>{set_class(button,1,`w-full flex items-start rounded-lg p-3 transition-colors duration-200 overflow-hidden ${strict_equals(get(data).account.accountType,AccountTypeCategory.PRIMARY)?"bg-purple-50 hover:bg-purple-100 border border-purple-200":strict_equals(get(data).account.accountType,AccountTypeCategory.SUB)?"bg-blue-50 hover:bg-blue-100 border border-blue-200":"bg-green-50 hover:bg-green-100 border border-green-200"}`);set_class(div,1,`w-6 h-6 flex items-center justify-center rounded-full ${strict_equals(get(data).account.accountType,AccountTypeCategory.PRIMARY)?"bg-purple-500":strict_equals(get(data).account.accountType,AccountTypeCategory.SUB)?"bg-blue-500":"bg-green-500"} text-white mr-3 shrink-0`);set_text(text,strict_equals(get(data).account.accountType,AccountTypeCategory.PRIMARY)?"PORTFOLIO":strict_equals(get(data).account.accountType,AccountTypeCategory.SUB)?"SUB-PORTFOLIO":"IMPORTED");set_attribute(p,"title",get(data).account.name);set_text(text_1,get(data).account.name);set_attribute(p_1,"title",get(data).account.address);set_text(text_3,get(data).account.address)});append($$anchor2,li)});reset(ul);var node_4=sibling(ul,2);{var consequent_2=$$anchor2=>{RestrictedAccountDisplay($$anchor2,{get accounts(){return get(restrictedAccounts)},onUpgrade:onUpgrade()})};if_block(node_4,$$render=>{if(get(isRestricted))$$render(consequent_2)})}var node_5=sibling(node_4,2);AccountForm(node_5,{get account(){return get(selectedAccount)},onSubmit:updateAccount,get show(){return get(editMode)},set show($$value){set(editMode,$$value,true)}});var node_6=sibling(node_5,2);EnhancedDeleteConfirmation(node_6,{get account(){return get(selectedAccount)},get allAccounts(){return accounts()},onConfirm:confirmDelete,onCancel:()=>set(showEnhancedDeleteModal,false),onLoadBalance:loadBalanceForDelete,get show(){return get(showEnhancedDeleteModal)},set show($$value){set(showEnhancedDeleteModal,$$value,true)}});append($$anchor,fragment);var $$pop=pop({...legacy_api()});$$cleanup();return $$pop}delegate(["click"]);Accounts[FILENAME]="src/lib/components/Accounts.svelte";var root_1$1=add_locations(from_html(`<p class="text-sm text-gray-500">Whatever account you select will become your <span class="font-bold underline">active</span> account!</p>`),Accounts[FILENAME],[[104,3,[[105,49]]]]);var root_3=add_locations(from_html(`<p class="text-lg font-bold text-red-500">There are no Portfolio Accounts to display! Create at least one Portfolio account!</p>`),Accounts[FILENAME],[[97,4]]);var root_2$1=add_locations(from_html(`<div class="border-t border-b border-gray-500 py-4"><!> <!></div>`),Accounts[FILENAME],[[89,2]]);var root$1=add_locations(from_html(`<div><!></div>`),Accounts[FILENAME],[[81,0]]);function Accounts($$anchor,$$props){check_target(new.target);push($$props,true,Accounts);var $$ownership_validator=create_ownership_validator($$props);const[$$stores,$$cleanup]=setup_stores();const $yakklCurrentlySelectedStore=()=>(validate_store(yakklCurrentlySelectedStore,"yakklCurrentlySelectedStore"),store_get(yakklCurrentlySelectedStore,"$yakklCurrentlySelectedStore",$$stores));const $yakklAccountsStore=()=>(validate_store(yakklAccountsStore,"yakklAccountsStore"),store_get(yakklAccountsStore,"$yakklAccountsStore",$$stores));let account=prop($$props,"account",15,null),show=prop($$props,"show",15,false),onAccountSelect=prop($$props,"onAccountSelect",3,null),onClose=prop($$props,"onClose",3,null),className=prop($$props,"className",3,"z-[999]");async function handleAccountSelect(selectedAccount){try{log.info("[Accounts] Account selected:",false,{name:selectedAccount.name,address:selectedAccount.address,type:selectedAccount.accountType,currentShowState:show()});if(strict_equals(account(),null,false)){account(selectedAccount)}if(strict_equals(onAccountSelect(),null,false)){onAccountSelect()(selectedAccount)}const currentlySelected=$yakklCurrentlySelectedStore();if(currentlySelected){const updatedCurrentlySelected={...currentlySelected,shortcuts:{...currentlySelected.shortcuts,address:selectedAccount.address,accountName:selectedAccount.name,accountType:selectedAccount.accountType,alias:selectedAccount.alias,quantity:0n,primary:strict_equals(selectedAccount.accountType,"sub")?selectedAccount.primaryAccount:null},updateDate:dateString()};await setYakklCurrentlySelectedStorage(updatedCurrentlySelected);log.info("[Accounts] Successfully updated currently selected account, closing modal")}else{log.warn("[Accounts] No currently selected store found, cannot update account")}show(false);if(onClose()){onClose()()}log.info("[Accounts] Modal show state set to false:",false,{show:show()})}catch(error){log.error("[Accounts] Failed to update selected account:",false,error);show(false);if(onClose()){onClose()()}}}function handleUpgrade(){show(false);openModal("upgrade")}function closeModal(){show(false);if(onClose()){onClose()()}}var div=root$1();var node=child(div);{const footer=wrap_snippet(Accounts,function($$anchor2){validate_snippet_args(...arguments);var p=root_1$1();append($$anchor2,p)});$$ownership_validator.binding("show",Modal,show);Modal(node,{title:"Account List",description:"Select the account you wish to make current",onClose:closeModal,onCancel:closeModal,get show(){return show()},set show($$value){show($$value)},footer:footer,children:wrap_snippet(Accounts,($$anchor2,$$slotProps)=>{var div_1=root_2$1();var node_1=child(div_1);AccountListing(node_1,{get accounts(){return $yakklAccountsStore()},onAccountSelect:handleAccountSelect,onUpgrade:handleUpgrade});var node_2=sibling(node_1,2);{var consequent=$$anchor3=>{var p_1=root_3();append($$anchor3,p_1)};if_block(node_2,$$render=>{if($yakklCurrentlySelectedStore()&&strict_equals($yakklCurrentlySelectedStore().shortcuts.address,YAKKL_ZERO_ADDRESS))$$render(consequent)})}reset(div_1);append($$anchor2,div_1)}),$$slots:{footer:true,default:true}})}reset(div);template_effect(()=>set_class(div,1,`relative ${className()??""}`));append($$anchor,div);var $$pop=pop({...legacy_api()});$$cleanup();return $$pop}Copy[FILENAME]="src/lib/components/Copy.svelte";async function copyToClipboard(_,$$props,handleMultiCopy,handleSingleCopy,showFeedback,isCopied,timerManager,feedbackDuration){try{if(Array.isArray($$props.target)){await handleMultiCopy($$props.target)}else{await handleSingleCopy($$props.target)}if(showFeedback()){set(isCopied,true);timerManager.addTimeout("copy-feedback",()=>{set(isCopied,false)},feedbackDuration());timerManager.startTimeout("copy-feedback")}}catch(err){set(isCopied,false)}}var root_1=add_locations(from_html(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-500" aria-hidden="true"><path d="M20 6L9 17l-5-5"></path></svg> <span class="sr-only">Copied!</span>`,1),Copy[FILENAME],[[124,2,[[137,3]]],[139,2]]);var root_2=add_locations(from_html(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500 hover:text-blue-500 transition-colors duration-200" aria-hidden="true"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg> <span class="sr-only">Copy to clipboard</span>`,1),Copy[FILENAME],[[141,2,[[154,3],[155,3]]],[157,2]]);var root=add_locations(from_html(`<button type="button" title="Copy to clipboard"><!></button>`),Copy[FILENAME],[[104,0]]);function Copy($$anchor,$$props){check_target(new.target);push($$props,true,Copy);const size=prop($$props,"size",3,20),className=prop($$props,"className",3,""),showFeedback=prop($$props,"showFeedback",3,true),feedbackDuration=prop($$props,"feedbackDuration",3,2e3),defaultRedactText=prop($$props,"defaultRedactText",3,"<redacted>"),onClick=prop($$props,"onClick",19,()=>void 0);let isCopied=tag(state(false),"isCopied");let timeoutIds=new Map;const timerManager=UnifiedTimerManager.getInstance();function getValue(copyTarget){if(copyTarget.id){const element=document.getElementById(copyTarget.id);if(element instanceof HTMLInputElement||element instanceof HTMLTextAreaElement){return element.value}else if(element){return element.textContent||""}log$1.warn(`Element with id '${copyTarget.id}' not found`);return""}const value=copyTarget.value;if(strict_equals(value,null)||strict_equals(value,void 0)){return""}return value.toString()}async function handleSingleCopy(copyTarget){const value=getValue(copyTarget);await navigator.clipboard.writeText(value);if(onClick()){onClick()(value)}if(copyTarget.timeout){timeoutClipboard(copyTarget.timeout,copyTarget.redactText||defaultRedactText())}}async function handleMultiCopy(copyTargets){const values=copyTargets.map(target2=>getValue(target2));const combinedValue=values.join("\n");await navigator.clipboard.writeText(combinedValue);if(onClick()){onClick()(combinedValue)}copyTargets.forEach((target2,index2)=>{if(target2.timeout){const timerId=`copy-timeout-${target2.id||index2}`;timerManager.addTimeout(timerId,async()=>{const currentValues=[...values];const redactText=target2.redactText||defaultRedactText();currentValues[index2]=redactText;await navigator.clipboard.writeText(currentValues.join("\n"));timeoutIds.delete(target2.id||values[index2])},target2.timeout);timerManager.startTimeout(timerId);timeoutIds.set(target2.id||values[index2],timerId)}})}user_effect(()=>()=>{timeoutIds.forEach(timerId=>{timerManager.stopTimeout(timerId);timerManager.removeTimeout(timerId)});timeoutIds.clear()});var button=root();button.__click=[copyToClipboard,$$props,handleMultiCopy,handleSingleCopy,showFeedback,isCopied,timerManager,feedbackDuration];var node=child(button);{var consequent=$$anchor2=>{var fragment=root_1();var svg=first_child(fragment);next(2);template_effect(()=>{set_attribute(svg,"width",size());set_attribute(svg,"height",size())});append($$anchor2,fragment)};var alternate=$$anchor2=>{var fragment_1=root_2();var svg_1=first_child(fragment_1);next(2);template_effect(()=>{set_attribute(svg_1,"width",size());set_attribute(svg_1,"height",size())});append($$anchor2,fragment_1)};if_block(node,$$render=>{if(get(isCopied))$$render(consequent);else $$render(alternate,false)})}reset(button);template_effect(()=>set_class(button,1,`\n    inline-flex\n    items-center\n    justify-center\n    transition-all\n    duration-200\n    ease-in-out\n    rounded-md\n    focus:outline-none\n    focus:ring-2\n    focus:ring-offset-2\n    focus:ring-blue-500\n    ${className()??""}\n  `));append($$anchor,button);return pop({...legacy_api()})}delegate(["click"]);export{Accounts as A,Copy as C};
//# sourceMappingURL=D6ZwBv0_.js.map
