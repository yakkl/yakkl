import{c as check_target,l as legacy_api}from"./BXFaAXnq.js";import{p as push,h as tag,o as onMount,a as pop,i as state,e as set,F as FILENAME,s as sibling,c as child,g as get,r as reset,b as strict_equals}from"./BaS8d5lg.js";import{a as add_locations}from"./3AhEABF_.js";import{d as delegate}from"./DiU70Is3.js";import{d as from_svg,f as from_html,a as append}from"./Cm3jf07C.js";import{c as create_ownership_validator}from"./COgMMZ9C.js";import{i as if_block}from"./Q1yPWpQ-.js";import{w as wrap_snippet}from"./d5hrMixo.js";import{r as remove_input_defaults}from"./DTBsVM-c.js";import{b as bind_value}from"./B6q982nR.js";import{p as prop}from"./BYboeQtC.js";import{s as setup_stores,a as store_get}from"./CViNpZsE.js";import{v as validate_store}from"./Dv9a3G0k.js";import{v as getProfile,x as isEncryptedData,z as decryptData,w as digestMessage,G as isProfileData,H as yakklMiscStore}from"./Cb2naUpm.js";import{l as log}from"./WDN37msH.js";import"./CgCfpVku.js";import{M as Modal}from"./UU1vCwIM.js";PincodeVerify[FILENAME]="src/lib/components/PincodeVerify.svelte";async function handleVerify(_,pincode,show,onRejected,$yakklMiscStore,onVerified){var _a,_b;try{if(get(pincode).length<8){alert("Please enter a valid pincode");return}const profile=await getProfile();if(!profile){show(false);onRejected()("No profile found")}if(isEncryptedData(profile.data)){await decryptData(profile.data,$yakklMiscStore()).then(result=>{profile.data=result})}const digestedPincode=await digestMessage(get(pincode));if(isProfileData(profile.data)&&strict_equals((_a=profile.data)==null?void 0:_a.pincode,digestedPincode)){onVerified()(digestedPincode)}else{log.debug("Invalid pincode(s):",false,(_b=profile.data)==null?void 0:_b.pincode,digestedPincode);alert("Invalid pincode")}set(pincode,"");show(false)}catch(e){log.error(e);onRejected()("Pincode verification failed")}}function resetForm(__1,pincode){set(pincode,"")}function togglePinVisibility(__2,eyeOpen,toggleVisibility){set(eyeOpen,!get(eyeOpen));toggleVisibility("pincode","number")}var root_2=add_locations(from_svg(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-gray-500"><path d="M12 15a3 3 0 100-6 3 3 0 000 6z"></path><path fill-rule="evenodd" d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 010-1.113zM17.25 12a5.25 5.25 0 11-10.5 0 5.25 5.25 0 0110.5 0z" clip-rule="evenodd"></path></svg>`),PincodeVerify[FILENAME],[[109,5,[[115,6],[116,6]]]]);var root_3=add_locations(from_svg(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-gray-500"><path d="M3.53 2.47a.75.75 0 00-1.06 1.06l18 18a.75.75 0 101.06-1.06l-18-18zM22.676 12.553a11.249 11.249 0 01-2.631 4.31l-3.099-3.099a5.25 5.25 0 00-6.71-6.71L7.759 4.577a11.217 11.217 0 014.242-.827c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113z"></path><path d="M15.75 12c0 .18-.013.357-.037.53l-4.244-4.243A3.75 3.75 0 0115.75 12zM12.53 15.713l-4.243-4.244a3.75 3.75 0 004.243 4.243z"></path><path d="M6.75 12c0-.619.107-1.213.304-1.764l-3.1-3.1a11.25 11.25 0 00-2.63 4.31c-.12.362-.12.752 0 1.114 1.489 4.467 5.704 7.69 10.675 7.69 1.5 0 2.933-.294 4.242-.827l-2.477-2.477A5.25 5.25 0 016.75 12z"></path></svg>`),PincodeVerify[FILENAME],[[123,5,[[129,6],[132,6],[135,6]]]]);var root_1=add_locations(from_html(`<div class="p-6 text-primary-light dark:text-primary-dark"><p class="mb-4 text-secondary-light dark:text-secondary-dark">Please verify your pincode to move forward. Thank you.</p> <div class="relative"><input id="pincode" type="password" inputmode="numeric" minlength="8" maxlength="8" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-700 bg-gray-50" placeholder="Enter 8 Digit Pin Code" autocomplete="off" required/> <button type="button" class="absolute top-1/2 right-3 transform -translate-y-1/2 focus:outline-none"><!></button></div> <div class="mt-6 flex justify-end space-x-4"><button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Cancel/Reject</button> <button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Reset</button> <button type="button" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Verify</button></div></div>`),PincodeVerify[FILENAME],[[85,1,[[86,2],[89,2,[[91,3],[103,3]]],[142,2,[[143,3],[148,3],[153,3]]]]]]);function PincodeVerify($$anchor,$$props){check_target(new.target);push($$props,true,PincodeVerify);var $$ownership_validator=create_ownership_validator($$props);const[$$stores,$$cleanup]=setup_stores();const $yakklMiscStore=()=>(validate_store(yakklMiscStore,"yakklMiscStore"),store_get(yakklMiscStore,"$yakklMiscStore",$$stores));let show=prop($$props,"show",15,false),className=prop($$props,"className",3,"z-[899]"),onRejected=prop($$props,"onRejected",3,()=>{}),onVerified=prop($$props,"onVerified",3,()=>{});let pincode=tag(state(""),"pincode");let eyeOpen=tag(state(false),"eyeOpen");onMount(()=>{set(pincode,"");show(false)});function closeModal(){set(pincode,"");show(false);onRejected()("Pincode verification failed")}function toggleVisibility(id="pincode",type="text"){try{let x=document.getElementById(id);if(strict_equals(x.type,"password")){x.type=type}else{x.type="password"}}catch(e){log.error(e)}}{$$ownership_validator.binding("show",Modal,show);Modal($$anchor,{title:"Pincode Authorization",get className(){return className()},onClose:closeModal,get show(){return show()},set show($$value){show($$value)},children:wrap_snippet(PincodeVerify,($$anchor2,$$slotProps)=>{var div=root_1();var div_1=sibling(child(div),2);var input=child(div_1);remove_input_defaults(input);var button=sibling(input,2);button.__click=[togglePinVisibility,eyeOpen,toggleVisibility];var node=child(button);{var consequent=$$anchor3=>{var svg=root_2();append($$anchor3,svg)};var alternate=$$anchor3=>{var svg_1=root_3();append($$anchor3,svg_1)};if_block(node,$$render=>{if(get(eyeOpen))$$render(consequent);else $$render(alternate,false)})}reset(button);reset(div_1);var div_2=sibling(div_1,2);var button_1=child(div_2);button_1.__click=closeModal;var button_2=sibling(button_1,2);button_2.__click=[resetForm,pincode];var button_3=sibling(button_2,2);button_3.__click=[handleVerify,pincode,show,onRejected,$yakklMiscStore,onVerified];reset(div_2);reset(div);bind_value(input,()=>get(pincode),$$value=>set(pincode,$$value));append($$anchor2,div)}),$$slots:{default:true}})}var $$pop=pop({...legacy_api()});$$cleanup();return $$pop}delegate(["click"]);export{PincodeVerify as P};
//# sourceMappingURL=Fc_LhyTR.js.map
