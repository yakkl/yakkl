var __defProp=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:true,configurable:true,writable:true,value:value}):obj[key]=value;var __publicField=(obj,key,value)=>__defNormalProp(obj,typeof key!=="symbol"?key+"":key,value);import{c as check_target,l as legacy_api}from"./BXFaAXnq.js";import{p as push,t as template_effect,a as pop,F as FILENAME,f as first_child,c as child,s as sibling,r as reset,n as noop}from"./BaS8d5lg.js";import{a as add_locations}from"./3AhEABF_.js";import{a as append,f as from_html,c as comment}from"./Cm3jf07C.js";import{s as set_class}from"./DX_EEhpR.js";import{p as prop}from"./BYboeQtC.js";import{g as get,d as derived,w as writable}from"./B2gA1VsD.js";import{b as browser}from"./D-5FeuF0.js";import{P as PlanType}from"./CoXEMRXA.js";import{aL as yakklAccountsStore,a8 as yakklSettingsStore,Z as yakklCurrentlySelectedStore}from"./Cb2naUpm.js";import{s as set_text}from"./Cmwrv3PW.js";import{i as if_block}from"./Q1yPWpQ-.js";import{s as snippet}from"./d5hrMixo.js";import{s as set_attribute}from"./DTBsVM-c.js";import{d as delegate}from"./DiU70Is3.js";AIHelpButton[FILENAME]="src/routes/preview2/lib/components/AIHelpButton.svelte";var root=add_locations(from_html(`<a href="/preview2/ai-help">ðŸ¤–</a>`),AIHelpButton[FILENAME],[[3,0]]);function AIHelpButton($$anchor,$$props){check_target(new.target);push($$props,true,AIHelpButton);let className=prop($$props,"className",3,"");var a=root();template_effect(()=>set_class(a,1,`yakkl-circle-button text-xl z-50 ${className()}`));append($$anchor,a);return pop({...legacy_api()})}const safeClientSendMessage=async message=>({success:false,error:"Mock implementation"});class BaseService{async sendMessage(message){var _a,_b;try{if(!browser);const response=await safeClientSendMessage(message);if(response.error){return{success:false,error:{hasError:true,message:((_a=response.error)==null?void 0:_a.message)||"Unknown error",code:(_b=response.error)==null?void 0:_b.code}}}return{success:true,data:response.result}}catch(error){return{success:false,error:{hasError:true,message:error instanceof Error?error.message:"Unknown error"}}}}handleError(error){return{hasError:true,message:error instanceof Error?error.message:"Unknown error",code:error==null?void 0:error.code}}}const _WalletService=class _WalletService extends BaseService{constructor(){super()}static getInstance(){if(!_WalletService.instance){_WalletService.instance=new _WalletService}return _WalletService.instance}async getAccounts(){try{const accounts=get(yakklAccountsStore);const settings=get(yakklSettingsStore);if(accounts&&accounts.length>0){const preview2Accounts=accounts.map(acc=>{var _a,_b;return{address:acc.address||"",ens:acc.alias||null,username:acc.name||"",avatar:acc.avatar||null,isActive:true,balance:((_a=acc.quantity)==null?void 0:_a.toString())||"0",plan:((_b=settings==null?void 0:settings.plan)==null?void 0:_b.type)||PlanType.Basic}});return{success:true,data:preview2Accounts}}const response=await this.sendMessage({method:"eth_accounts"});if(response.success&&response.data){const preview2Accounts=response.data.map(address=>{var _a;return{address:address,ens:null,username:"",avatar:null,isActive:false,balance:"0",plan:((_a=settings==null?void 0:settings.plan)==null?void 0:_a.type)||PlanType.Basic}});return{success:true,data:preview2Accounts}}return response}catch(error){return{success:false,error:this.handleError(error)}}}async getCurrentAccount(){var _a,_b,_c;try{const currentlySelected=get(yakklCurrentlySelectedStore);const settings=get(yakklSettingsStore);if((_a=currentlySelected==null?void 0:currentlySelected.shortcuts)==null?void 0:_a.address){const accounts=get(yakklAccountsStore);const account=accounts==null?void 0:accounts.find(acc=>acc.address===currentlySelected.shortcuts.address);if(account){const preview2Account={address:account.address||"",ens:account.alias||null,username:account.name||"",avatar:account.avatar||null,isActive:true,balance:((_b=account.quantity)==null?void 0:_b.toString())||"0",plan:((_c=settings==null?void 0:settings.plan)==null?void 0:_c.type)||PlanType.Basic};return{success:true,data:preview2Account}}}const accountsResponse=await this.getAccounts();if(accountsResponse.success&&accountsResponse.data&&accountsResponse.data.length>0){return{success:true,data:accountsResponse.data[0]}}return{success:true,data:null}}catch(error){return{success:false,error:this.handleError(error)}}}async getBalance(address){try{const response=await this.sendMessage({method:"eth_getBalance",params:[address,"latest"]});return response}catch(error){return{success:false,error:this.handleError(error)}}}async switchAccount(address){try{const currentlySelected=get(yakklCurrentlySelectedStore);if(currentlySelected){yakklCurrentlySelectedStore.set({...currentlySelected,shortcuts:{...currentlySelected.shortcuts,address:address}})}return{success:true,data:true}}catch(error){return{success:false,error:this.handleError(error)}}}async getChains(){try{const chains=[{key:"eth-mainnet",name:"Ethereum",network:"Mainnet",icon:"/images/eth.svg",isTestnet:false,chainId:1,rpcUrl:"https://mainnet.infura.io/v3/YOUR_KEY"},{key:"eth-sepolia",name:"Ethereum",network:"Sepolia",icon:"/images/eth.svg",isTestnet:true,chainId:11155111,rpcUrl:"https://sepolia.infura.io/v3/YOUR_KEY"},{key:"polygon-mainnet",name:"Polygon",network:"Mainnet",icon:"/images/polygon.svg",isTestnet:false,chainId:137,rpcUrl:"https://polygon-rpc.com"}];return{success:true,data:chains}}catch(error){return{success:false,error:this.handleError(error)}}}async switchChain(chainId){try{const response=await this.sendMessage({method:"wallet_switchEthereumChain",params:[{chainId:`0x${chainId.toString(16)}`}]});if(response.success){const currentlySelected=get(yakklCurrentlySelectedStore);if(currentlySelected){yakklCurrentlySelectedStore.set({...currentlySelected,shortcuts:{...currentlySelected.shortcuts,chainId:chainId}})}}return response}catch(error){return{success:false,error:this.handleError(error)}}}};__publicField(_WalletService,"instance");let WalletService=_WalletService;function createChainStore(){const walletService=WalletService.getInstance();const{subscribe:subscribe,set:set,update:update}=writable({chains:[],currentChain:null,showTestnets:false,loading:{isLoading:false},error:{hasError:false}});return{subscribe:subscribe,async loadChains(){update(state=>({...state,loading:{isLoading:true,message:"Loading networks..."}}));const response=await walletService.getChains();if(response.success&&response.data){update(state=>({...state,chains:response.data,currentChain:response.data.find(c=>c.chainId===1)||response.data[0],loading:{isLoading:false},error:{hasError:false}}))}else{update(state=>({...state,loading:{isLoading:false},error:response.error||{hasError:true,message:"Failed to load chains"}}))}},async switchChain(chainId){update(state=>({...state,loading:{isLoading:true,message:"Switching network..."}}));const response=await walletService.switchChain(chainId);if(response.success){update(state=>{const chain=state.chains.find(c=>c.chainId===chainId);return{...state,currentChain:chain||null,loading:{isLoading:false},error:{hasError:false}}})}else{update(state=>({...state,loading:{isLoading:false},error:response.error||{hasError:true,message:"Failed to switch network"}}))}},setCurrentChain(chain){update(state=>({...state,currentChain:chain}))},toggleTestnets(){update(state=>({...state,showTestnets:!state.showTestnets}))},reset(){set({chains:[],currentChain:null,showTestnets:false,loading:{isLoading:false},error:{hasError:false}})}}}const chainStore=createChainStore();const currentChain=derived(chainStore,$store=>$store.currentChain);const visibleChains=derived(chainStore,$store=>$store.showTestnets?$store.chains:$store.chains.filter(chain=>!chain.isTestnet));derived(chainStore,$store=>$store.loading.isLoading);const chain_store=Object.freeze(Object.defineProperty({__proto__:null,chainStore:chainStore,currentChain:currentChain,visibleChains:visibleChains},Symbol.toStringTag,{value:"Module"}));function createAccountStore(){const walletService=WalletService.getInstance();const{subscribe:subscribe,set:set,update:update}=writable({accounts:[],currentAccount:null,loading:{isLoading:false},error:{hasError:false}});return{subscribe:subscribe,async loadAccounts(){update(state=>({...state,loading:{isLoading:true,message:"Loading accounts..."}}));const response=await walletService.getAccounts();if(response.success&&response.data){update(state=>({...state,accounts:response.data,loading:{isLoading:false},error:{hasError:false}}));const currentResponse=await walletService.getCurrentAccount();if(currentResponse.success&&currentResponse.data){update(state=>({...state,currentAccount:currentResponse.data}))}}else{update(state=>({...state,loading:{isLoading:false},error:response.error||{hasError:true,message:"Failed to load accounts"}}))}},async switchAccount(address){const response=await walletService.switchAccount(address);if(response.success){update(state=>{const account=state.accounts.find(acc=>acc.address===address);return{...state,currentAccount:account||null}})}},setCurrentAccount(account){update(state=>({...state,currentAccount:account}))},reset(){set({accounts:[],currentAccount:null,loading:{isLoading:false},error:{hasError:false}})}}}const accountStore=createAccountStore();const currentAccount=derived(accountStore,$store=>$store.currentAccount);derived(accountStore,$store=>$store.accounts);derived(accountStore,$store=>$store.loading.isLoading);const account_store=Object.freeze(Object.defineProperty({__proto__:null,accountStore:accountStore,currentAccount:currentAccount},Symbol.toStringTag,{value:"Module"}));Modal[FILENAME]="src/routes/preview2/lib/components/v1/Modal.svelte";function handleClose(_,preventClose,onClose){if(!preventClose()){onClose()()}}var root_2=add_locations(from_html(`<button class="absolute top-4 right-4 text-2xl font-bold hover:text-primary-light dark:hover:text-primary-dark focus:outline-none">&times;</button>`),Modal[FILENAME],[[38,5]]);var root_3=add_locations(from_html(`<h2 class="text-2xl font-bold mb-4 text-primary-light dark:text-primary-dark truncate pr-8"> </h2> <p class="text-sm mb-2 text-secondary-light dark:text-secondary-dark"> </p>`,1),Modal[FILENAME],[[46,5],[52,5]]);var root_4=add_locations(from_html(`<h2 class="text-2xl font-bold mb-2 text-primary-light dark:text-primary-dark truncate pr-8"> </h2>`),Modal[FILENAME],[[56,5]]);var root_1=add_locations(from_html(`<div aria-modal="true"><div class="absolute inset-0 bg-black opacity-50"></div> <div class="bg-surface-light dark:bg-surface-dark text-primary-light dark:text-primary-dark rounded-lg shadow-lg w-full max-w-md mx-4 z-10 max-h-[80%] flex flex-col overflow-hidden"><div class="p-4 relative overflow-hidden"><!> <!></div> <div class="flex-1 overflow-y-auto overflow-x-hidden px-4"><!></div> <div class="px-6 py-3 rounded-b-lg border-t border-neutral-light dark:border-neutral-dark bg-surface-light dark:bg-surface-dark text-primary-light dark:text-primary-dark overflow-hidden"><!></div></div></div>`),Modal[FILENAME],[[26,1,[[29,2],[32,2,[[36,3],[66,3],[71,3]]]]]]);function Modal($$anchor,$$props){check_target(new.target);push($$props,true,Modal);let show=prop($$props,"show",15,false),title=prop($$props,"title",3,""),description=prop($$props,"description",3,""),className=prop($$props,"className",3,"");prop($$props,"onCancel",3,()=>{show(false)});let onClose=prop($$props,"onClose",3,()=>{show(false)}),preventClose=prop($$props,"preventClose",3,false);var fragment=comment();var node=first_child(fragment);{var consequent_2=$$anchor2=>{var div=root_1();var div_1=child(div);div_1.__click=[handleClose,preventClose,onClose];var div_2=sibling(div_1,2);var div_3=child(div_2);var node_1=child(div_3);{var consequent=$$anchor3=>{var button=root_2();button.__click=[handleClose,preventClose,onClose];append($$anchor3,button)};if_block(node_1,$$render=>{if(!preventClose())$$render(consequent)})}var node_2=sibling(node_1,2);{var consequent_1=$$anchor3=>{var fragment_1=root_3();var h2=first_child(fragment_1);var text=child(h2,true);reset(h2);var p=sibling(h2,2);var text_1=child(p,true);reset(p);template_effect(()=>{set_attribute(h2,"title",title());set_text(text,title());set_text(text_1,description())});append($$anchor3,fragment_1)};var alternate=$$anchor3=>{var h2_1=root_4();var text_2=child(h2_1,true);reset(h2_1);template_effect(()=>{set_attribute(h2_1,"title",title());set_text(text_2,title())});append($$anchor3,h2_1)};if_block(node_2,$$render=>{if(description())$$render(consequent_1);else $$render(alternate,false)})}reset(div_3);var div_4=sibling(div_3,2);var node_3=child(div_4);snippet(node_3,()=>$$props.children??noop);reset(div_4);var div_5=sibling(div_4,2);var node_4=child(div_5);snippet(node_4,()=>$$props.footer??noop);reset(div_5);reset(div_2);reset(div);template_effect(()=>set_class(div,1,`fixed inset-0 flex items-center justify-center z-[699] ${className()??""}`));append($$anchor2,div)};if_block(node,$$render=>{if(show())$$render(consequent_2)})}append($$anchor,fragment);return pop({...legacy_api()})}delegate(["click"]);function createModalStore(){const{subscribe:subscribe,set:set,update:update}=writable({isOpen:false,modalType:void 0,modalId:void 0});return{subscribe:subscribe,openModal(type,id){update(state=>({...state,isOpen:true,modalType:type,modalId:id}))},closeModal(){set({isOpen:false,modalType:void 0,modalId:void 0})},isModalOpen:()=>{let isOpen=false;subscribe(state=>{isOpen=state.isOpen})();return isOpen}}}const modalStore=createModalStore();const isModalOpen=writable(false);modalStore.subscribe(state=>{isModalOpen.set(state.isOpen)});export{AIHelpButton as A,BaseService as B,Modal as M,currentAccount as a,accountStore as b,currentChain as c,chainStore as d,chain_store as e,account_store as f,isModalOpen as i,modalStore as m,visibleChains as v};
//# sourceMappingURL=BO6zr7mn.js.map
