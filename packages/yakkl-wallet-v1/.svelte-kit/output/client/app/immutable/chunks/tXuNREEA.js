const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CLXcTOXD.js","./WDN37msH.js","./BqPlEZPR.js","./Cb2naUpm.js","./CgCfpVku.js","./B2gA1VsD.js","./BaS8d5lg.js","./BOosul_h.js","./DOIU7iEY.js"])))=>i.map(i=>d[i]);
var __defProp=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:true,configurable:true,writable:true,value:value}):obj[key]=value;var __publicField=(obj,key,value)=>__defNormalProp(obj,typeof key!=="symbol"?key+"":key,value);import{c as check_target,l as legacy_api}from"./BXFaAXnq.js";import{p as push,a as pop,F as FILENAME,c as child,r as reset,s as sibling,t as template_effect}from"./BaS8d5lg.js";import{a as add_locations}from"./3AhEABF_.js";import{s as set_text}from"./Cmwrv3PW.js";import{c as create_ownership_validator}from"./COgMMZ9C.js";import{f as from_html,a as append}from"./Cm3jf07C.js";import{w as wrap_snippet}from"./d5hrMixo.js";import{d as delegate,b as apply}from"./DiU70Is3.js";import{p as prop}from"./BYboeQtC.js";import{M as Modal}from"./UU1vCwIM.js";import{_ as __vitePreload,l as log}from"./Cb2naUpm.js";import{b as browserSvelte,c as isClient,g as getBrowserExt,a as browser_ext}from"./CgCfpVku.js";Failed[FILENAME]="src/lib/components/Failed.svelte";var root_1=add_locations(from_html(`<div class="p-6"><p class="text-sm text-gray-500"> </p> <div class="mt-4 flex justify-end"><button type="button" class="ml-2 rounded-md border border-transparent bg-red-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"> </button></div></div>`),Failed[FILENAME],[[15,1,[[16,2],[17,2,[[18,3]]]]]]);function Failed($$anchor,$$props){check_target(new.target);push($$props,true,Failed);var $$ownership_validator=create_ownership_validator($$props);let show=prop($$props,"show",15,false),title=prop($$props,"title",3,"Failed!"),content=prop($$props,"content",3,"An error has occurred."),rejectText=prop($$props,"rejectText",3,"Close"),className=prop($$props,"className",3,"z-[999]"),onReject=prop($$props,"onReject",3,()=>{show(false)});{$$ownership_validator.binding("show",Modal,show);Modal($$anchor,{get title(){return title()},get className(){return className()},get show(){return show()},set show($$value){show($$value)},children:wrap_snippet(Failed,($$anchor2,$$slotProps)=>{var div=root_1();var p=child(div);var text=child(p,true);reset(p);var div_1=sibling(p,2);var button=child(div_1);button.__click=function(...$$args){apply(onReject,this,$$args,Failed,[21,13])};var text_1=child(button,true);reset(button);reset(div_1);reset(div);template_effect(()=>{set_text(text,content());set_text(text_1,rejectText())});append($$anchor2,div)}),$$slots:{default:true}})}return pop({...legacy_api()})}delegate(["click"]);async function getDuplex(){if(browserSvelte){const mod=await __vitePreload(()=>import("./CLXcTOXD.js").then(n=>n.i),true?__vite__mapDeps([0,1,2,3,4,5,6,7]):void 0,import.meta.url);return mod.Duplex}else{const mod=await __vitePreload(()=>import("./DOIU7iEY.js").then(n=>n.b),true?__vite__mapDeps([8,1,3,4,5,6,7,2]):void 0,import.meta.url);return mod.Duplex}}class PortDuplexStream{constructor(port,stream){__publicField(this,"port");__publicField(this,"stream");__publicField(this,"inflight",0);this.port=port;this.stream=stream;this.port.onMessage.addListener(this._onMessage.bind(this));this.port.onDisconnect.addListener(()=>this.destroy())}_onMessage(message){try{log.info("PortDuplexStream _onMessage:",false,message);this.inflight=Math.max(0,this.inflight-1);this.stream.push(message)}catch(err){log.error("PortDuplexStream _onMessage error",false,err)}}write(msg){log.info("PortDuplexStream write:",false,msg);this.inflight++;this.port.postMessage(msg)}on(event,handler){log.info("PortDuplexStream on:",false,event);this.stream.on(event,handler)}destroy(){log.info("PortDuplexStream destroy:",false);this.port.disconnect();this.stream.destroy()}isIdle(){return this.inflight===0}async waitForIdle(timeout=3e3){log.info("PortDuplexStream waitForIdle:",false,timeout);const start=Date.now();return new Promise((resolve,reject)=>{const check=()=>{if(this.isIdle())return resolve();if(Date.now()-start>timeout)return reject(new Error("Timed out waiting for port to go idle"));setTimeout(check,50)};check()})}}class PortManagerWithStream{constructor(name){__publicField(this,"port",null);__publicField(this,"stream",null);__publicField(this,"requestId",null);__publicField(this,"name");this.name=name}async createPort(){var _a;if(this.port&&this.stream)return true;const ext=isClient?getBrowserExt():browser_ext;if(!ext||!((_a=ext.runtime)==null?void 0:_a.connect)){log.error("Extension API not available for PortManagerWithStream");return false}try{this.port=ext.runtime.connect({name:this.name});const Duplex=await getDuplex();class CustomDuplex extends Duplex{constructor(){super({objectMode:true})}_read(){}_write(_chunk,_enc,cb){cb()}write(chunk){super.write(chunk)}on(event,handler){super.on(event,handler)}destroy(){super.destroy()}}const baseStream=new CustomDuplex;this.stream=new PortDuplexStream(this.port,baseStream);return true}catch(error){log.error("Failed to create port stream",false,error);this.port=null;this.stream=null;return false}}getStream(){return this.stream}getPort(){return this.port}isIdle(){var _a;return((_a=this.stream)==null?void 0:_a.isIdle())??true}async waitForIdle(timeout=3e3){var _a;return(_a=this.stream)==null?void 0:_a.waitForIdle(timeout)}disconnect(){var _a;try{if(this.port&&this.requestId){browser_ext.runtime.sendMessage({type:"UNREGISTER_SESSION_PORT",requestId:this.requestId})}(_a=this.stream)==null?void 0:_a.destroy()}catch(err){log.warn("Error destroying port stream",false,err)}this.stream=null;this.port=null;this.requestId=null}setRequestId(requestId){this.requestId=requestId}getRequestId(){return this.requestId}clearRequestId(){this.requestId=null}}function createPortManagerWithStream(name="secure"){return new PortManagerWithStream(name)}export{Failed as F,createPortManagerWithStream as c};
//# sourceMappingURL=tXuNREEA.js.map
