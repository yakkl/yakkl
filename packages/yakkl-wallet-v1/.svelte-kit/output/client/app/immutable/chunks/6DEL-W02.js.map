{"version":3,"file":"6DEL-W02.js","sources":["../../../../../../src/lib/components/Pincode.svelte"],"sourcesContent":["<script lang=\"ts\">\n\t// Pincode change\n\timport { onMount } from 'svelte';\n\timport {\n\t\tgetProfile,\n\t\tsetProfileStorage,\n\t\tyakklMiscStore,\n\t\tprofileStore,\n\t\tyakklCurrentlySelectedStore,\n\t\tsetYakklCurrentlySelectedStorage,\n\t\tgetYakklCurrentlySelected\n\t} from '$lib/common/stores';\n\timport { encryptData, decryptData, digestMessage } from '$lib/common/encryption';\n\timport { deepCopy } from '$lib/utilities/utilities';\n\timport {\n\t\tisEncryptedData,\n\t\tisProfileData,\n\t\ttype CurrentlySelectedData,\n\t\ttype EncryptedData,\n\t\ttype Profile,\n\t\ttype ProfileData,\n\t\ttype YakklCurrentlySelected\n\t} from '$lib/common';\n\timport Modal from './Modal.svelte';\n\timport { log } from '$lib/managers/Logger';\n\n\tinterface Props {\n\t\tshow?: boolean;\n\t\tclassName?: string;\n\t\tonVerified?: (pincodeOld: string, pincodeNew: string) => void;\n\t}\n\n\tlet { show = $bindable(false), className = 'z-[999]', onVerified = () => {} }: Props = $props();\n\n\tlet pincodeOriginal = $state('');\n\tlet pincodeNew = $state('');\n\tlet eyeOpenOriginal = $state(false);\n\tlet eyeOpenNew = $state(false);\n\tlet currentlySelected: YakklCurrentlySelected;\n\n\tonMount(async () => {\n\t\tcurrentlySelected = await getYakklCurrentlySelected();\n\t\tpincodeOriginal = '';\n\t\tpincodeNew = '';\n\t\tshow = false;\n\t});\n\n\tasync function handleChange() {\n\t\ttry {\n\t\t\tif (pincodeOriginal.length < 8 || pincodeNew.length < 8) {\n\t\t\t\talert(\n\t\t\t\t\t\"Please enter a valid pincode. 8 numbers. Don't enter the same number in all 8 digits.\"\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (pincodeOriginal === pincodeNew) {\n\t\t\t\talert('Please enter a different pincode to update.');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet profile: Profile | null = await getProfile();\n\t\t\tif (!profile) {\n\t\t\t\tthrow 'No profile found';\n\t\t\t}\n\n\t\t\tif (isEncryptedData(profile.data)) {\n\t\t\t\tawait decryptData(profile.data as unknown as EncryptedData, $yakklMiscStore).then(\n\t\t\t\t\t(result) => {\n\t\t\t\t\t\tprofile.data = result as ProfileData;\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst digestedOriginalPincode = await digestMessage(pincodeOriginal);\n\t\t\tif (\n\t\t\t\tisProfileData(profile.data) &&\n\t\t\t\t(profile.data as ProfileData)?.pincode !== digestedOriginalPincode\n\t\t\t) {\n\t\t\t\talert('Invalid current pincode');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (isProfileData(profile.data)) {\n\t\t\t\tprofile.data.pincode = await digestMessage(pincodeNew);\n\t\t\t\tawait encryptData(profile.data, $yakklMiscStore).then((result) => {\n\t\t\t\t\tprofile.data = result;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t(currentlySelected.data as CurrentlySelectedData).profile = await deepCopy(profile);\n\n\t\t\tawait setYakklCurrentlySelectedStorage(currentlySelected);\n\n\t\t\t$profileStore = await deepCopy(profile);\n\t\t\tsetProfileStorage(profile);\n\n\t\t\tonVerified(pincodeOriginal, pincodeNew);\n\n\t\t\tpincodeOriginal = '';\n\t\t\tpincodeNew = '';\n\n\t\t\tshow = false;\n\t\t} catch (e) {\n\t\t\tlog.error(e);\n\t\t}\n\t}\n\n\tfunction closeModal() {\n\t\tpincodeOriginal = '';\n\t\tpincodeNew = '';\n\t\tshow = false;\n\t}\n\n\tfunction resetForm() {\n\t\tpincodeOriginal = '';\n\t\tpincodeNew = '';\n\t}\n\n\tfunction togglePinVisibilityOriginal() {\n\t\teyeOpenOriginal = !eyeOpenOriginal;\n\t\ttoggleVisibility('pincodeOriginal', 'number');\n\t}\n\n\tfunction togglePinVisibilityNew() {\n\t\teyeOpenNew = !eyeOpenNew;\n\t\ttoggleVisibility('pincodeNew', 'number');\n\t}\n\n\tfunction toggleVisibility(id: string, type: string) {\n\t\ttry {\n\t\t\tconst element = document.getElementById(id) as HTMLInputElement;\n\t\t\tif (element.type === 'password') {\n\t\t\t\telement.type = type;\n\t\t\t} else {\n\t\t\t\telement.type = 'password';\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tlog.error(e);\n\t\t}\n\t}\n</script>\n\n<div class=\"relative {className}\">\n\t<Modal bind:show title=\"Pincode Change\" onClose={closeModal}>\n\t\t<div class=\"p-6 text-primary-light dark:text-primary-dark\">\n\t\t\t<p class=\"mb-4 text-secondary-light dark:text-secondary-dark\">\n\t\t\t\tPlease verify your current pincode and then enter your new pincode. Thank you.\n\t\t\t</p>\n\t\t\t<div class=\"relative mb-4\">\n\t\t\t\t<input\n\t\t\t\t\tid=\"pincodeOriginal\"\n\t\t\t\t\ttype=\"password\"\n\t\t\t\t\tinputmode=\"numeric\"\n\t\t\t\t\tminlength=\"8\"\n\t\t\t\t\tmaxlength=\"8\"\n\t\t\t\t\tclass=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n\t\t\t\t\tplaceholder=\"CURRENT - 8 Digit Pin Code\"\n\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t\tbind:value={pincodeOriginal}\n\t\t\t\t\trequired\n\t\t\t\t/>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"absolute top-1/2 right-3 transform -translate-y-1/2 focus:outline-none\"\n\t\t\t\t\tonclick={togglePinVisibilityOriginal}\n\t\t\t\t>\n\t\t\t\t\t{#if eyeOpenOriginal}\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\tclass=\"w-6 h-6 text-gray-500\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path d=\"M12 15a3 3 0 100-6 3 3 0 000 6z\" />\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\td=\"M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 010-1.113zM17.25 12a5.25 5.25 0 11-10.5 0 5.25 5.25 0 0110.5 0z\"\n\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\tclass=\"w-6 h-6 text-gray-500\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M3.53 2.47a.75.75 0 00-1.06 1.06l18 18a.75.75 0 101.06-1.06l-18-18zM22.676 12.553a11.249 11.249 0 01-2.631 4.31l-3.099-3.099a5.25 5.25 0 00-6.71-6.71L7.759 4.577a11.217 11.217 0 014.242-.827c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113z\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M15.75 12c0 .18-.013.357-.037.53l-4.244-4.243A3.75 3.75 0 0115.75 12zM12.53 15.713l-4.243-4.244a3.75 3.75 0 004.243 4.243z\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M6.75 12c0-.619.107-1.213.304-1.764l-3.1-3.1a11.25 11.25 0 00-2.63 4.31c-.12.362-.12.752 0 1.114 1.489 4.467 5.704 7.69 10.675 7.69 1.5 0 2.933-.294 4.242-.827l-2.477-2.477A5.25 5.25 0 016.75 12z\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t{/if}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div class=\"relative\">\n\t\t\t\t<input\n\t\t\t\t\tid=\"pincodeNew\"\n\t\t\t\t\ttype=\"password\"\n\t\t\t\t\tinputmode=\"numeric\"\n\t\t\t\t\tminlength=\"8\"\n\t\t\t\t\tmaxlength=\"8\"\n\t\t\t\t\tclass=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n\t\t\t\t\tplaceholder=\"NEW - 8 Digit Pin Code\"\n\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t\tbind:value={pincodeNew}\n\t\t\t\t\trequired\n\t\t\t\t/>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"absolute top-1/2 right-3 transform -translate-y-1/2 focus:outline-none\"\n\t\t\t\t\tonclick={togglePinVisibilityNew}\n\t\t\t\t>\n\t\t\t\t\t{#if eyeOpenNew}\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\tclass=\"w-6 h-6 text-gray-500\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path d=\"M12 15a3 3 0 100-6 3 3 0 000 6z\" />\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\td=\"M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 010-1.113zM17.25 12a5.25 5.25 0 11-10.5 0 5.25 5.25 0 0110.5 0z\"\n\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\tclass=\"w-6 h-6 text-gray-500\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M3.53 2.47a.75.75 0 00-1.06 1.06l18 18a.75.75 0 101.06-1.06l-18-18zM22.676 12.553a11.249 11.249 0 01-2.631 4.31l-3.099-3.099a5.25 5.25 0 00-6.71-6.71L7.759 4.577a11.217 11.217 0 014.242-.827c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113z\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M15.75 12c0 .18-.013.357-.037.53l-4.244-4.243A3.75 3.75 0 0115.75 12zM12.53 15.713l-4.243-4.244a3.75 3.75 0 004.243 4.243z\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M6.75 12c0-.619.107-1.213.304-1.764l-3.1-3.1a11.25 11.25 0 00-2.63 4.31c-.12.362-.12.752 0 1.114 1.489 4.467 5.704 7.69 10.675 7.69 1.5 0 2.933-.294 4.242-.827l-2.477-2.477A5.25 5.25 0 016.75 12z\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t{/if}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div class=\"mt-6 flex justify-end space-x-4\">\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n\t\t\t\t\tonclick={closeModal}>Cancel</button\n\t\t\t\t>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n\t\t\t\t\tonclick={resetForm}>Reset</button\n\t\t\t\t>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n\t\t\t\t\tonclick={handleChange}>Change</button\n\t\t\t\t>\n\t\t\t</div>\n\t\t</div>\n\t</Modal>\n</div>\n"],"names":["resetForm","_","pincodeOriginal","pincodeNew","togglePinVisibilityOriginal","__1","eyeOpenOriginal","toggleVisibility","$.get","togglePinVisibilityNew","__2","eyeOpenNew","show","$.prop","$$props","className","onVerified","$.tag","$.state","currentlySelected","onMount","async","getYakklCurrentlySelected","handleChange","length","alert","$.strict_equals","profile","getProfile","isEncryptedData","data","decryptData","$yakklMiscStore","then","result","digestedOriginalPincode","digestMessage","isProfileData","_a","pincode","encryptData","deepCopy","setYakklCurrentlySelectedStorage","$.store_set","profileStore","setProfileStorage","e","log","error","closeModal","id","type","element","document","getElementById","$$render","consequent","alternate","consequent_1","alternate_1","bind_value","input","$$value","input_1"],"mappings":"kyCAkHUA,UAAYC,EAAAC,gBAAAC,gBACpBD,gBAAkB,QAClBC,WAAa,GACd,UAESC,4BAA8BC,IAAAC,gBAAAC,sBACtCD,iBAAmBE,IAAAF,kBACnBC,iBAAiB,kBAAmB,SACrC,UAESE,uBAAyBC,IAAAC,WAAAJ,sBACjCI,YAAcH,IAAAG,aACdJ,iBAAiB,aAAc,SAChC,29JA/FM,IAAAK,KAAAC,KAAAC,QAAA,OAAA,GAAiB,OAAQC,UAAYF,KAAAC,QAAA,YAAA,EAAA,WAAWE,WAAAH,KAAAC,QAAA,aAAA,EAAA,QAElD,IAAAZ,gBAAAe,IAAAC,MAAyB,IAAE,mBAC3B,IAAAf,WAAAc,IAAAC,MAAoB,IAAE,cACtB,IAAAZ,gBAAAW,IAAAC,MAAyB,OAAK,mBAC9B,IAAAP,WAAAM,IAAAC,MAAoB,OAAK,cACzB,IAAAC,kBAEJC,QAAoBC,UACnBF,wBAA0BG,gCAC1BpB,gBAAkB,QAClBC,WAAa,IACbS,KAAO,wBAGOW,sBACV,IACCf,GAAAA,IAAAN,iBAAgBsB,OAAS,GAAAhB,IAAKL,YAAWqB,OAAS,EAAG,CACxDC,MACC,+FAGF,CAEI,GAAAC,cAAAlB,IAAAN,iBAAAM,IAAoBL,aAAY,CACnCsB,MAAM,qDAEP,CAEI,IAAAE,cAAgCC,iBAC/BD,QAAS,CACP,KAAA,kBACP,CAEI,GAAAE,gBAAgBF,QAAQG,MAAO,OAC5BC,YAAYJ,QAAQG,KAAkCE,mBAAiBC,KAC3EC,SACAP,QAAQG,KAAOI,QAGlB,CAEM,MAAAC,8BAAgCC,kBAAclC,kBAEnD,GAAAmC,cAAcV,QAAQG,OAAIJ,eACzBY,GAAQX,QAAAG,OAAR,UAA8B,EAAAQ,GAAAC,QAAYJ,wBAC1C,OAAA,CACDV,MAAM,iCAEP,CAEI,GAAAY,cAAcV,QAAQG,MAAO,CAChCH,QAAQG,KAAKS,cAAgBH,cAAA5B,IAAcL,mBACrCqC,YAAYb,QAAQG,KAAME,mBAAiBC,KAAMC,SACtDP,QAAQG,KAAOI,QAEjB,CAECf,kBAAkBW,KAA+BH,cAAgBc,SAASd,eAErEe,iCAAiCvB,mBAEjBwB,UAAAC,mBAAAH,SAASd,UAC/BkB,kBAAkBlB,SAElBX,aAAAR,IAAWN,qBAAiBC,iBAE5BD,gBAAkB,QAClBC,WAAa,IAEbS,KAAO,MACR,OAASkC,GACRC,IAAIC,MAAMF,EACX,CACD,UAESG,iBACR/C,gBAAkB,QAClBC,WAAa,IACbS,KAAO,MACR,CAiBS,SAAAL,iBAAiB2C,GAAYC,MACjC,IACG,MAAAC,QAAUC,SAASC,eAAeJ,IACpC,GAAAxB,cAAA0B,QAAQD,KAAS,YAAY,CAChCC,QAAQD,KAAOA,SACT,CACNC,QAAQD,KAAO,UAChB,CACD,OAASL,GACRC,IAAIC,MAAMF,EACX,CACD,iIAIiDG,mRAqBpC7C,mQAEJE,iBAAeiD,SAAAC,iBAAAD,SAAAE,UAAA,yKAkDXhD,mQAEJE,YAAU4C,SAAAG,mBAAAH,SAAAI,YAAA,4GAsCNV,8DAKAjD,UAASE,gBAAAC,8DAKToB,uCA5GGqC,WAAAC,MAAA,IAAArD,IAAAN,8BAAAA,gBAAe4D,UAoDfF,WAAAG,QAAA,IAAAvD,IAAAL,yBAAAA,WAAU2D,wHApEL/C,aAAS"}