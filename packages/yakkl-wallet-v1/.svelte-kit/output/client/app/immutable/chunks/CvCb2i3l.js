import{c as check_target,l as legacy_api}from"./BXFaAXnq.js";import"./Doq7snb5.js";import{p as push,o as onMount,d as onDestroy,f as first_child,a as pop,F as FILENAME,g as get,m as mutable_source,b as strict_equals,e as set,c as child,s as sibling,r as reset,t as template_effect}from"./BaS8d5lg.js";import{a as add_locations}from"./3AhEABF_.js";import{s as set_text}from"./Cmwrv3PW.js";import{i as if_block}from"./Q1yPWpQ-.js";import{c as comment,a as append,f as from_html}from"./Cm3jf07C.js";import{e as event}from"./DiU70Is3.js";import{i as init}from"./D9iNYspi.js";import{g as getSettings,A as AccessSourceType,s as setSettings}from"./Cb2naUpm.js";import{o as openModal}from"./CZPMS86D.js";import{UnifiedTimerManager}from"./z-nmOEXa.js";import{C as CountdownTimer}from"./Ch-onVly.js";TrialCountdown[FILENAME]="src/lib/components/TrialCountdown.svelte";var root_1=add_locations(from_html(`<div class="fixed bottom-0 left-0 right-0 z-50 bg-yellow-300 dark:bg-yellow-800 text-yellow-900 dark:text-yellow-100 px-4 py-2 text-center text-sm font-medium flex items-center justify-between shadow-lg"><div class="flex items-center space-x-2"><span class="font-bold">‚è≥ Trial ends in:</span> <span> </span></div> <div class="flex items-center space-x-3"><button class="text-xs font-semibold underline hover:text-yellow-700 dark:hover:text-yellow-300">Upgrade</button> <button title="Pin or unpin this banner" class="text-xs opacity-60 hover:opacity-100">üìå</button></div></div>`),TrialCountdown[FILENAME],[[89,1,[[92,2,[[93,3],[94,3]]],[96,2,[[97,3],[103,3]]]]]]);function TrialCountdown($$anchor,$$props){check_target(new.target);push($$props,false,TrialCountdown);let remaining=mutable_source("");let visible=mutable_source(true);let pinned=false;let countdownTimer=null;let hideTimeoutId="trial-hide-timeout";const timerManager=UnifiedTimerManager.getInstance();async function updateCountdown(){const settings=await getSettings();if(!settings||strict_equals(settings.plan.source,AccessSourceType.TRIAL,false)||!settings.plan.trialEndDate){set(visible,false);return}pinned=settings.trialCountdownPinned??false;const end=new Date(settings.plan.trialEndDate).getTime();const now=Date.now();const durationMs=end-now;if(durationMs<=0){set(visible,false);return}countdownTimer=new CountdownTimer("trial-countdown",durationMs,remainingSeconds=>{const hours=Math.floor(remainingSeconds/3600);const minutes=Math.floor(remainingSeconds%3600/60);const seconds=remainingSeconds%60;set(remaining,`${hours}h ${minutes}m ${seconds}s`)},()=>{set(visible,false)});countdownTimer.start();if(!pinned){timerManager.addTimeout(hideTimeoutId,()=>{set(visible,false)},3e4);timerManager.startTimeout(hideTimeoutId)}}function handleUpgrade(){openModal("upgrade")}async function togglePin(){pinned=!pinned;const store=await getSettings();const updated={...store,trialCountdownPinned:pinned};setSettings(updated);if(!pinned){timerManager.addTimeout(hideTimeoutId,()=>{set(visible,false)},3e4);timerManager.startTimeout(hideTimeoutId)}else{set(visible,true);timerManager.stopTimeout(hideTimeoutId);timerManager.removeTimeout(hideTimeoutId)}}onMount(async()=>{await updateCountdown()});onDestroy(()=>{if(countdownTimer){countdownTimer.destroy();countdownTimer=null}timerManager.stopTimeout(hideTimeoutId);timerManager.removeTimeout(hideTimeoutId)});init();var fragment=comment();var node=first_child(fragment);{var consequent=$$anchor2=>{var div=root_1();var div_1=child(div);var span=sibling(child(div_1),2);var text=child(span,true);reset(span);reset(div_1);var div_2=sibling(div_1,2);var button=child(div_2);var button_1=sibling(button,2);reset(div_2);reset(div);template_effect(()=>set_text(text,get(remaining)));event("click",button,handleUpgrade);event("click",button_1,togglePin);append($$anchor2,div)};if_block(node,$$render=>{if(get(visible))$$render(consequent)})}append($$anchor,fragment);return pop({...legacy_api()})}export{TrialCountdown as T};
//# sourceMappingURL=CvCb2i3l.js.map
