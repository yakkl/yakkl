{"version":3,"file":"Ch-onVly.js","sources":["../../../../../../src/lib/managers/CountdownTimer.ts"],"sourcesContent":["import { writable, type Writable } from 'svelte/store';\nimport { UnifiedTimerManager } from './UnifiedTimerManager';\n\nexport interface CountdownState {\n\tremaining: number;\n\tisRunning: boolean;\n\tisPaused: boolean;\n\tprogress: number; // 0-100 percentage\n}\n\nexport class CountdownTimer {\n\tprivate id: string;\n\tprivate duration: number;\n\tprivate remaining: number;\n\tprivate startTime: number = 0;\n\tprivate pausedTime: number = 0;\n\tprivate isRunning: boolean = false;\n\tprivate isPaused: boolean = false;\n\tprivate onTick?: (remaining: number) => void;\n\tprivate onComplete?: () => void;\n\tprivate timerManager: UnifiedTimerManager;\n\n\tpublic store: Writable<CountdownState>;\n\n\tconstructor(\n\t\tid: string,\n\t\tduration: number,\n\t\tonTick?: (remaining: number) => void,\n\t\tonComplete?: () => void\n\t) {\n\t\tthis.id = `countdown-${id}`;\n\t\tthis.duration = duration;\n\t\tthis.remaining = duration;\n\t\tthis.onTick = onTick;\n\t\tthis.onComplete = onComplete;\n\t\tthis.timerManager = UnifiedTimerManager.getInstance();\n\n\t\tthis.store = writable<CountdownState>({\n\t\t\tremaining: duration,\n\t\t\tisRunning: false,\n\t\t\tisPaused: false,\n\t\t\tprogress: 0\n\t\t});\n\t}\n\n\tstart(): void {\n\t\tif (this.isRunning && !this.isPaused) return;\n\n\t\tif (this.isPaused) {\n\t\t\t// Resume from paused state\n\t\t\tthis.startTime = Date.now() - (this.duration - this.remaining);\n\t\t\tthis.isPaused = false;\n\t\t} else {\n\t\t\t// Start fresh\n\t\t\tthis.startTime = Date.now();\n\t\t\tthis.remaining = this.duration;\n\t\t}\n\n\t\tthis.isRunning = true;\n\t\tthis.updateStore();\n\n\t\t// Add interval for ticking\n\t\tthis.timerManager.addInterval(this.id, () => this.tick(), 100);\n\t\tthis.timerManager.startInterval(this.id);\n\t}\n\n\tprivate tick(): void {\n\t\tif (!this.isRunning || this.isPaused) return;\n\n\t\tconst elapsed = Date.now() - this.startTime;\n\t\tthis.remaining = Math.max(0, this.duration - elapsed);\n\n\t\tconst progress = ((this.duration - this.remaining) / this.duration) * 100;\n\n\t\tthis.updateStore();\n\n\t\tif (this.onTick) {\n\t\t\tthis.onTick(Math.ceil(this.remaining / 1000)); // Return seconds\n\t\t}\n\n\t\tif (this.remaining <= 0) {\n\t\t\tthis.complete();\n\t\t}\n\t}\n\n\tprivate complete(): void {\n\t\tthis.stop();\n\t\tif (this.onComplete) {\n\t\t\tthis.onComplete();\n\t\t}\n\t}\n\n\tpause(): void {\n\t\tif (!this.isRunning || this.isPaused) return;\n\n\t\tthis.isPaused = true;\n\t\tthis.pausedTime = Date.now();\n\t\tthis.timerManager.stopInterval(this.id);\n\t\tthis.updateStore();\n\t}\n\n\tresume(): void {\n\t\tif (!this.isPaused) return;\n\t\tthis.start();\n\t}\n\n\tstop(): void {\n\t\tthis.isRunning = false;\n\t\tthis.isPaused = false;\n\t\tthis.remaining = this.duration;\n\t\tthis.timerManager.stopInterval(this.id);\n\t\tthis.timerManager.removeInterval(this.id);\n\t\tthis.updateStore();\n\t}\n\n\treset(): void {\n\t\tthis.stop();\n\t\tthis.remaining = this.duration;\n\t\tthis.updateStore();\n\t}\n\n\tgetRemainingSeconds(): number {\n\t\treturn Math.ceil(this.remaining / 1000);\n\t}\n\n\tgetRemainingTime(): { minutes: number; seconds: number } {\n\t\tconst totalSeconds = this.getRemainingSeconds();\n\t\treturn {\n\t\t\tminutes: Math.floor(totalSeconds / 60),\n\t\t\tseconds: totalSeconds % 60\n\t\t};\n\t}\n\n\tgetProgress(): number {\n\t\treturn ((this.duration - this.remaining) / this.duration) * 100;\n\t}\n\n\tprivate updateStore(): void {\n\t\tthis.store.set({\n\t\t\tremaining: this.remaining,\n\t\t\tisRunning: this.isRunning,\n\t\t\tisPaused: this.isPaused,\n\t\t\tprogress: this.getProgress()\n\t\t});\n\t}\n\n\tdestroy(): void {\n\t\tthis.stop();\n\t}\n}\n\n// Factory function for creating countdown timers\nexport function createCountdownTimer(\n\tid: string,\n\tdurationInSeconds: number,\n\tonTick?: (remaining: number) => void,\n\tonComplete?: () => void\n): CountdownTimer {\n\treturn new CountdownTimer(id, durationInSeconds * 1000, onTick, onComplete);\n}\n"],"names":["CountdownTimer","constructor","id","duration","onTick","onComplete","__publicField","this","remaining","timerManager","UnifiedTimerManager","getInstance","store","writable","isRunning","isPaused","progress","start","startTime","Date","now","updateStore","addInterval","tick","startInterval","elapsed","Math","max","ceil","complete","stop","pause","pausedTime","stopInterval","resume","removeInterval","reset","getRemainingSeconds","getRemainingTime","totalSeconds","minutes","floor","seconds","getProgress","set","destroy","createCountdownTimer","durationInSeconds"],"mappings":"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"}