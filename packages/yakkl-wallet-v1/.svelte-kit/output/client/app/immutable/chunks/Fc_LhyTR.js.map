{"version":3,"file":"Fc_LhyTR.js","sources":["../../../../../../src/lib/components/PincodeVerify.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { onMount } from 'svelte';\n\timport { getProfile, yakklMiscStore } from '$lib/common/stores';\n\timport { decryptData, digestMessage, isEncryptedData, isProfileData } from '$lib/common';\n\timport type { EncryptedData, ProfileData, Profile } from '$lib/common';\n\timport Modal from './Modal.svelte';\n\timport { log } from '$lib/managers/Logger';\n\n\tinterface Props {\n\t\tshow?: boolean;\n\t\tclassName?: string;\n\t\tonRejected?: (rejection: string) => void;\n\t\tonVerified?: (pincode: string) => void;\n\t}\n\n\tlet {\n\t\tshow = $bindable(false),\n\t\tclassName = 'z-[899]',\n\t\tonRejected = () => {},\n\t\tonVerified = () => {}\n\t}: Props = $props();\n\n\tlet pincode = $state('');\n\tlet eyeOpen = $state(false);\n\n\tonMount(() => {\n\t\tpincode = '';\n\t\tshow = false;\n\t});\n\n\tasync function handleVerify() {\n\t\ttry {\n\t\t\tif (pincode.length < 8) {\n\t\t\t\talert('Please enter a valid pincode');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst profile: Profile | null = await getProfile();\n\n\t\t\tif (!profile) {\n\t\t\t\tshow = false;\n\t\t\t\tonRejected('No profile found');\n\t\t\t}\n\n\t\t\tif (isEncryptedData(profile.data)) {\n\t\t\t\tawait decryptData(profile.data as unknown as EncryptedData, $yakklMiscStore).then(\n\t\t\t\t\t(result) => {\n\t\t\t\t\t\tprofile.data = result as ProfileData;\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst digestedPincode = await digestMessage(pincode);\n\t\t\tif (\n\t\t\t\tisProfileData(profile.data) &&\n\t\t\t\t(profile.data as ProfileData)?.pincode === digestedPincode\n\t\t\t) {\n\t\t\t\tonVerified(digestedPincode); // Send the verified digested pincode and not the actual pincode\n\t\t\t} else {\n\t\t\t\tlog.debug(\n\t\t\t\t\t'Invalid pincode(s):',\n\t\t\t\t\tfalse,\n\t\t\t\t\t(profile.data as ProfileData)?.pincode,\n\t\t\t\t\tdigestedPincode\n\t\t\t\t);\n\t\t\t\talert('Invalid pincode');\n\t\t\t}\n\n\t\t\tpincode = '';\n\t\t\tshow = false;\n\t\t} catch (e) {\n\t\t\tlog.error(e);\n\t\t\tonRejected('Pincode verification failed');\n\t\t}\n\t\t// finally {\n\t\t//   show = false;\n\t\t//   onRejected(\"Pincode verification failed\");\n\t\t// }\n\t}\n\n\tfunction closeModal() {\n\t\tpincode = '';\n\t\tshow = false;\n\t\tonRejected('Pincode verification failed');\n\t}\n\n\tfunction resetForm() {\n\t\tpincode = '';\n\t}\n\n\tfunction togglePinVisibility() {\n\t\teyeOpen = !eyeOpen;\n\t\ttoggleVisibility('pincode', 'number');\n\t}\n\n\tfunction toggleVisibility(id = 'pincode', type = 'text') {\n\t\ttry {\n\t\t\tlet x = document.getElementById(id) as HTMLInputElement;\n\t\t\tif (x.type === 'password') {\n\t\t\t\tx.type = type;\n\t\t\t} else {\n\t\t\t\tx.type = 'password';\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tlog.error(e);\n\t\t}\n\t}\n</script>\n\n<!-- <div class=\"relative {className}\"> -->\n<Modal bind:show title=\"Pincode Authorization\" {className} onClose={closeModal}>\n\t<div class=\"p-6 text-primary-light dark:text-primary-dark\">\n\t\t<p class=\"mb-4 text-secondary-light dark:text-secondary-dark\">\n\t\t\tPlease verify your pincode to move forward. Thank you.\n\t\t</p>\n\t\t<div class=\"relative\">\n\t\t\t<!-- Numeric with password type will still show dots even if not allowed when type is text but it will not show -->\n\t\t\t<input\n\t\t\t\tid=\"pincode\"\n\t\t\t\ttype=\"password\"\n\t\t\t\tinputmode=\"numeric\"\n\t\t\t\tminlength=\"8\"\n\t\t\t\tmaxlength=\"8\"\n\t\t\t\tclass=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-700 bg-gray-50\"\n\t\t\t\tplaceholder=\"Enter 8 Digit Pin Code\"\n\t\t\t\tautocomplete=\"off\"\n\t\t\t\tbind:value={pincode}\n\t\t\t\trequired\n\t\t\t/>\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclass=\"absolute top-1/2 right-3 transform -translate-y-1/2 focus:outline-none\"\n\t\t\t\tonclick={togglePinVisibility}\n\t\t\t>\n\t\t\t\t{#if eyeOpen}\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\tclass=\"w-6 h-6 text-gray-500\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path d=\"M12 15a3 3 0 100-6 3 3 0 000 6z\" />\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\td=\"M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 010-1.113zM17.25 12a5.25 5.25 0 11-10.5 0 5.25 5.25 0 0110.5 0z\"\n\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t{:else}\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\tclass=\"w-6 h-6 text-gray-500\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M3.53 2.47a.75.75 0 00-1.06 1.06l18 18a.75.75 0 101.06-1.06l-18-18zM22.676 12.553a11.249 11.249 0 01-2.631 4.31l-3.099-3.099a5.25 5.25 0 00-6.71-6.71L7.759 4.577a11.217 11.217 0 014.242-.827c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113z\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M15.75 12c0 .18-.013.357-.037.53l-4.244-4.243A3.75 3.75 0 0115.75 12zM12.53 15.713l-4.243-4.244a3.75 3.75 0 004.243 4.243z\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M6.75 12c0-.619.107-1.213.304-1.764l-3.1-3.1a11.25 11.25 0 00-2.63 4.31c-.12.362-.12.752 0 1.114 1.489 4.467 5.704 7.69 10.675 7.69 1.5 0 2.933-.294 4.242-.827l-2.477-2.477A5.25 5.25 0 016.75 12z\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t{/if}\n\t\t\t</button>\n\t\t</div>\n\t\t<div class=\"mt-6 flex justify-end space-x-4\">\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclass=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n\t\t\t\tonclick={closeModal}>Cancel/Reject</button\n\t\t\t>\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclass=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n\t\t\t\tonclick={resetForm}>Reset</button\n\t\t\t>\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclass=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n\t\t\t\tonclick={handleVerify}>Verify</button\n\t\t\t>\n\t\t</div>\n\t</div>\n</Modal>\n<!-- </div> -->\n"],"names":["async","handleVerify","$.get","pincode","length","alert","profile","getProfile","show","onRejected","isEncryptedData","data","decryptData","$yakklMiscStore","then","result","digestedPincode","digestMessage","isProfileData","$.strict_equals","_a","onVerified","log","debug","_b","e","error","resetForm","__1","togglePinVisibility","__2","eyeOpen","toggleVisibility","$.prop","$$props","className","$.tag","$.state","onMount","closeModal","id","type","x","document","getElementById","$$render","consequent","alternate","bind_value","input","$$value"],"mappings":"4iCA8BgBA,eAAAC,6EACV,IACC,GAAAC,IAAAC,SAAQC,OAAS,EAAG,CACvBC,MAAM,sCAEP,CAEM,MAAAC,cAAgCC,iBAEjCD,QAAS,CACbE,KAAO,OACPC,aAAW,mBACZ,CAEI,GAAAC,gBAAgBJ,QAAQK,MAAO,OAC5BC,YAAYN,QAAQK,KAAkCE,mBAAiBC,KAC3EC,SACAT,QAAQK,KAAOI,QAGlB,CAEM,MAAAC,sBAAwBC,kBAAcd,UAE3C,GAAAe,cAAcZ,QAAQK,OAAIQ,eACzBC,WAAQT,OAAR,UAAA,EAAAS,GAA8BjB,QAAYa,iBAC1C,CACDK,aAAWL,qBACL,CACNM,IAAIC,MACH,sBACA,OACCC,WAAQb,OAAR,UAAA,EAAAa,GAA8BrB,QAC/Ba,iBAEDX,MAAM,kBACP,KAEAF,QAAU,IACVK,KAAO,MACR,OAASiB,GACRH,IAAII,MAAMD,GACVhB,aAAW,8BACZ,CAKD,UAQSkB,UAAYC,IAAAzB,aACpBA,QAAU,GACX,UAES0B,oBAAsBC,IAAAC,QAAAC,sBAC9BD,SAAW7B,IAAA6B,UACXC,iBAAiB,UAAW,SAC7B,2pGA7EC,IAAAxB,KAAAyB,KAAAC,QAAA,OAAA,GAAiB,OACjBC,UAAYF,KAAAC,QAAA,YAAA,EAAA,WACZzB,WAAAwB,KAAAC,QAAA,aAAA,EAAA,QACAb,WAAAY,KAAAC,QAAA,aAAA,EAAA,QAGG,IAAA/B,QAAAiC,IAAAC,MAAiB,IAAE,WACnB,IAAAN,QAAAK,IAAAC,MAAiB,OAAK,WAE1BC,QAAc,SACbnC,QAAU,IACVK,KAAO,kBAqDC+B,iBACRpC,QAAU,IACVK,KAAO,OACPC,aAAW,8BACZ,UAWSuB,iBAAiBQ,GAAK,UAAWC,KAAO,QAC5C,IACC,IAAAC,EAAIC,SAASC,eAAeJ,IAC5B,GAAArB,cAAAuB,EAAED,KAAS,YAAY,CAC1BC,EAAED,KAAOA,SACH,CACNC,EAAED,KAAO,UACV,CACD,OAAShB,GACRH,IAAII,MAAMD,EACX,CACD,6IAImEc,qRAsBvDV,+OAEJE,SAAOc,SAAAC,iBAAAD,SAAAE,UAAA,0GAsCHR,8DAKAZ,UAASxB,4DAKTF,yFAxDG+C,WAAAC,MAAA,IAAA/C,IAAAC,sBAAAA,QAAO+C"}