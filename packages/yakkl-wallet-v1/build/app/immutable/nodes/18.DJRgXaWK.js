import{c as check_target,l as legacy_api}from"../chunks/BXFaAXnq.js";import{p as push,h as tag,f as first_child,a as pop,i as state,e as set,g as get,s as sibling,c as child,F as FILENAME,r as reset}from"../chunks/BaS8d5lg.js";import{a as add_locations}from"../chunks/3AhEABF_.js";import{a as append,f as from_html}from"../chunks/Cm3jf07C.js";import{s as setup_stores,b as store_set}from"../chunks/CViNpZsE.js";import{l as log_if_contains_state}from"../chunks/DZ17DrFv.js";import{p as page}from"../chunks/eULPtkAc.js";import{b as browserSvelte}from"../chunks/CgCfpVku.js";import{L as Login}from"../chunks/BjtG3ltR.js";import{y as yakklUserNameStore,b as yakklDappConnectRequestStore,c as syncStorageToStore,l as log}from"../chunks/Cb2naUpm.js";import{s as safeLogout,a as safeNavigate}from"../chunks/COpD6KvM.js";import{messagingService,startActivityTracking}from"../chunks/DT3ZCMgr.js";import{E as ErrorNoAction}from"../chunks/2Ogrppv5.js";import{W as Welcome}from"../chunks/BmabbRFA.js";import{p as protectedContexts}from"../chunks/D59oTG1g.js";_page[FILENAME]="src/routes/(dapp)/dapp/login/+page.svelte";var root=add_locations(from_html(`<!> <div class="relative h-[98vh] text-base-content"><main class="px-4 text-center"><!> <div class="mt-5"><!></div></main></div>`,1),_page[FILENAME],[[100,0,[[101,1,[[104,2]]]]]]);function _page($$anchor,$$props){check_target(new.target);push($$props,true,_page);const[$$stores,$$cleanup]=setup_stores();let requestId=tag(state(""),"requestId");let method=tag(state(""),"method");let showError=tag(state(false),"showError");let errorValue=tag(state(""),"errorValue");let approvalUrl="";function getApprovalUrl(){if(!get(method))return"/dapp/popups/approve/";switch(get(method)){case"eth_requestAccounts":return"/dapp/popups/accounts/";case"eth_sendTransaction":return"/dapp/popups/transactions/";case"eth_signTypedData_v4":case"personal_sign":case"eth_signTransaction":return"/dapp/popups/sign/";case"wallet_requestPermissions":case"wallet_revokePermissions":case"wallet_getPermissions":return"/dapp/popups/permissions/";case"wallet_switchEthereumChain":return"/dapp/popups/wallet/";default:return"/dapp/popups/approve/"}}function initializeFromUrl(){if(!browserSvelte)return;const urlRequestId=page.url.searchParams.get("requestId")??"";set(requestId,urlRequestId,true);set(method,page.url.searchParams.get("method")??"",true);approvalUrl=getApprovalUrl();console.log(...log_if_contains_state("log","approvalUrl",approvalUrl));console.log(...log_if_contains_state("log","requestId",get(requestId)));console.log(...log_if_contains_state("log","method",get(method)))}initializeFromUrl();function onSuccess(profile,digest,isMinimal){try{if(!browserSvelte)return;store_set(yakklUserNameStore,profile.userName||"");store_set(yakklDappConnectRequestStore,get(requestId));syncStorageToStore();const contextType="popup-dapp";if(protectedContexts.includes(contextType)){log.info(`Starting activity tracking for protected context: ${contextType}`);startActivityTracking(contextType)}else{log.info(`Skipping activity tracking for non-protected context: ${contextType}`)}const url=`${approvalUrl}?requestId=${get(requestId)}&method=${get(method)}`;safeNavigate(url)}catch(e){log.error("Error during post-login initialization",false,e);set(errorValue,e,true);set(showError,true);messagingService.sendMessage("rejectRequest",{requestId:get(requestId),error:"Authentication failed"})}}function onError(value){if(!browserSvelte)return;set(errorValue,value,true);set(showError,true);messagingService.sendMessage("rejectRequest",{requestId:get(requestId),error:"Authentication failed"})}function onCancel(){if(!browserSvelte)return;safeLogout()}function onClose(){if(!browserSvelte)return;set(showError,false);set(errorValue,"")}var fragment=root();var node=first_child(fragment);ErrorNoAction(node,{title:"ERROR!",get value(){return get(errorValue)},onClose:onClose,get show(){return get(showError)},set show($$value){set(showError,$$value,true)}});var div=sibling(node,2);var main=child(div);var node_1=child(main);Welcome(node_1,{});var div_1=sibling(node_1,2);var node_2=child(div_1);Login(node_2,{minimumAuth:true,get requestId(){return get(requestId)},get method(){return get(method)},onSuccess:onSuccess,onError:onError,onCancel:onCancel,loginButtonText:"Unlock",cancelButtonText:"Exit/Logout"});reset(div_1);reset(main);reset(div);append($$anchor,fragment);var $$pop=pop({...legacy_api()});$$cleanup();return $$pop}export{_page as component};
//# sourceMappingURL=18.DJRgXaWK.js.map
