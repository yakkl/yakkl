import{c as check_target,l as legacy_api}from"../chunks/BXFaAXnq.js";import{p as push,h as tag,o as onMount,d as onDestroy,f as first_child,c as child,s as sibling,t as template_effect,a as pop,i as state,b as strict_equals,e as set,$ as $document,g as get,F as FILENAME,r as reset,j as next}from"../chunks/BaS8d5lg.js";import{a as add_locations}from"../chunks/3AhEABF_.js";import{s as set_text}from"../chunks/Cmwrv3PW.js";import{a as append,f as from_html}from"../chunks/Cm3jf07C.js";import{v as validate_store}from"../chunks/Dv9a3G0k.js";import{h as head}from"../chunks/twIkBoiu.js";import{s as set_attribute}from"../chunks/DTBsVM-c.js";import{s as set_class}from"../chunks/DX_EEhpR.js";import{d as delegate}from"../chunks/DiU70Is3.js";import{a as store_get,b as store_set,s as setup_stores}from"../chunks/CViNpZsE.js";import{l as log_if_contains_state}from"../chunks/DZ17DrFv.js";import{b as browserSvelte,a as browser_ext}from"../chunks/CgCfpVku.js";import{g as goto}from"../chunks/CkqS9PXN.js";import{p as page}from"../chunks/Dzk7oUvJ.js";import{b as yakklDappConnectRequestStore,g as getSettings,P as PATH_LOGIN,d as PATH_DAPP_ACCOUNTS,Y as YAKKL_DAPP,e as yakklConnectedDomainsStore}from"../chunks/Cb2naUpm.js";_page[FILENAME]="src/routes/(dapp)/dapp/walletConnect/+page.svelte";function handleApprove(_,showConfirm){set(showConfirm,true)}var root=add_locations(from_html(`<div><div class="modal-box relative"><h3 class="text-lg font-bold"> </h3> <p class="py-4">This will connect <span class="font-bold"> </span> to YAKKL速! Do you wish to continue?</p> <div class="modal-action"><button class="btn">Reject</button> <button class="btn">Yes, Approved</button></div></div></div> <div><div class="modal-box relative"><h3 class="text-lg font-bold">Failed!</h3> <p class="py-4"> </p> <div class="modal-action"><button class="btn">Close</button></div></div></div> <div class="text-center justify-center m-2 flex flex-col absolute top-[250px]"><div class="text-primary-content text-2xl font-bold flex flex-col"> <br/> <div class="text-primary-content text-2xl font-bold flex flex-col mt-4">Wants to connect to:</div></div> <div class="text-primary-content text-2xl font-bold flex flex-col mt-3">Connect with YAKKL速</div> <div class="justify-center mt-5"><div class="rounded-badge inline-flex w-fit p-2 bg-secondary text-base-content font-semibold"><div class="flex flex-row w-10 h-10"><img alt="Dapp logo"/></div> <div class="animate-pulse flex flex-row"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-8 h-8 fill-gray-100"><path fill-rule="evenodd" d="M15.97 2.47a.75.75 0 011.06 0l4.5 4.5a.75.75 0 010 1.06l-4.5 4.5a.75.75 0 11-1.06-1.06l3.22-3.22H7.5a.75.75 0 010-1.5h11.69l-3.22-3.22a.75.75 0 010-1.06zm-7.94 9a.75.75 0 010 1.06l-3.22 3.22H16.5a.75.75 0 010 1.5H4.81l3.22 3.22a.75.75 0 11-1.06 1.06l-4.5-4.5a.75.75 0 010-1.06l4.5-4.5a.75.75 0 011.06 0z" clip-rule="evenodd"></path></svg></div> <div class="flex flex-row w-10 h-10"><img src="/images/logoBullFav48x48.png" alt="yakkl logo"/></div></div></div> <div class="text-center flex flex-col m-4 broder border-gray-500 bg-black"><p class="text-base-content font-bold">Select the account(s) to use for this dApp site</p></div> <div class="my-4"><div class="flex space-x-2 justify-center"><button class="btn-sm btn-accent uppercase rounded-full" aria-label="Cancel">Reject</button> <button type="submit" id="recover" class="btn-sm btn-primary uppercase rounded-full ml-2" aria-label="Confirm">Approve</button></div></div></div>`,1),_page[FILENAME],[[122,0,[[123,1,[[125,2],[126,2,[[127,21]]],[129,2,[[130,3],[131,3]]]]]]],[136,0,[[137,1,[[139,2],[140,2],[141,2,[[142,3]]]]]]],[147,0,[[149,1,[[151,2],[152,2]]],[156,1],[157,1,[[158,2,[[159,3,[[160,4]]],[162,3,[[163,4,[[164,5]]]]],[171,3,[[172,4]]]]]]],[177,1,[[178,2]]],[181,1,[[182,2,[[183,3],[191,3]]]]]]]]);function _page($$anchor,$$props){check_target(new.target);push($$props,true,_page);const[$$stores,$$cleanup]=setup_stores();const $page=()=>(validate_store(page,"page"),store_get(page,"$page",$$stores));const $yakklConnectedDomainsStore=()=>(validate_store(yakklConnectedDomainsStore,"yakklConnectedDomainsStore"),store_get(yakklConnectedDomainsStore,"$yakklConnectedDomainsStore",$$stores));let showConfirm=tag(state(false),"showConfirm");let showSuccess=false;let showFailure=tag(state(false),"showFailure");let errorValue=tag(state("No domain/site name was found. Access to YAKKL速 is denied."),"errorValue");let port;let domain=tag(state(void 0),"domain");let domainLogo=tag(state(void 0),"domainLogo");let domainTitle=tag(state(void 0),"domainTitle");let requestData;let method;let requestId;let message;let context;if(browserSvelte){requestId=$page().url.searchParams.get("requestId");store_set(yakklDappConnectRequestStore,requestId)}async function handleIsLocked(){try{let yakklSettings=await getSettings();if(yakklSettings.init&&strict_equals(yakklSettings.isLocked,true)){goto(PATH_LOGIN+"?requestId="+requestId)}else{goto(PATH_DAPP_ACCOUNTS+"?requestId="+requestId)}}catch(e){set(errorValue,e,true);set(showFailure,true)}}onMount(()=>{try{if(browserSvelte){port=browser_ext.runtime.connect({name:YAKKL_DAPP});port.onMessage.addListener(async event=>{var _a,_b,_c,_d,_e,_f,_g,_h,_i,_j;method=event.method;requestData=event.data;if(strict_equals(event.method,"get_params")){set(domainTitle,((_b=(_a=requestData==null?void 0:requestData.data)==null?void 0:_a.metaDataParams)==null?void 0:_b.title)??"",true);set(domain,((_d=(_c=requestData==null?void 0:requestData.data)==null?void 0:_c.metaDataParams)==null?void 0:_d.domain)??"",true);const url=new URL(window.location.href);const favicon=url.searchParams.get("favicon");set(domainLogo,favicon||(((_f=(_e=requestData==null?void 0:requestData.data)==null?void 0:_e.metaDataParams)==null?void 0:_f.icon)??"/images/logoBullLock48x48.png"),true);message=((_h=(_g=requestData==null?void 0:requestData.data)==null?void 0:_g.metaDataParams)==null?void 0:_h.message)??"Nothing was passed in explaining the intent of this approval. Be mindful!";context=((_j=(_i=requestData==null?void 0:requestData.data)==null?void 0:_i.metaDataParams)==null?void 0:_j.context)??"accounts";requestId=!requestId?requestData.id:requestId;if(!get(domain)){set(errorValue,"Domain was not found. Check the dApp site again.");set(showFailure,true)}else{if($yakklConnectedDomainsStore()){$yakklConnectedDomainsStore().find(element=>{if(strict_equals(element.domain,get(domain))){const accounts=element.addresses;if(port)port.postMessage({method:"eth_requestAccounts",id:requestId,type:"YAKKL_RESPONSE",result:accounts});return}})}}}});port.postMessage({method:"get_params",id:requestId})}}catch(e){console.log(...log_if_contains_state("log",e))}});onDestroy(()=>{try{if(browserSvelte){if(port){port.disconnect();port=void 0}}}catch(e){console.log(...log_if_contains_state("log",e))}});function handleReject(){try{set(showConfirm,false);set(showFailure,false);showSuccess=false;if(port)port.postMessage({method:method,response:{type:"error",data:{code:4001,message:"User rejected the request."}},requestData:requestData});if(browserSvelte)window.close()}catch(e){console.log(...log_if_contains_state("log",e))}}var fragment=root();head($$anchor2=>{$document.title="YAKKL速 Smart Wallet"});var div=first_child(fragment);let classes;var div_1=child(div);var h3=child(div_1);var text=child(h3);reset(h3);var p=sibling(h3,2);var span=sibling(child(p));var text_1=child(span,true);reset(span);next();reset(p);var div_2=sibling(p,2);var button=child(div_2);button.__click=handleReject;var button_1=sibling(button,2);button_1.__click=handleIsLocked;reset(div_2);reset(div_1);reset(div);var div_3=sibling(div,2);let classes_1;var div_4=child(div_3);var p_1=sibling(child(div_4),2);var text_2=child(p_1,true);reset(p_1);var div_5=sibling(p_1,2);var button_2=child(div_5);button_2.__click=handleReject;reset(div_5);reset(div_4);reset(div_3);var div_6=sibling(div_3,2);var div_7=child(div_6);var text_3=child(div_7);next(3);reset(div_7);var div_8=sibling(div_7,4);var div_9=child(div_8);var div_10=child(div_9);var img=child(div_10);reset(div_10);next(4);reset(div_9);reset(div_8);var div_11=sibling(div_8,4);var div_12=child(div_11);var button_3=child(div_12);button_3.__click=handleReject;var button_4=sibling(button_3,2);button_4.__click=[handleApprove,showConfirm];reset(div_12);reset(div_11);reset(div_6);template_effect(($0,$1)=>{classes=set_class(div,1,"modal",null,classes,$0);set_text(text,`Connect to ${get(domain)??""}`);set_text(text_1,get(domain));classes_1=set_class(div_3,1,"modal",null,classes_1,$1);set_text(text_2,get(errorValue));set_text(text_3,`${get(domainTitle)??""??""} `);set_attribute(img,"src",get(domainLogo))},[()=>({"modal-open":get(showConfirm)}),()=>({"modal-open":get(showFailure)})]);append($$anchor,fragment);var $$pop=pop({...legacy_api()});$$cleanup();return $$pop}delegate(["click"]);export{_page as component};
//# sourceMappingURL=25.DuI4fxyr.js.map
