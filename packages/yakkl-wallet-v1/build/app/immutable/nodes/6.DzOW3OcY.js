var __defProp=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:true,configurable:true,writable:true,value:value}):obj[key]=value;var __publicField=(obj,key,value)=>__defNormalProp(obj,typeof key!=="symbol"?key+"":key,value);import{h as getMiscStore,C as getYakklCurrentlySelected,bK as TokenService,l as log$1,d9 as MessageType,b7 as activeTabUIStore,a9 as getObjectFromLocalStorage,_ as __vitePreload,i as PATH_LOGOUT,g as getSettings,n as PlanType,v as getProfile,x as isEncryptedData,z as decryptData,H as yakklMiscStore,R as encryptData,am as setProfileStorage,bL as SystemTheme,s as setSettings,da as getYakklGPTKeyStore,db as yakklGPTRunningStore,dc as yakklGPTKeyStore,aY as getYakklChats,ab as dateString,V as VERSION$1,aE as DEFAULT_PERSONA,aJ as yakklChatsStore,aK as setYakklChatsStorage,k as yakklConnectionStore,dd as formatTimestamp,P as PATH_LOGIN,ae as PATH_WELCOME,de as PATH_ETHEREUM_TRANSACTIONS_SEND,aj as yakklCombinedTokenStore,ah as yakklTokenDataCustomStore,af as setYakklTokenDataCustomStorage,Z as yakklCurrentlySelectedStore,$ as yakklPricingStore,ay as NetworkType,a1 as EthereumBigNumber,ak as setYakklCurrentlySelectedStorage,aL as yakklAccountsStore,a as DEFAULT_POPUP_WIDTH,an as DEFAULT_TITLE,D as DEFAULT_POPUP_HEIGHT,cv as sessionInitialized}from"../chunks/Cb2naUpm.js";import{a as browser_ext,b as browserSvelte}from"../chunks/CgCfpVku.js";import{g as get,w as writable,d as derived}from"../chunks/B2gA1VsD.js";import{i as isServerSide}from"../chunks/BgnL0Zd7.js";import{g as getBrowserExt}from"../chunks/DPTaukvs.js";import{c as check_target,l as legacy_api}from"../chunks/BXFaAXnq.js";import{p as push$1,f as first_child,s as sibling,c as child,r as reset,a as pop,b as strict_equals,F as FILENAME,n as noop,h as tag,o as onMount,d as onDestroy,t as template_effect,i as state$1,e as set,g as get$1,j as next,ay as user_effect,u as user_derived,a7 as untrack,bv as to_array,ae as proxy,aC as tag_proxy,m as mutable_source,ak as update,bD as effect_root,aZ as equals,$ as $document}from"../chunks/BaS8d5lg.js";import{a as add_locations}from"../chunks/3AhEABF_.js";import{h as head}from"../chunks/twIkBoiu.js";import{a as append,f as from_html,c as comment,t as text,d as from_svg}from"../chunks/Cm3jf07C.js";import{i as if_block}from"../chunks/Q1yPWpQ-.js";import{w as wrap_snippet,s as snippet}from"../chunks/d5hrMixo.js";import{s as set_class,c as clsx}from"../chunks/DX_EEhpR.js";import{a as store_get,s as setup_stores,d as store_mutate,b as store_set}from"../chunks/CViNpZsE.js";import{v as validate_store}from"../chunks/Dv9a3G0k.js";import{l as log,p as process$1}from"../chunks/WDN37msH.js";import"../chunks/Doq7snb5.js";import{d as delegate,e as event,c as remove_textarea_child,b as apply}from"../chunks/DiU70Is3.js";import{i as init$1}from"../chunks/D9iNYspi.js";import{UnifiedTimerManager}from"../chunks/z-nmOEXa.js";import{h as handleOpenInTab,C as ClipboardJS,v as autoscroll,o as getTokenChange,e as formatEther,w as truncate,x as blockContextMenu,b as blockWindowResize}from"../chunks/CnIbzB-6.js";import"../chunks/Dw28gLPr.js";import{i as identicon}from"../chunks/j44ihrtO.js";import{s as safeLogout}from"../chunks/COpD6KvM.js";import{d as attribute_effect,s as set_attribute,r as remove_input_defaults,b as bind_select_value}from"../chunks/DTBsVM-c.js";import{r as rest_props,p as prop}from"../chunks/BYboeQtC.js";import"../chunks/D-aJ6pD4.js";import{P as Popover,f as action,S as Spinner,A as Avatar$1,g as SpeedDial,h as SpeedDialButton}from"../chunks/trmx-wka.js";import{P as PlanBadge,T as Tooltip_1,E as EyeIcon}from"../chunks/DoycIOVK.js";import{b as bind_this}from"../chunks/BMXnoaUY.js";import{g as goto}from"../chunks/CkqS9PXN.js";import{s as shouldShowProFeatures,t as toProAnalytics,a as toBasicAnalytics}from"../chunks/lYZBmhZM.js";import{S as SimpleTooltip}from"../chunks/De3JWpHf.js";import{s as set_text}from"../chunks/Cmwrv3PW.js";import{c as create_ownership_validator}from"../chunks/COgMMZ9C.js";import{b as bind_value,a as bind_checked}from"../chunks/B6q982nR.js";import{c as createForm$1}from"../chunks/CEKklR__.js";import{c as create$3,a as create$6,d as create$7,e as create$5}from"../chunks/B4Ku5_Cd.js";import{M as Modal}from"../chunks/UU1vCwIM.js";import{E as ErrorNoAction}from"../chunks/2Ogrppv5.js";import{e as each,i as index}from"../chunks/DraJ8LN-.js";import{v as validate_snippet_args,P as ProtectedValue}from"../chunks/BWLEmBJs.js";import{v as validate_binding,a as validate_each_keys}from"../chunks/PvfmHBx2.js";import{W as WalletManager}from"../chunks/BJK8DTVo.js";import{g as getYakklCurrentlySelectedAccountKey}from"../chunks/z_jpiecc.js";import{h as html}from"../chunks/CAyblTkn.js";import{B as Buffer2}from"../chunks/BOosul_h.js";import{S as Swap,U as UniswapSwapManager,g as getTokenBalance,R as Receive}from"../chunks/Dlv-TT2p.js";import{initializeUiContext}from"../chunks/DT3ZCMgr.js";import{s as set_style}from"../chunks/D1JcdFy3.js";import{t as transition,a as fly,f as fade}from"../chunks/DevLwR0m.js";import{N as NotificationService}from"../chunks/Bmr6hs4q.js";import{S as SecurityWarningEnhanced}from"../chunks/BkpHtFnp.js";import{a as await_block}from"../chunks/BB5C_DND.js";import{b as startPricingChecks,c as checkPricesCallback,s as stopCheckPrices}from"../chunks/Ch26qbWO.js";import{A as Accounts,C as Copy}from"../chunks/D6ZwBv0_.js";import{C as Contacts}from"../chunks/Dko_oNea.js";import{C as Confirmation}from"../chunks/BWiVuumU.js";import{E as EditControls}from"../chunks/BELG66li.js";import{a as ImportPrivateKey,I as ImportWatchAccount,S as SkeletonBalance}from"../chunks/3fXJKFcU.js";import{U as Upgrade}from"../chunks/CIbUU8ai.js";import{u as updateTokenPrices}from"../chunks/CrqeLLe0.js";import{balanceCacheManager}from"../chunks/DpKLkluw.js";import{a as accountTokenCacheManager}from"../chunks/DNmXX2Qc.js";import{T as TrialCountdown}from"../chunks/CvCb2i3l.js";import{c as closeModal,m as modal,a as modalName}from"../chunks/CZPMS86D.js";function computeTokenValue(token){var _a2;let balance=(token==null?void 0:token.balance)?Number(token.balance):0;const price=((_a2=token==null?void 0:token.price)==null?void 0:_a2.price)??0;const value=balance*price;return{balance:balance,value:value}}var define_process_env_default$1={DEV_MODE:"true",NODE_ENV:'"development"'};async function getInstances(){var _a2;try{const yakklMiscStore2=getMiscStore();if(!yakklMiscStore2){return[null,null,null,null]}const currentlySelected=await getYakklCurrentlySelected();const chainId=((_a2=currentlySelected.shortcuts)==null?void 0:_a2.chainId)??1;let wallet=null;const apiKey=define_process_env_default$1.ALCHEMY_API_KEY_PROD||define_process_env_default$1.VITE_ALCHEMY_API_KEY_PROD||"pBm4VA9q8Laz9x3bmXTNZ9m-ArxczEWk";wallet=WalletManager.getInstance(["Alchemy"],["Ethereum"],chainId,apiKey);if(wallet){if(!wallet.getSigner()){const accountKey=await getYakklCurrentlySelectedAccountKey();if(accountKey==null?void 0:accountKey.privateKey){await wallet.setSigner(accountKey.privateKey)}else{log.warn("No account key found, wallet may not be functional.")}}const provider=wallet.getProvider();if(provider){const signer=wallet.getSigner();if(signer){provider.setSigner(signer)}const blockchain=wallet.getBlockchain();const tokenService=new TokenService(blockchain);return[wallet,provider,blockchain,tokenService]}return[wallet,null,null,null]}return[null,null,null,null]}catch(error){log.error("getInstances() - Failed:",false,error);return[null,null,null,null]}}var ConnectionType=(ConnectionType2=>{ConnectionType2["UI"]="ui-connection";ConnectionType2["POPUP"]="popup-connection";ConnectionType2["CONTENT"]="content-connection";return ConnectionType2})(ConnectionType||{});const _BackgroundManager=class _BackgroundManager{constructor(){__publicField(this,"connections");__publicField(this,"messageQueue");__publicField(this,"MAX_QUEUE_SIZE",100);__publicField(this,"STORAGE_PREFIX","bg_msg_");__publicField(this,"initialized",false);this.connections=new Map;this.messageQueue=[];this.initialize().catch(error=>{log$1.error("Failed to initialize BackgroundManager:",false,error)})}static getInstance(){if(!_BackgroundManager.instance){_BackgroundManager.instance=new _BackgroundManager}return _BackgroundManager.instance}async initialize(){if(!browser_ext)return;if(this.initialized)return;try{browser_ext.runtime.onConnect.addListener(port=>{if(this.isValidConnectionType(port.name)){this.handleNewConnection(port)}});await this.restoreQueuedMessages();this.initialized=true}catch(error){log$1.error("BackgroundManager initialization failed:",false,error);throw error}}isValidConnectionType(type){return Object.values(ConnectionType).includes(type)}handleNewConnection(port){try{const connectionInfo={type:port.name,port:port,connectedAt:Date.now()};this.connections.set(port.name,connectionInfo);port.onDisconnect.addListener(()=>{this.handleDisconnection(port)});this.processQueuedMessages().catch(error=>{log$1.error("Failed to process queued messages:",false,error)})}catch(error){log$1.error("Error handling new connection:",false,error)}}handleDisconnection(port){try{this.connections.delete(port.name)}catch(error){log$1.error("Error handling disconnection:",false,error)}}hasConnections(){return this.connections.size>0}hasUIConnection(){return this.connections.has("ui-connection")}getConnectionInfo(type){return this.connections.get(type)}async sendMessage(type,data){try{if(!this.hasConnections()){await this.handleNoConnections(type,data);return}const message={type:type,data:data};const sendPromises=[];this.connections.forEach(({port:port})=>{sendPromises.push(new Promise((resolve,reject)=>{try{port.postMessage(message);resolve()}catch(error){reject(error)}}))});await Promise.allSettled(sendPromises)}catch(error){log$1.error("Failed to send message:",false,error);await this.handleMessageError(type,data,error)}}async handleNoConnections(type,data){try{await Promise.all([this.queueMessage(type,data),this.saveToStorage(type,data)])}catch(error){log$1.error("Failed to handle no connections case:",false,error)}}async handleMessageError(type,data,error){try{await this.queueMessage(type,data);log$1.error("Message queued due to error:",false,{type:type,error:error})}catch(queueError){log$1.error("Failed to queue message after error:",false,queueError)}}async queueMessage(type,data){const queuedMessage={type:type,data:data,timestamp:Date.now()};this.messageQueue.push(queuedMessage);if(this.messageQueue.length>this.MAX_QUEUE_SIZE){this.messageQueue.shift()}await this.persistQueue()}async persistQueue(){if(!browser_ext)return;try{await browser_ext.storage.local.set({[`${this.STORAGE_PREFIX}queue`]:this.messageQueue})}catch(error){log$1.error("Failed to persist message queue:",false,error)}}async restoreQueuedMessages(){if(!browser_ext)return;try{const result=await browser_ext.storage.local.get(`${this.STORAGE_PREFIX}queue`);const storedQueue=result[`${this.STORAGE_PREFIX}queue`];if(Array.isArray(storedQueue)){this.messageQueue=storedQueue.filter(message=>typeof message==="object"&&message!==null&&"type"in message&&"data"in message&&"timestamp"in message&&typeof message.type==="string"&&typeof message.timestamp==="number")}else{this.messageQueue=[];log$1.debug("No valid queued messages found in storage")}}catch(error){log$1.error("Failed to restore queued messages:",false,error);this.messageQueue=[]}}async saveToStorage(type,data){if(!browser_ext)return;try{await browser_ext.storage.local.set({[`${this.STORAGE_PREFIX}${type}`]:{data:data,timestamp:Date.now()}})}catch(error){log$1.error("Failed to save to storage:",false,error)}}async processQueuedMessages(){if(!this.hasConnections()){return}try{const messages=[...this.messageQueue];this.messageQueue=[];for(const message of messages){await this.sendMessage(message.type,message.data)}await this.persistQueue()}catch(error){log$1.error("Failed to process queued messages:",false,error)}}async clearQueue(){try{this.messageQueue=[];await this.persistQueue()}catch(error){log$1.error("Failed to clear message queue:",false,error)}}getQueueSize(){return this.messageQueue.length}isInitialized(){return this.initialized}};__publicField(_BackgroundManager,"instance",null);let BackgroundManager=_BackgroundManager;BackgroundManager.getInstance();const MAX_RETRIES=5;const INITIAL_RETRY_DELAY=1e3;const MAX_RETRY_DELAY=32e3;const state={retryCount:0,retryTimeout:void 0,isConnecting:false};function calculateBackoffDelay(retryCount){const exponentialDelay=INITIAL_RETRY_DELAY*Math.pow(2,retryCount);const maxDelay=Math.min(exponentialDelay,MAX_RETRY_DELAY);const jitter=maxDelay*.2*(Math.random()*2-1);return Math.floor(maxDelay+jitter)}function cleanupConnection(){if(state.retryTimeout){clearTimeout(state.retryTimeout);state.retryTimeout=void 0}state.isConnecting=false}async function retryConnection(){if(browserSvelte){if(state.retryCount>=MAX_RETRIES){log$1.error("Maximum reconnection attempts reached",true,{attempts:state.retryCount});cleanupConnection();return}const delay=calculateBackoffDelay(state.retryCount);log$1.info("Attempting to reconnect",false,{attempt:state.retryCount+1,delay:`${delay}ms`});if(typeof window!=="undefined"){state.retryTimeout=window.setTimeout(async()=>{try{state.retryCount++;await initializeUIConnection()}catch(error){log$1.error("Reconnection attempt failed:",false,{attempt:state.retryCount,error:error});await retryConnection()}},delay)}}}async function initializeUIConnection(){if(state.isConnecting){log$1.warn("Connection attempt already in progress");return}try{state.isConnecting=true;if(browserSvelte&&browser_ext){const port=browser_ext.runtime.connect({name:ConnectionType.UI});if(!port){log$1.error("Failed to establish connection with UI",true);throw new Error("Connection failed")}port.onMessage.addListener(message=>{try{if(isValidMessage(message)){handleMessage(message)}else{log$1.warn("Invalid message format received:",false,message)}}catch(error){log$1.error("Error handling message:",false,error)}});port.onDisconnect.addListener(()=>{if(browserSvelte&&browser_ext){const error=browser_ext.runtime.lastError;log$1.warn("UI connection disconnected",false,{error:error});cleanupConnection();if(browser_ext&&!browser_ext.runtime.lastError){retryConnection().catch(error2=>{log$1.error("Failed to initiate reconnection:",true,error2)})}else{log$1.warn("Extension context invalid, skipping reconnection")}}});state.retryCount=0;state.isConnecting=false;log$1.info("UI connection established successfully");return port}}catch(error){log$1.error("Failed to initialize UI connection:",true,error);throw error}}let connectionMonitorInterval;function startConnectionMonitor(){if(typeof window!=="undefined"){connectionMonitorInterval=window.setInterval(()=>{if(!state.isConnecting&&state.retryCount<MAX_RETRIES){if(browserSvelte&&browser_ext){browser_ext.runtime.getPlatformInfo().then(()=>{}).catch(()=>{log$1.warn("Connection check failed, initiating reconnect");initializeUIConnection().catch(error=>{log$1.error("Connection monitor reconnect failed:",false,error)})})}}},3e4)}}function stopConnectionMonitor(){if(connectionMonitorInterval){clearInterval(connectionMonitorInterval);connectionMonitorInterval=void 0}}function cleanup(){cleanupConnection();stopConnectionMonitor()}startConnectionMonitor();function handleMessage(message){try{log$1.debug("handleMessage:[connectionStore]",false,message);switch(message.type){case MessageType.ACTIVE_TAB_CHANGED:if(isTabChangeData(message.data)){handleActiveTabChange(message.data)}break;case MessageType.TAB_UPDATED:if(isTabChangeData(message.data)){handleTabUpdate(message.data)}break;case MessageType.TAB_REMOVED:if(isTabChangeData(message.data)){handleTabRemove(null)}break;case MessageType.WINDOW_FOCUSED:if(isWindowFocusData(message.data)){handleWindowFocus(message.data)}break;default:log$1.info("Unhandled message type. Letting it pass:",false,message.type)}}catch(error){throw error}}function isValidMessage(message){return typeof message==="object"&&message!==null&&"type"in message&&"data"in message&&typeof message.type==="string"}function isTabChangeData(data){return typeof data==="object"&&data!==null&&"tabId"in data&&typeof data.tabId==="number"}function isWindowFocusData(data){return typeof data==="object"&&data!==null&&"windowId"in data&&typeof data.windowId==="number"}function handleActiveTabChange(data){log$1.debug("handleActiveTabChange:--------------------\x3e>>>>>>>>>",false,data);if((data==null?void 0:data.windowType)==="normal"){activeTabUIStore.set(data);log$1.debug("Active tab changed:",false,data)}}function handleTabRemove(data){}function handleTabUpdate(data){activeTabUIStore.set(data);log$1.debug("Tab removed:",false,data)}async function handleWindowFocus(data){try{if(!(browserSvelte&&browser_ext))return;log$1.debug("handleWindowFocus:>>>>>>>>>>>>>>>>>>>>>>",false,data);if((data==null?void 0:data.type)==="normal"){const activeTab={tabId:0,windowId:data.windowId,windowType:data.type,url:"",title:"",favIconUrl:"",dateTime:(new Date).toISOString()};const tabs=await browser_ext.tabs.query({active:true,windowId:data.windowId});if(tabs.length>0){activeTab.tabId=tabs[0].id??0;activeTab.url=tabs[0].url??"";activeTab.title=tabs[0].title??"";activeTab.favIconUrl=tabs[0].favIconUrl??"";if(activeTab.tabId>0){activeTabUIStore.set(activeTab);log$1.debug("Window focused changed: [connectionStore]",false,activeTab)}}}else{}}catch(error){log$1.error("Error handling window focus:",false,error);throw error}}async function load(){if(isServerSide()){log$1.info("+layout.ts is running in SSR, skipping browser_ext usage.");return{}}try{log$1.debug("/+layout.ts - Initializing UI connection...");await initializeUIConnection();const activeTab=get(activeTabUIStore);if(!activeTab){const ext=getBrowserExt();if(ext){try{const response=await ext.runtime.sendMessage({type:"getActiveTab"});if(response==null?void 0:response.activeTab){activeTabUIStore.set(response.activeTab)}else{log$1.debug("No active tab found, getting from local storage:",false,await getObjectFromLocalStorage("activeTabBackground"))}log$1.debug("Active tab:",false,activeTab,response,activeTabUIStore)}catch(error){log$1.error("Failed to initialize UI connection:",false,error)}}else{log$1.warn("browser_ext is not available.")}}}catch(error){log$1.error("Failed to initialize UI connection:",false,error)}return{destroy(){cleanup()}}}const _layout$1=Object.freeze(Object.defineProperty({__proto__:null,load:load},Symbol.toStringTag,{value:"Module"}));var ExtensionContext=(ExtensionContext2=>{ExtensionContext2["UNKNOWN"]="unknown";ExtensionContext2["BACKGROUND"]="background";ExtensionContext2["POPUP"]="popup";ExtensionContext2["CONTENT_SCRIPT"]="content_script";ExtensionContext2["OPTIONS"]="options";ExtensionContext2["DEVTOOLS"]="devtools";ExtensionContext2["SIDEPANEL"]="sidepanel";return ExtensionContext2})(ExtensionContext||{});const _BrowserAccessor=class _BrowserAccessor{constructor(){__publicField(this,"browserApi",null);__publicField(this,"currentContext","unknown");__publicField(this,"initialized",false);__publicField(this,"initPromise",null)}static getInstance(){if(!_BrowserAccessor.instance){_BrowserAccessor.instance=new _BrowserAccessor}return _BrowserAccessor.instance}isInServiceWorker(){try{return typeof self!=="undefined"&&typeof self.ServiceWorkerGlobalScope!=="undefined"&&self instanceof self.ServiceWorkerGlobalScope}catch(error){return false}}hasChromeApis(){return typeof chrome!=="undefined"&&!!chrome&&!!chrome.runtime}async detectContext(){var _a2,_b;if(typeof window==="undefined"&&typeof self==="undefined"){return"unknown"}try{const isServiceWorker=this.isInServiceWorker();const hasExtensionApi=this.hasChromeApis();const isWindow=typeof window!=="undefined";const isPopup=isWindow&&(window.location.pathname.includes("popup.html")||((_a2=document.body)==null?void 0:_a2.dataset.context)==="popup");const isOptions=isWindow&&(window.location.pathname.includes("options.html")||((_b=document.body)==null?void 0:_b.dataset.context)==="options");const hasDevtools=typeof chrome!=="undefined"&&typeof chrome.devtools!=="undefined";const isContentScript=isWindow&&hasExtensionApi&&window.location.protocol.startsWith("http");if(await this.resolveExecutionContext()==="sidepanel"){return"sidepanel"}if(isServiceWorker&&hasExtensionApi){return"background"}else if(isPopup){return"popup"}else if(isOptions){return"options"}else if(hasDevtools){return"devtools"}else if(isContentScript){return"content_script"}else if(hasExtensionApi){return"popup"}}catch(error){log.error("Error detecting context:",false,error)}return"unknown"}async resolveExecutionContext(){try{const win=await browser_ext.windows.getCurrent();if(!win||!win.type){return"sidepanel"}if(win.type==="popup")return"popup";if(win.type==="normal")return"sidepanel";return"sidepanel"}catch(err){console.warn("Error resolving execution context:",err);return"sidepanel"}}async initialize(){if(this.initialized){return this.browserApi}if(this.initPromise){return this.initPromise}if(typeof window==="undefined"&&typeof self==="undefined"){this.initialized=true;return null}this.initPromise=(async()=>{try{this.currentContext=await this.detectContext();log.info(`Initializing browser API in ${this.currentContext} context`);if(this.currentContext!=="unknown"){if(typeof window!=="undefined"&&window.browser){this.browserApi=window.browser;log.info("Using global browser API from window.browser")}else if(this.hasChromeApis()){if(this.currentContext==="background"){try{log.info("Loaded browser API via dynamic import in background");const polyfill=await __vitePreload(()=>import("webextension-polyfill"),true?[]:void 0,import.meta.url);this.browserApi=polyfill.default}catch(e){log.error("Failed to import polyfill in background:",false,e);this.browserApi=this.createChromeShim()}}else{this.browserApi=window.browser||this.createChromeShim();log.info("Using global browser API or chrome shim")}}}if(!this.browserApi){log.warn(`No browser API available in ${this.currentContext} context`)}}catch(error){log.error("Failed to initialize browser API:",false,error);this.browserApi=null}finally{this.initialized=true;this.initPromise=null}return this.browserApi})();return this.initPromise}async getBrowser(){if(!this.initialized&&!this.initPromise){await this.initialize()}return this.browserApi}getBrowserSync(){if(!this.initialized&&!this.initPromise){this.initialize().catch(e=>{log.error("Async initialization failed:",false,e)})}return this.browserApi}async getContext(){if(this.currentContext==="unknown"){this.currentContext=await this.detectContext()}return this.currentContext}setBrowser(browser){this.browserApi=browser;this.initialized=true}hasChromeApi(apiName){if(!this.hasChromeApis())return false;switch(apiName){case"sidePanel":return typeof chrome.sidePanel!=="undefined";case"tabs":return typeof chrome.tabs!=="undefined";case"alarms":return typeof chrome.alarms!=="undefined";case"idle":return typeof chrome.idle!=="undefined";case"notifications":return typeof chrome.notifications!=="undefined";default:return false}}async performOperation(operation,fallback){const browser=await this.getBrowser();if(!browser){return fallback}try{return await operation(browser)}catch(error){log.error("Browser operation failed:",false,error);return fallback}}createChromeShim(){if(!this.hasChromeApis()){log.warn("Chrome APIs not available for creating shim");return{}}const browser={};if(chrome==null?void 0:chrome.runtime){browser.runtime={sendMessage:message=>new Promise((resolve,reject)=>{chrome.runtime.sendMessage(message,response=>{if(chrome.runtime.lastError){reject(chrome.runtime.lastError)}else{resolve(response)}})}),connect:connectInfo=>{const port=chrome.runtime.connect(connectInfo);return port}}}if(chrome==null?void 0:chrome.storage){browser.storage={local:{get:keys=>new Promise((resolve,reject)=>{chrome.storage.local.get(keys,result=>{if(chrome.runtime.lastError){reject(chrome.runtime.lastError)}else{resolve(result)}})}),set:items=>new Promise((resolve,reject)=>{chrome.storage.local.set(items,()=>{if(chrome.runtime.lastError){reject(chrome.runtime.lastError)}else{resolve()}})}),remove:keys=>new Promise((resolve,reject)=>{chrome.storage.local.remove(keys,()=>{if(chrome.runtime.lastError){reject(chrome.runtime.lastError)}else{resolve()}})}),clear:()=>new Promise((resolve,reject)=>{chrome.storage.local.clear(()=>{if(chrome.runtime.lastError){reject(chrome.runtime.lastError)}else{resolve()}})})}}}if(chrome==null?void 0:chrome.sidePanel){browser.sidePanel={setPanelBehavior:options=>new Promise((resolve,reject)=>{try{chrome.sidePanel.setPanelBehavior(options);resolve()}catch(error){reject(error)}}),open:options=>new Promise((resolve,reject)=>{try{chrome.sidePanel.open(options);resolve()}catch(error){reject(error)}})}}if(chrome==null?void 0:chrome.tabs){const tabsImpl={query:queryInfo=>new Promise((resolve,reject)=>{chrome.tabs.query(queryInfo,tabs=>{if(chrome.runtime.lastError){reject(chrome.runtime.lastError)}else{resolve(tabs)}})}),get:tabId=>new Promise((resolve,reject)=>{chrome.tabs.get(tabId,tab=>{if(chrome.runtime.lastError){reject(chrome.runtime.lastError)}else{resolve(tab)}})}),getCurrent:()=>new Promise((resolve,reject)=>{chrome.tabs.getCurrent(tab=>{if(chrome.runtime.lastError){reject(chrome.runtime.lastError)}else{resolve(tab)}})})};browser.tabs=tabsImpl}if(chrome==null?void 0:chrome.alarms){const alarmsImpl={create:function(nameOrInfo,maybeInfo){try{if(typeof nameOrInfo==="string"){if(maybeInfo){chrome.alarms.create(nameOrInfo,maybeInfo)}else{chrome.alarms.create(nameOrInfo,{})}}else{chrome.alarms.create("",nameOrInfo)}}catch(error){log.error("Error creating alarm:",false,error)}},clear:name=>new Promise((resolve,reject)=>{chrome.alarms.clear(name,wasCleared=>{if(chrome.runtime.lastError){reject(chrome.runtime.lastError)}else{resolve(wasCleared)}})}),clearAll:()=>new Promise((resolve,reject)=>{chrome.alarms.clearAll(wasCleared=>{if(chrome.runtime.lastError){reject(chrome.runtime.lastError)}else{resolve(wasCleared)}})})};if(chrome.alarms.onAlarm){alarmsImpl.onAlarm={addListener:listener=>{chrome.alarms.onAlarm.addListener(listener)},removeListener:listener=>{chrome.alarms.onAlarm.removeListener(listener)},hasListener:listener=>chrome.alarms.onAlarm.hasListener(listener)}}browser.alarms=alarmsImpl}const browser_ext2=browser;return browser_ext2}};__publicField(_BrowserAccessor,"instance");let BrowserAccessor=_BrowserAccessor;Share[FILENAME]="src/lib/components/Share.svelte";var root_1$c=add_locations(from_html(`<div class="p-1 block"><div class="flex text-center justify-center m-2 ml-0 w-full"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-6 h-6 fill-red-700 animate-pulse"><path d="M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007.004-.003.001a.752.752 0 01-.704 0l-.003-.001z"></path></svg> <p class="ml-1 text-sm font-bold text-center text-purple-600">SHARE THE LOVE!</p></div> <button id="twitter" data-id="twitter" class="flex flex-row rounded-md ml-6 text-base font-semibold text-gray-900 dark:text-wwhite hover:bg-gray-200 w-full text-left"><svg viewBox="0 0 1200 1227" xmlns="http://www.w3.org/2000/svg" class="flex flex-col w-5 h-5 mt-[.1rem] mr-1 bg-black"><path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z" fill="white"></path></svg> <span class="ml-3 flex flex-col text-base font-semibold text-gray-900 dark:text-base-content hover:text-slate-600 dark:hover:text-gray-900">X (twitter)</span></button> <button id="linkedin" data-id="linkedin" class="my-1 flex flex-row rounded-md ml-6 text-base font-semibold text-gray-900 dark:text-white hover:bg-gray-200 w-full text-left"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="flex flex-col w-6 h-6"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg> <span class="ml-3 flex flex-col text-base font-semibold text-gray-900 dark:text-base-content hover:text-slate-600 dark:hover:text-gray-900">LinkedIn</span></button></div>`),Share[FILENAME],[[37,1,[[38,2,[[39,3,[[44,4]]],[48,3]]],[52,2,[[58,3,[[63,4]]],[68,3]]],[74,2,[[80,3,[[81,4]]],[85,3]]]]]]);var root$g=add_locations(from_html(`<!>  <button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-7 h-7 fill-gray-100 hover:fill-gray-400"><path fill-rule="evenodd" d="M15.75 4.5a3 3 0 11.825 2.066l-8.421 4.679a3.002 3.002 0 010 1.51l8.421 4.679a3 3 0 11-.729 1.31l-8.421-4.678a3 3 0 110-4.132l8.421-4.679a3 3 0 01-.096-.755z" clip-rule="evenodd"></path></svg></button>`,1),Share[FILENAME],[[95,0,[[101,1,[[107,2]]]]]]);function Share($$anchor,$$props){check_target(new.target);push$1($$props,true,Share);let rest=rest_props($$props,["$$slots","$$events","$$legacy"],"rest");async function handleShare(event2){var _a2;event2.preventDefault();const target=event2.currentTarget;const id=(_a2=target==null?void 0:target.dataset)==null?void 0:_a2.id;if(!id){log.error("No ID found");return}let message;let url="";if(strict_equals(id,"twitter")){message="Spreading the love! @yakklcrypto YAKKL¬Æ Smart Wallet is awesome! Their website is: https://yakkl.com and you can download the Smart Wallet at the Chrome Browser Extension store: ";url=encodeURI(`https://twitter.com/intent/tweet?hashtags=crypto,yakkl,bitcoin,ethereum&via=yakklcrypto&original_referer=https://yakkl.com&ref_src=YAKKL&url=https://chrome.google.com/webstore/detail/dpmfhilhjlhhakpbieclcghochdofeao/&text=${message}`)}else if(strict_equals(id,"linkedin")){message="Can't wait to share the love of YAKKL¬Æ Smart Wallet! Download the best Crypto Smart Wallet at (Google Chrome Store) https://chrome.google.com/webstore/detail/dpmfhilhjlhhakpbieclcghochdofeao/. The website is: https://yakkl.com.";url=encodeURI(`https://www.linkedin.com/sharing/share-offsite?url=https://yakkl.com/?utm_source=linkedin&utm_medium=share&title=${message}`)}if(url){handleOpenInTab(url)}}var fragment=root$g();var node=first_child(fragment);Popover(node,{triggeredBy:"#share",placement:"bottom-start",class:"w-[200px] text-sm font-normal text-gray-900 bg-white dark:text-gray-400 dark:border-gray-600 dark:bg-gray-800 z-100",children:wrap_snippet(Share,($$anchor2,$$slotProps)=>{var div=root_1$c();var button=sibling(child(div),2);button.__click=handleShare;var button_1=sibling(button,2);button_1.__click=handleShare;reset(div);append($$anchor2,div)}),$$slots:{default:true}});var button_2=sibling(node,2);attribute_effect(button_2,()=>({id:"share",onclick:handleShare,...rest,class:"bg-transparent border-none p-0 cursor-pointer"}));append($$anchor,fragment);return pop({...legacy_api()})}delegate(["click"]);ImageBar[FILENAME]="src/lib/components/ImageBar.svelte";var root$f=add_locations(from_html(`<div id="imgHeader" class="visible print:hidden relative top-0 h-[65px] bg-cover bg-[url('/images/background_gradient_2.png')] mx-2 mt-2 rounded-lg"><!></div>`),ImageBar[FILENAME],[[6,0]]);function ImageBar($$anchor,$$props){check_target(new.target);push$1($$props,true,ImageBar);var div=root$f();var node=child(div);snippet(node,()=>$$props.children??noop);reset(div);append($$anchor,div);return pop({...legacy_api()})}const showEmergencyKit=writable(false);const showEmergencyKitExport=writable(false);const showEmergencyKitImport=writable(false);OffcanvasMainMenu[FILENAME]="src/lib/components/OffcanvasMainMenu.svelte";function handleLogout$1(){goto(PATH_LOGOUT)}function openExportKit(_,isProUser){if(!get$1(isProUser))return;showEmergencyKitExport.set(true);showEmergencyKitImport.set(false);showEmergencyKit.set(true)}function openImportKit(__1,isProUser){if(!get$1(isProUser))return;showEmergencyKitExport.set(false);showEmergencyKitImport.set(true);showEmergencyKit.set(true)}var root_1$b=add_locations(from_html(`<button class="w-full text-left px-4 py-2 rounded-md text-sm hover:bg-primary-100 transition flex items-center gap-2"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z"></path></svg> Export Emergency Kit</button>`),OffcanvasMainMenu[FILENAME],[[125,4,[[129,5,[[130,6]]]]]]);var root_3$a=add_locations(from_html(`<button disabled class="w-full text-left px-4 py-2 rounded-md text-sm text-gray-400 cursor-not-allowed flex items-center gap-2"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg> Export Emergency Kit <div class="w-3 h-3 bg-gradient-to-r from-indigo-400 to-purple-400 rounded-full flex items-center justify-center ml-auto"><svg class="w-2 h-2 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg></div></button>`),OffcanvasMainMenu[FILENAME],[[136,5,[[140,6,[[141,7]]],[144,6,[[145,7,[[146,8]]]]]]]]);var root_4$8=add_locations(from_html(`<button class="w-full text-left px-4 py-2 rounded-md text-sm hover:bg-primary-100 transition flex items-center gap-2"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z"></path></svg> Import Emergency Kit</button>`),OffcanvasMainMenu[FILENAME],[[155,4,[[159,5,[[160,6]]]]]]);var root_6$a=add_locations(from_html(`<button disabled class="w-full text-left px-4 py-2 rounded-md text-sm text-gray-400 cursor-not-allowed flex items-center gap-2"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg> Import Emergency Kit <div class="w-3 h-3 bg-gradient-to-r from-indigo-400 to-purple-400 rounded-full flex items-center justify-center ml-auto"><svg class="w-2 h-2 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg></div></button>`),OffcanvasMainMenu[FILENAME],[[166,5,[[170,6,[[171,7]]],[174,6,[[175,7,[[176,8]]]]]]]]);var root$e=add_locations(from_html(`<div class="z-100 offcanvas offcanvas-start top-0 left-0 fixed bottom-auto flex flex-col min-w-[200px] max-w-[280px] font-sans antialiased invisible bg-clip-padding shadow-sm outline-none transition duration-300 ease-in-out border-none rounded-r-md bg-primary text-base-content" tabindex="-1" id="offcanvasMainMenu" aria-labelledby="offcanvasMainMenuLabel" role="dialog" aria-modal="true"><div class="offcanvas-header flex items-center justify-between px-4 pt-2 pb-2 bg-primary-200"><h5 class="offcanvas-title font-semibold" id="offcanvasMainMenuLabel">Menu</h5> <button type="button" class="text-base-content opacity-60 hover:opacity-100" data-bs-dismiss="offcanvas" aria-label="Close"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <hr class="my-1 border-base-content/20"/> <ul class="px-2 space-y-1"><li><!></li> <li><!></li> <li data-bs-dismiss="offcanvas"><a href="https://yakkl.com/university/support?utm_source=yakkl&amp;utm_medium=extension&amp;utm_campaign=extension&amp;utm_content=menu&amp;utm_term=help" class="block px-4 py-2 rounded-md text-sm hover:bg-primary-100 transition" target="_blank" rel="noreferrer">‚ùì Help Center</a></li> <li data-bs-dismiss="offcanvas"><button class="w-full text-left px-4 py-2 rounded-md text-sm text-red-600 hover:text-red-800 hover:bg-primary-100 transition">üîí Lock & Logout</button></li> <li data-bs-dismiss="offcanvas"><button class="w-full text-left px-4 py-2 rounded-md text-sm hover:bg-primary-100 transition">üß® Exit YAKKL</button></li></ul> <hr class="my-1 border-base-content/20"/> <div class="text-center py-2 bg-primary"><a class="text-sm font-semibold text-base-content hover:underline" href="https://yakkl.com/?utm_source=yakkl&amp;utm_medium=extension&amp;utm_campaign=extension&amp;utm_content=menu&amp;utm_term=extension" target="_blank" rel="noreferrer">yakkl.com</a></div></div>`),OffcanvasMainMenu[FILENAME],[[86,0,[[98,1,[[99,2],[100,2,[[106,3,[[114,4]]]]]]],[119,1],[122,1,[[123,2],[153,2],[183,2,[[184,3]]],[193,2,[[194,3]]],[201,2,[[202,3]]]]],[211,1],[213,1,[[214,2]]]]]]);function OffcanvasMainMenu($$anchor,$$props){check_target(new.target);push$1($$props,true,OffcanvasMainMenu);let settings=tag(state$1(null),"settings");let isProUser=tag(state$1(false),"isProUser");let offcanvasElement;let isHoveringMenu=tag(state$1(false),"isHoveringMenu");let hoverTimeout=null;onMount(async()=>{var _a2,_b;set(settings,await getSettings(),true);set(isProUser,shouldShowProFeatures(((_b=(_a2=get$1(settings))==null?void 0:_a2.plan)==null?void 0:_b.type)||PlanType.BASIC_MEMBER),true);if(strict_equals(typeof window,"undefined",false)){setupClickOutsideListener()}});onDestroy(()=>{if(strict_equals(typeof window,"undefined",false)&&strict_equals(typeof document,"undefined",false)){document.removeEventListener("click",handleClickOutside)}if(hoverTimeout){clearTimeout(hoverTimeout)}});function setupClickOutsideListener(){if(strict_equals(typeof document,"undefined",false)){document.addEventListener("click",handleClickOutside)}}function handleClickOutside(event2){if(!offcanvasElement)return;const target=event2.target;const isOffcanvasVisible=offcanvasElement.classList.contains("show");const isClickOutside=!offcanvasElement.contains(target);const isNotTrigger=!target.closest('[data-bs-toggle="offcanvas"][data-bs-target="#offcanvasMainMenu"]');if(isOffcanvasVisible&&isClickOutside&&isNotTrigger){closeOffcanvas()}}function closeOffcanvas(){if(strict_equals(typeof window,"undefined",false)&&window.bootstrap){const offcanvasInstance=window.bootstrap.Offcanvas.getInstance(offcanvasElement);if(offcanvasInstance){offcanvasInstance.hide()}}}function handleMenuMouseEnter(){set(isHoveringMenu,true);if(hoverTimeout){clearTimeout(hoverTimeout);hoverTimeout=null}}function handleMenuMouseLeave(){set(isHoveringMenu,false);hoverTimeout=setTimeout(()=>{closeOffcanvas()},500)}var div=root$e();var ul=sibling(child(div),4);var li=child(ul);var node=child(li);{var consequent=$$anchor2=>{var button=root_1$b();button.__click=[openExportKit,isProUser];append($$anchor2,button)};var alternate=$$anchor2=>{SimpleTooltip($$anchor2,{content:"Upgrade to Pro for full Emergency Kit features",children:wrap_snippet(OffcanvasMainMenu,($$anchor3,$$slotProps)=>{var button_1=root_3$a();append($$anchor3,button_1)}),$$slots:{default:true}})};if_block(node,$$render=>{if(get$1(isProUser))$$render(consequent);else $$render(alternate,false)})}reset(li);var li_1=sibling(li,2);var node_1=child(li_1);{var consequent_1=$$anchor2=>{var button_2=root_4$8();button_2.__click=[openImportKit,isProUser];append($$anchor2,button_2)};var alternate_1=$$anchor2=>{SimpleTooltip($$anchor2,{content:"Upgrade to Pro for full Emergency Kit features",children:wrap_snippet(OffcanvasMainMenu,($$anchor3,$$slotProps)=>{var button_3=root_6$a();append($$anchor3,button_3)}),$$slots:{default:true}})};if_block(node_1,$$render=>{if(get$1(isProUser))$$render(consequent_1);else $$render(alternate_1,false)})}reset(li_1);var li_2=sibling(li_1,4);var button_4=child(li_2);button_4.__click=[handleLogout$1];reset(li_2);var li_3=sibling(li_2,2);var button_5=child(li_3);button_5.__click=[handleLogout$1];reset(li_3);reset(ul);next(4);reset(div);bind_this(div,$$value=>offcanvasElement=$$value,()=>offcanvasElement);template_effect(()=>{set_attribute(li,"data-bs-dismiss",get$1(isProUser)?"offcanvas":"");set_attribute(li_1,"data-bs-dismiss",get$1(isProUser)?"offcanvas":"")});event("mouseenter",div,handleMenuMouseEnter);event("mouseleave",div,handleMenuMouseLeave);append($$anchor,div);return pop({...legacy_api()})}delegate(["click"]);GraduationCapButton[FILENAME]="src/lib/components/icons/GraduationCapButton.svelte";var on_click$a=(_,handleUniversity)=>handleUniversity();var root$d=add_locations(from_html(`<button class="flex items-center justify-center w-10 h-10 rounded-full backdrop-blur-sm bg-white/20 dark:bg-zinc-800/30 hover:bg-white/30 dark:hover:bg-zinc-700/50 transition" aria-label="YAKKL University"><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5 text-white dark:text-purple-400"><path d="M12 2L1 7l11 5 9-4.09V17h2V7L12 2zm-1 14.74l-5-2.27v2l5 2.27 5-2.27v-2l-5 2.27z"></path></svg></button>`),GraduationCapButton[FILENAME],[[9,0,[[14,1,[[20,2]]]]]]);function GraduationCapButton($$anchor,$$props){check_target(new.target);push$1($$props,false,GraduationCapButton);function handleUniversity(){handleOpenInTab("https://yakkl.com/university/support?utm_source=yakkl&utm_medium=extension&utm_campaign=extension&utm_content=university&utm_term=extension")}init$1();var button=root$d();button.__click=[on_click$a,handleUniversity];append($$anchor,button);return pop({...legacy_api()})}delegate(["click"]);Avatar[FILENAME]="src/lib/components/Avatar.svelte";var root_1$a=add_locations(from_html(`<img loading="lazy"/>`),Avatar[FILENAME],[[7,1]]);var root_2$9=add_locations(from_html(`<div role="img"> </div>`),Avatar[FILENAME],[[14,1]]);function Avatar($$anchor,$$props){var _a2,_b;check_target(new.target);push$1($$props,true,Avatar);const initial=((_b=(_a2=$$props.userName)==null?void 0:_a2.charAt(0))==null?void 0:_b.toUpperCase())??"?";const defaultClasses="w-10 h-10 rounded-full ring-2 ring-offset-1 flex items-center justify-center text-sm font-bold uppercase bg-primary-300 text-base-content";var fragment=comment();var node=first_child(fragment);{var consequent=$$anchor2=>{var img=root_1$a();template_effect(()=>{set_attribute(img,"src",$$props.url);set_attribute(img,"alt",$$props.ariaLabel??"User avatar");set_class(img,1,`object-cover ${$$props.className??defaultClasses}`)});append($$anchor2,img)};var alternate=$$anchor2=>{var div=root_2$9();var text2=child(div,true);reset(div);template_effect(()=>{set_class(div,1,clsx($$props.className??defaultClasses));set_attribute(div,"aria-label",$$props.ariaLabel??"User avatar");set_text(text2,initial)});append($$anchor2,div)};if_block(node,$$render=>{if($$props.url)$$render(consequent);else $$render(alternate,false)})}append($$anchor,fragment);return pop({...legacy_api()})}Profile[FILENAME]="src/lib/components/Profile.svelte";function resetForm$1(_,profile,profileData,updateField){var _a2,_b,_c,_d,_e;if(get$1(profile)&&get$1(profileData)){updateField("userName",get$1(profile).userName||"");updateField("firstName",((_a2=get$1(profileData).name)==null?void 0:_a2.first)||"");updateField("lastName",((_b=get$1(profileData).name)==null?void 0:_b.last)||"");updateField("email",get$1(profileData).email||"");updateField("bio",((_c=get$1(profileData))==null?void 0:_c.bio)||"");updateField("website",((_d=get$1(profileData))==null?void 0:_d.website)||"");updateField("avatarUrl",((_e=get$1(profileData))==null?void 0:_e.avatarUrl)||"")}}var root_2$8=add_locations(from_html(`<div class="flex items-center justify-center py-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div> <span class="ml-2 text-gray-600">Loading profile...</span></div>`),Profile[FILENAME],[[256,3,[[257,4],[258,4]]]]);var root_4$7=add_locations(from_html(`<p class="mt-1 text-sm text-red-600"> </p>`),Profile[FILENAME],[[286,7]]);var root_5$9=add_locations(from_html(`<p class="mt-1 text-sm text-red-600"> </p>`),Profile[FILENAME],[[306,7]]);var root_6$9=add_locations(from_html(`<p class="mt-1 text-sm text-red-600"> </p>`),Profile[FILENAME],[[323,7]]);var root_7$8=add_locations(from_html(`<p class="mt-1 text-sm text-red-600"> </p>`),Profile[FILENAME],[[342,7]]);var root_8$6=add_locations(from_html(`<p class="mt-1 text-sm text-red-600"> </p>`),Profile[FILENAME],[[359,7]]);var root_9$6=add_locations(from_html(`<p class="mt-1 text-sm text-red-600"> </p>`),Profile[FILENAME],[[378,6]]);var root_10$4=add_locations(from_html(`<p class="mt-1 text-sm text-red-600"> </p>`),Profile[FILENAME],[[395,6]]);var root_11$5=add_locations(from_html(`<div class="rounded-md bg-red-50 p-4"><p class="text-sm font-medium text-red-800"> </p></div>`),Profile[FILENAME],[[402,5,[[403,6]]]]);var root_12$4=add_locations(from_html(`<div class="rounded-md bg-green-50 p-4"><p class="text-sm font-medium text-green-800"> </p></div>`),Profile[FILENAME],[[408,5,[[409,6]]]]);var root_13$6=add_locations(from_html(`<span class="flex items-center"><div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div> Saving...</span>`),Profile[FILENAME],[[440,8,[[441,9]]]]);var root_15$4=add_locations(from_html(`<div class="text-xs text-gray-500 text-center pt-2 border-t"> </div>`),Profile[FILENAME],[[453,5]]);var root_3$9=add_locations(from_html(`<form class="space-y-6"><div class="flex flex-col items-center space-y-4"><div class="text-center"><!></div> <div class="w-full"><label for="avatarUrl" class="block text-sm font-medium text-gray-700 mb-1">Avatar URL (optional)</label> <input id="avatarUrl" type="url" placeholder="https://example.com/your-avatar.jpg"/> <!></div></div> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="userName" class="block text-sm font-medium text-gray-700 mb-1">Username <span class="text-red-500">*</span></label> <input id="userName" type="text" placeholder="your_username"/> <!></div> <div><label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email <span class="text-red-500">*</span></label> <input id="email" type="email" placeholder="your@email.com"/> <!></div></div> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="firstName" class="block text-sm font-medium text-gray-700 mb-1">First Name <span class="text-red-500">*</span></label> <input id="firstName" type="text" placeholder="John"/> <!></div> <div><label for="lastName" class="block text-sm font-medium text-gray-700 mb-1">Last Name <span class="text-red-500">*</span></label> <input id="lastName" type="text" placeholder="Doe"/> <!></div></div> <div><label for="website" class="block text-sm font-medium text-gray-700 mb-1">Website (optional)</label> <input id="website" type="url" placeholder="https://your-website.com"/> <!></div> <div><label for="bio" class="block text-sm font-medium text-gray-700 mb-1">Bio (optional)</label> <textarea id="bio" rows="3" placeholder="Tell us about yourself..."></textarea> <!> <p class="mt-1 text-sm text-gray-500"> </p></div> <!> <!> <div class="flex justify-between pt-5"><button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Reset</button> <div class="flex space-x-3"><button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Cancel</button> <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"><!></button></div></div> <!></form>`),Profile[FILENAME],[[261,3,[[263,4,[[264,5],[273,5,[[274,6],[277,6]]]]],[292,4,[[293,5,[[294,6,[[295,16]]],[297,6]]],[310,5,[[311,6,[[312,13]]],[314,6]]]]],[328,4,[[329,5,[[330,6,[[331,18]]],[333,6]]],[346,5,[[347,6,[[348,17]]],[350,6]]]]],[365,4,[[366,5],[369,5]]],[382,4,[[383,5],[386,5],[397,5]]],[414,4,[[415,5],[424,5,[[425,6],[434,6]]]]]]]]);var root_1$9=add_locations(from_html(`<div class="space-y-6 p-6"><!></div>`),Profile[FILENAME],[[254,1]]);var root$c=add_locations(from_html(`<!> <!>`,1),Profile[FILENAME],[]);function Profile($$anchor,$$props){check_target(new.target);push$1($$props,true,Profile);var $$ownership_validator=create_ownership_validator($$props);const[$$stores,$$cleanup]=setup_stores();const $isValid=()=>(validate_store(isValid,"isValid"),store_get(isValid,"$isValid",$$stores));const $form=()=>(validate_store(form,"form"),store_get(form,"$form",$$stores));const $yakklMiscStore=()=>(validate_store(yakklMiscStore,"yakklMiscStore"),store_get(yakklMiscStore,"$yakklMiscStore",$$stores));const $errors=()=>(validate_store(errors,"errors"),store_get(errors,"$errors",$$stores));const $touched=()=>(validate_store(touched,"touched"),store_get(touched,"$touched",$$stores));let show=prop($$props,"show",15,false),onClose=prop($$props,"onClose",3,()=>show(false)),onComplete=prop($$props,"onComplete",3,()=>{});let profile=tag(state$1(null),"profile");let profileData=tag(state$1(null),"profileData");let isLoading=tag(state$1(false),"isLoading");let isSaving=tag(state$1(false),"isSaving");let error=tag(state$1(""),"error");let success=tag(state$1(""),"success");let previewAvatarUrl=tag(state$1(""),"previewAvatarUrl");let hasChanges=tag(state$1(false),"hasChanges");let showError=tag(state$1(false),"showError");let errorValue=tag(state$1(""),"errorValue");const validationSchema=create$3().shape({userName:create$6().required("Username is required").min(3,"Username must be at least 3 characters").max(30,"Username must be less than 30 characters").matches(/^[a-zA-Z0-9_-]+$/,"Username can only contain letters, numbers, underscores, and dashes"),firstName:create$6().required("First name is required").min(1,"First name is required").max(50,"First name must be less than 50 characters"),lastName:create$6().required("Last name is required").min(1,"Last name is required").max(50,"Last name must be less than 50 characters"),email:create$6().email("Must be a valid email address").required("Email address is required"),bio:create$6().max(500,"Bio must be less than 500 characters").optional(),website:create$6().url("Must be a valid URL").optional().nullable().transform(value=>strict_equals(value,"")?null:value),avatarUrl:create$6().url("Must be a valid URL").optional().nullable().transform(value=>strict_equals(value,"")?null:value)});const{form:form,errors:errors,isValid:isValid,touched:touched,updateField:updateField}=createForm$1({initialValues:{userName:"",firstName:"",lastName:"",email:"",bio:"",website:"",avatarUrl:""},validationSchema:validationSchema,onSubmit:async values=>{await saveProfile(values)}});async function handleFormSubmit(event2){event2.preventDefault();if(!$isValid()){return}await saveProfile($form())}user_effect(()=>{if(show()){loadProfileData()}});user_effect(()=>{var _a2,_b,_c,_d,_e;if(get$1(profile)&&get$1(profileData)&&!get$1(isLoading)){const currentValues=$form();const originalValues={userName:get$1(profile).userName||"",firstName:((_a2=get$1(profileData).name)==null?void 0:_a2.first)||"",lastName:((_b=get$1(profileData).name)==null?void 0:_b.last)||"",email:get$1(profileData).email||"",bio:((_c=get$1(profileData))==null?void 0:_c.bio)||"",website:((_d=get$1(profileData))==null?void 0:_d.website)||"",avatarUrl:((_e=get$1(profileData))==null?void 0:_e.avatarUrl)||""};set(hasChanges,strict_equals(currentValues.userName,originalValues.userName,false)||strict_equals(currentValues.firstName,originalValues.firstName,false)||strict_equals(currentValues.lastName,originalValues.lastName,false)||strict_equals(currentValues.email,originalValues.email,false)||strict_equals(currentValues.bio,originalValues.bio,false)||strict_equals(currentValues.website,originalValues.website,false)||strict_equals(currentValues.avatarUrl,originalValues.avatarUrl,false),true)}else{set(hasChanges,false)}});user_effect(()=>{var _a2,_b;const avatarUrl=$form().avatarUrl;if(avatarUrl&&strict_equals(avatarUrl.trim(),"",false)){set(previewAvatarUrl,avatarUrl,true)}else{set(previewAvatarUrl,((_a2=get$1(profileData))==null?void 0:_a2.avatarUrl)||identicon(((_b=get$1(profile))==null?void 0:_b.userName)||"default"),true)}});async function loadProfileData(){var _a2,_b,_c,_d,_e;set(isLoading,true);set(error,"");try{set(profile,await getProfile(),true);if(!get$1(profile)){set(error,"Profile not found");return}if(isEncryptedData(get$1(profile).data)){const miscStore=$yakklMiscStore();if(!miscStore){set(error,"Unable to decrypt profile data");return}set(profileData,await decryptData(get$1(profile).data,miscStore),true)}else{set(profileData,get$1(profile).data,true)}updateField("userName",get$1(profile).userName||"");updateField("firstName",((_a2=get$1(profileData).name)==null?void 0:_a2.first)||"");updateField("lastName",((_b=get$1(profileData).name)==null?void 0:_b.last)||"");updateField("email",get$1(profileData).email||"");updateField("bio",((_c=get$1(profileData))==null?void 0:_c.bio)||"");updateField("website",((_d=get$1(profileData))==null?void 0:_d.website)||"");updateField("avatarUrl",((_e=get$1(profileData))==null?void 0:_e.avatarUrl)||"")}catch(e){log$1.error("Error loading profile data:",false,e);set(error,"Failed to load profile data")}finally{set(isLoading,false)}}async function saveProfile(values){if(!get$1(profile)||!get$1(profileData)){set(error,"Profile data not loaded");return}set(isSaving,true);set(error,"");set(success,"");try{log$1.info("[Profile] Starting save with values:",false,values);log$1.info("[Profile] Current state:",false,{profile:!!get$1(profile),profileData:!!get$1(profileData),miscStore:!!$yakklMiscStore()});const miscStore=$yakklMiscStore();if(!miscStore){const errorMsg="Unable to encrypt profile data - missing encryption key";log$1.error("[Profile] "+errorMsg,false);set(error,errorMsg);set(errorValue,errorMsg);set(showError,true);set(isSaving,false);return}const updatedProfileData={...get$1(profileData),name:{id:get$1(profile).id,persona:get$1(profile).persona,first:values.firstName||"",last:values.lastName||""},email:values.email||"",bio:values.bio||"",website:values.website||"",avatarUrl:values.avatarUrl||""};log$1.info("[Profile] Created updated profile data:",false,updatedProfileData);const updatedProfile={...get$1(profile),userName:values.userName,data:updatedProfileData,updateDate:(new Date).toISOString()};log$1.info("[Profile] Created updated profile:",false,{userName:updatedProfile.userName,updateDate:updatedProfile.updateDate});log$1.info("[Profile] Starting encryption...");try{updatedProfile.data=await encryptData(updatedProfileData,miscStore);log$1.info("[Profile] Encryption successful")}catch(encryptError){const errorMsg="Failed to encrypt profile data: "+encryptError.message;log$1.error("[Profile] Encryption failed:",false,encryptError);set(error,errorMsg);set(errorValue,errorMsg);set(showError,true);set(isSaving,false);return}log$1.info("[Profile] Starting storage save...");try{await setProfileStorage(updatedProfile);log$1.info("[Profile] Storage save successful")}catch(saveError){const errorMsg="Failed to save profile to storage: "+saveError.message;log$1.error("[Profile] Storage failed:",false,saveError);set(error,errorMsg);set(errorValue,errorMsg);set(showError,true);set(isSaving,false);return}set(profile,{...updatedProfile,data:updatedProfileData},true);set(profileData,updatedProfileData,true);set(success,"Profile updated successfully!");set(hasChanges,false);log$1.info("[Profile] Profile saved successfully, state updated:",false,{hasChanges:get$1(hasChanges),profile:get$1(profile).userName,profileData:get$1(profileData).name});onComplete()();log$1.info("[Profile] Preparing to close modal after successful save");setTimeout(()=>{show(false);set(isSaving,false)},100)}catch(e){const errorMsg="Failed to save profile changes: "+e.message;log$1.error("[Profile] Unexpected error saving profile:",false,e);set(error,errorMsg);set(errorValue,errorMsg);set(showError,true);set(isSaving,false)}}function handleClose(){if(get$1(hasChanges)){if(confirm("You have unsaved changes. Are you sure you want to close?")){show(false);onClose()()}}else{show(false);onClose()()}}function handleErrorClose(){set(showError,false);set(error,"");set(errorValue,"")}var fragment=root$c();var node=first_child(fragment);{$$ownership_validator.binding("show",Modal,show);Modal(node,{title:"Profile",onClose:handleClose,className:"max-w-2xl",get show(){return show()},set show($$value){show($$value)},children:wrap_snippet(Profile,($$anchor2,$$slotProps)=>{var div=root_1$9();var node_1=child(div);{var consequent=$$anchor3=>{var div_1=root_2$8();append($$anchor3,div_1)};var alternate=$$anchor3=>{var form_1=root_3$9();var div_2=child(form_1);var div_3=child(div_2);var node_2=child(div_3);const expression=user_derived(()=>$form().firstName||$form().userName);Avatar(node_2,{get url(){return get$1(previewAvatarUrl)},get userName(){return get$1(expression)},className:"w-24 h-24 rounded-full ring-4 ring-offset-2 ring-indigo-500",ariaLabel:"Profile Avatar"});reset(div_3);var div_4=sibling(div_3,2);var input=sibling(child(div_4),2);remove_input_defaults(input);let classes;var node_3=sibling(input,2);{var consequent_1=$$anchor4=>{var p=root_4$7();var text2=child(p,true);reset(p);template_effect(()=>set_text(text2,$errors().avatarUrl));append($$anchor4,p)};if_block(node_3,$$render=>{if($errors().avatarUrl&&$touched().avatarUrl)$$render(consequent_1)})}reset(div_4);reset(div_2);var div_5=sibling(div_2,2);var div_6=child(div_5);var input_1=sibling(child(div_6),2);remove_input_defaults(input_1);let classes_1;var node_4=sibling(input_1,2);{var consequent_2=$$anchor4=>{var p_1=root_5$9();var text_1=child(p_1,true);reset(p_1);template_effect(()=>set_text(text_1,$errors().userName));append($$anchor4,p_1)};if_block(node_4,$$render=>{if($errors().userName&&$touched().userName)$$render(consequent_2)})}reset(div_6);var div_7=sibling(div_6,2);var input_2=sibling(child(div_7),2);remove_input_defaults(input_2);let classes_2;var node_5=sibling(input_2,2);{var consequent_3=$$anchor4=>{var p_2=root_6$9();var text_2=child(p_2,true);reset(p_2);template_effect(()=>set_text(text_2,$errors().email));append($$anchor4,p_2)};if_block(node_5,$$render=>{if($errors().email&&$touched().email)$$render(consequent_3)})}reset(div_7);reset(div_5);var div_8=sibling(div_5,2);var div_9=child(div_8);var input_3=sibling(child(div_9),2);remove_input_defaults(input_3);let classes_3;var node_6=sibling(input_3,2);{var consequent_4=$$anchor4=>{var p_3=root_7$8();var text_3=child(p_3,true);reset(p_3);template_effect(()=>set_text(text_3,$errors().firstName));append($$anchor4,p_3)};if_block(node_6,$$render=>{if($errors().firstName&&$touched().firstName)$$render(consequent_4)})}reset(div_9);var div_10=sibling(div_9,2);var input_4=sibling(child(div_10),2);remove_input_defaults(input_4);let classes_4;var node_7=sibling(input_4,2);{var consequent_5=$$anchor4=>{var p_4=root_8$6();var text_4=child(p_4,true);reset(p_4);template_effect(()=>set_text(text_4,$errors().lastName));append($$anchor4,p_4)};if_block(node_7,$$render=>{if($errors().lastName&&$touched().lastName)$$render(consequent_5)})}reset(div_10);reset(div_8);var div_11=sibling(div_8,2);var input_5=sibling(child(div_11),2);remove_input_defaults(input_5);let classes_5;var node_8=sibling(input_5,2);{var consequent_6=$$anchor4=>{var p_5=root_9$6();var text_5=child(p_5,true);reset(p_5);template_effect(()=>set_text(text_5,$errors().website));append($$anchor4,p_5)};if_block(node_8,$$render=>{if($errors().website&&$touched().website)$$render(consequent_6)})}reset(div_11);var div_12=sibling(div_11,2);var textarea=sibling(child(div_12),2);remove_textarea_child(textarea);let classes_6;var node_9=sibling(textarea,2);{var consequent_7=$$anchor4=>{var p_6=root_10$4();var text_6=child(p_6,true);reset(p_6);template_effect(()=>set_text(text_6,$errors().bio));append($$anchor4,p_6)};if_block(node_9,$$render=>{if($errors().bio&&$touched().bio)$$render(consequent_7)})}var p_7=sibling(node_9,2);var text_7=child(p_7);reset(p_7);reset(div_12);var node_10=sibling(div_12,2);{var consequent_8=$$anchor4=>{var div_13=root_11$5();var p_8=child(div_13);var text_8=child(p_8,true);reset(p_8);reset(div_13);template_effect(()=>set_text(text_8,get$1(error)));append($$anchor4,div_13)};if_block(node_10,$$render=>{if(get$1(error))$$render(consequent_8)})}var node_11=sibling(node_10,2);{var consequent_9=$$anchor4=>{var div_14=root_12$4();var p_9=child(div_14);var text_9=child(p_9,true);reset(p_9);reset(div_14);template_effect(()=>set_text(text_9,get$1(success)));append($$anchor4,div_14)};if_block(node_11,$$render=>{if(get$1(success))$$render(consequent_9)})}var div_15=sibling(node_11,2);var button=child(div_15);button.__click=[resetForm$1,profile,profileData,updateField];var div_16=sibling(button,2);var button_1=child(div_16);button_1.__click=handleClose;var button_2=sibling(button_1,2);var node_12=child(button_2);{var consequent_10=$$anchor4=>{var span=root_13$6();append($$anchor4,span)};var alternate_1=$$anchor4=>{var text_10=text("Save Changes");append($$anchor4,text_10)};if_block(node_12,$$render=>{if(get$1(isSaving))$$render(consequent_10);else $$render(alternate_1,false)})}reset(button_2);reset(div_16);reset(div_15);var node_13=sibling(div_15,2);{var consequent_11=$$anchor4=>{var div_17=root_15$4();var text_11=child(div_17);reset(div_17);template_effect($0=>set_text(text_11,`Last updated: ${$0??""}`),[()=>new Date(get$1(profile).updateDate).toLocaleString()]);append($$anchor4,div_17)};if_block(node_13,$$render=>{var _a2;if((_a2=get$1(profile))==null?void 0:_a2.updateDate)$$render(consequent_11)})}reset(form_1);template_effect(($0,$1,$2,$3,$4,$5,$6)=>{classes=set_class(input,1,"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",null,classes,$0);classes_1=set_class(input_1,1,"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",null,classes_1,$1);classes_2=set_class(input_2,1,"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",null,classes_2,$2);classes_3=set_class(input_3,1,"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",null,classes_3,$3);classes_4=set_class(input_4,1,"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",null,classes_4,$4);classes_5=set_class(input_5,1,"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",null,classes_5,$5);classes_6=set_class(textarea,1,"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",null,classes_6,$6);set_text(text_7,`${($form().bio||"").length??""}/500 characters`);button.disabled=!get$1(hasChanges)||get$1(isSaving);button_1.disabled=get$1(isSaving);button_2.disabled=!$isValid()||!get$1(hasChanges)||get$1(isSaving)},[()=>({"border-red-500":$errors().avatarUrl&&$touched().avatarUrl}),()=>({"border-red-500":$errors().userName&&$touched().userName}),()=>({"border-red-500":$errors().email&&$touched().email}),()=>({"border-red-500":$errors().firstName&&$touched().firstName}),()=>({"border-red-500":$errors().lastName&&$touched().lastName}),()=>({"border-red-500":$errors().website&&$touched().website}),()=>({"border-red-500":$errors().bio&&$touched().bio})]);event("submit",form_1,handleFormSubmit);bind_value(input,()=>$form().avatarUrl,$$value=>store_mutate(form,untrack($form).avatarUrl=$$value,untrack($form)));bind_value(input_1,()=>$form().userName,$$value=>store_mutate(form,untrack($form).userName=$$value,untrack($form)));bind_value(input_2,()=>$form().email,$$value=>store_mutate(form,untrack($form).email=$$value,untrack($form)));bind_value(input_3,()=>$form().firstName,$$value=>store_mutate(form,untrack($form).firstName=$$value,untrack($form)));bind_value(input_4,()=>$form().lastName,$$value=>store_mutate(form,untrack($form).lastName=$$value,untrack($form)));bind_value(input_5,()=>$form().website,$$value=>store_mutate(form,untrack($form).website=$$value,untrack($form)));bind_value(textarea,()=>$form().bio,$$value=>store_mutate(form,untrack($form).bio=$$value,untrack($form)));append($$anchor3,form_1)};if_block(node_1,$$render=>{if(get$1(isLoading))$$render(consequent);else $$render(alternate,false)})}reset(div);append($$anchor2,div)}),$$slots:{default:true}})}var node_14=sibling(node,2);ErrorNoAction(node_14,{get value(){return get$1(errorValue)},title:"Profile Save Error",onClose:handleErrorClose,get show(){return get$1(showError)},set show($$value){set(showError,$$value,true)}});append($$anchor,fragment);var $$pop=pop({...legacy_api()});$$cleanup();return $$pop}delegate(["click"]);Settings[FILENAME]="src/lib/components/Settings.svelte";function resetForm(_,settings,profile,updateField){var _a2,_b,_c,_d,_e,_f,_g,_h;if(get$1(settings)&&get$1(profile)){updateField("showTestNetworks",((_a2=get$1(profile).preferences)==null?void 0:_a2.showTestNetworks)??false);updateField("theme",((_b=get$1(profile).preferences)==null?void 0:_b.dark)??SystemTheme.SYSTEM);updateField("locale",((_c=get$1(profile).preferences)==null?void 0:_c.locale)??"en-US");updateField("currency",((_e=(_d=get$1(profile).preferences)==null?void 0:_d.currency)==null?void 0:_e.code)??"USD");updateField("idleDelayInterval",((_f=get$1(profile).preferences)==null?void 0:_f.idleDelayInterval)??300);updateField("idleAutoLock",((_g=get$1(profile).preferences)==null?void 0:_g.idleAutoLock)??true);updateField("idleAutoLockCycle",((_h=get$1(profile).preferences)==null?void 0:_h.idleAutoLockCycle)??180);updateField("showHints",get$1(settings).showHints??true);updateField("trialCountdownPinned",get$1(settings).trialCountdownPinned??false)}}var root_2$7=add_locations(from_html(`<div class="flex items-center justify-center py-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div> <span class="ml-2 text-gray-600">Loading settings...</span></div>`),Settings[FILENAME],[[245,3,[[246,4],[247,4]]]]);var root_4$6=add_locations(from_html(`<div class="bg-gray-50 p-4 rounded-lg"><h3 class="text-lg font-medium text-gray-900 mb-3">Account Information</h3> <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"><div><span class="font-medium text-gray-700">Plan:</span> <span class="ml-2 text-gray-600"> </span></div> <div><span class="font-medium text-gray-700">Member since:</span> <span class="ml-2 text-gray-600"> </span></div> <div><span class="font-medium text-gray-700">Profile ID:</span> <span class="ml-2 text-gray-600 font-mono text-xs"> </span></div> <div><span class="font-medium text-gray-700">Version:</span> <span class="ml-2 text-gray-600"> </span></div></div></div>`),Settings[FILENAME],[[253,5,[[254,6],[255,6,[[256,7,[[257,8],[258,8]]],[260,7,[[261,8],[262,8]]],[264,7,[[265,8],[266,8]]],[268,7,[[269,8],[270,8]]]]]]]]);var root_5$8=add_locations(from_html(`<option> </option>`),Settings[FILENAME],[[290,9]]);var root_6$8=add_locations(from_html(`<option> </option>`),Settings[FILENAME],[[336,9]]);var root_7$7=add_locations(from_html(`<p class="mt-1 text-sm text-red-600"> </p>`),Settings[FILENAME],[[340,8]]);var root_8$5=add_locations(from_html(`<option> </option>`),Settings[FILENAME],[[355,9]]);var root_9$5=add_locations(from_html(`<p class="mt-1 text-sm text-red-600"> </p>`),Settings[FILENAME],[[359,8]]);var root_10$3=add_locations(from_html(`<option> </option>`),Settings[FILENAME],[[379,9]]);var root_12$3=add_locations(from_html(`<p class="mt-1 text-sm text-red-600"> </p>`),Settings[FILENAME],[[415,9]]);var root_11$4=add_locations(from_html(`<div><label for="idleAutoLockCycle" class="block text-sm font-medium text-gray-700 mb-1">Auto-lock cycle (seconds)</label> <input id="idleAutoLockCycle" type="number" min="60" max="3600" step="60"/> <!> <p class="mt-1 text-sm text-gray-500">How often to check for idle activity (minimum 60 seconds)</p></div>`),Settings[FILENAME],[[400,7,[[401,8],[404,8],[417,8]]]]);var root_13$5=add_locations(from_html(`<div><h3 class="text-lg font-medium text-gray-900 mb-4">Trial Settings</h3> <div class="flex items-center"><input id="trialCountdownPinned" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"/> <label for="trialCountdownPinned" class="ml-2 block text-sm text-gray-900">Pin trial countdown to top of interface</label></div></div>`),Settings[FILENAME],[[427,5,[[428,6],[429,6,[[430,7],[436,7]]]]]]);var root_14$5=add_locations(from_html(`<div class="rounded-md bg-red-50 p-4"><p class="text-sm font-medium text-red-800"> </p></div>`),Settings[FILENAME],[[445,5,[[446,6]]]]);var root_15$3=add_locations(from_html(`<div class="rounded-md bg-green-50 p-4"><p class="text-sm font-medium text-green-800"> </p></div>`),Settings[FILENAME],[[451,5,[[452,6]]]]);var root_16$3=add_locations(from_html(`<span class="flex items-center"><div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div> Saving...</span>`),Settings[FILENAME],[[483,8,[[484,9]]]]);var root_18$2=add_locations(from_html(`<div class="text-xs text-gray-500 text-center pt-2 border-t"> </div>`),Settings[FILENAME],[[496,5]]);var root_3$8=add_locations(from_html(`<form class="space-y-6"><!> <div><h3 class="text-lg font-medium text-gray-900 mb-4">Display & Theme</h3> <div class="space-y-4"><div><label for="theme" class="block text-sm font-medium text-gray-700 mb-1">Theme</label> <select id="theme" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></select></div> <div class="flex items-center"><input id="showTestNetworks" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"/> <label for="showTestNetworks" class="ml-2 block text-sm text-gray-900">Show test networks</label></div> <div class="flex items-center"><input id="showHints" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"/> <label for="showHints" class="ml-2 block text-sm text-gray-900">Show helpful hints and tips</label></div></div></div> <div><h3 class="text-lg font-medium text-gray-900 mb-4">Localization</h3> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="locale" class="block text-sm font-medium text-gray-700 mb-1">Language <span class="text-red-500">*</span></label> <select id="locale"></select> <!></div> <div><label for="currency" class="block text-sm font-medium text-gray-700 mb-1">Currency <span class="text-red-500">*</span></label> <select id="currency"></select> <!></div></div></div> <div><h3 class="text-lg font-medium text-gray-900 mb-4">Security & Privacy</h3> <div class="space-y-4"><div><label for="idleDelayInterval" class="block text-sm font-medium text-gray-700 mb-1">Auto-lock after idle time</label> <select id="idleDelayInterval" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></select> <p class="mt-1 text-sm text-gray-500">Automatically lock the wallet after the specified time of inactivity</p></div> <div class="flex items-center"><input id="idleAutoLock" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"/> <label for="idleAutoLock" class="ml-2 block text-sm text-gray-900">Enable automatic idle lock</label></div> <!></div></div> <!> <!> <!> <div class="flex justify-between pt-5"><button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Reset</button> <div class="flex space-x-3"><button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Cancel</button> <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"><!></button></div></div> <!></form>`),Settings[FILENAME],[[250,3,[[277,4,[[278,5],[279,5,[[280,6,[[281,7],[284,7]]],[295,6,[[296,7],[302,7]]],[307,6,[[308,7],[314,7]]]]]]],[322,4,[[323,5],[324,5,[[325,6,[[326,7,[[327,17]]],[329,7]]],[344,6,[[345,7,[[346,17]]],[348,7]]]]]]],[366,4,[[367,5],[368,5,[[369,6,[[370,7],[373,7],[382,7]]],[387,6,[[388,7],[394,7]]]]]]],[457,4,[[458,5],[467,5,[[468,6],[477,6]]]]]]]]);var root_1$8=add_locations(from_html(`<div class="space-y-6 p-6"><!></div>`),Settings[FILENAME],[[243,1]]);function Settings($$anchor,$$props){check_target(new.target);push$1($$props,true,Settings);var $$ownership_validator=create_ownership_validator($$props);const[$$stores,$$cleanup]=setup_stores();const $isValid=()=>(validate_store(isValid,"isValid"),store_get(isValid,"$isValid",$$stores));const $form=()=>(validate_store(form,"form"),store_get(form,"$form",$$stores));const $errors=()=>(validate_store(errors,"errors"),store_get(errors,"$errors",$$stores));const $touched=()=>(validate_store(touched,"touched"),store_get(touched,"$touched",$$stores));let show=prop($$props,"show",15,false),onClose=prop($$props,"onClose",3,()=>show(false)),onComplete=prop($$props,"onComplete",3,()=>{});let settings=tag(state$1(null),"settings");let profile=tag(state$1(null),"profile");let isLoading=tag(state$1(false),"isLoading");let isSaving=tag(state$1(false),"isSaving");let error=tag(state$1(""),"error");let success=tag(state$1(""),"success");let hasChanges=tag(state$1(false),"hasChanges");const themeOptions=[{value:SystemTheme.SYSTEM,label:"System"},{value:SystemTheme.LIGHT,label:"Light"},{value:SystemTheme.DARK,label:"Dark"}];const currencyOptions=[{value:"USD",label:"US Dollar (USD)"},{value:"EUR",label:"Euro (EUR)"},{value:"GBP",label:"British Pound (GBP)"},{value:"JPY",label:"Japanese Yen (JPY)"},{value:"CAD",label:"Canadian Dollar (CAD)"},{value:"AUD",label:"Australian Dollar (AUD)"},{value:"CHF",label:"Swiss Franc (CHF)"},{value:"CNY",label:"Chinese Yuan (CNY)"}];const localeOptions=[{value:"en-US",label:"English (US)"},{value:"en-GB",label:"English (UK)"},{value:"es-ES",label:"Spanish"},{value:"fr-FR",label:"French"},{value:"de-DE",label:"German"},{value:"it-IT",label:"Italian"},{value:"pt-PT",label:"Portuguese"},{value:"ja-JP",label:"Japanese"},{value:"ko-KR",label:"Korean"},{value:"zh-CN",label:"Chinese (Simplified)"},{value:"zh-TW",label:"Chinese (Traditional)"}];const idleDelayOptions=[{value:60,label:"1 minute"},{value:300,label:"5 minutes"},{value:600,label:"10 minutes"},{value:900,label:"15 minutes"},{value:1800,label:"30 minutes"},{value:3600,label:"1 hour"},{value:0,label:"Never"}];const validationSchema=create$3().shape({showTestNetworks:create$7(),theme:create$6().oneOf(Object.values(SystemTheme)),locale:create$6().required("Locale is required"),currency:create$6().required("Currency is required"),idleDelayInterval:create$5().min(0,"Idle delay must be 0 or positive"),idleAutoLock:create$7(),idleAutoLockCycle:create$5().min(60,"Auto-lock cycle must be at least 1 minute"),showHints:create$7(),trialCountdownPinned:create$7()});const{form:form,errors:errors,isValid:isValid,touched:touched,updateField:updateField}=createForm$1({initialValues:{showTestNetworks:false,theme:SystemTheme.SYSTEM,locale:"en-US",currency:"USD",idleDelayInterval:300,idleAutoLock:true,idleAutoLockCycle:180,showHints:true,trialCountdownPinned:false},validationSchema:validationSchema,onSubmit:async values=>{await saveSettings(values)}});async function handleFormSubmit(event2){event2.preventDefault();if(!$isValid()){return}await saveSettings($form())}user_effect(()=>{if(show()){loadSettingsData()}});user_effect(()=>{var _a2,_b,_c,_d,_e,_f,_g,_h;if(get$1(settings)&&get$1(profile)&&!get$1(isLoading)){const currentValues=$form();const originalValues={showTestNetworks:((_a2=get$1(profile).preferences)==null?void 0:_a2.showTestNetworks)??false,theme:((_b=get$1(profile).preferences)==null?void 0:_b.dark)??SystemTheme.SYSTEM,locale:((_c=get$1(profile).preferences)==null?void 0:_c.locale)??"en-US",currency:((_e=(_d=get$1(profile).preferences)==null?void 0:_d.currency)==null?void 0:_e.code)??"USD",idleDelayInterval:((_f=get$1(profile).preferences)==null?void 0:_f.idleDelayInterval)??300,idleAutoLock:((_g=get$1(profile).preferences)==null?void 0:_g.idleAutoLock)??true,idleAutoLockCycle:((_h=get$1(profile).preferences)==null?void 0:_h.idleAutoLockCycle)??180,showHints:get$1(settings).showHints??true,trialCountdownPinned:get$1(settings).trialCountdownPinned??false};set(hasChanges,strict_equals(currentValues.showTestNetworks,originalValues.showTestNetworks,false)||strict_equals(currentValues.theme,originalValues.theme,false)||strict_equals(currentValues.locale,originalValues.locale,false)||strict_equals(currentValues.currency,originalValues.currency,false)||strict_equals(currentValues.idleDelayInterval,originalValues.idleDelayInterval,false)||strict_equals(currentValues.idleAutoLock,originalValues.idleAutoLock,false)||strict_equals(currentValues.idleAutoLockCycle,originalValues.idleAutoLockCycle,false)||strict_equals(currentValues.showHints,originalValues.showHints,false)||strict_equals(currentValues.trialCountdownPinned,originalValues.trialCountdownPinned,false),true)}else{set(hasChanges,false)}});async function loadSettingsData(){var _a2,_b,_c,_d,_e,_f,_g,_h;set(isLoading,true);set(error,"");try{await(async $$value=>{var $$array=to_array($$value,2);set(settings,$$array[0],true);set(profile,$$array[1],true)})(await Promise.all([getSettings(),getProfile()]));if(!get$1(settings)){set(error,"Settings not found");return}if(!get$1(profile)){set(error,"Profile not found");return}updateField("showTestNetworks",((_a2=get$1(profile).preferences)==null?void 0:_a2.showTestNetworks)??false);updateField("theme",((_b=get$1(profile).preferences)==null?void 0:_b.dark)??SystemTheme.SYSTEM);updateField("locale",((_c=get$1(profile).preferences)==null?void 0:_c.locale)??"en-US");updateField("currency",((_e=(_d=get$1(profile).preferences)==null?void 0:_d.currency)==null?void 0:_e.code)??"USD");updateField("idleDelayInterval",((_f=get$1(profile).preferences)==null?void 0:_f.idleDelayInterval)??300);updateField("idleAutoLock",((_g=get$1(profile).preferences)==null?void 0:_g.idleAutoLock)??true);updateField("idleAutoLockCycle",((_h=get$1(profile).preferences)==null?void 0:_h.idleAutoLockCycle)??180);updateField("showHints",get$1(settings).showHints??true);updateField("trialCountdownPinned",get$1(settings).trialCountdownPinned??false)}catch(e){log.error("Error loading settings data:",false,e);set(error,"Failed to load settings data")}finally{set(isLoading,false)}}async function saveSettings(values){if(!get$1(settings)||!get$1(profile)){set(error,"Settings data not loaded");return}set(isSaving,true);set(error,"");set(success,"");try{const updatedSettings={...get$1(settings),showHints:values.showHints,trialCountdownPinned:values.trialCountdownPinned,updateDate:(new Date).toISOString()};const updatedProfile={...get$1(profile),preferences:{...get$1(profile).preferences,showTestNetworks:values.showTestNetworks,dark:values.theme,locale:values.locale,currency:{...get$1(profile).preferences.currency,code:values.currency},idleDelayInterval:values.idleDelayInterval,idleAutoLock:values.idleAutoLock,idleAutoLockCycle:values.idleAutoLockCycle,updateDate:(new Date).toISOString()},updateDate:(new Date).toISOString()};await Promise.all([setSettings(updatedSettings),setProfileStorage(updatedProfile)]);set(settings,updatedSettings,true);set(profile,updatedProfile,true);set(success,"Settings updated successfully!");set(hasChanges,false);onComplete()();onComplete()();setTimeout(()=>{show(false);set(isSaving,false)},100)}catch(e){const errorMsg="Failed to save settings changes: "+e.message;log.error("Error saving settings:",false,e);set(error,errorMsg);set(isSaving,false)}}function handleClose(){if(get$1(hasChanges)){if(confirm("You have unsaved changes. Are you sure you want to close?")){show(false);onClose()()}}else{show(false);onClose()()}}function getPlanLabel(planType){switch(planType){case PlanType.BASIC_MEMBER:return"Basic Member";case PlanType.YAKKL_PRO:return"YAKKL Pro";case PlanType.YAKKL_PREMIUM:return"YAKKL Premium";default:return"Unknown"}}{$$ownership_validator.binding("show",Modal,show);Modal($$anchor,{title:"Account Settings",onClose:handleClose,className:"max-w-2xl",get show(){return show()},set show($$value){show($$value)},children:wrap_snippet(Settings,($$anchor2,$$slotProps)=>{var div=root_1$8();var node=child(div);{var consequent=$$anchor3=>{var div_1=root_2$7();append($$anchor3,div_1)};var alternate=$$anchor3=>{var form_1=root_3$8();var node_1=child(form_1);{var consequent_1=$$anchor4=>{var div_2=root_4$6();var div_3=sibling(child(div_2),2);var div_4=child(div_3);var span=sibling(child(div_4),2);var text2=child(span,true);reset(span);reset(div_4);var div_5=sibling(div_4,2);var span_1=sibling(child(div_5),2);var text_1=child(span_1,true);reset(span_1);reset(div_5);var div_6=sibling(div_5,2);var span_2=sibling(child(div_6),2);var text_2=child(span_2);reset(span_2);reset(div_6);var div_7=sibling(div_6,2);var span_3=sibling(child(div_7),2);var text_3=child(span_3,true);reset(span_3);reset(div_7);reset(div_3);reset(div_2);template_effect(($0,$1,$2)=>{set_text(text2,$0);set_text(text_1,$1);set_text(text_2,`${$2??""}...`);set_text(text_3,get$1(settings).version)},[()=>getPlanLabel(get$1(settings).plan.type),()=>new Date(get$1(settings).createDate).toLocaleDateString(),()=>get$1(settings).id.substring(0,8)]);append($$anchor4,div_2)};if_block(node_1,$$render=>{if(get$1(settings)&&get$1(profile))$$render(consequent_1)})}var div_8=sibling(node_1,2);var div_9=sibling(child(div_8),2);var div_10=child(div_9);var select=sibling(child(div_10),2);each(select,21,()=>themeOptions,index,($$anchor4,option)=>{var option_1=root_5$8();var option_1_value={};var text_4=child(option_1,true);reset(option_1);template_effect(()=>{if(option_1_value!==(option_1_value=get$1(option).value)){option_1.value=(option_1.__value=get$1(option).value)??""}set_text(text_4,get$1(option).label)});append($$anchor4,option_1)});reset(select);reset(div_10);var div_11=sibling(div_10,2);var input=child(div_11);remove_input_defaults(input);next(2);reset(div_11);var div_12=sibling(div_11,2);var input_1=child(div_12);remove_input_defaults(input_1);next(2);reset(div_12);reset(div_9);reset(div_8);var div_13=sibling(div_8,2);var div_14=sibling(child(div_13),2);var div_15=child(div_14);var select_1=sibling(child(div_15),2);let classes;each(select_1,21,()=>localeOptions,index,($$anchor4,option)=>{var option_2=root_6$8();var option_2_value={};var text_5=child(option_2,true);reset(option_2);template_effect(()=>{if(option_2_value!==(option_2_value=get$1(option).value)){option_2.value=(option_2.__value=get$1(option).value)??""}set_text(text_5,get$1(option).label)});append($$anchor4,option_2)});reset(select_1);var node_2=sibling(select_1,2);{var consequent_2=$$anchor4=>{var p=root_7$7();var text_6=child(p,true);reset(p);template_effect(()=>set_text(text_6,$errors().locale));append($$anchor4,p)};if_block(node_2,$$render=>{if($errors().locale&&$touched().locale)$$render(consequent_2)})}reset(div_15);var div_16=sibling(div_15,2);var select_2=sibling(child(div_16),2);let classes_1;each(select_2,21,()=>currencyOptions,index,($$anchor4,option)=>{var option_3=root_8$5();var option_3_value={};var text_7=child(option_3,true);reset(option_3);template_effect(()=>{if(option_3_value!==(option_3_value=get$1(option).value)){option_3.value=(option_3.__value=get$1(option).value)??""}set_text(text_7,get$1(option).label)});append($$anchor4,option_3)});reset(select_2);var node_3=sibling(select_2,2);{var consequent_3=$$anchor4=>{var p_1=root_9$5();var text_8=child(p_1,true);reset(p_1);template_effect(()=>set_text(text_8,$errors().currency));append($$anchor4,p_1)};if_block(node_3,$$render=>{if($errors().currency&&$touched().currency)$$render(consequent_3)})}reset(div_16);reset(div_14);reset(div_13);var div_17=sibling(div_13,2);var div_18=sibling(child(div_17),2);var div_19=child(div_18);var select_3=sibling(child(div_19),2);each(select_3,21,()=>idleDelayOptions,index,($$anchor4,option)=>{var option_4=root_10$3();var option_4_value={};var text_9=child(option_4,true);reset(option_4);template_effect(()=>{if(option_4_value!==(option_4_value=get$1(option).value)){option_4.value=(option_4.__value=get$1(option).value)??""}set_text(text_9,get$1(option).label)});append($$anchor4,option_4)});reset(select_3);next(2);reset(div_19);var div_20=sibling(div_19,2);var input_2=child(div_20);remove_input_defaults(input_2);next(2);reset(div_20);var node_4=sibling(div_20,2);{var consequent_5=$$anchor4=>{var div_21=root_11$4();var input_3=sibling(child(div_21),2);remove_input_defaults(input_3);let classes_2;var node_5=sibling(input_3,2);{var consequent_4=$$anchor5=>{var p_2=root_12$3();var text_10=child(p_2,true);reset(p_2);template_effect(()=>set_text(text_10,$errors().idleAutoLockCycle));append($$anchor5,p_2)};if_block(node_5,$$render=>{if($errors().idleAutoLockCycle&&$touched().idleAutoLockCycle)$$render(consequent_4)})}next(2);reset(div_21);template_effect($0=>classes_2=set_class(input_3,1,"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",null,classes_2,$0),[()=>({"border-red-500":$errors().idleAutoLockCycle&&$touched().idleAutoLockCycle})]);bind_value(input_3,()=>$form().idleAutoLockCycle,$$value=>store_mutate(form,untrack($form).idleAutoLockCycle=$$value,untrack($form)));append($$anchor4,div_21)};if_block(node_4,$$render=>{if($form().idleAutoLock)$$render(consequent_5)})}reset(div_18);reset(div_17);var node_6=sibling(div_17,2);{var consequent_6=$$anchor4=>{var div_22=root_13$5();var div_23=sibling(child(div_22),2);var input_4=child(div_23);remove_input_defaults(input_4);next(2);reset(div_23);reset(div_22);bind_checked(input_4,()=>$form().trialCountdownPinned,$$value=>store_mutate(form,untrack($form).trialCountdownPinned=$$value,untrack($form)));append($$anchor4,div_22)};if_block(node_6,$$render=>{var _a2,_b;if((_b=(_a2=get$1(settings))==null?void 0:_a2.plan)==null?void 0:_b.trialEndDate)$$render(consequent_6)})}var node_7=sibling(node_6,2);{var consequent_7=$$anchor4=>{var div_24=root_14$5();var p_3=child(div_24);var text_11=child(p_3,true);reset(p_3);reset(div_24);template_effect(()=>set_text(text_11,get$1(error)));append($$anchor4,div_24)};if_block(node_7,$$render=>{if(get$1(error))$$render(consequent_7)})}var node_8=sibling(node_7,2);{var consequent_8=$$anchor4=>{var div_25=root_15$3();var p_4=child(div_25);var text_12=child(p_4,true);reset(p_4);reset(div_25);template_effect(()=>set_text(text_12,get$1(success)));append($$anchor4,div_25)};if_block(node_8,$$render=>{if(get$1(success))$$render(consequent_8)})}var div_26=sibling(node_8,2);var button=child(div_26);button.__click=[resetForm,settings,profile,updateField];var div_27=sibling(button,2);var button_1=child(div_27);button_1.__click=handleClose;var button_2=sibling(button_1,2);var node_9=child(button_2);{var consequent_9=$$anchor4=>{var span_4=root_16$3();append($$anchor4,span_4)};var alternate_1=$$anchor4=>{var text_13=text("Save Changes");append($$anchor4,text_13)};if_block(node_9,$$render=>{if(get$1(isSaving))$$render(consequent_9);else $$render(alternate_1,false)})}reset(button_2);reset(div_27);reset(div_26);var node_10=sibling(div_26,2);{var consequent_10=$$anchor4=>{var div_28=root_18$2();var text_14=child(div_28);reset(div_28);template_effect($0=>set_text(text_14,`Last updated: ${$0??""}`),[()=>new Date(get$1(settings).updateDate).toLocaleString()]);append($$anchor4,div_28)};if_block(node_10,$$render=>{var _a2;if((_a2=get$1(settings))==null?void 0:_a2.updateDate)$$render(consequent_10)})}reset(form_1);template_effect(($0,$1)=>{classes=set_class(select_1,1,"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",null,classes,$0);classes_1=set_class(select_2,1,"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",null,classes_1,$1);button.disabled=!get$1(hasChanges)||get$1(isSaving);button_1.disabled=get$1(isSaving);button_2.disabled=!$isValid()||!get$1(hasChanges)||get$1(isSaving)},[()=>({"border-red-500":$errors().locale&&$touched().locale}),()=>({"border-red-500":$errors().currency&&$touched().currency})]);event("submit",form_1,handleFormSubmit);bind_select_value(select,()=>$form().theme,$$value=>store_mutate(form,untrack($form).theme=$$value,untrack($form)));bind_checked(input,()=>$form().showTestNetworks,$$value=>store_mutate(form,untrack($form).showTestNetworks=$$value,untrack($form)));bind_checked(input_1,()=>$form().showHints,$$value=>store_mutate(form,untrack($form).showHints=$$value,untrack($form)));bind_select_value(select_1,()=>$form().locale,$$value=>store_mutate(form,untrack($form).locale=$$value,untrack($form)));bind_select_value(select_2,()=>$form().currency,$$value=>store_mutate(form,untrack($form).currency=$$value,untrack($form)));bind_select_value(select_3,()=>$form().idleDelayInterval,$$value=>store_mutate(form,untrack($form).idleDelayInterval=$$value,untrack($form)));bind_checked(input_2,()=>$form().idleAutoLock,$$value=>store_mutate(form,untrack($form).idleAutoLock=$$value,untrack($form)));append($$anchor3,form_1)};if_block(node,$$render=>{if(get$1(isLoading))$$render(consequent);else $$render(alternate,false)})}reset(div);append($$anchor2,div)}),$$slots:{default:true}})}var $$pop=pop({...legacy_api()});$$cleanup();return $$pop}delegate(["click"]);Watcher[FILENAME]="src/lib/components/Watcher.svelte";async function addWatchAccount(__1,newAccountForm,error,watchAccounts){try{if(!get$1(newAccountForm).address||!get$1(newAccountForm).alias){set(error,"Address and alias are required");return}const newAccount={id:Date.now().toString(),...get$1(newAccountForm),tags:get$1(newAccountForm).tags.filter(tag2=>tag2.trim()),balance:0,portfolioValue:0,lastActivity:new Date,socialScore:0,isActive:true,createdAt:new Date};set(watchAccounts,[...get$1(watchAccounts),newAccount],true);set(newAccountForm,{address:"",alias:"",blockchain:"ethereum",accountType:"personal",category:"",tags:[],notifications:{largeTransactions:true,balanceChanges:false,socialActivity:false}},true);log.info("Added new watch account:",false,newAccount)}catch(err){set(error,"Failed to add watch account");log.error("Error adding watch account:",false,err)}}function handleComplete(__2,$$props,handleClose){var _a2;(_a2=$$props.onComplete)==null?void 0:_a2.call($$props);handleClose()}var on_click$9=(__3,activeTab)=>set(activeTab,"accounts");var on_click_1$2=(__4,activeTab)=>set(activeTab,"analytics");var on_click_2$2=(__5,activeTab)=>set(activeTab,"social");var on_click_3$1=(__6,activeTab)=>set(activeTab,"alerts");var on_click_4$1=(__7,error)=>set(error,"");var root_3$7=add_locations(from_html(`<div class="mb-4 p-3 bg-red-50 border border-red-200 rounded-md"><p class="text-red-700 text-sm"> </p> <button class="text-red-600 hover:text-red-800 text-xs underline mt-1">Dismiss</button></div>`),Watcher[FILENAME],[[256,6,[[257,7],[258,7]]]]);var root_5$7=add_locations(from_html(`<option> </option>`),Watcher[FILENAME],[[307,12]]);var root_6$7=add_locations(from_html(`<option> </option>`),Watcher[FILENAME],[[319,12]]);var root_8$4=add_locations(from_html(`<span class="inline-flex items-center gap-1 px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-xs"> <button class="text-indigo-500 hover:text-indigo-700">√ó</button></span>`),Watcher[FILENAME],[[349,11,[[351,12]]]]);var root_7$6=add_locations(from_html(`<div class="mt-2 flex flex-wrap gap-1"></div>`),Watcher[FILENAME],[[347,9]]);var root_9$4=add_locations(from_html(`<div class="flex justify-center py-8"><div class="animate-spin rounded-full h-8 w-8 border-2 border-indigo-500 border-t-transparent"></div></div>`),Watcher[FILENAME],[[361,9,[[362,10]]]]);var root_11$3=add_locations(from_html(`<div class="text-center py-8 text-gray-500"><p>No watch accounts added yet</p> <p class="text-sm">Add accounts above to start tracking portfolios and social activity</p></div>`),Watcher[FILENAME],[[365,9,[[366,10],[367,10]]]]);var root_14$4=add_locations(from_html(`<span class="px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-xs"> </span>`),Watcher[FILENAME],[[382,16]]);var root_15$2=add_locations(from_html(`<div class="font-semibold text-gray-900"> </div>`),Watcher[FILENAME],[[389,14]]);var root_16$2=add_locations(from_html(`<div class="text-sm text-gray-500"> </div>`),Watcher[FILENAME],[[392,14]]);var on_click_5=(__8,selectAccount,account)=>selectAccount(get$1(account));var root_17$2=add_locations(from_html(`<button class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded text-xs hover:bg-indigo-200">Analyze</button>`),Watcher[FILENAME],[[396,15]]);var on_click_6=(__9,removeWatchAccount,account)=>removeWatchAccount(get$1(account).id);var root_18$1=add_locations(from_html(`<button class="px-3 py-1 bg-red-100 text-red-700 rounded text-xs hover:bg-red-200">Remove</button>`),Watcher[FILENAME],[[404,15]]);var root_13$4=add_locations(from_html(`<div class="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow"><div class="flex items-center justify-between"><div class="flex items-center gap-3"><div class="text-2xl"> </div> <div><div class="font-medium text-gray-900"> </div> <div class="text-sm text-gray-500 font-mono"> </div> <div class="flex items-center gap-2 mt-1"><span class="px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs"> </span> <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs"> </span> <!></div></div></div> <div class="text-right"><!> <!> <div class="flex gap-2 mt-2"><!> <!></div></div></div></div>`),Watcher[FILENAME],[[371,10,[[372,11,[[373,12,[[374,13],[375,13,[[376,14],[377,14],[378,14,[[379,15],[380,15]]]]]]],[387,12,[[394,13]]]]]]]]);var root_4$5=add_locations(from_html(`<div class="space-y-6"><div class="flex items-center justify-between"><h3 class="text-lg font-semibold text-gray-900">Watch Accounts</h3> <span class="text-sm text-gray-500"> </span></div> <div class="bg-gray-50 p-4 rounded-lg"><h4 class="font-medium text-gray-900 mb-3">Add New Watch Account</h4> <div class="grid grid-cols-2 gap-4"><div><label for="watcher-address" class="block text-sm font-medium text-gray-700 mb-1">Address</label> <input id="watcher-address" type="text" placeholder="0x... or wallet address" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"/></div> <div><label for="watcher-alias" class="block text-sm font-medium text-gray-700 mb-1">Alias</label> <input id="watcher-alias" type="text" placeholder="Display name" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"/></div> <div><label for="watcher-blockchain" class="block text-sm font-medium text-gray-700 mb-1">Blockchain</label> <select id="watcher-blockchain" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"></select></div> <div><label for="watcher-account-type" class="block text-sm font-medium text-gray-700 mb-1">Account Type</label> <select id="watcher-account-type" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"></select></div></div> <div class="mt-4 flex gap-2"><input id="watcher-tags" type="text" placeholder="Add tags (press Enter)" aria-label="Add tags for the watch account" class="flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"/> <button class="px-4 py-2 bg-indigo-600 text-white rounded-md text-sm hover:bg-indigo-700 transition-colors">Add Account</button></div> <!></div> <div class="space-y-3"><!></div></div>`),Watcher[FILENAME],[[269,6,[[270,7,[[271,8],[272,8]]],[276,7,[[277,8],[278,8,[[279,9,[[280,10],[281,10]]],[289,9,[[290,10],[291,10]]],[299,9,[[300,10],[301,10]]],[311,9,[[312,10],[313,10]]]]],[324,8,[[325,9],[339,9]]]]],[359,7]]]]);var on_click_7=(__10,activeTab)=>set(activeTab,"accounts");var root_20$4=add_locations(from_html(`<div class="space-y-6"><div class="flex items-center gap-3"><button class="text-indigo-600 hover:text-indigo-800">‚Üê Back</button> <h3 class="text-lg font-semibold text-gray-900"> </h3></div> <div class="grid grid-cols-3 gap-4"><div class="bg-gradient-to-r from-blue-500 to-blue-600 p-4 rounded-lg text-white"><div class="text-sm opacity-90">Portfolio Value</div> <div class="text-2xl font-bold"> </div></div> <div class="bg-gradient-to-r from-green-500 to-green-600 p-4 rounded-lg text-white"><div class="text-sm opacity-90">Social Score</div> <div class="text-2xl font-bold"> </div></div> <div class="bg-gradient-to-r from-purple-500 to-purple-600 p-4 rounded-lg text-white"><div class="text-sm opacity-90">Account Type</div> <div class="text-lg font-semibold"> </div></div></div> <div class="text-center py-12 text-gray-500"><p>üìä Advanced portfolio analytics coming soon</p> <p class="text-sm">Balance trends, transaction analysis, and performance metrics</p></div></div>`),Watcher[FILENAME],[[422,6,[[423,7,[[424,8],[430,8]]],[433,7,[[434,8,[[435,9],[436,9]]],[438,8,[[439,9],[440,9]]],[442,8,[[443,9],[444,9]]]]],[448,7,[[449,8],[450,8]]]]]]);var on_click_8=(__11,activeTab)=>set(activeTab,"accounts");var root_24$1=add_locations(from_html(`<div class="flex items-center justify-between p-2 bg-gray-50 rounded"><div class="flex items-center gap-2"><span class="text-lg"> </span> <div><div class="font-medium text-sm"> </div> <div class="text-xs text-gray-500"> </div></div></div> <span class="px-2 py-1 bg-orange-100 text-orange-700 rounded text-xs"> </span></div>`),Watcher[FILENAME],[[509,13,[[510,14,[[511,15],[512,15,[[513,16],[514,16]]]]],[517,14]]]]);var root_23$3=add_locations(from_html(`<div class="grid grid-cols-2 gap-6"><div class="space-y-4"><div class="bg-white border border-gray-200 rounded-lg p-4"><h4 class="font-medium text-gray-900 mb-3">Influence Metrics</h4> <div class="space-y-2"><div class="flex justify-between"><span class="text-sm text-gray-600">Copy Traders</span> <span class="font-medium"> </span></div> <div class="flex justify-between"><span class="text-sm text-gray-600">Portfolio Mirrors</span> <span class="font-medium"> </span></div> <div class="flex justify-between"><span class="text-sm text-gray-600">Social Mentions</span> <span class="font-medium"> </span></div></div></div> <div class="bg-white border border-gray-200 rounded-lg p-4"><h4 class="font-medium text-gray-900 mb-3">Trading Activity</h4> <div class="flex items-center gap-2"><span> </span> <span class="text-sm text-gray-600">activity level</span></div> <div class="mt-2"><span class="text-sm text-gray-600">Reputation Score:</span> <span class="font-medium"> </span></div></div></div> <div class="space-y-4"><div class="bg-white border border-gray-200 rounded-lg p-4"><h4 class="font-medium text-gray-900 mb-3">Recent Activity</h4> <div class="space-y-3"></div></div></div></div>`),Watcher[FILENAME],[[469,8,[[470,9,[[471,10,[[472,11],[473,11,[[474,12,[[475,13],[476,13]]],[478,12,[[479,13],[480,13]]],[482,12,[[483,13],[484,13]]]]]]],[489,10,[[490,11],[491,11,[[492,12],[495,12]]],[497,11,[[498,12],[499,12]]]]]]],[504,9,[[505,10,[[506,11],[507,11]]]]]]]]);var root_25$3=add_locations(from_html(`<div class="text-center py-12 text-gray-500"><p>üåê Social intelligence data not available</p> <p class="text-sm">Connect social data sources to see influence metrics</p></div>`),Watcher[FILENAME],[[527,8,[[528,9],[529,9]]]]);var root_22$3=add_locations(from_html(`<div class="space-y-6"><div class="flex items-center gap-3"><button class="text-indigo-600 hover:text-indigo-800">‚Üê Back</button> <h3 class="text-lg font-semibold text-gray-900"> </h3></div> <!></div>`),Watcher[FILENAME],[[456,6,[[457,7,[[458,8],[464,8]]]]]]);var root_27$3=add_locations(from_html(`<div class="space-y-6"><h3 class="text-lg font-semibold text-gray-900">Alert Configuration</h3> <div class="text-center py-12 text-gray-500"><p>üîî Smart alerts coming soon</p> <p class="text-sm">Large transactions, social activity, and portfolio changes</p></div></div>`),Watcher[FILENAME],[[536,6,[[537,7],[539,7,[[540,8],[541,8]]]]]]);var root_2$6=add_locations(from_html(`<div class="flex h-[600px]"><div class="w-48 bg-gray-50 border-r border-gray-200 p-4"><nav class="space-y-2"><button>üìã Watch Accounts</button> <button>üìä Analytics</button> <button>üåê Social Intel</button> <button>üîî Alerts</button></nav></div> <div class="flex-1 p-6"><!> <!></div></div>`),Watcher[FILENAME],[[220,3,[[222,4,[[223,5,[[224,6],[230,6],[237,6],[244,6]]]]],[254,4]]]]);var root_32$2=add_locations(from_html(`<button class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Save Changes</button>`),Watcher[FILENAME],[[566,6]]);var root_28=add_locations(from_html(`<div class="flex justify-between"><div class="text-sm text-gray-500"><!></div> <div class="flex gap-3"><button class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50">Close</button> <!></div></div>`),Watcher[FILENAME],[[550,3,[[551,4],[558,4,[[559,5]]]]]]);function Watcher($$anchor,$$props){check_target(new.target);push$1($$props,true,Watcher);let watchAccounts=tag(state$1(proxy([])),"watchAccounts");let selectedAccount=tag(state$1(null),"selectedAccount");let socialData=tag_proxy(proxy(new Map),"socialData");let activeTab=tag(state$1("accounts"),"activeTab");let isLoading=tag(state$1(false),"isLoading");let error=tag(state$1(""),"error");let newAccountForm=tag(state$1(proxy({address:"",alias:"",blockchain:"ethereum",accountType:"personal",category:"",tags:[],notifications:{largeTransactions:true,balanceChanges:false,socialActivity:false}})),"newAccountForm");const supportedBlockchains=[{id:"ethereum",name:"Ethereum",symbol:"ETH"},{id:"bitcoin",name:"Bitcoin",symbol:"BTC"},{id:"polygon",name:"Polygon",symbol:"MATIC"},{id:"arbitrum",name:"Arbitrum",symbol:"ARB"},{id:"optimism",name:"Optimism",symbol:"OP"}];const accountTypes=[{id:"personal",name:"Personal Account",description:"Individual wallet addresses you want to track",icon:"üë§"},{id:"exchange",name:"Exchange Account",description:"Centralized exchange accounts for portfolio tracking",icon:"üè¶"},{id:"whale",name:"Whale Watching",description:"High-value accounts for social trading intelligence",icon:"üêã"},{id:"institution",name:"Institutional",description:"Corporate or institutional wallet addresses",icon:"üè¢"},{id:"contract",name:"Smart Contract",description:"DeFi protocols and smart contract addresses",icon:"üìú"}];onMount(async()=>{await loadWatchAccounts()});async function loadWatchAccounts(){try{set(isLoading,true);await new Promise(resolve=>setTimeout(resolve,500));set(watchAccounts,[{id:"1",address:"0x742d35cc6129c6532c742fc9d2c1b1e7c15b4c85",alias:"Vitalik Buterin",blockchain:"ethereum",accountType:"whale",category:"Influencer",tags:["ethereum","founder","whale"],balance:25e5,portfolioValue:125e6,lastActivity:new Date(Date.now()-36e5),socialScore:95,isActive:true,createdAt:new Date(Date.now()-864e5*7),notifications:{largeTransactions:true,balanceChanges:false,socialActivity:true}}],true);socialData.set("1",{followersCount:52e5,tradingActivity:"whale",reputationScore:98,recentTransactions:[{amount:15e5,direction:"out",timestamp:new Date(Date.now()-36e5),significance:"major"}],influenceMetrics:{copyTraders:15e3,portfolioMirrors:8500,socialMentions:125e3}})}catch(err){set(error,"Failed to load watch accounts");log.error("Error loading watch accounts:",false,err)}finally{set(isLoading,false)}}function removeWatchAccount(accountId){var _a2;set(watchAccounts,get$1(watchAccounts).filter(acc=>strict_equals(acc.id,accountId,false)),true);if(strict_equals((_a2=get$1(selectedAccount))==null?void 0:_a2.id,accountId)){set(selectedAccount,null)}}function selectAccount(account){set(selectedAccount,account,true);set(activeTab,"analytics")}function addTag(tag2){if(tag2.trim()&&!get$1(newAccountForm).tags.includes(tag2.trim())){get$1(newAccountForm).tags=[...get$1(newAccountForm).tags,tag2.trim()]}}function removeTag(index2){get$1(newAccountForm).tags=get$1(newAccountForm).tags.filter((_,i)=>strict_equals(i,index2,false))}function formatBalance(value){if(value>=1e6){return`$${(value/1e6).toFixed(2)}M`}if(value>=1e3){return`$${(value/1e3).toFixed(1)}K`}return`$${value.toFixed(2)}`}function getAccountTypeInfo(type){return accountTypes.find(t=>strict_equals(t.id,type))||accountTypes[0]}function getActivityColor(activity){switch(activity){case"whale":return"text-purple-600 bg-purple-100";case"high":return"text-red-600 bg-red-100";case"medium":return"text-orange-600 bg-orange-100";case"low":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}}function handleClose(){set(error,"");set(selectedAccount,null);set(activeTab,"accounts");$$props.onClose()}var fragment=comment();var node=first_child(fragment);{var consequent_14=$$anchor2=>{{const body=wrap_snippet(Watcher,function($$anchor3){validate_snippet_args(...arguments);var div=root_2$6();var div_1=child(div);var nav=child(div_1);var button=child(nav);button.__click=[on_click$9,activeTab];var button_1=sibling(button,2);button_1.__click=[on_click_1$2,activeTab];var button_2=sibling(button_1,2);button_2.__click=[on_click_2$2,activeTab];var button_3=sibling(button_2,2);button_3.__click=[on_click_3$1,activeTab];reset(nav);reset(div_1);var div_2=sibling(div_1,2);var node_1=child(div_2);{var consequent=$$anchor4=>{var div_3=root_3$7();var p=child(div_3);var text2=child(p,true);reset(p);var button_4=sibling(p,2);button_4.__click=[on_click_4$1,error];reset(div_3);template_effect(()=>set_text(text2,get$1(error)));append($$anchor4,div_3)};if_block(node_1,$$render=>{if(get$1(error))$$render(consequent)})}var node_2=sibling(node_1,2);{var consequent_6=$$anchor4=>{var div_4=root_4$5();var div_5=child(div_4);var span=sibling(child(div_5),2);var text_1=child(span);reset(span);reset(div_5);var div_6=sibling(div_5,2);var div_7=sibling(child(div_6),2);var div_8=child(div_7);var input=sibling(child(div_8),2);remove_input_defaults(input);validate_binding("bind:value={newAccountForm.address}",()=>get$1(newAccountForm),()=>"address",283,11);reset(div_8);var div_9=sibling(div_8,2);var input_1=sibling(child(div_9),2);remove_input_defaults(input_1);validate_binding("bind:value={newAccountForm.alias}",()=>get$1(newAccountForm),()=>"alias",293,11);reset(div_9);var div_10=sibling(div_9,2);var select=sibling(child(div_10),2);each(select,21,()=>supportedBlockchains,index,($$anchor5,blockchain)=>{var option=root_5$7();var option_value={};var text_2=child(option);reset(option);template_effect(()=>{if(option_value!==(option_value=get$1(blockchain).id)){option.value=(option.__value=get$1(blockchain).id)??""}set_text(text_2,`${get$1(blockchain).name??""} (${get$1(blockchain).symbol??""})`)});append($$anchor5,option)});reset(select);validate_binding("bind:value={newAccountForm.blockchain}",()=>get$1(newAccountForm),()=>"blockchain",303,11);reset(div_10);var div_11=sibling(div_10,2);var select_1=sibling(child(div_11),2);each(select_1,21,()=>accountTypes,index,($$anchor5,type)=>{var option_1=root_6$7();var option_1_value={};var text_3=child(option_1);reset(option_1);template_effect(()=>{if(option_1_value!==(option_1_value=get$1(type).id)){option_1.value=(option_1.__value=get$1(type).id)??""}set_text(text_3,`${get$1(type).icon??""} ${get$1(type).name??""}`)});append($$anchor5,option_1)});reset(select_1);validate_binding("bind:value={newAccountForm.accountType}",()=>get$1(newAccountForm),()=>"accountType",315,11);reset(div_11);reset(div_7);var div_12=sibling(div_7,2);var input_2=child(div_12);input_2.__keydown=e=>{if(strict_equals(e.key,"Enter")){e.preventDefault();addTag(e.currentTarget.value);e.currentTarget.value=""}};var button_5=sibling(input_2,2);button_5.__click=[addWatchAccount,newAccountForm,error,watchAccounts];reset(div_12);var node_3=sibling(div_12,2);{var consequent_1=$$anchor5=>{var div_13=root_7$6();each(div_13,21,()=>get$1(newAccountForm).tags,index,($$anchor6,tag2,index2)=>{var span_1=root_8$4();var text_4=child(span_1);var button_6=sibling(text_4);button_6.__click=()=>removeTag(index2);reset(span_1);template_effect(()=>set_text(text_4,`${get$1(tag2)??""} `));append($$anchor6,span_1)});reset(div_13);append($$anchor5,div_13)};if_block(node_3,$$render=>{if(get$1(newAccountForm).tags.length>0)$$render(consequent_1)})}reset(div_6);var div_14=sibling(div_6,2);var node_4=child(div_14);{var consequent_2=$$anchor5=>{var div_15=root_9$4();append($$anchor5,div_15)};var alternate=($$anchor5,$$elseif)=>{{var consequent_3=$$anchor6=>{var div_16=root_11$3();append($$anchor6,div_16)};var alternate_1=$$anchor6=>{var fragment_2=comment();var node_5=first_child(fragment_2);each(node_5,17,()=>get$1(watchAccounts),index,($$anchor7,account)=>{var div_17=root_13$4();var div_18=child(div_17);var div_19=child(div_18);var div_20=child(div_19);var text_5=child(div_20,true);reset(div_20);var div_21=sibling(div_20,2);var div_22=child(div_21);var text_6=child(div_22,true);reset(div_22);var div_23=sibling(div_22,2);var text_7=child(div_23);reset(div_23);var div_24=sibling(div_23,2);var span_2=child(div_24);var text_8=child(span_2,true);reset(span_2);var span_3=sibling(span_2,2);var text_9=child(span_3,true);reset(span_3);var node_6=sibling(span_3,2);each(node_6,17,()=>get$1(account).tags,index,($$anchor8,tag2)=>{var span_4=root_14$4();var text_10=child(span_4,true);reset(span_4);template_effect(()=>set_text(text_10,get$1(tag2)));append($$anchor8,span_4)});reset(div_24);reset(div_21);reset(div_19);var div_25=sibling(div_19,2);var node_7=child(div_25);{var consequent_4=$$anchor8=>{var div_26=root_15$2();var text_11=child(div_26,true);reset(div_26);template_effect($0=>set_text(text_11,$0),[()=>formatBalance(get$1(account).portfolioValue)]);append($$anchor8,div_26)};if_block(node_7,$$render=>{if(get$1(account).portfolioValue)$$render(consequent_4)})}var node_8=sibling(node_7,2);{var consequent_5=$$anchor8=>{var div_27=root_16$2();var text_12=child(div_27);reset(div_27);template_effect(()=>set_text(text_12,`Social: ${get$1(account).socialScore??""}/100`));append($$anchor8,div_27)};if_block(node_8,$$render=>{if(get$1(account).socialScore)$$render(consequent_5)})}var div_28=sibling(node_8,2);var node_9=child(div_28);SimpleTooltip(node_9,{content:"View analytics",children:wrap_snippet(Watcher,($$anchor8,$$slotProps)=>{var button_7=root_17$2();button_7.__click=[on_click_5,selectAccount,account];append($$anchor8,button_7)}),$$slots:{default:true}});var node_10=sibling(node_9,2);SimpleTooltip(node_10,{content:"Remove account",children:wrap_snippet(Watcher,($$anchor8,$$slotProps)=>{var button_8=root_18$1();button_8.__click=[on_click_6,removeWatchAccount,account];append($$anchor8,button_8)}),$$slots:{default:true}});reset(div_28);reset(div_25);reset(div_18);reset(div_17);template_effect(($0,$1,$2,$3)=>{set_text(text_5,$0);set_text(text_6,get$1(account).alias);set_text(text_7,`${$1??""}...${$2??""}`);set_text(text_8,get$1(account).blockchain);set_text(text_9,$3)},[()=>getAccountTypeInfo(get$1(account).accountType).icon,()=>get$1(account).address.slice(0,10),()=>get$1(account).address.slice(-8),()=>getAccountTypeInfo(get$1(account).accountType).name]);append($$anchor7,div_17)});append($$anchor6,fragment_2)};if_block($$anchor5,$$render=>{if(strict_equals(get$1(watchAccounts).length,0))$$render(consequent_3);else $$render(alternate_1,false)},$$elseif)}};if_block(node_4,$$render=>{if(get$1(isLoading))$$render(consequent_2);else $$render(alternate,false)})}reset(div_14);reset(div_4);template_effect(()=>set_text(text_1,`${get$1(watchAccounts).length??""} accounts`));bind_value(input,()=>get$1(newAccountForm).address,$$value=>get$1(newAccountForm).address=$$value);bind_value(input_1,()=>get$1(newAccountForm).alias,$$value=>get$1(newAccountForm).alias=$$value);bind_select_value(select,()=>get$1(newAccountForm).blockchain,$$value=>get$1(newAccountForm).blockchain=$$value);bind_select_value(select_1,()=>get$1(newAccountForm).accountType,$$value=>get$1(newAccountForm).accountType=$$value);append($$anchor4,div_4)};var alternate_2=($$anchor4,$$elseif)=>{{var consequent_7=$$anchor5=>{var div_29=root_20$4();var div_30=child(div_29);var button_9=child(div_30);button_9.__click=[on_click_7,activeTab];var h3=sibling(button_9,2);var text_13=child(h3);reset(h3);reset(div_30);var div_31=sibling(div_30,2);var div_32=child(div_31);var div_33=sibling(child(div_32),2);var text_14=child(div_33,true);reset(div_33);reset(div_32);var div_34=sibling(div_32,2);var div_35=sibling(child(div_34),2);var text_15=child(div_35);reset(div_35);reset(div_34);var div_36=sibling(div_34,2);var div_37=sibling(child(div_36),2);var text_16=child(div_37,true);reset(div_37);reset(div_36);reset(div_31);next(2);reset(div_29);template_effect(($0,$1)=>{set_text(text_13,`Analytics: ${get$1(selectedAccount).alias??""}`);set_text(text_14,$0);set_text(text_15,`${(get$1(selectedAccount).socialScore||0)??""}/100`);set_text(text_16,$1)},[()=>formatBalance(get$1(selectedAccount).portfolioValue||0),()=>getAccountTypeInfo(get$1(selectedAccount).accountType).name]);append($$anchor5,div_29)};var alternate_3=($$anchor5,$$elseif2)=>{{var consequent_9=$$anchor6=>{var div_38=root_22$3();var div_39=child(div_38);var button_10=child(div_39);button_10.__click=[on_click_8,activeTab];var h3_1=sibling(button_10,2);var text_17=child(h3_1);reset(h3_1);reset(div_39);var node_11=sibling(div_39,2);{var consequent_8=$$anchor7=>{var div_40=root_23$3();const social=user_derived(()=>socialData.get(get$1(selectedAccount).id));get$1(social);var div_41=child(div_40);var div_42=child(div_41);var div_43=sibling(child(div_42),2);var div_44=child(div_43);var span_5=sibling(child(div_44),2);var text_18=child(span_5,true);reset(span_5);reset(div_44);var div_45=sibling(div_44,2);var span_6=sibling(child(div_45),2);var text_19=child(span_6,true);reset(span_6);reset(div_45);var div_46=sibling(div_45,2);var span_7=sibling(child(div_46),2);var text_20=child(span_7,true);reset(span_7);reset(div_46);reset(div_43);reset(div_42);var div_47=sibling(div_42,2);var div_48=sibling(child(div_47),2);var span_8=child(div_48);var text_21=child(span_8,true);reset(span_8);next(2);reset(div_48);var div_49=sibling(div_48,2);var span_9=sibling(child(div_49),2);var text_22=child(span_9);reset(span_9);reset(div_49);reset(div_47);reset(div_41);var div_50=sibling(div_41,2);var div_51=child(div_50);var div_52=sibling(child(div_51),2);each(div_52,21,()=>get$1(social).recentTransactions,index,($$anchor8,tx)=>{var div_53=root_24$1();var div_54=child(div_53);var span_10=child(div_54);var text_23=child(span_10,true);reset(span_10);var div_55=sibling(span_10,2);var div_56=child(div_55);var text_24=child(div_56,true);reset(div_56);var div_57=sibling(div_56,2);var text_25=child(div_57,true);reset(div_57);reset(div_55);reset(div_54);var span_11=sibling(div_54,2);var text_26=child(span_11,true);reset(span_11);reset(div_53);template_effect(($0,$1)=>{set_text(text_23,strict_equals(get$1(tx).direction,"in")?"üìà":"üìâ");set_text(text_24,$0);set_text(text_25,$1);set_text(text_26,get$1(tx).significance)},[()=>formatBalance(get$1(tx).amount),()=>get$1(tx).timestamp.toLocaleTimeString()]);append($$anchor8,div_53)});reset(div_52);reset(div_51);reset(div_50);reset(div_40);template_effect(($0,$1,$2,$3,$4)=>{set_text(text_18,$0);set_text(text_19,$1);set_text(text_20,$2);set_class(span_8,1,`px-2 py-1 rounded text-sm font-medium ${$3??""}`);set_text(text_21,$4);set_text(text_22,`${get$1(social).reputationScore??""}/100`)},[()=>get$1(social).influenceMetrics.copyTraders.toLocaleString(),()=>get$1(social).influenceMetrics.portfolioMirrors.toLocaleString(),()=>get$1(social).influenceMetrics.socialMentions.toLocaleString(),()=>getActivityColor(get$1(social).tradingActivity),()=>get$1(social).tradingActivity.toUpperCase()]);append($$anchor7,div_40)};var alternate_4=$$anchor7=>{var div_58=root_25$3();append($$anchor7,div_58)};if_block(node_11,$$render=>{if(socialData.has(get$1(selectedAccount).id))$$render(consequent_8);else $$render(alternate_4,false)})}reset(div_38);template_effect(()=>set_text(text_17,`Social Intelligence: ${get$1(selectedAccount).alias??""}`));append($$anchor6,div_38)};var alternate_5=($$anchor6,$$elseif3)=>{{var consequent_10=$$anchor7=>{var div_59=root_27$3();append($$anchor7,div_59)};if_block($$anchor6,$$render=>{if(strict_equals(get$1(activeTab),"alerts"))$$render(consequent_10)},$$elseif3)}};if_block($$anchor5,$$render=>{if(strict_equals(get$1(activeTab),"social")&&get$1(selectedAccount))$$render(consequent_9);else $$render(alternate_5,false)},$$elseif2)}};if_block($$anchor4,$$render=>{if(strict_equals(get$1(activeTab),"analytics")&&get$1(selectedAccount))$$render(consequent_7);else $$render(alternate_3,false)},$$elseif)}};if_block(node_2,$$render=>{if(strict_equals(get$1(activeTab),"accounts"))$$render(consequent_6);else $$render(alternate_2,false)})}reset(div_2);reset(div);template_effect(()=>{set_class(button,1,`w-full text-left px-3 py-2 rounded-md text-sm font-medium transition-colors ${strict_equals(get$1(activeTab),"accounts")?"bg-indigo-100 text-indigo-700":"text-gray-600 hover:bg-gray-100"}`);set_class(button_1,1,`w-full text-left px-3 py-2 rounded-md text-sm font-medium transition-colors ${strict_equals(get$1(activeTab),"analytics")?"bg-indigo-100 text-indigo-700":"text-gray-600 hover:bg-gray-100"}`);button_1.disabled=!get$1(selectedAccount);set_class(button_2,1,`w-full text-left px-3 py-2 rounded-md text-sm font-medium transition-colors ${strict_equals(get$1(activeTab),"social")?"bg-indigo-100 text-indigo-700":"text-gray-600 hover:bg-gray-100"}`);button_2.disabled=!get$1(selectedAccount);set_class(button_3,1,`w-full text-left px-3 py-2 rounded-md text-sm font-medium transition-colors ${strict_equals(get$1(activeTab),"alerts")?"bg-indigo-100 text-indigo-700":"text-gray-600 hover:bg-gray-100"}`)});append($$anchor3,div)});const footer=wrap_snippet(Watcher,function($$anchor3){validate_snippet_args(...arguments);var div_60=root_28();var div_61=child(div_60);var node_12=child(div_61);{var consequent_11=$$anchor4=>{var text_27=text("Pro feature: Advanced portfolio tracking & social intelligence");append($$anchor4,text_27)};var alternate_6=($$anchor4,$$elseif)=>{{var consequent_12=$$anchor5=>{var text_28=text();template_effect(()=>set_text(text_28,`Analyzing: ${get$1(selectedAccount).alias??""}`));append($$anchor5,text_28)};if_block($$anchor4,$$render=>{if(get$1(selectedAccount))$$render(consequent_12)},$$elseif)}};if_block(node_12,$$render=>{if(strict_equals(get$1(activeTab),"accounts"))$$render(consequent_11);else $$render(alternate_6,false)})}reset(div_61);var div_62=sibling(div_61,2);var button_11=child(div_62);button_11.__click=handleClose;var node_13=sibling(button_11,2);{var consequent_13=$$anchor4=>{var button_12=root_32$2();button_12.__click=[handleComplete,$$props,handleClose];append($$anchor4,button_12)};if_block(node_13,$$render=>{if(strict_equals(get$1(activeTab),"accounts"))$$render(consequent_13)})}reset(div_62);reset(div_60);append($$anchor3,div_60)});Modal($$anchor2,{title:"Watcher - Portfolio Tracking & Social Intelligence",show:true,onClose:handleClose,size:"xl",body:body,footer:footer,$$slots:{body:true,footer:true}})}};if_block(node,$$render=>{if($$props.show)$$render(consequent_14)})}append($$anchor,fragment);return pop({...legacy_api()})}delegate(["click","keydown"]);WatchList[FILENAME]="src/lib/components/WatchList.svelte";function WatchList($$anchor,$$props){check_target(new.target);push$1($$props,true,WatchList);var $$ownership_validator=create_ownership_validator($$props);let show=prop($$props,"show",15,false),onClose=prop($$props,"onClose",3,()=>show(false)),onComplete=prop($$props,"onComplete",3,()=>{});{$$ownership_validator.binding("show",Watcher,show);Watcher($$anchor,{onClose:onClose(),onComplete:onComplete(),get show(){return show()},set show($$value){show($$value)}})}return pop({...legacy_api()})}OffcanvasProfileMenu[FILENAME]="src/lib/components/OffcanvasProfileMenu.svelte";function handleLogout(){goto(PATH_LOGOUT)}function openProfile(_,showProfileModal){set(showProfileModal,true)}function openSettings(__1,showSettingsModal){set(showSettingsModal,true)}function openWatchList(__2,isProUser,showWatchListModal){if(!get$1(isProUser))return;set(showWatchListModal,true)}var root_1$7=add_locations(from_html(`<button class="w-full text-left px-4 py-2 rounded-md text-sm hover:bg-primary-100 transition flex items-center gap-2"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9M12,4.5C17,4.5 21.27,7.61 23,12C21.27,16.39 17,19.5 12,19.5C7,19.5 2.73,16.39 1,12C2.73,7.61 7,4.5 12,4.5M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7Z"></path></svg> Watch Accounts</button>`),OffcanvasProfileMenu[FILENAME],[[164,4,[[168,5,[[169,6]]]]]]);var root_3$6=add_locations(from_html(`<button disabled class="w-full text-left px-4 py-2 rounded-md text-sm text-gray-400 cursor-not-allowed flex items-center gap-2"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9M12,4.5C17,4.5 21.27,7.61 23,12C21.27,16.39 17,19.5 12,19.5C7,19.5 2.73,16.39 1,12C2.73,7.61 7,4.5 12,4.5M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7Z"></path></svg> Watch Accounts <div class="w-3 h-3 bg-gradient-to-r from-indigo-400 to-purple-400 rounded-full flex items-center justify-center ml-auto"><svg class="w-2 h-2 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg></div></button>`),OffcanvasProfileMenu[FILENAME],[[175,5,[[179,6,[[180,7]]],[183,6,[[184,7,[[185,8]]]]]]]]);var root$b=add_locations(from_html(`<div class="z-100 offcanvas offcanvas-end top-0 right-0 fixed bottom-auto flex flex-col min-w-[200px] max-w-[280px] font-sans antialiased invisible bg-clip-padding shadow-sm outline-none transition duration-300 ease-in-out border-none rounded-l-md bg-primary text-base-content" tabindex="-1" id="offcanvasProfileMenu" aria-labelledby="offcanvasProfileMenuLabel" role="dialog" aria-modal="true"><div class="offcanvas-header flex items-center justify-between px-4 pt-2 pb-2 bg-primary-200"><h5 class="offcanvas-title font-semibold" id="offcanvasProfileMenuLabel">Profile</h5> <button type="button" class="text-base-content opacity-60 hover:opacity-100" data-bs-dismiss="offcanvas" aria-label="Close"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <hr class="my-1 border-base-content/20"/> <div class="flex items-center gap-3 px-4 py-3"><!> <div class="text-sm font-semibold"> </div></div> <hr class="my-1 border-base-content/20"/> <ul class="px-2 space-y-1"><li data-bs-dismiss="offcanvas"><button class="w-full text-left px-4 py-2 rounded-md text-sm hover:bg-primary-100 transition">üë§ Profile</button></li> <li data-bs-dismiss="offcanvas"><button class="w-full text-left px-4 py-2 rounded-md text-sm hover:bg-primary-100 transition">‚öôÔ∏è Account Settings</button></li> <li><!></li> <li data-bs-dismiss="offcanvas"><button class="w-full text-left px-4 py-2 rounded-md text-sm text-red-600 hover:text-red-800 hover:bg-primary-100 transition">üîí Logout</button></li></ul> <hr class="my-1 border-base-content/20"/> <div class="text-center py-2 bg-primary"><a class="text-sm font-semibold text-base-content hover:underline" href="https://yakkl.com/?utm_source=yakkl&amp;utm_medium=extension&amp;utm_campaign=extension&amp;utm_content=profile&amp;utm_term=extension" target="_blank" rel="noreferrer">yakkl.com</a></div></div> <!> <!> <!>`,1),OffcanvasProfileMenu[FILENAME],[[97,0,[[109,1,[[110,2],[111,2,[[117,3,[[125,4]]]]]]],[130,1],[133,1,[[139,2]]],[142,1],[145,1,[[146,2,[[147,3]]],[154,2,[[155,3]]],[162,2],[192,2,[[193,3]]]]],[202,1],[204,1,[[205,2]]]]]]);function OffcanvasProfileMenu($$anchor,$$props){check_target(new.target);push$1($$props,true,OffcanvasProfileMenu);let showProfileModal=tag(state$1(false),"showProfileModal");let showSettingsModal=tag(state$1(false),"showSettingsModal");let showWatchListModal=tag(state$1(false),"showWatchListModal");let offcanvasElement;let isHoveringMenu=tag(state$1(false),"isHoveringMenu");let hoverTimeout=null;let settings=null;let isProUser=tag(state$1(false),"isProUser");onMount(async()=>{var _a2;settings=await getSettings();set(isProUser,shouldShowProFeatures(((_a2=settings==null?void 0:settings.plan)==null?void 0:_a2.type)||PlanType.BASIC_MEMBER),true);if(strict_equals(typeof window,"undefined",false)){setupClickOutsideListener()}});onDestroy(()=>{if(strict_equals(typeof window,"undefined",false)&&strict_equals(typeof document,"undefined",false)){document.removeEventListener("click",handleClickOutside)}if(hoverTimeout){clearTimeout(hoverTimeout)}});function setupClickOutsideListener(){if(strict_equals(typeof document,"undefined",false)){document.addEventListener("click",handleClickOutside)}}function handleClickOutside(event2){if(!offcanvasElement)return;const target=event2.target;const isOffcanvasVisible=offcanvasElement.classList.contains("show");const isClickOutside=!offcanvasElement.contains(target);const isNotTrigger=!target.closest('[data-bs-toggle="offcanvas"][data-bs-target="#offcanvasProfileMenu"]');if(isOffcanvasVisible&&isClickOutside&&isNotTrigger){closeOffcanvas()}}function closeOffcanvas(){if(strict_equals(typeof window,"undefined",false)&&window.bootstrap){const offcanvasInstance=window.bootstrap.Offcanvas.getInstance(offcanvasElement);if(offcanvasInstance){offcanvasInstance.hide()}}}function handleMenuMouseEnter(){set(isHoveringMenu,true);if(hoverTimeout){clearTimeout(hoverTimeout);hoverTimeout=null}}function handleMenuMouseLeave(){set(isHoveringMenu,false);hoverTimeout=setTimeout(()=>{closeOffcanvas()},500)}function handleProfileComplete(){set(showProfileModal,false)}function handleSettingsComplete(){set(showSettingsModal,false)}function handleWatchListComplete(){set(showWatchListModal,false)}var fragment=root$b();var div=first_child(fragment);var div_1=sibling(child(div),4);var node=child(div_1);Avatar(node,{get url(){return $$props.avatarUrl},ariaLabel:"Profile",className:"w-10 h-10 rounded-full ring-2 ring-offset-1"});var div_2=sibling(node,2);var text2=child(div_2,true);reset(div_2);reset(div_1);var ul=sibling(div_1,4);var li=child(ul);var button=child(li);button.__click=[openProfile,showProfileModal];reset(li);var li_1=sibling(li,2);var button_1=child(li_1);button_1.__click=[openSettings,showSettingsModal];reset(li_1);var li_2=sibling(li_1,2);var node_1=child(li_2);{var consequent=$$anchor2=>{var button_2=root_1$7();button_2.__click=[openWatchList,isProUser,showWatchListModal];append($$anchor2,button_2)};var alternate=$$anchor2=>{SimpleTooltip($$anchor2,{content:"Upgrade to Pro for portfolio tracking, whale watching, and social trading intelligence",children:wrap_snippet(OffcanvasProfileMenu,($$anchor3,$$slotProps)=>{var button_3=root_3$6();append($$anchor3,button_3)}),$$slots:{default:true}})};if_block(node_1,$$render=>{if(get$1(isProUser))$$render(consequent);else $$render(alternate,false)})}reset(li_2);var li_3=sibling(li_2,2);var button_4=child(li_3);button_4.__click=[handleLogout];reset(li_3);reset(ul);next(4);reset(div);bind_this(div,$$value=>offcanvasElement=$$value,()=>offcanvasElement);var node_2=sibling(div,2);Profile(node_2,{onComplete:handleProfileComplete,onClose:()=>set(showProfileModal,false),get show(){return get$1(showProfileModal)},set show($$value){set(showProfileModal,$$value,true)}});var node_3=sibling(node_2,2);Settings(node_3,{onComplete:handleSettingsComplete,onClose:()=>set(showSettingsModal,false),get show(){return get$1(showSettingsModal)},set show($$value){set(showSettingsModal,$$value,true)}});var node_4=sibling(node_3,2);WatchList(node_4,{onComplete:handleWatchListComplete,onClose:()=>set(showWatchListModal,false),get show(){return get$1(showWatchListModal)},set show($$value){set(showWatchListModal,$$value,true)}});template_effect(()=>{set_text(text2,$$props.userName??"Anonymous Yakker");set_attribute(li_2,"data-bs-dismiss",get$1(isProUser)?"offcanvas":"")});event("mouseenter",div,handleMenuMouseEnter);event("mouseleave",div,handleMenuMouseLeave);append($$anchor,fragment);return pop({...legacy_api()})}delegate(["click"]);Header[FILENAME]="src/lib/components/Header.svelte";function handlePopout(){if(browserSvelte){browser_ext.runtime.sendMessage({type:"popout"});safeLogout()}}var root_2$5=add_locations(from_html(`<a data-bs-toggle="offcanvas" href="#offcanvasMainMenu" aria-controls="offcanvasMainMenu" role="button" aria-label="Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-7 h-7 fill-gray-100 hover:fill-gray-400"><path fill-rule="evenodd" d="M3 5.25a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 5.25zm0 4.5A.75.75 0 013.75 9h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 9.75zm0 4.5a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75a.75.75 0 01-.75-.75zm0 4.5a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75a.75.75 0 01-.75-.75z" clip-rule="evenodd"></path></svg></a>`),Header[FILENAME],[[133,4,[[142,5,[[147,6]]]]]]);var on_click$8=()=>goto("/preview2");var root_4$4=add_locations(from_html(`<button class="flex items-center justify-center w-8 h-8 bg-gradient-to-r from-purple-500 to-indigo-600 rounded-full shadow-md hover:from-purple-600 hover:to-indigo-700 transition-all" aria-label="Preview new design"><svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg></button>`),Header[FILENAME],[[160,4,[[165,5,[[166,6]]]]]]);var root_5$6=add_locations(from_html(`<button aria-label="Popout"></button>`),Header[FILENAME],[[181,4]]);var root_7$5=add_locations(from_html(`<a data-bs-toggle="offcanvas" href="#offcanvasProfileMenu" aria-controls="offcanvasProfileMenu" role="button" aria-label="Menu"><!></a>`),Header[FILENAME],[[186,5]]);var root_1$6=add_locations(from_html(`<nav class="grid grid-cols-[1fr,2fr,1fr] items-center w-full py-2 px-2 gap-0"><div class="flex items-center justify-start gap-4"><!> <!> <!></div> <div class="flex items-center justify-center"><!></div> <div class="flex items-center justify-end gap-4"><!> <!></div></nav>`),Header[FILENAME],[[129,1,[[131,2],[173,2],[178,2]]]]);var root$a=add_locations(from_html(`<!> <!> <!>`,1),Header[FILENAME],[]);function Header($$anchor,$$props){check_target(new.target);push$1($$props,false,Header);let browserContext=mutable_source();let address="";let imageSRC="";let userName=mutable_source("");let avatarUrl=mutable_source("");let browserAccessor=BrowserAccessor.getInstance();onMount(async()=>{var _a2;try{set(browserContext,await browserAccessor.getContext());const current=await getYakklCurrentlySelected();address=current.shortcuts.address;imageSRC=identicon(address||"default");const profile=await getProfile();if(profile){set(userName,profile.userName||"Anonymous Yakker");let profileData;if(isEncryptedData(profile.data)){const miscStore=get(yakklMiscStore);if(miscStore){profileData=await decryptData(profile.data,miscStore)}else{profileData={name:{first:"",last:""},email:"",registered:{}}}}else{profileData=profile.data}set(avatarUrl,((_a2=profileData.meta)==null?void 0:_a2.avatarUrl)||imageSRC)}}catch(e){log.warn("Error loading profile data in Header:",false,e);set(userName,"Anonymous Yakker");set(avatarUrl,imageSRC)}});function showOffcanvasMain(){if(strict_equals(typeof window,"undefined",false)&&window.bootstrap){const element=document.getElementById("offcanvasMainMenu");if(element){const offcanvasInstance=window.bootstrap.Offcanvas.getOrCreateInstance(element);offcanvasInstance.show()}}}function showOffcanvasProfile(){if(strict_equals(typeof window,"undefined",false)&&window.bootstrap){const element=document.getElementById("offcanvasProfileMenu");if(element){const offcanvasInstance=window.bootstrap.Offcanvas.getOrCreateInstance(element);offcanvasInstance.show()}}}function handleMainMenuHover(){setTimeout(()=>{showOffcanvasMain()},100)}function handleMainMenuLeave(){}function handleProfileMenuHover(){setTimeout(()=>{showOffcanvasProfile()},100)}function handleProfileMenuLeave(){}init$1();var fragment=root$a();var node=first_child(fragment);ImageBar(node,{children:wrap_snippet(Header,($$anchor2,$$slotProps)=>{var nav=root_1$6();var div=child(nav);var node_1=child(div);SimpleTooltip(node_1,{content:"Open the main menu",position:"right",children:wrap_snippet(Header,($$anchor3,$$slotProps2)=>{var a=root_2$5();event("mouseenter",a,handleMainMenuHover);event("mouseleave",a,handleMainMenuLeave);append($$anchor3,a)}),$$slots:{default:true}});var node_2=sibling(node_1,2);SimpleTooltip(node_2,{content:"YAKKL University",position:"bottom",children:wrap_snippet(Header,($$anchor3,$$slotProps2)=>{GraduationCapButton($$anchor3,{})}),$$slots:{default:true}});var node_3=sibling(node_2,2);SimpleTooltip(node_3,{content:"Preview new wallet design",position:"bottom",children:wrap_snippet(Header,($$anchor3,$$slotProps2)=>{var button=root_4$4();button.__click=[on_click$8];append($$anchor3,button)}),$$slots:{default:true}});reset(div);var div_1=sibling(div,2);var node_4=child(div_1);PlanBadge(node_4,{});reset(div_1);var div_2=sibling(div_1,2);var node_5=child(div_2);Share(node_5,{});var node_6=sibling(node_5,2);{var consequent=$$anchor3=>{var button_1=root_5$6();button_1.__click=[handlePopout];append($$anchor3,button_1)};var alternate=$$anchor3=>{SimpleTooltip($$anchor3,{content:"Open the profile menu",position:"bottom",children:wrap_snippet(Header,($$anchor4,$$slotProps2)=>{var a_1=root_7$5();var node_7=child(a_1);Avatar(node_7,{get url(){return get$1(avatarUrl)},get userName(){return get$1(userName)},ariaLabel:"Profile",className:"w-8 h-8 rounded-full ring-2 ring-offset-1"});reset(a_1);event("mouseenter",a_1,handleProfileMenuHover);event("mouseleave",a_1,handleProfileMenuLeave);append($$anchor4,a_1)}),$$slots:{default:true}})};if_block(node_6,$$render=>{if(strict_equals(get$1(browserContext),ExtensionContext.SIDEPANEL))$$render(consequent);else $$render(alternate,false)})}reset(div_2);reset(nav);append($$anchor2,nav)}),$$slots:{default:true}});var node_8=sibling(node,2);OffcanvasMainMenu(node_8,{});var node_9=sibling(node_8,2);OffcanvasProfileMenu(node_9,{get userName(){return get$1(userName)},get avatarUrl(){return get$1(avatarUrl)}});append($$anchor,fragment);return pop({...legacy_api()})}delegate(["click"]);const default_format="RFC3986";const formatters={RFC1738:v=>String(v).replace(/%20/g,"+"),RFC3986:v=>String(v)};const RFC1738="RFC1738";const is_array$1=Array.isArray;const hex_table=(()=>{const array=[];for(let i=0;i<256;++i){array.push("%"+((i<16?"0":"")+i.toString(16)).toUpperCase())}return array})();const limit=1024;const encode=(str2,_defaultEncoder,charset,_kind,format)=>{if(str2.length===0){return str2}let string=str2;if(typeof str2==="symbol"){string=Symbol.prototype.toString.call(str2)}else if(typeof str2!=="string"){string=String(str2)}if(charset==="iso-8859-1"){return escape(string).replace(/%u[0-9a-f]{4}/gi,function($0){return"%26%23"+parseInt($0.slice(2),16)+"%3B"})}let out="";for(let j=0;j<string.length;j+=limit){const segment=string.length>=limit?string.slice(j,j+limit):string;const arr=[];for(let i=0;i<segment.length;++i){let c=segment.charCodeAt(i);if(c===45||c===46||c===95||c===126||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||format===RFC1738&&(c===40||c===41)){arr[arr.length]=segment.charAt(i);continue}if(c<128){arr[arr.length]=hex_table[c];continue}if(c<2048){arr[arr.length]=hex_table[192|c>>6]+hex_table[128|c&63];continue}if(c<55296||c>=57344){arr[arr.length]=hex_table[224|c>>12]+hex_table[128|c>>6&63]+hex_table[128|c&63];continue}i+=1;c=65536+((c&1023)<<10|segment.charCodeAt(i)&1023);arr[arr.length]=hex_table[240|c>>18]+hex_table[128|c>>12&63]+hex_table[128|c>>6&63]+hex_table[128|c&63]}out+=arr.join("")}return out};function is_buffer(obj){if(!obj||typeof obj!=="object"){return false}return!!(obj.constructor&&obj.constructor.isBuffer&&obj.constructor.isBuffer(obj))}function maybe_map(val,fn){if(is_array$1(val)){const mapped=[];for(let i=0;i<val.length;i+=1){mapped.push(fn(val[i]))}return mapped}return fn(val)}const has=Object.prototype.hasOwnProperty;const array_prefix_generators={brackets(prefix){return String(prefix)+"[]"},comma:"comma",indices(prefix,key){return String(prefix)+"["+key+"]"},repeat(prefix){return String(prefix)}};const is_array=Array.isArray;const push=Array.prototype.push;const push_to_array=function(arr,value_or_array){push.apply(arr,is_array(value_or_array)?value_or_array:[value_or_array])};const to_ISO=Date.prototype.toISOString;const defaults={addQueryPrefix:false,allowDots:false,allowEmptyArrays:false,arrayFormat:"indices",charset:"utf-8",charsetSentinel:false,delimiter:"&",encode:true,encodeDotInKeys:false,encoder:encode,encodeValuesOnly:false,format:default_format,formatter:formatters[default_format],indices:false,serializeDate(date){return to_ISO.call(date)},skipNulls:false,strictNullHandling:false};function is_non_nullish_primitive(v){return typeof v==="string"||typeof v==="number"||typeof v==="boolean"||typeof v==="symbol"||typeof v==="bigint"}const sentinel={};function inner_stringify(object,prefix,generateArrayPrefix,commaRoundTrip,allowEmptyArrays,strictNullHandling,skipNulls,encodeDotInKeys,encoder,filter,sort,allowDots,serializeDate,format,formatter,encodeValuesOnly,charset,sideChannel){let obj=object;let tmp_sc=sideChannel;let step=0;let find_flag=false;while((tmp_sc=tmp_sc.get(sentinel))!==void 0&&!find_flag){const pos=tmp_sc.get(object);step+=1;if(typeof pos!=="undefined"){if(pos===step){throw new RangeError("Cyclic object value")}else{find_flag=true}}if(typeof tmp_sc.get(sentinel)==="undefined"){step=0}}if(typeof filter==="function"){obj=filter(prefix,obj)}else if(obj instanceof Date){obj=serializeDate==null?void 0:serializeDate(obj)}else if(generateArrayPrefix==="comma"&&is_array(obj)){obj=maybe_map(obj,function(value){if(value instanceof Date){return serializeDate==null?void 0:serializeDate(value)}return value})}if(obj===null){if(strictNullHandling){return encoder&&!encodeValuesOnly?encoder(prefix,defaults.encoder,charset,"key",format):prefix}obj=""}if(is_non_nullish_primitive(obj)||is_buffer(obj)){if(encoder){const key_value=encodeValuesOnly?prefix:encoder(prefix,defaults.encoder,charset,"key",format);return[(formatter==null?void 0:formatter(key_value))+"="+(formatter==null?void 0:formatter(encoder(obj,defaults.encoder,charset,"value",format)))]}return[(formatter==null?void 0:formatter(prefix))+"="+(formatter==null?void 0:formatter(String(obj)))]}const values=[];if(typeof obj==="undefined"){return values}let obj_keys;if(generateArrayPrefix==="comma"&&is_array(obj)){if(encodeValuesOnly&&encoder){obj=maybe_map(obj,encoder)}obj_keys=[{value:obj.length>0?obj.join(",")||null:void 0}]}else if(is_array(filter)){obj_keys=filter}else{const keys=Object.keys(obj);obj_keys=sort?keys.sort(sort):keys}const encoded_prefix=encodeDotInKeys?String(prefix).replace(/\./g,"%2E"):String(prefix);const adjusted_prefix=commaRoundTrip&&is_array(obj)&&obj.length===1?encoded_prefix+"[]":encoded_prefix;if(allowEmptyArrays&&is_array(obj)&&obj.length===0){return adjusted_prefix+"[]"}for(let j=0;j<obj_keys.length;++j){const key=obj_keys[j];const value=typeof key==="object"&&typeof key.value!=="undefined"?key.value:obj[key];if(skipNulls&&value===null){continue}const encoded_key=allowDots&&encodeDotInKeys?key.replace(/\./g,"%2E"):key;const key_prefix=is_array(obj)?typeof generateArrayPrefix==="function"?generateArrayPrefix(adjusted_prefix,encoded_key):adjusted_prefix:adjusted_prefix+(allowDots?"."+encoded_key:"["+encoded_key+"]");sideChannel.set(object,step);const valueSideChannel=new WeakMap;valueSideChannel.set(sentinel,sideChannel);push_to_array(values,inner_stringify(value,key_prefix,generateArrayPrefix,commaRoundTrip,allowEmptyArrays,strictNullHandling,skipNulls,encodeDotInKeys,generateArrayPrefix==="comma"&&encodeValuesOnly&&is_array(obj)?null:encoder,filter,sort,allowDots,serializeDate,format,formatter,encodeValuesOnly,charset,valueSideChannel))}return values}function normalize_stringify_options(opts=defaults){if(typeof opts.allowEmptyArrays!=="undefined"&&typeof opts.allowEmptyArrays!=="boolean"){throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided")}if(typeof opts.encodeDotInKeys!=="undefined"&&typeof opts.encodeDotInKeys!=="boolean"){throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided")}if(opts.encoder!==null&&typeof opts.encoder!=="undefined"&&typeof opts.encoder!=="function"){throw new TypeError("Encoder has to be a function.")}const charset=opts.charset||defaults.charset;if(typeof opts.charset!=="undefined"&&opts.charset!=="utf-8"&&opts.charset!=="iso-8859-1"){throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined")}let format=default_format;if(typeof opts.format!=="undefined"){if(!has.call(formatters,opts.format)){throw new TypeError("Unknown format option provided.")}format=opts.format}const formatter=formatters[format];let filter=defaults.filter;if(typeof opts.filter==="function"||is_array(opts.filter)){filter=opts.filter}let arrayFormat;if(opts.arrayFormat&&opts.arrayFormat in array_prefix_generators){arrayFormat=opts.arrayFormat}else if("indices"in opts){arrayFormat=opts.indices?"indices":"repeat"}else{arrayFormat=defaults.arrayFormat}if("commaRoundTrip"in opts&&typeof opts.commaRoundTrip!=="boolean"){throw new TypeError("`commaRoundTrip` must be a boolean, or absent")}const allowDots=typeof opts.allowDots==="undefined"?!!opts.encodeDotInKeys===true?true:defaults.allowDots:!!opts.allowDots;return{addQueryPrefix:typeof opts.addQueryPrefix==="boolean"?opts.addQueryPrefix:defaults.addQueryPrefix,allowDots:allowDots,allowEmptyArrays:typeof opts.allowEmptyArrays==="boolean"?!!opts.allowEmptyArrays:defaults.allowEmptyArrays,arrayFormat:arrayFormat,charset:charset,charsetSentinel:typeof opts.charsetSentinel==="boolean"?opts.charsetSentinel:defaults.charsetSentinel,commaRoundTrip:!!opts.commaRoundTrip,delimiter:typeof opts.delimiter==="undefined"?defaults.delimiter:opts.delimiter,encode:typeof opts.encode==="boolean"?opts.encode:defaults.encode,encodeDotInKeys:typeof opts.encodeDotInKeys==="boolean"?opts.encodeDotInKeys:defaults.encodeDotInKeys,encoder:typeof opts.encoder==="function"?opts.encoder:defaults.encoder,encodeValuesOnly:typeof opts.encodeValuesOnly==="boolean"?opts.encodeValuesOnly:defaults.encodeValuesOnly,filter:filter,format:format,formatter:formatter,serializeDate:typeof opts.serializeDate==="function"?opts.serializeDate:defaults.serializeDate,skipNulls:typeof opts.skipNulls==="boolean"?opts.skipNulls:defaults.skipNulls,sort:typeof opts.sort==="function"?opts.sort:null,strictNullHandling:typeof opts.strictNullHandling==="boolean"?opts.strictNullHandling:defaults.strictNullHandling}}function stringify(object,opts={}){let obj=object;const options=normalize_stringify_options(opts);let obj_keys;let filter;if(typeof options.filter==="function"){filter=options.filter;obj=filter("",obj)}else if(is_array(options.filter)){filter=options.filter;obj_keys=filter}const keys=[];if(typeof obj!=="object"||obj===null){return""}const generateArrayPrefix=array_prefix_generators[options.arrayFormat];const commaRoundTrip=generateArrayPrefix==="comma"&&options.commaRoundTrip;if(!obj_keys){obj_keys=Object.keys(obj)}if(options.sort){obj_keys.sort(options.sort)}const sideChannel=new WeakMap;for(let i=0;i<obj_keys.length;++i){const key=obj_keys[i];if(options.skipNulls&&obj[key]===null){continue}push_to_array(keys,inner_stringify(obj[key],key,generateArrayPrefix,commaRoundTrip,options.allowEmptyArrays,options.strictNullHandling,options.skipNulls,options.encodeDotInKeys,options.encode?options.encoder:null,options.filter,options.sort,options.allowDots,options.serializeDate,options.format,options.formatter,options.encodeValuesOnly,options.charset,sideChannel))}const joined=keys.join(options.delimiter);let prefix=options.addQueryPrefix===true?"?":"";if(options.charsetSentinel){if(options.charset==="iso-8859-1"){prefix+="utf8=%26%2310003%3B&"}else{prefix+="utf8=%E2%9C%93&"}}return joined.length>0?prefix+joined:""}const VERSION="4.104.0";let auto=false;let kind=void 0;let fetch$1=void 0;let FormData$1=void 0;let File$1=void 0;let ReadableStream$1=void 0;let getMultipartRequestOptions=void 0;let getDefaultAgent=void 0;let fileFromPath=void 0;let isFsReadStream=void 0;function setShims(shims,options={auto:false}){if(auto){throw new Error(`you must \`import 'openai/shims/${shims.kind}'\` before importing anything else from openai`)}if(kind){throw new Error(`can't \`import 'openai/shims/${shims.kind}'\` after \`import 'openai/shims/${kind}'\``)}auto=options.auto;kind=shims.kind;fetch$1=shims.fetch;FormData$1=shims.FormData;File$1=shims.File;ReadableStream$1=shims.ReadableStream;getMultipartRequestOptions=shims.getMultipartRequestOptions;getDefaultAgent=shims.getDefaultAgent;fileFromPath=shims.fileFromPath;isFsReadStream=shims.isFsReadStream}class MultipartBody{constructor(body){this.body=body}get[Symbol.toStringTag](){return"MultipartBody"}}function getRuntime({manuallyImported:manuallyImported}={}){const recommendation=manuallyImported?`You may need to use polyfills`:`Add one of these imports before your first \`import ‚Ä¶ from 'openai'\`:\n- \`import 'openai/shims/node'\` (if you're running on Node)\n- \`import 'openai/shims/web'\` (otherwise)\n`;let _fetch,_Request,_Response,_Headers;try{_fetch=fetch;_Request=Request;_Response=Response;_Headers=Headers}catch(error){throw new Error(`this environment is missing the following Web Fetch API type: ${error.message}. ${recommendation}`)}return{kind:"web",fetch:_fetch,Request:_Request,Response:_Response,Headers:_Headers,FormData:typeof FormData!=="undefined"?FormData:class FormData{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${recommendation}`)}},Blob:typeof Blob!=="undefined"?Blob:class Blob{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${recommendation}`)}},File:typeof File!=="undefined"?File:class File{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${recommendation}`)}},ReadableStream:typeof ReadableStream!=="undefined"?ReadableStream:class ReadableStream{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${recommendation}`)}},getMultipartRequestOptions:async(form,opts)=>({...opts,body:new MultipartBody(form)}),getDefaultAgent:url=>void 0,fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:value=>false}}const init=()=>{if(!kind)setShims(getRuntime(),{auto:true})};init();class OpenAIError extends Error{}class APIError extends OpenAIError{constructor(status,error,message,headers){super(`${APIError.makeMessage(status,error,message)}`);this.status=status;this.headers=headers;this.request_id=headers==null?void 0:headers["x-request-id"];this.error=error;const data=error;this.code=data==null?void 0:data["code"];this.param=data==null?void 0:data["param"];this.type=data==null?void 0:data["type"]}static makeMessage(status,error,message){const msg=(error==null?void 0:error.message)?typeof error.message==="string"?error.message:JSON.stringify(error.message):error?JSON.stringify(error):message;if(status&&msg){return`${status} ${msg}`}if(status){return`${status} status code (no body)`}if(msg){return msg}return"(no status code or body)"}static generate(status,errorResponse,message,headers){if(!status||!headers){return new APIConnectionError({message:message,cause:castToError(errorResponse)})}const error=errorResponse==null?void 0:errorResponse["error"];if(status===400){return new BadRequestError(status,error,message,headers)}if(status===401){return new AuthenticationError(status,error,message,headers)}if(status===403){return new PermissionDeniedError(status,error,message,headers)}if(status===404){return new NotFoundError(status,error,message,headers)}if(status===409){return new ConflictError(status,error,message,headers)}if(status===422){return new UnprocessableEntityError(status,error,message,headers)}if(status===429){return new RateLimitError(status,error,message,headers)}if(status>=500){return new InternalServerError(status,error,message,headers)}return new APIError(status,error,message,headers)}}class APIUserAbortError extends APIError{constructor({message:message}={}){super(void 0,void 0,message||"Request was aborted.",void 0)}}class APIConnectionError extends APIError{constructor({message:message,cause:cause}){super(void 0,void 0,message||"Connection error.",void 0);if(cause)this.cause=cause}}class APIConnectionTimeoutError extends APIConnectionError{constructor({message:message}={}){super({message:message??"Request timed out."})}}class BadRequestError extends APIError{}class AuthenticationError extends APIError{}class PermissionDeniedError extends APIError{}class NotFoundError extends APIError{}class ConflictError extends APIError{}class UnprocessableEntityError extends APIError{}class RateLimitError extends APIError{}class InternalServerError extends APIError{}class LengthFinishReasonError extends OpenAIError{constructor(){super(`Could not parse response content as the length limit was reached`)}}class ContentFilterFinishReasonError extends OpenAIError{constructor(){super(`Could not parse response content as the request was rejected by the content filter`)}}var __classPrivateFieldSet$5=function(receiver,state2,value,kind2,f){if(kind2==="m")throw new TypeError("Private method is not writable");if(kind2==="a"&&!f)throw new TypeError("Private accessor was defined without a setter");if(typeof state2==="function"?receiver!==state2||!f:!state2.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return kind2==="a"?f.call(receiver,value):f?f.value=value:state2.set(receiver,value),value};var __classPrivateFieldGet$6=function(receiver,state2,kind2,f){if(kind2==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof state2==="function"?receiver!==state2||!f:!state2.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return kind2==="m"?f:kind2==="a"?f.call(receiver):f?f.value:state2.get(receiver)};var _LineDecoder_carriageReturnIndex;class LineDecoder{constructor(){_LineDecoder_carriageReturnIndex.set(this,void 0);this.buffer=new Uint8Array;__classPrivateFieldSet$5(this,_LineDecoder_carriageReturnIndex,null,"f")}decode(chunk){if(chunk==null){return[]}const binaryChunk=chunk instanceof ArrayBuffer?new Uint8Array(chunk):typeof chunk==="string"?(new TextEncoder).encode(chunk):chunk;let newData=new Uint8Array(this.buffer.length+binaryChunk.length);newData.set(this.buffer);newData.set(binaryChunk,this.buffer.length);this.buffer=newData;const lines=[];let patternIndex;while((patternIndex=findNewlineIndex(this.buffer,__classPrivateFieldGet$6(this,_LineDecoder_carriageReturnIndex,"f")))!=null){if(patternIndex.carriage&&__classPrivateFieldGet$6(this,_LineDecoder_carriageReturnIndex,"f")==null){__classPrivateFieldSet$5(this,_LineDecoder_carriageReturnIndex,patternIndex.index,"f");continue}if(__classPrivateFieldGet$6(this,_LineDecoder_carriageReturnIndex,"f")!=null&&(patternIndex.index!==__classPrivateFieldGet$6(this,_LineDecoder_carriageReturnIndex,"f")+1||patternIndex.carriage)){lines.push(this.decodeText(this.buffer.slice(0,__classPrivateFieldGet$6(this,_LineDecoder_carriageReturnIndex,"f")-1)));this.buffer=this.buffer.slice(__classPrivateFieldGet$6(this,_LineDecoder_carriageReturnIndex,"f"));__classPrivateFieldSet$5(this,_LineDecoder_carriageReturnIndex,null,"f");continue}const endIndex=__classPrivateFieldGet$6(this,_LineDecoder_carriageReturnIndex,"f")!==null?patternIndex.preceding-1:patternIndex.preceding;const line=this.decodeText(this.buffer.slice(0,endIndex));lines.push(line);this.buffer=this.buffer.slice(patternIndex.index);__classPrivateFieldSet$5(this,_LineDecoder_carriageReturnIndex,null,"f")}return lines}decodeText(bytes){if(bytes==null)return"";if(typeof bytes==="string")return bytes;if(typeof Buffer2!=="undefined"){if(bytes instanceof Buffer2){return bytes.toString()}if(bytes instanceof Uint8Array){return Buffer2.from(bytes).toString()}throw new OpenAIError(`Unexpected: received non-Uint8Array (${bytes.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder!=="undefined"){if(bytes instanceof Uint8Array||bytes instanceof ArrayBuffer){this.textDecoder??(this.textDecoder=new TextDecoder("utf8"));return this.textDecoder.decode(bytes)}throw new OpenAIError(`Unexpected: received non-Uint8Array/ArrayBuffer (${bytes.constructor.name}) in a web platform. Please report this error.`)}throw new OpenAIError(`Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.`)}flush(){if(!this.buffer.length){return[]}return this.decode("\n")}}_LineDecoder_carriageReturnIndex=new WeakMap;LineDecoder.NEWLINE_CHARS=new Set(["\n","\r"]);LineDecoder.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function findNewlineIndex(buffer,startIndex){const newline=10;const carriage=13;for(let i=startIndex??0;i<buffer.length;i++){if(buffer[i]===newline){return{preceding:i,index:i+1,carriage:false}}if(buffer[i]===carriage){return{preceding:i,index:i+1,carriage:true}}}return null}function findDoubleNewlineIndex(buffer){const newline=10;const carriage=13;for(let i=0;i<buffer.length-1;i++){if(buffer[i]===newline&&buffer[i+1]===newline){return i+2}if(buffer[i]===carriage&&buffer[i+1]===carriage){return i+2}if(buffer[i]===carriage&&buffer[i+1]===newline&&i+3<buffer.length&&buffer[i+2]===carriage&&buffer[i+3]===newline){return i+4}}return-1}function ReadableStreamToAsyncIterable(stream){if(stream[Symbol.asyncIterator])return stream;const reader=stream.getReader();return{async next(){try{const result=await reader.read();if(result==null?void 0:result.done)reader.releaseLock();return result}catch(e){reader.releaseLock();throw e}},async return(){const cancelPromise=reader.cancel();reader.releaseLock();await cancelPromise;return{done:true,value:void 0}},[Symbol.asyncIterator](){return this}}}class Stream{constructor(iterator,controller){this.iterator=iterator;this.controller=controller}static fromSSEResponse(response,controller){let consumed=false;async function*iterator(){if(consumed){throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.")}consumed=true;let done=false;try{for await(const sse of _iterSSEMessages(response,controller)){if(done)continue;if(sse.data.startsWith("[DONE]")){done=true;continue}if(sse.event===null||sse.event.startsWith("response.")||sse.event.startsWith("transcript.")){let data;try{data=JSON.parse(sse.data)}catch(e){console.error(`Could not parse message into JSON:`,sse.data);console.error(`From chunk:`,sse.raw);throw e}if(data&&data.error){throw new APIError(void 0,data.error,void 0,createResponseHeaders(response.headers))}yield data}else{let data;try{data=JSON.parse(sse.data)}catch(e){console.error(`Could not parse message into JSON:`,sse.data);console.error(`From chunk:`,sse.raw);throw e}if(sse.event=="error"){throw new APIError(void 0,data.error,data.message,void 0)}yield{event:sse.event,data:data}}}done=true}catch(e){if(e instanceof Error&&e.name==="AbortError")return;throw e}finally{if(!done)controller.abort()}}return new Stream(iterator,controller)}static fromReadableStream(readableStream,controller){let consumed=false;async function*iterLines(){const lineDecoder=new LineDecoder;const iter=ReadableStreamToAsyncIterable(readableStream);for await(const chunk of iter){for(const line of lineDecoder.decode(chunk)){yield line}}for(const line of lineDecoder.flush()){yield line}}async function*iterator(){if(consumed){throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.")}consumed=true;let done=false;try{for await(const line of iterLines()){if(done)continue;if(line)yield JSON.parse(line)}done=true}catch(e){if(e instanceof Error&&e.name==="AbortError")return;throw e}finally{if(!done)controller.abort()}}return new Stream(iterator,controller)}[Symbol.asyncIterator](){return this.iterator()}tee(){const left=[];const right=[];const iterator=this.iterator();const teeIterator=queue=>({next:()=>{if(queue.length===0){const result=iterator.next();left.push(result);right.push(result)}return queue.shift()}});return[new Stream(()=>teeIterator(left),this.controller),new Stream(()=>teeIterator(right),this.controller)]}toReadableStream(){const self2=this;let iter;const encoder=new TextEncoder;return new ReadableStream$1({async start(){iter=self2[Symbol.asyncIterator]()},async pull(ctrl){try{const{value:value,done:done}=await iter.next();if(done)return ctrl.close();const bytes=encoder.encode(JSON.stringify(value)+"\n");ctrl.enqueue(bytes)}catch(err){ctrl.error(err)}},async cancel(){var _a2;await((_a2=iter.return)==null?void 0:_a2.call(iter))}})}}async function*_iterSSEMessages(response,controller){if(!response.body){controller.abort();throw new OpenAIError(`Attempted to iterate over a response with no body`)}const sseDecoder=new SSEDecoder;const lineDecoder=new LineDecoder;const iter=ReadableStreamToAsyncIterable(response.body);for await(const sseChunk of iterSSEChunks(iter)){for(const line of lineDecoder.decode(sseChunk)){const sse=sseDecoder.decode(line);if(sse)yield sse}}for(const line of lineDecoder.flush()){const sse=sseDecoder.decode(line);if(sse)yield sse}}async function*iterSSEChunks(iterator){let data=new Uint8Array;for await(const chunk of iterator){if(chunk==null){continue}const binaryChunk=chunk instanceof ArrayBuffer?new Uint8Array(chunk):typeof chunk==="string"?(new TextEncoder).encode(chunk):chunk;let newData=new Uint8Array(data.length+binaryChunk.length);newData.set(data);newData.set(binaryChunk,data.length);data=newData;let patternIndex;while((patternIndex=findDoubleNewlineIndex(data))!==-1){yield data.slice(0,patternIndex);data=data.slice(patternIndex)}}if(data.length>0){yield data}}class SSEDecoder{constructor(){this.event=null;this.data=[];this.chunks=[]}decode(line){if(line.endsWith("\r")){line=line.substring(0,line.length-1)}if(!line){if(!this.event&&!this.data.length)return null;const sse={event:this.event,data:this.data.join("\n"),raw:this.chunks};this.event=null;this.data=[];this.chunks=[];return sse}this.chunks.push(line);if(line.startsWith(":")){return null}let[fieldname,_,value]=partition(line,":");if(value.startsWith(" ")){value=value.substring(1)}if(fieldname==="event"){this.event=value}else if(fieldname==="data"){this.data.push(value)}return null}}function partition(str2,delimiter){const index2=str2.indexOf(delimiter);if(index2!==-1){return[str2.substring(0,index2),delimiter,str2.substring(index2+delimiter.length)]}return[str2,"",""]}const isResponseLike=value=>value!=null&&typeof value==="object"&&typeof value.url==="string"&&typeof value.blob==="function";const isFileLike=value=>value!=null&&typeof value==="object"&&typeof value.name==="string"&&typeof value.lastModified==="number"&&isBlobLike(value);const isBlobLike=value=>value!=null&&typeof value==="object"&&typeof value.size==="number"&&typeof value.type==="string"&&typeof value.text==="function"&&typeof value.slice==="function"&&typeof value.arrayBuffer==="function";const isUploadable=value=>isFileLike(value)||isResponseLike(value)||isFsReadStream(value);async function toFile(value,name,options){var _a2;value=await value;if(isFileLike(value)){return value}if(isResponseLike(value)){const blob=await value.blob();name||(name=new URL(value.url).pathname.split(/[\\/]/).pop()??"unknown_file");const data=isBlobLike(blob)?[await blob.arrayBuffer()]:[blob];return new File$1(data,name,options)}const bits=await getBytes(value);name||(name=getName(value)??"unknown_file");if(!(options==null?void 0:options.type)){const type=(_a2=bits[0])==null?void 0:_a2.type;if(typeof type==="string"){options={...options,type:type}}}return new File$1(bits,name,options)}async function getBytes(value){var _a2;let parts=[];if(typeof value==="string"||ArrayBuffer.isView(value)||value instanceof ArrayBuffer){parts.push(value)}else if(isBlobLike(value)){parts.push(await value.arrayBuffer())}else if(isAsyncIterableIterator(value)){for await(const chunk of value){parts.push(chunk)}}else{throw new Error(`Unexpected data type: ${typeof value}; constructor: ${(_a2=value==null?void 0:value.constructor)==null?void 0:_a2.name}; props: ${propsForError(value)}`)}return parts}function propsForError(value){const props=Object.getOwnPropertyNames(value);return`[${props.map(p=>`"${p}"`).join(", ")}]`}function getName(value){var _a2;return getStringFromMaybeBuffer(value.name)||getStringFromMaybeBuffer(value.filename)||((_a2=getStringFromMaybeBuffer(value.path))==null?void 0:_a2.split(/[\\/]/).pop())}const getStringFromMaybeBuffer=x=>{if(typeof x==="string")return x;if(typeof Buffer2!=="undefined"&&x instanceof Buffer2)return String(x);return void 0};const isAsyncIterableIterator=value=>value!=null&&typeof value==="object"&&typeof value[Symbol.asyncIterator]==="function";const isMultipartBody=body=>body&&typeof body==="object"&&body.body&&body[Symbol.toStringTag]==="MultipartBody";const multipartFormRequestOptions=async opts=>{const form=await createForm(opts.body);return getMultipartRequestOptions(form,opts)};const createForm=async body=>{const form=new FormData$1;await Promise.all(Object.entries(body||{}).map(([key,value])=>addFormValue(form,key,value)));return form};const addFormValue=async(form,key,value)=>{if(value===void 0)return;if(value==null){throw new TypeError(`Received null for "${key}"; to pass null in FormData, you must use the string 'null'`)}if(typeof value==="string"||typeof value==="number"||typeof value==="boolean"){form.append(key,String(value))}else if(isUploadable(value)){const file=await toFile(value);form.append(key,file)}else if(Array.isArray(value)){await Promise.all(value.map(entry=>addFormValue(form,key+"[]",entry)))}else if(typeof value==="object"){await Promise.all(Object.entries(value).map(([name,prop2])=>addFormValue(form,`${key}[${name}]`,prop2)))}else{throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${value} instead`)}};var define_process_env_default={DEV_MODE:"true",NODE_ENV:'"development"'};var __classPrivateFieldSet$4=function(receiver,state2,value,kind2,f){if(typeof state2==="function"?receiver!==state2||true:!state2.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return state2.set(receiver,value),value};var __classPrivateFieldGet$5=function(receiver,state2,kind2,f){if(typeof state2==="function"?receiver!==state2||!f:!state2.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return kind2==="m"?f:kind2==="a"?f.call(receiver):f?f.value:state2.get(receiver)};var _AbstractPage_client;init();async function defaultParseResponse(props){var _a2;const{response:response}=props;if(props.options.stream){debug("response",response.status,response.url,response.headers,response.body);if(props.options.__streamClass){return props.options.__streamClass.fromSSEResponse(response,props.controller)}return Stream.fromSSEResponse(response,props.controller)}if(response.status===204){return null}if(props.options.__binaryResponse){return response}const contentType=response.headers.get("content-type");const mediaType=(_a2=contentType==null?void 0:contentType.split(";")[0])==null?void 0:_a2.trim();const isJSON=(mediaType==null?void 0:mediaType.includes("application/json"))||(mediaType==null?void 0:mediaType.endsWith("+json"));if(isJSON){const json=await response.json();debug("response",response.status,response.url,response.headers,json);return _addRequestID(json,response)}const text2=await response.text();debug("response",response.status,response.url,response.headers,text2);return text2}function _addRequestID(value,response){if(!value||typeof value!=="object"||Array.isArray(value)){return value}return Object.defineProperty(value,"_request_id",{value:response.headers.get("x-request-id"),enumerable:false})}class APIPromise extends Promise{constructor(responsePromise,parseResponse2=defaultParseResponse){super(resolve=>{resolve(null)});this.responsePromise=responsePromise;this.parseResponse=parseResponse2}_thenUnwrap(transform){return new APIPromise(this.responsePromise,async props=>_addRequestID(transform(await this.parseResponse(props),props),props.response))}asResponse(){return this.responsePromise.then(p=>p.response)}async withResponse(){const[data,response]=await Promise.all([this.parse(),this.asResponse()]);return{data:data,response:response,request_id:response.headers.get("x-request-id")}}parse(){if(!this.parsedPromise){this.parsedPromise=this.responsePromise.then(this.parseResponse)}return this.parsedPromise}then(onfulfilled,onrejected){return this.parse().then(onfulfilled,onrejected)}catch(onrejected){return this.parse().catch(onrejected)}finally(onfinally){return this.parse().finally(onfinally)}}class APIClient{constructor({baseURL:baseURL,maxRetries:maxRetries=2,timeout:timeout=6e5,httpAgent:httpAgent,fetch:overriddenFetch}){this.baseURL=baseURL;this.maxRetries=validatePositiveInteger("maxRetries",maxRetries);this.timeout=validatePositiveInteger("timeout",timeout);this.httpAgent=httpAgent;this.fetch=overriddenFetch??fetch$1}authHeaders(opts){return{}}defaultHeaders(opts){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...getPlatformHeaders(),...this.authHeaders(opts)}}validateHeaders(headers,customHeaders){}defaultIdempotencyKey(){return`stainless-node-retry-${uuid4()}`}get(path,opts){return this.methodRequest("get",path,opts)}post(path,opts){return this.methodRequest("post",path,opts)}patch(path,opts){return this.methodRequest("patch",path,opts)}put(path,opts){return this.methodRequest("put",path,opts)}delete(path,opts){return this.methodRequest("delete",path,opts)}methodRequest(method,path,opts){return this.request(Promise.resolve(opts).then(async opts2=>{const body=opts2&&isBlobLike(opts2==null?void 0:opts2.body)?new DataView(await opts2.body.arrayBuffer()):(opts2==null?void 0:opts2.body)instanceof DataView?opts2.body:(opts2==null?void 0:opts2.body)instanceof ArrayBuffer?new DataView(opts2.body):opts2&&ArrayBuffer.isView(opts2==null?void 0:opts2.body)?new DataView(opts2.body.buffer):opts2==null?void 0:opts2.body;return{method:method,path:path,...opts2,body:body}}))}getAPIList(path,Page2,opts){return this.requestAPIList(Page2,{method:"get",path:path,...opts})}calculateContentLength(body){if(typeof body==="string"){if(typeof Buffer2!=="undefined"){return Buffer2.byteLength(body,"utf8").toString()}if(typeof TextEncoder!=="undefined"){const encoder=new TextEncoder;const encoded=encoder.encode(body);return encoded.length.toString()}}else if(ArrayBuffer.isView(body)){return body.byteLength.toString()}return null}buildRequest(inputOptions,{retryCount:retryCount=0}={}){var _a2;const options={...inputOptions};const{method:method,path:path,query:query,headers:headers={}}=options;const body=ArrayBuffer.isView(options.body)||options.__binaryRequest&&typeof options.body==="string"?options.body:isMultipartBody(options.body)?options.body.body:options.body?JSON.stringify(options.body,null,2):null;const contentLength=this.calculateContentLength(body);const url=this.buildURL(path,query);if("timeout"in options)validatePositiveInteger("timeout",options.timeout);options.timeout=options.timeout??this.timeout;const httpAgent=options.httpAgent??this.httpAgent??getDefaultAgent(url);const minAgentTimeout=options.timeout+1e3;if(typeof((_a2=httpAgent==null?void 0:httpAgent.options)==null?void 0:_a2.timeout)==="number"&&minAgentTimeout>(httpAgent.options.timeout??0)){httpAgent.options.timeout=minAgentTimeout}if(this.idempotencyHeader&&method!=="get"){if(!inputOptions.idempotencyKey)inputOptions.idempotencyKey=this.defaultIdempotencyKey();headers[this.idempotencyHeader]=inputOptions.idempotencyKey}const reqHeaders=this.buildHeaders({options:options,headers:headers,contentLength:contentLength,retryCount:retryCount});const req={method:method,...body&&{body:body},headers:reqHeaders,...httpAgent&&{agent:httpAgent},signal:options.signal??null};return{req:req,url:url,timeout:options.timeout}}buildHeaders({options:options,headers:headers,contentLength:contentLength,retryCount:retryCount}){const reqHeaders={};if(contentLength){reqHeaders["content-length"]=contentLength}const defaultHeaders=this.defaultHeaders(options);applyHeadersMut(reqHeaders,defaultHeaders);applyHeadersMut(reqHeaders,headers);if(isMultipartBody(options.body)&&kind!=="node"){delete reqHeaders["content-type"]}if(getHeader(defaultHeaders,"x-stainless-retry-count")===void 0&&getHeader(headers,"x-stainless-retry-count")===void 0){reqHeaders["x-stainless-retry-count"]=String(retryCount)}if(getHeader(defaultHeaders,"x-stainless-timeout")===void 0&&getHeader(headers,"x-stainless-timeout")===void 0&&options.timeout){reqHeaders["x-stainless-timeout"]=String(Math.trunc(options.timeout/1e3))}this.validateHeaders(reqHeaders,headers);return reqHeaders}async prepareOptions(options){}async prepareRequest(request,{url:url,options:options}){}parseHeaders(headers){return!headers?{}:Symbol.iterator in headers?Object.fromEntries(Array.from(headers).map(header=>[...header])):{...headers}}makeStatusError(status,error,message,headers){return APIError.generate(status,error,message,headers)}request(options,remainingRetries=null){return new APIPromise(this.makeRequest(options,remainingRetries))}async makeRequest(optionsInput,retriesRemaining){var _a2,_b;const options=await optionsInput;const maxRetries=options.maxRetries??this.maxRetries;if(retriesRemaining==null){retriesRemaining=maxRetries}await this.prepareOptions(options);const{req:req,url:url,timeout:timeout}=this.buildRequest(options,{retryCount:maxRetries-retriesRemaining});await this.prepareRequest(req,{url:url,options:options});debug("request",url,options,req.headers);if((_a2=options.signal)==null?void 0:_a2.aborted){throw new APIUserAbortError}const controller=new AbortController;const response=await this.fetchWithTimeout(url,req,timeout,controller).catch(castToError);if(response instanceof Error){if((_b=options.signal)==null?void 0:_b.aborted){throw new APIUserAbortError}if(retriesRemaining){return this.retryRequest(options,retriesRemaining)}if(response.name==="AbortError"){throw new APIConnectionTimeoutError}throw new APIConnectionError({cause:response})}const responseHeaders=createResponseHeaders(response.headers);if(!response.ok){if(retriesRemaining&&this.shouldRetry(response)){const retryMessage2=`retrying, ${retriesRemaining} attempts remaining`;debug(`response (error; ${retryMessage2})`,response.status,url,responseHeaders);return this.retryRequest(options,retriesRemaining,responseHeaders)}const errText=await response.text().catch(e=>castToError(e).message);const errJSON=safeJSON(errText);const errMessage=errJSON?void 0:errText;const retryMessage=retriesRemaining?`(error; no more retries left)`:`(error; not retryable)`;debug(`response (error; ${retryMessage})`,response.status,url,responseHeaders,errMessage);const err=this.makeStatusError(response.status,errJSON,errMessage,responseHeaders);throw err}return{response:response,options:options,controller:controller}}requestAPIList(Page2,options){const request=this.makeRequest(options,null);return new PagePromise(this,request,Page2)}buildURL(path,query){const url=isAbsoluteURL(path)?new URL(path):new URL(this.baseURL+(this.baseURL.endsWith("/")&&path.startsWith("/")?path.slice(1):path));const defaultQuery=this.defaultQuery();if(!isEmptyObj(defaultQuery)){query={...defaultQuery,...query}}if(typeof query==="object"&&query&&!Array.isArray(query)){url.search=this.stringifyQuery(query)}return url.toString()}stringifyQuery(query){return Object.entries(query).filter(([_,value])=>typeof value!=="undefined").map(([key,value])=>{if(typeof value==="string"||typeof value==="number"||typeof value==="boolean"){return`${encodeURIComponent(key)}=${encodeURIComponent(value)}`}if(value===null){return`${encodeURIComponent(key)}=`}throw new OpenAIError(`Cannot stringify type ${typeof value}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(url,init2,ms,controller){const{signal:signal,...options}=init2||{};if(signal)signal.addEventListener("abort",()=>controller.abort());const timeout=setTimeout(()=>controller.abort(),ms);const fetchOptions={signal:controller.signal,...options};if(fetchOptions.method){fetchOptions.method=fetchOptions.method.toUpperCase()}return this.fetch.call(void 0,url,fetchOptions).finally(()=>{clearTimeout(timeout)})}shouldRetry(response){const shouldRetryHeader=response.headers.get("x-should-retry");if(shouldRetryHeader==="true")return true;if(shouldRetryHeader==="false")return false;if(response.status===408)return true;if(response.status===409)return true;if(response.status===429)return true;if(response.status>=500)return true;return false}async retryRequest(options,retriesRemaining,responseHeaders){let timeoutMillis;const retryAfterMillisHeader=responseHeaders==null?void 0:responseHeaders["retry-after-ms"];if(retryAfterMillisHeader){const timeoutMs=parseFloat(retryAfterMillisHeader);if(!Number.isNaN(timeoutMs)){timeoutMillis=timeoutMs}}const retryAfterHeader=responseHeaders==null?void 0:responseHeaders["retry-after"];if(retryAfterHeader&&!timeoutMillis){const timeoutSeconds=parseFloat(retryAfterHeader);if(!Number.isNaN(timeoutSeconds)){timeoutMillis=timeoutSeconds*1e3}else{timeoutMillis=Date.parse(retryAfterHeader)-Date.now()}}if(!(timeoutMillis&&0<=timeoutMillis&&timeoutMillis<60*1e3)){const maxRetries=options.maxRetries??this.maxRetries;timeoutMillis=this.calculateDefaultRetryTimeoutMillis(retriesRemaining,maxRetries)}await sleep(timeoutMillis);return this.makeRequest(options,retriesRemaining-1)}calculateDefaultRetryTimeoutMillis(retriesRemaining,maxRetries){const initialRetryDelay=.5;const maxRetryDelay=8;const numRetries=maxRetries-retriesRemaining;const sleepSeconds=Math.min(initialRetryDelay*Math.pow(2,numRetries),maxRetryDelay);const jitter=1-Math.random()*.25;return sleepSeconds*jitter*1e3}getUserAgent(){return`${this.constructor.name}/JS ${VERSION}`}}class AbstractPage{constructor(client,response,body,options){_AbstractPage_client.set(this,void 0);__classPrivateFieldSet$4(this,_AbstractPage_client,client);this.options=options;this.response=response;this.body=body}hasNextPage(){const items=this.getPaginatedItems();if(!items.length)return false;return this.nextPageInfo()!=null}async getNextPage(){const nextInfo=this.nextPageInfo();if(!nextInfo){throw new OpenAIError("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.")}const nextOptions={...this.options};if("params"in nextInfo&&typeof nextOptions.query==="object"){nextOptions.query={...nextOptions.query,...nextInfo.params}}else if("url"in nextInfo){const params=[...Object.entries(nextOptions.query||{}),...nextInfo.url.searchParams.entries()];for(const[key,value]of params){nextInfo.url.searchParams.set(key,value)}nextOptions.query=void 0;nextOptions.path=nextInfo.url.toString()}return await __classPrivateFieldGet$5(this,_AbstractPage_client,"f").requestAPIList(this.constructor,nextOptions)}async*iterPages(){let page=this;yield page;while(page.hasNextPage()){page=await page.getNextPage();yield page}}async*[(_AbstractPage_client=new WeakMap,Symbol.asyncIterator)](){for await(const page of this.iterPages()){for(const item of page.getPaginatedItems()){yield item}}}}class PagePromise extends APIPromise{constructor(client,request,Page2){super(request,async props=>new Page2(client,props.response,await defaultParseResponse(props),props.options))}async*[Symbol.asyncIterator](){const page=await(this);for await(const item of page){yield item}}}const createResponseHeaders=headers=>new Proxy(Object.fromEntries(headers.entries()),{get(target,name){const key=name.toString();return target[key.toLowerCase()]||target[key]}});const requestOptionsKeys={method:true,path:true,query:true,body:true,headers:true,maxRetries:true,stream:true,timeout:true,httpAgent:true,signal:true,idempotencyKey:true,__metadata:true,__binaryRequest:true,__binaryResponse:true,__streamClass:true};const isRequestOptions=obj=>typeof obj==="object"&&obj!==null&&!isEmptyObj(obj)&&Object.keys(obj).every(k=>hasOwn(requestOptionsKeys,k));const getPlatformProperties=()=>{var _a2;if(typeof Deno!=="undefined"&&Deno.build!=null){return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":VERSION,"X-Stainless-OS":normalizePlatform(Deno.build.os),"X-Stainless-Arch":normalizeArch(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version==="string"?Deno.version:((_a2=Deno.version)==null?void 0:_a2.deno)??"unknown"}}if(typeof EdgeRuntime!=="undefined"){return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process$1.version}}if(Object.prototype.toString.call(typeof process$1!=="undefined"?process$1:0)==="[object process]"){return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":VERSION,"X-Stainless-OS":normalizePlatform(process$1.platform),"X-Stainless-Arch":normalizeArch(process$1.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process$1.version}}const browserInfo=getBrowserInfo();if(browserInfo){return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${browserInfo.browser}`,"X-Stainless-Runtime-Version":browserInfo.version}}return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function getBrowserInfo(){if(typeof navigator==="undefined"||!navigator){return null}const browserPatterns=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:key,pattern:pattern}of browserPatterns){const match=pattern.exec(navigator.userAgent);if(match){const major=match[1]||0;const minor=match[2]||0;const patch=match[3]||0;return{browser:key,version:`${major}.${minor}.${patch}`}}}return null}const normalizeArch=arch=>{if(arch==="x32")return"x32";if(arch==="x86_64"||arch==="x64")return"x64";if(arch==="arm")return"arm";if(arch==="aarch64"||arch==="arm64")return"arm64";if(arch)return`other:${arch}`;return"unknown"};const normalizePlatform=platform=>{platform=platform.toLowerCase();if(platform.includes("ios"))return"iOS";if(platform==="android")return"Android";if(platform==="darwin")return"MacOS";if(platform==="win32")return"Windows";if(platform==="freebsd")return"FreeBSD";if(platform==="openbsd")return"OpenBSD";if(platform==="linux")return"Linux";if(platform)return`Other:${platform}`;return"Unknown"};let _platformHeaders;const getPlatformHeaders=()=>_platformHeaders??(_platformHeaders=getPlatformProperties());const safeJSON=text2=>{try{return JSON.parse(text2)}catch(err){return void 0}};const startsWithSchemeRegexp=/^[a-z][a-z0-9+.-]*:/i;const isAbsoluteURL=url=>startsWithSchemeRegexp.test(url);const sleep=ms=>new Promise(resolve=>setTimeout(resolve,ms));const validatePositiveInteger=(name,n)=>{if(typeof n!=="number"||!Number.isInteger(n)){throw new OpenAIError(`${name} must be an integer`)}if(n<0){throw new OpenAIError(`${name} must be a positive integer`)}return n};const castToError=err=>{if(err instanceof Error)return err;if(typeof err==="object"&&err!==null){try{return new Error(JSON.stringify(err))}catch{}}return new Error(err)};const readEnv=env=>{var _a2,_b,_c,_d;if(typeof process$1!=="undefined"){return((_a2=define_process_env_default==null?void 0:define_process_env_default[env])==null?void 0:_a2.trim())??void 0}if(typeof Deno!=="undefined"){return(_d=(_c=(_b=Deno.env)==null?void 0:_b.get)==null?void 0:_c.call(_b,env))==null?void 0:_d.trim()}return void 0};function isEmptyObj(obj){if(!obj)return true;for(const _k in obj)return false;return true}function hasOwn(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)}function applyHeadersMut(targetHeaders,newHeaders){for(const k in newHeaders){if(!hasOwn(newHeaders,k))continue;const lowerKey=k.toLowerCase();if(!lowerKey)continue;const val=newHeaders[k];if(val===null){delete targetHeaders[lowerKey]}else if(val!==void 0){targetHeaders[lowerKey]=val}}}const SENSITIVE_HEADERS=new Set(["authorization","api-key"]);function debug(action2,...args){if(typeof process$1!=="undefined"&&(define_process_env_default==null?void 0:define_process_env_default["DEBUG"])==="true"){const modifiedArgs=args.map(arg=>{if(!arg){return arg}if(arg["headers"]){const modifiedArg2={...arg,headers:{...arg["headers"]}};for(const header in arg["headers"]){if(SENSITIVE_HEADERS.has(header.toLowerCase())){modifiedArg2["headers"][header]="REDACTED"}}return modifiedArg2}let modifiedArg=null;for(const header in arg){if(SENSITIVE_HEADERS.has(header.toLowerCase())){modifiedArg??(modifiedArg={...arg});modifiedArg[header]="REDACTED"}}return modifiedArg??arg});console.log(`OpenAI:DEBUG:${action2}`,...modifiedArgs)}}const uuid4=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,c=>{const r=Math.random()*16|0;const v=c==="x"?r:r&3|8;return v.toString(16)});const isRunningInBrowser=()=>typeof window!=="undefined"&&typeof window.document!=="undefined"&&typeof navigator!=="undefined";const isHeadersProtocol=headers=>typeof(headers==null?void 0:headers.get)==="function";const getHeader=(headers,header)=>{var _a2;const lowerCasedHeader=header.toLowerCase();if(isHeadersProtocol(headers)){const intercapsHeader=((_a2=header[0])==null?void 0:_a2.toUpperCase())+header.substring(1).replace(/([^\w])(\w)/g,(_m,g1,g2)=>g1+g2.toUpperCase());for(const key of[header,lowerCasedHeader,header.toUpperCase(),intercapsHeader]){const value=headers.get(key);if(value){return value}}}for(const[key,value]of Object.entries(headers)){if(key.toLowerCase()===lowerCasedHeader){if(Array.isArray(value)){if(value.length<=1)return value[0];console.warn(`Received ${value.length} entries for the ${header} header, using the first entry.`);return value[0]}return value}}return void 0};const toFloat32Array=base64Str=>{if(typeof Buffer2!=="undefined"){const buf=Buffer2.from(base64Str,"base64");return Array.from(new Float32Array(buf.buffer,buf.byteOffset,buf.length/Float32Array.BYTES_PER_ELEMENT))}else{const binaryStr=atob(base64Str);const len=binaryStr.length;const bytes=new Uint8Array(len);for(let i=0;i<len;i++){bytes[i]=binaryStr.charCodeAt(i)}return Array.from(new Float32Array(bytes.buffer))}};function isObj(obj){return obj!=null&&typeof obj==="object"&&!Array.isArray(obj)}class Page extends AbstractPage{constructor(client,response,body,options){super(client,response,body,options);this.data=body.data||[];this.object=body.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class CursorPage extends AbstractPage{constructor(client,response,body,options){super(client,response,body,options);this.data=body.data||[];this.has_more=body.has_more||false}getPaginatedItems(){return this.data??[]}hasNextPage(){if(this.has_more===false){return false}return super.hasNextPage()}nextPageParams(){const info=this.nextPageInfo();if(!info)return null;if("params"in info)return info.params;const params=Object.fromEntries(info.url.searchParams);if(!Object.keys(params).length)return null;return params}nextPageInfo(){var _a2;const data=this.getPaginatedItems();if(!data.length){return null}const id=(_a2=data[data.length-1])==null?void 0:_a2.id;if(!id){return null}return{params:{after:id}}}}class APIResource{constructor(client){this._client=client}}let Messages$1=class Messages extends APIResource{list(completionId,query={},options){if(isRequestOptions(query)){return this.list(completionId,{},query)}return this._client.getAPIList(`/chat/completions/${completionId}/messages`,ChatCompletionStoreMessagesPage,{query:query,...options})}};let Completions$2=class Completions extends APIResource{constructor(){super(...arguments);this.messages=new Messages$1(this._client)}create(body,options){return this._client.post("/chat/completions",{body:body,...options,stream:body.stream??false})}retrieve(completionId,options){return this._client.get(`/chat/completions/${completionId}`,options)}update(completionId,body,options){return this._client.post(`/chat/completions/${completionId}`,{body:body,...options})}list(query={},options){if(isRequestOptions(query)){return this.list({},query)}return this._client.getAPIList("/chat/completions",ChatCompletionsPage,{query:query,...options})}del(completionId,options){return this._client.delete(`/chat/completions/${completionId}`,options)}};class ChatCompletionsPage extends CursorPage{}class ChatCompletionStoreMessagesPage extends CursorPage{}Completions$2.ChatCompletionsPage=ChatCompletionsPage;Completions$2.Messages=Messages$1;let Chat$1=class Chat extends APIResource{constructor(){super(...arguments);this.completions=new Completions$2(this._client)}};Chat$1.Completions=Completions$2;Chat$1.ChatCompletionsPage=ChatCompletionsPage;class Speech extends APIResource{create(body,options){return this._client.post("/audio/speech",{body:body,...options,headers:{Accept:"application/octet-stream",...options==null?void 0:options.headers},__binaryResponse:true})}}class Transcriptions extends APIResource{create(body,options){return this._client.post("/audio/transcriptions",multipartFormRequestOptions({body:body,...options,stream:body.stream??false,__metadata:{model:body.model}}))}}class Translations extends APIResource{create(body,options){return this._client.post("/audio/translations",multipartFormRequestOptions({body:body,...options,__metadata:{model:body.model}}))}}class Audio extends APIResource{constructor(){super(...arguments);this.transcriptions=new Transcriptions(this._client);this.translations=new Translations(this._client);this.speech=new Speech(this._client)}}Audio.Transcriptions=Transcriptions;Audio.Translations=Translations;Audio.Speech=Speech;class Batches extends APIResource{create(body,options){return this._client.post("/batches",{body:body,...options})}retrieve(batchId,options){return this._client.get(`/batches/${batchId}`,options)}list(query={},options){if(isRequestOptions(query)){return this.list({},query)}return this._client.getAPIList("/batches",BatchesPage,{query:query,...options})}cancel(batchId,options){return this._client.post(`/batches/${batchId}/cancel`,options)}}class BatchesPage extends CursorPage{}Batches.BatchesPage=BatchesPage;var __classPrivateFieldSet$3=function(receiver,state2,value,kind2,f){if(kind2==="m")throw new TypeError("Private method is not writable");if(kind2==="a"&&!f)throw new TypeError("Private accessor was defined without a setter");if(typeof state2==="function"?receiver!==state2||!f:!state2.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return kind2==="a"?f.call(receiver,value):f?f.value=value:state2.set(receiver,value),value};var __classPrivateFieldGet$4=function(receiver,state2,kind2,f){if(kind2==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof state2==="function"?receiver!==state2||!f:!state2.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return kind2==="m"?f:kind2==="a"?f.call(receiver):f?f.value:state2.get(receiver)};var _EventStream_instances,_EventStream_connectedPromise,_EventStream_resolveConnectedPromise,_EventStream_rejectConnectedPromise,_EventStream_endPromise,_EventStream_resolveEndPromise,_EventStream_rejectEndPromise,_EventStream_listeners,_EventStream_ended,_EventStream_errored,_EventStream_aborted,_EventStream_catchingPromiseCreated,_EventStream_handleError;class EventStream{constructor(){_EventStream_instances.add(this);this.controller=new AbortController;_EventStream_connectedPromise.set(this,void 0);_EventStream_resolveConnectedPromise.set(this,()=>{});_EventStream_rejectConnectedPromise.set(this,()=>{});_EventStream_endPromise.set(this,void 0);_EventStream_resolveEndPromise.set(this,()=>{});_EventStream_rejectEndPromise.set(this,()=>{});_EventStream_listeners.set(this,{});_EventStream_ended.set(this,false);_EventStream_errored.set(this,false);_EventStream_aborted.set(this,false);_EventStream_catchingPromiseCreated.set(this,false);__classPrivateFieldSet$3(this,_EventStream_connectedPromise,new Promise((resolve,reject)=>{__classPrivateFieldSet$3(this,_EventStream_resolveConnectedPromise,resolve,"f");__classPrivateFieldSet$3(this,_EventStream_rejectConnectedPromise,reject,"f")}),"f");__classPrivateFieldSet$3(this,_EventStream_endPromise,new Promise((resolve,reject)=>{__classPrivateFieldSet$3(this,_EventStream_resolveEndPromise,resolve,"f");__classPrivateFieldSet$3(this,_EventStream_rejectEndPromise,reject,"f")}),"f");__classPrivateFieldGet$4(this,_EventStream_connectedPromise,"f").catch(()=>{});__classPrivateFieldGet$4(this,_EventStream_endPromise,"f").catch(()=>{})}_run(executor){setTimeout(()=>{executor().then(()=>{this._emitFinal();this._emit("end")},__classPrivateFieldGet$4(this,_EventStream_instances,"m",_EventStream_handleError).bind(this))},0)}_connected(){if(this.ended)return;__classPrivateFieldGet$4(this,_EventStream_resolveConnectedPromise,"f").call(this);this._emit("connect")}get ended(){return __classPrivateFieldGet$4(this,_EventStream_ended,"f")}get errored(){return __classPrivateFieldGet$4(this,_EventStream_errored,"f")}get aborted(){return __classPrivateFieldGet$4(this,_EventStream_aborted,"f")}abort(){this.controller.abort()}on(event2,listener){const listeners=__classPrivateFieldGet$4(this,_EventStream_listeners,"f")[event2]||(__classPrivateFieldGet$4(this,_EventStream_listeners,"f")[event2]=[]);listeners.push({listener:listener});return this}off(event2,listener){const listeners=__classPrivateFieldGet$4(this,_EventStream_listeners,"f")[event2];if(!listeners)return this;const index2=listeners.findIndex(l=>l.listener===listener);if(index2>=0)listeners.splice(index2,1);return this}once(event2,listener){const listeners=__classPrivateFieldGet$4(this,_EventStream_listeners,"f")[event2]||(__classPrivateFieldGet$4(this,_EventStream_listeners,"f")[event2]=[]);listeners.push({listener:listener,once:true});return this}emitted(event2){return new Promise((resolve,reject)=>{__classPrivateFieldSet$3(this,_EventStream_catchingPromiseCreated,true,"f");if(event2!=="error")this.once("error",reject);this.once(event2,resolve)})}async done(){__classPrivateFieldSet$3(this,_EventStream_catchingPromiseCreated,true,"f");await __classPrivateFieldGet$4(this,_EventStream_endPromise,"f")}_emit(event2,...args){if(__classPrivateFieldGet$4(this,_EventStream_ended,"f")){return}if(event2==="end"){__classPrivateFieldSet$3(this,_EventStream_ended,true,"f");__classPrivateFieldGet$4(this,_EventStream_resolveEndPromise,"f").call(this)}const listeners=__classPrivateFieldGet$4(this,_EventStream_listeners,"f")[event2];if(listeners){__classPrivateFieldGet$4(this,_EventStream_listeners,"f")[event2]=listeners.filter(l=>!l.once);listeners.forEach(({listener:listener})=>listener(...args))}if(event2==="abort"){const error=args[0];if(!__classPrivateFieldGet$4(this,_EventStream_catchingPromiseCreated,"f")&&!(listeners==null?void 0:listeners.length)){Promise.reject(error)}__classPrivateFieldGet$4(this,_EventStream_rejectConnectedPromise,"f").call(this,error);__classPrivateFieldGet$4(this,_EventStream_rejectEndPromise,"f").call(this,error);this._emit("end");return}if(event2==="error"){const error=args[0];if(!__classPrivateFieldGet$4(this,_EventStream_catchingPromiseCreated,"f")&&!(listeners==null?void 0:listeners.length)){Promise.reject(error)}__classPrivateFieldGet$4(this,_EventStream_rejectConnectedPromise,"f").call(this,error);__classPrivateFieldGet$4(this,_EventStream_rejectEndPromise,"f").call(this,error);this._emit("end")}}_emitFinal(){}}_EventStream_connectedPromise=new WeakMap,_EventStream_resolveConnectedPromise=new WeakMap,_EventStream_rejectConnectedPromise=new WeakMap,_EventStream_endPromise=new WeakMap,_EventStream_resolveEndPromise=new WeakMap,_EventStream_rejectEndPromise=new WeakMap,_EventStream_listeners=new WeakMap,_EventStream_ended=new WeakMap,_EventStream_errored=new WeakMap,_EventStream_aborted=new WeakMap,_EventStream_catchingPromiseCreated=new WeakMap,_EventStream_instances=new WeakSet,_EventStream_handleError=function _EventStream_handleError2(error){__classPrivateFieldSet$3(this,_EventStream_errored,true,"f");if(error instanceof Error&&error.name==="AbortError"){error=new APIUserAbortError}if(error instanceof APIUserAbortError){__classPrivateFieldSet$3(this,_EventStream_aborted,true,"f");return this._emit("abort",error)}if(error instanceof OpenAIError){return this._emit("error",error)}if(error instanceof Error){const openAIError=new OpenAIError(error.message);openAIError.cause=error;return this._emit("error",openAIError)}return this._emit("error",new OpenAIError(String(error)))};var __classPrivateFieldGet$3=function(receiver,state2,kind2,f){if(kind2==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof state2==="function"?receiver!==state2||!f:!state2.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return kind2==="m"?f:kind2==="a"?f.call(receiver):f?f.value:state2.get(receiver)};var __classPrivateFieldSet$2=function(receiver,state2,value,kind2,f){if(kind2==="m")throw new TypeError("Private method is not writable");if(kind2==="a"&&!f)throw new TypeError("Private accessor was defined without a setter");if(typeof state2==="function"?receiver!==state2||!f:!state2.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return kind2==="a"?f.call(receiver,value):f?f.value=value:state2.set(receiver,value),value};var _AssistantStream_instances,_AssistantStream_events,_AssistantStream_runStepSnapshots,_AssistantStream_messageSnapshots,_AssistantStream_messageSnapshot,_AssistantStream_finalRun,_AssistantStream_currentContentIndex,_AssistantStream_currentContent,_AssistantStream_currentToolCallIndex,_AssistantStream_currentToolCall,_AssistantStream_currentEvent,_AssistantStream_currentRunSnapshot,_AssistantStream_currentRunStepSnapshot,_AssistantStream_addEvent,_AssistantStream_endRequest,_AssistantStream_handleMessage,_AssistantStream_handleRunStep,_AssistantStream_handleEvent,_AssistantStream_accumulateRunStep,_AssistantStream_accumulateMessage,_AssistantStream_accumulateContent,_AssistantStream_handleRun;class AssistantStream extends EventStream{constructor(){super(...arguments);_AssistantStream_instances.add(this);_AssistantStream_events.set(this,[]);_AssistantStream_runStepSnapshots.set(this,{});_AssistantStream_messageSnapshots.set(this,{});_AssistantStream_messageSnapshot.set(this,void 0);_AssistantStream_finalRun.set(this,void 0);_AssistantStream_currentContentIndex.set(this,void 0);_AssistantStream_currentContent.set(this,void 0);_AssistantStream_currentToolCallIndex.set(this,void 0);_AssistantStream_currentToolCall.set(this,void 0);_AssistantStream_currentEvent.set(this,void 0);_AssistantStream_currentRunSnapshot.set(this,void 0);_AssistantStream_currentRunStepSnapshot.set(this,void 0)}[(_AssistantStream_events=new WeakMap,_AssistantStream_runStepSnapshots=new WeakMap,_AssistantStream_messageSnapshots=new WeakMap,_AssistantStream_messageSnapshot=new WeakMap,_AssistantStream_finalRun=new WeakMap,_AssistantStream_currentContentIndex=new WeakMap,_AssistantStream_currentContent=new WeakMap,_AssistantStream_currentToolCallIndex=new WeakMap,_AssistantStream_currentToolCall=new WeakMap,_AssistantStream_currentEvent=new WeakMap,_AssistantStream_currentRunSnapshot=new WeakMap,_AssistantStream_currentRunStepSnapshot=new WeakMap,_AssistantStream_instances=new WeakSet,Symbol.asyncIterator)](){const pushQueue=[];const readQueue=[];let done=false;this.on("event",event2=>{const reader=readQueue.shift();if(reader){reader.resolve(event2)}else{pushQueue.push(event2)}});this.on("end",()=>{done=true;for(const reader of readQueue){reader.resolve(void 0)}readQueue.length=0});this.on("abort",err=>{done=true;for(const reader of readQueue){reader.reject(err)}readQueue.length=0});this.on("error",err=>{done=true;for(const reader of readQueue){reader.reject(err)}readQueue.length=0});return{next:async()=>{if(!pushQueue.length){if(done){return{value:void 0,done:true}}return new Promise((resolve,reject)=>readQueue.push({resolve:resolve,reject:reject})).then(chunk2=>chunk2?{value:chunk2,done:false}:{value:void 0,done:true})}const chunk=pushQueue.shift();return{value:chunk,done:false}},return:async()=>{this.abort();return{value:void 0,done:true}}}}static fromReadableStream(stream){const runner=new AssistantStream;runner._run(()=>runner._fromReadableStream(stream));return runner}async _fromReadableStream(readableStream,options){var _a2;const signal=options==null?void 0:options.signal;if(signal){if(signal.aborted)this.controller.abort();signal.addEventListener("abort",()=>this.controller.abort())}this._connected();const stream=Stream.fromReadableStream(readableStream,this.controller);for await(const event2 of stream){__classPrivateFieldGet$3(this,_AssistantStream_instances,"m",_AssistantStream_addEvent).call(this,event2)}if((_a2=stream.controller.signal)==null?void 0:_a2.aborted){throw new APIUserAbortError}return this._addRun(__classPrivateFieldGet$3(this,_AssistantStream_instances,"m",_AssistantStream_endRequest).call(this))}toReadableStream(){const stream=new Stream(this[Symbol.asyncIterator].bind(this),this.controller);return stream.toReadableStream()}static createToolAssistantStream(threadId,runId,runs,params,options){const runner=new AssistantStream;runner._run(()=>runner._runToolAssistantStream(threadId,runId,runs,params,{...options,headers:{...options==null?void 0:options.headers,"X-Stainless-Helper-Method":"stream"}}));return runner}async _createToolAssistantStream(run,threadId,runId,params,options){var _a2;const signal=options==null?void 0:options.signal;if(signal){if(signal.aborted)this.controller.abort();signal.addEventListener("abort",()=>this.controller.abort())}const body={...params,stream:true};const stream=await run.submitToolOutputs(threadId,runId,body,{...options,signal:this.controller.signal});this._connected();for await(const event2 of stream){__classPrivateFieldGet$3(this,_AssistantStream_instances,"m",_AssistantStream_addEvent).call(this,event2)}if((_a2=stream.controller.signal)==null?void 0:_a2.aborted){throw new APIUserAbortError}return this._addRun(__classPrivateFieldGet$3(this,_AssistantStream_instances,"m",_AssistantStream_endRequest).call(this))}static createThreadAssistantStream(params,thread,options){const runner=new AssistantStream;runner._run(()=>runner._threadAssistantStream(params,thread,{...options,headers:{...options==null?void 0:options.headers,"X-Stainless-Helper-Method":"stream"}}));return runner}static createAssistantStream(threadId,runs,params,options){const runner=new AssistantStream;runner._run(()=>runner._runAssistantStream(threadId,runs,params,{...options,headers:{...options==null?void 0:options.headers,"X-Stainless-Helper-Method":"stream"}}));return runner}currentEvent(){return __classPrivateFieldGet$3(this,_AssistantStream_currentEvent,"f")}currentRun(){return __classPrivateFieldGet$3(this,_AssistantStream_currentRunSnapshot,"f")}currentMessageSnapshot(){return __classPrivateFieldGet$3(this,_AssistantStream_messageSnapshot,"f")}currentRunStepSnapshot(){return __classPrivateFieldGet$3(this,_AssistantStream_currentRunStepSnapshot,"f")}async finalRunSteps(){await this.done();return Object.values(__classPrivateFieldGet$3(this,_AssistantStream_runStepSnapshots,"f"))}async finalMessages(){await this.done();return Object.values(__classPrivateFieldGet$3(this,_AssistantStream_messageSnapshots,"f"))}async finalRun(){await this.done();if(!__classPrivateFieldGet$3(this,_AssistantStream_finalRun,"f"))throw Error("Final run was not received.");return __classPrivateFieldGet$3(this,_AssistantStream_finalRun,"f")}async _createThreadAssistantStream(thread,params,options){var _a2;const signal=options==null?void 0:options.signal;if(signal){if(signal.aborted)this.controller.abort();signal.addEventListener("abort",()=>this.controller.abort())}const body={...params,stream:true};const stream=await thread.createAndRun(body,{...options,signal:this.controller.signal});this._connected();for await(const event2 of stream){__classPrivateFieldGet$3(this,_AssistantStream_instances,"m",_AssistantStream_addEvent).call(this,event2)}if((_a2=stream.controller.signal)==null?void 0:_a2.aborted){throw new APIUserAbortError}return this._addRun(__classPrivateFieldGet$3(this,_AssistantStream_instances,"m",_AssistantStream_endRequest).call(this))}async _createAssistantStream(run,threadId,params,options){var _a2;const signal=options==null?void 0:options.signal;if(signal){if(signal.aborted)this.controller.abort();signal.addEventListener("abort",()=>this.controller.abort())}const body={...params,stream:true};const stream=await run.create(threadId,body,{...options,signal:this.controller.signal});this._connected();for await(const event2 of stream){__classPrivateFieldGet$3(this,_AssistantStream_instances,"m",_AssistantStream_addEvent).call(this,event2)}if((_a2=stream.controller.signal)==null?void 0:_a2.aborted){throw new APIUserAbortError}return this._addRun(__classPrivateFieldGet$3(this,_AssistantStream_instances,"m",_AssistantStream_endRequest).call(this))}static accumulateDelta(acc,delta){for(const[key,deltaValue]of Object.entries(delta)){if(!acc.hasOwnProperty(key)){acc[key]=deltaValue;continue}let accValue=acc[key];if(accValue===null||accValue===void 0){acc[key]=deltaValue;continue}if(key==="index"||key==="type"){acc[key]=deltaValue;continue}if(typeof accValue==="string"&&typeof deltaValue==="string"){accValue+=deltaValue}else if(typeof accValue==="number"&&typeof deltaValue==="number"){accValue+=deltaValue}else if(isObj(accValue)&&isObj(deltaValue)){accValue=this.accumulateDelta(accValue,deltaValue)}else if(Array.isArray(accValue)&&Array.isArray(deltaValue)){if(accValue.every(x=>typeof x==="string"||typeof x==="number")){accValue.push(...deltaValue);continue}for(const deltaEntry of deltaValue){if(!isObj(deltaEntry)){throw new Error(`Expected array delta entry to be an object but got: ${deltaEntry}`)}const index2=deltaEntry["index"];if(index2==null){console.error(deltaEntry);throw new Error("Expected array delta entry to have an `index` property")}if(typeof index2!=="number"){throw new Error(`Expected array delta entry \`index\` property to be a number but got ${index2}`)}const accEntry=accValue[index2];if(accEntry==null){accValue.push(deltaEntry)}else{accValue[index2]=this.accumulateDelta(accEntry,deltaEntry)}}continue}else{throw Error(`Unhandled record type: ${key}, deltaValue: ${deltaValue}, accValue: ${accValue}`)}acc[key]=accValue}return acc}_addRun(run){return run}async _threadAssistantStream(params,thread,options){return await this._createThreadAssistantStream(thread,params,options)}async _runAssistantStream(threadId,runs,params,options){return await this._createAssistantStream(runs,threadId,params,options)}async _runToolAssistantStream(threadId,runId,runs,params,options){return await this._createToolAssistantStream(runs,threadId,runId,params,options)}}_AssistantStream_addEvent=function _AssistantStream_addEvent2(event2){if(this.ended)return;__classPrivateFieldSet$2(this,_AssistantStream_currentEvent,event2,"f");__classPrivateFieldGet$3(this,_AssistantStream_instances,"m",_AssistantStream_handleEvent).call(this,event2);switch(event2.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":__classPrivateFieldGet$3(this,_AssistantStream_instances,"m",_AssistantStream_handleRun).call(this,event2);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":__classPrivateFieldGet$3(this,_AssistantStream_instances,"m",_AssistantStream_handleRunStep).call(this,event2);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":__classPrivateFieldGet$3(this,_AssistantStream_instances,"m",_AssistantStream_handleMessage).call(this,event2);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},_AssistantStream_endRequest=function _AssistantStream_endRequest2(){if(this.ended){throw new OpenAIError(`stream has ended, this shouldn't happen`)}if(!__classPrivateFieldGet$3(this,_AssistantStream_finalRun,"f"))throw Error("Final run has not been received");return __classPrivateFieldGet$3(this,_AssistantStream_finalRun,"f")},_AssistantStream_handleMessage=function _AssistantStream_handleMessage2(event2){const[accumulatedMessage,newContent]=__classPrivateFieldGet$3(this,_AssistantStream_instances,"m",_AssistantStream_accumulateMessage).call(this,event2,__classPrivateFieldGet$3(this,_AssistantStream_messageSnapshot,"f"));__classPrivateFieldSet$2(this,_AssistantStream_messageSnapshot,accumulatedMessage,"f");__classPrivateFieldGet$3(this,_AssistantStream_messageSnapshots,"f")[accumulatedMessage.id]=accumulatedMessage;for(const content of newContent){const snapshotContent=accumulatedMessage.content[content.index];if((snapshotContent==null?void 0:snapshotContent.type)=="text"){this._emit("textCreated",snapshotContent.text)}}switch(event2.event){case"thread.message.created":this._emit("messageCreated",event2.data);break;case"thread.message.in_progress":break;case"thread.message.delta":this._emit("messageDelta",event2.data.delta,accumulatedMessage);if(event2.data.delta.content){for(const content of event2.data.delta.content){if(content.type=="text"&&content.text){let textDelta=content.text;let snapshot=accumulatedMessage.content[content.index];if(snapshot&&snapshot.type=="text"){this._emit("textDelta",textDelta,snapshot.text)}else{throw Error("The snapshot associated with this text delta is not text or missing")}}if(content.index!=__classPrivateFieldGet$3(this,_AssistantStream_currentContentIndex,"f")){if(__classPrivateFieldGet$3(this,_AssistantStream_currentContent,"f")){switch(__classPrivateFieldGet$3(this,_AssistantStream_currentContent,"f").type){case"text":this._emit("textDone",__classPrivateFieldGet$3(this,_AssistantStream_currentContent,"f").text,__classPrivateFieldGet$3(this,_AssistantStream_messageSnapshot,"f"));break;case"image_file":this._emit("imageFileDone",__classPrivateFieldGet$3(this,_AssistantStream_currentContent,"f").image_file,__classPrivateFieldGet$3(this,_AssistantStream_messageSnapshot,"f"));break}}__classPrivateFieldSet$2(this,_AssistantStream_currentContentIndex,content.index,"f")}__classPrivateFieldSet$2(this,_AssistantStream_currentContent,accumulatedMessage.content[content.index],"f")}}break;case"thread.message.completed":case"thread.message.incomplete":if(__classPrivateFieldGet$3(this,_AssistantStream_currentContentIndex,"f")!==void 0){const currentContent=event2.data.content[__classPrivateFieldGet$3(this,_AssistantStream_currentContentIndex,"f")];if(currentContent){switch(currentContent.type){case"image_file":this._emit("imageFileDone",currentContent.image_file,__classPrivateFieldGet$3(this,_AssistantStream_messageSnapshot,"f"));break;case"text":this._emit("textDone",currentContent.text,__classPrivateFieldGet$3(this,_AssistantStream_messageSnapshot,"f"));break}}}if(__classPrivateFieldGet$3(this,_AssistantStream_messageSnapshot,"f")){this._emit("messageDone",event2.data)}__classPrivateFieldSet$2(this,_AssistantStream_messageSnapshot,void 0,"f")}},_AssistantStream_handleRunStep=function _AssistantStream_handleRunStep2(event2){const accumulatedRunStep=__classPrivateFieldGet$3(this,_AssistantStream_instances,"m",_AssistantStream_accumulateRunStep).call(this,event2);__classPrivateFieldSet$2(this,_AssistantStream_currentRunStepSnapshot,accumulatedRunStep,"f");switch(event2.event){case"thread.run.step.created":this._emit("runStepCreated",event2.data);break;case"thread.run.step.delta":const delta=event2.data.delta;if(delta.step_details&&delta.step_details.type=="tool_calls"&&delta.step_details.tool_calls&&accumulatedRunStep.step_details.type=="tool_calls"){for(const toolCall of delta.step_details.tool_calls){if(toolCall.index==__classPrivateFieldGet$3(this,_AssistantStream_currentToolCallIndex,"f")){this._emit("toolCallDelta",toolCall,accumulatedRunStep.step_details.tool_calls[toolCall.index])}else{if(__classPrivateFieldGet$3(this,_AssistantStream_currentToolCall,"f")){this._emit("toolCallDone",__classPrivateFieldGet$3(this,_AssistantStream_currentToolCall,"f"))}__classPrivateFieldSet$2(this,_AssistantStream_currentToolCallIndex,toolCall.index,"f");__classPrivateFieldSet$2(this,_AssistantStream_currentToolCall,accumulatedRunStep.step_details.tool_calls[toolCall.index],"f");if(__classPrivateFieldGet$3(this,_AssistantStream_currentToolCall,"f"))this._emit("toolCallCreated",__classPrivateFieldGet$3(this,_AssistantStream_currentToolCall,"f"))}}}this._emit("runStepDelta",event2.data.delta,accumulatedRunStep);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":__classPrivateFieldSet$2(this,_AssistantStream_currentRunStepSnapshot,void 0,"f");const details=event2.data.step_details;if(details.type=="tool_calls"){if(__classPrivateFieldGet$3(this,_AssistantStream_currentToolCall,"f")){this._emit("toolCallDone",__classPrivateFieldGet$3(this,_AssistantStream_currentToolCall,"f"));__classPrivateFieldSet$2(this,_AssistantStream_currentToolCall,void 0,"f")}}this._emit("runStepDone",event2.data,accumulatedRunStep);break}},_AssistantStream_handleEvent=function _AssistantStream_handleEvent2(event2){__classPrivateFieldGet$3(this,_AssistantStream_events,"f").push(event2);this._emit("event",event2)},_AssistantStream_accumulateRunStep=function _AssistantStream_accumulateRunStep2(event2){switch(event2.event){case"thread.run.step.created":__classPrivateFieldGet$3(this,_AssistantStream_runStepSnapshots,"f")[event2.data.id]=event2.data;return event2.data;case"thread.run.step.delta":let snapshot=__classPrivateFieldGet$3(this,_AssistantStream_runStepSnapshots,"f")[event2.data.id];if(!snapshot){throw Error("Received a RunStepDelta before creation of a snapshot")}let data=event2.data;if(data.delta){const accumulated=AssistantStream.accumulateDelta(snapshot,data.delta);__classPrivateFieldGet$3(this,_AssistantStream_runStepSnapshots,"f")[event2.data.id]=accumulated}return __classPrivateFieldGet$3(this,_AssistantStream_runStepSnapshots,"f")[event2.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":__classPrivateFieldGet$3(this,_AssistantStream_runStepSnapshots,"f")[event2.data.id]=event2.data;break}if(__classPrivateFieldGet$3(this,_AssistantStream_runStepSnapshots,"f")[event2.data.id])return __classPrivateFieldGet$3(this,_AssistantStream_runStepSnapshots,"f")[event2.data.id];throw new Error("No snapshot available")},_AssistantStream_accumulateMessage=function _AssistantStream_accumulateMessage2(event2,snapshot){let newContent=[];switch(event2.event){case"thread.message.created":return[event2.data,newContent];case"thread.message.delta":if(!snapshot){throw Error("Received a delta with no existing snapshot (there should be one from message creation)")}let data=event2.data;if(data.delta.content){for(const contentElement of data.delta.content){if(contentElement.index in snapshot.content){let currentContent=snapshot.content[contentElement.index];snapshot.content[contentElement.index]=__classPrivateFieldGet$3(this,_AssistantStream_instances,"m",_AssistantStream_accumulateContent).call(this,contentElement,currentContent)}else{snapshot.content[contentElement.index]=contentElement;newContent.push(contentElement)}}}return[snapshot,newContent];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(snapshot){return[snapshot,newContent]}else{throw Error("Received thread message event with no existing snapshot")}}throw Error("Tried to accumulate a non-message event")},_AssistantStream_accumulateContent=function _AssistantStream_accumulateContent2(contentElement,currentContent){return AssistantStream.accumulateDelta(currentContent,contentElement)},_AssistantStream_handleRun=function _AssistantStream_handleRun2(event2){__classPrivateFieldSet$2(this,_AssistantStream_currentRunSnapshot,event2.data,"f");switch(event2.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":__classPrivateFieldSet$2(this,_AssistantStream_finalRun,event2.data,"f");if(__classPrivateFieldGet$3(this,_AssistantStream_currentToolCall,"f")){this._emit("toolCallDone",__classPrivateFieldGet$3(this,_AssistantStream_currentToolCall,"f"));__classPrivateFieldSet$2(this,_AssistantStream_currentToolCall,void 0,"f")}break}};class Assistants extends APIResource{create(body,options){return this._client.post("/assistants",{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}retrieve(assistantId,options){return this._client.get(`/assistants/${assistantId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}update(assistantId,body,options){return this._client.post(`/assistants/${assistantId}`,{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}list(query={},options){if(isRequestOptions(query)){return this.list({},query)}return this._client.getAPIList("/assistants",AssistantsPage,{query:query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}del(assistantId,options){return this._client.delete(`/assistants/${assistantId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}}class AssistantsPage extends CursorPage{}Assistants.AssistantsPage=AssistantsPage;function isRunnableFunctionWithParse(fn){return typeof fn.parse==="function"}const isAssistantMessage=message=>(message==null?void 0:message.role)==="assistant";const isFunctionMessage=message=>(message==null?void 0:message.role)==="function";const isToolMessage=message=>(message==null?void 0:message.role)==="tool";function isAutoParsableResponseFormat(response_format){return(response_format==null?void 0:response_format["$brand"])==="auto-parseable-response-format"}function isAutoParsableTool$1(tool){return(tool==null?void 0:tool["$brand"])==="auto-parseable-tool"}function maybeParseChatCompletion(completion,params){if(!params||!hasAutoParseableInput$1(params)){return{...completion,choices:completion.choices.map(choice=>({...choice,message:{...choice.message,parsed:null,...choice.message.tool_calls?{tool_calls:choice.message.tool_calls}:void 0}}))}}return parseChatCompletion(completion,params)}function parseChatCompletion(completion,params){const choices=completion.choices.map(choice=>{var _a2;if(choice.finish_reason==="length"){throw new LengthFinishReasonError}if(choice.finish_reason==="content_filter"){throw new ContentFilterFinishReasonError}return{...choice,message:{...choice.message,...choice.message.tool_calls?{tool_calls:((_a2=choice.message.tool_calls)==null?void 0:_a2.map(toolCall=>parseToolCall$1(params,toolCall)))??void 0}:void 0,parsed:choice.message.content&&!choice.message.refusal?parseResponseFormat(params,choice.message.content):null}}});return{...completion,choices:choices}}function parseResponseFormat(params,content){var _a2,_b;if(((_a2=params.response_format)==null?void 0:_a2.type)!=="json_schema"){return null}if(((_b=params.response_format)==null?void 0:_b.type)==="json_schema"){if("$parseRaw"in params.response_format){const response_format=params.response_format;return response_format.$parseRaw(content)}return JSON.parse(content)}return null}function parseToolCall$1(params,toolCall){var _a2;const inputTool=(_a2=params.tools)==null?void 0:_a2.find(inputTool2=>{var _a3;return((_a3=inputTool2.function)==null?void 0:_a3.name)===toolCall.function.name});return{...toolCall,function:{...toolCall.function,parsed_arguments:isAutoParsableTool$1(inputTool)?inputTool.$parseRaw(toolCall.function.arguments):(inputTool==null?void 0:inputTool.function.strict)?JSON.parse(toolCall.function.arguments):null}}}function shouldParseToolCall(params,toolCall){var _a2;if(!params){return false}const inputTool=(_a2=params.tools)==null?void 0:_a2.find(inputTool2=>{var _a3;return((_a3=inputTool2.function)==null?void 0:_a3.name)===toolCall.function.name});return isAutoParsableTool$1(inputTool)||(inputTool==null?void 0:inputTool.function.strict)||false}function hasAutoParseableInput$1(params){var _a2;if(isAutoParsableResponseFormat(params.response_format)){return true}return((_a2=params.tools)==null?void 0:_a2.some(t=>isAutoParsableTool$1(t)||t.type==="function"&&t.function.strict===true))??false}function validateInputTools(tools){for(const tool of tools??[]){if(tool.type!=="function"){throw new OpenAIError(`Currently only \`function\` tool types support auto-parsing; Received \`${tool.type}\``)}if(tool.function.strict!==true){throw new OpenAIError(`The \`${tool.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}}var __classPrivateFieldGet$2=function(receiver,state2,kind2,f){if(kind2==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof state2==="function"?receiver!==state2||!f:!state2.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return kind2==="m"?f:kind2==="a"?f.call(receiver):f?f.value:state2.get(receiver)};var _AbstractChatCompletionRunner_instances,_AbstractChatCompletionRunner_getFinalContent,_AbstractChatCompletionRunner_getFinalMessage,_AbstractChatCompletionRunner_getFinalFunctionCall,_AbstractChatCompletionRunner_getFinalFunctionCallResult,_AbstractChatCompletionRunner_calculateTotalUsage,_AbstractChatCompletionRunner_validateParams,_AbstractChatCompletionRunner_stringifyFunctionCallResult;const DEFAULT_MAX_CHAT_COMPLETIONS=10;class AbstractChatCompletionRunner extends EventStream{constructor(){super(...arguments);_AbstractChatCompletionRunner_instances.add(this);this._chatCompletions=[];this.messages=[]}_addChatCompletion(chatCompletion){var _a2;this._chatCompletions.push(chatCompletion);this._emit("chatCompletion",chatCompletion);const message=(_a2=chatCompletion.choices[0])==null?void 0:_a2.message;if(message)this._addMessage(message);return chatCompletion}_addMessage(message,emit=true){if(!("content"in message))message.content=null;this.messages.push(message);if(emit){this._emit("message",message);if((isFunctionMessage(message)||isToolMessage(message))&&message.content){this._emit("functionCallResult",message.content)}else if(isAssistantMessage(message)&&message.function_call){this._emit("functionCall",message.function_call)}else if(isAssistantMessage(message)&&message.tool_calls){for(const tool_call of message.tool_calls){if(tool_call.type==="function"){this._emit("functionCall",tool_call.function)}}}}}async finalChatCompletion(){await this.done();const completion=this._chatCompletions[this._chatCompletions.length-1];if(!completion)throw new OpenAIError("stream ended without producing a ChatCompletion");return completion}async finalContent(){await this.done();return __classPrivateFieldGet$2(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalContent).call(this)}async finalMessage(){await this.done();return __classPrivateFieldGet$2(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalMessage).call(this)}async finalFunctionCall(){await this.done();return __classPrivateFieldGet$2(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalFunctionCall).call(this)}async finalFunctionCallResult(){await this.done();return __classPrivateFieldGet$2(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalFunctionCallResult).call(this)}async totalUsage(){await this.done();return __classPrivateFieldGet$2(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_calculateTotalUsage).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const completion=this._chatCompletions[this._chatCompletions.length-1];if(completion)this._emit("finalChatCompletion",completion);const finalMessage=__classPrivateFieldGet$2(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalMessage).call(this);if(finalMessage)this._emit("finalMessage",finalMessage);const finalContent=__classPrivateFieldGet$2(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalContent).call(this);if(finalContent)this._emit("finalContent",finalContent);const finalFunctionCall=__classPrivateFieldGet$2(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalFunctionCall).call(this);if(finalFunctionCall)this._emit("finalFunctionCall",finalFunctionCall);const finalFunctionCallResult=__classPrivateFieldGet$2(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalFunctionCallResult).call(this);if(finalFunctionCallResult!=null)this._emit("finalFunctionCallResult",finalFunctionCallResult);if(this._chatCompletions.some(c=>c.usage)){this._emit("totalUsage",__classPrivateFieldGet$2(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_calculateTotalUsage).call(this))}}async _createChatCompletion(client,params,options){const signal=options==null?void 0:options.signal;if(signal){if(signal.aborted)this.controller.abort();signal.addEventListener("abort",()=>this.controller.abort())}__classPrivateFieldGet$2(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_validateParams).call(this,params);const chatCompletion=await client.chat.completions.create({...params,stream:false},{...options,signal:this.controller.signal});this._connected();return this._addChatCompletion(parseChatCompletion(chatCompletion,params))}async _runChatCompletion(client,params,options){for(const message of params.messages){this._addMessage(message,false)}return await this._createChatCompletion(client,params,options)}async _runFunctions(client,params,options){var _a2;const role="function";const{function_call:function_call="auto",stream:stream,...restParams}=params;const singleFunctionToCall=typeof function_call!=="string"&&(function_call==null?void 0:function_call.name);const{maxChatCompletions:maxChatCompletions=DEFAULT_MAX_CHAT_COMPLETIONS}=options||{};const functionsByName={};for(const f of params.functions){functionsByName[f.name||f.function.name]=f}const functions=params.functions.map(f=>({name:f.name||f.function.name,parameters:f.parameters,description:f.description}));for(const message of params.messages){this._addMessage(message,false)}for(let i=0;i<maxChatCompletions;++i){const chatCompletion=await this._createChatCompletion(client,{...restParams,function_call:function_call,functions:functions,messages:[...this.messages]},options);const message=(_a2=chatCompletion.choices[0])==null?void 0:_a2.message;if(!message){throw new OpenAIError(`missing message in ChatCompletion response`)}if(!message.function_call)return;const{name:name,arguments:args}=message.function_call;const fn=functionsByName[name];if(!fn){const content2=`Invalid function_call: ${JSON.stringify(name)}. Available options are: ${functions.map(f=>JSON.stringify(f.name)).join(", ")}. Please try again`;this._addMessage({role:role,name:name,content:content2});continue}else if(singleFunctionToCall&&singleFunctionToCall!==name){const content2=`Invalid function_call: ${JSON.stringify(name)}. ${JSON.stringify(singleFunctionToCall)} requested. Please try again`;this._addMessage({role:role,name:name,content:content2});continue}let parsed;try{parsed=isRunnableFunctionWithParse(fn)?await fn.parse(args):args}catch(error){this._addMessage({role:role,name:name,content:error instanceof Error?error.message:String(error)});continue}const rawContent=await fn.function(parsed,this);const content=__classPrivateFieldGet$2(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_stringifyFunctionCallResult).call(this,rawContent);this._addMessage({role:role,name:name,content:content});if(singleFunctionToCall)return}}async _runTools(client,params,options){var _a2,_b,_c;const role="tool";const{tool_choice:tool_choice="auto",stream:stream,...restParams}=params;const singleFunctionToCall=typeof tool_choice!=="string"&&((_a2=tool_choice==null?void 0:tool_choice.function)==null?void 0:_a2.name);const{maxChatCompletions:maxChatCompletions=DEFAULT_MAX_CHAT_COMPLETIONS}=options||{};const inputTools=params.tools.map(tool=>{if(isAutoParsableTool$1(tool)){if(!tool.$callback){throw new OpenAIError("Tool given to `.runTools()` that does not have an associated function")}return{type:"function",function:{function:tool.$callback,name:tool.function.name,description:tool.function.description||"",parameters:tool.function.parameters,parse:tool.$parseRaw,strict:true}}}return tool});const functionsByName={};for(const f of inputTools){if(f.type==="function"){functionsByName[f.function.name||f.function.function.name]=f.function}}const tools="tools"in params?inputTools.map(t=>t.type==="function"?{type:"function",function:{name:t.function.name||t.function.function.name,parameters:t.function.parameters,description:t.function.description,strict:t.function.strict}}:t):void 0;for(const message of params.messages){this._addMessage(message,false)}for(let i=0;i<maxChatCompletions;++i){const chatCompletion=await this._createChatCompletion(client,{...restParams,tool_choice:tool_choice,tools:tools,messages:[...this.messages]},options);const message=(_b=chatCompletion.choices[0])==null?void 0:_b.message;if(!message){throw new OpenAIError(`missing message in ChatCompletion response`)}if(!((_c=message.tool_calls)==null?void 0:_c.length)){return}for(const tool_call of message.tool_calls){if(tool_call.type!=="function")continue;const tool_call_id=tool_call.id;const{name:name,arguments:args}=tool_call.function;const fn=functionsByName[name];if(!fn){const content2=`Invalid tool_call: ${JSON.stringify(name)}. Available options are: ${Object.keys(functionsByName).map(name2=>JSON.stringify(name2)).join(", ")}. Please try again`;this._addMessage({role:role,tool_call_id:tool_call_id,content:content2});continue}else if(singleFunctionToCall&&singleFunctionToCall!==name){const content2=`Invalid tool_call: ${JSON.stringify(name)}. ${JSON.stringify(singleFunctionToCall)} requested. Please try again`;this._addMessage({role:role,tool_call_id:tool_call_id,content:content2});continue}let parsed;try{parsed=isRunnableFunctionWithParse(fn)?await fn.parse(args):args}catch(error){const content2=error instanceof Error?error.message:String(error);this._addMessage({role:role,tool_call_id:tool_call_id,content:content2});continue}const rawContent=await fn.function(parsed,this);const content=__classPrivateFieldGet$2(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_stringifyFunctionCallResult).call(this,rawContent);this._addMessage({role:role,tool_call_id:tool_call_id,content:content});if(singleFunctionToCall){return}}}return}}_AbstractChatCompletionRunner_instances=new WeakSet,_AbstractChatCompletionRunner_getFinalContent=function _AbstractChatCompletionRunner_getFinalContent2(){return __classPrivateFieldGet$2(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalMessage).call(this).content??null},_AbstractChatCompletionRunner_getFinalMessage=function _AbstractChatCompletionRunner_getFinalMessage2(){let i=this.messages.length;while(i-- >0){const message=this.messages[i];if(isAssistantMessage(message)){const{function_call:function_call,...rest}=message;const ret={...rest,content:message.content??null,refusal:message.refusal??null};if(function_call){ret.function_call=function_call}return ret}}throw new OpenAIError("stream ended without producing a ChatCompletionMessage with role=assistant")},_AbstractChatCompletionRunner_getFinalFunctionCall=function _AbstractChatCompletionRunner_getFinalFunctionCall2(){var _a2,_b;for(let i=this.messages.length-1;i>=0;i--){const message=this.messages[i];if(isAssistantMessage(message)&&(message==null?void 0:message.function_call)){return message.function_call}if(isAssistantMessage(message)&&((_a2=message==null?void 0:message.tool_calls)==null?void 0:_a2.length)){return(_b=message.tool_calls.at(-1))==null?void 0:_b.function}}return},_AbstractChatCompletionRunner_getFinalFunctionCallResult=function _AbstractChatCompletionRunner_getFinalFunctionCallResult2(){for(let i=this.messages.length-1;i>=0;i--){const message=this.messages[i];if(isFunctionMessage(message)&&message.content!=null){return message.content}if(isToolMessage(message)&&message.content!=null&&typeof message.content==="string"&&this.messages.some(x=>{var _a2;return x.role==="assistant"&&((_a2=x.tool_calls)==null?void 0:_a2.some(y=>y.type==="function"&&y.id===message.tool_call_id))})){return message.content}}return},_AbstractChatCompletionRunner_calculateTotalUsage=function _AbstractChatCompletionRunner_calculateTotalUsage2(){const total={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:usage}of this._chatCompletions){if(usage){total.completion_tokens+=usage.completion_tokens;total.prompt_tokens+=usage.prompt_tokens;total.total_tokens+=usage.total_tokens}}return total},_AbstractChatCompletionRunner_validateParams=function _AbstractChatCompletionRunner_validateParams2(params){if(params.n!=null&&params.n>1){throw new OpenAIError("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")}},_AbstractChatCompletionRunner_stringifyFunctionCallResult=function _AbstractChatCompletionRunner_stringifyFunctionCallResult2(rawContent){return typeof rawContent==="string"?rawContent:rawContent===void 0?"undefined":JSON.stringify(rawContent)};class ChatCompletionRunner extends AbstractChatCompletionRunner{static runFunctions(client,params,options){const runner=new ChatCompletionRunner;const opts={...options,headers:{...options==null?void 0:options.headers,"X-Stainless-Helper-Method":"runFunctions"}};runner._run(()=>runner._runFunctions(client,params,opts));return runner}static runTools(client,params,options){const runner=new ChatCompletionRunner;const opts={...options,headers:{...options==null?void 0:options.headers,"X-Stainless-Helper-Method":"runTools"}};runner._run(()=>runner._runTools(client,params,opts));return runner}_addMessage(message,emit=true){super._addMessage(message,emit);if(isAssistantMessage(message)&&message.content){this._emit("content",message.content)}}}const STR=1;const NUM=2;const ARR=4;const OBJ=8;const NULL=16;const BOOL=32;const NAN=64;const INFINITY=128;const MINUS_INFINITY=256;const INF=INFINITY|MINUS_INFINITY;const SPECIAL=NULL|BOOL|INF|NAN;const ATOM=STR|NUM|SPECIAL;const COLLECTION=ARR|OBJ;const ALL=ATOM|COLLECTION;const Allow={STR:STR,NUM:NUM,ARR:ARR,OBJ:OBJ,NULL:NULL,BOOL:BOOL,NAN:NAN,INFINITY:INFINITY,MINUS_INFINITY:MINUS_INFINITY,INF:INF,SPECIAL:SPECIAL,ATOM:ATOM,COLLECTION:COLLECTION,ALL:ALL};class PartialJSON extends Error{}class MalformedJSON extends Error{}function parseJSON(jsonString,allowPartial=Allow.ALL){if(typeof jsonString!=="string"){throw new TypeError(`expecting str, got ${typeof jsonString}`)}if(!jsonString.trim()){throw new Error(`${jsonString} is empty`)}return _parseJSON(jsonString.trim(),allowPartial)}const _parseJSON=(jsonString,allow)=>{const length=jsonString.length;let index2=0;const markPartialJSON=msg=>{throw new PartialJSON(`${msg} at position ${index2}`)};const throwMalformedError=msg=>{throw new MalformedJSON(`${msg} at position ${index2}`)};const parseAny=()=>{skipBlank();if(index2>=length)markPartialJSON("Unexpected end of input");if(jsonString[index2]==='"')return parseStr();if(jsonString[index2]==="{")return parseObj();if(jsonString[index2]==="[")return parseArr();if(jsonString.substring(index2,index2+4)==="null"||Allow.NULL&allow&&length-index2<4&&"null".startsWith(jsonString.substring(index2))){index2+=4;return null}if(jsonString.substring(index2,index2+4)==="true"||Allow.BOOL&allow&&length-index2<4&&"true".startsWith(jsonString.substring(index2))){index2+=4;return true}if(jsonString.substring(index2,index2+5)==="false"||Allow.BOOL&allow&&length-index2<5&&"false".startsWith(jsonString.substring(index2))){index2+=5;return false}if(jsonString.substring(index2,index2+8)==="Infinity"||Allow.INFINITY&allow&&length-index2<8&&"Infinity".startsWith(jsonString.substring(index2))){index2+=8;return Infinity}if(jsonString.substring(index2,index2+9)==="-Infinity"||Allow.MINUS_INFINITY&allow&&1<length-index2&&length-index2<9&&"-Infinity".startsWith(jsonString.substring(index2))){index2+=9;return-Infinity}if(jsonString.substring(index2,index2+3)==="NaN"||Allow.NAN&allow&&length-index2<3&&"NaN".startsWith(jsonString.substring(index2))){index2+=3;return NaN}return parseNum()};const parseStr=()=>{const start=index2;let escape2=false;index2++;while(index2<length&&(jsonString[index2]!=='"'||escape2&&jsonString[index2-1]==="\\")){escape2=jsonString[index2]==="\\"?!escape2:false;index2++}if(jsonString.charAt(index2)=='"'){try{return JSON.parse(jsonString.substring(start,++index2-Number(escape2)))}catch(e){throwMalformedError(String(e))}}else if(Allow.STR&allow){try{return JSON.parse(jsonString.substring(start,index2-Number(escape2))+'"')}catch(e){return JSON.parse(jsonString.substring(start,jsonString.lastIndexOf("\\"))+'"')}}markPartialJSON("Unterminated string literal")};const parseObj=()=>{index2++;skipBlank();const obj={};try{while(jsonString[index2]!=="}"){skipBlank();if(index2>=length&&Allow.OBJ&allow)return obj;const key=parseStr();skipBlank();index2++;try{const value=parseAny();Object.defineProperty(obj,key,{value:value,writable:true,enumerable:true,configurable:true})}catch(e){if(Allow.OBJ&allow)return obj;else throw e}skipBlank();if(jsonString[index2]===",")index2++}}catch(e){if(Allow.OBJ&allow)return obj;else markPartialJSON("Expected '}' at end of object")}index2++;return obj};const parseArr=()=>{index2++;const arr=[];try{while(jsonString[index2]!=="]"){arr.push(parseAny());skipBlank();if(jsonString[index2]===","){index2++}}}catch(e){if(Allow.ARR&allow){return arr}markPartialJSON("Expected ']' at end of array")}index2++;return arr};const parseNum=()=>{if(index2===0){if(jsonString==="-"&&Allow.NUM&allow)markPartialJSON("Not sure what '-' is");try{return JSON.parse(jsonString)}catch(e){if(Allow.NUM&allow){try{if("."===jsonString[jsonString.length-1])return JSON.parse(jsonString.substring(0,jsonString.lastIndexOf(".")));return JSON.parse(jsonString.substring(0,jsonString.lastIndexOf("e")))}catch(e2){}}throwMalformedError(String(e))}}const start=index2;if(jsonString[index2]==="-")index2++;while(jsonString[index2]&&!",]}".includes(jsonString[index2]))index2++;if(index2==length&&!(Allow.NUM&allow))markPartialJSON("Unterminated number literal");try{return JSON.parse(jsonString.substring(start,index2))}catch(e){if(jsonString.substring(start,index2)==="-"&&Allow.NUM&allow)markPartialJSON("Not sure what '-' is");try{return JSON.parse(jsonString.substring(start,jsonString.lastIndexOf("e")))}catch(e2){throwMalformedError(String(e2))}}};const skipBlank=()=>{while(index2<length&&" \n\r\t".includes(jsonString[index2])){index2++}};return parseAny()};const partialParse=input=>parseJSON(input,Allow.ALL^Allow.NUM);var __classPrivateFieldSet$1=function(receiver,state2,value,kind2,f){if(kind2==="m")throw new TypeError("Private method is not writable");if(kind2==="a"&&!f)throw new TypeError("Private accessor was defined without a setter");if(typeof state2==="function"?receiver!==state2||!f:!state2.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return kind2==="a"?f.call(receiver,value):f?f.value=value:state2.set(receiver,value),value};var __classPrivateFieldGet$1=function(receiver,state2,kind2,f){if(kind2==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof state2==="function"?receiver!==state2||!f:!state2.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return kind2==="m"?f:kind2==="a"?f.call(receiver):f?f.value:state2.get(receiver)};var _ChatCompletionStream_instances,_ChatCompletionStream_params,_ChatCompletionStream_choiceEventStates,_ChatCompletionStream_currentChatCompletionSnapshot,_ChatCompletionStream_beginRequest,_ChatCompletionStream_getChoiceEventState,_ChatCompletionStream_addChunk,_ChatCompletionStream_emitToolCallDoneEvent,_ChatCompletionStream_emitContentDoneEvents,_ChatCompletionStream_endRequest,_ChatCompletionStream_getAutoParseableResponseFormat,_ChatCompletionStream_accumulateChatCompletion;class ChatCompletionStream extends AbstractChatCompletionRunner{constructor(params){super();_ChatCompletionStream_instances.add(this);_ChatCompletionStream_params.set(this,void 0);_ChatCompletionStream_choiceEventStates.set(this,void 0);_ChatCompletionStream_currentChatCompletionSnapshot.set(this,void 0);__classPrivateFieldSet$1(this,_ChatCompletionStream_params,params,"f");__classPrivateFieldSet$1(this,_ChatCompletionStream_choiceEventStates,[],"f")}get currentChatCompletionSnapshot(){return __classPrivateFieldGet$1(this,_ChatCompletionStream_currentChatCompletionSnapshot,"f")}static fromReadableStream(stream){const runner=new ChatCompletionStream(null);runner._run(()=>runner._fromReadableStream(stream));return runner}static createChatCompletion(client,params,options){const runner=new ChatCompletionStream(params);runner._run(()=>runner._runChatCompletion(client,{...params,stream:true},{...options,headers:{...options==null?void 0:options.headers,"X-Stainless-Helper-Method":"stream"}}));return runner}async _createChatCompletion(client,params,options){var _a2;super._createChatCompletion;const signal=options==null?void 0:options.signal;if(signal){if(signal.aborted)this.controller.abort();signal.addEventListener("abort",()=>this.controller.abort())}__classPrivateFieldGet$1(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_beginRequest).call(this);const stream=await client.chat.completions.create({...params,stream:true},{...options,signal:this.controller.signal});this._connected();for await(const chunk of stream){__classPrivateFieldGet$1(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_addChunk).call(this,chunk)}if((_a2=stream.controller.signal)==null?void 0:_a2.aborted){throw new APIUserAbortError}return this._addChatCompletion(__classPrivateFieldGet$1(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_endRequest).call(this))}async _fromReadableStream(readableStream,options){var _a2;const signal=options==null?void 0:options.signal;if(signal){if(signal.aborted)this.controller.abort();signal.addEventListener("abort",()=>this.controller.abort())}__classPrivateFieldGet$1(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_beginRequest).call(this);this._connected();const stream=Stream.fromReadableStream(readableStream,this.controller);let chatId;for await(const chunk of stream){if(chatId&&chatId!==chunk.id){this._addChatCompletion(__classPrivateFieldGet$1(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_endRequest).call(this))}__classPrivateFieldGet$1(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_addChunk).call(this,chunk);chatId=chunk.id}if((_a2=stream.controller.signal)==null?void 0:_a2.aborted){throw new APIUserAbortError}return this._addChatCompletion(__classPrivateFieldGet$1(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_endRequest).call(this))}[(_ChatCompletionStream_params=new WeakMap,_ChatCompletionStream_choiceEventStates=new WeakMap,_ChatCompletionStream_currentChatCompletionSnapshot=new WeakMap,_ChatCompletionStream_instances=new WeakSet,_ChatCompletionStream_beginRequest=function _ChatCompletionStream_beginRequest2(){if(this.ended)return;__classPrivateFieldSet$1(this,_ChatCompletionStream_currentChatCompletionSnapshot,void 0,"f")},_ChatCompletionStream_getChoiceEventState=function _ChatCompletionStream_getChoiceEventState2(choice){let state2=__classPrivateFieldGet$1(this,_ChatCompletionStream_choiceEventStates,"f")[choice.index];if(state2){return state2}state2={content_done:false,refusal_done:false,logprobs_content_done:false,logprobs_refusal_done:false,done_tool_calls:new Set,current_tool_call_index:null};__classPrivateFieldGet$1(this,_ChatCompletionStream_choiceEventStates,"f")[choice.index]=state2;return state2},_ChatCompletionStream_addChunk=function _ChatCompletionStream_addChunk2(chunk){var _a2,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l,_m,_n,_o;if(this.ended)return;const completion=__classPrivateFieldGet$1(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_accumulateChatCompletion).call(this,chunk);this._emit("chunk",chunk,completion);for(const choice of chunk.choices){const choiceSnapshot=completion.choices[choice.index];if(choice.delta.content!=null&&((_a2=choiceSnapshot.message)==null?void 0:_a2.role)==="assistant"&&((_b=choiceSnapshot.message)==null?void 0:_b.content)){this._emit("content",choice.delta.content,choiceSnapshot.message.content);this._emit("content.delta",{delta:choice.delta.content,snapshot:choiceSnapshot.message.content,parsed:choiceSnapshot.message.parsed})}if(choice.delta.refusal!=null&&((_c=choiceSnapshot.message)==null?void 0:_c.role)==="assistant"&&((_d=choiceSnapshot.message)==null?void 0:_d.refusal)){this._emit("refusal.delta",{delta:choice.delta.refusal,snapshot:choiceSnapshot.message.refusal})}if(((_e=choice.logprobs)==null?void 0:_e.content)!=null&&((_f=choiceSnapshot.message)==null?void 0:_f.role)==="assistant"){this._emit("logprobs.content.delta",{content:(_g=choice.logprobs)==null?void 0:_g.content,snapshot:((_h=choiceSnapshot.logprobs)==null?void 0:_h.content)??[]})}if(((_i=choice.logprobs)==null?void 0:_i.refusal)!=null&&((_j=choiceSnapshot.message)==null?void 0:_j.role)==="assistant"){this._emit("logprobs.refusal.delta",{refusal:(_k=choice.logprobs)==null?void 0:_k.refusal,snapshot:((_l=choiceSnapshot.logprobs)==null?void 0:_l.refusal)??[]})}const state2=__classPrivateFieldGet$1(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_getChoiceEventState).call(this,choiceSnapshot);if(choiceSnapshot.finish_reason){__classPrivateFieldGet$1(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_emitContentDoneEvents).call(this,choiceSnapshot);if(state2.current_tool_call_index!=null){__classPrivateFieldGet$1(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_emitToolCallDoneEvent).call(this,choiceSnapshot,state2.current_tool_call_index)}}for(const toolCall of choice.delta.tool_calls??[]){if(state2.current_tool_call_index!==toolCall.index){__classPrivateFieldGet$1(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_emitContentDoneEvents).call(this,choiceSnapshot);if(state2.current_tool_call_index!=null){__classPrivateFieldGet$1(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_emitToolCallDoneEvent).call(this,choiceSnapshot,state2.current_tool_call_index)}}state2.current_tool_call_index=toolCall.index}for(const toolCallDelta of choice.delta.tool_calls??[]){const toolCallSnapshot=(_m=choiceSnapshot.message.tool_calls)==null?void 0:_m[toolCallDelta.index];if(!(toolCallSnapshot==null?void 0:toolCallSnapshot.type)){continue}if((toolCallSnapshot==null?void 0:toolCallSnapshot.type)==="function"){this._emit("tool_calls.function.arguments.delta",{name:(_n=toolCallSnapshot.function)==null?void 0:_n.name,index:toolCallDelta.index,arguments:toolCallSnapshot.function.arguments,parsed_arguments:toolCallSnapshot.function.parsed_arguments,arguments_delta:((_o=toolCallDelta.function)==null?void 0:_o.arguments)??""})}else{assertNever(toolCallSnapshot==null?void 0:toolCallSnapshot.type)}}}},_ChatCompletionStream_emitToolCallDoneEvent=function _ChatCompletionStream_emitToolCallDoneEvent2(choiceSnapshot,toolCallIndex){var _a2,_b,_c;const state2=__classPrivateFieldGet$1(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_getChoiceEventState).call(this,choiceSnapshot);if(state2.done_tool_calls.has(toolCallIndex)){return}const toolCallSnapshot=(_a2=choiceSnapshot.message.tool_calls)==null?void 0:_a2[toolCallIndex];if(!toolCallSnapshot){throw new Error("no tool call snapshot")}if(!toolCallSnapshot.type){throw new Error("tool call snapshot missing `type`")}if(toolCallSnapshot.type==="function"){const inputTool=(_c=(_b=__classPrivateFieldGet$1(this,_ChatCompletionStream_params,"f"))==null?void 0:_b.tools)==null?void 0:_c.find(tool=>tool.type==="function"&&tool.function.name===toolCallSnapshot.function.name);this._emit("tool_calls.function.arguments.done",{name:toolCallSnapshot.function.name,index:toolCallIndex,arguments:toolCallSnapshot.function.arguments,parsed_arguments:isAutoParsableTool$1(inputTool)?inputTool.$parseRaw(toolCallSnapshot.function.arguments):(inputTool==null?void 0:inputTool.function.strict)?JSON.parse(toolCallSnapshot.function.arguments):null})}else{assertNever(toolCallSnapshot.type)}},_ChatCompletionStream_emitContentDoneEvents=function _ChatCompletionStream_emitContentDoneEvents2(choiceSnapshot){var _a2,_b;const state2=__classPrivateFieldGet$1(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_getChoiceEventState).call(this,choiceSnapshot);if(choiceSnapshot.message.content&&!state2.content_done){state2.content_done=true;const responseFormat=__classPrivateFieldGet$1(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_getAutoParseableResponseFormat).call(this);this._emit("content.done",{content:choiceSnapshot.message.content,parsed:responseFormat?responseFormat.$parseRaw(choiceSnapshot.message.content):null})}if(choiceSnapshot.message.refusal&&!state2.refusal_done){state2.refusal_done=true;this._emit("refusal.done",{refusal:choiceSnapshot.message.refusal})}if(((_a2=choiceSnapshot.logprobs)==null?void 0:_a2.content)&&!state2.logprobs_content_done){state2.logprobs_content_done=true;this._emit("logprobs.content.done",{content:choiceSnapshot.logprobs.content})}if(((_b=choiceSnapshot.logprobs)==null?void 0:_b.refusal)&&!state2.logprobs_refusal_done){state2.logprobs_refusal_done=true;this._emit("logprobs.refusal.done",{refusal:choiceSnapshot.logprobs.refusal})}},_ChatCompletionStream_endRequest=function _ChatCompletionStream_endRequest2(){if(this.ended){throw new OpenAIError(`stream has ended, this shouldn't happen`)}const snapshot=__classPrivateFieldGet$1(this,_ChatCompletionStream_currentChatCompletionSnapshot,"f");if(!snapshot){throw new OpenAIError(`request ended without sending any chunks`)}__classPrivateFieldSet$1(this,_ChatCompletionStream_currentChatCompletionSnapshot,void 0,"f");__classPrivateFieldSet$1(this,_ChatCompletionStream_choiceEventStates,[],"f");return finalizeChatCompletion(snapshot,__classPrivateFieldGet$1(this,_ChatCompletionStream_params,"f"))},_ChatCompletionStream_getAutoParseableResponseFormat=function _ChatCompletionStream_getAutoParseableResponseFormat2(){var _a2;const responseFormat=(_a2=__classPrivateFieldGet$1(this,_ChatCompletionStream_params,"f"))==null?void 0:_a2.response_format;if(isAutoParsableResponseFormat(responseFormat)){return responseFormat}return null},_ChatCompletionStream_accumulateChatCompletion=function _ChatCompletionStream_accumulateChatCompletion2(chunk){var _a2,_b,_c,_d;let snapshot=__classPrivateFieldGet$1(this,_ChatCompletionStream_currentChatCompletionSnapshot,"f");const{choices:choices,...rest}=chunk;if(!snapshot){snapshot=__classPrivateFieldSet$1(this,_ChatCompletionStream_currentChatCompletionSnapshot,{...rest,choices:[]},"f")}else{Object.assign(snapshot,rest)}for(const{delta:delta,finish_reason:finish_reason,index:index2,logprobs:logprobs=null,...other}of chunk.choices){let choice=snapshot.choices[index2];if(!choice){choice=snapshot.choices[index2]={finish_reason:finish_reason,index:index2,message:{},logprobs:logprobs,...other}}if(logprobs){if(!choice.logprobs){choice.logprobs=Object.assign({},logprobs)}else{const{content:content2,refusal:refusal2,...rest3}=logprobs;Object.assign(choice.logprobs,rest3);if(content2){(_a2=choice.logprobs).content??(_a2.content=[]);choice.logprobs.content.push(...content2)}if(refusal2){(_b=choice.logprobs).refusal??(_b.refusal=[]);choice.logprobs.refusal.push(...refusal2)}}}if(finish_reason){choice.finish_reason=finish_reason;if(__classPrivateFieldGet$1(this,_ChatCompletionStream_params,"f")&&hasAutoParseableInput$1(__classPrivateFieldGet$1(this,_ChatCompletionStream_params,"f"))){if(finish_reason==="length"){throw new LengthFinishReasonError}if(finish_reason==="content_filter"){throw new ContentFilterFinishReasonError}}}Object.assign(choice,other);if(!delta)continue;const{content:content,refusal:refusal,function_call:function_call,role:role,tool_calls:tool_calls,...rest2}=delta;Object.assign(choice.message,rest2);if(refusal){choice.message.refusal=(choice.message.refusal||"")+refusal}if(role)choice.message.role=role;if(function_call){if(!choice.message.function_call){choice.message.function_call=function_call}else{if(function_call.name)choice.message.function_call.name=function_call.name;if(function_call.arguments){(_c=choice.message.function_call).arguments??(_c.arguments="");choice.message.function_call.arguments+=function_call.arguments}}}if(content){choice.message.content=(choice.message.content||"")+content;if(!choice.message.refusal&&__classPrivateFieldGet$1(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_getAutoParseableResponseFormat).call(this)){choice.message.parsed=partialParse(choice.message.content)}}if(tool_calls){if(!choice.message.tool_calls)choice.message.tool_calls=[];for(const{index:index3,id:id,type:type,function:fn,...rest3}of tool_calls){const tool_call=(_d=choice.message.tool_calls)[index3]??(_d[index3]={});Object.assign(tool_call,rest3);if(id)tool_call.id=id;if(type)tool_call.type=type;if(fn)tool_call.function??(tool_call.function={name:fn.name??"",arguments:""});if(fn==null?void 0:fn.name)tool_call.function.name=fn.name;if(fn==null?void 0:fn.arguments){tool_call.function.arguments+=fn.arguments;if(shouldParseToolCall(__classPrivateFieldGet$1(this,_ChatCompletionStream_params,"f"),tool_call)){tool_call.function.parsed_arguments=partialParse(tool_call.function.arguments)}}}}}return snapshot},Symbol.asyncIterator)](){const pushQueue=[];const readQueue=[];let done=false;this.on("chunk",chunk=>{const reader=readQueue.shift();if(reader){reader.resolve(chunk)}else{pushQueue.push(chunk)}});this.on("end",()=>{done=true;for(const reader of readQueue){reader.resolve(void 0)}readQueue.length=0});this.on("abort",err=>{done=true;for(const reader of readQueue){reader.reject(err)}readQueue.length=0});this.on("error",err=>{done=true;for(const reader of readQueue){reader.reject(err)}readQueue.length=0});return{next:async()=>{if(!pushQueue.length){if(done){return{value:void 0,done:true}}return new Promise((resolve,reject)=>readQueue.push({resolve:resolve,reject:reject})).then(chunk2=>chunk2?{value:chunk2,done:false}:{value:void 0,done:true})}const chunk=pushQueue.shift();return{value:chunk,done:false}},return:async()=>{this.abort();return{value:void 0,done:true}}}}toReadableStream(){const stream=new Stream(this[Symbol.asyncIterator].bind(this),this.controller);return stream.toReadableStream()}}function finalizeChatCompletion(snapshot,params){const{id:id,choices:choices,created:created,model:model,system_fingerprint:system_fingerprint,...rest}=snapshot;const completion={...rest,id:id,choices:choices.map(({message:message,finish_reason:finish_reason,index:index2,logprobs:logprobs,...choiceRest})=>{if(!finish_reason){throw new OpenAIError(`missing finish_reason for choice ${index2}`)}const{content:content=null,function_call:function_call,tool_calls:tool_calls,...messageRest}=message;const role=message.role;if(!role){throw new OpenAIError(`missing role for choice ${index2}`)}if(function_call){const{arguments:args,name:name}=function_call;if(args==null){throw new OpenAIError(`missing function_call.arguments for choice ${index2}`)}if(!name){throw new OpenAIError(`missing function_call.name for choice ${index2}`)}return{...choiceRest,message:{content:content,function_call:{arguments:args,name:name},role:role,refusal:message.refusal??null},finish_reason:finish_reason,index:index2,logprobs:logprobs}}if(tool_calls){return{...choiceRest,index:index2,finish_reason:finish_reason,logprobs:logprobs,message:{...messageRest,role:role,content:content,refusal:message.refusal??null,tool_calls:tool_calls.map((tool_call,i)=>{const{function:fn,type:type,id:id2,...toolRest}=tool_call;const{arguments:args,name:name,...fnRest}=fn||{};if(id2==null){throw new OpenAIError(`missing choices[${index2}].tool_calls[${i}].id\n${str(snapshot)}`)}if(type==null){throw new OpenAIError(`missing choices[${index2}].tool_calls[${i}].type\n${str(snapshot)}`)}if(name==null){throw new OpenAIError(`missing choices[${index2}].tool_calls[${i}].function.name\n${str(snapshot)}`)}if(args==null){throw new OpenAIError(`missing choices[${index2}].tool_calls[${i}].function.arguments\n${str(snapshot)}`)}return{...toolRest,id:id2,type:type,function:{...fnRest,name:name,arguments:args}}})}}}return{...choiceRest,message:{...messageRest,content:content,role:role,refusal:message.refusal??null},finish_reason:finish_reason,index:index2,logprobs:logprobs}}),created:created,model:model,object:"chat.completion",...system_fingerprint?{system_fingerprint:system_fingerprint}:{}};return maybeParseChatCompletion(completion,params)}function str(x){return JSON.stringify(x)}function assertNever(_x){}class ChatCompletionStreamingRunner extends ChatCompletionStream{static fromReadableStream(stream){const runner=new ChatCompletionStreamingRunner(null);runner._run(()=>runner._fromReadableStream(stream));return runner}static runFunctions(client,params,options){const runner=new ChatCompletionStreamingRunner(null);const opts={...options,headers:{...options==null?void 0:options.headers,"X-Stainless-Helper-Method":"runFunctions"}};runner._run(()=>runner._runFunctions(client,params,opts));return runner}static runTools(client,params,options){const runner=new ChatCompletionStreamingRunner(params);const opts={...options,headers:{...options==null?void 0:options.headers,"X-Stainless-Helper-Method":"runTools"}};runner._run(()=>runner._runTools(client,params,opts));return runner}}let Completions$1=class Completions2 extends APIResource{parse(body,options){validateInputTools(body.tools);return this._client.chat.completions.create(body,{...options,headers:{...options==null?void 0:options.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(completion=>parseChatCompletion(completion,body))}runFunctions(body,options){if(body.stream){return ChatCompletionStreamingRunner.runFunctions(this._client,body,options)}return ChatCompletionRunner.runFunctions(this._client,body,options)}runTools(body,options){if(body.stream){return ChatCompletionStreamingRunner.runTools(this._client,body,options)}return ChatCompletionRunner.runTools(this._client,body,options)}stream(body,options){return ChatCompletionStream.createChatCompletion(this._client,body,options)}};class Chat2 extends APIResource{constructor(){super(...arguments);this.completions=new Completions$1(this._client)}}(function(Chat3){Chat3.Completions=Completions$1})(Chat2||(Chat2={}));class Sessions extends APIResource{create(body,options){return this._client.post("/realtime/sessions",{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}}class TranscriptionSessions extends APIResource{create(body,options){return this._client.post("/realtime/transcription_sessions",{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}}class Realtime extends APIResource{constructor(){super(...arguments);this.sessions=new Sessions(this._client);this.transcriptionSessions=new TranscriptionSessions(this._client)}}Realtime.Sessions=Sessions;Realtime.TranscriptionSessions=TranscriptionSessions;class Messages2 extends APIResource{create(threadId,body,options){return this._client.post(`/threads/${threadId}/messages`,{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}retrieve(threadId,messageId,options){return this._client.get(`/threads/${threadId}/messages/${messageId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}update(threadId,messageId,body,options){return this._client.post(`/threads/${threadId}/messages/${messageId}`,{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}list(threadId,query={},options){if(isRequestOptions(query)){return this.list(threadId,{},query)}return this._client.getAPIList(`/threads/${threadId}/messages`,MessagesPage,{query:query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}del(threadId,messageId,options){return this._client.delete(`/threads/${threadId}/messages/${messageId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}}class MessagesPage extends CursorPage{}Messages2.MessagesPage=MessagesPage;class Steps extends APIResource{retrieve(threadId,runId,stepId,query={},options){if(isRequestOptions(query)){return this.retrieve(threadId,runId,stepId,{},query)}return this._client.get(`/threads/${threadId}/runs/${runId}/steps/${stepId}`,{query:query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}list(threadId,runId,query={},options){if(isRequestOptions(query)){return this.list(threadId,runId,{},query)}return this._client.getAPIList(`/threads/${threadId}/runs/${runId}/steps`,RunStepsPage,{query:query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}}class RunStepsPage extends CursorPage{}Steps.RunStepsPage=RunStepsPage;let Runs$1=class Runs extends APIResource{constructor(){super(...arguments);this.steps=new Steps(this._client)}create(threadId,params,options){const{include:include,...body}=params;return this._client.post(`/threads/${threadId}/runs`,{query:{include:include},body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers},stream:params.stream??false})}retrieve(threadId,runId,options){return this._client.get(`/threads/${threadId}/runs/${runId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}update(threadId,runId,body,options){return this._client.post(`/threads/${threadId}/runs/${runId}`,{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}list(threadId,query={},options){if(isRequestOptions(query)){return this.list(threadId,{},query)}return this._client.getAPIList(`/threads/${threadId}/runs`,RunsPage,{query:query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}cancel(threadId,runId,options){return this._client.post(`/threads/${threadId}/runs/${runId}/cancel`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}async createAndPoll(threadId,body,options){const run=await this.create(threadId,body,options);return await this.poll(threadId,run.id,options)}createAndStream(threadId,body,options){return AssistantStream.createAssistantStream(threadId,this._client.beta.threads.runs,body,options)}async poll(threadId,runId,options){const headers={...options==null?void 0:options.headers,"X-Stainless-Poll-Helper":"true"};if(options==null?void 0:options.pollIntervalMs){headers["X-Stainless-Custom-Poll-Interval"]=options.pollIntervalMs.toString()}while(true){const{data:run,response:response}=await this.retrieve(threadId,runId,{...options,headers:{...options==null?void 0:options.headers,...headers}}).withResponse();switch(run.status){case"queued":case"in_progress":case"cancelling":let sleepInterval=5e3;if(options==null?void 0:options.pollIntervalMs){sleepInterval=options.pollIntervalMs}else{const headerInterval=response.headers.get("openai-poll-after-ms");if(headerInterval){const headerIntervalMs=parseInt(headerInterval);if(!isNaN(headerIntervalMs)){sleepInterval=headerIntervalMs}}}await sleep(sleepInterval);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return run}}}stream(threadId,body,options){return AssistantStream.createAssistantStream(threadId,this._client.beta.threads.runs,body,options)}submitToolOutputs(threadId,runId,body,options){return this._client.post(`/threads/${threadId}/runs/${runId}/submit_tool_outputs`,{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers},stream:body.stream??false})}async submitToolOutputsAndPoll(threadId,runId,body,options){const run=await this.submitToolOutputs(threadId,runId,body,options);return await this.poll(threadId,run.id,options)}submitToolOutputsStream(threadId,runId,body,options){return AssistantStream.createToolAssistantStream(threadId,runId,this._client.beta.threads.runs,body,options)}};class RunsPage extends CursorPage{}Runs$1.RunsPage=RunsPage;Runs$1.Steps=Steps;Runs$1.RunStepsPage=RunStepsPage;class Threads extends APIResource{constructor(){super(...arguments);this.runs=new Runs$1(this._client);this.messages=new Messages2(this._client)}create(body={},options){if(isRequestOptions(body)){return this.create({},body)}return this._client.post("/threads",{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}retrieve(threadId,options){return this._client.get(`/threads/${threadId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}update(threadId,body,options){return this._client.post(`/threads/${threadId}`,{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}del(threadId,options){return this._client.delete(`/threads/${threadId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}createAndRun(body,options){return this._client.post("/threads/runs",{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers},stream:body.stream??false})}async createAndRunPoll(body,options){const run=await this.createAndRun(body,options);return await this.runs.poll(run.thread_id,run.id,options)}createAndRunStream(body,options){return AssistantStream.createThreadAssistantStream(body,this._client.beta.threads,options)}}Threads.Runs=Runs$1;Threads.RunsPage=RunsPage;Threads.Messages=Messages2;Threads.MessagesPage=MessagesPage;class Beta extends APIResource{constructor(){super(...arguments);this.realtime=new Realtime(this._client);this.chat=new Chat2(this._client);this.assistants=new Assistants(this._client);this.threads=new Threads(this._client)}}Beta.Realtime=Realtime;Beta.Assistants=Assistants;Beta.AssistantsPage=AssistantsPage;Beta.Threads=Threads;class Completions3 extends APIResource{create(body,options){return this._client.post("/completions",{body:body,...options,stream:body.stream??false})}}class Content extends APIResource{retrieve(containerId,fileId,options){return this._client.get(`/containers/${containerId}/files/${fileId}/content`,{...options,headers:{Accept:"application/binary",...options==null?void 0:options.headers},__binaryResponse:true})}}let Files$2=class Files extends APIResource{constructor(){super(...arguments);this.content=new Content(this._client)}create(containerId,body,options){return this._client.post(`/containers/${containerId}/files`,multipartFormRequestOptions({body:body,...options}))}retrieve(containerId,fileId,options){return this._client.get(`/containers/${containerId}/files/${fileId}`,options)}list(containerId,query={},options){if(isRequestOptions(query)){return this.list(containerId,{},query)}return this._client.getAPIList(`/containers/${containerId}/files`,FileListResponsesPage,{query:query,...options})}del(containerId,fileId,options){return this._client.delete(`/containers/${containerId}/files/${fileId}`,{...options,headers:{Accept:"*/*",...options==null?void 0:options.headers}})}};class FileListResponsesPage extends CursorPage{}Files$2.FileListResponsesPage=FileListResponsesPage;Files$2.Content=Content;class Containers extends APIResource{constructor(){super(...arguments);this.files=new Files$2(this._client)}create(body,options){return this._client.post("/containers",{body:body,...options})}retrieve(containerId,options){return this._client.get(`/containers/${containerId}`,options)}list(query={},options){if(isRequestOptions(query)){return this.list({},query)}return this._client.getAPIList("/containers",ContainerListResponsesPage,{query:query,...options})}del(containerId,options){return this._client.delete(`/containers/${containerId}`,{...options,headers:{Accept:"*/*",...options==null?void 0:options.headers}})}}class ContainerListResponsesPage extends CursorPage{}Containers.ContainerListResponsesPage=ContainerListResponsesPage;Containers.Files=Files$2;Containers.FileListResponsesPage=FileListResponsesPage;class Embeddings extends APIResource{create(body,options){const hasUserProvidedEncodingFormat=!!body.encoding_format;let encoding_format=hasUserProvidedEncodingFormat?body.encoding_format:"base64";if(hasUserProvidedEncodingFormat){debug("Request","User defined encoding_format:",body.encoding_format)}const response=this._client.post("/embeddings",{body:{...body,encoding_format:encoding_format},...options});if(hasUserProvidedEncodingFormat){return response}debug("response","Decoding base64 embeddings to float32 array");return response._thenUnwrap(response2=>{if(response2&&response2.data){response2.data.forEach(embeddingBase64Obj=>{const embeddingBase64Str=embeddingBase64Obj.embedding;embeddingBase64Obj.embedding=toFloat32Array(embeddingBase64Str)})}return response2})}}class OutputItems extends APIResource{retrieve(evalId,runId,outputItemId,options){return this._client.get(`/evals/${evalId}/runs/${runId}/output_items/${outputItemId}`,options)}list(evalId,runId,query={},options){if(isRequestOptions(query)){return this.list(evalId,runId,{},query)}return this._client.getAPIList(`/evals/${evalId}/runs/${runId}/output_items`,OutputItemListResponsesPage,{query:query,...options})}}class OutputItemListResponsesPage extends CursorPage{}OutputItems.OutputItemListResponsesPage=OutputItemListResponsesPage;class Runs2 extends APIResource{constructor(){super(...arguments);this.outputItems=new OutputItems(this._client)}create(evalId,body,options){return this._client.post(`/evals/${evalId}/runs`,{body:body,...options})}retrieve(evalId,runId,options){return this._client.get(`/evals/${evalId}/runs/${runId}`,options)}list(evalId,query={},options){if(isRequestOptions(query)){return this.list(evalId,{},query)}return this._client.getAPIList(`/evals/${evalId}/runs`,RunListResponsesPage,{query:query,...options})}del(evalId,runId,options){return this._client.delete(`/evals/${evalId}/runs/${runId}`,options)}cancel(evalId,runId,options){return this._client.post(`/evals/${evalId}/runs/${runId}`,options)}}class RunListResponsesPage extends CursorPage{}Runs2.RunListResponsesPage=RunListResponsesPage;Runs2.OutputItems=OutputItems;Runs2.OutputItemListResponsesPage=OutputItemListResponsesPage;class Evals extends APIResource{constructor(){super(...arguments);this.runs=new Runs2(this._client)}create(body,options){return this._client.post("/evals",{body:body,...options})}retrieve(evalId,options){return this._client.get(`/evals/${evalId}`,options)}update(evalId,body,options){return this._client.post(`/evals/${evalId}`,{body:body,...options})}list(query={},options){if(isRequestOptions(query)){return this.list({},query)}return this._client.getAPIList("/evals",EvalListResponsesPage,{query:query,...options})}del(evalId,options){return this._client.delete(`/evals/${evalId}`,options)}}class EvalListResponsesPage extends CursorPage{}Evals.EvalListResponsesPage=EvalListResponsesPage;Evals.Runs=Runs2;Evals.RunListResponsesPage=RunListResponsesPage;let Files$1=class Files2 extends APIResource{create(body,options){return this._client.post("/files",multipartFormRequestOptions({body:body,...options}))}retrieve(fileId,options){return this._client.get(`/files/${fileId}`,options)}list(query={},options){if(isRequestOptions(query)){return this.list({},query)}return this._client.getAPIList("/files",FileObjectsPage,{query:query,...options})}del(fileId,options){return this._client.delete(`/files/${fileId}`,options)}content(fileId,options){return this._client.get(`/files/${fileId}/content`,{...options,headers:{Accept:"application/binary",...options==null?void 0:options.headers},__binaryResponse:true})}retrieveContent(fileId,options){return this._client.get(`/files/${fileId}/content`,options)}async waitForProcessing(id,{pollInterval:pollInterval=5e3,maxWait:maxWait=30*60*1e3}={}){const TERMINAL_STATES=new Set(["processed","error","deleted"]);const start=Date.now();let file=await this.retrieve(id);while(!file.status||!TERMINAL_STATES.has(file.status)){await sleep(pollInterval);file=await this.retrieve(id);if(Date.now()-start>maxWait){throw new APIConnectionTimeoutError({message:`Giving up on waiting for file ${id} to finish processing after ${maxWait} milliseconds.`})}}return file}};class FileObjectsPage extends CursorPage{}Files$1.FileObjectsPage=FileObjectsPage;class Methods extends APIResource{}let Graders$1=class Graders extends APIResource{run(body,options){return this._client.post("/fine_tuning/alpha/graders/run",{body:body,...options})}validate(body,options){return this._client.post("/fine_tuning/alpha/graders/validate",{body:body,...options})}};class Alpha extends APIResource{constructor(){super(...arguments);this.graders=new Graders$1(this._client)}}Alpha.Graders=Graders$1;class Permissions extends APIResource{create(fineTunedModelCheckpoint,body,options){return this._client.getAPIList(`/fine_tuning/checkpoints/${fineTunedModelCheckpoint}/permissions`,PermissionCreateResponsesPage,{body:body,method:"post",...options})}retrieve(fineTunedModelCheckpoint,query={},options){if(isRequestOptions(query)){return this.retrieve(fineTunedModelCheckpoint,{},query)}return this._client.get(`/fine_tuning/checkpoints/${fineTunedModelCheckpoint}/permissions`,{query:query,...options})}del(fineTunedModelCheckpoint,permissionId,options){return this._client.delete(`/fine_tuning/checkpoints/${fineTunedModelCheckpoint}/permissions/${permissionId}`,options)}}class PermissionCreateResponsesPage extends Page{}Permissions.PermissionCreateResponsesPage=PermissionCreateResponsesPage;let Checkpoints$1=class Checkpoints extends APIResource{constructor(){super(...arguments);this.permissions=new Permissions(this._client)}};Checkpoints$1.Permissions=Permissions;Checkpoints$1.PermissionCreateResponsesPage=PermissionCreateResponsesPage;class Checkpoints2 extends APIResource{list(fineTuningJobId,query={},options){if(isRequestOptions(query)){return this.list(fineTuningJobId,{},query)}return this._client.getAPIList(`/fine_tuning/jobs/${fineTuningJobId}/checkpoints`,FineTuningJobCheckpointsPage,{query:query,...options})}}class FineTuningJobCheckpointsPage extends CursorPage{}Checkpoints2.FineTuningJobCheckpointsPage=FineTuningJobCheckpointsPage;class Jobs extends APIResource{constructor(){super(...arguments);this.checkpoints=new Checkpoints2(this._client)}create(body,options){return this._client.post("/fine_tuning/jobs",{body:body,...options})}retrieve(fineTuningJobId,options){return this._client.get(`/fine_tuning/jobs/${fineTuningJobId}`,options)}list(query={},options){if(isRequestOptions(query)){return this.list({},query)}return this._client.getAPIList("/fine_tuning/jobs",FineTuningJobsPage,{query:query,...options})}cancel(fineTuningJobId,options){return this._client.post(`/fine_tuning/jobs/${fineTuningJobId}/cancel`,options)}listEvents(fineTuningJobId,query={},options){if(isRequestOptions(query)){return this.listEvents(fineTuningJobId,{},query)}return this._client.getAPIList(`/fine_tuning/jobs/${fineTuningJobId}/events`,FineTuningJobEventsPage,{query:query,...options})}pause(fineTuningJobId,options){return this._client.post(`/fine_tuning/jobs/${fineTuningJobId}/pause`,options)}resume(fineTuningJobId,options){return this._client.post(`/fine_tuning/jobs/${fineTuningJobId}/resume`,options)}}class FineTuningJobsPage extends CursorPage{}class FineTuningJobEventsPage extends CursorPage{}Jobs.FineTuningJobsPage=FineTuningJobsPage;Jobs.FineTuningJobEventsPage=FineTuningJobEventsPage;Jobs.Checkpoints=Checkpoints2;Jobs.FineTuningJobCheckpointsPage=FineTuningJobCheckpointsPage;class FineTuning extends APIResource{constructor(){super(...arguments);this.methods=new Methods(this._client);this.jobs=new Jobs(this._client);this.checkpoints=new Checkpoints$1(this._client);this.alpha=new Alpha(this._client)}}FineTuning.Methods=Methods;FineTuning.Jobs=Jobs;FineTuning.FineTuningJobsPage=FineTuningJobsPage;FineTuning.FineTuningJobEventsPage=FineTuningJobEventsPage;FineTuning.Checkpoints=Checkpoints$1;FineTuning.Alpha=Alpha;class GraderModels extends APIResource{}class Graders2 extends APIResource{constructor(){super(...arguments);this.graderModels=new GraderModels(this._client)}}Graders2.GraderModels=GraderModels;class Images extends APIResource{createVariation(body,options){return this._client.post("/images/variations",multipartFormRequestOptions({body:body,...options}))}edit(body,options){return this._client.post("/images/edits",multipartFormRequestOptions({body:body,...options}))}generate(body,options){return this._client.post("/images/generations",{body:body,...options})}}class Models extends APIResource{retrieve(model,options){return this._client.get(`/models/${model}`,options)}list(options){return this._client.getAPIList("/models",ModelsPage,options)}del(model,options){return this._client.delete(`/models/${model}`,options)}}class ModelsPage extends Page{}Models.ModelsPage=ModelsPage;class Moderations extends APIResource{create(body,options){return this._client.post("/moderations",{body:body,...options})}}function maybeParseResponse(response,params){if(!params||!hasAutoParseableInput(params)){return{...response,output_parsed:null,output:response.output.map(item=>{if(item.type==="function_call"){return{...item,parsed_arguments:null}}if(item.type==="message"){return{...item,content:item.content.map(content=>({...content,parsed:null}))}}else{return item}})}}return parseResponse(response,params)}function parseResponse(response,params){const output=response.output.map(item=>{if(item.type==="function_call"){return{...item,parsed_arguments:parseToolCall(params,item)}}if(item.type==="message"){const content=item.content.map(content2=>{if(content2.type==="output_text"){return{...content2,parsed:parseTextFormat(params,content2.text)}}return content2});return{...item,content:content}}return item});const parsed=Object.assign({},response,{output:output});if(!Object.getOwnPropertyDescriptor(response,"output_text")){addOutputText(parsed)}Object.defineProperty(parsed,"output_parsed",{enumerable:true,get(){for(const output2 of parsed.output){if(output2.type!=="message"){continue}for(const content of output2.content){if(content.type==="output_text"&&content.parsed!==null){return content.parsed}}}return null}});return parsed}function parseTextFormat(params,content){var _a2,_b,_c,_d;if(((_b=(_a2=params.text)==null?void 0:_a2.format)==null?void 0:_b.type)!=="json_schema"){return null}if("$parseRaw"in((_c=params.text)==null?void 0:_c.format)){const text_format=(_d=params.text)==null?void 0:_d.format;return text_format.$parseRaw(content)}return JSON.parse(content)}function hasAutoParseableInput(params){var _a2;if(isAutoParsableResponseFormat((_a2=params.text)==null?void 0:_a2.format)){return true}return false}function isAutoParsableTool(tool){return(tool==null?void 0:tool["$brand"])==="auto-parseable-tool"}function getInputToolByName(input_tools,name){return input_tools.find(tool=>tool.type==="function"&&tool.name===name)}function parseToolCall(params,toolCall){const inputTool=getInputToolByName(params.tools??[],toolCall.name);return{...toolCall,...toolCall,parsed_arguments:isAutoParsableTool(inputTool)?inputTool.$parseRaw(toolCall.arguments):(inputTool==null?void 0:inputTool.strict)?JSON.parse(toolCall.arguments):null}}function addOutputText(rsp){const texts=[];for(const output of rsp.output){if(output.type!=="message"){continue}for(const content of output.content){if(content.type==="output_text"){texts.push(content.text)}}}rsp.output_text=texts.join("")}class InputItems extends APIResource{list(responseId,query={},options){if(isRequestOptions(query)){return this.list(responseId,{},query)}return this._client.getAPIList(`/responses/${responseId}/input_items`,ResponseItemsPage,{query:query,...options})}}var __classPrivateFieldSet=function(receiver,state2,value,kind2,f){if(kind2==="m")throw new TypeError("Private method is not writable");if(kind2==="a"&&!f)throw new TypeError("Private accessor was defined without a setter");if(typeof state2==="function"?receiver!==state2||!f:!state2.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return kind2==="a"?f.call(receiver,value):f?f.value=value:state2.set(receiver,value),value};var __classPrivateFieldGet=function(receiver,state2,kind2,f){if(kind2==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof state2==="function"?receiver!==state2||!f:!state2.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return kind2==="m"?f:kind2==="a"?f.call(receiver):f?f.value:state2.get(receiver)};var _ResponseStream_instances,_ResponseStream_params,_ResponseStream_currentResponseSnapshot,_ResponseStream_finalResponse,_ResponseStream_beginRequest,_ResponseStream_addEvent,_ResponseStream_endRequest,_ResponseStream_accumulateResponse;class ResponseStream extends EventStream{constructor(params){super();_ResponseStream_instances.add(this);_ResponseStream_params.set(this,void 0);_ResponseStream_currentResponseSnapshot.set(this,void 0);_ResponseStream_finalResponse.set(this,void 0);__classPrivateFieldSet(this,_ResponseStream_params,params,"f")}static createResponse(client,params,options){const runner=new ResponseStream(params);runner._run(()=>runner._createOrRetrieveResponse(client,params,{...options,headers:{...options==null?void 0:options.headers,"X-Stainless-Helper-Method":"stream"}}));return runner}async _createOrRetrieveResponse(client,params,options){var _a2;const signal=options==null?void 0:options.signal;if(signal){if(signal.aborted)this.controller.abort();signal.addEventListener("abort",()=>this.controller.abort())}__classPrivateFieldGet(this,_ResponseStream_instances,"m",_ResponseStream_beginRequest).call(this);let stream;let starting_after=null;if("response_id"in params){stream=await client.responses.retrieve(params.response_id,{stream:true},{...options,signal:this.controller.signal,stream:true});starting_after=params.starting_after??null}else{stream=await client.responses.create({...params,stream:true},{...options,signal:this.controller.signal})}this._connected();for await(const event2 of stream){__classPrivateFieldGet(this,_ResponseStream_instances,"m",_ResponseStream_addEvent).call(this,event2,starting_after)}if((_a2=stream.controller.signal)==null?void 0:_a2.aborted){throw new APIUserAbortError}return __classPrivateFieldGet(this,_ResponseStream_instances,"m",_ResponseStream_endRequest).call(this)}[(_ResponseStream_params=new WeakMap,_ResponseStream_currentResponseSnapshot=new WeakMap,_ResponseStream_finalResponse=new WeakMap,_ResponseStream_instances=new WeakSet,_ResponseStream_beginRequest=function _ResponseStream_beginRequest2(){if(this.ended)return;__classPrivateFieldSet(this,_ResponseStream_currentResponseSnapshot,void 0,"f")},_ResponseStream_addEvent=function _ResponseStream_addEvent2(event2,starting_after){if(this.ended)return;const maybeEmit=(name,event3)=>{if(starting_after==null||event3.sequence_number>starting_after){this._emit(name,event3)}};const response=__classPrivateFieldGet(this,_ResponseStream_instances,"m",_ResponseStream_accumulateResponse).call(this,event2);maybeEmit("event",event2);switch(event2.type){case"response.output_text.delta":{const output=response.output[event2.output_index];if(!output){throw new OpenAIError(`missing output at index ${event2.output_index}`)}if(output.type==="message"){const content=output.content[event2.content_index];if(!content){throw new OpenAIError(`missing content at index ${event2.content_index}`)}if(content.type!=="output_text"){throw new OpenAIError(`expected content to be 'output_text', got ${content.type}`)}maybeEmit("response.output_text.delta",{...event2,snapshot:content.text})}break}case"response.function_call_arguments.delta":{const output=response.output[event2.output_index];if(!output){throw new OpenAIError(`missing output at index ${event2.output_index}`)}if(output.type==="function_call"){maybeEmit("response.function_call_arguments.delta",{...event2,snapshot:output.arguments})}break}default:maybeEmit(event2.type,event2);break}},_ResponseStream_endRequest=function _ResponseStream_endRequest2(){if(this.ended){throw new OpenAIError(`stream has ended, this shouldn't happen`)}const snapshot=__classPrivateFieldGet(this,_ResponseStream_currentResponseSnapshot,"f");if(!snapshot){throw new OpenAIError(`request ended without sending any events`)}__classPrivateFieldSet(this,_ResponseStream_currentResponseSnapshot,void 0,"f");const parsedResponse=finalizeResponse(snapshot,__classPrivateFieldGet(this,_ResponseStream_params,"f"));__classPrivateFieldSet(this,_ResponseStream_finalResponse,parsedResponse,"f");return parsedResponse},_ResponseStream_accumulateResponse=function _ResponseStream_accumulateResponse2(event2){let snapshot=__classPrivateFieldGet(this,_ResponseStream_currentResponseSnapshot,"f");if(!snapshot){if(event2.type!=="response.created"){throw new OpenAIError(`When snapshot hasn't been set yet, expected 'response.created' event, got ${event2.type}`)}snapshot=__classPrivateFieldSet(this,_ResponseStream_currentResponseSnapshot,event2.response,"f");return snapshot}switch(event2.type){case"response.output_item.added":{snapshot.output.push(event2.item);break}case"response.content_part.added":{const output=snapshot.output[event2.output_index];if(!output){throw new OpenAIError(`missing output at index ${event2.output_index}`)}if(output.type==="message"){output.content.push(event2.part)}break}case"response.output_text.delta":{const output=snapshot.output[event2.output_index];if(!output){throw new OpenAIError(`missing output at index ${event2.output_index}`)}if(output.type==="message"){const content=output.content[event2.content_index];if(!content){throw new OpenAIError(`missing content at index ${event2.content_index}`)}if(content.type!=="output_text"){throw new OpenAIError(`expected content to be 'output_text', got ${content.type}`)}content.text+=event2.delta}break}case"response.function_call_arguments.delta":{const output=snapshot.output[event2.output_index];if(!output){throw new OpenAIError(`missing output at index ${event2.output_index}`)}if(output.type==="function_call"){output.arguments+=event2.delta}break}case"response.completed":{__classPrivateFieldSet(this,_ResponseStream_currentResponseSnapshot,event2.response,"f");break}}return snapshot},Symbol.asyncIterator)](){const pushQueue=[];const readQueue=[];let done=false;this.on("event",event2=>{const reader=readQueue.shift();if(reader){reader.resolve(event2)}else{pushQueue.push(event2)}});this.on("end",()=>{done=true;for(const reader of readQueue){reader.resolve(void 0)}readQueue.length=0});this.on("abort",err=>{done=true;for(const reader of readQueue){reader.reject(err)}readQueue.length=0});this.on("error",err=>{done=true;for(const reader of readQueue){reader.reject(err)}readQueue.length=0});return{next:async()=>{if(!pushQueue.length){if(done){return{value:void 0,done:true}}return new Promise((resolve,reject)=>readQueue.push({resolve:resolve,reject:reject})).then(event3=>event3?{value:event3,done:false}:{value:void 0,done:true})}const event2=pushQueue.shift();return{value:event2,done:false}},return:async()=>{this.abort();return{value:void 0,done:true}}}}async finalResponse(){await this.done();const response=__classPrivateFieldGet(this,_ResponseStream_finalResponse,"f");if(!response)throw new OpenAIError("stream ended without producing a ChatCompletion");return response}}function finalizeResponse(snapshot,params){return maybeParseResponse(snapshot,params)}class Responses extends APIResource{constructor(){super(...arguments);this.inputItems=new InputItems(this._client)}create(body,options){return this._client.post("/responses",{body:body,...options,stream:body.stream??false})._thenUnwrap(rsp=>{if("object"in rsp&&rsp.object==="response"){addOutputText(rsp)}return rsp})}retrieve(responseId,query={},options){return this._client.get(`/responses/${responseId}`,{query:query,...options,stream:(query==null?void 0:query.stream)??false})}del(responseId,options){return this._client.delete(`/responses/${responseId}`,{...options,headers:{Accept:"*/*",...options==null?void 0:options.headers}})}parse(body,options){return this._client.responses.create(body,options)._thenUnwrap(response=>parseResponse(response,body))}stream(body,options){return ResponseStream.createResponse(this._client,body,options)}cancel(responseId,options){return this._client.post(`/responses/${responseId}/cancel`,{...options,headers:{Accept:"*/*",...options==null?void 0:options.headers}})}}class ResponseItemsPage extends CursorPage{}Responses.InputItems=InputItems;class Parts extends APIResource{create(uploadId,body,options){return this._client.post(`/uploads/${uploadId}/parts`,multipartFormRequestOptions({body:body,...options}))}}class Uploads extends APIResource{constructor(){super(...arguments);this.parts=new Parts(this._client)}create(body,options){return this._client.post("/uploads",{body:body,...options})}cancel(uploadId,options){return this._client.post(`/uploads/${uploadId}/cancel`,options)}complete(uploadId,body,options){return this._client.post(`/uploads/${uploadId}/complete`,{body:body,...options})}}Uploads.Parts=Parts;const allSettledWithThrow=async promises=>{const results=await Promise.allSettled(promises);const rejected=results.filter(result=>result.status==="rejected");if(rejected.length){for(const result of rejected){console.error(result.reason)}throw new Error(`${rejected.length} promise(s) failed - see the above errors`)}const values=[];for(const result of results){if(result.status==="fulfilled"){values.push(result.value)}}return values};class Files3 extends APIResource{create(vectorStoreId,body,options){return this._client.post(`/vector_stores/${vectorStoreId}/files`,{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}retrieve(vectorStoreId,fileId,options){return this._client.get(`/vector_stores/${vectorStoreId}/files/${fileId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}update(vectorStoreId,fileId,body,options){return this._client.post(`/vector_stores/${vectorStoreId}/files/${fileId}`,{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}list(vectorStoreId,query={},options){if(isRequestOptions(query)){return this.list(vectorStoreId,{},query)}return this._client.getAPIList(`/vector_stores/${vectorStoreId}/files`,VectorStoreFilesPage,{query:query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}del(vectorStoreId,fileId,options){return this._client.delete(`/vector_stores/${vectorStoreId}/files/${fileId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}async createAndPoll(vectorStoreId,body,options){const file=await this.create(vectorStoreId,body,options);return await this.poll(vectorStoreId,file.id,options)}async poll(vectorStoreId,fileId,options){const headers={...options==null?void 0:options.headers,"X-Stainless-Poll-Helper":"true"};if(options==null?void 0:options.pollIntervalMs){headers["X-Stainless-Custom-Poll-Interval"]=options.pollIntervalMs.toString()}while(true){const fileResponse=await this.retrieve(vectorStoreId,fileId,{...options,headers:headers}).withResponse();const file=fileResponse.data;switch(file.status){case"in_progress":let sleepInterval=5e3;if(options==null?void 0:options.pollIntervalMs){sleepInterval=options.pollIntervalMs}else{const headerInterval=fileResponse.response.headers.get("openai-poll-after-ms");if(headerInterval){const headerIntervalMs=parseInt(headerInterval);if(!isNaN(headerIntervalMs)){sleepInterval=headerIntervalMs}}}await sleep(sleepInterval);break;case"failed":case"completed":return file}}}async upload(vectorStoreId,file,options){const fileInfo=await this._client.files.create({file:file,purpose:"assistants"},options);return this.create(vectorStoreId,{file_id:fileInfo.id},options)}async uploadAndPoll(vectorStoreId,file,options){const fileInfo=await this.upload(vectorStoreId,file,options);return await this.poll(vectorStoreId,fileInfo.id,options)}content(vectorStoreId,fileId,options){return this._client.getAPIList(`/vector_stores/${vectorStoreId}/files/${fileId}/content`,FileContentResponsesPage,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}}class VectorStoreFilesPage extends CursorPage{}class FileContentResponsesPage extends Page{}Files3.VectorStoreFilesPage=VectorStoreFilesPage;Files3.FileContentResponsesPage=FileContentResponsesPage;class FileBatches extends APIResource{create(vectorStoreId,body,options){return this._client.post(`/vector_stores/${vectorStoreId}/file_batches`,{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}retrieve(vectorStoreId,batchId,options){return this._client.get(`/vector_stores/${vectorStoreId}/file_batches/${batchId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}cancel(vectorStoreId,batchId,options){return this._client.post(`/vector_stores/${vectorStoreId}/file_batches/${batchId}/cancel`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}async createAndPoll(vectorStoreId,body,options){const batch=await this.create(vectorStoreId,body);return await this.poll(vectorStoreId,batch.id,options)}listFiles(vectorStoreId,batchId,query={},options){if(isRequestOptions(query)){return this.listFiles(vectorStoreId,batchId,{},query)}return this._client.getAPIList(`/vector_stores/${vectorStoreId}/file_batches/${batchId}/files`,VectorStoreFilesPage,{query:query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}async poll(vectorStoreId,batchId,options){const headers={...options==null?void 0:options.headers,"X-Stainless-Poll-Helper":"true"};if(options==null?void 0:options.pollIntervalMs){headers["X-Stainless-Custom-Poll-Interval"]=options.pollIntervalMs.toString()}while(true){const{data:batch,response:response}=await this.retrieve(vectorStoreId,batchId,{...options,headers:headers}).withResponse();switch(batch.status){case"in_progress":let sleepInterval=5e3;if(options==null?void 0:options.pollIntervalMs){sleepInterval=options.pollIntervalMs}else{const headerInterval=response.headers.get("openai-poll-after-ms");if(headerInterval){const headerIntervalMs=parseInt(headerInterval);if(!isNaN(headerIntervalMs)){sleepInterval=headerIntervalMs}}}await sleep(sleepInterval);break;case"failed":case"cancelled":case"completed":return batch}}}async uploadAndPoll(vectorStoreId,{files:files,fileIds:fileIds=[]},options){if(files==null||files.length==0){throw new Error(`No \`files\` provided to process. If you've already uploaded files you should use \`.createAndPoll()\` instead`)}const configuredConcurrency=(options==null?void 0:options.maxConcurrency)??5;const concurrencyLimit=Math.min(configuredConcurrency,files.length);const client=this._client;const fileIterator=files.values();const allFileIds=[...fileIds];async function processFiles(iterator){for(let item of iterator){const fileObj=await client.files.create({file:item,purpose:"assistants"},options);allFileIds.push(fileObj.id)}}const workers=Array(concurrencyLimit).fill(fileIterator).map(processFiles);await allSettledWithThrow(workers);return await this.createAndPoll(vectorStoreId,{file_ids:allFileIds})}}class VectorStores extends APIResource{constructor(){super(...arguments);this.files=new Files3(this._client);this.fileBatches=new FileBatches(this._client)}create(body,options){return this._client.post("/vector_stores",{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}retrieve(vectorStoreId,options){return this._client.get(`/vector_stores/${vectorStoreId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}update(vectorStoreId,body,options){return this._client.post(`/vector_stores/${vectorStoreId}`,{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}list(query={},options){if(isRequestOptions(query)){return this.list({},query)}return this._client.getAPIList("/vector_stores",VectorStoresPage,{query:query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}del(vectorStoreId,options){return this._client.delete(`/vector_stores/${vectorStoreId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}search(vectorStoreId,body,options){return this._client.getAPIList(`/vector_stores/${vectorStoreId}/search`,VectorStoreSearchResponsesPage,{body:body,method:"post",...options,headers:{"OpenAI-Beta":"assistants=v2",...options==null?void 0:options.headers}})}}class VectorStoresPage extends CursorPage{}class VectorStoreSearchResponsesPage extends Page{}VectorStores.VectorStoresPage=VectorStoresPage;VectorStores.VectorStoreSearchResponsesPage=VectorStoreSearchResponsesPage;VectorStores.Files=Files3;VectorStores.VectorStoreFilesPage=VectorStoreFilesPage;VectorStores.FileContentResponsesPage=FileContentResponsesPage;VectorStores.FileBatches=FileBatches;var _a;class OpenAI extends APIClient{constructor({baseURL:baseURL=readEnv("OPENAI_BASE_URL"),apiKey:apiKey=readEnv("OPENAI_API_KEY"),organization:organization=readEnv("OPENAI_ORG_ID")??null,project:project=readEnv("OPENAI_PROJECT_ID")??null,...opts}={}){if(apiKey===void 0){throw new OpenAIError("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).")}const options={apiKey:apiKey,organization:organization,project:project,...opts,baseURL:baseURL||`https://api.openai.com/v1`};if(!options.dangerouslyAllowBrowser&&isRunningInBrowser()){throw new OpenAIError("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n")}super({baseURL:options.baseURL,timeout:options.timeout??6e5,httpAgent:options.httpAgent,maxRetries:options.maxRetries,fetch:options.fetch});this.completions=new Completions3(this);this.chat=new Chat$1(this);this.embeddings=new Embeddings(this);this.files=new Files$1(this);this.images=new Images(this);this.audio=new Audio(this);this.moderations=new Moderations(this);this.models=new Models(this);this.fineTuning=new FineTuning(this);this.graders=new Graders2(this);this.vectorStores=new VectorStores(this);this.beta=new Beta(this);this.batches=new Batches(this);this.uploads=new Uploads(this);this.responses=new Responses(this);this.evals=new Evals(this);this.containers=new Containers(this);this._options=options;this.apiKey=apiKey;this.organization=organization;this.project=project}defaultQuery(){return this._options.defaultQuery}defaultHeaders(opts){return{...super.defaultHeaders(opts),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(opts){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(query){return stringify(query,{arrayFormat:"brackets"})}}_a=OpenAI;OpenAI.OpenAI=_a;OpenAI.DEFAULT_TIMEOUT=6e5;OpenAI.OpenAIError=OpenAIError;OpenAI.APIError=APIError;OpenAI.APIConnectionError=APIConnectionError;OpenAI.APIConnectionTimeoutError=APIConnectionTimeoutError;OpenAI.APIUserAbortError=APIUserAbortError;OpenAI.NotFoundError=NotFoundError;OpenAI.ConflictError=ConflictError;OpenAI.RateLimitError=RateLimitError;OpenAI.BadRequestError=BadRequestError;OpenAI.AuthenticationError=AuthenticationError;OpenAI.InternalServerError=InternalServerError;OpenAI.PermissionDeniedError=PermissionDeniedError;OpenAI.UnprocessableEntityError=UnprocessableEntityError;OpenAI.toFile=toFile;OpenAI.fileFromPath=fileFromPath;OpenAI.Completions=Completions3;OpenAI.Chat=Chat$1;OpenAI.ChatCompletionsPage=ChatCompletionsPage;OpenAI.Embeddings=Embeddings;OpenAI.Files=Files$1;OpenAI.FileObjectsPage=FileObjectsPage;OpenAI.Images=Images;OpenAI.Audio=Audio;OpenAI.Moderations=Moderations;OpenAI.Models=Models;OpenAI.ModelsPage=ModelsPage;OpenAI.FineTuning=FineTuning;OpenAI.Graders=Graders2;OpenAI.VectorStores=VectorStores;OpenAI.VectorStoresPage=VectorStoresPage;OpenAI.VectorStoreSearchResponsesPage=VectorStoreSearchResponsesPage;OpenAI.Beta=Beta;OpenAI.Batches=Batches;OpenAI.BatchesPage=BatchesPage;OpenAI.Uploads=Uploads;OpenAI.Responses=Responses;OpenAI.Evals=Evals;OpenAI.EvalListResponsesPage=EvalListResponsesPage;OpenAI.Containers=Containers;OpenAI.ContainerListResponsesPage=ContainerListResponsesPage;async function fetchGPT4Response(prompt){let response=null;const apiKey=getYakklGPTKeyStore();try{const openai=new OpenAI({apiKey:apiKey,dangerouslyAllowBrowser:true});response=await openai.chat.completions.create({model:"gpt-4o",messages:[{role:"user",content:prompt}]});return{usage:response.usage,content:response.choices[0].message.content}}catch(error){log.error("Error fetching GPT response:",false,error);log.error("Response:",false,response);throw{error:error,response:response}}}async function apiKeyFetch(apiUrl,keyId){try{const response=await fetch(`${apiUrl}/api/syek/${keyId}`);const data=await response.json();return data.key}catch(error){log.error("Error fetching key:",false,keyId);throw error}}Chatbot[FILENAME]="src/lib/components/Chatbot.svelte";async function clearMessages(_,messages,$yakklChatsStore,showClearWarning,errorValue,error){try{messages.length=0;store_set(yakklChatsStore,[]);await setYakklChatsStorage([]);set(showClearWarning,false)}catch(e){set(errorValue,"Error clearing messages. "+e);set(error,true)}}function handlePrint(){log.error("Print functionality not implemented yet")}var on_click$7=(__1,showClearWarning)=>set(showClearWarning,true);var on_click_1$1=()=>handleOpenInTab("https://yakkl.com/university/support?utm_source=yakkl&utm_medium=extension&utm_campaign=yakkl_gpt&utm_content=knowledge_base&utm_term=extension");var root_3$5=add_locations(from_html(`<img src="/images/bot-avatar.png" alt="Bot avatar" class="w-8 h-8 rounded-full mr-2"/>`),Chatbot[FILENAME],[[180,7]]);var root_2$4=add_locations(from_html(`<div><div class="flex items-start max-w-[70%]"><!> <div><p><!></p> <div> </div></div> <!></div></div>`),Chatbot[FILENAME],[[177,4,[[178,5,[[186,6,[[191,7],[192,7]]]]]]]]);var root_1$5=add_locations(from_html(`<pre class="hidden"> </pre> <!>`,1),Chatbot[FILENAME],[[174,3]]);var root_5$5=add_locations(from_html(`<div class="flex justify-center items-center"><!></div>`),Chatbot[FILENAME],[[206,3]]);var on_click_2$1=(__2,showClearWarning)=>set(showClearWarning,false);var root_6$6=add_locations(from_html(`<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"><div class="bg-white p-6 rounded-lg shadow-xl"><h3 class="text-lg font-bold mb-4">Clear all messages?</h3> <p class="mb-4">Are you sure you want to clear all messages? This action cannot be undone.</p> <div class="flex justify-end"><button class="btn btn-sm btn-outline mr-2">Cancel</button> <button class="btn btn-sm btn-error">Clear</button></div></div></div>`),Chatbot[FILENAME],[[214,1,[[215,2,[[216,3],[217,3],[218,3,[[219,4],[222,4]]]]]]]]);var root$9=add_locations(from_html(`<div class="flex flex-col h-full"><!> <div class="grid grid-cols-2 gap-4 mb-4 px-2"><button class="btn btn-sm btn-outline w-full">Print conversation</button> <button class="btn btn-sm btn-outline btn-error w-full">Clear messages</button> <button class="btn btn-sm btn-primary col-span-2 w-full">YAKKL¬Æ Knowledge base</button></div> <div class="flex-grow overflow-y-auto bg-gray-100 p-4 rounded-lg border border-gray-300"><!> <!></div></div> <!>`,1),Chatbot[FILENAME],[[145,0,[[148,1,[[149,2],[152,2],[158,2]]],[169,1]]]]);function Chatbot($$anchor,$$props){check_target(new.target);push$1($$props,true,Chatbot);const[$$stores,$$cleanup]=setup_stores();const $yakklGPTRunningStore=()=>(validate_store(yakklGPTRunningStore,"yakklGPTRunningStore"),store_get(yakklGPTRunningStore,"$yakklGPTRunningStore",$$stores));const $yakklGPTKeyStore=()=>(validate_store(yakklGPTKeyStore,"yakklGPTKeyStore"),store_get(yakklGPTKeyStore,"$yakklGPTKeyStore",$$stores));const $yakklChatsStore=()=>(validate_store(yakklChatsStore,"yakklChatsStore"),store_get(yakklChatsStore,"$yakklChatsStore",$$stores));const $yakklConnectionStore=()=>(validate_store(yakklConnectionStore,"yakklConnectionStore"),store_get(yakklConnectionStore,"$yakklConnectionStore",$$stores));let messages=tag_proxy(proxy([]),"messages");let error=tag(state$1(false),"error");let errorValue=tag(state$1("An error has occurred. Please try again."),"errorValue");let clipboard;let showClearWarning=tag(state$1(false),"showClearWarning");store_set(yakklGPTRunningStore,false);if(browserSvelte){try{clipboard=new ClipboardJS(".clip")}catch(e){log.error(e)}}onMount(async()=>{try{messages.length=0;if(strict_equals($yakklGPTKeyStore(),null)||strict_equals($yakklGPTKeyStore(),void 0)){await apiKeyFetch("https://vault-backend.yakkl.workers.dev","tpg").then(results=>{if(results){store_set(yakklGPTKeyStore,results)}else{throw"Error loading auth."}})}const loadedMessages=await getYakklChats();if(Array.isArray(loadedMessages)){loadedMessages.forEach(msg=>{if(msg&&strict_equals(typeof msg,"object")){messages.push(msg)}})}}catch(e){log.error("Error in onMount:",false,e);set(errorValue,"Error loading key or chat history. "+e);set(error,true)}});onDestroy(async()=>{await storeChats()});async function storeChats(){try{const messageArray=Array.isArray(messages)?[...messages]:[];const cleanMessages=messageArray.map(msg=>({text:msg.text||"",sender:msg.sender||"",timestamp:msg.timestamp||Date.now().toString(),usage:msg.usage||{},id:msg.id||"",persona:msg.persona||DEFAULT_PERSONA,version:msg.version||VERSION$1,createDate:msg.createDate||dateString(),updateDate:msg.updateDate||dateString()}));store_set(yakklChatsStore,cleanMessages);await setYakklChatsStorage(cleanMessages)}catch(e){log.error("Error storing chats:",false,e);throw e}}async function handleSendMessage(input){var _a2;if(strict_equals(input.trim(),""))return;let response=null;let dateNow=dateString();try{if(!$yakklConnectionStore()){throw"Warning. Your Internet connection appears to be down. Try again later."}store_set(yakklGPTRunningStore,true);const newUserMessage={text:input,sender:"user",timestamp:Date.now().toString(),usage:{},id:"",version:VERSION$1,createDate:dateNow,updateDate:dateNow};messages.push(newUserMessage);response=await fetchGPT4Response(input);let formattedResponse=(_a2=response==null?void 0:response.content)==null?void 0:_a2.replace(/[\n]+/g,"<br/><br/>");const newBotMessage={text:formattedResponse?formattedResponse:"",sender:"yak",timestamp:Date.now().toString(),usage:response==null?void 0:response.usage,id:"",version:VERSION$1,createDate:dateNow,updateDate:dateNow};messages.push(newBotMessage);store_set(yakklChatsStore,[...messages]);await storeChats()}catch(e){set(errorValue,`An error occurred: ${(e==null?void 0:e.message)||e}`);set(error,true)}finally{store_set(yakklGPTRunningStore,false)}}var fragment=root$9();var div=first_child(fragment);var node=child(div);ErrorNoAction(node,{get value(){return get$1(errorValue)},title:"ERROR!",get show(){return get$1(error)},set show($$value){set(error,$$value,true)}});var div_1=sibling(node,2);var button=child(div_1);button.__click=[handlePrint];var button_1=sibling(button,2);button_1.__click=[on_click$7,showClearWarning];var button_2=sibling(button_1,2);button_2.__click=[on_click_1$1];reset(div_1);var div_2=sibling(div_1,2);var node_1=child(div_2);{var consequent_2=$$anchor2=>{var fragment_1=root_1$5();var pre=first_child(fragment_1);var text2=child(pre,true);reset(pre);var node_2=sibling(pre,2);each(node_2,17,()=>messages,index,($$anchor3,message)=>{var div_3=root_2$4();var div_4=child(div_3);var node_3=child(div_4);{var consequent=$$anchor4=>{var img=root_3$5();append($$anchor4,img)};if_block(node_3,$$render=>{if(strict_equals(get$1(message).sender,"user",false))$$render(consequent)})}var div_5=sibling(node_3,2);var p=child(div_5);var node_4=child(p);html(node_4,()=>get$1(message).text);reset(p);var div_6=sibling(p,2);var text_1=child(div_6,true);reset(div_6);reset(div_5);var node_5=sibling(div_5,2);{var consequent_1=$$anchor4=>{Avatar$1($$anchor4,{class:"w-8 h-8 rounded-full ml-2"})};if_block(node_5,$$render=>{if(strict_equals(get$1(message).sender,"user"))$$render(consequent_1)})}reset(div_4);reset(div_3);template_effect($0=>{set_class(div_3,1,`mb-4 flex ${strict_equals(get$1(message).sender,"user")?"justify-end":"justify-start"}`);set_class(div_5,1,`${strict_equals(get$1(message).sender,"user")?"bg-blue-500 text-white":"bg-gray-300 text-gray-700"} rounded-lg p-3`);set_class(div_6,1,`text-xs mt-1 ${strict_equals(get$1(message).sender,"user")?"text-blue-200":"text-gray-700"}`);set_text(text_1,$0)},[()=>formatTimestamp(get$1(message).timestamp)]);append($$anchor3,div_3)});template_effect($0=>set_text(text2,$0),[()=>JSON.stringify(messages,null,2)]);append($$anchor2,fragment_1)};if_block(node_1,$$render=>{if(messages)$$render(consequent_2)})}var node_6=sibling(node_1,2);{var consequent_3=$$anchor2=>{var div_7=root_5$5();var node_7=child(div_7);Spinner(node_7,{color:"purple",size:8});reset(div_7);append($$anchor2,div_7)};if_block(node_6,$$render=>{if($yakklGPTRunningStore())$$render(consequent_3)})}reset(div_2);action(div_2,$$node=>{var _a2;return(_a2=autoscroll)==null?void 0:_a2($$node)});reset(div);var node_8=sibling(div,2);{var consequent_4=$$anchor2=>{var div_8=root_6$6();var div_9=child(div_8);var div_10=sibling(child(div_9),4);var button_3=child(div_10);button_3.__click=[on_click_2$1,showClearWarning];var button_4=sibling(button_3,2);button_4.__click=[clearMessages,messages,$yakklChatsStore,showClearWarning,errorValue,error];reset(div_10);reset(div_9);reset(div_8);append($$anchor2,div_8)};if_block(node_8,$$render=>{if(get$1(showClearWarning))$$render(consequent_4)})}append($$anchor,fragment);var $$pop=pop({get handleSendMessage(){return handleSendMessage},...legacy_api()});$$cleanup();return $$pop}delegate(["click"]);ChatbotModal[FILENAME]="src/lib/components/ChatbotModal.svelte";var on_keydown=(e,sendMessage)=>{if(strict_equals(e.key,"Enter")&&!e.shiftKey){e.preventDefault();sendMessage()}};var root_1$4=add_locations(from_html(`<div class="flex w-full items-center"><textarea class="flex-grow rounded-l-lg textarea textarea-bordered resize-none h-20 bg-gray-200 text-gray-950" placeholder="Type your question..." rows="3"></textarea> <button class="btn btn-primary rounded-r-lg h-20">Send</button></div> <p class="text-xs text-gray-500 mt-2">Powered by OpenAI and/or Claude. Limited preview w/restrictions. Use with caution.</p>`,1),ChatbotModal[FILENAME],[[22,2,[[23,3],[35,3]]],[37,2]]);function ChatbotModal($$anchor,$$props){check_target(new.target);push$1($$props,true,ChatbotModal);var $$ownership_validator=create_ownership_validator($$props);let show=prop($$props,"show",15,false);let input=tag(state$1(""),"input");let chatbotComponent=tag(state$1(void 0),"chatbotComponent");function sendMessage(){if(strict_equals(get$1(input).trim(),"",false)){get$1(chatbotComponent).handleSendMessage(get$1(input));set(input,"")}}{const footer=wrap_snippet(ChatbotModal,function($$anchor2){validate_snippet_args(...arguments);var fragment_1=root_1$4();var div=first_child(fragment_1);var textarea=child(div);remove_textarea_child(textarea);textarea.__keydown=[on_keydown,sendMessage];var button=sibling(textarea,2);button.__click=sendMessage;reset(div);next(2);bind_value(textarea,()=>get$1(input),$$value=>set(input,$$value));append($$anchor2,fragment_1)});$$ownership_validator.binding("show",Modal,show);Modal($$anchor,{title:"YAKKL AI (LIMITED preview)",className:"z-[999] w-[100%] h-[90vh] max-w-none",get show(){return show()},set show($$value){show($$value)},footer:footer,children:wrap_snippet(ChatbotModal,($$anchor2,$$slotProps)=>{bind_this(Chatbot($$anchor2,{}),$$value=>set(chatbotComponent,$$value,true),()=>get$1(chatbotComponent))}),$$slots:{footer:true,default:true}})}return pop({...legacy_api()})}delegate(["keydown","click"]);Buy[FILENAME]="src/lib/components/Buy.svelte";function handleBuy(_e,show){show(false);handleOpenInTab("https://yakkl.com/crypto/buy?utm_source=yakkl&utm_medium=extension&utm_campaign=buy&utm_content=extension&utm_term=extension")}var on_click$6=(_,show)=>{show(false)};var root$8=add_locations(from_html(`<div><div class="modal-box relative justify-center"><h3 class="text-lg font-bold">Buy Crypto</h3> <p class="py-4">Stripe is our provider and this launches a buy page in the browser...</p> <div class="modal-action"><button class="btn">Cancel</button> <button class="btn">Continue <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></button></div></div></div>`),Buy[FILENAME],[[11,0,[[12,1,[[13,2],[14,2],[15,2,[[16,3],[22,3,[[24,4,[[32,5]]]]]]]]]]]]);function Buy($$anchor,$$props){check_target(new.target);push$1($$props,true,Buy);let show=prop($$props,"show",15,false);var div=root$8();let classes;var div_1=child(div);var div_2=sibling(child(div_1),4);var button=child(div_2);button.__click=[on_click$6,show];var button_1=sibling(button,2);button_1.__click=[handleBuy,show];reset(div_2);reset(div_1);reset(div);template_effect($0=>classes=set_class(div,1,"modal",null,classes,$0),[()=>({"modal-open":show()})]);append($$anchor,div);return pop({...legacy_api()})}delegate(["click"]);Footer[FILENAME]="src/lib/components/Footer.svelte";var on_click$5=(_,showChat)=>{set(showChat,true)};var root$7=add_locations(from_html(`<!> <!> <!>  <footer><div class="relative flex items-center justify-between my-2 mb-0 bg-primary/80 text-base-content rounded-lg shadow-lg"><span class="flex flex-1 justify-evenly max-w-[40%]"><div role="button" class="m-1 flex flex-col fill-base-content hover:fill-base-300 hover:text-base-300 items-center justify-center" data-bs-toggle="tooltip" data-bs-placement="top" title="Welcome Page" aria-label="home"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.47 3.84a.75.75 0 011.06 0l8.69 8.69a.75.75 0 101.06-1.06l-8.689-8.69a2.25 2.25 0 00-3.182 0l-8.69 8.69a.75.75 0 001.061 1.06l8.69-8.69z"></path><path d="M12 5.432l8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 01-.75-.75v-4.5a.75.75 0 00-.75-.75h-3a.75.75 0 00-.75.75V21a.75.75 0 01-.75.75H5.625a1.875 1.875 0 01-1.875-1.875v-6.198a2.29 2.29 0 00.091-.086L12 5.43z"></path></svg> <span class="xs:text-xs sm:text-sm md:text-base">Home</span></div>   <div role="button" class="m-1 flex flex-col fill-base-content hover:fill-base-300 hover:text-base-300 items-center justify-center" data-bs-toggle="tooltip" data-bs-placement="top" title="Send" aria-label="wallet send"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 font-bold"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 19.5l15-15m0 0H8.25m11.25 0v11.25"></path></svg> <span class="xs:text-xs sm:text-sm md:text-base">Send</span></div></span>  <div class="static bg-gray-100 rounded-full w-[50px] h-[50px] shadow-lg z-50"><div class="relative bg-gray-300/75 rounded-full m-1 h-[39px] drop-shadow-lg hover:drop-shadow-xl"><div role="button" class="relative m-1 w-[40px] h-[40px] fill-primary hover:fill-primary/50 text-primary hover:text-primary/50" data-bs-toggle="tooltip" data-bs-placement="top" title="Ring for Help" aria-label="help"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8 mt-0.5 -ml-[.05rem]"><path fill-rule="evenodd" d="M9 4.5a.75.75 0 01.721.544l.813 2.846a3.75 3.75 0 002.576 2.576l2.846.813a.75.75 0 010 1.442l-2.846.813a3.75 3.75 0 00-2.576 2.576l-.813 2.846a.75.75 0 01-1.442 0l-.813-2.846a3.75 3.75 0 00-2.576-2.576l-2.846-.813a.75.75 0 010-1.442l2.846-.813A3.75 3.75 0 007.466 7.89l.813-2.846A.75.75 0 019 4.5zM18 1.5a.75.75 0 01.728.568l.258 1.036c.236.94.97 1.674 1.91 1.91l1.036.258a.75.75 0 010 1.456l-1.036.258c-.94.236-1.674.97-1.91 1.91l-.258 1.036a.75.75 0 01-1.456 0l-.258-1.036a2.625 2.625 0 00-1.91-1.91l-1.036-.258a.75.75 0 010-1.456l1.036-.258a2.625 2.625 0 001.91-1.91l.258-1.036A.75.75 0 0118 1.5zM16.5 15a.75.75 0 01.712.513l.394 1.183c.15.447.5.799.948.948l1.183.395a.75.75 0 010 1.422l-1.183.395c-.447.15-.799.5-.948.948l-.395 1.183a.75.75 0 01-1.422 0l-.395-1.183a1.5 1.5 0 00-.948-.948l-1.183-.395a.75.75 0 010-1.422l1.183-.395c.447-.15.799-.5.948-.948l.395-1.183A.75.75 0 0116.5 15z" clip-rule="evenodd"></path></svg> <p class="text-xs ml-[.3rem] -mt-[.25rem]" style="line-height: .75rem; font-size: smaller">Help</p></div></div></div> <span class="flex flex-1 justify-evenly max-w-[40%]"><div role="button" class="m-1 flex flex-col fill-base-content hover:fill-base-300 hover:text-base-300 items-center justify-center" data-bs-toggle="tooltip" data-bs-placement="top" title="Buy" aria-label="Buy"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg> <span class="xs:text-xs sm:text-sm md:text-base">Buy</span></div>  <div role="button" class="flex flex-col fill-base-content hover:fill-base-300 hover:text-base-300 items-center justify-center" data-bs-toggle="tooltip" data-bs-placement="top" title="Swap" aria-label="swap"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 font-bold"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 00-3.7-3.7 48.678 48.678 0 00-7.324 0 4.006 4.006 0 00-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3l-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 003.7 3.7 48.656 48.656 0 007.324 0 4.006 4.006 0 003.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3l-3 3"></path></svg> <span class="xs:text-xs sm:text-sm md:text-base">Swap</span></div></span></div> <div class="inline-block mx-auto w-full text-center label-text"><span style="font-size: 10px;"> </span></div></footer>`,1),Footer[FILENAME],[[135,0,[[139,1,[[142,2,[[146,3,[[155,4,[[160,5],[163,5]]],[167,4]]],[173,3,[[182,4,[[190,5]]],[197,4]]]]],[203,2,[[204,3,[[210,4,[[221,5,[[227,6]]],[235,5]]]]]]],[245,2,[[249,3,[[258,4,[[266,5]]],[272,4]]],[278,3,[[287,4,[[295,5]]],[301,4]]]]]]],[307,1,[[311,2]]]]]]);function Footer($$anchor,$$props){check_target(new.target);push$1($$props,true,Footer);let id=prop($$props,"id",3,"footer");prop($$props,"containerWidth",3,"428");let classParam=prop($$props,"classParam",3,"text-center");let showChat=tag(state$1(false),"showChat");let showBuy=tag(state$1(false),"showBuy");let showSwap=tag(state$1(false),"showSwap");let planType=tag(state$1(proxy(PlanType.BASIC_MEMBER.toUpperCase())),"planType");let yakklMiscStore2;let yakklSettingsStore;let fundingAddress=tag(state$1(""),"fundingAddress");let swapPriceProvider=null;let provider=tag(state$1(void 0),"provider");let chainId=1;let blockchain=tag(state$1(void 0),"blockchain");let swapManager=tag(state$1(void 0),"swapManager");let tokenService=tag(state$1(void 0),"tokenService");onMount(async()=>{try{yakklMiscStore2=getMiscStore();if(!yakklMiscStore2){return}yakklSettingsStore=await getSettings();if(yakklSettingsStore){set(planType,yakklSettingsStore.plan.type.toUpperCase(),true)}const currentlySelected=await getYakklCurrentlySelected();if(currentlySelected){set(fundingAddress,currentlySelected.shortcuts.address,true)}if(strict_equals(swapPriceProvider,null)){let wallet=null;wallet=WalletManager.getInstance(["Alchemy"],["Ethereum"],chainId??1,"pBm4VA9q8Laz9x3bmXTNZ9m-ArxczEWk");if(wallet){if(!wallet.getSigner()){const accountKey=await getYakklCurrentlySelectedAccountKey();if(accountKey&&accountKey.privateKey)await wallet.setSigner(accountKey.privateKey)}set(provider,wallet.getProvider(),true);if(get$1(provider)){const signer=wallet.getSigner();if(signer){get$1(provider).setSigner(signer)}set(blockchain,wallet.getBlockchain(),true);set(swapManager,new UniswapSwapManager(get$1(blockchain),get$1(provider)),true);set(tokenService,new TokenService(get$1(blockchain)),true)}}}}catch(e){log.error(`Footer: onMount - ${e}`)}});async function home(){let path;if(!yakklMiscStore2){path=PATH_LOGIN}else{path=PATH_WELCOME}goto(path)}async function send(){let path;if(!yakklMiscStore2){path=PATH_LOGIN}else{path=PATH_ETHEREUM_TRANSACTIONS_SEND}goto(path)}async function buy(){let path;if(!yakklMiscStore2){path=PATH_LOGIN;goto(path)}else{set(showBuy,true)}}async function swap(){let path;if(!yakklMiscStore2){path=PATH_LOGIN;goto(path)}else{set(showSwap,true)}}var fragment=root$7();var node=first_child(fragment);ChatbotModal(node,{get show(){return get$1(showChat)},set show($$value){set(showChat,$$value,true)}});var node_1=sibling(node,2);Buy(node_1,{get show(){return get$1(showBuy)},set show($$value){set(showBuy,$$value,true)}});var node_2=sibling(node_1,2);Swap(node_2,{get fundingAddress(){return get$1(fundingAddress)},get provider(){return get$1(provider)},get blockchain(){return get$1(blockchain)},get swapManager(){return get$1(swapManager)},get tokenService(){return get$1(tokenService)},get show(){return get$1(showSwap)},set show($$value){set(showSwap,$$value,true)}});var footer=sibling(node_2,2);var div=child(footer);var span=child(div);var div_1=child(span);div_1.__click=home;var svg=child(div_1);set_class(svg,0,"w-6 h-6 stroke-primary/5 stroke-[1px]");next(2);reset(div_1);var div_2=sibling(div_1,2);div_2.__click=send;reset(span);var div_3=sibling(span,2);var div_4=child(div_3);var div_5=child(div_4);div_5.__click=[on_click$5,showChat];reset(div_4);reset(div_3);var span_1=sibling(div_3,2);var div_6=child(span_1);div_6.__click=buy;var div_7=sibling(div_6,2);div_7.__click=swap;reset(span_1);reset(div);var div_8=sibling(div,2);var span_2=child(div_8);var text2=child(span_2);reset(span_2);reset(div_8);reset(footer);template_effect($0=>{set_attribute(footer,"id",id());set_class(footer,1,`visible fixed mb-0 inset-x-0 bottom-0 mx-4 mt-0 bg-gradient-to-br from-gray-900 via-gray-800 to-black ${classParam()??""}`);set_text(text2,`YAKKL¬Æ ¬©Copyright ${$0??""}, Version: ${VERSION$1}\n\t\t\t${get$1(planType)??""}`)},[()=>(new Date).getFullYear().toString()]);append($$anchor,fragment);return pop({...legacy_api()})}delegate(["click"]);InAppNotifications[FILENAME]="src/lib/components/InAppNotifications.svelte";var root_2$3=add_locations(from_html(`<div class="absolute -top-1 -right-1 w-3 h-3 bg-yellow-400 rounded-full animate-ping"></div>`),InAppNotifications[FILENAME],[[232,7]]);var on_click$4=(_,dismissAll)=>dismissAll();var on_click_1=(__1,dismissAll)=>dismissAll();var root_1$3=add_locations(from_html(`<div><div class="max-w-7xl mx-auto px-4 py-3"><div class="flex items-center justify-between"><div class="flex items-center space-x-3"><div class="relative"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg> <!></div> <div class="flex-1"><div class="font-semibold text-lg">üîí YAKKL Security Alert</div> <div class="text-red-100 text-sm">Wallet will lock due to inactivity - take any action to stay active</div></div></div> <div class="flex items-center space-x-4"><div class="text-center"><div class="text-xs text-red-200 uppercase tracking-wide">Time Remaining</div> <div> </div> <div class="text-xs text-red-200">seconds</div></div> <div class="relative w-16 h-16"><svg class="w-16 h-16 transform -rotate-90" viewBox="0 0 32 32"><circle cx="16" cy="16" r="14" stroke="currentColor" stroke-width="2" fill="none" class="text-red-800"></circle><circle cx="16" cy="16" r="14" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"></circle></svg> <div class="absolute inset-0 flex items-center justify-center"><div class="text-xs font-bold text-white"> </div></div></div></div> <div class="flex items-center space-x-3"><button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-red-600">‚úÖ I'm Active</button> <button class="text-red-200 hover:text-white transition-colors duration-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div></div></div></div>`),InAppNotifications[FILENAME],[[208,1,[[213,2,[[214,3,[[216,4,[[217,5,[[218,6,[[225,7]]]]],[238,5,[[239,6],[240,6]]]]],[247,4,[[248,5,[[249,6],[250,6],[258,6]]],[262,5,[[263,6,[[265,7],[275,7]]],[291,6,[[292,7]]]]]]],[300,4,[[301,5],[309,5,[[313,6,[[319,7]]]]]]]]]]]]]]);var on_click_2=(__2,dismiss,notification)=>dismiss(get$1(notification).id);var on_click_3=(__3,dismiss,notification)=>dismiss(get$1(notification).id);var root_6$5=add_locations(from_html(`<div class="p-4 bg-yellow-600 text-white rounded-lg shadow-lg"><div class="flex justify-between items-start"><div class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg> <h3 class="font-bold text-lg"> </h3></div> <button class="text-white hover:text-gray-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div> <p class="mt-2"> </p> <div class="mt-3 flex justify-end"><button class="bg-white text-yellow-600 px-3 py-1 rounded hover:bg-gray-100">Dismiss</button></div></div>`),InAppNotifications[FILENAME],[[344,5,[[349,6,[[350,7,[[351,8,[[358,9]]],[365,8]]],[368,7,[[372,8,[[378,9]]]]]]],[387,6],[389,6,[[390,7]]]]]]);var on_click_4=(__4,dismiss,notification)=>dismiss(get$1(notification).id);var root_7$4=add_locations(from_html(`<div class="p-4 bg-blue-600 text-white rounded-lg shadow-lg"><div class="flex justify-between items-start"><h3 class="font-bold"> </h3> <button class="text-white hover:text-gray-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div> <p class="mt-2"> </p></div>`),InAppNotifications[FILENAME],[[400,5,[[405,6,[[406,7],[408,7,[[412,8,[[418,9]]]]]]],[427,6]]]]);var root_8$3=add_locations(from_html(`<button class="self-end bg-gray-700 text-white px-3 py-1 rounded hover:bg-gray-600 text-sm">Dismiss All</button>`),InAppNotifications[FILENAME],[[435,3]]);var root_3$4=add_locations(from_html(`<div><!> <!></div>`),InAppNotifications[FILENAME],[[334,1]]);var root$6=add_locations(from_html(`<!> <!>`,1),InAppNotifications[FILENAME],[]);function InAppNotifications($$anchor,$$props){check_target(new.target);push$1($$props,true,InAppNotifications);let notifications=tag(state$1(proxy([])),"notifications");let isLockdownActive=tag(state$1(false),"isLockdownActive");let lockdownTimeLeft=tag(state$1(0),"lockdownTimeLeft");let isUrgent=tag(state$1(false),"isUrgent");const timerManager=UnifiedTimerManager.getInstance();onMount(()=>{if(!browser_ext)return;const messageListener=(message,sender,sendResponse)=>{if(!message||strict_equals(typeof message,"object",false))return true;if(strict_equals(message.type,"SECURITY_ALERT")||strict_equals(message.type,"IMPORTANT_NOTIFICATION")){addNotification({id:message.id||`notification-${Date.now()}`,type:"security",title:message.title||"üîí Security Alert",message:message.message,timestamp:message.timestamp||Date.now()})}else if(strict_equals(message.type,"LOCKDOWN_WARNING")){const id=`lockdown-${Date.now()}`;const delayMs=message.delayMs||3e4;const countdown=Math.ceil(delayMs/1e3);set(isLockdownActive,true);set(lockdownTimeLeft,countdown,true);set(isUrgent,countdown<=10);addNotification({id:id,type:"lockdown",title:"üîí Security Alert",message:message.message||"YAKKL will be locked soon due to inactivity.",timestamp:message.timestamp||Date.now(),countdown:countdown,delayMs:delayMs});const intervalId=`countdown-${id}`;timerManager.addInterval(intervalId,()=>{updateCountdown(id)},1e3);timerManager.startInterval(intervalId);set(notifications,get$1(notifications).map(n=>strict_equals(n.id,id)?{...n,countdownInterval:intervalId}:n),true);if(browser_ext.runtime&&browser_ext.runtime.onMessage){browser_ext.runtime.sendMessage({type:"lockdownImminent",delayMs:delayMs,timestamp:Date.now()})}}else if(strict_equals(message.type,"CLEAR_NOTIFICATION")){removeNotification(message.notificationId)}return true};const handleIdleStateChange=event2=>{if(strict_equals(event2.detail.state,"active")){set(isLockdownActive,false);set(lockdownTimeLeft,0);set(isUrgent,false);set(notifications,get$1(notifications).filter(n=>strict_equals(n.type,"lockdown",false)),true);clearAllIntervals()}};const handleUserActivity2=()=>{if(get$1(isLockdownActive)){set(isLockdownActive,false);set(lockdownTimeLeft,0);set(isUrgent,false);set(notifications,get$1(notifications).filter(n=>strict_equals(n.type,"lockdown",false)),true);clearAllIntervals()}};if(browser_ext.runtime&&browser_ext.runtime.onMessage){browser_ext.runtime.onMessage.addListener(messageListener)}window.addEventListener("yakklIdleStateChanged",handleIdleStateChange);window.addEventListener("yakklUserActivityDetected",handleUserActivity2);return()=>{if(browser_ext.runtime&&browser_ext.runtime.onMessage){browser_ext.runtime.onMessage.removeListener(messageListener)}window.removeEventListener("yakklIdleStateChanged",handleIdleStateChange);window.removeEventListener("yakklUserActivityDetected",handleUserActivity2);clearAllIntervals()}});onDestroy(()=>{clearAllIntervals()});function addNotification(notification){const existing=get$1(notifications).find(n=>strict_equals(n.id,notification.id));if(existing){set(notifications,get$1(notifications).map(n=>strict_equals(n.id,notification.id)?{...n,...notification}:n),true)}else{set(notifications,[...get$1(notifications),notification],true)}}function removeNotification(id){const notification=get$1(notifications).find(n=>strict_equals(n.id,id));if(notification&&notification.countdownInterval){timerManager.stopInterval(notification.countdownInterval);timerManager.removeInterval(notification.countdownInterval)}if(strict_equals(notification==null?void 0:notification.type,"lockdown")){set(isLockdownActive,false);set(lockdownTimeLeft,0);set(isUrgent,false)}set(notifications,get$1(notifications).filter(n=>strict_equals(n.id,id,false)),true)}function updateCountdown(id){const notification=get$1(notifications).find(n=>strict_equals(n.id,id));if(notification&&notification.countdown){const newCountdown=notification.countdown-1;set(lockdownTimeLeft,newCountdown);set(isUrgent,newCountdown<=10);if(newCountdown<=0){removeNotification(id)}else{set(notifications,get$1(notifications).map(n=>strict_equals(n.id,id)?{...n,countdown:newCountdown}:n),true)}}}function clearAllIntervals(){get$1(notifications).forEach(notification=>{if(notification.countdownInterval){timerManager.stopInterval(notification.countdownInterval);timerManager.removeInterval(notification.countdownInterval)}})}function dismiss(id){const notification=get$1(notifications).find(n=>strict_equals(n.id,id));if(strict_equals(notification==null?void 0:notification.type,"lockdown")&&browser_ext){try{browser_ext.runtime.sendMessage({type:"USER_ACTIVITY",timestamp:Date.now(),context:"security",action:"dismiss_lockdown_warning"}).catch(()=>{})}catch(e){}}removeNotification(id)}async function dismissAll(){const hasLockdownWarning=get$1(notifications).some(n=>strict_equals(n.type,"lockdown"));if(hasLockdownWarning&&browser_ext){try{await browser_ext.runtime.sendMessage({type:"USER_ACTIVITY",timestamp:Date.now(),context:"security",action:"dismiss_all_lockdown_warnings"})}catch(e){}}await NotificationService.clearAllAlertsEnhanced();clearAllIntervals();set(notifications,[],true);set(isLockdownActive,false);set(lockdownTimeLeft,0);set(isUrgent,false)}var fragment=root$6();var node=first_child(fragment);{var consequent_1=$$anchor2=>{var div=root_1$3();let classes;var div_1=child(div);var div_2=child(div_1);var div_3=child(div_2);var div_4=child(div_3);var svg=child(div_4);let classes_1;var node_1=sibling(svg,2);{var consequent=$$anchor3=>{var div_5=root_2$3();append($$anchor3,div_5)};if_block(node_1,$$render=>{if(get$1(isUrgent))$$render(consequent)})}reset(div_4);next(2);reset(div_3);var div_6=sibling(div_3,2);var div_7=child(div_6);var div_8=sibling(child(div_7),2);let classes_2;var text2=child(div_8,true);reset(div_8);next(2);reset(div_7);var div_9=sibling(div_7,2);var svg_1=child(div_9);var circle=sibling(child(svg_1));let classes_3;reset(svg_1);var div_10=sibling(svg_1,2);var div_11=child(div_10);var text_1=child(div_11);reset(div_11);reset(div_10);reset(div_9);reset(div_6);var div_12=sibling(div_6,2);var button=child(div_12);button.__click=[on_click$4,dismissAll];var button_1=sibling(button,2);button_1.__click=[on_click_1,dismissAll];reset(div_12);reset(div_2);reset(div_1);reset(div);template_effect(($0,$1,$2,$3,$4)=>{classes=set_class(div,1,"fixed top-0 left-0 right-0 z-50 bg-gradient-to-r from-red-600 to-red-700 text-white shadow-lg border-b-2 border-red-500",null,classes,$0);classes_1=set_class(svg,0,"h-6 w-6 text-yellow-300",null,classes_1,$1);classes_2=set_class(div_8,1,"text-3xl font-mono font-bold text-yellow-300 transition-all duration-300",null,classes_2,$2);set_text(text2,get$1(lockdownTimeLeft));classes_3=set_class(circle,0,"text-yellow-300 transition-all duration-1000",null,classes_3,$3);set_style(circle,`stroke-dasharray: 87.96459430051421; stroke-dashoffset: ${2*Math.PI*14*(1-get$1(lockdownTimeLeft)/30)}`);set_text(text_1,`${$4??""}%`)},[()=>({"animate-pulse":get$1(isUrgent)}),()=>({"animate-spin":get$1(isUrgent)}),()=>({"text-yellow-100":get$1(isUrgent),"animate-pulse":get$1(isUrgent),"scale-110":get$1(isUrgent)}),()=>({"text-yellow-100":get$1(isUrgent)}),()=>Math.round(get$1(lockdownTimeLeft)/30*100)]);transition(3,div,()=>fly,()=>({y:-100,duration:400}));append($$anchor2,div)};if_block(node,$$render=>{if(get$1(isLockdownActive))$$render(consequent_1)})}var node_2=sibling(node,2);{var consequent_5=$$anchor2=>{var div_13=root_3$4();let classes_4;var node_3=child(div_13);validate_each_keys(()=>get$1(notifications),notification=>notification.id);each(node_3,17,()=>get$1(notifications),notification=>notification.id,($$anchor3,notification)=>{var fragment_1=comment();var node_4=first_child(fragment_1);{var consequent_3=$$anchor4=>{var fragment_2=comment();var node_5=first_child(fragment_2);{var consequent_2=$$anchor5=>{var div_14=root_6$5();var div_15=child(div_14);var div_16=child(div_15);var h3=sibling(child(div_16),2);var text_2=child(h3,true);reset(h3);reset(div_16);var button_2=sibling(div_16,2);button_2.__click=[on_click_2,dismiss,notification];reset(div_15);var p=sibling(div_15,2);var text_3=child(p,true);reset(p);var div_17=sibling(p,2);var button_3=child(div_17);button_3.__click=[on_click_3,dismiss,notification];reset(div_17);reset(div_14);template_effect(()=>{set_text(text_2,get$1(notification).title);set_text(text_3,get$1(notification).message)});transition(1,div_14,()=>fly,()=>({x:20,duration:300}));transition(2,div_14,()=>fade,()=>({duration:200}));append($$anchor5,div_14)};var alternate=$$anchor5=>{var div_18=root_7$4();var div_19=child(div_18);var h3_1=child(div_19);var text_4=child(h3_1,true);reset(h3_1);var button_4=sibling(h3_1,2);button_4.__click=[on_click_4,dismiss,notification];reset(div_19);var p_1=sibling(div_19,2);var text_5=child(p_1,true);reset(p_1);reset(div_18);template_effect(()=>{set_text(text_4,get$1(notification).title);set_text(text_5,get$1(notification).message)});transition(1,div_18,()=>fly,()=>({x:20,duration:300}));transition(2,div_18,()=>fade,()=>({duration:200}));append($$anchor5,div_18)};if_block(node_5,$$render=>{if(strict_equals(get$1(notification).type,"security"))$$render(consequent_2);else $$render(alternate,false)})}append($$anchor4,fragment_2)};if_block(node_4,$$render=>{if(strict_equals(get$1(notification).type,"lockdown",false))$$render(consequent_3)})}append($$anchor3,fragment_1)});var node_6=sibling(node_3,2);{var consequent_4=$$anchor3=>{var button_5=root_8$3();button_5.__click=dismissAll;append($$anchor3,button_5)};if_block(node_6,$$render=>{if(get$1(notifications).filter(n=>strict_equals(n.type,"lockdown",false)).length>1)$$render(consequent_4)})}reset(div_13);template_effect($0=>classes_4=set_class(div_13,1,"fixed right-4 z-40 flex flex-col gap-4 max-w-md transition-all duration-300",null,classes_4,$0),[()=>({"top-24":get$1(isLockdownActive),"top-4":!get$1(isLockdownActive)})]);append($$anchor2,div_13)};if_block(node_2,$$render=>{if(get$1(notifications).length>0)$$render(consequent_5)})}append($$anchor,fragment);return pop({...legacy_api()})}delegate(["click"]);TokenForm[FILENAME]="src/lib/components/TokenForm.svelte";var root_2$2=add_locations(from_html(`<span class="text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[184,5]]);var root_3$3=add_locations(from_html(`<p class="mt-2 text-sm text-red-600"> </p>`),TokenForm[FILENAME],[[197,4]]);var root_4$3=add_locations(from_html(`<span class="text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[207,5]]);var root_5$4=add_locations(from_html(`<p class="mt-2 text-sm text-red-600"> </p>`),TokenForm[FILENAME],[[220,4]]);var root_6$4=add_locations(from_html(`<span class="text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[230,5]]);var root_7$3=add_locations(from_html(`<p class="mt-2 text-sm text-red-600"> </p>`),TokenForm[FILENAME],[[242,4]]);var root_8$2=add_locations(from_html(`<span class="text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[252,5]]);var root_9$3=add_locations(from_html(`<p class="mt-2 text-sm text-red-600"> </p>`),TokenForm[FILENAME],[[265,4]]);var root_10$2=add_locations(from_html(`<span class="text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[277,5]]);var root_11$2=add_locations(from_html(`<p class="mt-2 text-sm text-red-600"> </p>`),TokenForm[FILENAME],[[291,4]]);var root_12$2=add_locations(from_html(`<span class="text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[303,6]]);var root_13$3=add_locations(from_html(`<p class="mt-2 text-sm text-red-600"> </p>`),TokenForm[FILENAME],[[324,5]]);var root_14$3=add_locations(from_html(`<span class="text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[334,6]]);var root_15$1=add_locations(from_html(`<option>Mainnet</option> <option>Sepolia Testnet</option> <option>Goerli Testnet</option>`,1),TokenForm[FILENAME],[[344,6],[345,6],[346,6]]);var root_17$1=add_locations(from_html(`<option>Mainnet Beta</option> <option>Testnet</option> <option>Devnet</option>`,1),TokenForm[FILENAME],[[348,6],[349,6],[350,6]]);var root_19$2=add_locations(from_html(`<option>Mainnet</option> <option>Testnet</option>`,1),TokenForm[FILENAME],[[352,6],[353,6]]);var root_20$3=add_locations(from_html(`<option>Mainnet</option> <option>Testnet</option>`,1),TokenForm[FILENAME],[[355,6],[356,6]]);var root_21$2=add_locations(from_html(`<p class="mt-2 text-sm text-red-600"> </p>`),TokenForm[FILENAME],[[360,5]]);var root_22$2=add_locations(from_html(`<span class="text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[372,6]]);var root_23$2=add_locations(from_html(`<option>ERC20</option> <option>ERC721 (NFT)</option> <option>ERC1155</option>`,1),TokenForm[FILENAME],[[382,6],[383,6],[384,6]]);var root_25$2=add_locations(from_html(`<option>SPL Token</option> <option>Solana NFT</option>`,1),TokenForm[FILENAME],[[386,6],[387,6]]);var root_27$2=add_locations(from_html(`<option>BRC20</option> <option>Runes</option>`,1),TokenForm[FILENAME],[[389,6],[390,6]]);var root_29$1=add_locations(from_html(`<option>CW20</option> <option>IBC Token</option>`,1),TokenForm[FILENAME],[[392,6],[393,6]]);var root_30$1=add_locations(from_html(`<option>Native Token</option> <option>Custom</option>`,1),TokenForm[FILENAME],[[395,6],[396,6]]);var root_31=add_locations(from_html(`<p class="mt-2 text-sm text-red-600"> </p>`),TokenForm[FILENAME],[[400,5]]);var root_33$1=add_locations(from_html(`<span class="text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[411,7]]);var root_34=add_locations(from_html(`<p class="mt-2 text-sm text-red-600"> </p>`),TokenForm[FILENAME],[[425,6]]);var root_32$1=add_locations(from_html(`<div><div class="flex items-center gap-2"><label for="chainid" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Chain ID <span class="text-red-500">*</span></label> <!></div> <input type="number" id="chainid" step="1" required placeholder="Enter the chain ID" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800"/> <!></div>`),TokenForm[FILENAME],[[405,4,[[406,5,[[407,6,[[408,17]]]]],[414,5]]]]);var root_35=add_locations(from_html(`<span class="ml-1 text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[448,6]]);var root_36=add_locations(from_html(`<span class="ml-1 text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[464,6]]);var root_37=add_locations(from_html(`<span class="ml-1 text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[480,6]]);var root_38=add_locations(from_html(`<span class="ml-1 text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[496,6]]);var root_40=add_locations(from_html(`<span class="text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[511,7]]);var root_41=add_locations(from_html(`<span class="text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[538,7]]);var root_39=add_locations(from_html(`<div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><div class="flex items-center gap-2"><label for="exchange" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Exchange</label> <!></div> <select id="exchange" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800"><option>Select Exchange</option><option>Binance</option><option>Coinbase</option><option>Kraken</option><option>OKX</option><option>Bybit</option><option>KuCoin</option><option>Gemini</option><option>Other</option></select></div> <div><div class="flex items-center gap-2"><label for="exchangeSymbol" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Exchange Symbol</label> <!></div> <input type="text" id="exchangeSymbol" placeholder="Exchange-specific symbol" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800"/></div></div>`),TokenForm[FILENAME],[[504,3,[[505,4,[[506,5,[[507,6]]],[514,5,[[520,6],[521,6],[522,6],[523,6],[524,6],[525,6],[526,6],[527,6],[528,6]]]]],[532,4,[[533,5,[[534,6]]],[541,5]]]]]]);var root_42=add_locations(from_html(`<span class="text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[561,6]]);var root_43=add_locations(from_html(`<span class="text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[580,6]]);var root_44=add_locations(from_html(`<p class="mt-2 text-sm text-red-600"> </p>`),TokenForm[FILENAME],[[592,5]]);var root_45=add_locations(from_html(`<span class="text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[604,5]]);var root_46=add_locations(from_html(`<p class="mt-2 text-sm text-red-600"> </p>`),TokenForm[FILENAME],[[614,4]]);var root_47=add_locations(from_html(`<span class="text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[624,5]]);var root_48=add_locations(from_html(`<p class="mt-2 text-sm text-red-600"> </p>`),TokenForm[FILENAME],[[636,4]]);var root_49=add_locations(from_html(`<span class="text-gray-400 hover:text-gray-600 cursor-help">‚ìò</span>`),TokenForm[FILENAME],[[646,5]]);var root_50=add_locations(from_html(`<p class="mt-2 text-sm text-red-600"> </p>`),TokenForm[FILENAME],[[658,4]]);var on_click$3=(_,show)=>show(false);var root_1$2=add_locations(from_html(`<form class="space-y-4 p-6"><div><div class="flex items-center gap-2"><label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Name <span class="text-red-500">*</span></label> <!></div> <input type="text" id="name" required placeholder="Enter the token name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800"/> <!></div> <div><div class="flex items-center gap-2"><label for="address" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Address <span class="text-red-500">*</span></label> <!></div> <input type="text" id="address" required placeholder="Enter the token contract address" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focusring:indigo-500 sm:text-sm text-gray-800"/> <!></div> <div><div class="flex items-center gap-2"><label for="alias" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Alias</label> <!></div> <input type="text" id="alias" placeholder="Enter an alias like an ENS (optional)" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800"/> <!></div> <div><div class="flex items-center gap-2"><label for="symbol" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Symbol <span class="text-red-500">*</span></label> <!></div> <input type="text" id="symbol" required placeholder="Enter the token symbol" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focusring:indigo-500 sm:text-sm text-gray-800"/> <!></div> <div><div class="flex items-center gap-2"><label for="decimals" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Decimals <span class="text-red-500">*</span></label> <!></div> <input type="number" id="decimals" step="1" required placeholder="Enter the decimals token uses" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focusring:indigo-500 sm:text-sm text-gray-800"/> <!></div> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><div class="flex items-center gap-2"><label for="blockchain" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Blockchain <span class="text-red-500">*</span></label> <!></div> <select id="blockchain" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800"><option>Ethereum</option><option>Solana</option><option>Bitcoin</option><option>Cosmos</option><option>Polygon</option><option>Arbitrum</option><option>Optimism</option><option>Base</option><option>Avalanche</option><option>Binance Smart Chain</option></select> <!></div> <div><div class="flex items-center gap-2"><label for="network" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Network <span class="text-red-500">*</span></label> <!></div> <select id="network" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800"><!></select> <!></div></div> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><div class="flex items-center gap-2"><label for="standard" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Token Standard <span class="text-red-500">*</span></label> <!></div> <select id="standard" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800"><!></select> <!></div> <!></div> <div class="space-y-4 p-4 bg-gray-50 rounded-lg"><h3 class="text-sm font-medium text-gray-900">Token Options</h3> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="flex items-center"><input type="checkbox" id="isWatchOnly" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"/> <label for="isWatchOnly" class="ml-2 block text-sm text-gray-900">Watch-only (track price but no transactions)</label> <!></div> <div class="flex items-center"><input type="checkbox" id="portfolioIncluded" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"/> <label for="portfolioIncluded" class="ml-2 block text-sm text-gray-900">Include in portfolio total</label> <!></div> <div class="flex items-center"><input type="checkbox" id="sidepanel" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"/> <label for="sidepanel" class="ml-2 block text-sm text-gray-900">Show in sidepanel</label> <!></div> <div class="flex items-center"><input type="checkbox" id="isExchangeBalance" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"/> <label for="isExchangeBalance" class="ml-2 block text-sm text-gray-900">Exchange balance</label> <!></div></div></div> <!> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><div class="flex items-center gap-2"><label for="coingeckoId" class="block text-sm font-medium text-gray-700 dark:text-gray-200">CoinGecko ID</label> <!></div> <input type="text" id="coingeckoId" placeholder="e.g., bitcoin, ethereum" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800"/></div> <div><div class="flex items-center gap-2"><label for="website" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Website</label> <!></div> <input type="url" id="website" placeholder="https://example.com" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800"/> <!></div></div> <div><div class="flex items-center gap-2"><label for="evmCompatible" class="block text-sm font-medium text-gray-700 dark:text-gray-200">EVM compatible</label> <!></div> <input type="checkbox" id="evmCompatible"/> <!></div> <div><div class="flex items-center gap-2"><label for="logoURI" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Logo URI</label> <!></div> <input type="text" id="logoURI" placeholder="Enter the URL (https://...) for the logo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800"/> <!></div> <div><div class="flex items-center gap-2"><label for="url" class="block text-sm font-medium text-gray-700 dark:text-gray-200">URL</label> <!></div> <input type="text" id="url" placeholder="Optional:Enter the URL (https://...) for the token" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-800"/> <!></div> <div class="pt-5"><div class="flex justify-end space-x-4"><button type="button" class="rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">Cancel</button> <button type="button" class="rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">Reset</button> <button type="submit" class="rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">Save</button></div></div></form>`),TokenForm[FILENAME],[[177,1,[[178,2,[[179,3,[[180,4,[[181,11]]]]],[187,3]]],[201,2,[[202,3,[[203,4,[[204,14]]]]],[210,3]]],[224,2,[[225,3,[[226,4]]],[233,3]]],[246,2,[[247,3,[[248,4,[[249,13]]]]],[255,3]]],[269,2,[[270,3,[[271,4,[[272,15]]]]],[280,3]]],[296,2,[[297,3,[[298,4,[[299,5,[[300,18]]]]],[306,4,[[312,5],[313,5],[314,5],[315,5],[316,5],[317,5],[318,5],[319,5],[320,5],[321,5]]]]],[328,3,[[329,4,[[330,5,[[331,15]]]]],[337,4]]]]],[365,2,[[366,3,[[367,4,[[368,5,[[369,22]]]]],[375,4]]]]],[432,2,[[433,3],[435,3,[[436,4,[[437,5],[444,5]]],[452,4,[[453,5],[460,5]]],[468,4,[[469,5],[476,5]]],[484,4,[[485,5],[492,5]]]]]]],[554,2,[[555,3,[[556,4,[[557,5]]],[564,4]]],[574,3,[[575,4,[[576,5]]],[583,4]]]]],[597,2,[[598,3,[[599,4]]],[607,3]]],[618,2,[[619,3,[[620,4]]],[627,3]]],[640,2,[[641,3,[[642,4]]],[649,3]]],[662,2,[[663,3,[[664,4],[669,4],[674,4]]]]]]]]);function TokenForm($$anchor,$$props){check_target(new.target);push$1($$props,true,TokenForm);var $$ownership_validator=create_ownership_validator($$props);const[$$stores,$$cleanup]=setup_stores();const $form=()=>(validate_store(form,"form"),store_get(form,"$form",$$stores));const $errors=()=>(validate_store(errors,"errors"),store_get(errors,"$errors",$$stores));let show=prop($$props,"show",15,false),token=prop($$props,"token",3,null);prop($$props,"className",3,"z-[999]");const{form:form,errors:errors,handleChange:handleChange,handleSubmit:handleSubmit,updateInitialValues:updateInitialValues}=createForm$1({initialValues:{address:"",name:"",alias:"",symbol:"",decimals:18,chainId:1,sidepanel:true,evmCompatible:true,logoURI:"",url:"",customDefault:"custom",isNative:false,isStablecoin:false,description:"",blockchain:"ethereum",network:"mainnet",standard:"ERC20",isWatchOnly:false,portfolioIncluded:true,coingeckoId:"",website:"",exchange:"",exchangeSymbol:"",isExchangeBalance:false},validationSchema:create$3().shape({address:create$6().required("Please enter a token address"),name:create$6().required("Please enter a token name"),alias:create$6().optional(),symbol:create$6().required("Please enter a token symbol"),decimals:create$5().required("Please enter the token decimals"),chainId:create$5().when("blockchain",{is:val=>["ethereum","polygon","arbitrum","optimism","base"].includes(val),then:schema=>schema.required("Please enter the chain ID"),otherwise:schema=>schema.optional()}),blockchain:create$6().required("Please select a blockchain"),network:create$6().required("Please select a network"),standard:create$6().required("Please select a token standard"),sidepanel:create$7().optional().default(true),evmCompatible:create$7().optional().default(true),logoURI:create$6().url("Must be a valid URL").optional().nullable(),url:create$6().url("Must be a valid URL").optional().nullable(),website:create$6().url("Must be a valid URL").optional().nullable(),coingeckoId:create$6().optional(),exchange:create$6().optional(),exchangeSymbol:create$6().optional(),isWatchOnly:create$7().optional().default(false),portfolioIncluded:create$7().optional().default(true),isExchangeBalance:create$7().optional().default(false)}),onSubmit:values=>{var _a2,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l;try{const updatedToken={...values,sidepanel:values.sidepanel??true,evmCompatible:values.evmCompatible??(strict_equals(values.blockchain,"ethereum")||strict_equals(values.standard,"ERC20")),customDefault:"custom",symbol:values.symbol.toUpperCase(),balance:((_a2=token())==null?void 0:_a2.balance)??0n,quantity:((_b=token())==null?void 0:_b.quantity)??0,price:{price:0,isNative:false,provider:"",lastUpdated:new Date,chainId:((_c=token())==null?void 0:_c.chainId)??values.chainId??1,currency:"",status:((_e=(_d=token())==null?void 0:_d.price)==null?void 0:_e.status)??0,message:((_g=(_f=token())==null?void 0:_f.price)==null?void 0:_g.message)??""},change:((_h=token())==null?void 0:_h.change)??[],value:((_i=token())==null?void 0:_i.value)??0,tags:((_j=token())==null?void 0:_j.tags)??[],version:((_k=token())==null?void 0:_k.version)??VERSION$1,blockchain:values.blockchain,network:values.network,standard:values.standard,isWatchOnly:values.isWatchOnly,portfolioIncluded:values.portfolioIncluded,watchedAt:((_l=token())==null?void 0:_l.watchedAt)??(new Date).toISOString(),exchangeInfo:values.isExchangeBalance?{exchange:values.exchange,exchangeSymbol:values.exchangeSymbol||values.symbol,isExchangeBalance:values.isExchangeBalance}:void 0,metadata:{coingeckoId:values.coingeckoId||void 0,website:values.website||void 0,lastUpdated:(new Date).toISOString()}};$$props.onSubmit(updatedToken);resetForm2();show(false)}catch(error){log.error("TokenForm: Error:",false,error)}}});function resetForm2(){updateInitialValues({address:"",name:"",alias:"",symbol:"",decimals:18,chainId:1,sidepanel:true,evmCompatible:true,logoURI:"",url:"",customDefault:"custom",isNative:false,isStablecoin:false,description:"",blockchain:"ethereum",network:"mainnet",standard:"ERC20",isWatchOnly:false,portfolioIncluded:true,coingeckoId:"",website:"",exchange:"",exchangeSymbol:"",isExchangeBalance:false})}user_effect(()=>{var _a2,_b,_c,_d,_e;if(token()){updateInitialValues({address:token().address,name:token().name,alias:token().alias??"",symbol:token().symbol,decimals:token().decimals,chainId:token().chainId??1,sidepanel:token().sidepanel??true,evmCompatible:token().evmCompatible??true,logoURI:token().logoURI??"",url:token().url??"",customDefault:"custom",isNative:token().isNative??false,isStablecoin:token().isStablecoin??false,description:token().description??"",blockchain:token().blockchain??"ethereum",network:token().network??"mainnet",standard:token().standard??"ERC20",isWatchOnly:token().isWatchOnly??false,portfolioIncluded:token().portfolioIncluded??true,coingeckoId:((_a2=token().metadata)==null?void 0:_a2.coingeckoId)??"",website:((_b=token().metadata)==null?void 0:_b.website)??"",exchange:((_c=token().exchangeInfo)==null?void 0:_c.exchange)??"",exchangeSymbol:((_d=token().exchangeInfo)==null?void 0:_d.exchangeSymbol)??"",isExchangeBalance:((_e=token().exchangeInfo)==null?void 0:_e.isExchangeBalance)??false})}});const expression=user_derived(()=>token()?"Edit Token":"Add Token");{$$ownership_validator.binding("show",Modal,show);Modal($$anchor,{get title(){return get$1(expression)},get show(){return show()},set show($$value){show($$value)},children:wrap_snippet(TokenForm,($$anchor2,$$slotProps)=>{var form_1=root_1$2();var div=child(form_1);var div_1=child(div);var node=sibling(child(div_1),2);Tooltip_1(node,{content:"The full name of the token (e.g., Ethereum, Bitcoin)",children:wrap_snippet(TokenForm,($$anchor3,$$slotProps2)=>{var span=root_2$2();append($$anchor3,span)}),$$slots:{default:true}});reset(div_1);var input=sibling(div_1,2);remove_input_defaults(input);input.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[194,14])};var node_1=sibling(input,2);{var consequent=$$anchor3=>{var p=root_3$3();var text2=child(p,true);reset(p);template_effect(()=>set_text(text2,$errors().name));append($$anchor3,p)};if_block(node_1,$$render=>{if($errors().name)$$render(consequent)})}reset(div);var div_2=sibling(div,2);var div_3=child(div_2);var node_2=sibling(child(div_3),2);Tooltip_1(node_2,{content:"The contract address of the token on the blockchain",children:wrap_snippet(TokenForm,($$anchor3,$$slotProps2)=>{var span_1=root_4$3();append($$anchor3,span_1)}),$$slots:{default:true}});reset(div_3);var input_1=sibling(div_3,2);remove_input_defaults(input_1);input_1.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[217,14])};var node_3=sibling(input_1,2);{var consequent_1=$$anchor3=>{var p_1=root_5$4();var text_1=child(p_1,true);reset(p_1);template_effect(()=>set_text(text_1,$errors().address));append($$anchor3,p_1)};if_block(node_3,$$render=>{if($errors().address)$$render(consequent_1)})}reset(div_2);var div_4=sibling(div_2,2);var div_5=child(div_4);var node_4=sibling(child(div_5),2);Tooltip_1(node_4,{content:"An optional alias for the token (e.g., ENS name)",children:wrap_snippet(TokenForm,($$anchor3,$$slotProps2)=>{var span_2=root_6$4();append($$anchor3,span_2)}),$$slots:{default:true}});reset(div_5);var input_2=sibling(div_5,2);remove_input_defaults(input_2);input_2.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[239,14])};var node_5=sibling(input_2,2);{var consequent_2=$$anchor3=>{var p_2=root_7$3();var text_2=child(p_2,true);reset(p_2);template_effect(()=>set_text(text_2,$errors().alias));append($$anchor3,p_2)};if_block(node_5,$$render=>{if($errors().alias)$$render(consequent_2)})}reset(div_4);var div_6=sibling(div_4,2);var div_7=child(div_6);var node_6=sibling(child(div_7),2);Tooltip_1(node_6,{content:"The token's ticker symbol (e.g., ETH, BTC)",children:wrap_snippet(TokenForm,($$anchor3,$$slotProps2)=>{var span_3=root_8$2();append($$anchor3,span_3)}),$$slots:{default:true}});reset(div_7);var input_3=sibling(div_7,2);remove_input_defaults(input_3);input_3.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[262,14])};var node_7=sibling(input_3,2);{var consequent_3=$$anchor3=>{var p_3=root_9$3();var text_3=child(p_3,true);reset(p_3);template_effect(()=>set_text(text_3,$errors().symbol));append($$anchor3,p_3)};if_block(node_7,$$render=>{if($errors().symbol)$$render(consequent_3)})}reset(div_6);var div_8=sibling(div_6,2);var div_9=child(div_8);var node_8=sibling(child(div_9),2);Tooltip_1(node_8,{content:"The number of decimal places the token uses (e.g., 18 for most ERC20 tokens)",children:wrap_snippet(TokenForm,($$anchor3,$$slotProps2)=>{var span_4=root_10$2();append($$anchor3,span_4)}),$$slots:{default:true}});reset(div_9);var input_4=sibling(div_9,2);remove_input_defaults(input_4);input_4.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[288,14])};var node_9=sibling(input_4,2);{var consequent_4=$$anchor3=>{var p_4=root_11$2();var text_4=child(p_4,true);reset(p_4);template_effect(()=>set_text(text_4,$errors().decimals));append($$anchor3,p_4)};if_block(node_9,$$render=>{if($errors().decimals)$$render(consequent_4)})}reset(div_8);var div_10=sibling(div_8,2);var div_11=child(div_10);var div_12=child(div_11);var node_10=sibling(child(div_12),2);Tooltip_1(node_10,{content:"The blockchain network this token exists on",children:wrap_snippet(TokenForm,($$anchor3,$$slotProps2)=>{var span_5=root_12$2();append($$anchor3,span_5)}),$$slots:{default:true}});reset(div_12);var select=sibling(div_12,2);select.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[309,15])};var option=child(select);option.value=option.__value="ethereum";var option_1=sibling(option);option_1.value=option_1.__value="solana";var option_2=sibling(option_1);option_2.value=option_2.__value="bitcoin";var option_3=sibling(option_2);option_3.value=option_3.__value="cosmos";var option_4=sibling(option_3);option_4.value=option_4.__value="polygon";var option_5=sibling(option_4);option_5.value=option_5.__value="arbitrum";var option_6=sibling(option_5);option_6.value=option_6.__value="optimism";var option_7=sibling(option_6);option_7.value=option_7.__value="base";var option_8=sibling(option_7);option_8.value=option_8.__value="avalanche";var option_9=sibling(option_8);option_9.value=option_9.__value="bsc";reset(select);var node_11=sibling(select,2);{var consequent_5=$$anchor3=>{var p_5=root_13$3();var text_5=child(p_5,true);reset(p_5);template_effect(()=>set_text(text_5,$errors().blockchain));append($$anchor3,p_5)};if_block(node_11,$$render=>{if($errors().blockchain)$$render(consequent_5)})}reset(div_11);var div_13=sibling(div_11,2);var div_14=child(div_13);var node_12=sibling(child(div_14),2);Tooltip_1(node_12,{content:"The specific network (mainnet, testnet, etc.)",children:wrap_snippet(TokenForm,($$anchor3,$$slotProps2)=>{var span_6=root_14$3();append($$anchor3,span_6)}),$$slots:{default:true}});reset(div_14);var select_1=sibling(div_14,2);select_1.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[340,15])};var node_13=child(select_1);{var consequent_6=$$anchor3=>{var fragment_1=root_15$1();var option_10=first_child(fragment_1);option_10.value=option_10.__value="mainnet";var option_11=sibling(option_10,2);option_11.value=option_11.__value="sepolia";var option_12=sibling(option_11,2);option_12.value=option_12.__value="goerli";append($$anchor3,fragment_1)};var alternate=($$anchor3,$$elseif)=>{{var consequent_7=$$anchor4=>{var fragment_2=root_17$1();var option_13=first_child(fragment_2);option_13.value=option_13.__value="mainnet-beta";var option_14=sibling(option_13,2);option_14.value=option_14.__value="testnet";var option_15=sibling(option_14,2);option_15.value=option_15.__value="devnet";append($$anchor4,fragment_2)};var alternate_1=($$anchor4,$$elseif2)=>{{var consequent_8=$$anchor5=>{var fragment_3=root_19$2();var option_16=first_child(fragment_3);option_16.value=option_16.__value="mainnet";var option_17=sibling(option_16,2);option_17.value=option_17.__value="testnet";append($$anchor5,fragment_3)};var alternate_2=$$anchor5=>{var fragment_4=root_20$3();var option_18=first_child(fragment_4);option_18.value=option_18.__value="mainnet";var option_19=sibling(option_18,2);option_19.value=option_19.__value="testnet";append($$anchor5,fragment_4)};if_block($$anchor4,$$render=>{if(strict_equals($form().blockchain,"bitcoin"))$$render(consequent_8);else $$render(alternate_2,false)},$$elseif2)}};if_block($$anchor3,$$render=>{if(strict_equals($form().blockchain,"solana"))$$render(consequent_7);else $$render(alternate_1,false)},$$elseif)}};if_block(node_13,$$render=>{if(strict_equals($form().blockchain,"ethereum"))$$render(consequent_6);else $$render(alternate,false)})}reset(select_1);var node_14=sibling(select_1,2);{var consequent_9=$$anchor3=>{var p_6=root_21$2();var text_6=child(p_6,true);reset(p_6);template_effect(()=>set_text(text_6,$errors().network));append($$anchor3,p_6)};if_block(node_14,$$render=>{if($errors().network)$$render(consequent_9)})}reset(div_13);reset(div_10);var div_15=sibling(div_10,2);var div_16=child(div_15);var div_17=child(div_16);var node_15=sibling(child(div_17),2);Tooltip_1(node_15,{content:"The token standard (ERC20, SPL, etc.)",children:wrap_snippet(TokenForm,($$anchor3,$$slotProps2)=>{var span_7=root_22$2();append($$anchor3,span_7)}),$$slots:{default:true}});reset(div_17);var select_2=sibling(div_17,2);select_2.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[378,15])};var node_16=child(select_2);{var consequent_10=$$anchor3=>{var fragment_5=root_23$2();var option_20=first_child(fragment_5);option_20.value=option_20.__value="ERC20";var option_21=sibling(option_20,2);option_21.value=option_21.__value="ERC721";var option_22=sibling(option_21,2);option_22.value=option_22.__value="ERC1155";append($$anchor3,fragment_5)};var alternate_3=($$anchor3,$$elseif)=>{{var consequent_11=$$anchor4=>{var fragment_6=root_25$2();var option_23=first_child(fragment_6);option_23.value=option_23.__value="SPL";var option_24=sibling(option_23,2);option_24.value=option_24.__value="NFT";append($$anchor4,fragment_6)};var alternate_4=($$anchor4,$$elseif2)=>{{var consequent_12=$$anchor5=>{var fragment_7=root_27$2();var option_25=first_child(fragment_7);option_25.value=option_25.__value="BRC20";var option_26=sibling(option_25,2);option_26.value=option_26.__value="RUNES";append($$anchor5,fragment_7)};var alternate_5=($$anchor5,$$elseif3)=>{{var consequent_13=$$anchor6=>{var fragment_8=root_29$1();var option_27=first_child(fragment_8);option_27.value=option_27.__value="CW20";var option_28=sibling(option_27,2);option_28.value=option_28.__value="IBC";append($$anchor6,fragment_8)};var alternate_6=$$anchor6=>{var fragment_9=root_30$1();var option_29=first_child(fragment_9);option_29.value=option_29.__value="NATIVE";var option_30=sibling(option_29,2);option_30.value=option_30.__value="CUSTOM";append($$anchor6,fragment_9)};if_block($$anchor5,$$render=>{if(strict_equals($form().blockchain,"cosmos"))$$render(consequent_13);else $$render(alternate_6,false)},$$elseif3)}};if_block($$anchor4,$$render=>{if(strict_equals($form().blockchain,"bitcoin"))$$render(consequent_12);else $$render(alternate_5,false)},$$elseif2)}};if_block($$anchor3,$$render=>{if(strict_equals($form().blockchain,"solana"))$$render(consequent_11);else $$render(alternate_4,false)},$$elseif)}};if_block(node_16,$$render=>{if(strict_equals($form().blockchain,"ethereum")||strict_equals($form().blockchain,"polygon")||strict_equals($form().blockchain,"arbitrum")||strict_equals($form().blockchain,"optimism")||strict_equals($form().blockchain,"base"))$$render(consequent_10);else $$render(alternate_3,false)})}reset(select_2);var node_17=sibling(select_2,2);{var consequent_14=$$anchor3=>{var p_7=root_31();var text_7=child(p_7,true);reset(p_7);template_effect(()=>set_text(text_7,$errors().standard));append($$anchor3,p_7)};if_block(node_17,$$render=>{if($errors().standard)$$render(consequent_14)})}reset(div_16);var node_18=sibling(div_16,2);{var consequent_16=$$anchor3=>{var div_18=root_32$1();var div_19=child(div_18);var node_19=sibling(child(div_19),2);Tooltip_1(node_19,{content:"The ID of the blockchain network (e.g., 1 for Ethereum Mainnet)",children:wrap_snippet(TokenForm,($$anchor4,$$slotProps2)=>{var span_8=root_33$1();append($$anchor4,span_8)}),$$slots:{default:true}});reset(div_19);var input_5=sibling(div_19,2);remove_input_defaults(input_5);input_5.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[422,16])};var node_20=sibling(input_5,2);{var consequent_15=$$anchor4=>{var p_8=root_34();var text_8=child(p_8,true);reset(p_8);template_effect(()=>set_text(text_8,$errors().chainId));append($$anchor4,p_8)};if_block(node_20,$$render=>{if($errors().chainId)$$render(consequent_15)})}reset(div_18);bind_value(input_5,()=>$form().chainId,$$value=>store_mutate(form,untrack($form).chainId=$$value,untrack($form)));append($$anchor3,div_18)};if_block(node_18,$$render=>{if(["ethereum","polygon","arbitrum","optimism","base","bsc","avalanche"].includes($form().blockchain))$$render(consequent_16)})}reset(div_15);var div_20=sibling(div_15,2);var div_21=sibling(child(div_20),2);var div_22=child(div_21);var input_6=child(div_22);remove_input_defaults(input_6);input_6.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[441,16])};var node_21=sibling(input_6,4);Tooltip_1(node_21,{content:"Enable this for tokens you want to track but can't transact with",children:wrap_snippet(TokenForm,($$anchor3,$$slotProps2)=>{var span_9=root_35();append($$anchor3,span_9)}),$$slots:{default:true}});reset(div_22);var div_23=sibling(div_22,2);var input_7=child(div_23);remove_input_defaults(input_7);input_7.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[457,16])};var node_22=sibling(input_7,4);Tooltip_1(node_22,{content:"Include this token's value in your total portfolio calculation",children:wrap_snippet(TokenForm,($$anchor3,$$slotProps2)=>{var span_10=root_36();append($$anchor3,span_10)}),$$slots:{default:true}});reset(div_23);var div_24=sibling(div_23,2);var input_8=child(div_24);remove_input_defaults(input_8);input_8.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[473,16])};var node_23=sibling(input_8,4);Tooltip_1(node_23,{content:"Show this token in the sidepanel view",children:wrap_snippet(TokenForm,($$anchor3,$$slotProps2)=>{var span_11=root_37();append($$anchor3,span_11)}),$$slots:{default:true}});reset(div_24);var div_25=sibling(div_24,2);var input_9=child(div_25);remove_input_defaults(input_9);input_9.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[489,16])};var node_24=sibling(input_9,4);Tooltip_1(node_24,{content:"This represents a balance on a centralized exchange",children:wrap_snippet(TokenForm,($$anchor3,$$slotProps2)=>{var span_12=root_38();append($$anchor3,span_12)}),$$slots:{default:true}});reset(div_25);reset(div_21);reset(div_20);var node_25=sibling(div_20,2);{var consequent_17=$$anchor3=>{var div_26=root_39();var div_27=child(div_26);var div_28=child(div_27);var node_26=sibling(child(div_28),2);Tooltip_1(node_26,{content:"Which exchange this balance is on",children:wrap_snippet(TokenForm,($$anchor4,$$slotProps2)=>{var span_13=root_40();append($$anchor4,span_13)}),$$slots:{default:true}});reset(div_28);var select_3=sibling(div_28,2);select_3.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[517,16])};var option_31=child(select_3);option_31.value=option_31.__value="";var option_32=sibling(option_31);option_32.value=option_32.__value="binance";var option_33=sibling(option_32);option_33.value=option_33.__value="coinbase";var option_34=sibling(option_33);option_34.value=option_34.__value="kraken";var option_35=sibling(option_34);option_35.value=option_35.__value="okx";var option_36=sibling(option_35);option_36.value=option_36.__value="bybit";var option_37=sibling(option_36);option_37.value=option_37.__value="kucoin";var option_38=sibling(option_37);option_38.value=option_38.__value="gemini";var option_39=sibling(option_38);option_39.value=option_39.__value="other";reset(select_3);reset(div_27);var div_29=sibling(div_27,2);var div_30=child(div_29);var node_27=sibling(child(div_30),2);Tooltip_1(node_27,{content:"Symbol used on the exchange (may differ from token symbol)",children:wrap_snippet(TokenForm,($$anchor4,$$slotProps2)=>{var span_14=root_41();append($$anchor4,span_14)}),$$slots:{default:true}});reset(div_30);var input_10=sibling(div_30,2);remove_input_defaults(input_10);input_10.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[547,16])};reset(div_29);reset(div_26);bind_select_value(select_3,()=>$form().exchange,$$value=>store_mutate(form,untrack($form).exchange=$$value,untrack($form)));bind_value(input_10,()=>$form().exchangeSymbol,$$value=>store_mutate(form,untrack($form).exchangeSymbol=$$value,untrack($form)));append($$anchor3,div_26)};if_block(node_25,$$render=>{if($form().isExchangeBalance)$$render(consequent_17)})}var div_31=sibling(node_25,2);var div_32=child(div_31);var div_33=child(div_32);var node_28=sibling(child(div_33),2);Tooltip_1(node_28,{content:"CoinGecko API identifier for price tracking",children:wrap_snippet(TokenForm,($$anchor3,$$slotProps2)=>{var span_15=root_42();append($$anchor3,span_15)}),$$slots:{default:true}});reset(div_33);var input_11=sibling(div_33,2);remove_input_defaults(input_11);input_11.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[570,15])};reset(div_32);var div_34=sibling(div_32,2);var div_35=child(div_34);var node_29=sibling(child(div_35),2);Tooltip_1(node_29,{content:"Official website URL",children:wrap_snippet(TokenForm,($$anchor3,$$slotProps2)=>{var span_16=root_43();append($$anchor3,span_16)}),$$slots:{default:true}});reset(div_35);var input_12=sibling(div_35,2);remove_input_defaults(input_12);input_12.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[589,15])};var node_30=sibling(input_12,2);{var consequent_18=$$anchor3=>{var p_9=root_44();var text_9=child(p_9,true);reset(p_9);template_effect(()=>set_text(text_9,$errors().website));append($$anchor3,p_9)};if_block(node_30,$$render=>{if($errors().website)$$render(consequent_18)})}reset(div_34);reset(div_31);var div_36=sibling(div_31,2);var div_37=child(div_36);var node_31=sibling(child(div_37),2);Tooltip_1(node_31,{content:"Whether this token follows the Ethereum Virtual Machine standard",children:wrap_snippet(TokenForm,($$anchor3,$$slotProps2)=>{var span_17=root_45();append($$anchor3,span_17)}),$$slots:{default:true}});reset(div_37);var input_13=sibling(div_37,2);remove_input_defaults(input_13);input_13.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[611,14])};var node_32=sibling(input_13,2);{var consequent_19=$$anchor3=>{var p_10=root_46();var text_10=child(p_10,true);reset(p_10);template_effect(()=>set_text(text_10,$errors().evmCompatible));append($$anchor3,p_10)};if_block(node_32,$$render=>{if($errors().evmCompatible)$$render(consequent_19)})}reset(div_36);var div_38=sibling(div_36,2);var div_39=child(div_38);var node_33=sibling(child(div_39),2);Tooltip_1(node_33,{content:"URL to the token's logo image (should be a direct link to an image)",children:wrap_snippet(TokenForm,($$anchor3,$$slotProps2)=>{var span_18=root_47();append($$anchor3,span_18)}),$$slots:{default:true}});reset(div_39);var input_14=sibling(div_39,2);remove_input_defaults(input_14);input_14.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[633,14])};var node_34=sibling(input_14,2);{var consequent_20=$$anchor3=>{var p_11=root_48();var text_11=child(p_11,true);reset(p_11);template_effect(()=>set_text(text_11,$errors().logoURI));append($$anchor3,p_11)};if_block(node_34,$$render=>{if($errors().logoURI)$$render(consequent_20)})}reset(div_38);var div_40=sibling(div_38,2);var div_41=child(div_40);var node_35=sibling(child(div_41),2);Tooltip_1(node_35,{content:"URL to the token's explorer or website (optional)",children:wrap_snippet(TokenForm,($$anchor3,$$slotProps2)=>{var span_19=root_49();append($$anchor3,span_19)}),$$slots:{default:true}});reset(div_41);var input_15=sibling(div_41,2);remove_input_defaults(input_15);input_15.__change=function(...$$args){apply(()=>handleChange,this,$$args,TokenForm,[655,14])};var node_36=sibling(input_15,2);{var consequent_21=$$anchor3=>{var p_12=root_50();var text_12=child(p_12,true);reset(p_12);template_effect(()=>set_text(text_12,$errors().url));append($$anchor3,p_12)};if_block(node_36,$$render=>{if($errors().url)$$render(consequent_21)})}reset(div_40);var div_42=sibling(div_40,2);var div_43=child(div_42);var button=child(div_43);button.__click=[on_click$3,show];var button_1=sibling(button,2);button_1.__click=resetForm2;next(2);reset(div_43);reset(div_42);reset(form_1);event("submit",form_1,function(...$$args){apply(()=>handleSubmit,this,$$args,TokenForm,[177,17])});bind_value(input,()=>$form().name,$$value=>store_mutate(form,untrack($form).name=$$value,untrack($form)));bind_value(input_1,()=>$form().address,$$value=>store_mutate(form,untrack($form).address=$$value,untrack($form)));bind_value(input_2,()=>$form().alias,$$value=>store_mutate(form,untrack($form).alias=$$value,untrack($form)));bind_value(input_3,()=>$form().symbol,$$value=>store_mutate(form,untrack($form).symbol=$$value,untrack($form)));bind_value(input_4,()=>$form().decimals,$$value=>store_mutate(form,untrack($form).decimals=$$value,untrack($form)));bind_select_value(select,()=>$form().blockchain,$$value=>store_mutate(form,untrack($form).blockchain=$$value,untrack($form)));bind_select_value(select_1,()=>$form().network,$$value=>store_mutate(form,untrack($form).network=$$value,untrack($form)));bind_select_value(select_2,()=>$form().standard,$$value=>store_mutate(form,untrack($form).standard=$$value,untrack($form)));bind_checked(input_6,()=>$form().isWatchOnly,$$value=>store_mutate(form,untrack($form).isWatchOnly=$$value,untrack($form)));bind_checked(input_7,()=>$form().portfolioIncluded,$$value=>store_mutate(form,untrack($form).portfolioIncluded=$$value,untrack($form)));bind_checked(input_8,()=>$form().sidepanel,$$value=>store_mutate(form,untrack($form).sidepanel=$$value,untrack($form)));bind_checked(input_9,()=>$form().isExchangeBalance,$$value=>store_mutate(form,untrack($form).isExchangeBalance=$$value,untrack($form)));bind_value(input_11,()=>$form().coingeckoId,$$value=>store_mutate(form,untrack($form).coingeckoId=$$value,untrack($form)));bind_value(input_12,()=>$form().website,$$value=>store_mutate(form,untrack($form).website=$$value,untrack($form)));bind_checked(input_13,()=>$form().evmCompatible,$$value=>store_mutate(form,untrack($form).evmCompatible=$$value,untrack($form)));bind_value(input_14,()=>$form().logoURI,$$value=>store_mutate(form,untrack($form).logoURI=$$value,untrack($form)));bind_value(input_15,()=>$form().url,$$value=>store_mutate(form,untrack($form).url=$$value,untrack($form)));append($$anchor2,form_1)}),$$slots:{default:true}})}var $$pop=pop({...legacy_api()});$$cleanup();return $$pop}delegate(["change","click"]);TokenListEnhanced[FILENAME]="src/lib/components/TokenListEnhanced.svelte";var on_click$2=(_,onTokenSelect,token)=>onTokenSelect()(get$1(token));var root_2$1=add_locations(from_html(`<img class="w-6 h-6 rounded-full"/>`),TokenListEnhanced[FILENAME],[[108,6]]);var root_4$2=add_locations(from_svg(`<svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd"></path></svg>`),TokenListEnhanced[FILENAME],[[110,6,[[111,7]]]]);var root_5$3=add_locations(from_svg(`<svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732L14.146 12.8l-1.179 4.456a1 1 0 01-1.934 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732L9.854 7.2l1.179-4.456A1 1 0 0112 2z" clip-rule="evenodd"></path></svg>`),TokenListEnhanced[FILENAME],[[114,6,[[115,7]]]]);var root_6$3=add_locations(from_html(`<span class="text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded-full">Visible</span>`),TokenListEnhanced[FILENAME],[[127,8]]);var root_7$2=add_locations(from_html(`<span class="text-xs px-2 py-1 bg-emerald-100 text-emerald-700 rounded-full">Custom</span>`),TokenListEnhanced[FILENAME],[[130,8]]);var root_9$2=add_locations(from_html(`<span class="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded-full cursor-help">Basic</span>`),TokenListEnhanced[FILENAME],[[134,9]]);var root_11$1=add_locations(from_html(`<span class="text-xs text-gray-600 font-medium cursor-help" title="Token Balance"> </span>`),TokenListEnhanced[FILENAME],[[152,8]]);var root_13$2=add_locations(from_html(`<span class="text-xs px-2 py-1 bg-green-100 text-green-700 rounded-full cursor-help"> </span>`),TokenListEnhanced[FILENAME],[[160,8]]);var root_16$1=add_locations(from_html(`<span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full cursor-help"> </span>`),TokenListEnhanced[FILENAME],[[197,10]]);var root_14$2=add_locations(from_html(`<div class="space-y-2 mb-2"><div class="flex items-center space-x-2"><span> </span> <span> </span></div> <div class="flex items-center space-x-2 text-xs text-gray-500"><span title="Market Cap"> </span> <span title="24h Volume"> </span> <span title="Risk Score"> </span></div> <div class="flex items-center space-x-2 text-xs"><span class="px-2 py-1 bg-purple-100 text-purple-700 rounded-full" title="RSI"> </span> <!></div> <div class="flex items-center space-x-2 text-xs"><span> </span> <span class="text-gray-500" title="Mentions in 24h"> </span></div></div>`),TokenListEnhanced[FILENAME],[[170,6,[[172,7,[[173,8],[176,8]]],[182,7,[[183,8],[184,8],[185,8]]],[191,7,[[192,8]]],[205,7,[[206,8],[209,8]]]]]]);var root_19$1=add_locations(from_html(`<div class="mb-2"><span> </span></div>`),TokenListEnhanced[FILENAME],[[218,7,[[219,8]]]]);var root_20$2=add_locations(from_html(`<div class="flex items-center space-x-2"><span class="text-xs px-2 py-1 bg-purple-100 text-purple-700 rounded-full"> </span></div>`),TokenListEnhanced[FILENAME],[[233,6,[[234,7]]]]);var root_21$1=add_locations(from_html(`<div class="mt-2 p-2 bg-amber-50 border border-amber-200 rounded"><div class="text-xs text-amber-800"><span class="font-medium">üöÄ Pro Insights Available:</span> Advanced analytics, yield opportunities, risk analysis, and more</div></div>`),TokenListEnhanced[FILENAME],[[242,6,[[243,7,[[244,8]]]]]]);var root_1$1=add_locations(from_html(`<li class="mb-3 relative overflow-hidden"><button><div><!></div> <div class="flex-1 min-w-0 overflow-hidden"><div class="flex items-center justify-between mb-1"><div class="flex items-center space-x-2"><h3 class="text-sm font-semibold text-gray-800"> </h3> <!> <!> <!></div></div> <p class="text-sm font-medium text-gray-700 truncate mb-1"> </p> <div class="flex items-center space-x-4 mb-2"><!> <!></div> <!> <p class="text-xs text-gray-500 font-mono truncate mb-2"> </p> <!> <!></div></button> <!></li>`),TokenListEnhanced[FILENAME],[[91,2,[[92,3,[[100,4],[120,4,[[121,5,[[122,6,[[123,7]]]]],[141,5],[146,5],[227,5]]]]]]]]);var root$5=add_locations(from_html(`<ul class="overflow-hidden"></ul> <!> <!>`,1),TokenListEnhanced[FILENAME],[[88,0]]);function TokenListEnhanced($$anchor,$$props){check_target(new.target);push$1($$props,true,TokenListEnhanced);let tokens=prop($$props,"tokens",19,()=>[]),onTokenSelect=prop($$props,"onTokenSelect",3,()=>{}),onTokenUpdate=prop($$props,"onTokenUpdate",3,()=>{}),onTokenDelete=prop($$props,"onTokenDelete",3,()=>{});let selectedToken=tag(state$1(null),"selectedToken");let showEditModal=tag(state$1(false),"showEditModal");let showDeleteModal=tag(state$1(false),"showDeleteModal");let settings=tag(state$1(null),"settings");let isProUser=tag(state$1(false),"isProUser");const currencyFormatter=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2});const preciseFormatter=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:8});onMount(async()=>{var _a2,_b;set(settings,await getSettings(),true);set(isProUser,shouldShowProFeatures(((_b=(_a2=get$1(settings))==null?void 0:_a2.plan)==null?void 0:_b.type)||PlanType.BASIC_MEMBER),true)});function handleEdit(token){set(selectedToken,token,true);set(showEditModal,true)}function handleDelete(token){if(strict_equals(token==null?void 0:token.customDefault,"custom")){set(selectedToken,token,true);set(showDeleteModal,true)}}function confirmDelete(){var _a2;if(get$1(selectedToken)&&strict_equals((_a2=get$1(selectedToken))==null?void 0:_a2.customDefault,"custom")){onTokenDelete()(get$1(selectedToken));set(showDeleteModal,false);set(selectedToken,null)}}function getAnalyticsData(token){return get$1(isProUser)?toProAnalytics(token):toBasicAnalytics(token)}function formatLargeNumber(value){if(value>=1e9)return`$${(value/1e9).toFixed(2)}B`;if(value>=1e6)return`$${(value/1e6).toFixed(2)}M`;if(value>=1e3)return`$${(value/1e3).toFixed(2)}K`;return currencyFormatter.format(value)}function getRiskColor(score){if(score<=3)return"text-green-600 bg-green-100";if(score<=6)return"text-yellow-600 bg-yellow-100";return"text-red-600 bg-red-100"}function getRiskLevel(score){if(score<=3)return"Low";if(score<=6)return"Medium";return"High"}var fragment=root$5();var ul=first_child(fragment);each(ul,21,tokens,index,($$anchor2,token)=>{var li=root_1$1();const analytics=user_derived(()=>getAnalyticsData(get$1(token)));get$1(analytics);var button=child(li);button.__click=[on_click$2,onTokenSelect,token];var div=child(button);var node=child(div);{var consequent=$$anchor3=>{var img=root_2$1();template_effect(()=>{set_attribute(img,"src",get$1(token).logoURI);set_attribute(img,"alt",get$1(token).symbol)});append($$anchor3,img)};var alternate=($$anchor3,$$elseif)=>{{var consequent_1=$$anchor4=>{var svg=root_4$2();append($$anchor4,svg)};var alternate_1=$$anchor4=>{var svg_1=root_5$3();append($$anchor4,svg_1)};if_block($$anchor3,$$render=>{var _a2;if(strict_equals((_a2=get$1(token))==null?void 0:_a2.customDefault,"custom"))$$render(consequent_1);else $$render(alternate_1,false)},$$elseif)}};if_block(node,$$render=>{var _a2;if((_a2=get$1(token))==null?void 0:_a2.logoURI)$$render(consequent);else $$render(alternate,false)})}reset(div);var div_1=sibling(div,2);var div_2=child(div_1);var div_3=child(div_2);var h3=child(div_3);var text2=child(h3,true);reset(h3);var node_1=sibling(h3,2);{var consequent_2=$$anchor3=>{var span=root_6$3();append($$anchor3,span)};if_block(node_1,$$render=>{var _a2;if((_a2=get$1(token))==null?void 0:_a2.sidepanel)$$render(consequent_2)})}var node_2=sibling(node_1,2);{var consequent_3=$$anchor3=>{var span_1=root_7$2();append($$anchor3,span_1)};if_block(node_2,$$render=>{var _a2;if(strict_equals((_a2=get$1(token))==null?void 0:_a2.customDefault,"custom"))$$render(consequent_3)})}var node_3=sibling(node_2,2);{var consequent_4=$$anchor3=>{SimpleTooltip($$anchor3,{content:"Upgrade to Pro for advanced analytics",children:wrap_snippet(TokenListEnhanced,($$anchor4,$$slotProps)=>{var span_2=root_9$2();append($$anchor4,span_2)}),$$slots:{default:true}})};if_block(node_3,$$render=>{if(!get$1(isProUser))$$render(consequent_4)})}reset(div_3);reset(div_2);var p=sibling(div_2,2);var text_1=child(p);reset(p);var div_4=sibling(p,2);var node_4=child(div_4);{var consequent_5=$$anchor3=>{const rawBalance=user_derived(()=>strict_equals(typeof get$1(analytics).balance,"bigint")?Number(get$1(analytics).balance)/Math.pow(10,get$1(analytics).decimals||18):Number(get$1(analytics).balance));get$1(rawBalance);const balanceNumber=user_derived(()=>isNaN(get$1(rawBalance))?0:get$1(rawBalance));get$1(balanceNumber);const balanceValue=user_derived(()=>get$1(analytics).value);get$1(balanceValue);const expression=user_derived(()=>`${get$1(balanceNumber).toFixed(8)} ${get$1(analytics).symbol} ‚âà ${preciseFormatter.format(get$1(balanceValue))}`);SimpleTooltip($$anchor3,{get content(){return get$1(expression)},children:wrap_snippet(TokenListEnhanced,($$anchor4,$$slotProps)=>{var span_3=root_11$1();var text_2=child(span_3);reset(span_3);template_effect(($0,$1)=>set_text(text_2,`Balance: ${$0??""} ${$1??""}`),[()=>get$1(balanceNumber).toFixed(4),()=>get$1(balanceValue)>0?`‚âà ${currencyFormatter.format(get$1(balanceValue))}`:""]);append($$anchor4,span_3)}),$$slots:{default:true}})};if_block(node_4,$$render=>{if(get$1(analytics).balance)$$render(consequent_5)})}var node_5=sibling(node_4,2);{var consequent_6=$$anchor3=>{const expression_1=user_derived(()=>preciseFormatter.format(get$1(analytics).currentPrice));SimpleTooltip($$anchor3,{get content(){return get$1(expression_1)},children:wrap_snippet(TokenListEnhanced,($$anchor4,$$slotProps)=>{var span_4=root_13$2();var text_3=child(span_4,true);reset(span_4);template_effect($0=>set_text(text_3,$0),[()=>get$1(analytics).currentPrice<.01?"~< $0.01":currencyFormatter.format(get$1(analytics).currentPrice)]);append($$anchor4,span_4)}),$$slots:{default:true}})};if_block(node_5,$$render=>{if(get$1(analytics).currentPrice>0)$$render(consequent_6)})}reset(div_4);var node_6=sibling(div_4,2);{var consequent_8=$$anchor3=>{var div_5=root_14$2();const proData=user_derived(()=>get$1(analytics));get$1(proData);var div_6=child(div_5);var span_5=child(div_6);var text_4=child(span_5);reset(span_5);var span_6=sibling(span_5,2);var text_5=child(span_6);reset(span_6);reset(div_6);var div_7=sibling(div_6,2);var span_7=child(div_7);var text_6=child(span_7);reset(span_7);var span_8=sibling(span_7,2);var text_7=child(span_8);reset(span_8);var span_9=sibling(span_8,2);var text_8=child(span_9);reset(span_9);reset(div_7);var div_8=sibling(div_7,2);var span_10=child(div_8);var text_9=child(span_10);reset(span_10);var node_7=sibling(span_10,2);{var consequent_7=$$anchor4=>{const expression_2=user_derived(()=>`${get$1(proData).yieldOpportunities.length} yield opportunities available`);SimpleTooltip($$anchor4,{get content(){return get$1(expression_2)},children:wrap_snippet(TokenListEnhanced,($$anchor5,$$slotProps)=>{var span_11=root_16$1();var text_10=child(span_11);reset(span_11);template_effect($0=>set_text(text_10,`Max APY: ${$0??""}%`),[()=>Math.max(...get$1(proData).yieldOpportunities.map(y=>y.apy)).toFixed(1)]);append($$anchor5,span_11)}),$$slots:{default:true}})};if_block(node_7,$$render=>{if(get$1(proData).yieldOpportunities.length>0)$$render(consequent_7)})}reset(div_8);var div_9=sibling(div_8,2);var span_12=child(div_9);var text_11=child(span_12);reset(span_12);var span_13=sibling(span_12,2);var text_12=child(span_13);reset(span_13);reset(div_9);reset(div_5);template_effect(($0,$1,$2,$3,$4,$5,$6)=>{set_class(span_5,1,`text-xs px-2 py-1 rounded-full ${get$1(proData).priceChange24h>=0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`);set_text(text_4,`24h: ${get$1(proData).priceChange24h>=0?"+":""}${$0??""}%`);set_class(span_6,1,`text-xs px-2 py-1 rounded-full ${get$1(proData).priceChange7d>=0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`);set_text(text_5,`7d: ${get$1(proData).priceChange7d>=0?"+":""}${$1??""}%`);set_text(text_6,`MC: ${$2??""}`);set_text(text_7,`Vol: ${$3??""}`);set_class(span_9,1,`px-2 py-1 rounded-full ${$4??""}`);set_text(text_8,`Risk: ${$5??""}`);set_text(text_9,`RSI: ${$6??""}`);set_class(span_12,1,`px-2 py-1 rounded-full ${get$1(proData).socialSentiment.score>0?"bg-green-100 text-green-700":get$1(proData).socialSentiment.score<0?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`);set_text(text_11,`Sentiment: ${get$1(proData).socialSentiment.score>0?"Positive":get$1(proData).socialSentiment.score<0?"Negative":"Neutral"}`);set_text(text_12,`${get$1(proData).socialSentiment.mentions24h??""} mentions`)},[()=>get$1(proData).priceChange24h.toFixed(2),()=>get$1(proData).priceChange7d.toFixed(2),()=>formatLargeNumber(get$1(proData).marketCap),()=>formatLargeNumber(get$1(proData).volume24h),()=>getRiskColor(get$1(proData).riskScore),()=>getRiskLevel(get$1(proData).riskScore),()=>get$1(proData).technicalIndicators.rsi.toFixed(0)]);append($$anchor3,div_5)};var alternate_2=($$anchor3,$$elseif)=>{{var consequent_10=$$anchor4=>{var fragment_5=comment();const percentageValue=user_derived(()=>getTokenChange(get$1(token).change,"24h"));get$1(percentageValue);var node_8=first_child(fragment_5);{var consequent_9=$$anchor5=>{var div_10=root_19$1();var span_14=child(div_10);var text_13=child(span_14);reset(span_14);reset(div_10);template_effect($0=>{set_class(span_14,1,`text-xs px-2 py-1 rounded-full ${get$1(percentageValue)>=0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`);set_text(text_13,`24h: ${get$1(percentageValue)>=0?"+":""}${$0??""}%`)},[()=>get$1(percentageValue).toFixed(2)]);append($$anchor5,div_10)};if_block(node_8,$$render=>{if(strict_equals(get$1(percentageValue),null,false))$$render(consequent_9)})}append($$anchor4,fragment_5)};if_block($$anchor3,$$render=>{if(get$1(token).change)$$render(consequent_10)},$$elseif)}};if_block(node_6,$$render=>{if(get$1(isProUser)&&"priceChange24h"in get$1(analytics))$$render(consequent_8);else $$render(alternate_2,false)})}var p_1=sibling(node_6,2);var text_14=child(p_1,true);reset(p_1);var node_9=sibling(p_1,2);{var consequent_11=$$anchor3=>{var div_11=root_20$2();var span_15=child(div_11);var text_15=child(span_15);reset(span_15);reset(div_11);template_effect(()=>set_text(text_15,`${get$1(token).decimals??""} decimals`));append($$anchor3,div_11)};if_block(node_9,$$render=>{if(get$1(token).decimals)$$render(consequent_11)})}var node_10=sibling(node_9,2);{var consequent_12=$$anchor3=>{var div_12=root_21$1();append($$anchor3,div_12)};if_block(node_10,$$render=>{if(!get$1(isProUser))$$render(consequent_12)})}reset(div_1);reset(button);var node_11=sibling(button,2);const expression_3=user_derived(()=>{var _a2;return strict_equals((_a2=get$1(token))==null?void 0:_a2.customDefault,"custom")?["copy","edit","delete"]:["copy","edit"]});const expression_4=user_derived(()=>get$1(token).balance&&Number(get$1(token).balance)>0);EditControls(node_11,{onCopy:()=>navigator.clipboard.writeText(get$1(token).address),onEdit:()=>handleEdit(get$1(token)),onDelete:()=>handleDelete(get$1(token)),get controls(){return get$1(expression_3)},get hasBalance(){return get$1(expression_4)}});reset(li);template_effect(()=>{var _a2,_b,_c,_d,_e;set_class(button,1,`w-full flex items-start rounded-lg p-3 transition-colors duration-200 overflow-hidden ${strict_equals((_a2=get$1(token))==null?void 0:_a2.customDefault,"custom")?"bg-emerald-50 hover:bg-emerald-100 border border-emerald-200":((_b=get$1(token))==null?void 0:_b.sidepanel)?"bg-blue-50 hover:bg-blue-100 border border-blue-200":"bg-gray-50 hover:bg-gray-100 border border-gray-200"}`);set_class(div,1,`w-6 h-6 flex items-center justify-center rounded-full ${strict_equals((_c=get$1(token))==null?void 0:_c.customDefault,"custom")?"bg-emerald-500":((_d=get$1(token))==null?void 0:_d.sidepanel)?"bg-blue-500":"bg-gray-500"} text-white mr-3 shrink-0`);set_text(text2,strict_equals((_e=get$1(token))==null?void 0:_e.customDefault,"custom")?"CUSTOM TOKEN":"COMMON TOKEN");set_attribute(p,"title",get$1(token).name);set_text(text_1,`${get$1(token).name??""} (${get$1(token).symbol??""})`);set_attribute(p_1,"title",get$1(token).address);set_text(text_14,get$1(token).address)});append($$anchor2,li)});reset(ul);var node_12=sibling(ul,2);TokenForm(node_12,{get token(){return get$1(selectedToken)},onSubmit:onTokenUpdate(),get show(){return get$1(showEditModal)},set show($$value){set(showEditModal,$$value,true)}});var node_13=sibling(node_12,2);Confirmation(node_13,{onConfirm:confirmDelete,title:"Delete Token",message:"Are you sure you want to delete this token? This action cannot be undone.",get show(){return get$1(showDeleteModal)},set show($$value){set(showDeleteModal,$$value,true)}});append($$anchor,fragment);return pop({...legacy_api()})}delegate(["click"]);TokensEnhanced[FILENAME]="src/lib/components/TokensEnhanced.svelte";var root_3$2=add_locations(from_html(`<a href="#upgrade" class="text-xs text-indigo-600 hover:text-indigo-700 font-medium flex items-center gap-1"><svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg> Upgrade for live prices</a>`),TokensEnhanced[FILENAME],[[136,5,[[140,6,[[141,7]]]]]]);var root_4$1=add_locations(from_html(`<div class="space-y-3 mb-4 max-h-96 overflow-y-auto"><!></div> <div class="text-sm text-gray-500 text-center mb-4"> </div>`,1),TokensEnhanced[FILENAME],[[151,3],[161,3]]);var root_5$2=add_locations(from_html(`<div class="text-center py-12"><div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-green-100 to-emerald-100 rounded-full flex items-center justify-center"><svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div> <h3 class="text-lg font-semibold text-gray-700 mb-2">No Tokens Found</h3> <p class="text-gray-500 mb-6">Add tokens to start tracking your portfolio</p></div>`),TokensEnhanced[FILENAME],[[166,3,[[167,4,[[168,5,[[169,6]]]]],[172,4],[173,4]]]]);var on_click$1=(_,showAddModal,show)=>{set(showAddModal,true);show(false)};var root_6$2=add_locations(from_html(`<div class="mt-3 p-3 bg-amber-50 rounded-lg border border-amber-200"><div class="flex items-start"><div class="flex-shrink-0"><svg class="w-4 h-4 text-amber-600 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg></div> <div class="ml-2"><p class="text-xs text-amber-800 font-medium">Manual refresh only - Upgrade to YAKKL Pro for:</p> <ul class="text-xs text-amber-700 mt-1 space-y-0.5"><li>‚Ä¢ Automatic price updates with full analytics</li> <li>‚Ä¢ Real-time portfolio tracking</li> <li>‚Ä¢ Advanced token insights</li> <li>‚Ä¢ Priority support</li></ul></div></div></div>`),TokensEnhanced[FILENAME],[[193,4,[[194,5,[[195,6,[[196,7,[[197,8]]]]],[200,6,[[201,7],[204,7,[[205,8],[206,8],[207,8],[208,8]]]]]]]]]]);var root_7$1=add_locations(from_html(`<div class="mt-3 p-3 bg-green-50 rounded-lg border border-green-200"><div class="flex items-center"><div class="flex-shrink-0"><svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg></div> <div class="ml-2"><p class="text-xs text-green-800">Enjoying automatic price updates and full token analytics</p></div></div></div>`),TokensEnhanced[FILENAME],[[214,4,[[215,5,[[216,6,[[217,7,[[218,8]]]]],[221,6,[[222,7]]]]]]]]);var root_1=add_locations(from_html(`<div class="p-4"><div class="flex items-center justify-between mb-4"><div class="flex items-center gap-2"><h3 class="text-lg font-semibold text-gray-800">Token Portfolio</h3> <div class="flex items-center gap-1"><div class="w-2 h-2 bg-green-600 rounded-full animate-pulse"></div> <span class="text-xs text-gray-500"> </span></div></div> <!></div> <!> <div class="border-t border-gray-200 pt-4"><button class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg flex items-center justify-center space-x-2"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg> <span>Add Custom Token</span></button> <!></div></div>`),TokensEnhanced[FILENAME],[[121,1,[[123,2,[[124,3,[[125,4],[126,4,[[127,5],[128,5]]]]]]],[178,2,[[179,3,[[186,4,[[187,5]]],[189,4]]]]]]]]);var root$4=add_locations(from_html(`<!> <!>`,1),TokensEnhanced[FILENAME],[]);function TokensEnhanced($$anchor,$$props){check_target(new.target);push$1($$props,true,TokensEnhanced);var $$ownership_validator=create_ownership_validator($$props);const[$$stores,$$cleanup]=setup_stores();const $yakklCombinedTokenStore=()=>(validate_store(yakklCombinedTokenStore,"yakklCombinedTokenStore"),store_get(yakklCombinedTokenStore,"$yakklCombinedTokenStore",$$stores));const $yakklCurrentlySelectedStore=()=>(validate_store(yakklCurrentlySelectedStore,"yakklCurrentlySelectedStore"),store_get(yakklCurrentlySelectedStore,"$yakklCurrentlySelectedStore",$$stores));const $yakklTokenDataCustomStore=()=>(validate_store(yakklTokenDataCustomStore,"yakklTokenDataCustomStore"),store_get(yakklTokenDataCustomStore,"$yakklTokenDataCustomStore",$$stores));let show=prop($$props,"show",15,false),onTokenSelect=prop($$props,"onTokenSelect",3,null),className=prop($$props,"className",3,"z-[899]");let showAddModal=tag(state$1(false),"showAddModal");let tokens=tag(state$1(proxy([])),"tokens");let provider=null;let tokenService=null;let settings=null;let isBasicMember=tag(state$1(true),"isBasicMember");let isRefreshing=tag(state$1(false),"isRefreshing");let lastRefreshTime=tag(state$1(null),"lastRefreshTime");let autoRefreshInterval=null;const BASIC_AUTO_REFRESH_INTERVAL_MS=3e5;const PRO_AUTO_REFRESH_INTERVAL_MS=3e4;onMount(async()=>{var _a2;settings=await getSettings();set(isBasicMember,strict_equals((_a2=settings==null?void 0:settings.plan)==null?void 0:_a2.type,PlanType.BASIC_MEMBER));const instances=await getInstances();if(instances.length>0){provider=instances[1];tokenService=instances[3]}startAutoRefresh()});onDestroy(()=>{if(autoRefreshInterval){clearInterval(autoRefreshInterval)}});user_effect(()=>{set(tokens,$yakklCombinedTokenStore(),true)});function startAutoRefresh(){if(autoRefreshInterval)return;const interval=get$1(isBasicMember)?BASIC_AUTO_REFRESH_INTERVAL_MS:PRO_AUTO_REFRESH_INTERVAL_MS;autoRefreshInterval=setInterval(async()=>{if(!get$1(isRefreshing)){await refreshTokenPrices(false)}},interval)}async function refreshTokenPrices(showLoading=true){if(get$1(isRefreshing))return;if(showLoading){set(isRefreshing,true)}try{log.info("Refreshing token prices...",false);await new Promise(resolve=>setTimeout(resolve,1e3));set(lastRefreshTime,new Date,true)}catch(error){log.error("Error refreshing token prices:",false,error)}finally{set(isRefreshing,false)}}function handleTokenSelect(selectedToken){if(strict_equals(onTokenSelect(),null,false)){onTokenSelect()(selectedToken)}show(false)}async function handleTokenAdd(token){if(strict_equals(token==null?void 0:token.customDefault,"custom")){const balance=await getTokenBalance(token,$yakklCurrentlySelectedStore().shortcuts.address,provider,tokenService);token.balance=balance;yakklTokenDataCustomStore.update(tokens2=>[...tokens2,token]);setYakklTokenDataCustomStorage($yakklTokenDataCustomStore())}set(showAddModal,false)}function handleTokenDelete(deletedToken){yakklTokenDataCustomStore.update(tokens2=>{const updatedTokens=tokens2.filter(t=>strict_equals(t.address,deletedToken.address,false));setYakklTokenDataCustomStorage(updatedTokens);return updatedTokens})}function handleTokenUpdate(updatedToken){yakklTokenDataCustomStore.update(tokens2=>{const updatedTokens=tokens2.map(t=>strict_equals(t.address,updatedToken.address)?updatedToken:t);log.info("updatedTokens",false,updatedTokens);setYakklTokenDataCustomStorage(updatedTokens);return updatedTokens})}function closeModal2(){show(false)}var fragment=root$4();var node=first_child(fragment);{$$ownership_validator.binding("show",Modal,show);Modal(node,{title:"All Tokens",description:"View and manage your tokens",onClose:closeModal2,get className(){return className()},get show(){return show()},set show($$value){show($$value)},children:wrap_snippet(TokensEnhanced,($$anchor2,$$slotProps)=>{var div=root_1();var div_1=child(div);var div_2=child(div_1);var div_3=sibling(child(div_2),2);var span=sibling(child(div_3),2);var text2=child(span);reset(span);reset(div_3);reset(div_2);var node_1=sibling(div_2,2);{var consequent=$$anchor3=>{SimpleTooltip($$anchor3,{content:"Upgrade for real-time price updates and advanced analytics",children:wrap_snippet(TokensEnhanced,($$anchor4,$$slotProps2)=>{var a=root_3$2();append($$anchor4,a)}),$$slots:{default:true}})};if_block(node_1,$$render=>{if(get$1(isBasicMember))$$render(consequent)})}reset(div_1);var node_2=sibling(div_1,2);{var consequent_1=$$anchor3=>{var fragment_2=root_4$1();var div_4=first_child(fragment_2);var node_3=child(div_4);TokenListEnhanced(node_3,{get tokens(){return get$1(tokens)},onTokenSelect:handleTokenSelect,onTokenUpdate:handleTokenUpdate,onTokenDelete:handleTokenDelete});reset(div_4);var div_5=sibling(div_4,2);var text_1=child(div_5);reset(div_5);template_effect(()=>set_text(text_1,`Showing all ${get$1(tokens).length??""} token${strict_equals(get$1(tokens).length,1)?"":"s"}`));append($$anchor3,fragment_2)};var alternate=$$anchor3=>{var div_6=root_5$2();append($$anchor3,div_6)};if_block(node_2,$$render=>{if(get$1(tokens).length>0)$$render(consequent_1);else $$render(alternate,false)})}var div_7=sibling(node_2,2);var button=child(div_7);button.__click=[on_click$1,showAddModal,show];var node_4=sibling(button,2);{var consequent_2=$$anchor3=>{var div_8=root_6$2();append($$anchor3,div_8)};var alternate_1=$$anchor3=>{var div_9=root_7$1();append($$anchor3,div_9)};if_block(node_4,$$render=>{if(get$1(isBasicMember))$$render(consequent_2);else $$render(alternate_1,false)})}reset(div_7);reset(div);template_effect(()=>set_text(text2,`Auto-refresh ${get$1(isBasicMember)?"(5min)":"(live)"}`));append($$anchor2,div)}),$$slots:{default:true}})}var node_5=sibling(node,2);TokenForm(node_5,{onSubmit:handleTokenAdd,get show(){return get$1(showAddModal)},set show($$value){set(showAddModal,$$value,true)}});append($$anchor,fragment);var $$pop=pop({...legacy_api()});$$cleanup();return $$pop}delegate(["click"]);const tokenTotals=derived(yakklCombinedTokenStore,(tokens,set2)=>{if(!tokens||tokens.length===0){log.warn("No tokens found in yakklCombinedTokenStore. Skipping calculations.");set2({portfolioTotal:0,formattedTotal:"-------",chainTotals:{byChain:{},formatted:{}}});return}let portfolioTotal=0;const chainTotals={};tokens.forEach(token=>{if(!token)return;const{value:value}=computeTokenValue(token);portfolioTotal+=value;const chainId=token.chainId??-1;chainTotals[chainId]=(chainTotals[chainId]??0)+value});const formattedTotal=portfolioTotal>0?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(portfolioTotal):"-------";const formattedChainTotals=Object.entries(chainTotals).reduce((acc,[chainId,total])=>{acc[chainId]=total>0?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(total):"-------";return acc},{});set2({portfolioTotal:portfolioTotal,formattedTotal:formattedTotal,chainTotals:{byChain:chainTotals,formatted:formattedChainTotals}})},{portfolioTotal:0,formattedTotal:"-------",chainTotals:{byChain:{},formatted:{}}});TokensIcon[FILENAME]="src/lib/components/icons/TokensIcon.svelte";var root$3=add_locations(from_svg(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"></path></svg>`),TokensIcon[FILENAME],[[4,0,[[5,2]]]]);function TokensIcon($$anchor,$$props){check_target(new.target);push$1($$props,true,TokensIcon);let className=prop($$props,"className",3,"w-6 h-6");var svg=root$3();template_effect(()=>set_class(svg,0,clsx(className())));append($$anchor,svg);return pop({...legacy_api()})}PortfolioTotal[FILENAME]="src/lib/components/PortfolioTotal.svelte";async function handleManualRefresh$1(_,isBasicMember,isManualRefreshing,lastManualRefresh,refreshCooldown,lastUpdated){if(!get$1(isBasicMember)&&!get$1(isManualRefreshing)){const now=Date.now();const timeSinceLastRefresh=now-get$1(lastManualRefresh);const minInterval=15e3;if(timeSinceLastRefresh<minInterval){set(refreshCooldown,Math.ceil((minInterval-timeSinceLastRefresh)/1e3),true);const cooldownInterval=setInterval(()=>{update(refreshCooldown,-1);if(get$1(refreshCooldown)<=0){clearInterval(cooldownInterval)}},1e3);return}set(isManualRefreshing,true);set(lastManualRefresh,now,true);try{log.debug("Manual portfolio refresh triggered",false);await new Promise(resolve=>setTimeout(resolve,1e3));set(lastUpdated,(new Date).toLocaleTimeString(),true)}catch(error2){log.error("Manual refresh failed:",false,error2)}finally{set(isManualRefreshing,false)}}}add_locations(from_html(`<div class="flex items-center gap-2 svelte-ny126m"><div class="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent svelte-ny126m"></div> <span class="text-sm svelte-ny126m">Calculating...</span></div>`),PortfolioTotal[FILENAME],[[217,6,[[218,7],[219,7]]]]);add_locations(from_html(`<span class="text-red-200 text-sm svelte-ny126m">Error</span>`),PortfolioTotal[FILENAME],[[222,6]]);var root_6$1=add_locations(from_html(`<div class="text-white/80 p-1 flex items-center gap-1 svelte-ny126m"><div class="w-2 h-2 bg-green-400 rounded-full animate-pulse svelte-ny126m"></div> <span class="text-xs svelte-ny126m">Auto</span></div>`),PortfolioTotal[FILENAME],[[236,6,[[237,7],[238,7]]]]);var root_5$1=add_locations(from_html(`<div class="flex-shrink-0 svelte-ny126m"><!></div>`),PortfolioTotal[FILENAME],[[234,4]]);var root_7=add_locations(from_html(`<div class="flex-shrink-0 text-white text-xs opacity-75 svelte-ny126m"> </div>`),PortfolioTotal[FILENAME],[[246,4]]);var root_10$1=add_locations(from_html(`<div class="animate-spin w-3 h-3 border border-white border-t-transparent rounded-full svelte-ny126m"></div>`),PortfolioTotal[FILENAME],[[261,8]]);var root_12$1=add_locations(from_html(`<span class="text-xs font-medium svelte-ny126m"> </span>`),PortfolioTotal[FILENAME],[[263,8]]);var root_13$1=add_locations(from_svg(`<svg class="w-3 h-3 svelte-ny126m" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" class="svelte-ny126m"></path></svg>`),PortfolioTotal[FILENAME],[[265,8,[[266,9]]]]);var root_9$1=add_locations(from_html(`<button class="p-1 text-white/80 hover:text-white hover:bg-white/10 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed svelte-ny126m"><!></button>`),PortfolioTotal[FILENAME],[[255,6]]);var root_8$1=add_locations(from_html(`<div class="flex-shrink-0 svelte-ny126m"><!></div>`),PortfolioTotal[FILENAME],[[253,4]]);add_locations(from_html(`<div class="text-red-600 text-sm svelte-ny126m"></div>`),PortfolioTotal[FILENAME],[[292,5]]);var root_19=add_locations(from_html(`<img class="w-6 h-6 rounded-full svelte-ny126m"/>`),PortfolioTotal[FILENAME],[[300,10]]);var root_20$1=add_locations(from_html(`<div class="w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center text-xs font-bold text-gray-600 svelte-ny126m"> </div>`),PortfolioTotal[FILENAME],[[302,10]]);var root_21=add_locations(from_html(`<div class="flex items-center gap-1 cursor-help svelte-ny126m"><div class="w-8 h-3 bg-gray-200 rounded animate-pulse svelte-ny126m"></div> <div class="w-3 h-3 bg-gradient-to-r from-indigo-400 to-purple-400 rounded-full flex items-center justify-center hover:from-indigo-500 hover:to-purple-500 transition-colors svelte-ny126m"><svg class="w-2 h-2 text-white svelte-ny126m" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" class="svelte-ny126m"></path></svg></div></div>`),PortfolioTotal[FILENAME],[[321,11,[[322,12],[323,12,[[324,13,[[325,14]]]]]]]]);var root_18=add_locations(from_html(`<div class="flex items-center justify-between p-2 bg-gray-50 rounded svelte-ny126m"><div class="flex items-center gap-3 svelte-ny126m"><!> <div class="svelte-ny126m"><div class="font-medium text-gray-900 svelte-ny126m"> </div> <div class="text-sm text-gray-500 svelte-ny126m"> </div></div></div> <div class="text-right svelte-ny126m"><div class="font-medium text-gray-900 svelte-ny126m"><!></div> <div class="text-sm text-gray-500 svelte-ny126m"><!></div></div></div>`),PortfolioTotal[FILENAME],[[297,7,[[298,8,[[306,9,[[307,10],[308,10]]]]],[311,8,[[312,9],[318,9]]]]]]);var root_17=add_locations(from_html(`<div class="space-y-2 max-h-60 overflow-y-auto svelte-ny126m"></div> <div class="pt-2 border-t border-gray-200 svelte-ny126m"><div class="flex justify-between items-center mb-2 svelte-ny126m"><span class="font-semibold text-gray-900 svelte-ny126m">Total</span> <span class="font-bold text-lg text-gray-900 svelte-ny126m"><!></span></div> <div class="p-3 bg-gradient-to-r from-indigo-50 to-purple-50 border border-indigo-200 rounded-lg svelte-ny126m"><div class="flex items-center gap-2 svelte-ny126m"><svg class="w-4 h-4 text-indigo-600 svelte-ny126m" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" class="svelte-ny126m"></path></svg> <div class="text-xs svelte-ny126m"><div class="font-medium text-indigo-900 svelte-ny126m">Upgrade for full analytics</div> <div class="text-indigo-700 svelte-ny126m">Portfolio percentages, yield opportunities, risk analysis & more</div></div></div></div></div>`,1),PortfolioTotal[FILENAME],[[295,5],[337,5,[[338,6,[[339,7],[340,7]]],[348,6,[[349,7,[[350,8,[[351,9]]],[353,8,[[354,9],[355,9]]]]]]]]]]);var root_24=add_locations(from_html(`<img class="w-6 h-6 rounded-full svelte-ny126m"/>`),PortfolioTotal[FILENAME],[[367,10]]);var root_25$1=add_locations(from_html(`<div class="w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center text-xs font-bold text-gray-600 svelte-ny126m"> </div>`),PortfolioTotal[FILENAME],[[369,10]]);var root_23$1=add_locations(from_html(`<div class="flex items-center justify-between p-2 bg-gray-50 rounded svelte-ny126m"><div class="flex items-center gap-3 svelte-ny126m"><!> <div class="svelte-ny126m"><div class="font-medium text-gray-900 svelte-ny126m"> </div> <div class="text-sm text-gray-500 svelte-ny126m"> </div></div></div> <div class="text-right svelte-ny126m"><div class="font-medium text-gray-900 svelte-ny126m"><!></div> <div class="text-sm text-gray-500 svelte-ny126m"><!></div></div></div>`),PortfolioTotal[FILENAME],[[364,7,[[365,8,[[373,9,[[374,10],[375,10]]]]],[378,8,[[379,9],[385,9]]]]]]);var root_22$1=add_locations(from_html(`<div class="space-y-2 max-h-60 overflow-y-auto svelte-ny126m"></div> <div class="pt-2 border-t border-gray-200 svelte-ny126m"><div class="flex justify-between items-center svelte-ny126m"><span class="font-semibold text-gray-900 svelte-ny126m">Total</span> <span class="font-bold text-lg text-gray-900 svelte-ny126m"><!></span></div> <div class="text-sm text-gray-500 mt-1 svelte-ny126m"> </div></div>`,1),PortfolioTotal[FILENAME],[[362,5],[396,5,[[397,6,[[398,7],[399,7]]],[406,6]]]]);var root_14$1=add_locations(from_html(`<div class="absolute z-50 w-80 p-4 mt-2 bg-white rounded-lg shadow-xl border border-gray-200 left-0 top-full svelte-ny126m" role="tooltip" aria-label="Portfolio breakdown details"><div class="space-y-3 svelte-ny126m"><div class="flex items-center justify-between svelte-ny126m"><h3 class="text-lg font-semibold text-gray-900 svelte-ny126m">Portfolio Breakdown</h3> <span class="text-sm text-gray-500 svelte-ny126m"> </span></div> <!></div></div>`),PortfolioTotal[FILENAME],[[278,2,[[285,3,[[286,4,[[287,5],[288,5]]]]]]]]);var root_27$1=add_locations(from_html(`<div class="flex items-center justify-between p-2 bg-gray-100 rounded svelte-ny126m"><span class="font-medium svelte-ny126m"> </span> <span class="svelte-ny126m"><!></span></div>`),PortfolioTotal[FILENAME],[[419,4,[[420,5],[421,5]]]]);var root_26$1=add_locations(from_html(`<div class="mt-4 space-y-2 svelte-ny126m"></div>`),PortfolioTotal[FILENAME],[[417,2]]);var root$2=add_locations(from_html(`<div><div class="group cursor-pointer svelte-ny126m" role="button" tabindex="0"><div class="flex items-center gap-2 p-3 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 svelte-ny126m"><div class="flex-shrink-0 svelte-ny126m"><svg class="w-5 h-5 text-white svelte-ny126m" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" class="svelte-ny126m"></path></svg></div> <div class="flex-1 min-w-0 svelte-ny126m"><div class="text-white text-sm font-medium opacity-90 svelte-ny126m">Total Portfolio</div> <div class="text-white text-lg font-bold svelte-ny126m"><!></div></div> <!> <!> <!></div></div> <!> <!></div>`),PortfolioTotal[FILENAME],[[193,0,[[195,1,[[204,2,[[206,3,[[207,4,[[208,5]]]]],[213,3,[[214,4],[215,4]]]]]]]]]]);function PortfolioTotal($$anchor,$$props){check_target(new.target);push$1($$props,true,PortfolioTotal);const[$$stores,$$cleanup]=setup_stores();const $tokenTotals=()=>(validate_store(tokenTotals,"tokenTotals"),store_get(tokenTotals,"$tokenTotals",$$stores));const $yakklCombinedTokenStore=()=>(validate_store(yakklCombinedTokenStore,"yakklCombinedTokenStore"),store_get(yakklCombinedTokenStore,"$yakklCombinedTokenStore",$$stores));const $yakklCurrentlySelectedStore=()=>(validate_store(yakklCurrentlySelectedStore,"yakklCurrentlySelectedStore"),store_get(yakklCurrentlySelectedStore,"$yakklCurrentlySelectedStore",$$stores));const $yakklPricingStore=()=>(validate_store(yakklPricingStore,"yakklPricingStore"),store_get(yakklPricingStore,"$yakklPricingStore",$$stores));let className=prop($$props,"className",3,""),showDetails=prop($$props,"showDetails",3,false),currency=prop($$props,"currency",3,"USD");let validCurrency=tag(user_derived(()=>currency()&&strict_equals(currency().length,3)?currency():"USD"),"validCurrency");let totalPortfolioValue=tag(state$1(0),"totalPortfolioValue");let portfolioBreakdown=tag(state$1(proxy([])),"portfolioBreakdown");let showTooltip=tag(state$1(false),"showTooltip");let lastUpdated=tag(state$1(""),"lastUpdated");let settings=null;let isBasicMember=tag(state$1(true),"isBasicMember");let hasInitialLoad=tag(state$1(false),"hasInitialLoad");let currencyFormatter=tag(state$1(void 0),"currencyFormatter");user_effect(()=>{try{set(currencyFormatter,new Intl.NumberFormat("en-US",{style:"currency",currency:get$1(validCurrency),minimumFractionDigits:2,maximumFractionDigits:2}),true)}catch(error2){log.warn("[PortfolioTotal] Invalid currency code, falling back to USD:",false,{currency:get$1(validCurrency),error:error2});set(currencyFormatter,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}),true)}});const percentFormatter=new Intl.NumberFormat("en-US",{style:"percent",minimumFractionDigits:1,maximumFractionDigits:1});user_effect(()=>{var _a2,_b;const totals=$tokenTotals();set(totalPortfolioValue,totals.portfolioTotal,true);const tokens=$yakklCombinedTokenStore();if(tokens&&tokens.length>0){const breakdown=[];let totalValue=totals.portfolioTotal;tokens.forEach(token=>{var _a3;if(token.balance&&((_a3=token.price)==null?void 0:_a3.price)){let balanceNum;if(strict_equals(typeof token.balance,"bigint")){balanceNum=Number(token.balance)/Math.pow(10,token.decimals||18)}else{balanceNum=Number(token.balance)}const tokenValue=balanceNum*token.price.price;if(tokenValue>0){breakdown.push({token:token,value:tokenValue,percentage:totalValue>0?tokenValue/totalValue:0})}}});const currentlySelected=$yakklCurrentlySelectedStore();const ethPrice=((_a2=$yakklPricingStore())==null?void 0:_a2.price)||0;if(((_b=currentlySelected==null?void 0:currentlySelected.shortcuts)==null?void 0:_b.quantity)&&ethPrice>0){const ethBalance=parseFloat(formatEther(currentlySelected.shortcuts.quantity));const ethValue=ethBalance*ethPrice;if(ethValue>0){breakdown.push({token:{name:"Ethereum",symbol:"ETH",address:"0x0000000000000000000000000000000000000000",decimals:18,chainId:1,balance:currentlySelected.shortcuts.quantity,price:{price:ethPrice,provider:"pricing-store",lastUpdated:new Date,chainId:1},portfolioIncluded:true,blockchain:"ethereum",isNative:true},value:ethValue,percentage:totalValue>0?ethValue/totalValue:0})}}breakdown.sort((a,b)=>b.value-a.value);set(portfolioBreakdown,breakdown,true)}set(lastUpdated,(new Date).toLocaleTimeString(),true);set(hasInitialLoad,true)});onMount(async()=>{var _a2;settings=await getSettings();set(isBasicMember,!shouldShowProFeatures(((_a2=settings==null?void 0:settings.plan)==null?void 0:_a2.type)||PlanType.BASIC_MEMBER))});onDestroy(()=>{if(tooltipTimeout){clearTimeout(tooltipTimeout)}});let tooltipTimeout=null;let isHoveringTooltip=tag(state$1(false),"isHoveringTooltip");let isHoveringTrigger=tag(state$1(false),"isHoveringTrigger");let isManualRefreshing=tag(state$1(false),"isManualRefreshing");let lastManualRefresh=tag(state$1(0),"lastManualRefresh");let refreshCooldown=tag(state$1(0),"refreshCooldown");user_effect(()=>{if(get$1(isHoveringTrigger)){set(showTooltip,true)}});user_effect(()=>{if(!get$1(isHoveringTrigger)&&!get$1(isHoveringTooltip)){if(tooltipTimeout)clearTimeout(tooltipTimeout);tooltipTimeout=setTimeout(()=>{set(showTooltip,false)},50)}else if(tooltipTimeout){clearTimeout(tooltipTimeout);tooltipTimeout=null}});function handleMouseEnter(){set(isHoveringTrigger,true)}function handleMouseLeave(){set(isHoveringTrigger,false)}function handleTooltipMouseEnter(){set(isHoveringTooltip,true)}function handleTooltipMouseLeave(){set(isHoveringTooltip,false)}function getTokenDisplayName(token){if(token.isNative){return token.name}return token.alias||token.name}const canManualRefresh=tag(user_derived(()=>()=>{if(get$1(isBasicMember)||get$1(isManualRefreshing))return false;const timeSinceLastRefresh=Date.now()-get$1(lastManualRefresh);return timeSinceLastRefresh>=15e3}),"canManualRefresh");var div=root$2();var div_1=child(div);var div_2=child(div_1);var div_3=sibling(child(div_2),2);var div_4=sibling(child(div_3),2);var node=child(div_4);{var alternate=($$anchor2,$$elseif)=>{{var alternate_1=$$anchor3=>{const expression=user_derived(()=>get$1(currencyFormatter)?get$1(currencyFormatter).format(get$1(totalPortfolioValue)):`$${get$1(totalPortfolioValue).toFixed(2)}`);ProtectedValue($$anchor3,{get value(){return get$1(expression)},placeholder:"*****"})};if_block($$anchor2,$$render=>{$$render(alternate_1,false)},$$elseif)}};if_block(node,$$render=>{$$render(alternate,false)})}reset(div_4);reset(div_3);var node_1=sibling(div_3,2);{var consequent_2=$$anchor2=>{var div_6=root_5$1();var node_2=child(div_6);const expression_1=user_derived(()=>get$1(isBasicMember)?"Auto-refreshes every 5 minutes":"Auto-refreshes every minute");SimpleTooltip(node_2,{get content(){return get$1(expression_1)},children:wrap_snippet(PortfolioTotal,($$anchor3,$$slotProps)=>{var div_7=root_6$1();append($$anchor3,div_7)}),$$slots:{default:true}});reset(div_6);append($$anchor2,div_6)};if_block(node_1,$$render=>{if(get$1(hasInitialLoad)&&true)$$render(consequent_2)})}var node_3=sibling(node_1,2);{var consequent_3=$$anchor2=>{var div_8=root_7();var text2=child(div_8,true);reset(div_8);template_effect(()=>set_text(text2,get$1(lastUpdated)));append($$anchor2,div_8)};if_block(node_3,$$render=>{if(get$1(lastUpdated)&&true)$$render(consequent_3)})}var node_4=sibling(node_3,2);{var consequent_6=$$anchor2=>{var div_9=root_8$1();var node_5=child(div_9);const expression_2=user_derived(()=>get$1(refreshCooldown)>0?`Wait ${get$1(refreshCooldown)}s before next refresh`:get$1(canManualRefresh)?"Manual refresh (Pro feature)":"Refreshing...");SimpleTooltip(node_5,{get content(){return get$1(expression_2)},children:wrap_snippet(PortfolioTotal,($$anchor3,$$slotProps)=>{var button=root_9$1();button.__click=[handleManualRefresh$1,isBasicMember,isManualRefreshing,lastManualRefresh,refreshCooldown,lastUpdated];var node_6=child(button);{var consequent_4=$$anchor4=>{var div_10=root_10$1();append($$anchor4,div_10)};var alternate_2=($$anchor4,$$elseif)=>{{var consequent_5=$$anchor5=>{var span_1=root_12$1();var text_1=child(span_1,true);reset(span_1);template_effect(()=>set_text(text_1,get$1(refreshCooldown)));append($$anchor5,span_1)};var alternate_3=$$anchor5=>{var svg=root_13$1();append($$anchor5,svg)};if_block($$anchor4,$$render=>{if(get$1(refreshCooldown)>0)$$render(consequent_5);else $$render(alternate_3,false)},$$elseif)}};if_block(node_6,$$render=>{if(get$1(isManualRefreshing))$$render(consequent_4);else $$render(alternate_2,false)})}reset(button);template_effect(()=>button.disabled=!get$1(canManualRefresh));append($$anchor3,button)}),$$slots:{default:true}});reset(div_9);append($$anchor2,div_9)};if_block(node_4,$$render=>{if(!get$1(isBasicMember))$$render(consequent_6)})}reset(div_2);reset(div_1);var node_7=sibling(div_1,2);{var consequent_11=$$anchor2=>{var div_11=root_14$1();var div_12=child(div_11);var div_13=child(div_12);var span_2=sibling(child(div_13),2);var text_2=child(span_2);reset(span_2);reset(div_13);var node_8=sibling(div_13,2);{var alternate_4=($$anchor3,$$elseif)=>{{var consequent_9=$$anchor4=>{var fragment_1=root_17();var div_15=first_child(fragment_1);each(div_15,21,()=>get$1(portfolioBreakdown),index,($$anchor5,item)=>{var div_16=root_18();var div_17=child(div_16);var node_9=child(div_17);{var consequent_8=$$anchor6=>{var img=root_19();template_effect(()=>{set_attribute(img,"src",get$1(item).token.logoURI);set_attribute(img,"alt",get$1(item).token.symbol)});append($$anchor6,img)};var alternate_5=$$anchor6=>{var div_18=root_20$1();var text_3=child(div_18,true);reset(div_18);template_effect($0=>set_text(text_3,$0),[()=>get$1(item).token.symbol.charAt(0)]);append($$anchor6,div_18)};if_block(node_9,$$render=>{if(get$1(item).token.logoURI)$$render(consequent_8);else $$render(alternate_5,false)})}var div_19=sibling(node_9,2);var div_20=child(div_19);var text_4=child(div_20,true);reset(div_20);var div_21=sibling(div_20,2);var text_5=child(div_21,true);reset(div_21);reset(div_19);reset(div_17);var div_22=sibling(div_17,2);var div_23=child(div_22);var node_10=child(div_23);const expression_3=user_derived(()=>get$1(currencyFormatter)?get$1(currencyFormatter).format(get$1(item).value):`$${get$1(item).value.toFixed(2)}`);ProtectedValue(node_10,{get value(){return get$1(expression_3)},placeholder:"*****"});reset(div_23);var div_24=sibling(div_23,2);var node_11=child(div_24);SimpleTooltip(node_11,{content:"Upgrade to Pro to see portfolio percentages, yield opportunities, and advanced analytics",children:wrap_snippet(PortfolioTotal,($$anchor6,$$slotProps)=>{var div_25=root_21();append($$anchor6,div_25)}),$$slots:{default:true}});reset(div_24);reset(div_22);reset(div_16);template_effect($0=>{set_text(text_4,get$1(item).token.symbol);set_text(text_5,$0)},[()=>getTokenDisplayName(get$1(item).token)]);append($$anchor5,div_16)});reset(div_15);var div_26=sibling(div_15,2);var div_27=child(div_26);var span_3=sibling(child(div_27),2);var node_12=child(span_3);const expression_4=user_derived(()=>get$1(currencyFormatter)?get$1(currencyFormatter).format(get$1(totalPortfolioValue)):`$${get$1(totalPortfolioValue).toFixed(2)}`);ProtectedValue(node_12,{get value(){return get$1(expression_4)},placeholder:"*****"});reset(span_3);reset(div_27);next(2);reset(div_26);append($$anchor4,fragment_1)};var alternate_6=$$anchor4=>{var fragment_2=root_22$1();var div_28=first_child(fragment_2);each(div_28,21,()=>get$1(portfolioBreakdown),index,($$anchor5,item)=>{var div_29=root_23$1();var div_30=child(div_29);var node_13=child(div_30);{var consequent_10=$$anchor6=>{var img_1=root_24();template_effect(()=>{set_attribute(img_1,"src",get$1(item).token.logoURI);set_attribute(img_1,"alt",get$1(item).token.symbol)});append($$anchor6,img_1)};var alternate_7=$$anchor6=>{var div_31=root_25$1();var text_6=child(div_31,true);reset(div_31);template_effect($0=>set_text(text_6,$0),[()=>get$1(item).token.symbol.charAt(0)]);append($$anchor6,div_31)};if_block(node_13,$$render=>{if(get$1(item).token.logoURI)$$render(consequent_10);else $$render(alternate_7,false)})}var div_32=sibling(node_13,2);var div_33=child(div_32);var text_7=child(div_33,true);reset(div_33);var div_34=sibling(div_33,2);var text_8=child(div_34,true);reset(div_34);reset(div_32);reset(div_30);var div_35=sibling(div_30,2);var div_36=child(div_35);var node_14=child(div_36);const expression_5=user_derived(()=>get$1(currencyFormatter)?get$1(currencyFormatter).format(get$1(item).value):`$${get$1(item).value.toFixed(2)}`);ProtectedValue(node_14,{get value(){return get$1(expression_5)},placeholder:"*****"});reset(div_36);var div_37=sibling(div_36,2);var node_15=child(div_37);const expression_6=user_derived(()=>percentFormatter.format(get$1(item).percentage));ProtectedValue(node_15,{get value(){return get$1(expression_6)},placeholder:"****"});reset(div_37);reset(div_35);reset(div_29);template_effect($0=>{set_text(text_7,get$1(item).token.symbol);set_text(text_8,$0)},[()=>getTokenDisplayName(get$1(item).token)]);append($$anchor5,div_29)});reset(div_28);var div_38=sibling(div_28,2);var div_39=child(div_38);var span_4=sibling(child(div_39),2);var node_16=child(span_4);const expression_7=user_derived(()=>get$1(currencyFormatter)?get$1(currencyFormatter).format(get$1(totalPortfolioValue)):`$${get$1(totalPortfolioValue).toFixed(2)}`);ProtectedValue(node_16,{get value(){return get$1(expression_7)},placeholder:"*****"});reset(span_4);reset(div_39);var div_40=sibling(div_39,2);var text_9=child(div_40);reset(div_40);reset(div_38);template_effect(()=>set_text(text_9,`${get$1(portfolioBreakdown).length??""} asset${strict_equals(get$1(portfolioBreakdown).length,1)?"":"s"} included`));append($$anchor4,fragment_2)};if_block($$anchor3,$$render=>{if(get$1(isBasicMember))$$render(consequent_9);else $$render(alternate_6,false)},$$elseif)}};if_block(node_8,$$render=>{$$render(alternate_4,false)})}reset(div_12);reset(div_11);template_effect(()=>set_text(text_2,`Updated: ${get$1(lastUpdated)??""}`));event("mouseenter",div_11,handleTooltipMouseEnter);event("mouseleave",div_11,handleTooltipMouseLeave);append($$anchor2,div_11)};if_block(node_7,$$render=>{if(get$1(showTooltip)&&get$1(portfolioBreakdown).length>0)$$render(consequent_11)})}var node_17=sibling(node_7,2);{var consequent_12=$$anchor2=>{var div_41=root_26$1();each(div_41,21,()=>get$1(portfolioBreakdown),index,($$anchor3,item)=>{var div_42=root_27$1();var span_5=child(div_42);var text_10=child(span_5,true);reset(span_5);var span_6=sibling(span_5,2);var node_18=child(span_6);const expression_8=user_derived(()=>get$1(currencyFormatter)?get$1(currencyFormatter).format(get$1(item).value):`$${get$1(item).value.toFixed(2)}`);ProtectedValue(node_18,{get value(){return get$1(expression_8)},placeholder:"*****"});reset(span_6);reset(div_42);template_effect(()=>set_text(text_10,get$1(item).token.symbol));append($$anchor3,div_42)});reset(div_41);append($$anchor2,div_41)};if_block(node_17,$$render=>{if(showDetails())$$render(consequent_12)})}reset(div);template_effect(()=>set_class(div,1,`relative inline-block ${className()??""}`,"svelte-ny126m"));event("mouseenter",div_1,handleMouseEnter);event("mouseleave",div_1,handleMouseLeave);event("focus",div_1,handleMouseEnter);event("blur",div_1,handleMouseLeave);append($$anchor,div);var $$pop=pop({...legacy_api()});$$cleanup();return $$pop}delegate(["click"]);Card[FILENAME]="src/lib/components/Card.svelte";async function handleManualRefresh(__1,isProUser,isManualRefreshing,lastManualRefresh,refreshCooldown,updateWithCurrentlySelected,showErrorSafely){if(get$1(isProUser)&&!get$1(isManualRefreshing)){const now=Date.now();const timeSinceLastRefresh=now-get$1(lastManualRefresh);const minInterval=15e3;if(timeSinceLastRefresh<minInterval){set(refreshCooldown,Math.ceil((minInterval-timeSinceLastRefresh)/1e3),true);const cooldownInterval=setInterval(()=>{update(refreshCooldown,-1);if(get$1(refreshCooldown)<=0){clearInterval(cooldownInterval)}},1e3);return}set(isManualRefreshing,true);set(lastManualRefresh,now,true);try{log.debug("Manual Card refresh triggered",false);await checkPricesCallback();await updateTokenPrices();await updateWithCurrentlySelected()}catch(error2){log.error("Manual Card refresh failed:",false,error2);showErrorSafely("Failed to refresh data")}finally{set(isManualRefreshing,false)}}}function toggleDropdown(__2,isDropdownOpen){set(isDropdownOpen,!get$1(isDropdownOpen))}var root_2=add_locations(from_html(`<!> <!> <!> <!> <!> <!> <!>`,1),Card[FILENAME],[]);var root_3$1=add_locations(from_html(`<p>o_o</p>`),Card[FILENAME],[[776,1]]);var root_5=add_locations(from_svg(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" aria-hidden="true" class="w-6 h-6" fill="currentColor"><path fill-rule="evenodd" d="M6 4.75A.75.75 0 016.75 4h10.5a.75.75 0 010 1.5H6.75A.75.75 0 016 4.75zM6 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H6.75A.75.75 0 016 10zm0 5.25a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H6.75a.75.75 0 01-.75-.75zM1.99 4.75a1 1 0 011-1H3a1 1 0 011 1v.01a1 1 0 01-1 1h-.01a1 1 0 01-1-1v-.01zM1.99 15.25a1 1 0 011-1H3a1 1 0 011 1v.01a1 1 0 01-1 1h-.01a1 1 0 01-1-1v-.01zM1.99 10a1 1 0 011-1H3a1 1 0 011 1v.01a1 1 0 01-1 1h-.01a1 1 0 01-1-1V10z" clip-rule="evenodd"></path></svg>`),Card[FILENAME],[[841,5,[[848,6]]]]);var root_6=add_locations(from_svg(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" aria-hidden="true" class="w-6 h-6" fill="currentColor"><path fill-rule="evenodd" d="M6 4.75A.75.75 0 016.75 4h10.5a.75.75 0 010 1.5H6.75A.75.75 0 016 4.75zM6 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H6.75A.75.75 0 016 10zm0 5.25a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H6.75a.75.75 0 01-.75-.75zM1.99 4.75a1 1 0 011-1H3a1 1 0 011 1v.01a1 1 0 01-1 1h-.01a1 1 0 01-1-1v-.01zM1.99 15.25a1 1 0 011-1H3a1 1 0 011 1v.01a1 1 0 01-1 1h-.01a1 1 0 01-1-1v-.01zM1.99 10a1 1 0 011-1H3a1 1 0 011 1v.01a1 1 0 01-1 1h-.01a1 1 0 01-1-1V10z" clip-rule="evenodd"></path></svg>`),Card[FILENAME],[[862,5,[[869,6]]]]);var root_8=add_locations(from_svg(`<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" viewBox="0 0 24 24" class="w-6 h-6"><path fill-rule="evenodd" d="M3 4.875C3 3.839 3.84 3 4.875 3h4.5c1.036 0 1.875.84 1.875 1.875v4.5c0 1.036-.84 1.875-1.875 1.875h-4.5A1.875 1.875 0 013 9.375v-4.5zM4.875 4.5a.375.375 0 00-.375.375v4.5c0 .207.168.375.375.375h4.5a.375.375 0 00.375-.375v-4.5a.375.375 0 00-.375-.375h-4.5zm7.875.375c0-1.036.84-1.875 1.875-1.875h4.5C20.16 3 21 3.84 21 4.875v4.5c0 1.036-.84 1.875-1.875 1.875h-4.5a1.875 1.875 0 01-1.875-1.875v-4.5zm1.875-.375a.375.375 0 00-.375.375v4.5c0 .207.168.375.375.375h4.5a.375.375 0 00.375-.375v-4.5a.375.375 0 00-.375-.375h-4.5zM6 6.75A.75.75 0 016.75 6h.75a.75.75 0 01.75.75v.75a.75.75 0 01-.75.75h-.75A.75.75 0 016 7.5v-.75zm9.75 0A.75.75 0 0116.5 6h.75a.75.75 0 01.75.75v.75a.75.75 0 01-.75.75h-.75a.75.75 0 01-.75-.75v-.75zM3 14.625c0-1.036.84-1.875 1.875-1.875h4.5c1.036 0 1.875.84 1.875 1.875v4.5c0 1.035-.84 1.875-1.875 1.875h-4.5A1.875 1.875 0 013 19.125v-4.5zm1.875-.375a.375.375 0 00-.375.375v4.5c0 .207.168.375.375.375h4.5a.375.375 0 00.375-.375v-4.5a.375.375 0 00-.375-.375h-4.5zm7.875-.75a.75.75 0 01.75-.75h.75a.75.75 0 01.75.75v.75a.75.75 0 01-.75.75h-.75a.75.75 0 01-.75-.75v-.75zm6 0a.75.75 0 01.75-.75h.75a.75.75 0 01.75.75v.75a.75.75 0 01-.75.75h-.75a.75.75 0 01-.75-.75v-.75zM6 16.5a.75.75 0 01.75-.75h.75a.75.75 0 01.75.75v.75a.75.75 0 01-.75.75h-.75a.75.75 0 01-.75-.75v-.75zm9.75 0a.75.75 0 01.75-.75h.75a.75.75 0 01.75.75v.75a.75.75 0 01-.75.75h-.75a.75.75 0 01-.75-.75v-.75zm-3 3a.75.75 0 01.75-.75h.75a.75.75 0 01.75.75v.75a.75.75 0 01-.75.75h-.75a.75.75 0 01-.75-.75v-.75zm6 0a.75.75 0 01.75-.75h.75a.75.75 0 01.75.75v.75a.75.75 0 01-.75.75h-.75a.75.75 0 01-.75-.75v-.75z" clip-rule="evenodd"></path></svg>`),Card[FILENAME],[[905,5,[[912,6]]]]);var root_9=add_locations(from_svg(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75"></path></svg>`),Card[FILENAME],[[926,5,[[934,6]]]]);var root_10=add_locations(from_svg(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" aria-hidden="true" class="w-6 h-6" fill="currentColor"><path fill-rule="evenodd" d="M10 2a.75.75 0 01.75.75v5.59l1.95-2.1a.75.75 0 111.1 1.02l-3.25 3.5a.75.75 0 01-1.1 0L6.2 7.26a.75.75 0 111.1-1.02l1.95 2.1V2.75A.75.75 0 0110 2z" clip-rule="evenodd"></path><path fill-rule="evenodd" d="M10 18a.75.75 0 01-.75-.75v-5.59l-1.95 2.1a.75.75 0 11-1.1-1.02l3.25-3.5a.75.75 0 011.1 0l3.25 3.5a.75.75 0 11-1.1 1.02l-1.95-2.1v5.59a.75.75 0 01-.75.75z" clip-rule="evenodd"></path></svg>`),Card[FILENAME],[[948,5,[[955,6],[960,6]]]]);var root_11=add_locations(from_svg(`<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" stroke="currentColor" class="w-6 h-6"><path fill-rule="evenodd" d="M3 4.25A2.25 2.25 0 015.25 2h5.5A2.25 2.25 0 0113 4.25v2a.75.75 0 01-1.5 0v-2a.75.75 0 00-.75-.75h-5.5a.75.75 0 00-.75.75v11.5c0 .414.336.75.75.75h5.5a.75.75 0 00.75-.75v-2a.75.75 0 011.5 0v2A2.25 2.25 0 0110.75 18h-5.5A2.25 2.25 0 013 15.75V4.25z" clip-rule="evenodd"></path><path fill-rule="evenodd" d="M19 10a.75.75 0 00-.75-.75H8.704l1.048-.943a.75.75 0 10-1.004-1.114l-2.5 2.25a.75.75 0 000 1.114l2.5 2.25a.75.75 0 101.004-1.114l-1.048-.943h9.546A.75.75 0 0019 10z" clip-rule="evenodd"></path></svg>`),Card[FILENAME],[[968,5,[[975,6],[980,6]]]]);var root_4=add_locations(from_svg(`<svg aria-hidden="true" class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z"></path></svg><!><!><!><!><!><!><!>`,1),Card[FILENAME],[[824,4,[[830,6]]]]);var root_13=add_locations(from_html(`<button class="w-28 px-3 py-1 bg-red-800/80 text-white font-medium text-xs leading-tight uppercase rounded-full shadow-md hover:bg-red-700 hover:shadow-lg focus:bg-red-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-red-800 active:shadow-lg active:text-white transition duration-150 ease-in-out flex items-center whitespace-nowrap"> </button>`),Card[FILENAME],[[1005,9]]);var root_14=add_locations(from_html(`<button class="w-28 px-3 py-1 bg-green-800/80 text-white font-medium text-xs leading-tight uppercase rounded-full shadow-md hover:bg-green-700 hover:shadow-lg focus:bg-green-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-green-800 active:shadow-lg active:text-white transition duration-150 ease-in-out flex items-center whitespace-nowrap"> </button>`),Card[FILENAME],[[1015,9]]);var on_click=(__3,handleNetworkTypeChange,network)=>handleNetworkTypeChange(get$1(network));var root_16=add_locations(from_html(`<li><div role="button" tabindex="0" class="dropdown-item text-sm py-2 px-4 font-normal w-full whitespace-nowrap bg-transparent text-gray-300 hover:bg-gray-500 hover:text-white focus:text-white focus:bg-gray-700"><!></div></li>`),Card[FILENAME],[[1027,11,[[1030,12]]]]);var root_15=add_locations(from_html(`<ul class="absolute top-full left-0 dropdown-content menu bg-opacity-70 text-base z-50 float-left py-2 list-none text-left rounded-lg shadow-lg mt-1 m-0 bg-clip-padding border-none bg-gray-800"></ul>`),Card[FILENAME],[[1023,9]]);var root_12=add_locations(from_html(`<span class="flex h-6"><div class="dropdown dropdown-bottom relative"><!> <!></div></span>`),Card[FILENAME],[[999,6,[[1e3,7]]]]);add_locations(from_html(`<span class="flex h-6"><label class="w-28 px-3 py-1 bg-red-800/80 text-white font-medium text-xs leading-tight uppercase rounded-full shadow-md hover:bg-red-700 hover:shadow-lg focus:bg-red-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-red-800 active:shadow-lg active:text-white transition duration-150 ease-in-out flex items-center whitespace-nowrap"> </label></span>`),Card[FILENAME],[[1049,6,[[1051,7]]]]);var root_20=add_locations(from_svg(`<svg width="60" height="60" fill="none" viewBox="0 0 60 60"><g clip-path="url(#j)"><rect width="60" height="60" rx="30" fill="#987DE8"></rect><path fill-rule="evenodd" clip-rule="evenodd" d="m15.48 28.367 11.966-19.3c1.174-1.892 3.927-1.892 5.1 0l11.97 19.306a6 6 0 0 1 .9 3.142v.028a6 6 0 0 1-1.154 3.56L33.227 50.208c-1.599 2.188-4.864 2.188-6.461 0L15.733 35.095a6 6 0 0 1-1.154-3.538v-.029a6 6 0 0 1 .9-3.161Z" fill="#fff"></path><path d="M30.84 10.112a.992.992 0 0 0-.844-.464V24.5l12.598 5.53c.081-.466-.001-.963-.27-1.398L30.84 10.112Z" fill="#643CDD"></path><path d="M29.996 9.648a.991.991 0 0 0-.845.465l-11.489 18.53a1.991 1.991 0 0 0-.264 1.387l12.598-5.53V9.648Z" fill="#BDADEB"></path><path d="M29.996 50.544a.994.994 0 0 0 .808-.41l11.235-15.38c.307-.434-.193-.988-.658-.72L31.49 39.71a2.998 2.998 0 0 1-1.494.398v10.437Z" fill="#643CDD"></path><path d="M17.966 34.762 29.19 50.134c.2.274.503.41.807.41V40.108a2.998 2.998 0 0 1-1.493-.398l-9.884-5.676c-.468-.27-.971.292-.653.728Z" fill="#BDADEB"></path><path d="M42.594 30.03 29.996 24.5v13.138a3 3 0 0 0 1.495-.399l10.149-5.83c.525-.31.856-.823.954-1.38Z" fill="#401AB3"></path><path d="M29.996 37.638V24.462l-12.598 5.566c.098.564.437 1.083.974 1.392l10.13 5.82c.462.265.978.398 1.494.398Z" fill="#7C5AE2"></path></g><rect class="help-img-highlight" x=".5" y=".5" width="59" height="59" rx="29.5"></rect><defs><clipPath id="j"><rect width="60" height="60" rx="30" fill="#fff"></rect></clipPath></defs></svg>`),Card[FILENAME],[[1086,6,[[1087,7,[[1088,8],[1089,8],[1095,8],[1099,8],[1103,8],[1107,8],[1111,8],[1115,8]]],[1120,7],[1121,7,[[1122,8,[[1122,25]]]]]]]]);var root_23=add_locations(from_html(`<div class="animate-spin w-4 h-4 border border-white border-t-transparent rounded-full"></div>`),Card[FILENAME],[[1149,10]]);var root_25=add_locations(from_html(`<span class="text-xs font-medium"> </span>`),Card[FILENAME],[[1151,10]]);var root_26=add_locations(from_svg(`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>`),Card[FILENAME],[[1153,10,[[1154,11]]]]);var root_22=add_locations(from_html(`<button class="p-1 text-white/80 hover:text-white hover:bg-white/10 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed"><!></button>`),Card[FILENAME],[[1143,8]]);var root_27=add_locations(from_svg(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-6 h-6 fill-green-500 font-bold"><path fill-rule="evenodd" d="M11.47 2.47a.75.75 0 011.06 0l3.75 3.75a.75.75 0 01-1.06 1.06l-2.47-2.47V21a.75.75 0 01-1.5 0V4.81L8.78 7.28a.75.75 0 01-1.06-1.06l3.75-3.75z" clip-rule="evenodd"></path></svg>`),Card[FILENAME],[[1168,7,[[1173,8]]]]);var root_29=add_locations(from_svg(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-6 h-6 fill-red-500 font-bold"><path fill-rule="evenodd" d="M12 2.25a.75.75 0 01.75.75v16.19l2.47-2.47a.75.75 0 111.06 1.06l-3.75 3.75a.75.75 0 01-1.06 0l-3.75-3.75a.75.75 0 111.06-1.06l2.47 2.47V3a.75.75 0 01.75-.75z" clip-rule="evenodd"></path></svg>`),Card[FILENAME],[[1180,7,[[1185,8]]]]);var root_30=add_locations(from_html(`<span class="ml-2"><!></span>`),Card[FILENAME],[[1203,6]]);var root_32=add_locations(from_html(`<span class="ml-2 text-gray-400">-----</span>`),Card[FILENAME],[[1207,6]]);var root_33=add_locations(from_html(`<span class="ml-2"><!></span>`),Card[FILENAME],[[1209,6]]);var root$1=add_locations(from_html(`<!> <!> <div class="visible print:hidden relative top-0 mx-2"><div class="visible print:hidden relative m-2 ml-0 mr-0 h-[261px] rounded-xl"><div class="grid grid-rows-5 gap-1 h-full"><div class="absolute left-4 bottom-1"><span class="text-gray-100 text-md">Asset Market Price:</span> <span class="ml-2 text-gray-100 text-md"> </span></div> <!> <nav class="print:hidden visible relative row-span-1 inset-x-0 navbar navbar-expand-sm p-2 flex items-center w-full justify-between"><div class="flex justify-between w-full items-center"><span class="text-gray-100 text-center dark:text-white text-4xl ml-2 -mt-6 font-bold"> </span> <!></div></nav> <div class="ml-4"><div class="row-span-2 -mt-4"><p class="text-gray-100 dark:text-white text-lg">Account:</p> <p class="text-gray-100 dark:text-white text-lg ml-4 -mt-1" data-bs-toggle="tooltip" data-bs-placement="top">Name: <span class="uppercase ml-5"> </span></p> <p class="text-gray-100 dark:text-white text-lg ml-4 -mt-2" data-bs-toggle="tooltip" data-bs-placement="top">Number: <span class="ml-1"> </span> <!></p></div> <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 opacity-25 -z-10"><!></div> <div class="flex text-xl justify-center mt-4 text-gray-100 dark:text-white row-span-1"><span data-bs-toggle="tooltip" data-bs-placement="top"><!></span> <span class="ml-2"> </span> <div class="relative flex items-center gap-2"><!> <!></div></div> <div class="flex justify-center text-lg text-gray-100 dark:text-white -mt-1 row-span-1 -ml-[2.3rem]"><span><!></span> <!> <span class="ml-2"> </span></div> <div class="flex justify-center text-lg text-gray-100 dark:text-white mt-2 row-span-1" style="max-width: 300px; overflow-x: auto; white-space: nowrap;"><span>Account Portfolio:</span> <!></div> <div class="flex justify-center mt-3 row-span-1"><!></div></div></div></div> <div style="z-index: 1;" class="grid right-[18.5px] left-[18.5px] bottom-[5px] h-[10px] absolute rounded bg-secondary text-accent-content place-content-center"></div> <div style="z-index: 0;" class="grid right-[27px] left-[27px] bottom-[2.5px] h-[10px] absolute rounded bg-accent text-secondary-content place-content-center"></div></div>`,1),Card[FILENAME],[[807,0,[[808,1,[[812,2,[[813,3,[[814,4],[815,4]]],[989,3,[[993,4,[[994,5]]]]],[1061,3,[[1062,4,[[1063,5],[1064,5,[[1070,12]]],[1072,5,[[1078,14]]]]],[1082,4],[1128,4,[[1129,5],[1136,5],[1137,5]]],[1163,4,[[1166,5],[1194,5]]],[1197,4,[[1201,5]]],[1215,4]]]]]]],[1223,1],[1227,1]]]]);function Card($$anchor,$$props){check_target(new.target);push$1($$props,true,Card);const[$$stores,$$cleanup]=setup_stores();const $yakklPricingStore=()=>(validate_store(yakklPricingStore,"yakklPricingStore"),store_get(yakklPricingStore,"$yakklPricingStore",$$stores));const $yakklMiscStore=()=>(validate_store(yakklMiscStore,"yakklMiscStore"),store_get(yakklMiscStore,"$yakklMiscStore",$$stores));const $yakklCurrentlySelectedStore=()=>(validate_store(yakklCurrentlySelectedStore,"yakklCurrentlySelectedStore"),store_get(yakklCurrentlySelectedStore,"$yakklCurrentlySelectedStore",$$stores));const $yakklAccountsStore=()=>(validate_store(yakklAccountsStore,"yakklAccountsStore"),store_get(yakklAccountsStore,"$yakklAccountsStore",$$stores));function shouldShowErrorToUser(error2){const errorMessage=(error2==null?void 0:error2.message)||(error2==null?void 0:error2.toString())||"";const networkErrors=["missing response","timeout","TIMEOUT","SERVER_ERROR","NETWORK_ERROR","Failed to fetch","fetch","Connection failed","Request timeout","eth_getBalance","call revert exception","alchemy.com","infura.io","requestBody","serverError","code=SERVER_ERROR","version=web/","JsonRpcError","RPC Error"];return!networkErrors.some(pattern=>errorMessage.toLowerCase().includes(pattern.toLowerCase()))}function showErrorSafely(errorMsg){if(get$1(errorCooldown))return;if(shouldShowErrorToUser(errorMsg)){set(errorValue,errorMsg,true);set(error,true);set(errorCooldown,true);setTimeout(()=>{set(errorCooldown,false)},3e3)}}const canManualRefresh=tag(user_derived(()=>()=>{if(!get$1(isProUser)||get$1(isManualRefreshing))return false;const timeSinceLastRefresh=Date.now()-get$1(lastManualRefresh);return timeSinceLastRefresh>=15e3}),"canManualRefresh");let id=prop($$props,"id",3,"card");let wallet=null;let provider=null;let blockchain=null;let tokenService=null;let networks=[{blockchain:"Ethereum",name:"Mainnet",chainId:1,symbol:"ETH",type:NetworkType.MAINNET,explorer:"https://etherscan.io",decimals:18},{blockchain:"Ethereum",name:"Sepolia",chainId:11155111,symbol:"ETH",type:NetworkType.TESTNET,explorer:"https://sepolia.etherscan.io",decimals:18}];let network=tag(state$1(proxy(networks[0])),"network");let networkLabel=tag(state$1("Mainnet"),"networkLabel");let addressShow=tag(state$1("Loading..."),"addressShow");let address=tag(state$1(""),"address");let name=tag(state$1("Loading..."),"name");let nameShow=tag(state$1("Loading..."),"nameShow");let valueFiat=tag(state$1("0.00"),"valueFiat");let showAccountsModal=tag(state$1(false),"showAccountsModal");let showAccountImportModal=tag(state$1(false),"showAccountImportModal");let showWatchAccountModal=tag(state$1(false),"showWatchAccountModal");let showContacts=tag(state$1(false),"showContacts");let showTokens=tag(state$1(false),"showTokens");let showRecv=tag(state$1(false),"showRecv");let showUpgradeModal=tag(state$1(false),"showUpgradeModal");let price=0;let prevPrice=0;let direction=tag(state$1("fl"),"direction");let error=tag(state$1(false),"error");let errorValue=tag(state$1(""),"errorValue");let errorCooldown=tag(state$1(false),"errorCooldown");let assetPriceValue=tag(state$1(0n),"assetPriceValue");let assetPrice=tag(state$1(""),"assetPrice");let symbolLabel=tag(state$1(""),"symbolLabel");let isProUser=tag(state$1(false),"isProUser");let isManualRefreshing=tag(state$1(false),"isManualRefreshing");let lastManualRefresh=tag(state$1(0),"lastManualRefresh");let refreshCooldown=tag(state$1(0),"refreshCooldown");let currencyLabel=tag(state$1(""),"currencyLabel");let currency=tag(state$1(void 0),"currency");let shortcutsValue=tag(state$1(proxy(EthereumBigNumber.from(0))),"shortcutsValue");let chainId=tag(state$1(1),"chainId");let formattedEtherValue=tag(state$1(""),"formattedEtherValue");let isDropdownOpen=tag(state$1(false),"isDropdownOpen");let tokens=[];let isCalculatingPortfolio=tag(state$1(false),"isCalculatingPortfolio");let portfolioValue=tag(state$1("-----"),"portfolioValue");let portfolioCurrency=tag(state$1("USD"),"portfolioCurrency");let settings=tag(state$1(null),"settings");let planType=tag(state$1(proxy(PlanType.BASIC_MEMBER)),"planType");user_effect(()=>{(async()=>{if(!get$1(isInitialized)||!$yakklPricingStore()||!$yakklMiscStore())return;if(strict_equals($yakklPricingStore().price,$yakklPricingStore().prevPrice)){log.info("Price has not changed.");return}price=$yakklPricingStore().price??0;const prevPrice2=$yakklPricingStore().prevPrice??0;log.info("Price changed:",false,price,prevPrice2);if(price){if(strict_equals(price,prevPrice2,false)){await updateWithCurrentlySelected();updateDisplayValues()}}})()});user_effect(()=>{if(!get$1(isInitialized)||!get$1(assetPriceValue))return;const newAssetPrice=get$1(currency)?get$1(currency).format(Number(get$1(assetPriceValue))):"0.00";if(strict_equals(get$1(assetPrice),newAssetPrice,false)){set(assetPrice,newAssetPrice,true)}});user_effect(()=>{var _a2,_b;if(!get$1(isInitialized)||get$1(address))return;set(address,((_b=(_a2=$yakklCurrentlySelectedStore())==null?void 0:_a2.shortcuts)==null?void 0:_b.address)??"",true)});let previousAddress=tag(state$1(""),"previousAddress");let isUpdatingBalance=tag(state$1(false),"isUpdatingBalance");let isInitialized=tag(state$1(false),"isInitialized");let initializationTimeout=null;user_effect(()=>{if(!get$1(isInitialized)||!$yakklCurrentlySelectedStore()||!$yakklMiscStore()){return}const address2=$yakklCurrentlySelectedStore().shortcuts.address;if(strict_equals(address2,get$1(previousAddress))){return}if(!get$1(isInitialized)){return}log.info("[Card] Currently selected account changed, updating card display");set(previousAddress,address2,true);const cached=balanceCacheManager.getCachedBalance(address2);if(cached){log.info("[Card] Loading cached balance for immediate display");set(shortcutsValue,EthereumBigNumber.from(cached.balance),true);updateWithCurrentlySelected();updateDisplayValues()}else{updateWithCurrentlySelected();updateDisplayValues()}const cachedPortfolio=accountTokenCacheManager.getCachedPortfolioValue(address2);if(cachedPortfolio){set(portfolioValue,get$1(currency)?get$1(currency).format(cachedPortfolio.value):cachedPortfolio.value.toFixed(2),true);set(portfolioCurrency,cachedPortfolio.currency,true);log.debug("[Card] Loaded cached portfolio value:",false,{value:cachedPortfolio.value,currency:cachedPortfolio.currency})}else{set(isCalculatingPortfolio,true);set(portfolioValue,"-----")}if(!cached||balanceCacheManager.isStale(address2)){log.info("[Card] Refreshing balance in background");refreshBalanceInBackground()}if(!cachedPortfolio||accountTokenCacheManager.isPortfolioValueStale(address2)){log.info("[Card] Refreshing portfolio value in background");refreshPortfolioInBackground()}});effect_root(()=>{const unsubscribeYakklStore=yakklCombinedTokenStore.subscribe((updatedTokens=[])=>{var _a2,_b;tokens=updatedTokens;if(!get$1(isInitialized)||!$yakklMiscStore()||!((_b=(_a2=$yakklCurrentlySelectedStore())==null?void 0:_a2.shortcuts)==null?void 0:_b.address)||strict_equals(updatedTokens.length,0)||get$1(isCalculatingPortfolio)){return}setTimeout(()=>{if(get$1(isInitialized)&&!get$1(isCalculatingPortfolio)){calculateAndCachePortfolioValue($yakklCurrentlySelectedStore().shortcuts.address,updatedTokens)}},100)});return()=>{unsubscribeYakklStore()}});onMount(async()=>{var _a2,_b;try{log.info("[Card] Component mounting...");set(settings,await getSettings(),true);set(isProUser,shouldShowProFeatures(((_b=(_a2=get$1(settings))==null?void 0:_a2.plan)==null?void 0:_b.type)||PlanType.BASIC_MEMBER),true);if(browserSvelte){await browser_ext.runtime.sendMessage({type:"clientReady"});startPricingChecks();await updateTokenPrices();if(!$yakklCurrentlySelectedStore())yakklCurrentlySelectedStore.set(await getYakklCurrentlySelected());if($yakklCurrentlySelectedStore()){const currentlySelected=$yakklCurrentlySelectedStore();currentlySelected.shortcuts.networks=networks;set(currencyLabel,currentlySelected.preferences.currency.code??"USD",true);set(currency,new Intl.NumberFormat("en-US",{style:"currency",currency:get$1(currencyLabel)}),true);set(symbolLabel,currentlySelected.shortcuts.symbol??"ETH",true);set(chainId,currentlySelected.shortcuts.network.chainId??1,true);const instances=await getInstances();if(instances.length>0){wallet=instances[0];provider=instances[1];blockchain=instances[2];tokenService=instances[3];if(wallet&&provider&&blockchain&&tokenService){tokenService.updateTokenBalances(currentlySelected.shortcuts.address)}}const val=await getBalance(currentlySelected.shortcuts.network.chainId,currentlySelected.shortcuts.address);currentlySelected.shortcuts.quantity=val??0n;checkPricesCallback();await setYakklCurrentlySelectedStorage(currentlySelected);updateWithCurrentlySelected();if($yakklCurrentlySelectedStore().shortcuts.quantity){await updateValuePriceFiat();updateDisplayValues()}}set(settings,await getSettings(),true);if(get$1(settings)){set(planType,get$1(settings).plan.type,true)}}initializationTimeout=setTimeout(()=>{var _a3,_b2;if((_b2=(_a3=$yakklCurrentlySelectedStore())==null?void 0:_a3.shortcuts)==null?void 0:_b2.address){set(previousAddress,$yakklCurrentlySelectedStore().shortcuts.address,true)}set(isInitialized,true);log.debug("[Card] Reactive effects initialized")},500)}catch(e){log.warn(`onMount: ${e}`)}});user_effect(()=>{var _a2;if(!get$1(isInitialized)||!$yakklMiscStore())return;const currentPrice=(_a2=$yakklPricingStore())==null?void 0:_a2.price;if(currentPrice&&currentPrice>0){balanceCacheManager.updatePriceForAllEntries(currentPrice);log.debug("[Card] Price changed, updated all cached entries:",false,{newPrice:currentPrice})}});async function updateWithCurrentlySelected(){var _a2;try{const{address:address2,accountName:accountName,network:network2,quantity:quantity}=$yakklCurrentlySelectedStore().shortcuts;set(addressShow,truncate(address2,6)+address2.substring(address2.length-4));set(name,accountName,true);set(nameShow,truncate(accountName,20),true);set(networkLabel,$yakklCurrentlySelectedStore().shortcuts.network.name??network2.name,true);set(assetPriceValue,((_a2=$yakklPricingStore())==null?void 0:_a2.price)??0,true);set(currencyLabel,$yakklCurrentlySelectedStore().preferences.currency.code??"USD",true);set(shortcutsValue,EthereumBigNumber.from(quantity)??EthereumBigNumber.from(0),true);set(chainId,(network2==null?void 0:network2.chainId)??1,true)}catch(e){log.warn(e)}}onDestroy(async()=>{if(initializationTimeout){clearTimeout(initializationTimeout)}if($yakklCurrentlySelectedStore()){await setYakklCurrentlySelectedStorage($yakklCurrentlySelectedStore())}stopCheckPrices()});async function refreshBalanceInBackground(){var _a2;try{if(!$yakklCurrentlySelectedStore()||!wallet||get$1(isUpdatingBalance))return;set(isUpdatingBalance,true);const address2=$yakklCurrentlySelectedStore().shortcuts.address;const chainId2=$yakklCurrentlySelectedStore().shortcuts.network.chainId;const freshBalance=await getBalance(chainId2,address2);if(freshBalance&&strict_equals(freshBalance,$yakklCurrentlySelectedStore().shortcuts.quantity,false)){balanceCacheManager.setCachedBalance(address2,freshBalance,((_a2=$yakklPricingStore())==null?void 0:_a2.price)??0);yakklCurrentlySelectedStore.update(current=>({...current,shortcuts:{...current.shortcuts,quantity:freshBalance}}));updateWithCurrentlySelected();log.info("[Card] Background balance refresh completed")}}catch(error2){log.warn("[Card] Background balance refresh failed:",false,error2)}finally{set(isUpdatingBalance,false)}}async function refreshPortfolioInBackground(){try{if(!$yakklCurrentlySelectedStore())return;const address2=$yakklCurrentlySelectedStore().shortcuts.address;set(isCalculatingPortfolio,true);let accountTokens=accountTokenCacheManager.getCachedTokensForAccount(address2);if(!accountTokens||strict_equals(accountTokens.length,0)){accountTokens=tokens}await calculateAndCachePortfolioValue(address2,accountTokens)}catch(error2){log.warn("[Card] Background portfolio refresh failed:",false,error2);set(isCalculatingPortfolio,false);set(portfolioValue,"-----")}}async function calculateAndCachePortfolioValue(address2,tokenList){var _a2,_b,_c,_d,_e,_f,_g;try{set(isCalculatingPortfolio,true);let totalValue=0;for(const token of tokenList){if(token.balance&&((_a2=token.price)==null?void 0:_a2.price)){let balanceNum;if(strict_equals(typeof token.balance,"bigint")){balanceNum=Number(token.balance)/Math.pow(10,token.decimals||18)}else{balanceNum=Number(token.balance)}const tokenValue=balanceNum*token.price.price;totalValue+=tokenValue}}if(((_c=(_b=$yakklCurrentlySelectedStore())==null?void 0:_b.shortcuts)==null?void 0:_c.quantity)&&((_d=$yakklPricingStore())==null?void 0:_d.price)){const ethValue=parseFloat(formatEther2($yakklCurrentlySelectedStore().shortcuts.quantity))*$yakklPricingStore().price;totalValue+=ethValue}const currencyCode=((_g=(_f=(_e=$yakklCurrentlySelectedStore())==null?void 0:_e.preferences)==null?void 0:_f.currency)==null?void 0:_g.code)??"USD";accountTokenCacheManager.setCachedPortfolioValue(address2,totalValue,currencyCode);set(portfolioValue,get$1(currency)?get$1(currency).format(totalValue):totalValue.toFixed(2),true);set(portfolioCurrency,currencyCode,true);set(isCalculatingPortfolio,false);log.info("[Card] Portfolio value calculated and cached:",false,{address:address2,value:totalValue,currency:currencyCode,tokenCount:tokenList.length})}catch(error2){log.warn("[Card] Error calculating portfolio value:",false,error2);set(isCalculatingPortfolio,false);set(portfolioValue,"-----")}}async function updateValuePriceFiat(){var _a2,_b,_c;try{if(!$yakklCurrentlySelectedStore()||get$1(isUpdatingBalance)){log.warn("No currently selected account or already updating balance.");resetPriceData();return}set(isUpdatingBalance,true);let{address:address2,quantity:quantity,network:network2}=$yakklCurrentlySelectedStore().shortcuts;const qty=await getBalance(network2.chainId,address2);if(strict_equals($yakklCurrentlySelectedStore().shortcuts.quantity,qty,false)){yakklCurrentlySelectedStore.update(current=>({...current,shortcuts:{...current.shortcuts,quantity:qty??0n}}))}if(qty&&((_a2=$yakklPricingStore())==null?void 0:_a2.price)){balanceCacheManager.setCachedBalance(address2,qty,$yakklPricingStore().price);log.info("[Card] Updated cache with new balance/price:",false,{address:address2,balance:qty.toString(),price:$yakklPricingStore().price})}const price2=EthereumBigNumber.from(((_b=$yakklPricingStore())==null?void 0:_b.price)??0);if(strict_equals($yakklCurrentlySelectedStore().shortcuts.quantity,price2,false)){const etherValue=parseFloat(formatEther2($yakklCurrentlySelectedStore().shortcuts.quantity??0n));if(!isNaN(etherValue)&&((_c=$yakklPricingStore())==null?void 0:_c.price)){const fiatValue=etherValue*$yakklPricingStore().price;const etherValueString=etherValue.toFixed(5);if(strict_equals(get$1(formattedEtherValue),etherValueString,false)){set(formattedEtherValue,etherValueString,true)}const newFiatValue=get$1(currency)?get$1(currency).format(fiatValue):"0.00";if(strict_equals(get$1(valueFiat),newFiatValue,false)){set(valueFiat,newFiatValue,true)}updatePriceDirection($yakklPricingStore().price)}else{resetPriceData()}}else{log.info("updateValuePriceFiat - Value NOT updated.")}}catch(error2){log.warn("Error in updateValuePriceFiat:",false,error2);resetPriceData()}finally{set(isUpdatingBalance,false)}}function updatePriceDirection(newPrice){if(prevPrice>newPrice){set(direction,"dn")}else if(prevPrice<newPrice){set(direction,"up")}else{set(direction,"fl")}prevPrice=newPrice}function resetPriceData(){set(valueFiat,"0.00");set(formattedEtherValue,"0.00000");set(direction,"fl")}function updateDisplayValues(){var _a2,_b;try{if(!$yakklCurrentlySelectedStore()||!((_a2=$yakklPricingStore())==null?void 0:_a2.price)){resetPriceData();return}const quantity=$yakklCurrentlySelectedStore().shortcuts.quantity??0n;const etherValue=parseFloat(formatEther2(quantity));if(!isNaN(etherValue)&&((_b=$yakklPricingStore())==null?void 0:_b.price)){const fiatValue=etherValue*$yakklPricingStore().price;const etherValueString=etherValue.toFixed(5);if(strict_equals(get$1(formattedEtherValue),etherValueString,false)){set(formattedEtherValue,etherValueString,true)}const newFiatValue=get$1(currency)?get$1(currency).format(fiatValue):"0.00";if(strict_equals(get$1(valueFiat),newFiatValue,false)){set(valueFiat,newFiatValue,true)}updatePriceDirection($yakklPricingStore().price)}else{resetPriceData()}}catch(error2){log.warn("Error in updateDisplayValues:",false,error2);resetPriceData()}}async function handleAccounts(account){try{if(!account){log.warn("Account is not defined.");return}let updatedCurrentlySelected=$yakklCurrentlySelectedStore();if(updatedCurrentlySelected&&isEncryptedData(updatedCurrentlySelected.data)){if(!$yakklMiscStore()){log.warn("Cannot decrypt data: yakklMiscStore is not available");return}updatedCurrentlySelected.data=await decryptData(updatedCurrentlySelected.data,$yakklMiscStore())}let balance;const cached=balanceCacheManager.getCachedBalance(account.address);if(cached){balance=cached.balance;log.info("[Card] Using cached balance for account selection:",false,{address:account.address,balance:balance.toString()})}else{try{balance=await getBalance(get$1(chainId)??1,account.address);log.info("[Card] Fetched fresh balance for account selection:",false,{address:account.address,balance:balance.toString()})}catch(error2){log.warn("[Card] Failed to get balance, using 0:",false,error2);balance=0n}}if(!$yakklMiscStore()){log.warn("Cannot encrypt data: yakklMiscStore is not available");return}updatedCurrentlySelected={...updatedCurrentlySelected,shortcuts:{...updatedCurrentlySelected.shortcuts,accountType:account.accountType,address:account.address,primary:account.primaryAccount,accountName:account.name,quantity:balance??EthereumBigNumber.from(0)},data:await encryptData({...updatedCurrentlySelected==null?void 0:updatedCurrentlySelected.data,account:account},$yakklMiscStore())};await setYakklCurrentlySelectedStorage(updatedCurrentlySelected);if(browserSvelte){browser_ext.runtime.sendMessage({type:"YAKKL_STATE_CHANGE",data:{address:account.address,accounts:[account.address]}}).catch(error2=>{log.warn("Error sending account change message",true,error2)})}await updateWithCurrentlySelected();await updateValuePriceFiat();if(wallet&&provider&&blockchain&&tokenService){await tokenService.updateTokenBalances($yakklCurrentlySelectedStore().shortcuts.address)}set(showAccountsModal,false)}catch(error2){log.warn("Error in handleAccounts:",false,error2);set(showAccountsModal,false)}}async function handleNetworkTypeChange(net){try{if($yakklCurrentlySelectedStore()){set(isDropdownOpen,false);if(strict_equals(net.chainId,$yakklCurrentlySelectedStore().shortcuts.chainId)){return}const currentlySelected=$yakklCurrentlySelectedStore();yakklCurrentlySelectedStore.update(current=>({...current,shortcuts:{...current.shortcuts,chainId:net.chainId,network:net}}));set(chainId,net.chainId,true);set(network,net,true);if(wallet)await wallet.setChainId(get$1(chainId));set(direction,"fl");currentlySelected.shortcuts.symbol=get$1(network).symbol;currentlySelected.shortcuts.type=get$1(network).type.toString();const qty=await getBalance(get$1(chainId),currentlySelected.shortcuts.address);currentlySelected.shortcuts.quantity=qty??0n;if(!isEncryptedData(currentlySelected.data)){if($yakklMiscStore()){const encryptedData=await encryptData(currentlySelected.data,$yakklMiscStore());currentlySelected.data=encryptedData}}await setYakklCurrentlySelectedStorage(currentlySelected);await updateValuePriceFiat();if(wallet&&provider&&blockchain&&tokenService){tokenService.updateTokenBalances($yakklCurrentlySelectedStore().shortcuts.address)}if(browserSvelte){browser_ext.runtime.sendMessage({type:"YAKKL_STATE_CHANGE",data:{chainId:net.chainId}}).catch(error2=>{log.warn("Error sending chain change message",true,error2)})}set(isDropdownOpen,false)}}catch(e){log.warn("[Card] Network change error:",false,e);showErrorSafely(e);set(isDropdownOpen,false)}}async function handleContact(){try{set(showAccountImportModal,false);updateValuePriceFiat()}catch(e){log.warn(e)}}async function handleToken(){try{set(showAccountImportModal,false);updateValuePriceFiat()}catch(e){log.warn(e)}}async function handleImport(){try{log.info("handleImport - Not implemented")}catch(e){log.warn(e)}}async function handleWatchAccountComplete(){log.info("Watch account added");if(wallet&&provider&&blockchain&&tokenService){await tokenService.updateTokenBalances($yakklCurrentlySelectedStore().shortcuts.address)}set(showWatchAccountModal,false)}async function getBalance(chainId2,address2){var _a2;try{if(chainId2&&wallet){if(strict_equals(wallet.getChainId(),chainId2,false)){await wallet.setChainId(chainId2)}const val=await wallet.getBalance(address2);if(strict_equals(val,null,false)&&((_a2=$yakklPricingStore())==null?void 0:_a2.price)){balanceCacheManager.setCachedBalance(address2,val,$yakklPricingStore().price);log.debug("[Card] Updated cache in getBalance:",false,{address:address2,balance:val.toString()})}return val}return null}catch(e){log.warn("[Card] Balance fetch error:",false,e);showErrorSafely(e);return null}}function formatEther2(value){try{const val=EthereumBigNumber.from(value);return val.toEtherString()}catch(e){log.warn(e);return"0.00000"}}function handleErrorClose(){set(error,false);set(errorValue,"");set(errorCooldown,true);setTimeout(()=>{set(errorCooldown,false)},1e4)}var fragment=root$1();var node=first_child(fragment);ErrorNoAction(node,{get value(){return get$1(errorValue)},title:"ERROR!",onClose:handleErrorClose,get show(){return get$1(error)},set show($$value){set(error,$$value,true)}});var node_1=sibling(node,2);await_block(node_1,$yakklAccountsStore,$$anchor2=>{var p=root_3$1();append($$anchor2,p)},($$anchor2,_)=>{var fragment_1=comment();var node_2=first_child(fragment_1);{var consequent=$$anchor3=>{var fragment_2=root_2();var node_3=first_child(fragment_2);Accounts(node_3,{onAccountSelect:handleAccounts,onClose:()=>set(showAccountsModal,false),className:"text-gray-600",get show(){return get$1(showAccountsModal)},set show($$value){set(showAccountsModal,$$value,true)}});var node_4=sibling(node_3,2);Contacts(node_4,{onContactSelect:handleContact,get show(){return get$1(showContacts)},set show($$value){set(showContacts,$$value,true)}});var node_5=sibling(node_4,2);TokensEnhanced(node_5,{onTokenSelect:handleToken,get show(){return get$1(showTokens)},set show($$value){set(showTokens,$$value,true)}});var node_6=sibling(node_5,2);Receive(node_6,{get address(){return get$1(address)},get show(){return get$1(showRecv)},set show($$value){set(showRecv,$$value,true)}});var node_7=sibling(node_6,2);ImportPrivateKey(node_7,{onComplete:handleImport,className:"text-gray-600 z-[999]",get show(){return get$1(showAccountImportModal)},set show($$value){set(showAccountImportModal,$$value,true)}});var node_8=sibling(node_7,2);ImportWatchAccount(node_8,{onComplete:handleWatchAccountComplete,onCancel:()=>set(showWatchAccountModal,false),className:"text-gray-600 z-[999]",get show(){return get$1(showWatchAccountModal)},set show($$value){set(showWatchAccountModal,$$value,true)}});var node_9=sibling(node_8,2);Upgrade(node_9,{onClose:()=>set(showUpgradeModal,false),onCancel:()=>set(showUpgradeModal,false),get show(){return get$1(showUpgradeModal)},set show($$value){set(showUpgradeModal,$$value,true)}});append($$anchor3,fragment_2)};if_block(node_2,$$render=>{if(equals($yakklAccountsStore(),void 0,false))$$render(consequent)})}append($$anchor2,fragment_1)});var div=sibling(node_1,2);var div_1=child(div);set_style(div_1,"z-index: 4; background-image: url('/images/background_gradient_2.png'); ");var div_2=child(div_1);var div_3=child(div_2);var span=sibling(child(div_3),2);var text$1=child(span);reset(span);reset(div_3);var node_10=sibling(div_3,2);SpeedDial(node_10,{defaultClass:"absolute right-1 bottom-1 z-10 bg-primary rounded-full",pill:false,tooltip:"none",placement:"bottom",children:wrap_snippet(Card,($$anchor2,$$slotProps)=>{var fragment_3=root_4();var node_11=sibling(first_child(fragment_3));SpeedDialButton(node_11,{name:"Accounts",class:"w-16",$$events:{click:()=>{set(showAccountsModal,true)}},children:wrap_snippet(Card,($$anchor3,$$slotProps2)=>{var svg=root_5();append($$anchor3,svg)}),$$slots:{default:true}});var node_12=sibling(node_11);SpeedDialButton(node_12,{name:"Contacts",class:"w-16",$$events:{click:()=>{set(showContacts,true)}},children:wrap_snippet(Card,($$anchor3,$$slotProps2)=>{var svg_1=root_6();append($$anchor3,svg_1)}),$$slots:{default:true}});var node_13=sibling(node_12);SpeedDialButton(node_13,{name:"Tokens",class:"w-16",$$events:{click:()=>{set(showTokens,true)}},children:wrap_snippet(Card,($$anchor3,$$slotProps2)=>{TokensIcon($$anchor3,{})}),$$slots:{default:true}});var node_14=sibling(node_13);SpeedDialButton(node_14,{name:"Receive",class:"w-16",$$events:{click:()=>{set(showRecv,true)}},children:wrap_snippet(Card,($$anchor3,$$slotProps2)=>{var svg_2=root_8();append($$anchor3,svg_2)}),$$slots:{default:true}});var node_15=sibling(node_14);SpeedDialButton(node_15,{name:"Import Account",class:"w-16",$$events:{click:()=>{set(showAccountImportModal,true)}},children:wrap_snippet(Card,($$anchor3,$$slotProps2)=>{var svg_3=root_9();append($$anchor3,svg_3)}),$$slots:{default:true}});var node_16=sibling(node_15);SpeedDialButton(node_16,{name:"Upgrade",class:"w-16",$$events:{click:()=>{set(showUpgradeModal,true)}},children:wrap_snippet(Card,($$anchor3,$$slotProps2)=>{var svg_4=root_10();append($$anchor3,svg_4)}),$$slots:{default:true}});var node_17=sibling(node_16);SpeedDialButton(node_17,{name:"Lock/Exit",class:"w-16",$$events:{click:()=>goto(PATH_LOGOUT)},children:wrap_snippet(Card,($$anchor3,$$slotProps2)=>{var svg_5=root_11();append($$anchor3,svg_5)}),$$slots:{default:true}});append($$anchor2,fragment_3)}),$$slots:{default:true}});var nav=sibling(node_10,2);var div_4=child(nav);var span_1=child(div_4);var text_1=child(span_1,true);reset(span_1);var node_18=sibling(span_1,2);{var consequent_4=$$anchor2=>{var span_2=root_12();var div_5=child(span_2);var node_19=child(div_5);{var consequent_1=$$anchor3=>{var button=root_13();button.__click=[toggleDropdown,isDropdownOpen];var text_2=child(button);reset(button);template_effect(()=>set_text(text_2,`LIVE-${get$1(networkLabel)??""}`));append($$anchor3,button)};var alternate=$$anchor3=>{var button_1=root_14();button_1.__click=[toggleDropdown,isDropdownOpen];var text_3=child(button_1);reset(button_1);template_effect(()=>set_text(text_3,`Test-${get$1(networkLabel)??""}`));append($$anchor3,button_1)};if_block(node_19,$$render=>{if(strict_equals(get$1(networkLabel).toLowerCase(),"mainnet"))$$render(consequent_1);else $$render(alternate,false)})}var node_20=sibling(node_19,2);{var consequent_3=$$anchor3=>{var ul=root_15();each(ul,21,()=>networks,index,($$anchor4,network2,$$index,$$array)=>{var li=root_16();var div_6=child(li);div_6.__click=[on_click,handleNetworkTypeChange,network2];var node_21=child(div_6);{var consequent_2=$$anchor5=>{var text_4=text();template_effect(()=>set_text(text_4,`LIVE-${get$1(network2).name??""}`));append($$anchor5,text_4)};var alternate_1=$$anchor5=>{var text_5=text();template_effect(()=>set_text(text_5,`Testnet-${get$1(network2).name??""}`));append($$anchor5,text_5)};if_block(node_21,$$render=>{if(strict_equals(get$1(network2).type,NetworkType.MAINNET))$$render(consequent_2);else $$render(alternate_1,false)})}reset(div_6);reset(li);append($$anchor4,li)});reset(ul);append($$anchor3,ul)};if_block(node_20,$$render=>{if(get$1(isDropdownOpen))$$render(consequent_3)})}reset(div_5);reset(span_2);append($$anchor2,span_2)};if_block(node_18,$$render=>{$$render(consequent_4)})}reset(div_4);reset(nav);var div_7=sibling(nav,2);var div_8=child(div_7);var p_1=sibling(child(div_8),2);var span_4=sibling(child(p_1));var text_7=child(span_4,true);reset(span_4);reset(p_1);var p_2=sibling(p_1,2);var span_5=sibling(child(p_2));var text_8=child(span_5,true);reset(span_5);var node_22=sibling(span_5,2);const expression=user_derived(()=>({value:get$1(address)}));Copy(node_22,{get target(){return get$1(expression)}});reset(p_2);reset(div_8);var div_9=sibling(div_8,2);var node_23=child(div_9);{var consequent_5=$$anchor2=>{var svg_6=root_20();append($$anchor2,svg_6)};if_block(node_23,$$render=>{if(get$1(symbolLabel))$$render(consequent_5)})}reset(div_9);var div_10=sibling(div_9,2);var span_6=child(div_10);var node_24=child(span_6);ProtectedValue(node_24,{get value(){return get$1(formattedEtherValue)},placeholder:"*******"});reset(span_6);var span_7=sibling(span_6,2);var text_9=child(span_7,true);reset(span_7);var div_11=sibling(span_7,2);var node_25=child(div_11);EyeIcon(node_25,{});var node_26=sibling(node_25,2);{var consequent_8=$$anchor2=>{const expression_1=user_derived(()=>get$1(refreshCooldown)>0?`Wait ${get$1(refreshCooldown)}s before next refresh`:get$1(canManualRefresh)?"Manual refresh (Pro feature)":"Refreshing...");SimpleTooltip($$anchor2,{get content(){return get$1(expression_1)},children:wrap_snippet(Card,($$anchor3,$$slotProps)=>{var button_2=root_22();button_2.__click=[handleManualRefresh,isProUser,isManualRefreshing,lastManualRefresh,refreshCooldown,updateWithCurrentlySelected,showErrorSafely];var node_27=child(button_2);{var consequent_6=$$anchor4=>{var div_12=root_23();append($$anchor4,div_12)};var alternate_3=($$anchor4,$$elseif)=>{{var consequent_7=$$anchor5=>{var span_8=root_25();var text_10=child(span_8,true);reset(span_8);template_effect(()=>set_text(text_10,get$1(refreshCooldown)));append($$anchor5,span_8)};var alternate_4=$$anchor5=>{var svg_7=root_26();append($$anchor5,svg_7)};if_block($$anchor4,$$render=>{if(get$1(refreshCooldown)>0)$$render(consequent_7);else $$render(alternate_4,false)},$$elseif)}};if_block(node_27,$$render=>{if(get$1(isManualRefreshing))$$render(consequent_6);else $$render(alternate_3,false)})}reset(button_2);template_effect(()=>button_2.disabled=!get$1(canManualRefresh));append($$anchor3,button_2)}),$$slots:{default:true}})};if_block(node_26,$$render=>{if(get$1(isProUser))$$render(consequent_8)})}reset(div_11);reset(div_10);var div_13=sibling(div_10,2);var span_9=child(div_13);var node_28=child(span_9);{var consequent_9=$$anchor2=>{var svg_8=root_27();append($$anchor2,svg_8)};var alternate_5=($$anchor2,$$elseif)=>{{var consequent_10=$$anchor3=>{var svg_9=root_29();append($$anchor3,svg_9)};if_block($$anchor2,$$render=>{if(strict_equals(get$1(direction),"dn"))$$render(consequent_10)},$$elseif)}};if_block(node_28,$$render=>{if(strict_equals(get$1(direction),"up"))$$render(consequent_9);else $$render(alternate_5,false)})}reset(span_9);var node_29=sibling(span_9,2);ProtectedValue(node_29,{get value(){return get$1(valueFiat)},placeholder:"*******"});var span_10=sibling(node_29,2);var text_11=child(span_10,true);reset(span_10);reset(div_13);var div_14=sibling(div_13,2);var node_30=sibling(child(div_14),2);{var consequent_11=$$anchor2=>{var span_11=root_30();var node_31=child(span_11);SkeletonBalance(node_31,{className:"inline-block",showLabel:false});reset(span_11);append($$anchor2,span_11)};var alternate_6=($$anchor2,$$elseif)=>{{var consequent_12=$$anchor3=>{var span_12=root_32();append($$anchor3,span_12)};var alternate_7=$$anchor3=>{var span_13=root_33();var node_32=child(span_13);ProtectedValue(node_32,{get value(){return get$1(portfolioValue)},placeholder:"*******"});reset(span_13);append($$anchor3,span_13)};if_block($$anchor2,$$render=>{if(strict_equals(get$1(portfolioValue),"-----")||strict_equals(get$1(portfolioValue),"$0.00"))$$render(consequent_12);else $$render(alternate_7,false)},$$elseif)}};if_block(node_30,$$render=>{if(get$1(isCalculatingPortfolio))$$render(consequent_11);else $$render(alternate_6,false)})}reset(div_14);var div_15=sibling(div_14,2);var node_33=child(div_15);const expression_2=user_derived(()=>get$1(currencyLabel)||"USD");PortfolioTotal(node_33,{className:"transform scale-90",get currency(){return get$1(expression_2)}});reset(div_15);reset(div_7);reset(div_2);reset(div_1);next(4);reset(div);template_effect($0=>{set_text(text$1,`${get$1(assetPrice)??""} ${get$1(currencyLabel)??""}`);set_attribute(nav,"id",id());set_text(text_1,$yakklCurrentlySelectedStore()&&$yakklCurrentlySelectedStore().shortcuts.network.blockchain);set_attribute(p_1,"title",get$1(name));set_text(text_7,get$1(nameShow));set_attribute(p_2,"title",get$1(address));set_text(text_8,get$1(addressShow));set_attribute(span_6,"title",$0);set_text(text_9,get$1(symbolLabel));set_text(text_11,get$1(currencyLabel))},[()=>get$1(shortcutsValue).toEtherString()]);append($$anchor,fragment);var $$pop=pop({...legacy_api()});$$cleanup();return $$pop}delegate(["click"]);_layout[FILENAME]="src/routes/(wallet)/+layout.svelte";var root_3=add_locations(from_html(`<div class="text-xs text-gray-500 p-2">Card loading...</div>`),_layout[FILENAME],[[121,2]]);var root=add_locations(from_html(`<!> <!> <div id="wrapper"><!> <!> <div class="min-h-[40rem] mx-2 overflow-hidden"><div class="relative mt-1 overflow-hidden"><main><!></main></div></div> <!></div> <!> <!> <!>`,1),_layout[FILENAME],[[110,0,[[124,1,[[125,2,[[127,3]]]]]]]]);function _layout($$anchor,$$props){check_target(new.target);push$1($$props,true,_layout);const[$$stores,$$cleanup]=setup_stores();const $yakklMiscStore=()=>(validate_store(yakklMiscStore,"yakklMiscStore"),store_get(yakklMiscStore,"$yakklMiscStore",$$stores));const $modal=()=>(validate_store(modal,"modal"),store_get(modal,"$modal",$$stores));const $modalName=()=>(validate_store(modalName,"modalName"),store_get(modalName,"$modalName",$$stores));function shouldShowErrorToUser(error2){const errorMessage=(error2==null?void 0:error2.message)||(error2==null?void 0:error2.toString())||"";const networkErrors=["missing response","timeout","TIMEOUT","SERVER_ERROR","NETWORK_ERROR","Failed to fetch","fetch","Connection failed","Request timeout","eth_getBalance","call revert exception","alchemy.com","infura.io","requestBody","serverError","code=SERVER_ERROR","version=web/","JsonRpcError","RPC Error","getBalance","Balance fetch"];return!networkErrors.some(pattern=>errorMessage.toLowerCase().includes(pattern.toLowerCase()))}let popupWidth=tag_proxy(proxy(DEFAULT_POPUP_WIDTH),"popupWidth");let popupHeight=DEFAULT_POPUP_HEIGHT;let title=tag_proxy(proxy(DEFAULT_TITLE),"title");let contextMenu=tag(state$1(false),"contextMenu");let resize=tag(state$1(false),"resize");let error=tag(state$1(false),"error");let errorValue=tag(state$1(""),"errorValue");user_effect(()=>{if(browserSvelte&&!navigator.onLine){log$1.warn("Internet connection is offline");set(errorValue,"It appears your Internet connection is offline. YAKKL needs access to the Internet to obtain current market prices and gas fees. A number of areas will either not function or work in a limited capacity. Thank you!");set(error,true)}else{set(error,false)}});user_effect(()=>{{set(contextMenu,true);set(resize,true)}if(!get$1(contextMenu))blockContextMenu();if(!get$1(resize))blockWindowResize(popupWidth,popupHeight)});onMount(async()=>{try{log$1.debug("+layout.svelte (wallet level) - onMount");sessionInitialized.set(false);if(browser_ext){await initializeUiContext(browser_ext)}window.addEventListener("error",event2=>{const error2=event2.error;if(error2&&!shouldShowErrorToUser(error2)){log$1.warn("[Global] Suppressed network error from user:",false,error2);event2.preventDefault();return false}});window.addEventListener("unhandledrejection",event2=>{const error2=event2.reason;if(error2&&!shouldShowErrorToUser(error2)){log$1.warn("[Global] Suppressed network rejection from user:",false,error2);event2.preventDefault();return false}})}catch(error2){log$1.error("+layout.svelte (wallet level) - onMount:",false,error2)}});var fragment=root();head($$anchor2=>{template_effect(()=>$document.title=title)});var node=first_child(fragment);SecurityWarningEnhanced(node,{});var node_1=sibling(node,2);ErrorNoAction(node_1,{title:"Error",get value(){return get$1(errorValue)},get show(){return get$1(error)},set show($$value){set(error,$$value,true)}});var div=sibling(node_1,2);var node_2=child(div);Header(node_2,{});var node_3=sibling(node_2,2);{var consequent=$$anchor2=>{Card($$anchor2,{})};var alternate=$$anchor2=>{var div_1=root_3();append($$anchor2,div_1)};if_block(node_3,$$render=>{if($yakklMiscStore())$$render(consequent);else $$render(alternate,false)})}var div_2=sibling(node_3,2);var div_3=child(div_2);var main=child(div_3);set_class(main,1,"p-2 max-h-[448px] overflow-y-auto overflow-x-hidden");var node_4=child(main);snippet(node_4,()=>$$props.children??noop);reset(main);reset(div_3);reset(div_2);var node_5=sibling(div_2,2);const expression=user_derived(()=>popupWidth.toString());Footer(node_5,{get containerWidth(){return get$1(expression)}});reset(div);var node_6=sibling(div,2);InAppNotifications(node_6,{});var node_7=sibling(node_6,2);TrialCountdown(node_7,{});var node_8=sibling(node_7,2);const expression_1=user_derived(()=>$modal()&&strict_equals($modalName(),"upgrade"));Upgrade(node_8,{get show(){return get$1(expression_1)},get onClose(){return closeModal},get onCancel(){return closeModal}});template_effect(()=>set_class(div,1,`w-[${popupWidth??""}px] max-w-[${popupWidth??""}px] rounded-md flex flex-col bg-gradient-to-br from-gray-900 via-gray-800 to-black min-h-screen transition-opacity duration-500 animate-fade-in overflow-hidden`));append($$anchor,fragment);var $$pop=pop({...legacy_api()});$$cleanup();return $$pop}export{_layout as component,_layout$1 as universal};
//# sourceMappingURL=6.DzOW3OcY.js.map
