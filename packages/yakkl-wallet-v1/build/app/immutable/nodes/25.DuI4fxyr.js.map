{"version":3,"file":"25.DuI4fxyr.js","sources":["../../../../../../src/routes/(dapp)/dapp/walletConnect/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { browserSvelte, browser_ext } from '$lib/common/environment';\n\timport { goto } from '$app/navigation';\n\timport { page } from '$app/stores';\n\timport {\n\t\tyakklConnectedDomainsStore,\n\t\tgetSettings,\n\t\tyakklDappConnectRequestStore\n\t} from '$lib/common/stores';\n\timport { PATH_LOGIN, YAKKL_DAPP, PATH_DAPP_ACCOUNTS } from '$lib/common/constants';\n\timport { onMount, onDestroy } from 'svelte';\n\n\timport type { Runtime } from 'webextension-polyfill';\n\timport type { Settings } from '$lib/common';\n\n\ttype RuntimePort = Runtime.Port | undefined;\n\n\tlet showConfirm = $state(false);\n\tlet showSuccess = false;\n\tlet showFailure = $state(false);\n\tlet errorValue = $state('No domain/site name was found. Access to YAKKL® is denied.');\n\tlet port: RuntimePort;\n\tlet domain: string = $state();\n\tlet domainLogo: string = $state();\n\tlet domainTitle: string = $state();\n\tlet requestData: any;\n\tlet method: string;\n\tlet requestId: string | null;\n\tlet message; // This gets passed letting the user know what the intent is\n\tlet context;\n\n\tif (browserSvelte) {\n\t\trequestId = $page.url.searchParams.get('requestId');\n\t\t$yakklDappConnectRequestStore = requestId as string;\n\t}\n\n\t// NOTE: domains will be added (if not already there at the next step - accounts)\n\tasync function handleIsLocked() {\n\t\ttry {\n\t\t\tlet yakklSettings = (await getSettings()) as Settings;\n\n\t\t\tif (yakklSettings.init && yakklSettings.isLocked === true) {\n\t\t\t\tgoto(PATH_LOGIN + '?requestId=' + requestId); // May force login auth every time so all of the checks would not be needed!\n\t\t\t} else {\n\t\t\t\tgoto(PATH_DAPP_ACCOUNTS + '?requestId=' + requestId);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\terrorValue = e as string;\n\t\t\tshowFailure = true;\n\t\t}\n\t}\n\n\tonMount(() => {\n\t\ttry {\n\t\t\tif (browserSvelte) {\n\t\t\t\tport = browser_ext.runtime.connect({ name: YAKKL_DAPP });\n\t\t\t\tport.onMessage.addListener(async (event: any) => {\n\t\t\t\t\tmethod = event.method;\n\t\t\t\t\trequestData = event.data;\n\n\t\t\t\t\tif (event.method === 'get_params') {\n\t\t\t\t\t\tdomainTitle = requestData?.data?.metaDataParams?.title ?? '';\n\t\t\t\t\t\tdomain = requestData?.data?.metaDataParams?.domain ?? '';\n\t\t\t\t\t\t// Get favicon from URL parameters first, fall back to metadata\n\t\t\t\t\t\tconst url = new URL(window.location.href);\n\t\t\t\t\t\tconst favicon = url.searchParams.get('favicon');\n\t\t\t\t\t\tdomainLogo =\n\t\t\t\t\t\t\tfavicon ||\n\t\t\t\t\t\t\t(requestData?.data?.metaDataParams?.icon ?? '/images/logoBullLock48x48.png');\n\t\t\t\t\t\tmessage =\n\t\t\t\t\t\t\trequestData?.data?.metaDataParams?.message ??\n\t\t\t\t\t\t\t'Nothing was passed in explaining the intent of this approval. Be mindful!';\n\t\t\t\t\t\tcontext = requestData?.data?.metaDataParams?.context ?? 'accounts';\n\t\t\t\t\t\trequestId = !requestId ? requestData.id : requestId;\n\n\t\t\t\t\t\tif (!domain) {\n\t\t\t\t\t\t\terrorValue = 'Domain was not found. Check the dApp site again.';\n\t\t\t\t\t\t\tshowFailure = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Only enable these if you need to CLEAR everything out for testing!\n\t\t\t\t\t\t\t// $yakklConnectedDomainsStore = [];\n\t\t\t\t\t\t\t// await setYakklConnectedDomainsStorage([]);\n\t\t\t\t\t\t\t// let yakklAccounts = [];\n\t\t\t\t\t\t\t// yakklAccounts = await getYakklAccounts();\n\t\t\t\t\t\t\t// for (const item of yakklAccounts) {\n\t\t\t\t\t\t\t//   item.connectedDomains.length = 0;\n\t\t\t\t\t\t\t// };\n\t\t\t\t\t\t\t// $yakklAccountsStore = yakklAccounts;\n\t\t\t\t\t\t\t// await setYakklAccountsStorage($yakklAccountsStore);\n\t\t\t\t\t\t\t// Comment out this section after testing for clearing\n\n\t\t\t\t\t\t\tif ($yakklConnectedDomainsStore) {\n\t\t\t\t\t\t\t\t$yakklConnectedDomainsStore.find((element) => {\n\t\t\t\t\t\t\t\t\tif (element.domain === domain) {\n\t\t\t\t\t\t\t\t\t\tconst accounts = element.addresses;\n\t\t\t\t\t\t\t\t\t\tif (port)\n\t\t\t\t\t\t\t\t\t\t\tport.postMessage({\n\t\t\t\t\t\t\t\t\t\t\t\tmethod: 'eth_requestAccounts',\n\t\t\t\t\t\t\t\t\t\t\t\tid: requestId,\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'YAKKL_RESPONSE',\n\t\t\t\t\t\t\t\t\t\t\t\tresult: accounts\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tport.postMessage({ method: 'get_params', id: requestId }); // request is not currently used but we may want to later\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.log(e);\n\t\t}\n\t});\n\n\tonDestroy(() => {\n\t\ttry {\n\t\t\tif (browserSvelte) {\n\t\t\t\tif (port) {\n\t\t\t\t\tport.disconnect();\n\t\t\t\t\t// port.onMessage.removeListener();\n\t\t\t\t\tport = undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.log(e);\n\t\t}\n\t});\n\n\tfunction handleReject() {\n\t\ttry {\n\t\t\tshowConfirm = false;\n\t\t\tshowFailure = false;\n\t\t\tshowSuccess = false;\n\n\t\t\tif (port)\n\t\t\t\tport.postMessage({\n\t\t\t\t\tmethod: method,\n\t\t\t\t\tresponse: { type: 'error', data: { code: 4001, message: 'User rejected the request.' } },\n\t\t\t\t\trequestData: requestData\n\t\t\t\t});\n\t\t\t// If requestId is not valid then use 0 since we are bailing out anyway\n\t\t\t// May want to think about putting a slight tick to make sure all queues get flushed\n\t\t\t//goto(PATH_LOGOUT); // May want to do something else if they are already logged in!\n\t\t\tif (browserSvelte) window.close();\n\t\t} catch (e) {\n\t\t\tconsole.log(e);\n\t\t}\n\t}\n\n\tfunction handleApprove() {\n\t\tshowConfirm = true;\n\t}\n</script>\n\n<svelte:head>\n\t<title>YAKKL® Smart Wallet</title>\n</svelte:head>\n\n<div class=\"modal\" class:modal-open={showConfirm}>\n\t<div class=\"modal-box relative\">\n\t\t<!-- <label for=\"my-modal-3\" class=\"btn btn-sm btn-circle absolute right-2 top-2\">✕</label> -->\n\t\t<h3 class=\"text-lg font-bold\">Connect to {domain}</h3>\n\t\t<p class=\"py-4\">\n\t\t\tThis will connect <span class=\"font-bold\">{domain}</span> to YAKKL®! Do you wish to continue?\n\t\t</p>\n\t\t<div class=\"modal-action\">\n\t\t\t<button class=\"btn\" onclick={handleReject}>Reject</button>\n\t\t\t<button class=\"btn\" onclick={handleIsLocked}>Yes, Approved</button>\n\t\t</div>\n\t</div>\n</div>\n\n<div class=\"modal\" class:modal-open={showFailure}>\n\t<div class=\"modal-box relative\">\n\t\t<!-- <label for=\"my-modal-3\" class=\"btn btn-sm btn-circle absolute right-2 top-2\">✕</label> -->\n\t\t<h3 class=\"text-lg font-bold\">Failed!</h3>\n\t\t<p class=\"py-4\">{errorValue}</p>\n\t\t<div class=\"modal-action\">\n\t\t\t<button class=\"btn\" onclick={handleReject}>Close</button>\n\t\t</div>\n\t</div>\n</div>\n\n<div class=\"text-center justify-center m-2 flex flex-col absolute top-[250px]\">\n\t<!-- <Beta /> -->\n\t<div class=\"text-primary-content text-2xl font-bold flex flex-col\">\n\t\t{domainTitle ?? ''}\n\t\t<br />\n\t\t<div class=\"text-primary-content text-2xl font-bold flex flex-col mt-4\">\n\t\t\tWants to connect to:\n\t\t</div>\n\t</div>\n\t<div class=\"text-primary-content text-2xl font-bold flex flex-col mt-3\">Connect with YAKKL®</div>\n\t<div class=\"justify-center mt-5\">\n\t\t<div class=\"rounded-badge inline-flex w-fit p-2 bg-secondary text-base-content font-semibold\">\n\t\t\t<div class=\"flex flex-row w-10 h-10\">\n\t\t\t\t<img src={domainLogo} alt=\"Dapp logo\" />\n\t\t\t</div>\n\t\t\t<div class=\"animate-pulse flex flex-row\">\n\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" class=\"w-8 h-8 fill-gray-100\">\n\t\t\t\t\t<path\n\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\td=\"M15.97 2.47a.75.75 0 011.06 0l4.5 4.5a.75.75 0 010 1.06l-4.5 4.5a.75.75 0 11-1.06-1.06l3.22-3.22H7.5a.75.75 0 010-1.5h11.69l-3.22-3.22a.75.75 0 010-1.06zm-7.94 9a.75.75 0 010 1.06l-3.22 3.22H16.5a.75.75 0 010 1.5H4.81l3.22 3.22a.75.75 0 11-1.06 1.06l-4.5-4.5a.75.75 0 010-1.06l4.5-4.5a.75.75 0 011.06 0z\"\n\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t\t<div class=\"flex flex-row w-10 h-10\">\n\t\t\t\t<img src=\"/images/logoBullFav48x48.png\" alt=\"yakkl logo\" />\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class=\"text-center flex flex-col m-4 broder border-gray-500 bg-black\">\n\t\t<p class=\"text-base-content font-bold\">Select the account(s) to use for this dApp site</p>\n\t</div>\n\n\t<div class=\"my-4\">\n\t\t<div class=\"flex space-x-2 justify-center\">\n\t\t\t<button\n\t\t\t\tonclick={handleReject}\n\t\t\t\tclass=\"btn-sm btn-accent uppercase rounded-full\"\n\t\t\t\taria-label=\"Cancel\"\n\t\t\t>\n\t\t\t\tReject\n\t\t\t</button>\n\n\t\t\t<button\n\t\t\t\ttype=\"submit\"\n\t\t\t\tid=\"recover\"\n\t\t\t\tonclick={handleApprove}\n\t\t\t\tclass=\"btn-sm btn-primary uppercase rounded-full ml-2\"\n\t\t\t\taria-label=\"Confirm\"\n\t\t\t>\n\t\t\t\tApprove\n\t\t\t</button>\n\t\t</div>\n\t</div>\n</div>\n"],"names":["handleApprove","_","showConfirm","$.tag","$.state","showSuccess","showFailure","errorValue","port","domain","domainLogo","domainTitle","requestData","method","requestId","message","context","browserSvelte","$page","url","searchParams","get","$.store_set","yakklDappConnectRequestStore","handleIsLocked","yakklSettings","getSettings","init","$.strict_equals","isLocked","goto","PATH_LOGIN","PATH_DAPP_ACCOUNTS","e","set","onMount","browser_ext","runtime","connect","name","YAKKL_DAPP","onMessage","addListener","event","data","_b","_a","metaDataParams","title","_d","_c","URL","window","location","href","favicon","_f","_e","icon","_h","_g","_j","_i","id","$yakklConnectedDomainsStore","find","element","accounts","addresses","postMessage","type","result","console","log","onDestroy","disconnect","handleReject","response","code","close","$.set_text","text_3","$.get"],"mappings":"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"}