{"version":3,"file":"28.wV6PP3Lk.js","sources":["../../../../../../src/routes/(splash)/popup/popup/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { browser_ext } from '$lib/common/environment';\n\timport { onDestroy, onMount } from 'svelte';\n\timport { YAKKL_SPLASH, NUM_OF_SPLASH_IMAGES } from '$lib/common/constants';\n\timport { wait } from '$lib/common/utils';\n\timport { log } from '$lib/common/logger-wrapper';\n\timport type { Runtime } from 'webextension-polyfill';\n\n\ttype RuntimePort = Runtime.Port;\n\n\tlet port: RuntimePort;\n\tlet isPortDisconnected = false;\n\n\tonMount(async () => {\n\t\ttry {\n\t\t\tlog.info('YAKKL: Splash: Attempting to connect to background script...');\n\n\t\t\tif (!browser_ext) {\n\t\t\t\tlog.warn('Browser extension API is unavailable.');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tport = browser_ext.runtime.connect({ name: YAKKL_SPLASH });\n\t\t\tif (port) {\n\t\t\t\tlog.debug('YAKKL: Splash: Port connected.');\n\n\t\t\t\tisPortDisconnected = false;\n\n\t\t\t\tport.onMessage.addListener((m: any) => {\n\t\t\t\t\tif (m.popup === 'YAKKL: Launched') {\n\t\t\t\t\t\twindow.close(); // Close this splash window\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tport.onDisconnect.addListener(() => {\n\t\t\t\t\tisPortDisconnected = true;\n\t\t\t\t\tlog.info('Port has been disconnected.');\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tlog.info('YAKKL: Splash: Port is trying again in 2 seconds...');\n\t\t\t\tawait wait(2000);\n\n\t\t\t\tport = browser_ext.runtime.connect({ name: YAKKL_SPLASH });\n\t\t\t\tif (port) {\n\t\t\t\t\tport.onMessage.addListener((m: any) => {\n\t\t\t\t\t\tif (m.popup === 'YAKKL: Launched') {\n\t\t\t\t\t\t\tport.disconnect();\n\t\t\t\t\t\t\twindow.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tport.onDisconnect.addListener(() => {\n\t\t\t\t\t\tisPortDisconnected = true;\n\t\t\t\t\t\tlog.info('Port has been disconnected.');\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tbrowser_ext.runtime.reload();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbrowser_ext.alarms.create('yakkl-splash-alarm', { when: Date.now() + 2000 });\n\t\t\tbrowser_ext.alarms.onAlarm.addListener((m: any) => {\n\t\t\t\tif (port && !isPortDisconnected) port.postMessage({ popup: 'YAKKL: Splash' });\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tlog.error(e);\n\t\t}\n\t});\n\n\tonDestroy(() => {\n\t\ttry {\n\t\t\tif (port) {\n\t\t\t\tport.disconnect();\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tlog.error(e);\n\t\t}\n\t});\n\n\tfunction getRandomInt(max: number) {\n\t\treturn Math.floor(Math.random() * max);\n\t}\n</script>\n\n<img src=\"/images/splash_{getRandomInt(NUM_OF_SPLASH_IMAGES)}.png\" alt=\"Splash page with logo\" />\n"],"names":["port","isPortDisconnected","onMount","async","log","info","browser_ext","warn","runtime","connect","name","YAKKL_SPLASH","debug","onMessage","addListener","m","$.strict_equals","popup","window","close","onDisconnect","wait","disconnect","reload","alarms","create","when","Date","now","onAlarm","postMessage","e","error","onDestroy","getRandomInt","max","Math","floor","random","$.template_effect","$0","$.set_attribute","img","NUM_OF_SPLASH_IMAGES","$.derived_safe_equal"],"mappings":"u4BAUK,IAAAA,SACAC,mBAAqB,MAEzBC,QAAoBC,UACf,IACHC,IAAIC,KAAK,oEAEJC,YAAa,CACjBF,IAAIG,KAAK,+CAEV,CAEAP,KAAOM,YAAYE,QAAQC,QAAA,CAAUC,KAAMC,kBACvCX,KAAM,CACTI,IAAIQ,MAAM,kCAEWX,mBAAA,MAEhBD,KAAAa,UAAUC,YAAaC,IACvB,GAAAC,cAAAD,EAAEE,MAAU,mBAAmB,CAClCC,OAAOC,OACR,IAGInB,KAAAoB,aAAaN,YAAkB,KACdb,mBAAA,KACrBG,IAAIC,KAAK,qCAEJ,CACND,IAAIC,KAAK,6DACHgB,KAAK,KAEXrB,KAAOM,YAAYE,QAAQC,QAAA,CAAUC,KAAMC,kBACvCX,KAAM,CACJA,KAAAa,UAAUC,YAAaC,IACvB,GAAAC,cAAAD,EAAEE,MAAU,mBAAmB,CAClCjB,KAAKsB,aACLJ,OAAOC,OACR,IAGInB,KAAAoB,aAAaN,YAAkB,KACdb,mBAAA,KACrBG,IAAIC,KAAK,qCAEJ,CACNC,YAAYE,QAAQe,QACrB,CACD,CAEYjB,YAAAkB,OAAOC,OAAO,qBAAwB,CAAAC,KAAMC,KAAKC,MAAQ,MACrEtB,YAAYkB,OAAOK,QAAQf,YAAaC,IACnC,GAAAf,OAASC,mBAAoBD,KAAK8B,YAAA,CAAcb,MAAO,mBAE7D,OAASc,GACR3B,IAAI4B,MAAMD,EACX,IAGDE,UAAgB,KACX,OACCjC,KAAM,CACTA,KAAKsB,YACN,CACD,OAASS,GACR3B,IAAI4B,MAAMD,EACX,IAGQ,SAAAG,aAAaC,YACdC,KAAKC,MAAMD,KAAKE,SAAWH,IACnC,uBAGyBI,gBAAAC,IAAAC,cAAAC,IAAA,MAAA,kBAAAF,IAAA,UAAA,CAAA,IAAAN,aAAaS,uBAAoBC"}