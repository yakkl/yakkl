var __defProp=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:true,configurable:true,writable:true,value:value}):obj[key]=value;var __publicField=(obj,key,value)=>__defNormalProp(obj,typeof key!=="symbol"?key+"":key,value);import{c as check_target,l as legacy_api}from"./BXFaAXnq.js";import{p as push,h as tag,o as onMount,t as template_effect,a as pop,i as state,u as user_derived,F as FILENAME,b as strict_equals,g as get,e as set,c as child,r as reset,f as first_child,s as sibling,j as next}from"./BaS8d5lg.js";import{a as add_locations}from"./3AhEABF_.js";import{s as set_text}from"./Cmwrv3PW.js";import{i as if_block}from"./Q1yPWpQ-.js";import{e as each,i as index}from"./DraJ8LN-.js";import{a as append,f as from_html,d as from_svg,c as comment}from"./Cm3jf07C.js";import{v as validate_store}from"./Dv9a3G0k.js";import{d as delegate}from"./DiU70Is3.js";import{s as set_class}from"./DX_EEhpR.js";import{p as prop}from"./BYboeQtC.js";import{s as setup_stores,a as store_get}from"./CViNpZsE.js";import{l as log_if_contains_state}from"./DZ17DrFv.js";import{w as writable}from"./B2gA1VsD.js";class NetworkManagerMod{constructor(){__publicField(this,"manifest",{id:"system-network-manager",name:"Enhanced Network Manager",version:"1.0.0",description:"Advanced network switching and management with custom networks support",author:"YAKKL Team",license:"MIT",tier:"community",category:"network",tags:["network","switching","management","custom"],permissions:["storage","network"],minimumWalletVersion:"2.0.0",supportedPlatforms:["web","extension"],discoverable:true,enhances:["wallet-core","header-component"],conflicts:[],iconUrl:"/icons/network-manager.svg",screenshotUrls:[],capabilities:{ui:{hasComponents:true,hasWidgets:true,mountPoints:["header","settings","modal"]},background:{hasWorkers:false,hasScheduledTasks:false},apis:{endpoints:["switch-network","add-network","get-networks"],webhooks:[]},storage:{maxSize:1024*1024,encrypted:false},network:{allowedHosts:["chainlist.org","ethereum.org"],requiresProxy:false}}});__publicField(this,"engine",null);__publicField(this,"loaded",false);__publicField(this,"active",false);__publicField(this,"customNetworks",[])}async initialize(engine){this.engine=engine;this.loaded=true;this.active=true;await this.loadCustomNetworks();console.log("🌐 Network Manager mod initialized");this.setupEventListeners()}async destroy(){this.loaded=false;this.active=false;this.engine=null;this.customNetworks=[];console.log("🌐 Network Manager mod destroyed")}isLoaded(){return this.loaded}isActive(){return this.active}getComponent(id){switch(id){case"network-switcher-enhanced":return this.createNetworkSwitcher();case"custom-network-form":return this.createCustomNetworkForm();case"network-status-indicator":return this.createNetworkStatusIndicator();default:return null}}getWidget(id){switch(id){case"network-performance":return this.createPerformanceWidget();case"network-security":return this.createSecurityWidget();default:return null}}getBackgroundScript(id){return null}async handleAPICall(endpoint,data){switch(endpoint){case"switch-network":return await this.switchNetwork(data.chainId);case"add-network":return await this.addCustomNetwork(data.network);case"get-networks":return await this.getAvailableNetworks();default:throw new Error(`Unknown API endpoint: ${endpoint}`)}}emit(event,data){if(this.engine){this.engine.emit(event,data)}}on(event,handler){if(this.engine){this.engine.on(event,handler)}}off(event,handler){if(this.engine){this.engine.off(event,handler)}}async enhance(otherMod){if(otherMod.manifest.id==="header-component"){return true}if(otherMod.manifest.id==="wallet-core"){return true}return false}getEnhancements(){return[{id:"enhanced-network-switching",name:"Enhanced Network Switching",description:"Faster network switching with visual feedback",targetMod:["header-component"],type:"ui-enhancement"},{id:"custom-network-support",name:"Custom Network Support",description:"Add and manage custom RPC networks",targetMod:["wallet-core"],type:"feature-enhancement"},{id:"network-performance-monitoring",name:"Network Performance Monitoring",description:"Monitor RPC performance and suggest optimal endpoints",targetMod:["wallet-core"],type:"performance-enhancement"}]}async loadCustomNetworks(){try{const stored=localStorage.getItem("yakkl:custom-networks");this.customNetworks=stored?JSON.parse(stored):[]}catch(error){console.warn("Failed to load custom networks:",error);this.customNetworks=[]}}async saveCustomNetworks(){try{localStorage.setItem("yakkl:custom-networks",JSON.stringify(this.customNetworks))}catch(error){console.error("Failed to save custom networks:",error)}}setupEventListeners(){if(!this.engine)return;this.engine.on("network:changed",network=>{console.log("🌐 Network changed via Network Manager:",network.name);this.emit("mod:network:changed",{network:network,source:"network-manager"})});this.engine.on("network:error",error=>{console.warn("🌐 Network error detected:",error);this.emit("mod:network:error",{error:error,suggestions:this.getErrorSuggestions(error)})})}async switchNetwork(chainId){if(!this.engine)throw new Error("Engine not available");try{const network=await this.validateNetwork(chainId);if(!network){throw new Error(`Network with chain ID ${chainId} not found or invalid`)}await this.engine.networks.switch(chainId.toString());this.emit("mod:network:switched",{chainId:chainId,network:network,timestamp:Date.now(),source:"network-manager-mod"});return{success:true,network:network}}catch(error){this.emit("mod:network:switch-failed",{chainId:chainId,error:error.message});throw error}}async addCustomNetwork(networkData){var _a;try{const validated=await this.validateCustomNetwork(networkData);this.customNetworks.push(validated);await this.saveCustomNetworks();if((_a=this.engine)==null?void 0:_a.networks.add){await this.engine.networks.add(validated)}this.emit("mod:network:added",{network:validated});return{success:true,network:validated}}catch(error){this.emit("mod:network:add-failed",{networkData:networkData,error:error.message});throw error}}async getAvailableNetworks(){var _a;const standardNetworks=((_a=this.engine)==null?void 0:_a.networks.getSupported())||[];return[...standardNetworks,...this.customNetworks]}async validateNetwork(chainId){const networks=await this.getAvailableNetworks();return networks.find(n=>n.chainId===chainId)}async validateCustomNetwork(data){if(!data.name||!data.rpcUrl||!data.chainId){throw new Error("Network must have name, rpcUrl, and chainId")}const existing=this.customNetworks.find(n=>n.chainId===data.chainId);if(existing){throw new Error(`Network with chain ID ${data.chainId} already exists`)}try{const response=await fetch(data.rpcUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",method:"eth_chainId",params:[],id:1})});const result=await response.json();const chainId=parseInt(result.result,16);if(chainId!==data.chainId){throw new Error(`RPC returned different chain ID: ${chainId} vs ${data.chainId}`)}}catch(error){throw new Error(`RPC validation failed: ${error.message}`)}return{...data,id:`custom-${data.chainId}`,isCustom:true,addedAt:Date.now()}}getErrorSuggestions(error){const suggestions=[];if(error.code==="NETWORK_ERROR"){suggestions.push("Check your internet connection");suggestions.push("Try switching to a different RPC endpoint")}if(error.code==="TIMEOUT"){suggestions.push("RPC endpoint is slow, consider using a faster one");suggestions.push("Check if the network is experiencing congestion")}return suggestions}createNetworkSwitcher(){return{type:"enhanced-network-switcher",props:{networks:this.getAvailableNetworks(),customNetworks:this.customNetworks,onSwitch:chainId=>this.switchNetwork(chainId),onAddCustom:network=>this.addCustomNetwork(network)}}}createCustomNetworkForm(){return{type:"custom-network-form",props:{onSubmit:data=>this.addCustomNetwork(data),onValidate:data=>this.validateCustomNetwork(data)}}}createNetworkStatusIndicator(){var _a;return{type:"network-status",props:{currentNetwork:(_a=this.engine)==null?void 0:_a.networks.getCurrent(),onRefresh:()=>this.checkNetworkHealth()}}}createPerformanceWidget(){return{type:"network-performance-widget",props:{metrics:this.getNetworkMetrics(),onOptimize:()=>this.suggestOptimalEndpoint()}}}createSecurityWidget(){return{type:"network-security-widget",props:{securityLevel:this.assessNetworkSecurity(),warnings:this.getSecurityWarnings()}}}async checkNetworkHealth(){return{healthy:true,latency:250,reliability:99.5}}getNetworkMetrics(){return{latency:250,successRate:99.2,avgBlockTime:12.5}}async suggestOptimalEndpoint(){return["https://eth.llamarpc.com","https://cloudflare-eth.com"]}assessNetworkSecurity(){return"high"}getSecurityWarnings(){return[]}}class AccountManagerMod{constructor(){__publicField(this,"manifest",{id:"system-account-manager",name:"Enhanced Account Manager",version:"1.0.0",description:"Advanced account management with security features and multi-sig support",author:"YAKKL Team",license:"MIT",tier:"community",category:"account",tags:["account","security","management","multi-sig"],permissions:["storage","accounts","signatures"],minimumWalletVersion:"2.0.0",supportedPlatforms:["web","extension"],discoverable:true,enhances:["wallet-core","header-component","transaction-manager"],conflicts:[],iconUrl:"/icons/account-manager.svg",screenshotUrls:[],capabilities:{ui:{hasComponents:true,hasWidgets:true,mountPoints:["header","accounts","settings","modal"]},background:{hasWorkers:false,hasScheduledTasks:true},apis:{endpoints:["create-account","import-account","export-account","backup-accounts"],webhooks:[]},storage:{maxSize:5*1024*1024,encrypted:true},network:{allowedHosts:["api.ens.domains"],requiresProxy:false}}});__publicField(this,"engine",null);__publicField(this,"loaded",false);__publicField(this,"active",false);__publicField(this,"accountCache",new Map);__publicField(this,"securitySettings",{})}async initialize(engine){this.engine=engine;this.loaded=true;this.active=true;await this.loadSecuritySettings();await this.initializeAccountCache();console.log("👤 Account Manager mod initialized");this.setupEventListeners();this.startSecurityMonitoring()}async destroy(){this.loaded=false;this.active=false;this.engine=null;this.accountCache.clear();this.securitySettings={};console.log("👤 Account Manager mod destroyed")}isLoaded(){return this.loaded}isActive(){return this.active}getComponent(id){switch(id){case"account-switcher-enhanced":return this.createAccountSwitcher();case"account-creation-wizard":return this.createAccountWizard();case"account-security-panel":return this.createSecurityPanel();case"account-backup-manager":return this.createBackupManager();case"multi-sig-manager":return this.createMultiSigManager();default:return null}}getWidget(id){switch(id){case"account-health":return this.createAccountHealthWidget();case"security-status":return this.createSecurityStatusWidget();case"balance-overview":return this.createBalanceOverviewWidget();default:return null}}getBackgroundScript(id){switch(id){case"security-monitor":return this.createSecurityMonitor();default:return null}}async handleAPICall(endpoint,data){switch(endpoint){case"create-account":return await this.createAccount(data);case"import-account":return await this.importAccount(data);case"export-account":return await this.exportAccount(data);case"backup-accounts":return await this.backupAccounts(data);default:throw new Error(`Unknown API endpoint: ${endpoint}`)}}emit(event,data){if(this.engine){this.engine.emit(event,data)}}on(event,handler){if(this.engine){this.engine.on(event,handler)}}off(event,handler){if(this.engine){this.engine.off(event,handler)}}async enhance(otherMod){if(otherMod.manifest.id==="transaction-manager"){return true}if(otherMod.manifest.id==="header-component"){return true}if(otherMod.manifest.id==="wallet-core"){return true}return false}getEnhancements(){return[{id:"enhanced-account-switching",name:"Enhanced Account Switching",description:"Faster account switching with ENS resolution and balance preview",targetMod:["header-component"],type:"ui-enhancement"},{id:"transaction-security-validation",name:"Transaction Security Validation",description:"Enhanced security checks for transactions",targetMod:["transaction-manager"],type:"security-enhancement"},{id:"multi-sig-support",name:"Multi-Signature Support",description:"Support for multi-signature wallets and transactions",targetMod:["wallet-core"],type:"feature-enhancement"},{id:"account-health-monitoring",name:"Account Health Monitoring",description:"Monitor account activity and detect suspicious behavior",targetMod:["wallet-core"],type:"security-enhancement"}]}async loadSecuritySettings(){try{const stored=localStorage.getItem("yakkl:account-security");this.securitySettings=stored?JSON.parse(stored):{autoLockTimeout:15,requireBiometric:false,allowScreenshots:false,maxFailedAttempts:3,enabledFeatures:["ens-resolution","balance-monitoring"]}}catch(error){console.warn("Failed to load security settings:",error);this.securitySettings={}}}async saveSecuritySettings(){try{localStorage.setItem("yakkl:account-security",JSON.stringify(this.securitySettings))}catch(error){console.error("Failed to save security settings:",error)}}async initializeAccountCache(){if(!this.engine)return;try{const accounts=await this.engine.accounts.getAll();for(const account of accounts){await this.cacheAccountData(account)}}catch(error){console.warn("Failed to initialize account cache:",error)}}async cacheAccountData(account){try{const enrichedAccount={...account,balance:await this.getAccountBalance(account.address),ensName:await this.resolveENS(account.address),lastActivity:await this.getLastActivity(account.address),securityScore:await this.calculateSecurityScore(account),cached:Date.now()};this.accountCache.set(account.address,enrichedAccount)}catch(error){console.warn(`Failed to cache data for account ${account.address}:`,error)}}setupEventListeners(){if(!this.engine)return;this.engine.on("account:created",async account=>{console.log("👤 New account created:",account.address);await this.cacheAccountData(account);this.emit("mod:account:created",{account:account,enhanced:true})});this.engine.on("account:selected",async account=>{console.log("👤 Account selected:",account.address);await this.refreshAccountCache(account.address);this.emit("mod:account:selected",{account:account,cached:this.accountCache.get(account.address)})});this.engine.on("transaction:signed",transaction=>{this.recordAccountActivity(transaction.from,"transaction_signed")})}startSecurityMonitoring(){setInterval(()=>{this.performSecurityCheck()},6e4)}async createAccount(data){if(!this.engine)throw new Error("Engine not available");try{const account=await this.engine.accounts.create(data.name);if(this.securitySettings.requireBiometric){}await this.cacheAccountData(account);this.emit("mod:account:created-enhanced",{account:account,securityLevel:this.calculateSecurityLevel(account),timestamp:Date.now()});return{success:true,account:account}}catch(error){this.emit("mod:account:creation-failed",{error:error.message,data:data});throw error}}async importAccount(data){if(!this.engine)throw new Error("Engine not available");try{await this.validateImportData(data);let account;if(data.type==="private-key"){account=await this.engine.accounts.importPrivateKey(data.privateKey,data.name)}else if(data.type==="mnemonic"){account=await this.engine.accounts.importMnemonic(data.mnemonic,data.name)}else if(data.type==="watch-only"){account=await this.engine.accounts.importWatchOnly(data.address,data.name)}else{throw new Error(`Unsupported import type: ${data.type}`)}await this.cacheAccountData(account);this.emit("mod:account:imported",{account:account,type:data.type});return{success:true,account:account}}catch(error){this.emit("mod:account:import-failed",{error:error.message,type:data.type});throw error}}async exportAccount(data){try{if(!this.validateExportPermissions(data.address)){throw new Error("Export not allowed for this account")}this.emit("mod:account:exported",{address:data.address,type:data.type});return{success:true,warning:"Keep exported data secure"}}catch(error){this.emit("mod:account:export-failed",{error:error.message,address:data.address});throw error}}async backupAccounts(data){var _a;try{const accounts=await((_a=this.engine)==null?void 0:_a.accounts.getAll())||[];const backup={version:"1.0",timestamp:Date.now(),accountCount:accounts.length,encrypted:true};this.emit("mod:account:backup-created",{backup:backup});return{success:true,backup:backup}}catch(error){this.emit("mod:account:backup-failed",{error:error.message});throw error}}async getAccountBalance(address){return"0.0"}async resolveENS(address){var _a;if(!((_a=this.securitySettings.enabledFeatures)==null?void 0:_a.includes("ens-resolution"))){return null}try{return null}catch(error){return null}}async getLastActivity(address){return Date.now()}async calculateSecurityScore(account){let score=50;if(account.type==="hardware")score+=30;if(account.type==="multi-sig")score+=25;if(this.securitySettings.requireBiometric)score+=15;return Math.min(score,100)}calculateSecurityLevel(account){const score=this.calculateSecurityScore(account);if(score>=80)return"high";if(score>=60)return"medium";return"low"}async refreshAccountCache(address){var _a;const account=await((_a=this.engine)==null?void 0:_a.accounts.get(address));if(account){await this.cacheAccountData(account)}}async validateImportData(data){if(!data.type){throw new Error("Import type is required")}if(data.type==="private-key"&&!data.privateKey){throw new Error("Private key is required")}if(data.type==="mnemonic"&&!data.mnemonic){throw new Error("Mnemonic phrase is required")}if(data.type==="watch-only"&&!data.address){throw new Error("Address is required for watch-only accounts")}}validateExportPermissions(address){return true}recordAccountActivity(address,activity){console.log(`👤 Activity recorded for ${address}: ${activity}`)}async performSecurityCheck(){}createAccountSwitcher(){return{type:"enhanced-account-switcher",props:{accounts:Array.from(this.accountCache.values()),onSwitch:address=>this.switchAccount(address),showBalances:true,showENS:true}}}createAccountWizard(){return{type:"account-creation-wizard",props:{onCreateNew:data=>this.createAccount(data),onImport:data=>this.importAccount(data),securityOptions:this.securitySettings}}}createSecurityPanel(){return{type:"account-security-panel",props:{settings:this.securitySettings,onUpdateSettings:settings=>this.updateSecuritySettings(settings)}}}createBackupManager(){return{type:"account-backup-manager",props:{onCreateBackup:options=>this.backupAccounts(options),onRestoreBackup:backup=>this.restoreBackup(backup)}}}createMultiSigManager(){return{type:"multi-sig-manager",props:{multiSigAccounts:this.getMultiSigAccounts(),onCreateMultiSig:config=>this.createMultiSig(config)}}}createAccountHealthWidget(){return{type:"account-health-widget",props:{accounts:Array.from(this.accountCache.values()),healthScores:this.getAccountHealthScores()}}}createSecurityStatusWidget(){return{type:"security-status-widget",props:{overallStatus:this.getOverallSecurityStatus(),alerts:this.getSecurityAlerts()}}}createBalanceOverviewWidget(){return{type:"balance-overview-widget",props:{totalBalance:this.calculateTotalBalance(),accountBalances:this.getAccountBalances()}}}createSecurityMonitor(){return{type:"security-monitor-worker",script:()=>{setInterval(()=>{this.performSecurityCheck()},3e5)}}}async switchAccount(address){if(this.engine){await this.engine.accounts.select(address)}}async updateSecuritySettings(settings){this.securitySettings={...this.securitySettings,...settings};await this.saveSecuritySettings()}async restoreBackup(backup){return{success:true}}getMultiSigAccounts(){return Array.from(this.accountCache.values()).filter(acc=>acc.type==="multi-sig")}async createMultiSig(config){return{success:true}}getAccountHealthScores(){const scores={};for(const[address,account]of this.accountCache){scores[address]=account.securityScore||50}return scores}getOverallSecurityStatus(){return"secure"}getSecurityAlerts(){return[]}calculateTotalBalance(){return"0.0"}getAccountBalances(){const balances={};for(const[address,account]of this.accountCache){balances[address]=account.balance||"0.0"}return balances}}const _SystemModRegistry=class _SystemModRegistry{constructor(){__publicField(this,"mods",new Map);__publicField(this,"loadedMods",new Map);this.registerSystemMods()}static getInstance(){if(!_SystemModRegistry.instance){_SystemModRegistry.instance=new _SystemModRegistry}return _SystemModRegistry.instance}registerSystemMods(){this.mods.set("system-network-manager",{id:"system-network-manager",name:"Enhanced Network Manager",description:"Advanced network switching and management with custom networks support",category:"network",tier:"community",loader:async()=>new NetworkManagerMod,enabled:true,systemMod:true});this.mods.set("system-account-manager",{id:"system-account-manager",name:"Enhanced Account Manager",description:"Advanced account management with security features and multi-sig support",category:"account",tier:"community",loader:async()=>new AccountManagerMod,enabled:true,systemMod:true});console.log("📋 System mod registry initialized with",this.mods.size,"mods")}getAvailableMods(){return Array.from(this.mods.values())}getModsByCategory(category){return Array.from(this.mods.values()).filter(mod=>mod.category===category)}getEnabledMods(){return Array.from(this.mods.values()).filter(mod=>mod.enabled)}getSystemMods(){return Array.from(this.mods.values()).filter(mod=>mod.systemMod)}async loadMod(modId){const entry=this.mods.get(modId);if(!entry){console.warn(`Mod ${modId} not found in registry`);return null}if(!entry.enabled){console.warn(`Mod ${modId} is disabled`);return null}if(this.loadedMods.has(modId)){return this.loadedMods.get(modId)}try{console.log(`📦 Loading mod: ${entry.name}`);const mod=await entry.loader();this.loadedMods.set(modId,mod);console.log(`✅ Loaded mod: ${entry.name}`);return mod}catch(error){console.error(`Failed to load mod ${modId}:`,error);return null}}async loadAllEnabledMods(){const enabledMods=this.getEnabledMods();const loadPromises=enabledMods.map(entry=>this.loadMod(entry.id));const results=await Promise.allSettled(loadPromises);return results.filter(result=>result.status==="fulfilled"&&result.value!==null).map(result=>result.value)}async loadSystemMods(){const systemMods=this.getSystemMods();const loadPromises=systemMods.map(entry=>this.loadMod(entry.id));const results=await Promise.allSettled(loadPromises);return results.filter(result=>result.status==="fulfilled"&&result.value!==null).map(result=>result.value)}setModEnabled(modId,enabled){const entry=this.mods.get(modId);if(!entry){return false}entry.enabled=enabled;if(!enabled&&this.loadedMods.has(modId)){const mod=this.loadedMods.get(modId);if(mod&&mod.destroy){mod.destroy().catch(err=>console.warn(`Error destroying mod ${modId}:`,err))}this.loadedMods.delete(modId)}return true}getLoadedMod(modId){return this.loadedMods.get(modId)||null}getLoadedMods(){return Array.from(this.loadedMods.values())}isModLoaded(modId){return this.loadedMods.has(modId)}async unloadMod(modId){const mod=this.loadedMods.get(modId);if(!mod){return false}try{if(mod.destroy){await mod.destroy()}this.loadedMods.delete(modId);console.log(`🗑️ Unloaded mod: ${modId}`);return true}catch(error){console.error(`Failed to unload mod ${modId}:`,error);return false}}async unloadAllMods(){const unloadPromises=Array.from(this.loadedMods.keys()).map(modId=>this.unloadMod(modId));await Promise.allSettled(unloadPromises);this.loadedMods.clear()}registerMod(entry){if(this.mods.has(entry.id)){console.warn(`Mod ${entry.id} is already registered`);return false}this.mods.set(entry.id,{...entry,systemMod:false});console.log(`📝 Registered mod: ${entry.name}`);return true}async unregisterMod(modId){const entry=this.mods.get(modId);if(!entry){return false}if(entry.systemMod){console.warn(`Cannot unregister system mod: ${modId}`);return false}if(this.loadedMods.has(modId)){await this.unloadMod(modId)}this.mods.delete(modId);console.log(`🗑️ Unregistered mod: ${entry.name}`);return true}searchMods(query){const lowerQuery=query.toLowerCase();return Array.from(this.mods.values()).filter(mod=>mod.name.toLowerCase().includes(lowerQuery)||mod.description.toLowerCase().includes(lowerQuery)||mod.category.toLowerCase().includes(lowerQuery))}getStatistics(){const mods2=Array.from(this.mods.values());const byCategory={};for(const mod of mods2){byCategory[mod.category]=(byCategory[mod.category]||0)+1}return{total:mods2.length,enabled:mods2.filter(m=>m.enabled).length,loaded:this.loadedMods.size,system:mods2.filter(m=>m.systemMod).length,thirdParty:mods2.filter(m=>!m.systemMod).length,byCategory:byCategory}}};__publicField(_SystemModRegistry,"instance");let SystemModRegistry=_SystemModRegistry;const systemModRegistry=SystemModRegistry.getInstance();console.log("📋 System mod registry exported");class CoreIntegration{constructor(){__publicField(this,"engine",null);__publicField(this,"initialized",false);__publicField(this,"mods",writable([]));__publicField(this,"enhancements",writable([]));__publicField(this,"discoveredMods",writable([]))}static getInstance(){if(!globalThis.coreIntegration){globalThis.coreIntegration=new CoreIntegration}return globalThis.coreIntegration}async initialize(){if(this.initialized)return;try{this.engine=this.createMockEngine();console.log("🔧 Using mock engine - YAKKL Core integration ready for future");this.setupEventListeners();await this.loadSystemMods();this.updateStores();this.initialized=true}catch(error){console.error("Failed to initialize core integration:",error);this.engine=this.createMockEngine();this.initialized=true;console.warn("⚠️ Using mock engine - YAKKL Core initialization failed")}}createMockEngine(){return{initialize(){return Promise.resolve()},async destroy(){},on(event,handler){},emit(event,data){},off(event,handler){},async loadMod(id){return await systemModRegistry.loadMod(id)},async discoverMods(){return systemModRegistry.getAvailableMods()},async getLoadedMods(){return systemModRegistry.getLoadedMods()},accounts:{getAll:()=>[],getCurrent:()=>null,create:name=>Promise.resolve({address:"0x...",name:name}),select:address=>Promise.resolve()},networks:{getSupported:()=>[],getCurrent:()=>({chainId:1,name:"Ethereum"}),switch:chainId=>Promise.resolve()},transactions:{getHistory:()=>[]}}}async loadSystemMods(){var _a,_b;try{console.log("📦 Loading system mods...");const systemMods=await systemModRegistry.loadSystemMods();for(const mod of systemMods){try{if(this.engine&&mod.initialize){await mod.initialize(this.engine);console.log(`✅ Initialized system mod: ${((_a=mod.manifest)==null?void 0:_a.name)||"Unknown"}`)}}catch(error){console.error(`Failed to initialize system mod ${(_b=mod.manifest)==null?void 0:_b.id}:`,error)}}console.log(`📦 Loaded ${systemMods.length} system mods`)}catch(error){console.error("Failed to load system mods:",error)}}async loadMod(modId){try{let mod=await systemModRegistry.loadMod(modId);if(mod&&this.engine){if(mod.initialize){await mod.initialize(this.engine)}this.updateStores();return mod}if(this.engine){mod=await this.engine.loadMod(modId);this.updateStores();return mod}return null}catch(error){console.error(`Failed to load mod ${modId}:`,error);return null}}async discoverMods(){try{const systemMods=systemModRegistry.getAvailableMods();let engineMods=[];if(this.engine){try{engineMods=await this.engine.discoverMods()}catch(error){console.warn("Engine mod discovery failed:",error)}}const allDiscovered=[...systemMods,...engineMods];this.discoveredMods.set(allDiscovered);return allDiscovered}catch(error){console.error("Failed to discover mods:",error);return[]}}async getModsByCategory(category){if(!this.engine)return[];try{const loadedMods=await this.engine.getLoadedMods();return loadedMods.filter(mod=>mod.manifest.category===category)}catch(error){console.error("Failed to get mods by category:",error);return[]}}async checkEnhancements(feature){if(!this.engine)return[];try{const loadedMods=await this.engine.getLoadedMods();const enhancements2=[];for(const mod of loadedMods){const modEnhancements=mod.getEnhancements();const relevantEnhancements=modEnhancements.filter(e=>e.targetMod.includes(feature)||e.description.toLowerCase().includes(feature.toLowerCase()));enhancements2.push(...relevantEnhancements)}return enhancements2}catch(error){console.error("Failed to check enhancements:",error);return[]}}setupEventListeners(){if(!this.engine)return;this.engine.on("mod:loaded",()=>{this.updateStores()});this.engine.on("mod:discovered",mods2=>{this.discoveredMods.set(mods2)})}async updateStores(){var _a;try{const systemMods=systemModRegistry.getLoadedMods();let engineMods=[];if(this.engine){try{engineMods=await this.engine.getLoadedMods()}catch(error){console.warn("Engine mod loading failed:",error)}}const allLoadedMods=[...systemMods,...engineMods];this.mods.set(allLoadedMods);const allEnhancements=[];for(const mod of allLoadedMods){if(mod.getEnhancements){try{allEnhancements.push(...mod.getEnhancements())}catch(error){console.warn(`Failed to get enhancements from mod ${(_a=mod.manifest)==null?void 0:_a.id}:`,error)}}}this.enhancements.set(allEnhancements);console.log(`📊 Updated stores: ${allLoadedMods.length} mods, ${allEnhancements.length} enhancements`)}catch(error){console.error("Failed to update stores:",error)}}isAvailable(){return this.initialized&&this.engine!==null}getEngine(){return this.engine}getAccountManager(){var _a;return((_a=this.engine)==null?void 0:_a.accounts)||null}getNetworkManager(){var _a;return((_a=this.engine)==null?void 0:_a.networks)||null}getTransactionManager(){var _a;return((_a=this.engine)==null?void 0:_a.transactions)||null}async destroy(){if(this.engine){await this.engine.destroy();this.engine=null}this.initialized=false}}const coreIntegration=CoreIntegration.getInstance();let initPromise=null;async function initializeCore(){if(!initPromise){initPromise=coreIntegration.initialize()}return initPromise}const{mods:mods,enhancements:enhancements,discoveredMods:discoveredMods}=coreIntegration;function isCoreAvailable(){return coreIntegration.isAvailable()}async function loadMod(id){return coreIntegration.loadMod(id)}async function discoverMods(){return coreIntegration.discoverMods()}async function checkEnhancements(feature){return coreIntegration.checkEnhancements(feature)}delegate(["click"]);ModDashboard[FILENAME]="src/routes/preview2/lib/components/mods/ModDashboard.svelte";var root_1=add_locations(from_html(`<div class="p-6 text-center"><div class="mb-4"><svg class="w-12 h-12 mx-auto text-zinc-400 dark:text-zinc-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path></svg></div> <h3 class="text-lg font-semibold text-zinc-900 dark:text-white mb-2">Mod System</h3> <p class="text-sm text-zinc-600 dark:text-zinc-400 mb-4">YAKKL Core is not available. Mod functionality is disabled.</p> <div class="text-xs text-zinc-500 dark:text-zinc-500">The mod system will be available once YAKKL Core is integrated.</div></div>`),ModDashboard[FILENAME],[[71,4,[[72,6,[[73,8,[[74,10]]]]],[77,6],[78,6],[81,6]]]]);var root_3=add_locations(from_svg(`<svg class="w-4 h-4 animate-spin mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>`),ModDashboard[FILENAME],[[106,10,[[107,12]]]]);var on_click=(_,activeTab)=>set(activeTab,"installed");var on_click_1=(__1,activeTab)=>set(activeTab,"discover");var on_click_2=(__2,selectedCategory,category)=>set(selectedCategory,get(category).id,true);var root_4=add_locations(from_html(`<button> </button>`),ModDashboard[FILENAME],[[141,8]]);var on_click_3=(__3,activeTab)=>set(activeTab,"discover");var root_6=add_locations(from_html(`<div class="text-center py-12"><div class="mb-4"><svg class="w-16 h-16 mx-auto text-zinc-300 dark:text-zinc-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg></div> <h3 class="text-lg font-medium text-zinc-900 dark:text-white mb-2"> </h3> <p class="text-sm text-zinc-600 dark:text-zinc-400 mb-4"> </p> <button class="yakkl-btn-primary text-sm">Discover Mods</button></div>`),ModDashboard[FILENAME],[[158,8,[[159,10,[[160,12,[[161,14]]]]],[164,10],[167,10],[173,10]]]]);var root_8=add_locations(from_html(`<div class="bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-xl p-4 hover:shadow-md transition-shadow"><div class="flex items-start gap-3 mb-3"><div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center text-white text-sm font-bold"> </div> <div class="flex-1 min-w-0"><div class="flex items-center gap-2 mb-1"><h3 class="font-medium text-zinc-900 dark:text-white truncate"> </h3> <span> </span></div> <p class="text-sm text-zinc-600 dark:text-zinc-400 line-clamp-2 svelte-efadq"> </p></div></div> <div class="flex items-center justify-between"><div class="text-xs text-zinc-500 dark:text-zinc-500"> </div> <div class="flex gap-2"><span class="inline-flex items-center px-2 py-1 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300 text-xs rounded-full">✓ Active</span></div></div></div>`),ModDashboard[FILENAME],[[183,12,[[184,14,[[185,16],[188,16,[[189,18,[[190,20],[193,20]]],[197,18]]]]],[203,14,[[204,16],[207,16,[[208,18]]]]]]]]);var root_7=add_locations(from_html(`<div class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>`),ModDashboard[FILENAME],[[181,8]]);var root_10=add_locations(from_html(`<div class="text-center py-12"><div class="mb-4"><svg class="w-16 h-16 mx-auto text-zinc-300 dark:text-zinc-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div> <h3 class="text-lg font-medium text-zinc-900 dark:text-white mb-2">No mods discovered</h3> <p class="text-sm text-zinc-600 dark:text-zinc-400 mb-4">Discovery is scanning for available mods in your environment</p> <button class="yakkl-btn-primary text-sm">Scan Again</button></div>`),ModDashboard[FILENAME],[[220,8,[[221,10,[[222,12,[[223,14]]]]],[226,10],[227,10],[230,10]]]]);var on_click_4=(__4,installMod,mod)=>{var _a;return installMod(((_a=get(mod).manifest)==null?void 0:_a.id)||get(mod).id)};var root_12=add_locations(from_html(`<div class="bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-xl p-4"><div class="flex items-center justify-between"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center text-white text-sm font-bold"> </div> <div><h3 class="font-medium text-zinc-900 dark:text-white"> </h3> <p class="text-sm text-zinc-600 dark:text-zinc-400"> </p></div></div> <button class="yakkl-btn-primary text-sm">Install</button></div></div>`),ModDashboard[FILENAME],[[240,12,[[241,14,[[242,16,[[243,18],[246,18,[[247,20],[250,20]]]]],[256,16]]]]]]);var root_11=add_locations(from_html(`<div class="space-y-4"></div>`),ModDashboard[FILENAME],[[238,8]]);var root_2=add_locations(from_html(`<div class="flex items-center justify-between mb-6"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center text-white"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg></div> <div><h2 class="text-xl font-bold text-zinc-900 dark:text-white">Mods</h2> <p class="text-sm text-zinc-600 dark:text-zinc-400">Extend your wallet with plugins</p></div></div> <button><!> Discover</button></div> <div class="flex gap-1 mb-6"><button> </button> <button> </button></div> <div class="flex flex-wrap gap-2 mb-6"></div> <!>`,1),ModDashboard[FILENAME],[[87,4,[[88,6,[[89,8,[[90,10,[[91,12]]]]],[94,8,[[95,10],[96,10]]]]],[100,6]]],[115,4,[[116,6],[126,6]]],[139,4]]);var root=add_locations(from_html(`<div><!></div>`),ModDashboard[FILENAME],[[69,0]]);function ModDashboard($$anchor,$$props){check_target(new.target);push($$props,true,ModDashboard);const[$$stores,$$cleanup]=setup_stores();const $mods=()=>(validate_store(mods,"mods"),store_get(mods,"$mods",$$stores));const $discoveredMods=()=>(validate_store(discoveredMods,"discoveredMods"),store_get(discoveredMods,"$discoveredMods",$$stores));let className=prop($$props,"className",3,"");let loading=tag(state(false),"loading");let activeTab=tag(state("installed"),"activeTab");let selectedCategory=tag(state("all"),"selectedCategory");let loadedMods=tag(user_derived($mods),"loadedMods");let discovered=tag(user_derived($discoveredMods),"discovered");const categories=[{id:"all",name:"All",icon:"📦"},{id:"portfolio",name:"Portfolio",icon:"💼"},{id:"trading",name:"Trading",icon:"📈"},{id:"defi",name:"DeFi",icon:"🏦"},{id:"security",name:"Security",icon:"🔒"},{id:"analytics",name:"Analytics",icon:"📊"},{id:"utility",name:"Utility",icon:"🛠️"}];let filteredMods=tag(user_derived(()=>()=>{if(strict_equals(get(selectedCategory),"all")){return get(loadedMods)}return get(loadedMods).filter(v=>strict_equals(v.manifest.category,get(selectedCategory)))}),"filteredMods");onMount(async()=>{if(isCoreAvailable()){await refreshDiscovery()}});async function refreshDiscovery(){set(loading,true);try{await discoverMods()}catch(error){console.error(...log_if_contains_state("error","Failed to discover mods:",error))}finally{set(loading,false)}}async function installMod(modId){try{await loadMod(modId)}catch(error){console.error(...log_if_contains_state("error",`Failed to install mod ${modId}:`,error))}}function getTierColor(tier){switch(tier){case"community":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-200";case"verified":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200";case"pro":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-200";case"private":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-200";case"enterprise":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200";default:return"bg-zinc-100 text-zinc-800 dark:bg-zinc-800 dark:text-zinc-200"}}function getCategoryIcon(category){const cat=categories.find(c=>strict_equals(c.id,category));return(cat==null?void 0:cat.icon)||"📦"}var div=root();var node=child(div);{var consequent=$$anchor2=>{var div_1=root_1();append($$anchor2,div_1)};var alternate=$$anchor2=>{var fragment=root_2();var div_2=first_child(fragment);var button=sibling(child(div_2),2);button.__click=refreshDiscovery;var node_1=child(button);{var consequent_1=$$anchor3=>{var svg=root_3();append($$anchor3,svg)};if_block(node_1,$$render=>{if(get(loading))$$render(consequent_1)})}next();reset(button);reset(div_2);var div_3=sibling(div_2,2);var button_1=child(div_3);button_1.__click=[on_click,activeTab];var text=child(button_1);reset(button_1);var button_2=sibling(button_1,2);button_2.__click=[on_click_1,activeTab];var text_1=child(button_2);reset(button_2);reset(div_3);var div_4=sibling(div_3,2);each(div_4,21,()=>categories,index,($$anchor3,category)=>{var button_3=root_4();button_3.__click=[on_click_2,selectedCategory,category];var text_2=child(button_3);reset(button_3);template_effect(()=>{set_class(button_3,1,`px-3 py-1 text-sm rounded-full transition-colors ${strict_equals(get(selectedCategory),get(category).id)?"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/50 dark:text-indigo-300":"bg-zinc-100 text-zinc-600 dark:bg-zinc-800 dark:text-zinc-400 hover:bg-zinc-200 dark:hover:bg-zinc-700"}`);set_text(text_2,`${get(category).icon??""} ${get(category).name??""}`)});append($$anchor3,button_3)});reset(div_4);var node_2=sibling(div_4,2);{var consequent_3=$$anchor3=>{var fragment_1=comment();var node_3=first_child(fragment_1);{var consequent_2=$$anchor4=>{var div_5=root_6();var h3=sibling(child(div_5),2);var text_3=child(h3,true);reset(h3);var p=sibling(h3,2);var text_4=child(p,true);reset(p);var button_4=sibling(p,2);button_4.__click=[on_click_3,activeTab];reset(div_5);template_effect(()=>{set_text(text_3,strict_equals(get(selectedCategory),"all")?"No mods installed":`No ${get(selectedCategory)} mods`);set_text(text_4,strict_equals(get(selectedCategory),"all")?"Discover and install mods to extend your wallet functionality":`Browse other categories or discover new ${get(selectedCategory)} mods`)});append($$anchor4,div_5)};var alternate_1=$$anchor4=>{var div_6=root_7();each(div_6,21,()=>get(filteredMods),index,($$anchor5,mod)=>{var div_7=root_8();var div_8=child(div_7);var div_9=child(div_8);var text_5=child(div_9,true);reset(div_9);var div_10=sibling(div_9,2);var div_11=child(div_10);var h3_1=child(div_11);var text_6=child(h3_1,true);reset(h3_1);var span=sibling(h3_1,2);var text_7=child(span,true);reset(span);reset(div_11);var p_1=sibling(div_11,2);var text_8=child(p_1,true);reset(p_1);reset(div_10);reset(div_8);var div_12=sibling(div_8,2);var div_13=child(div_12);var text_9=child(div_13);reset(div_13);next(2);reset(div_12);reset(div_7);template_effect(($0,$1)=>{set_text(text_5,$0);set_text(text_6,get(mod).manifest.name);set_class(span,1,$1,"svelte-efadq");set_text(text_7,get(mod).manifest.tier);set_text(text_8,get(mod).manifest.description);set_text(text_9,`v${get(mod).manifest.version??""}`)},[()=>getCategoryIcon(get(mod).manifest.category),()=>`px-2 py-0.5 text-xs font-medium rounded-full ${getTierColor(get(mod).manifest.tier)}`]);append($$anchor5,div_7)});reset(div_6);append($$anchor4,div_6)};if_block(node_3,$$render=>{if(strict_equals(get(filteredMods).length,0))$$render(consequent_2);else $$render(alternate_1,false)})}append($$anchor3,fragment_1)};var alternate_2=$$anchor3=>{var fragment_2=comment();var node_4=first_child(fragment_2);{var consequent_4=$$anchor4=>{var div_14=root_10();var button_5=sibling(child(div_14),6);button_5.__click=refreshDiscovery;reset(div_14);append($$anchor4,div_14)};var alternate_3=$$anchor4=>{var div_15=root_11();each(div_15,21,()=>get(discovered),index,($$anchor5,mod)=>{var div_16=root_12();var div_17=child(div_16);var div_18=child(div_17);var div_19=child(div_18);var text_10=child(div_19,true);reset(div_19);var div_20=sibling(div_19,2);var h3_2=child(div_20);var text_11=child(h3_2,true);reset(h3_2);var p_2=sibling(h3_2,2);var text_12=child(p_2,true);reset(p_2);reset(div_20);reset(div_18);var button_6=sibling(div_18,2);button_6.__click=[on_click_4,installMod,mod];reset(div_17);reset(div_16);template_effect($0=>{var _a,_b;set_text(text_10,$0);set_text(text_11,((_a=get(mod).manifest)==null?void 0:_a.name)||get(mod).id);set_text(text_12,((_b=get(mod).manifest)==null?void 0:_b.description)||"No description available")},[()=>{var _a;return getCategoryIcon(((_a=get(mod).manifest)==null?void 0:_a.category)||"utility")}]);append($$anchor5,div_16)});reset(div_15);append($$anchor4,div_15)};if_block(node_4,$$render=>{if(strict_equals(get(discovered).length,0))$$render(consequent_4);else $$render(alternate_3,false)})}append($$anchor3,fragment_2)};if_block(node_2,$$render=>{if(strict_equals(get(activeTab),"installed"))$$render(consequent_3);else $$render(alternate_2,false)})}template_effect(()=>{button.disabled=get(loading);set_class(button,1,`yakkl-btn-secondary text-sm ${get(loading)?"opacity-50":""}`);set_class(button_1,1,`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${strict_equals(get(activeTab),"installed")?"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/50 dark:text-indigo-300":"text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800"}`);set_text(text,`Installed (${get(loadedMods).length??""})`);set_class(button_2,1,`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${strict_equals(get(activeTab),"discover")?"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/50 dark:text-indigo-300":"text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800"}`);set_text(text_1,`Discover (${get(discovered).length??""})`)});append($$anchor2,fragment)};if_block(node,$$render=>{if(!isCoreAvailable())$$render(consequent);else $$render(alternate,false)})}reset(div);template_effect(()=>set_class(div,1,`mod-dashboard ${className()}`,"svelte-efadq"));append($$anchor,div);var $$pop=pop({...legacy_api()});$$cleanup();return $$pop}delegate(["click"]);export{ModDashboard as M,initializeCore as a,discoverMods as b,checkEnhancements as c,discoveredMods as d,isCoreAvailable as i,loadMod as l,mods as m,systemModRegistry as s};
//# sourceMappingURL=B6Kd56jc.js.map
