import{c as check_target,l as legacy_api}from"./BXFaAXnq.js";import{p as push,h as tag,i as state,f as first_child,c as child,r as reset,s as sibling,b as strict_equals,g as get,e as set,t as template_effect,a as pop,F as FILENAME,j as next}from"./BaS8d5lg.js";import{c as create_ownership_validator}from"./COgMMZ9C.js";import{w as wrap_snippet}from"./d5hrMixo.js";import{p as prop}from"./BYboeQtC.js";import{M as Modal}from"./UU1vCwIM.js";import{a as add_locations}from"./3AhEABF_.js";import{s as set_text}from"./Cmwrv3PW.js";import{i as if_block}from"./Q1yPWpQ-.js";import{a as append,f as from_html}from"./Cm3jf07C.js";import{d as delegate,b as apply}from"./DiU70Is3.js";import{E as EmergencyKitManager}from"./BGfGzDFG.js";import{h as getMiscStore,V as VERSION,aH as yakklPreferencesStore,aI as setPreferencesStorage,a8 as yakklSettingsStore,u as setSettingsStorage,al as profileStore,am as setProfileStorage,Z as yakklCurrentlySelectedStore,ak as setYakklCurrentlySelectedStorage,a5 as yakklContactsStore,aG as setYakklContactsStorage,aJ as yakklChatsStore,aK as setYakklChatsStorage,aL as yakklAccountsStore,az as setYakklAccountsStorage,aM as yakklPrimaryAccountsStore,ax as setYakklPrimaryAccountsStorage,aN as yakklWatchListStore,aO as setYakklWatchListStorage,aP as yakklBlockedListStore,aQ as setYakklBlockedListStorage,e as yakklConnectedDomainsStore,aR as setYakklConnectedDomainsStorage,ai as yakklTokenDataStore,aS as setYakklTokenDataStorage,ah as yakklTokenDataCustomStore,af as setYakklTokenDataCustomStorage,aj as yakklCombinedTokenStore,at as setYakklCombinedTokenStorage,aT as yakklWalletProvidersStore,aU as setYakklWalletProvidersStorage,aV as yakklWalletBlockchainsStore,aW as setYakklWalletBlockchainsStorage,aX as getPreferences,g as getSettings,v as getProfile,C as getYakklCurrentlySelected,a6 as getYakklContacts,aY as getYakklChats,o as getYakklAccounts,p as getYakklPrimaryAccounts,aZ as getYakklWatchList,a_ as getYakklBlockedList,ao as getYakklConnectedDomains,a$ as getYakklTokenData,b0 as getYakklTokenDataCustom,b1 as getYakklCombinedToken,b2 as getYakklWalletProviders,b3 as getYakklWalletBlockchains}from"./Cb2naUpm.js";import{l as log}from"./WDN37msH.js";import"./CgCfpVku.js";import{C as Confirmation}from"./BWiVuumU.js";import{s as safeLogout}from"./COpD6KvM.js";EmergencyKit[FILENAME]="src/lib/components/EmergencyKit.svelte";async function handleFileSelect(event,file,metadata,error){const target=event.target;if(target.files&&target.files.length>0){set(file,target.files[0],true);try{set(metadata,await EmergencyKitManager.readBulkEmergencyKitMetadata(get(file)),true)}catch(err){set(error,"Failed to read emergency kit metadata");log.error(err)}}}async function handleExport(_,loading,error,$$props){set(loading,true);set(error,"");try{const preferences=await getPreferences();const settings=await getSettings();const profile=await getProfile();const currentlySelected=await getYakklCurrentlySelected();const contacts=await getYakklContacts();const chats=await getYakklChats();const accounts=await getYakklAccounts();const primaryAccounts=await getYakklPrimaryAccounts();const watchList=await getYakklWatchList();const blockedList=await getYakklBlockedList();const connectedDomains=await getYakklConnectedDomains();const passwordOrSaltedKey=getMiscStore();const tokenData=await getYakklTokenData();const tokenDataCustom=await getYakklTokenDataCustom();const combinedTokenStore=await getYakklCombinedToken();const walletProviders=await getYakklWalletProviders();const walletBlockchains=await getYakklWalletBlockchains();if(!preferences||!settings||!profile||!currentlySelected||!passwordOrSaltedKey){throw new Error("Missing required data for export")}const bulkEmergencyKit=await EmergencyKitManager.createBulkEmergencyKit(preferences,settings,profile,currentlySelected,contacts??[],chats??[],accounts??[],primaryAccounts??[],watchList??[],blockedList??[],connectedDomains??[],passwordOrSaltedKey,tokenData??[],tokenDataCustom??[],combinedTokenStore??[],walletProviders??[],walletBlockchains??[]);const fileName=await EmergencyKitManager.downloadBulkEmergencyKit(bulkEmergencyKit);$$props.onComplete(true,"Emergency kit exported successfully as "+fileName)}catch(err){set(error,err instanceof Error?err.message:"Failed to export emergency kit",true);log.error(err);$$props.onComplete(false,get(error))}finally{set(loading,false)}}async function handleImport(__1,file,error,showConfirmation){if(!get(file)){set(error,"Please select a file to import");return}set(showConfirmation,true)}var root_1=add_locations(from_html(`<button class="bg-blue-500 text-white px-4 py-2 rounded"> </button>`),EmergencyKit[FILENAME],[[258,2]]);var root_3=add_locations(from_html(`<div class="mb-4"><h3 class="text-lg font-semibold">Emergency Kit Metadata:</h3> <p> </p> <p> </p> <p> </p> <p> </p> <p> </p></div> <div class="mb-4"><h4 class="text-lg font-bold">YAKKL will <span class="text-red-500 underline">auto logout</span> once the import is complete!\n\t\t\t\t\tSimply login again to continue.</h4></div>`,1),EmergencyKit[FILENAME],[[277,3,[[278,4],[279,4],[280,4],[281,4],[282,4],[283,4]]],[285,3,[[286,4,[[287,16]]]]]]);var root_2=add_locations(from_html(`<div class="mb-4"><label for="importFile" class="block mb-2">Select File to Import:</label> <input type="file" id="importFile" accept=".json" class="w-full p-2 border rounded"/></div> <!> <button class="bg-green-500 text-white px-4 py-2 rounded"> </button> <button class="bg-red-400 text-white px-4 py-2 rounded">Cancel</button>`,1),EmergencyKit[FILENAME],[[266,2,[[267,3],[268,3]]],[292,2],[299,2]]);var root_4=add_locations(from_html(`<p class="text-red-500 mt-4"> </p>`),EmergencyKit[FILENAME],[[303,2]]);var root=add_locations(from_html(`<div class="p-4"><h2 class="text-2xl font-bold mb-4"> </h2> <!> <!></div> <!>`,1),EmergencyKit[FILENAME],[[254,0,[[255,1]]]]);function EmergencyKit($$anchor,$$props){check_target(new.target);push($$props,true,EmergencyKit);let mode=prop($$props,"mode",3,"export"),onCancel=prop($$props,"onCancel",3,()=>{});let file=tag(state(null),"file");let metadata=tag(state(null),"metadata");let loading=tag(state(false),"loading");let error=tag(state(""),"error");let showConfirmation=tag(state(false),"showConfirmation");async function confirmImport(){set(showConfirmation,false);set(loading,true);set(error,"");try{const passwordOrSaltedKey=getMiscStore();const{newData:newData,existingData:existingData}=await EmergencyKitManager.importBulkEmergencyKit(get(file),passwordOrSaltedKey);await updateStorageAndStores(newData,existingData);$$props.onComplete(true,`Emergency kit imported successfully for: ${get(file).name}`);safeLogout()}catch(err){set(error,`Failed to import emergency kit for: ${get(file).name}`);log.error(err);$$props.onComplete(false,`Failed to import emergency kit for: ${get(file).name}`)}finally{set(loading,false)}}async function updateStorageAndStores(newData,existingData){const updateFunctions=[{key:"yakklPreferencesStore",setStorage:setPreferencesStorage,store:yakklPreferencesStore},{key:"yakklSettingsStore",setStorage:setSettingsStorage,store:yakklSettingsStore},{key:"profileStore",setStorage:setProfileStorage,store:profileStore},{key:"yakklCurrentlySelectedStore",setStorage:setYakklCurrentlySelectedStorage,store:yakklCurrentlySelectedStore},{key:"yakklContactsStore",setStorage:setYakklContactsStorage,store:yakklContactsStore},{key:"yakklChatsStore",setStorage:setYakklChatsStorage,store:yakklChatsStore},{key:"yakklAccountsStore",setStorage:setYakklAccountsStorage,store:yakklAccountsStore},{key:"yakklPrimaryAccountsStore",setStorage:setYakklPrimaryAccountsStorage,store:yakklPrimaryAccountsStore},{key:"yakklWatchListStore",setStorage:setYakklWatchListStorage,store:yakklWatchListStore},{key:"yakklBlockedListStore",setStorage:setYakklBlockedListStorage,store:yakklBlockedListStore},{key:"yakklConnectedDomainsStore",setStorage:setYakklConnectedDomainsStorage,store:yakklConnectedDomainsStore},{key:"yakklTokenDataStore",setStorage:setYakklTokenDataStorage,store:yakklTokenDataStore},{key:"yakklTokenDataCustomStore",setStorage:setYakklTokenDataCustomStorage,store:yakklTokenDataCustomStore},{key:"yakklCombinedTokenStore",setStorage:setYakklCombinedTokenStorage,store:yakklCombinedTokenStore},{key:"yakklWalletProvidersStore",setStorage:setYakklWalletProvidersStorage,store:yakklWalletProvidersStore},{key:"yakklWalletBlockchainsStore",setStorage:setYakklWalletBlockchainsStorage,store:yakklWalletBlockchainsStore}];if(strict_equals(typeof VERSION,"undefined")||strict_equals(typeof VERSION,"string",false)||strict_equals(VERSION.trim(),"")){log.error("VERSION is not properly defined.");return}for(const{key:key,setStorage:setStorage,store:store}of updateFunctions){const data=newData[key]||existingData[key];if(data){if(data&&strict_equals(typeof data,"object")&&!Array.isArray(data)){if("version"in data||"VERSION"in data){data["version"]=VERSION;log.info(`Updated version for ${key} to ${VERSION}`)}}else if(data&&strict_equals(typeof data,"object")&&Array.isArray(data)){log.warn(`${key} contains array data - version not updated`)}else{log.error(`Invalid data object for ${key}. Cannot assign version.`);continue}try{await setStorage(data);store.set(data)}catch(error2){log.error(`Failed to update ${key}:`,false,error2)}}}}var fragment=root();var div=first_child(fragment);var h2=child(div);var text=child(h2);reset(h2);var node=sibling(h2,2);{var consequent=$$anchor2=>{var button=root_1();button.__click=[handleExport,loading,error,$$props];var text_1=child(button,true);reset(button);template_effect(()=>{button.disabled=get(loading);set_text(text_1,get(loading)?"Exporting...":"Export Emergency Kit")});append($$anchor2,button)};var alternate=$$anchor2=>{var fragment_1=root_2();var div_1=first_child(fragment_1);var input=sibling(child(div_1),2);input.__change=[handleFileSelect,file,metadata,error];reset(div_1);var node_1=sibling(div_1,2);{var consequent_1=$$anchor3=>{var fragment_2=root_3();var div_2=first_child(fragment_2);var p=sibling(child(div_2),2);var text_2=child(p);reset(p);var p_1=sibling(p,2);var text_3=child(p_1);reset(p_1);var p_2=sibling(p_1,2);var text_4=child(p_2);reset(p_2);var p_3=sibling(p_2,2);var text_5=child(p_3);reset(p_3);var p_4=sibling(p_3,2);var text_6=child(p_4);reset(p_4);reset(div_2);next(2);template_effect($0=>{set_text(text_2,`ID: ${get(metadata).id??""}`);set_text(text_3,`Created: ${$0??""}`);set_text(text_4,`Version: ${get(metadata).version??""}`);set_text(text_5,`Type: ${get(metadata).type??""}`);set_text(text_6,`Files: ${get(metadata).files??""}`)},[()=>new Date(get(metadata).createDate).toLocaleString()]);append($$anchor3,fragment_2)};if_block(node_1,$$render=>{if(get(metadata))$$render(consequent_1)})}var button_1=sibling(node_1,2);button_1.__click=[handleImport,file,error,showConfirmation];var text_7=child(button_1,true);reset(button_1);var button_2=sibling(button_1,2);button_2.__click=function(...$$args){apply(onCancel,this,$$args,EmergencyKit,[299,19])};template_effect(()=>{button_1.disabled=get(loading)||!get(file);set_text(text_7,get(loading)?"Importing...":"Import")});append($$anchor2,fragment_1)};if_block(node,$$render=>{if(strict_equals(mode(),"export"))$$render(consequent);else $$render(alternate,false)})}var node_2=sibling(node,2);{var consequent_2=$$anchor2=>{var p_5=root_4();var text_8=child(p_5,true);reset(p_5);template_effect(()=>set_text(text_8,get(error)));append($$anchor2,p_5)};if_block(node_2,$$render=>{if(get(error))$$render(consequent_2)})}reset(div);var node_3=sibling(div,2);Confirmation(node_3,{title:"Confirm Import",message:"Are you sure you want to continue? Doing so will override your current Smart Wallet data!",confirmText:"Yes, Import",rejectText:"Cancel",onConfirm:confirmImport,get show(){return get(showConfirmation)},set show($$value){set(showConfirmation,$$value,true)}});template_effect(()=>set_text(text,`${strict_equals(mode(),"export")?"Export":"Import"} Emergency Kit`));append($$anchor,fragment);return pop({...legacy_api()})}delegate(["click","change"]);EmergencyKitModal[FILENAME]="src/lib/components/EmergencyKitModal.svelte";function EmergencyKitModal($$anchor,$$props){check_target(new.target);push($$props,true,EmergencyKitModal);var $$ownership_validator=create_ownership_validator($$props);let show=prop($$props,"show",15,false),mode=prop($$props,"mode",3,"import"),onComplete=prop($$props,"onComplete",3,handleEmergencyKitComplete),onCancel=prop($$props,"onCancel",11,()=>{show(false)}),onClose=prop($$props,"onClose",11,()=>{show(false)});function handleEmergencyKitComplete(success,message){var _a;show(false);(_a=onComplete())==null?void 0:_a(success,message)}{$$ownership_validator.binding("show",Modal,show);Modal($$anchor,{onCancel:onCancel(),onClose:onClose(),title:"Emergency Kit",get show(){return show()},set show($$value){show($$value)},children:wrap_snippet(EmergencyKitModal,($$anchor2,$$slotProps)=>{EmergencyKit($$anchor2,{get mode(){return mode()},get onComplete(){return onComplete()},onCancel:onCancel()})}),$$slots:{default:true}})}return pop({...legacy_api()})}export{EmergencyKitModal as E};
//# sourceMappingURL=CubszWZ-.js.map
