{"version":3,"file":"sandbox.js","mappings":"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","sources":["webpack://yakkl-wallet/../../node_modules/.pnpm/dexie@4.0.11/node_modules/dexie/dist/dexie.js","webpack://yakkl-wallet/../../node_modules/.pnpm/dexie@4.0.11/node_modules/dexie/import-wrapper.mjs","webpack://yakkl-wallet/../../node_modules/.pnpm/idb@8.0.3/node_modules/idb/build/index.js","webpack://yakkl-wallet/./src/lib/managers/Errors.ts","webpack://yakkl-wallet/./src/lib/managers/Logger.ts","webpack://yakkl-wallet/webpack/bootstrap","webpack://yakkl-wallet/webpack/runtime/define property getters","webpack://yakkl-wallet/webpack/runtime/global","webpack://yakkl-wallet/webpack/runtime/hasOwnProperty shorthand","webpack://yakkl-wallet/webpack/runtime/make namespace object","webpack://yakkl-wallet/./src/lib/extensions/chrome/sandbox.ts"],"sourcesContent":["/*\n * Dexie.js - a minimalistic wrapper for IndexedDB\n * ===============================================\n *\n * By David Fahlander, david.fahlander@gmail.com\n *\n * Version 4.0.11, Wed Jan 15 2025\n *\n * https://dexie.org\n *\n * Apache License Version 2.0, January 2004, http://www.apache.org/licenses/\n */\n \n(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define(factory) :\n    (global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.Dexie = factory());\n})(this, (function () { 'use strict';\n\n    /*! *****************************************************************************\n    Copyright (c) Microsoft Corporation.\n    Permission to use, copy, modify, and/or distribute this software for any\n    purpose with or without fee is hereby granted.\n    THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\n    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\n    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\n    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\n    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\n    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\n    PERFORMANCE OF THIS SOFTWARE.\n    ***************************************************************************** */\n    var extendStatics = function(d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    function __extends(d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    }\n    var __assign = function() {\n        __assign = Object.assign || function __assign(t) {\n            for (var s, i = 1, n = arguments.length; i < n; i++) {\n                s = arguments[i];\n                for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n            }\n            return t;\n        };\n        return __assign.apply(this, arguments);\n    };\n    function __spreadArray(to, from, pack) {\n        if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n            if (ar || !(i in from)) {\n                if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n                ar[i] = from[i];\n            }\n        }\n        return to.concat(ar || Array.prototype.slice.call(from));\n    }\n\n    var _global = typeof globalThis !== 'undefined' ? globalThis :\n        typeof self !== 'undefined' ? self :\n            typeof window !== 'undefined' ? window :\n                global;\n\n    var keys = Object.keys;\n    var isArray = Array.isArray;\n    if (typeof Promise !== 'undefined' && !_global.Promise) {\n        _global.Promise = Promise;\n    }\n    function extend(obj, extension) {\n        if (typeof extension !== 'object')\n            return obj;\n        keys(extension).forEach(function (key) {\n            obj[key] = extension[key];\n        });\n        return obj;\n    }\n    var getProto = Object.getPrototypeOf;\n    var _hasOwn = {}.hasOwnProperty;\n    function hasOwn(obj, prop) {\n        return _hasOwn.call(obj, prop);\n    }\n    function props(proto, extension) {\n        if (typeof extension === 'function')\n            extension = extension(getProto(proto));\n        (typeof Reflect === \"undefined\" ? keys : Reflect.ownKeys)(extension).forEach(function (key) {\n            setProp(proto, key, extension[key]);\n        });\n    }\n    var defineProperty = Object.defineProperty;\n    function setProp(obj, prop, functionOrGetSet, options) {\n        defineProperty(obj, prop, extend(functionOrGetSet && hasOwn(functionOrGetSet, \"get\") && typeof functionOrGetSet.get === 'function' ?\n            { get: functionOrGetSet.get, set: functionOrGetSet.set, configurable: true } :\n            { value: functionOrGetSet, configurable: true, writable: true }, options));\n    }\n    function derive(Child) {\n        return {\n            from: function (Parent) {\n                Child.prototype = Object.create(Parent.prototype);\n                setProp(Child.prototype, \"constructor\", Child);\n                return {\n                    extend: props.bind(null, Child.prototype)\n                };\n            }\n        };\n    }\n    var getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n    function getPropertyDescriptor(obj, prop) {\n        var pd = getOwnPropertyDescriptor(obj, prop);\n        var proto;\n        return pd || (proto = getProto(obj)) && getPropertyDescriptor(proto, prop);\n    }\n    var _slice = [].slice;\n    function slice(args, start, end) {\n        return _slice.call(args, start, end);\n    }\n    function override(origFunc, overridedFactory) {\n        return overridedFactory(origFunc);\n    }\n    function assert(b) {\n        if (!b)\n            throw new Error(\"Assertion Failed\");\n    }\n    function asap$1(fn) {\n        if (_global.setImmediate)\n            setImmediate(fn);\n        else\n            setTimeout(fn, 0);\n    }\n    function arrayToObject(array, extractor) {\n        return array.reduce(function (result, item, i) {\n            var nameAndValue = extractor(item, i);\n            if (nameAndValue)\n                result[nameAndValue[0]] = nameAndValue[1];\n            return result;\n        }, {});\n    }\n    function getByKeyPath(obj, keyPath) {\n        if (typeof keyPath === 'string' && hasOwn(obj, keyPath))\n            return obj[keyPath];\n        if (!keyPath)\n            return obj;\n        if (typeof keyPath !== 'string') {\n            var rv = [];\n            for (var i = 0, l = keyPath.length; i < l; ++i) {\n                var val = getByKeyPath(obj, keyPath[i]);\n                rv.push(val);\n            }\n            return rv;\n        }\n        var period = keyPath.indexOf('.');\n        if (period !== -1) {\n            var innerObj = obj[keyPath.substr(0, period)];\n            return innerObj == null ? undefined : getByKeyPath(innerObj, keyPath.substr(period + 1));\n        }\n        return undefined;\n    }\n    function setByKeyPath(obj, keyPath, value) {\n        if (!obj || keyPath === undefined)\n            return;\n        if ('isFrozen' in Object && Object.isFrozen(obj))\n            return;\n        if (typeof keyPath !== 'string' && 'length' in keyPath) {\n            assert(typeof value !== 'string' && 'length' in value);\n            for (var i = 0, l = keyPath.length; i < l; ++i) {\n                setByKeyPath(obj, keyPath[i], value[i]);\n            }\n        }\n        else {\n            var period = keyPath.indexOf('.');\n            if (period !== -1) {\n                var currentKeyPath = keyPath.substr(0, period);\n                var remainingKeyPath = keyPath.substr(period + 1);\n                if (remainingKeyPath === \"\")\n                    if (value === undefined) {\n                        if (isArray(obj) && !isNaN(parseInt(currentKeyPath)))\n                            obj.splice(currentKeyPath, 1);\n                        else\n                            delete obj[currentKeyPath];\n                    }\n                    else\n                        obj[currentKeyPath] = value;\n                else {\n                    var innerObj = obj[currentKeyPath];\n                    if (!innerObj || !hasOwn(obj, currentKeyPath))\n                        innerObj = (obj[currentKeyPath] = {});\n                    setByKeyPath(innerObj, remainingKeyPath, value);\n                }\n            }\n            else {\n                if (value === undefined) {\n                    if (isArray(obj) && !isNaN(parseInt(keyPath)))\n                        obj.splice(keyPath, 1);\n                    else\n                        delete obj[keyPath];\n                }\n                else\n                    obj[keyPath] = value;\n            }\n        }\n    }\n    function delByKeyPath(obj, keyPath) {\n        if (typeof keyPath === 'string')\n            setByKeyPath(obj, keyPath, undefined);\n        else if ('length' in keyPath)\n            [].map.call(keyPath, function (kp) {\n                setByKeyPath(obj, kp, undefined);\n            });\n    }\n    function shallowClone(obj) {\n        var rv = {};\n        for (var m in obj) {\n            if (hasOwn(obj, m))\n                rv[m] = obj[m];\n        }\n        return rv;\n    }\n    var concat = [].concat;\n    function flatten(a) {\n        return concat.apply([], a);\n    }\n    var intrinsicTypeNames = \"BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey\"\n        .split(',').concat(flatten([8, 16, 32, 64].map(function (num) { return [\"Int\", \"Uint\", \"Float\"].map(function (t) { return t + num + \"Array\"; }); }))).filter(function (t) { return _global[t]; });\n    var intrinsicTypes = new Set(intrinsicTypeNames.map(function (t) { return _global[t]; }));\n    function cloneSimpleObjectTree(o) {\n        var rv = {};\n        for (var k in o)\n            if (hasOwn(o, k)) {\n                var v = o[k];\n                rv[k] = !v || typeof v !== 'object' || intrinsicTypes.has(v.constructor) ? v : cloneSimpleObjectTree(v);\n            }\n        return rv;\n    }\n    function objectIsEmpty(o) {\n        for (var k in o)\n            if (hasOwn(o, k))\n                return false;\n        return true;\n    }\n    var circularRefs = null;\n    function deepClone(any) {\n        circularRefs = new WeakMap();\n        var rv = innerDeepClone(any);\n        circularRefs = null;\n        return rv;\n    }\n    function innerDeepClone(x) {\n        if (!x || typeof x !== 'object')\n            return x;\n        var rv = circularRefs.get(x);\n        if (rv)\n            return rv;\n        if (isArray(x)) {\n            rv = [];\n            circularRefs.set(x, rv);\n            for (var i = 0, l = x.length; i < l; ++i) {\n                rv.push(innerDeepClone(x[i]));\n            }\n        }\n        else if (intrinsicTypes.has(x.constructor)) {\n            rv = x;\n        }\n        else {\n            var proto = getProto(x);\n            rv = proto === Object.prototype ? {} : Object.create(proto);\n            circularRefs.set(x, rv);\n            for (var prop in x) {\n                if (hasOwn(x, prop)) {\n                    rv[prop] = innerDeepClone(x[prop]);\n                }\n            }\n        }\n        return rv;\n    }\n    var toString = {}.toString;\n    function toStringTag(o) {\n        return toString.call(o).slice(8, -1);\n    }\n    var iteratorSymbol = typeof Symbol !== 'undefined' ?\n        Symbol.iterator :\n        '@@iterator';\n    var getIteratorOf = typeof iteratorSymbol === \"symbol\" ? function (x) {\n        var i;\n        return x != null && (i = x[iteratorSymbol]) && i.apply(x);\n    } : function () { return null; };\n    function delArrayItem(a, x) {\n        var i = a.indexOf(x);\n        if (i >= 0)\n            a.splice(i, 1);\n        return i >= 0;\n    }\n    var NO_CHAR_ARRAY = {};\n    function getArrayOf(arrayLike) {\n        var i, a, x, it;\n        if (arguments.length === 1) {\n            if (isArray(arrayLike))\n                return arrayLike.slice();\n            if (this === NO_CHAR_ARRAY && typeof arrayLike === 'string')\n                return [arrayLike];\n            if ((it = getIteratorOf(arrayLike))) {\n                a = [];\n                while ((x = it.next()), !x.done)\n                    a.push(x.value);\n                return a;\n            }\n            if (arrayLike == null)\n                return [arrayLike];\n            i = arrayLike.length;\n            if (typeof i === 'number') {\n                a = new Array(i);\n                while (i--)\n                    a[i] = arrayLike[i];\n                return a;\n            }\n            return [arrayLike];\n        }\n        i = arguments.length;\n        a = new Array(i);\n        while (i--)\n            a[i] = arguments[i];\n        return a;\n    }\n    var isAsyncFunction = typeof Symbol !== 'undefined'\n        ? function (fn) { return fn[Symbol.toStringTag] === 'AsyncFunction'; }\n        : function () { return false; };\n\n    var dexieErrorNames = [\n        'Modify',\n        'Bulk',\n        'OpenFailed',\n        'VersionChange',\n        'Schema',\n        'Upgrade',\n        'InvalidTable',\n        'MissingAPI',\n        'NoSuchDatabase',\n        'InvalidArgument',\n        'SubTransaction',\n        'Unsupported',\n        'Internal',\n        'DatabaseClosed',\n        'PrematureCommit',\n        'ForeignAwait'\n    ];\n    var idbDomErrorNames = [\n        'Unknown',\n        'Constraint',\n        'Data',\n        'TransactionInactive',\n        'ReadOnly',\n        'Version',\n        'NotFound',\n        'InvalidState',\n        'InvalidAccess',\n        'Abort',\n        'Timeout',\n        'QuotaExceeded',\n        'Syntax',\n        'DataClone'\n    ];\n    var errorList = dexieErrorNames.concat(idbDomErrorNames);\n    var defaultTexts = {\n        VersionChanged: \"Database version changed by other database connection\",\n        DatabaseClosed: \"Database has been closed\",\n        Abort: \"Transaction aborted\",\n        TransactionInactive: \"Transaction has already completed or failed\",\n        MissingAPI: \"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb\"\n    };\n    function DexieError(name, msg) {\n        this.name = name;\n        this.message = msg;\n    }\n    derive(DexieError).from(Error).extend({\n        toString: function () { return this.name + \": \" + this.message; }\n    });\n    function getMultiErrorMessage(msg, failures) {\n        return msg + \". Errors: \" + Object.keys(failures)\n            .map(function (key) { return failures[key].toString(); })\n            .filter(function (v, i, s) { return s.indexOf(v) === i; })\n            .join('\\n');\n    }\n    function ModifyError(msg, failures, successCount, failedKeys) {\n        this.failures = failures;\n        this.failedKeys = failedKeys;\n        this.successCount = successCount;\n        this.message = getMultiErrorMessage(msg, failures);\n    }\n    derive(ModifyError).from(DexieError);\n    function BulkError(msg, failures) {\n        this.name = \"BulkError\";\n        this.failures = Object.keys(failures).map(function (pos) { return failures[pos]; });\n        this.failuresByPos = failures;\n        this.message = getMultiErrorMessage(msg, this.failures);\n    }\n    derive(BulkError).from(DexieError);\n    var errnames = errorList.reduce(function (obj, name) { return (obj[name] = name + \"Error\", obj); }, {});\n    var BaseException = DexieError;\n    var exceptions = errorList.reduce(function (obj, name) {\n        var fullName = name + \"Error\";\n        function DexieError(msgOrInner, inner) {\n            this.name = fullName;\n            if (!msgOrInner) {\n                this.message = defaultTexts[name] || fullName;\n                this.inner = null;\n            }\n            else if (typeof msgOrInner === 'string') {\n                this.message = \"\".concat(msgOrInner).concat(!inner ? '' : '\\n ' + inner);\n                this.inner = inner || null;\n            }\n            else if (typeof msgOrInner === 'object') {\n                this.message = \"\".concat(msgOrInner.name, \" \").concat(msgOrInner.message);\n                this.inner = msgOrInner;\n            }\n        }\n        derive(DexieError).from(BaseException);\n        obj[name] = DexieError;\n        return obj;\n    }, {});\n    exceptions.Syntax = SyntaxError;\n    exceptions.Type = TypeError;\n    exceptions.Range = RangeError;\n    var exceptionMap = idbDomErrorNames.reduce(function (obj, name) {\n        obj[name + \"Error\"] = exceptions[name];\n        return obj;\n    }, {});\n    function mapError(domError, message) {\n        if (!domError || domError instanceof DexieError || domError instanceof TypeError || domError instanceof SyntaxError || !domError.name || !exceptionMap[domError.name])\n            return domError;\n        var rv = new exceptionMap[domError.name](message || domError.message, domError);\n        if (\"stack\" in domError) {\n            setProp(rv, \"stack\", { get: function () {\n                    return this.inner.stack;\n                } });\n        }\n        return rv;\n    }\n    var fullNameExceptions = errorList.reduce(function (obj, name) {\n        if ([\"Syntax\", \"Type\", \"Range\"].indexOf(name) === -1)\n            obj[name + \"Error\"] = exceptions[name];\n        return obj;\n    }, {});\n    fullNameExceptions.ModifyError = ModifyError;\n    fullNameExceptions.DexieError = DexieError;\n    fullNameExceptions.BulkError = BulkError;\n\n    function nop() { }\n    function mirror(val) { return val; }\n    function pureFunctionChain(f1, f2) {\n        if (f1 == null || f1 === mirror)\n            return f2;\n        return function (val) {\n            return f2(f1(val));\n        };\n    }\n    function callBoth(on1, on2) {\n        return function () {\n            on1.apply(this, arguments);\n            on2.apply(this, arguments);\n        };\n    }\n    function hookCreatingChain(f1, f2) {\n        if (f1 === nop)\n            return f2;\n        return function () {\n            var res = f1.apply(this, arguments);\n            if (res !== undefined)\n                arguments[0] = res;\n            var onsuccess = this.onsuccess,\n            onerror = this.onerror;\n            this.onsuccess = null;\n            this.onerror = null;\n            var res2 = f2.apply(this, arguments);\n            if (onsuccess)\n                this.onsuccess = this.onsuccess ? callBoth(onsuccess, this.onsuccess) : onsuccess;\n            if (onerror)\n                this.onerror = this.onerror ? callBoth(onerror, this.onerror) : onerror;\n            return res2 !== undefined ? res2 : res;\n        };\n    }\n    function hookDeletingChain(f1, f2) {\n        if (f1 === nop)\n            return f2;\n        return function () {\n            f1.apply(this, arguments);\n            var onsuccess = this.onsuccess,\n            onerror = this.onerror;\n            this.onsuccess = this.onerror = null;\n            f2.apply(this, arguments);\n            if (onsuccess)\n                this.onsuccess = this.onsuccess ? callBoth(onsuccess, this.onsuccess) : onsuccess;\n            if (onerror)\n                this.onerror = this.onerror ? callBoth(onerror, this.onerror) : onerror;\n        };\n    }\n    function hookUpdatingChain(f1, f2) {\n        if (f1 === nop)\n            return f2;\n        return function (modifications) {\n            var res = f1.apply(this, arguments);\n            extend(modifications, res);\n            var onsuccess = this.onsuccess,\n            onerror = this.onerror;\n            this.onsuccess = null;\n            this.onerror = null;\n            var res2 = f2.apply(this, arguments);\n            if (onsuccess)\n                this.onsuccess = this.onsuccess ? callBoth(onsuccess, this.onsuccess) : onsuccess;\n            if (onerror)\n                this.onerror = this.onerror ? callBoth(onerror, this.onerror) : onerror;\n            return res === undefined ?\n                (res2 === undefined ? undefined : res2) :\n                (extend(res, res2));\n        };\n    }\n    function reverseStoppableEventChain(f1, f2) {\n        if (f1 === nop)\n            return f2;\n        return function () {\n            if (f2.apply(this, arguments) === false)\n                return false;\n            return f1.apply(this, arguments);\n        };\n    }\n    function promisableChain(f1, f2) {\n        if (f1 === nop)\n            return f2;\n        return function () {\n            var res = f1.apply(this, arguments);\n            if (res && typeof res.then === 'function') {\n                var thiz = this, i = arguments.length, args = new Array(i);\n                while (i--)\n                    args[i] = arguments[i];\n                return res.then(function () {\n                    return f2.apply(thiz, args);\n                });\n            }\n            return f2.apply(this, arguments);\n        };\n    }\n\n    var debug = typeof location !== 'undefined' &&\n        /^(http|https):\\/\\/(localhost|127\\.0\\.0\\.1)/.test(location.href);\n    function setDebug(value, filter) {\n        debug = value;\n    }\n\n    var INTERNAL = {};\n    var ZONE_ECHO_LIMIT = 100, _a$1 = typeof Promise === 'undefined' ?\n        [] :\n        (function () {\n            var globalP = Promise.resolve();\n            if (typeof crypto === 'undefined' || !crypto.subtle)\n                return [globalP, getProto(globalP), globalP];\n            var nativeP = crypto.subtle.digest(\"SHA-512\", new Uint8Array([0]));\n            return [\n                nativeP,\n                getProto(nativeP),\n                globalP\n            ];\n        })(), resolvedNativePromise = _a$1[0], nativePromiseProto = _a$1[1], resolvedGlobalPromise = _a$1[2], nativePromiseThen = nativePromiseProto && nativePromiseProto.then;\n    var NativePromise = resolvedNativePromise && resolvedNativePromise.constructor;\n    var patchGlobalPromise = !!resolvedGlobalPromise;\n    function schedulePhysicalTick() {\n        queueMicrotask(physicalTick);\n    }\n    var asap = function (callback, args) {\n        microtickQueue.push([callback, args]);\n        if (needsNewPhysicalTick) {\n            schedulePhysicalTick();\n            needsNewPhysicalTick = false;\n        }\n    };\n    var isOutsideMicroTick = true,\n    needsNewPhysicalTick = true,\n    unhandledErrors = [],\n    rejectingErrors = [],\n    rejectionMapper = mirror;\n    var globalPSD = {\n        id: 'global',\n        global: true,\n        ref: 0,\n        unhandleds: [],\n        onunhandled: nop,\n        pgp: false,\n        env: {},\n        finalize: nop\n    };\n    var PSD = globalPSD;\n    var microtickQueue = [];\n    var numScheduledCalls = 0;\n    var tickFinalizers = [];\n    function DexiePromise(fn) {\n        if (typeof this !== 'object')\n            throw new TypeError('Promises must be constructed via new');\n        this._listeners = [];\n        this._lib = false;\n        var psd = (this._PSD = PSD);\n        if (typeof fn !== 'function') {\n            if (fn !== INTERNAL)\n                throw new TypeError('Not a function');\n            this._state = arguments[1];\n            this._value = arguments[2];\n            if (this._state === false)\n                handleRejection(this, this._value);\n            return;\n        }\n        this._state = null;\n        this._value = null;\n        ++psd.ref;\n        executePromiseTask(this, fn);\n    }\n    var thenProp = {\n        get: function () {\n            var psd = PSD, microTaskId = totalEchoes;\n            function then(onFulfilled, onRejected) {\n                var _this = this;\n                var possibleAwait = !psd.global && (psd !== PSD || microTaskId !== totalEchoes);\n                var cleanup = possibleAwait && !decrementExpectedAwaits();\n                var rv = new DexiePromise(function (resolve, reject) {\n                    propagateToListener(_this, new Listener(nativeAwaitCompatibleWrap(onFulfilled, psd, possibleAwait, cleanup), nativeAwaitCompatibleWrap(onRejected, psd, possibleAwait, cleanup), resolve, reject, psd));\n                });\n                if (this._consoleTask)\n                    rv._consoleTask = this._consoleTask;\n                return rv;\n            }\n            then.prototype = INTERNAL;\n            return then;\n        },\n        set: function (value) {\n            setProp(this, 'then', value && value.prototype === INTERNAL ?\n                thenProp :\n                {\n                    get: function () {\n                        return value;\n                    },\n                    set: thenProp.set\n                });\n        }\n    };\n    props(DexiePromise.prototype, {\n        then: thenProp,\n        _then: function (onFulfilled, onRejected) {\n            propagateToListener(this, new Listener(null, null, onFulfilled, onRejected, PSD));\n        },\n        catch: function (onRejected) {\n            if (arguments.length === 1)\n                return this.then(null, onRejected);\n            var type = arguments[0], handler = arguments[1];\n            return typeof type === 'function' ? this.then(null, function (err) {\n                return err instanceof type ? handler(err) : PromiseReject(err);\n            })\n                : this.then(null, function (err) {\n                    return err && err.name === type ? handler(err) : PromiseReject(err);\n                });\n        },\n        finally: function (onFinally) {\n            return this.then(function (value) {\n                return DexiePromise.resolve(onFinally()).then(function () { return value; });\n            }, function (err) {\n                return DexiePromise.resolve(onFinally()).then(function () { return PromiseReject(err); });\n            });\n        },\n        timeout: function (ms, msg) {\n            var _this = this;\n            return ms < Infinity ?\n                new DexiePromise(function (resolve, reject) {\n                    var handle = setTimeout(function () { return reject(new exceptions.Timeout(msg)); }, ms);\n                    _this.then(resolve, reject).finally(clearTimeout.bind(null, handle));\n                }) : this;\n        }\n    });\n    if (typeof Symbol !== 'undefined' && Symbol.toStringTag)\n        setProp(DexiePromise.prototype, Symbol.toStringTag, 'Dexie.Promise');\n    globalPSD.env = snapShot();\n    function Listener(onFulfilled, onRejected, resolve, reject, zone) {\n        this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n        this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n        this.resolve = resolve;\n        this.reject = reject;\n        this.psd = zone;\n    }\n    props(DexiePromise, {\n        all: function () {\n            var values = getArrayOf.apply(null, arguments)\n                .map(onPossibleParallellAsync);\n            return new DexiePromise(function (resolve, reject) {\n                if (values.length === 0)\n                    resolve([]);\n                var remaining = values.length;\n                values.forEach(function (a, i) { return DexiePromise.resolve(a).then(function (x) {\n                    values[i] = x;\n                    if (!--remaining)\n                        resolve(values);\n                }, reject); });\n            });\n        },\n        resolve: function (value) {\n            if (value instanceof DexiePromise)\n                return value;\n            if (value && typeof value.then === 'function')\n                return new DexiePromise(function (resolve, reject) {\n                    value.then(resolve, reject);\n                });\n            var rv = new DexiePromise(INTERNAL, true, value);\n            return rv;\n        },\n        reject: PromiseReject,\n        race: function () {\n            var values = getArrayOf.apply(null, arguments).map(onPossibleParallellAsync);\n            return new DexiePromise(function (resolve, reject) {\n                values.map(function (value) { return DexiePromise.resolve(value).then(resolve, reject); });\n            });\n        },\n        PSD: {\n            get: function () { return PSD; },\n            set: function (value) { return PSD = value; }\n        },\n        totalEchoes: { get: function () { return totalEchoes; } },\n        newPSD: newScope,\n        usePSD: usePSD,\n        scheduler: {\n            get: function () { return asap; },\n            set: function (value) { asap = value; }\n        },\n        rejectionMapper: {\n            get: function () { return rejectionMapper; },\n            set: function (value) { rejectionMapper = value; }\n        },\n        follow: function (fn, zoneProps) {\n            return new DexiePromise(function (resolve, reject) {\n                return newScope(function (resolve, reject) {\n                    var psd = PSD;\n                    psd.unhandleds = [];\n                    psd.onunhandled = reject;\n                    psd.finalize = callBoth(function () {\n                        var _this = this;\n                        run_at_end_of_this_or_next_physical_tick(function () {\n                            _this.unhandleds.length === 0 ? resolve() : reject(_this.unhandleds[0]);\n                        });\n                    }, psd.finalize);\n                    fn();\n                }, zoneProps, resolve, reject);\n            });\n        }\n    });\n    if (NativePromise) {\n        if (NativePromise.allSettled)\n            setProp(DexiePromise, \"allSettled\", function () {\n                var possiblePromises = getArrayOf.apply(null, arguments).map(onPossibleParallellAsync);\n                return new DexiePromise(function (resolve) {\n                    if (possiblePromises.length === 0)\n                        resolve([]);\n                    var remaining = possiblePromises.length;\n                    var results = new Array(remaining);\n                    possiblePromises.forEach(function (p, i) { return DexiePromise.resolve(p).then(function (value) { return results[i] = { status: \"fulfilled\", value: value }; }, function (reason) { return results[i] = { status: \"rejected\", reason: reason }; })\n                        .then(function () { return --remaining || resolve(results); }); });\n                });\n            });\n        if (NativePromise.any && typeof AggregateError !== 'undefined')\n            setProp(DexiePromise, \"any\", function () {\n                var possiblePromises = getArrayOf.apply(null, arguments).map(onPossibleParallellAsync);\n                return new DexiePromise(function (resolve, reject) {\n                    if (possiblePromises.length === 0)\n                        reject(new AggregateError([]));\n                    var remaining = possiblePromises.length;\n                    var failures = new Array(remaining);\n                    possiblePromises.forEach(function (p, i) { return DexiePromise.resolve(p).then(function (value) { return resolve(value); }, function (failure) {\n                        failures[i] = failure;\n                        if (!--remaining)\n                            reject(new AggregateError(failures));\n                    }); });\n                });\n            });\n        if (NativePromise.withResolvers)\n            DexiePromise.withResolvers = NativePromise.withResolvers;\n    }\n    function executePromiseTask(promise, fn) {\n        try {\n            fn(function (value) {\n                if (promise._state !== null)\n                    return;\n                if (value === promise)\n                    throw new TypeError('A promise cannot be resolved with itself.');\n                var shouldExecuteTick = promise._lib && beginMicroTickScope();\n                if (value && typeof value.then === 'function') {\n                    executePromiseTask(promise, function (resolve, reject) {\n                        value instanceof DexiePromise ?\n                            value._then(resolve, reject) :\n                            value.then(resolve, reject);\n                    });\n                }\n                else {\n                    promise._state = true;\n                    promise._value = value;\n                    propagateAllListeners(promise);\n                }\n                if (shouldExecuteTick)\n                    endMicroTickScope();\n            }, handleRejection.bind(null, promise));\n        }\n        catch (ex) {\n            handleRejection(promise, ex);\n        }\n    }\n    function handleRejection(promise, reason) {\n        rejectingErrors.push(reason);\n        if (promise._state !== null)\n            return;\n        var shouldExecuteTick = promise._lib && beginMicroTickScope();\n        reason = rejectionMapper(reason);\n        promise._state = false;\n        promise._value = reason;\n        addPossiblyUnhandledError(promise);\n        propagateAllListeners(promise);\n        if (shouldExecuteTick)\n            endMicroTickScope();\n    }\n    function propagateAllListeners(promise) {\n        var listeners = promise._listeners;\n        promise._listeners = [];\n        for (var i = 0, len = listeners.length; i < len; ++i) {\n            propagateToListener(promise, listeners[i]);\n        }\n        var psd = promise._PSD;\n        --psd.ref || psd.finalize();\n        if (numScheduledCalls === 0) {\n            ++numScheduledCalls;\n            asap(function () {\n                if (--numScheduledCalls === 0)\n                    finalizePhysicalTick();\n            }, []);\n        }\n    }\n    function propagateToListener(promise, listener) {\n        if (promise._state === null) {\n            promise._listeners.push(listener);\n            return;\n        }\n        var cb = promise._state ? listener.onFulfilled : listener.onRejected;\n        if (cb === null) {\n            return (promise._state ? listener.resolve : listener.reject)(promise._value);\n        }\n        ++listener.psd.ref;\n        ++numScheduledCalls;\n        asap(callListener, [cb, promise, listener]);\n    }\n    function callListener(cb, promise, listener) {\n        try {\n            var ret, value = promise._value;\n            if (!promise._state && rejectingErrors.length)\n                rejectingErrors = [];\n            ret = debug && promise._consoleTask ? promise._consoleTask.run(function () { return cb(value); }) : cb(value);\n            if (!promise._state && rejectingErrors.indexOf(value) === -1) {\n                markErrorAsHandled(promise);\n            }\n            listener.resolve(ret);\n        }\n        catch (e) {\n            listener.reject(e);\n        }\n        finally {\n            if (--numScheduledCalls === 0)\n                finalizePhysicalTick();\n            --listener.psd.ref || listener.psd.finalize();\n        }\n    }\n    function physicalTick() {\n        usePSD(globalPSD, function () {\n            beginMicroTickScope() && endMicroTickScope();\n        });\n    }\n    function beginMicroTickScope() {\n        var wasRootExec = isOutsideMicroTick;\n        isOutsideMicroTick = false;\n        needsNewPhysicalTick = false;\n        return wasRootExec;\n    }\n    function endMicroTickScope() {\n        var callbacks, i, l;\n        do {\n            while (microtickQueue.length > 0) {\n                callbacks = microtickQueue;\n                microtickQueue = [];\n                l = callbacks.length;\n                for (i = 0; i < l; ++i) {\n                    var item = callbacks[i];\n                    item[0].apply(null, item[1]);\n                }\n            }\n        } while (microtickQueue.length > 0);\n        isOutsideMicroTick = true;\n        needsNewPhysicalTick = true;\n    }\n    function finalizePhysicalTick() {\n        var unhandledErrs = unhandledErrors;\n        unhandledErrors = [];\n        unhandledErrs.forEach(function (p) {\n            p._PSD.onunhandled.call(null, p._value, p);\n        });\n        var finalizers = tickFinalizers.slice(0);\n        var i = finalizers.length;\n        while (i)\n            finalizers[--i]();\n    }\n    function run_at_end_of_this_or_next_physical_tick(fn) {\n        function finalizer() {\n            fn();\n            tickFinalizers.splice(tickFinalizers.indexOf(finalizer), 1);\n        }\n        tickFinalizers.push(finalizer);\n        ++numScheduledCalls;\n        asap(function () {\n            if (--numScheduledCalls === 0)\n                finalizePhysicalTick();\n        }, []);\n    }\n    function addPossiblyUnhandledError(promise) {\n        if (!unhandledErrors.some(function (p) { return p._value === promise._value; }))\n            unhandledErrors.push(promise);\n    }\n    function markErrorAsHandled(promise) {\n        var i = unhandledErrors.length;\n        while (i)\n            if (unhandledErrors[--i]._value === promise._value) {\n                unhandledErrors.splice(i, 1);\n                return;\n            }\n    }\n    function PromiseReject(reason) {\n        return new DexiePromise(INTERNAL, false, reason);\n    }\n    function wrap(fn, errorCatcher) {\n        var psd = PSD;\n        return function () {\n            var wasRootExec = beginMicroTickScope(), outerScope = PSD;\n            try {\n                switchToZone(psd, true);\n                return fn.apply(this, arguments);\n            }\n            catch (e) {\n                errorCatcher && errorCatcher(e);\n            }\n            finally {\n                switchToZone(outerScope, false);\n                if (wasRootExec)\n                    endMicroTickScope();\n            }\n        };\n    }\n    var task = { awaits: 0, echoes: 0, id: 0 };\n    var taskCounter = 0;\n    var zoneStack = [];\n    var zoneEchoes = 0;\n    var totalEchoes = 0;\n    var zone_id_counter = 0;\n    function newScope(fn, props, a1, a2) {\n        var parent = PSD, psd = Object.create(parent);\n        psd.parent = parent;\n        psd.ref = 0;\n        psd.global = false;\n        psd.id = ++zone_id_counter;\n        globalPSD.env;\n        psd.env = patchGlobalPromise ? {\n            Promise: DexiePromise,\n            PromiseProp: { value: DexiePromise, configurable: true, writable: true },\n            all: DexiePromise.all,\n            race: DexiePromise.race,\n            allSettled: DexiePromise.allSettled,\n            any: DexiePromise.any,\n            resolve: DexiePromise.resolve,\n            reject: DexiePromise.reject,\n        } : {};\n        if (props)\n            extend(psd, props);\n        ++parent.ref;\n        psd.finalize = function () {\n            --this.parent.ref || this.parent.finalize();\n        };\n        var rv = usePSD(psd, fn, a1, a2);\n        if (psd.ref === 0)\n            psd.finalize();\n        return rv;\n    }\n    function incrementExpectedAwaits() {\n        if (!task.id)\n            task.id = ++taskCounter;\n        ++task.awaits;\n        task.echoes += ZONE_ECHO_LIMIT;\n        return task.id;\n    }\n    function decrementExpectedAwaits() {\n        if (!task.awaits)\n            return false;\n        if (--task.awaits === 0)\n            task.id = 0;\n        task.echoes = task.awaits * ZONE_ECHO_LIMIT;\n        return true;\n    }\n    if (('' + nativePromiseThen).indexOf('[native code]') === -1) {\n        incrementExpectedAwaits = decrementExpectedAwaits = nop;\n    }\n    function onPossibleParallellAsync(possiblePromise) {\n        if (task.echoes && possiblePromise && possiblePromise.constructor === NativePromise) {\n            incrementExpectedAwaits();\n            return possiblePromise.then(function (x) {\n                decrementExpectedAwaits();\n                return x;\n            }, function (e) {\n                decrementExpectedAwaits();\n                return rejection(e);\n            });\n        }\n        return possiblePromise;\n    }\n    function zoneEnterEcho(targetZone) {\n        ++totalEchoes;\n        if (!task.echoes || --task.echoes === 0) {\n            task.echoes = task.awaits = task.id = 0;\n        }\n        zoneStack.push(PSD);\n        switchToZone(targetZone, true);\n    }\n    function zoneLeaveEcho() {\n        var zone = zoneStack[zoneStack.length - 1];\n        zoneStack.pop();\n        switchToZone(zone, false);\n    }\n    function switchToZone(targetZone, bEnteringZone) {\n        var currentZone = PSD;\n        if (bEnteringZone ? task.echoes && (!zoneEchoes++ || targetZone !== PSD) : zoneEchoes && (!--zoneEchoes || targetZone !== PSD)) {\n            queueMicrotask(bEnteringZone ? zoneEnterEcho.bind(null, targetZone) : zoneLeaveEcho);\n        }\n        if (targetZone === PSD)\n            return;\n        PSD = targetZone;\n        if (currentZone === globalPSD)\n            globalPSD.env = snapShot();\n        if (patchGlobalPromise) {\n            var GlobalPromise = globalPSD.env.Promise;\n            var targetEnv = targetZone.env;\n            if (currentZone.global || targetZone.global) {\n                Object.defineProperty(_global, 'Promise', targetEnv.PromiseProp);\n                GlobalPromise.all = targetEnv.all;\n                GlobalPromise.race = targetEnv.race;\n                GlobalPromise.resolve = targetEnv.resolve;\n                GlobalPromise.reject = targetEnv.reject;\n                if (targetEnv.allSettled)\n                    GlobalPromise.allSettled = targetEnv.allSettled;\n                if (targetEnv.any)\n                    GlobalPromise.any = targetEnv.any;\n            }\n        }\n    }\n    function snapShot() {\n        var GlobalPromise = _global.Promise;\n        return patchGlobalPromise ? {\n            Promise: GlobalPromise,\n            PromiseProp: Object.getOwnPropertyDescriptor(_global, \"Promise\"),\n            all: GlobalPromise.all,\n            race: GlobalPromise.race,\n            allSettled: GlobalPromise.allSettled,\n            any: GlobalPromise.any,\n            resolve: GlobalPromise.resolve,\n            reject: GlobalPromise.reject,\n        } : {};\n    }\n    function usePSD(psd, fn, a1, a2, a3) {\n        var outerScope = PSD;\n        try {\n            switchToZone(psd, true);\n            return fn(a1, a2, a3);\n        }\n        finally {\n            switchToZone(outerScope, false);\n        }\n    }\n    function nativeAwaitCompatibleWrap(fn, zone, possibleAwait, cleanup) {\n        return typeof fn !== 'function' ? fn : function () {\n            var outerZone = PSD;\n            if (possibleAwait)\n                incrementExpectedAwaits();\n            switchToZone(zone, true);\n            try {\n                return fn.apply(this, arguments);\n            }\n            finally {\n                switchToZone(outerZone, false);\n                if (cleanup)\n                    queueMicrotask(decrementExpectedAwaits);\n            }\n        };\n    }\n    function execInGlobalContext(cb) {\n        if (Promise === NativePromise && task.echoes === 0) {\n            if (zoneEchoes === 0) {\n                cb();\n            }\n            else {\n                enqueueNativeMicroTask(cb);\n            }\n        }\n        else {\n            setTimeout(cb, 0);\n        }\n    }\n    var rejection = DexiePromise.reject;\n\n    function tempTransaction(db, mode, storeNames, fn) {\n        if (!db.idbdb || (!db._state.openComplete && (!PSD.letThrough && !db._vip))) {\n            if (db._state.openComplete) {\n                return rejection(new exceptions.DatabaseClosed(db._state.dbOpenError));\n            }\n            if (!db._state.isBeingOpened) {\n                if (!db._state.autoOpen)\n                    return rejection(new exceptions.DatabaseClosed());\n                db.open().catch(nop);\n            }\n            return db._state.dbReadyPromise.then(function () { return tempTransaction(db, mode, storeNames, fn); });\n        }\n        else {\n            var trans = db._createTransaction(mode, storeNames, db._dbSchema);\n            try {\n                trans.create();\n                db._state.PR1398_maxLoop = 3;\n            }\n            catch (ex) {\n                if (ex.name === errnames.InvalidState && db.isOpen() && --db._state.PR1398_maxLoop > 0) {\n                    console.warn('Dexie: Need to reopen db');\n                    db.close({ disableAutoOpen: false });\n                    return db.open().then(function () { return tempTransaction(db, mode, storeNames, fn); });\n                }\n                return rejection(ex);\n            }\n            return trans._promise(mode, function (resolve, reject) {\n                return newScope(function () {\n                    PSD.trans = trans;\n                    return fn(resolve, reject, trans);\n                });\n            }).then(function (result) {\n                if (mode === 'readwrite')\n                    try {\n                        trans.idbtrans.commit();\n                    }\n                    catch (_a) { }\n                return mode === 'readonly' ? result : trans._completion.then(function () { return result; });\n            });\n        }\n    }\n\n    var DEXIE_VERSION = '4.0.11';\n    var maxString = String.fromCharCode(65535);\n    var minKey = -Infinity;\n    var INVALID_KEY_ARGUMENT = \"Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.\";\n    var STRING_EXPECTED = \"String expected.\";\n    var connections = [];\n    var DBNAMES_DB = '__dbnames';\n    var READONLY = 'readonly';\n    var READWRITE = 'readwrite';\n\n    function combine(filter1, filter2) {\n        return filter1 ?\n            filter2 ?\n                function () { return filter1.apply(this, arguments) && filter2.apply(this, arguments); } :\n                filter1 :\n            filter2;\n    }\n\n    var AnyRange = {\n        type: 3 ,\n        lower: -Infinity,\n        lowerOpen: false,\n        upper: [[]],\n        upperOpen: false\n    };\n\n    function workaroundForUndefinedPrimKey(keyPath) {\n        return typeof keyPath === \"string\" && !/\\./.test(keyPath)\n            ? function (obj) {\n                if (obj[keyPath] === undefined && (keyPath in obj)) {\n                    obj = deepClone(obj);\n                    delete obj[keyPath];\n                }\n                return obj;\n            }\n            : function (obj) { return obj; };\n    }\n\n    function Entity() {\n        throw exceptions.Type();\n    }\n\n    function cmp(a, b) {\n        try {\n            var ta = type(a);\n            var tb = type(b);\n            if (ta !== tb) {\n                if (ta === 'Array')\n                    return 1;\n                if (tb === 'Array')\n                    return -1;\n                if (ta === 'binary')\n                    return 1;\n                if (tb === 'binary')\n                    return -1;\n                if (ta === 'string')\n                    return 1;\n                if (tb === 'string')\n                    return -1;\n                if (ta === 'Date')\n                    return 1;\n                if (tb !== 'Date')\n                    return NaN;\n                return -1;\n            }\n            switch (ta) {\n                case 'number':\n                case 'Date':\n                case 'string':\n                    return a > b ? 1 : a < b ? -1 : 0;\n                case 'binary': {\n                    return compareUint8Arrays(getUint8Array(a), getUint8Array(b));\n                }\n                case 'Array':\n                    return compareArrays(a, b);\n            }\n        }\n        catch (_a) { }\n        return NaN;\n    }\n    function compareArrays(a, b) {\n        var al = a.length;\n        var bl = b.length;\n        var l = al < bl ? al : bl;\n        for (var i = 0; i < l; ++i) {\n            var res = cmp(a[i], b[i]);\n            if (res !== 0)\n                return res;\n        }\n        return al === bl ? 0 : al < bl ? -1 : 1;\n    }\n    function compareUint8Arrays(a, b) {\n        var al = a.length;\n        var bl = b.length;\n        var l = al < bl ? al : bl;\n        for (var i = 0; i < l; ++i) {\n            if (a[i] !== b[i])\n                return a[i] < b[i] ? -1 : 1;\n        }\n        return al === bl ? 0 : al < bl ? -1 : 1;\n    }\n    function type(x) {\n        var t = typeof x;\n        if (t !== 'object')\n            return t;\n        if (ArrayBuffer.isView(x))\n            return 'binary';\n        var tsTag = toStringTag(x);\n        return tsTag === 'ArrayBuffer' ? 'binary' : tsTag;\n    }\n    function getUint8Array(a) {\n        if (a instanceof Uint8Array)\n            return a;\n        if (ArrayBuffer.isView(a))\n            return new Uint8Array(a.buffer, a.byteOffset, a.byteLength);\n        return new Uint8Array(a);\n    }\n\n    var Table =  (function () {\n        function Table() {\n        }\n        Table.prototype._trans = function (mode, fn, writeLocked) {\n            var trans = this._tx || PSD.trans;\n            var tableName = this.name;\n            var task = debug && typeof console !== 'undefined' && console.createTask && console.createTask(\"Dexie: \".concat(mode === 'readonly' ? 'read' : 'write', \" \").concat(this.name));\n            function checkTableInTransaction(resolve, reject, trans) {\n                if (!trans.schema[tableName])\n                    throw new exceptions.NotFound(\"Table \" + tableName + \" not part of transaction\");\n                return fn(trans.idbtrans, trans);\n            }\n            var wasRootExec = beginMicroTickScope();\n            try {\n                var p = trans && trans.db._novip === this.db._novip ?\n                    trans === PSD.trans ?\n                        trans._promise(mode, checkTableInTransaction, writeLocked) :\n                        newScope(function () { return trans._promise(mode, checkTableInTransaction, writeLocked); }, { trans: trans, transless: PSD.transless || PSD }) :\n                    tempTransaction(this.db, mode, [this.name], checkTableInTransaction);\n                if (task) {\n                    p._consoleTask = task;\n                    p = p.catch(function (err) {\n                        console.trace(err);\n                        return rejection(err);\n                    });\n                }\n                return p;\n            }\n            finally {\n                if (wasRootExec)\n                    endMicroTickScope();\n            }\n        };\n        Table.prototype.get = function (keyOrCrit, cb) {\n            var _this = this;\n            if (keyOrCrit && keyOrCrit.constructor === Object)\n                return this.where(keyOrCrit).first(cb);\n            if (keyOrCrit == null)\n                return rejection(new exceptions.Type(\"Invalid argument to Table.get()\"));\n            return this._trans('readonly', function (trans) {\n                return _this.core.get({ trans: trans, key: keyOrCrit })\n                    .then(function (res) { return _this.hook.reading.fire(res); });\n            }).then(cb);\n        };\n        Table.prototype.where = function (indexOrCrit) {\n            if (typeof indexOrCrit === 'string')\n                return new this.db.WhereClause(this, indexOrCrit);\n            if (isArray(indexOrCrit))\n                return new this.db.WhereClause(this, \"[\".concat(indexOrCrit.join('+'), \"]\"));\n            var keyPaths = keys(indexOrCrit);\n            if (keyPaths.length === 1)\n                return this\n                    .where(keyPaths[0])\n                    .equals(indexOrCrit[keyPaths[0]]);\n            var compoundIndex = this.schema.indexes.concat(this.schema.primKey).filter(function (ix) {\n                if (ix.compound &&\n                    keyPaths.every(function (keyPath) { return ix.keyPath.indexOf(keyPath) >= 0; })) {\n                    for (var i = 0; i < keyPaths.length; ++i) {\n                        if (keyPaths.indexOf(ix.keyPath[i]) === -1)\n                            return false;\n                    }\n                    return true;\n                }\n                return false;\n            }).sort(function (a, b) { return a.keyPath.length - b.keyPath.length; })[0];\n            if (compoundIndex && this.db._maxKey !== maxString) {\n                var keyPathsInValidOrder = compoundIndex.keyPath.slice(0, keyPaths.length);\n                return this\n                    .where(keyPathsInValidOrder)\n                    .equals(keyPathsInValidOrder.map(function (kp) { return indexOrCrit[kp]; }));\n            }\n            if (!compoundIndex && debug)\n                console.warn(\"The query \".concat(JSON.stringify(indexOrCrit), \" on \").concat(this.name, \" would benefit from a \") +\n                    \"compound index [\".concat(keyPaths.join('+'), \"]\"));\n            var idxByName = this.schema.idxByName;\n            function equals(a, b) {\n                return cmp(a, b) === 0;\n            }\n            var _a = keyPaths.reduce(function (_a, keyPath) {\n                var prevIndex = _a[0], prevFilterFn = _a[1];\n                var index = idxByName[keyPath];\n                var value = indexOrCrit[keyPath];\n                return [\n                    prevIndex || index,\n                    prevIndex || !index ?\n                        combine(prevFilterFn, index && index.multi ?\n                            function (x) {\n                                var prop = getByKeyPath(x, keyPath);\n                                return isArray(prop) && prop.some(function (item) { return equals(value, item); });\n                            } : function (x) { return equals(value, getByKeyPath(x, keyPath)); })\n                        : prevFilterFn\n                ];\n            }, [null, null]), idx = _a[0], filterFunction = _a[1];\n            return idx ?\n                this.where(idx.name).equals(indexOrCrit[idx.keyPath])\n                    .filter(filterFunction) :\n                compoundIndex ?\n                    this.filter(filterFunction) :\n                    this.where(keyPaths).equals('');\n        };\n        Table.prototype.filter = function (filterFunction) {\n            return this.toCollection().and(filterFunction);\n        };\n        Table.prototype.count = function (thenShortcut) {\n            return this.toCollection().count(thenShortcut);\n        };\n        Table.prototype.offset = function (offset) {\n            return this.toCollection().offset(offset);\n        };\n        Table.prototype.limit = function (numRows) {\n            return this.toCollection().limit(numRows);\n        };\n        Table.prototype.each = function (callback) {\n            return this.toCollection().each(callback);\n        };\n        Table.prototype.toArray = function (thenShortcut) {\n            return this.toCollection().toArray(thenShortcut);\n        };\n        Table.prototype.toCollection = function () {\n            return new this.db.Collection(new this.db.WhereClause(this));\n        };\n        Table.prototype.orderBy = function (index) {\n            return new this.db.Collection(new this.db.WhereClause(this, isArray(index) ?\n                \"[\".concat(index.join('+'), \"]\") :\n                index));\n        };\n        Table.prototype.reverse = function () {\n            return this.toCollection().reverse();\n        };\n        Table.prototype.mapToClass = function (constructor) {\n            var _a = this, db = _a.db, tableName = _a.name;\n            this.schema.mappedClass = constructor;\n            if (constructor.prototype instanceof Entity) {\n                constructor =  (function (_super) {\n                    __extends(class_1, _super);\n                    function class_1() {\n                        return _super !== null && _super.apply(this, arguments) || this;\n                    }\n                    Object.defineProperty(class_1.prototype, \"db\", {\n                        get: function () { return db; },\n                        enumerable: false,\n                        configurable: true\n                    });\n                    class_1.prototype.table = function () { return tableName; };\n                    return class_1;\n                }(constructor));\n            }\n            var inheritedProps = new Set();\n            for (var proto = constructor.prototype; proto; proto = getProto(proto)) {\n                Object.getOwnPropertyNames(proto).forEach(function (propName) { return inheritedProps.add(propName); });\n            }\n            var readHook = function (obj) {\n                if (!obj)\n                    return obj;\n                var res = Object.create(constructor.prototype);\n                for (var m in obj)\n                    if (!inheritedProps.has(m))\n                        try {\n                            res[m] = obj[m];\n                        }\n                        catch (_) { }\n                return res;\n            };\n            if (this.schema.readHook) {\n                this.hook.reading.unsubscribe(this.schema.readHook);\n            }\n            this.schema.readHook = readHook;\n            this.hook(\"reading\", readHook);\n            return constructor;\n        };\n        Table.prototype.defineClass = function () {\n            function Class(content) {\n                extend(this, content);\n            }\n            return this.mapToClass(Class);\n        };\n        Table.prototype.add = function (obj, key) {\n            var _this = this;\n            var _a = this.schema.primKey, auto = _a.auto, keyPath = _a.keyPath;\n            var objToAdd = obj;\n            if (keyPath && auto) {\n                objToAdd = workaroundForUndefinedPrimKey(keyPath)(obj);\n            }\n            return this._trans('readwrite', function (trans) {\n                return _this.core.mutate({ trans: trans, type: 'add', keys: key != null ? [key] : null, values: [objToAdd] });\n            }).then(function (res) { return res.numFailures ? DexiePromise.reject(res.failures[0]) : res.lastResult; })\n                .then(function (lastResult) {\n                if (keyPath) {\n                    try {\n                        setByKeyPath(obj, keyPath, lastResult);\n                    }\n                    catch (_) { }\n                }\n                return lastResult;\n            });\n        };\n        Table.prototype.update = function (keyOrObject, modifications) {\n            if (typeof keyOrObject === 'object' && !isArray(keyOrObject)) {\n                var key = getByKeyPath(keyOrObject, this.schema.primKey.keyPath);\n                if (key === undefined)\n                    return rejection(new exceptions.InvalidArgument(\"Given object does not contain its primary key\"));\n                return this.where(\":id\").equals(key).modify(modifications);\n            }\n            else {\n                return this.where(\":id\").equals(keyOrObject).modify(modifications);\n            }\n        };\n        Table.prototype.put = function (obj, key) {\n            var _this = this;\n            var _a = this.schema.primKey, auto = _a.auto, keyPath = _a.keyPath;\n            var objToAdd = obj;\n            if (keyPath && auto) {\n                objToAdd = workaroundForUndefinedPrimKey(keyPath)(obj);\n            }\n            return this._trans('readwrite', function (trans) { return _this.core.mutate({ trans: trans, type: 'put', values: [objToAdd], keys: key != null ? [key] : null }); })\n                .then(function (res) { return res.numFailures ? DexiePromise.reject(res.failures[0]) : res.lastResult; })\n                .then(function (lastResult) {\n                if (keyPath) {\n                    try {\n                        setByKeyPath(obj, keyPath, lastResult);\n                    }\n                    catch (_) { }\n                }\n                return lastResult;\n            });\n        };\n        Table.prototype.delete = function (key) {\n            var _this = this;\n            return this._trans('readwrite', function (trans) { return _this.core.mutate({ trans: trans, type: 'delete', keys: [key] }); })\n                .then(function (res) { return res.numFailures ? DexiePromise.reject(res.failures[0]) : undefined; });\n        };\n        Table.prototype.clear = function () {\n            var _this = this;\n            return this._trans('readwrite', function (trans) { return _this.core.mutate({ trans: trans, type: 'deleteRange', range: AnyRange }); })\n                .then(function (res) { return res.numFailures ? DexiePromise.reject(res.failures[0]) : undefined; });\n        };\n        Table.prototype.bulkGet = function (keys) {\n            var _this = this;\n            return this._trans('readonly', function (trans) {\n                return _this.core.getMany({\n                    keys: keys,\n                    trans: trans\n                }).then(function (result) { return result.map(function (res) { return _this.hook.reading.fire(res); }); });\n            });\n        };\n        Table.prototype.bulkAdd = function (objects, keysOrOptions, options) {\n            var _this = this;\n            var keys = Array.isArray(keysOrOptions) ? keysOrOptions : undefined;\n            options = options || (keys ? undefined : keysOrOptions);\n            var wantResults = options ? options.allKeys : undefined;\n            return this._trans('readwrite', function (trans) {\n                var _a = _this.schema.primKey, auto = _a.auto, keyPath = _a.keyPath;\n                if (keyPath && keys)\n                    throw new exceptions.InvalidArgument(\"bulkAdd(): keys argument invalid on tables with inbound keys\");\n                if (keys && keys.length !== objects.length)\n                    throw new exceptions.InvalidArgument(\"Arguments objects and keys must have the same length\");\n                var numObjects = objects.length;\n                var objectsToAdd = keyPath && auto ?\n                    objects.map(workaroundForUndefinedPrimKey(keyPath)) :\n                    objects;\n                return _this.core.mutate({ trans: trans, type: 'add', keys: keys, values: objectsToAdd, wantResults: wantResults })\n                    .then(function (_a) {\n                    var numFailures = _a.numFailures, results = _a.results, lastResult = _a.lastResult, failures = _a.failures;\n                    var result = wantResults ? results : lastResult;\n                    if (numFailures === 0)\n                        return result;\n                    throw new BulkError(\"\".concat(_this.name, \".bulkAdd(): \").concat(numFailures, \" of \").concat(numObjects, \" operations failed\"), failures);\n                });\n            });\n        };\n        Table.prototype.bulkPut = function (objects, keysOrOptions, options) {\n            var _this = this;\n            var keys = Array.isArray(keysOrOptions) ? keysOrOptions : undefined;\n            options = options || (keys ? undefined : keysOrOptions);\n            var wantResults = options ? options.allKeys : undefined;\n            return this._trans('readwrite', function (trans) {\n                var _a = _this.schema.primKey, auto = _a.auto, keyPath = _a.keyPath;\n                if (keyPath && keys)\n                    throw new exceptions.InvalidArgument(\"bulkPut(): keys argument invalid on tables with inbound keys\");\n                if (keys && keys.length !== objects.length)\n                    throw new exceptions.InvalidArgument(\"Arguments objects and keys must have the same length\");\n                var numObjects = objects.length;\n                var objectsToPut = keyPath && auto ?\n                    objects.map(workaroundForUndefinedPrimKey(keyPath)) :\n                    objects;\n                return _this.core.mutate({ trans: trans, type: 'put', keys: keys, values: objectsToPut, wantResults: wantResults })\n                    .then(function (_a) {\n                    var numFailures = _a.numFailures, results = _a.results, lastResult = _a.lastResult, failures = _a.failures;\n                    var result = wantResults ? results : lastResult;\n                    if (numFailures === 0)\n                        return result;\n                    throw new BulkError(\"\".concat(_this.name, \".bulkPut(): \").concat(numFailures, \" of \").concat(numObjects, \" operations failed\"), failures);\n                });\n            });\n        };\n        Table.prototype.bulkUpdate = function (keysAndChanges) {\n            var _this = this;\n            var coreTable = this.core;\n            var keys = keysAndChanges.map(function (entry) { return entry.key; });\n            var changeSpecs = keysAndChanges.map(function (entry) { return entry.changes; });\n            var offsetMap = [];\n            return this._trans('readwrite', function (trans) {\n                return coreTable.getMany({ trans: trans, keys: keys, cache: 'clone' }).then(function (objs) {\n                    var resultKeys = [];\n                    var resultObjs = [];\n                    keysAndChanges.forEach(function (_a, idx) {\n                        var key = _a.key, changes = _a.changes;\n                        var obj = objs[idx];\n                        if (obj) {\n                            for (var _i = 0, _b = Object.keys(changes); _i < _b.length; _i++) {\n                                var keyPath = _b[_i];\n                                var value = changes[keyPath];\n                                if (keyPath === _this.schema.primKey.keyPath) {\n                                    if (cmp(value, key) !== 0) {\n                                        throw new exceptions.Constraint(\"Cannot update primary key in bulkUpdate()\");\n                                    }\n                                }\n                                else {\n                                    setByKeyPath(obj, keyPath, value);\n                                }\n                            }\n                            offsetMap.push(idx);\n                            resultKeys.push(key);\n                            resultObjs.push(obj);\n                        }\n                    });\n                    var numEntries = resultKeys.length;\n                    return coreTable\n                        .mutate({\n                        trans: trans,\n                        type: 'put',\n                        keys: resultKeys,\n                        values: resultObjs,\n                        updates: {\n                            keys: keys,\n                            changeSpecs: changeSpecs\n                        }\n                    })\n                        .then(function (_a) {\n                        var numFailures = _a.numFailures, failures = _a.failures;\n                        if (numFailures === 0)\n                            return numEntries;\n                        for (var _i = 0, _b = Object.keys(failures); _i < _b.length; _i++) {\n                            var offset = _b[_i];\n                            var mappedOffset = offsetMap[Number(offset)];\n                            if (mappedOffset != null) {\n                                var failure = failures[offset];\n                                delete failures[offset];\n                                failures[mappedOffset] = failure;\n                            }\n                        }\n                        throw new BulkError(\"\".concat(_this.name, \".bulkUpdate(): \").concat(numFailures, \" of \").concat(numEntries, \" operations failed\"), failures);\n                    });\n                });\n            });\n        };\n        Table.prototype.bulkDelete = function (keys) {\n            var _this = this;\n            var numKeys = keys.length;\n            return this._trans('readwrite', function (trans) {\n                return _this.core.mutate({ trans: trans, type: 'delete', keys: keys });\n            }).then(function (_a) {\n                var numFailures = _a.numFailures, lastResult = _a.lastResult, failures = _a.failures;\n                if (numFailures === 0)\n                    return lastResult;\n                throw new BulkError(\"\".concat(_this.name, \".bulkDelete(): \").concat(numFailures, \" of \").concat(numKeys, \" operations failed\"), failures);\n            });\n        };\n        return Table;\n    }());\n\n    function Events(ctx) {\n        var evs = {};\n        var rv = function (eventName, subscriber) {\n            if (subscriber) {\n                var i = arguments.length, args = new Array(i - 1);\n                while (--i)\n                    args[i - 1] = arguments[i];\n                evs[eventName].subscribe.apply(null, args);\n                return ctx;\n            }\n            else if (typeof (eventName) === 'string') {\n                return evs[eventName];\n            }\n        };\n        rv.addEventType = add;\n        for (var i = 1, l = arguments.length; i < l; ++i) {\n            add(arguments[i]);\n        }\n        return rv;\n        function add(eventName, chainFunction, defaultFunction) {\n            if (typeof eventName === 'object')\n                return addConfiguredEvents(eventName);\n            if (!chainFunction)\n                chainFunction = reverseStoppableEventChain;\n            if (!defaultFunction)\n                defaultFunction = nop;\n            var context = {\n                subscribers: [],\n                fire: defaultFunction,\n                subscribe: function (cb) {\n                    if (context.subscribers.indexOf(cb) === -1) {\n                        context.subscribers.push(cb);\n                        context.fire = chainFunction(context.fire, cb);\n                    }\n                },\n                unsubscribe: function (cb) {\n                    context.subscribers = context.subscribers.filter(function (fn) { return fn !== cb; });\n                    context.fire = context.subscribers.reduce(chainFunction, defaultFunction);\n                }\n            };\n            evs[eventName] = rv[eventName] = context;\n            return context;\n        }\n        function addConfiguredEvents(cfg) {\n            keys(cfg).forEach(function (eventName) {\n                var args = cfg[eventName];\n                if (isArray(args)) {\n                    add(eventName, cfg[eventName][0], cfg[eventName][1]);\n                }\n                else if (args === 'asap') {\n                    var context = add(eventName, mirror, function fire() {\n                        var i = arguments.length, args = new Array(i);\n                        while (i--)\n                            args[i] = arguments[i];\n                        context.subscribers.forEach(function (fn) {\n                            asap$1(function fireEvent() {\n                                fn.apply(null, args);\n                            });\n                        });\n                    });\n                }\n                else\n                    throw new exceptions.InvalidArgument(\"Invalid event config\");\n            });\n        }\n    }\n\n    function makeClassConstructor(prototype, constructor) {\n        derive(constructor).from({ prototype: prototype });\n        return constructor;\n    }\n\n    function createTableConstructor(db) {\n        return makeClassConstructor(Table.prototype, function Table(name, tableSchema, trans) {\n            this.db = db;\n            this._tx = trans;\n            this.name = name;\n            this.schema = tableSchema;\n            this.hook = db._allTables[name] ? db._allTables[name].hook : Events(null, {\n                \"creating\": [hookCreatingChain, nop],\n                \"reading\": [pureFunctionChain, mirror],\n                \"updating\": [hookUpdatingChain, nop],\n                \"deleting\": [hookDeletingChain, nop]\n            });\n        });\n    }\n\n    function isPlainKeyRange(ctx, ignoreLimitFilter) {\n        return !(ctx.filter || ctx.algorithm || ctx.or) &&\n            (ignoreLimitFilter ? ctx.justLimit : !ctx.replayFilter);\n    }\n    function addFilter(ctx, fn) {\n        ctx.filter = combine(ctx.filter, fn);\n    }\n    function addReplayFilter(ctx, factory, isLimitFilter) {\n        var curr = ctx.replayFilter;\n        ctx.replayFilter = curr ? function () { return combine(curr(), factory()); } : factory;\n        ctx.justLimit = isLimitFilter && !curr;\n    }\n    function addMatchFilter(ctx, fn) {\n        ctx.isMatch = combine(ctx.isMatch, fn);\n    }\n    function getIndexOrStore(ctx, coreSchema) {\n        if (ctx.isPrimKey)\n            return coreSchema.primaryKey;\n        var index = coreSchema.getIndexByKeyPath(ctx.index);\n        if (!index)\n            throw new exceptions.Schema(\"KeyPath \" + ctx.index + \" on object store \" + coreSchema.name + \" is not indexed\");\n        return index;\n    }\n    function openCursor(ctx, coreTable, trans) {\n        var index = getIndexOrStore(ctx, coreTable.schema);\n        return coreTable.openCursor({\n            trans: trans,\n            values: !ctx.keysOnly,\n            reverse: ctx.dir === 'prev',\n            unique: !!ctx.unique,\n            query: {\n                index: index,\n                range: ctx.range\n            }\n        });\n    }\n    function iter(ctx, fn, coreTrans, coreTable) {\n        var filter = ctx.replayFilter ? combine(ctx.filter, ctx.replayFilter()) : ctx.filter;\n        if (!ctx.or) {\n            return iterate(openCursor(ctx, coreTable, coreTrans), combine(ctx.algorithm, filter), fn, !ctx.keysOnly && ctx.valueMapper);\n        }\n        else {\n            var set_1 = {};\n            var union = function (item, cursor, advance) {\n                if (!filter || filter(cursor, advance, function (result) { return cursor.stop(result); }, function (err) { return cursor.fail(err); })) {\n                    var primaryKey = cursor.primaryKey;\n                    var key = '' + primaryKey;\n                    if (key === '[object ArrayBuffer]')\n                        key = '' + new Uint8Array(primaryKey);\n                    if (!hasOwn(set_1, key)) {\n                        set_1[key] = true;\n                        fn(item, cursor, advance);\n                    }\n                }\n            };\n            return Promise.all([\n                ctx.or._iterate(union, coreTrans),\n                iterate(openCursor(ctx, coreTable, coreTrans), ctx.algorithm, union, !ctx.keysOnly && ctx.valueMapper)\n            ]);\n        }\n    }\n    function iterate(cursorPromise, filter, fn, valueMapper) {\n        var mappedFn = valueMapper ? function (x, c, a) { return fn(valueMapper(x), c, a); } : fn;\n        var wrappedFn = wrap(mappedFn);\n        return cursorPromise.then(function (cursor) {\n            if (cursor) {\n                return cursor.start(function () {\n                    var c = function () { return cursor.continue(); };\n                    if (!filter || filter(cursor, function (advancer) { return c = advancer; }, function (val) { cursor.stop(val); c = nop; }, function (e) { cursor.fail(e); c = nop; }))\n                        wrappedFn(cursor.value, cursor, function (advancer) { return c = advancer; });\n                    c();\n                });\n            }\n        });\n    }\n\n    var PropModification =  (function () {\n        function PropModification(spec) {\n            this[\"@@propmod\"] = spec;\n        }\n        PropModification.prototype.execute = function (value) {\n            var _a;\n            var spec = this[\"@@propmod\"];\n            if (spec.add !== undefined) {\n                var term = spec.add;\n                if (isArray(term)) {\n                    return __spreadArray(__spreadArray([], (isArray(value) ? value : []), true), term, true).sort();\n                }\n                if (typeof term === 'number')\n                    return (Number(value) || 0) + term;\n                if (typeof term === 'bigint') {\n                    try {\n                        return BigInt(value) + term;\n                    }\n                    catch (_b) {\n                        return BigInt(0) + term;\n                    }\n                }\n                throw new TypeError(\"Invalid term \".concat(term));\n            }\n            if (spec.remove !== undefined) {\n                var subtrahend_1 = spec.remove;\n                if (isArray(subtrahend_1)) {\n                    return isArray(value) ? value.filter(function (item) { return !subtrahend_1.includes(item); }).sort() : [];\n                }\n                if (typeof subtrahend_1 === 'number')\n                    return Number(value) - subtrahend_1;\n                if (typeof subtrahend_1 === 'bigint') {\n                    try {\n                        return BigInt(value) - subtrahend_1;\n                    }\n                    catch (_c) {\n                        return BigInt(0) - subtrahend_1;\n                    }\n                }\n                throw new TypeError(\"Invalid subtrahend \".concat(subtrahend_1));\n            }\n            var prefixToReplace = (_a = spec.replacePrefix) === null || _a === void 0 ? void 0 : _a[0];\n            if (prefixToReplace && typeof value === 'string' && value.startsWith(prefixToReplace)) {\n                return spec.replacePrefix[1] + value.substring(prefixToReplace.length);\n            }\n            return value;\n        };\n        return PropModification;\n    }());\n\n    var Collection =  (function () {\n        function Collection() {\n        }\n        Collection.prototype._read = function (fn, cb) {\n            var ctx = this._ctx;\n            return ctx.error ?\n                ctx.table._trans(null, rejection.bind(null, ctx.error)) :\n                ctx.table._trans('readonly', fn).then(cb);\n        };\n        Collection.prototype._write = function (fn) {\n            var ctx = this._ctx;\n            return ctx.error ?\n                ctx.table._trans(null, rejection.bind(null, ctx.error)) :\n                ctx.table._trans('readwrite', fn, \"locked\");\n        };\n        Collection.prototype._addAlgorithm = function (fn) {\n            var ctx = this._ctx;\n            ctx.algorithm = combine(ctx.algorithm, fn);\n        };\n        Collection.prototype._iterate = function (fn, coreTrans) {\n            return iter(this._ctx, fn, coreTrans, this._ctx.table.core);\n        };\n        Collection.prototype.clone = function (props) {\n            var rv = Object.create(this.constructor.prototype), ctx = Object.create(this._ctx);\n            if (props)\n                extend(ctx, props);\n            rv._ctx = ctx;\n            return rv;\n        };\n        Collection.prototype.raw = function () {\n            this._ctx.valueMapper = null;\n            return this;\n        };\n        Collection.prototype.each = function (fn) {\n            var ctx = this._ctx;\n            return this._read(function (trans) { return iter(ctx, fn, trans, ctx.table.core); });\n        };\n        Collection.prototype.count = function (cb) {\n            var _this = this;\n            return this._read(function (trans) {\n                var ctx = _this._ctx;\n                var coreTable = ctx.table.core;\n                if (isPlainKeyRange(ctx, true)) {\n                    return coreTable.count({\n                        trans: trans,\n                        query: {\n                            index: getIndexOrStore(ctx, coreTable.schema),\n                            range: ctx.range\n                        }\n                    }).then(function (count) { return Math.min(count, ctx.limit); });\n                }\n                else {\n                    var count = 0;\n                    return iter(ctx, function () { ++count; return false; }, trans, coreTable)\n                        .then(function () { return count; });\n                }\n            }).then(cb);\n        };\n        Collection.prototype.sortBy = function (keyPath, cb) {\n            var parts = keyPath.split('.').reverse(), lastPart = parts[0], lastIndex = parts.length - 1;\n            function getval(obj, i) {\n                if (i)\n                    return getval(obj[parts[i]], i - 1);\n                return obj[lastPart];\n            }\n            var order = this._ctx.dir === \"next\" ? 1 : -1;\n            function sorter(a, b) {\n                var aVal = getval(a, lastIndex), bVal = getval(b, lastIndex);\n                return cmp(aVal, bVal) * order;\n            }\n            return this.toArray(function (a) {\n                return a.sort(sorter);\n            }).then(cb);\n        };\n        Collection.prototype.toArray = function (cb) {\n            var _this = this;\n            return this._read(function (trans) {\n                var ctx = _this._ctx;\n                if (ctx.dir === 'next' && isPlainKeyRange(ctx, true) && ctx.limit > 0) {\n                    var valueMapper_1 = ctx.valueMapper;\n                    var index = getIndexOrStore(ctx, ctx.table.core.schema);\n                    return ctx.table.core.query({\n                        trans: trans,\n                        limit: ctx.limit,\n                        values: true,\n                        query: {\n                            index: index,\n                            range: ctx.range\n                        }\n                    }).then(function (_a) {\n                        var result = _a.result;\n                        return valueMapper_1 ? result.map(valueMapper_1) : result;\n                    });\n                }\n                else {\n                    var a_1 = [];\n                    return iter(ctx, function (item) { return a_1.push(item); }, trans, ctx.table.core).then(function () { return a_1; });\n                }\n            }, cb);\n        };\n        Collection.prototype.offset = function (offset) {\n            var ctx = this._ctx;\n            if (offset <= 0)\n                return this;\n            ctx.offset += offset;\n            if (isPlainKeyRange(ctx)) {\n                addReplayFilter(ctx, function () {\n                    var offsetLeft = offset;\n                    return function (cursor, advance) {\n                        if (offsetLeft === 0)\n                            return true;\n                        if (offsetLeft === 1) {\n                            --offsetLeft;\n                            return false;\n                        }\n                        advance(function () {\n                            cursor.advance(offsetLeft);\n                            offsetLeft = 0;\n                        });\n                        return false;\n                    };\n                });\n            }\n            else {\n                addReplayFilter(ctx, function () {\n                    var offsetLeft = offset;\n                    return function () { return (--offsetLeft < 0); };\n                });\n            }\n            return this;\n        };\n        Collection.prototype.limit = function (numRows) {\n            this._ctx.limit = Math.min(this._ctx.limit, numRows);\n            addReplayFilter(this._ctx, function () {\n                var rowsLeft = numRows;\n                return function (cursor, advance, resolve) {\n                    if (--rowsLeft <= 0)\n                        advance(resolve);\n                    return rowsLeft >= 0;\n                };\n            }, true);\n            return this;\n        };\n        Collection.prototype.until = function (filterFunction, bIncludeStopEntry) {\n            addFilter(this._ctx, function (cursor, advance, resolve) {\n                if (filterFunction(cursor.value)) {\n                    advance(resolve);\n                    return bIncludeStopEntry;\n                }\n                else {\n                    return true;\n                }\n            });\n            return this;\n        };\n        Collection.prototype.first = function (cb) {\n            return this.limit(1).toArray(function (a) { return a[0]; }).then(cb);\n        };\n        Collection.prototype.last = function (cb) {\n            return this.reverse().first(cb);\n        };\n        Collection.prototype.filter = function (filterFunction) {\n            addFilter(this._ctx, function (cursor) {\n                return filterFunction(cursor.value);\n            });\n            addMatchFilter(this._ctx, filterFunction);\n            return this;\n        };\n        Collection.prototype.and = function (filter) {\n            return this.filter(filter);\n        };\n        Collection.prototype.or = function (indexName) {\n            return new this.db.WhereClause(this._ctx.table, indexName, this);\n        };\n        Collection.prototype.reverse = function () {\n            this._ctx.dir = (this._ctx.dir === \"prev\" ? \"next\" : \"prev\");\n            if (this._ondirectionchange)\n                this._ondirectionchange(this._ctx.dir);\n            return this;\n        };\n        Collection.prototype.desc = function () {\n            return this.reverse();\n        };\n        Collection.prototype.eachKey = function (cb) {\n            var ctx = this._ctx;\n            ctx.keysOnly = !ctx.isMatch;\n            return this.each(function (val, cursor) { cb(cursor.key, cursor); });\n        };\n        Collection.prototype.eachUniqueKey = function (cb) {\n            this._ctx.unique = \"unique\";\n            return this.eachKey(cb);\n        };\n        Collection.prototype.eachPrimaryKey = function (cb) {\n            var ctx = this._ctx;\n            ctx.keysOnly = !ctx.isMatch;\n            return this.each(function (val, cursor) { cb(cursor.primaryKey, cursor); });\n        };\n        Collection.prototype.keys = function (cb) {\n            var ctx = this._ctx;\n            ctx.keysOnly = !ctx.isMatch;\n            var a = [];\n            return this.each(function (item, cursor) {\n                a.push(cursor.key);\n            }).then(function () {\n                return a;\n            }).then(cb);\n        };\n        Collection.prototype.primaryKeys = function (cb) {\n            var ctx = this._ctx;\n            if (ctx.dir === 'next' && isPlainKeyRange(ctx, true) && ctx.limit > 0) {\n                return this._read(function (trans) {\n                    var index = getIndexOrStore(ctx, ctx.table.core.schema);\n                    return ctx.table.core.query({\n                        trans: trans,\n                        values: false,\n                        limit: ctx.limit,\n                        query: {\n                            index: index,\n                            range: ctx.range\n                        }\n                    });\n                }).then(function (_a) {\n                    var result = _a.result;\n                    return result;\n                }).then(cb);\n            }\n            ctx.keysOnly = !ctx.isMatch;\n            var a = [];\n            return this.each(function (item, cursor) {\n                a.push(cursor.primaryKey);\n            }).then(function () {\n                return a;\n            }).then(cb);\n        };\n        Collection.prototype.uniqueKeys = function (cb) {\n            this._ctx.unique = \"unique\";\n            return this.keys(cb);\n        };\n        Collection.prototype.firstKey = function (cb) {\n            return this.limit(1).keys(function (a) { return a[0]; }).then(cb);\n        };\n        Collection.prototype.lastKey = function (cb) {\n            return this.reverse().firstKey(cb);\n        };\n        Collection.prototype.distinct = function () {\n            var ctx = this._ctx, idx = ctx.index && ctx.table.schema.idxByName[ctx.index];\n            if (!idx || !idx.multi)\n                return this;\n            var set = {};\n            addFilter(this._ctx, function (cursor) {\n                var strKey = cursor.primaryKey.toString();\n                var found = hasOwn(set, strKey);\n                set[strKey] = true;\n                return !found;\n            });\n            return this;\n        };\n        Collection.prototype.modify = function (changes) {\n            var _this = this;\n            var ctx = this._ctx;\n            return this._write(function (trans) {\n                var modifyer;\n                if (typeof changes === 'function') {\n                    modifyer = changes;\n                }\n                else {\n                    var keyPaths = keys(changes);\n                    var numKeys = keyPaths.length;\n                    modifyer = function (item) {\n                        var anythingModified = false;\n                        for (var i = 0; i < numKeys; ++i) {\n                            var keyPath = keyPaths[i];\n                            var val = changes[keyPath];\n                            var origVal = getByKeyPath(item, keyPath);\n                            if (val instanceof PropModification) {\n                                setByKeyPath(item, keyPath, val.execute(origVal));\n                                anythingModified = true;\n                            }\n                            else if (origVal !== val) {\n                                setByKeyPath(item, keyPath, val);\n                                anythingModified = true;\n                            }\n                        }\n                        return anythingModified;\n                    };\n                }\n                var coreTable = ctx.table.core;\n                var _a = coreTable.schema.primaryKey, outbound = _a.outbound, extractKey = _a.extractKey;\n                var limit = 200;\n                var modifyChunkSize = _this.db._options.modifyChunkSize;\n                if (modifyChunkSize) {\n                    if (typeof modifyChunkSize == 'object') {\n                        limit = modifyChunkSize[coreTable.name] || modifyChunkSize['*'] || 200;\n                    }\n                    else {\n                        limit = modifyChunkSize;\n                    }\n                }\n                var totalFailures = [];\n                var successCount = 0;\n                var failedKeys = [];\n                var applyMutateResult = function (expectedCount, res) {\n                    var failures = res.failures, numFailures = res.numFailures;\n                    successCount += expectedCount - numFailures;\n                    for (var _i = 0, _a = keys(failures); _i < _a.length; _i++) {\n                        var pos = _a[_i];\n                        totalFailures.push(failures[pos]);\n                    }\n                };\n                return _this.clone().primaryKeys().then(function (keys) {\n                    var criteria = isPlainKeyRange(ctx) &&\n                        ctx.limit === Infinity &&\n                        (typeof changes !== 'function' || changes === deleteCallback) && {\n                        index: ctx.index,\n                        range: ctx.range\n                    };\n                    var nextChunk = function (offset) {\n                        var count = Math.min(limit, keys.length - offset);\n                        return coreTable.getMany({\n                            trans: trans,\n                            keys: keys.slice(offset, offset + count),\n                            cache: \"immutable\"\n                        }).then(function (values) {\n                            var addValues = [];\n                            var putValues = [];\n                            var putKeys = outbound ? [] : null;\n                            var deleteKeys = [];\n                            for (var i = 0; i < count; ++i) {\n                                var origValue = values[i];\n                                var ctx_1 = {\n                                    value: deepClone(origValue),\n                                    primKey: keys[offset + i]\n                                };\n                                if (modifyer.call(ctx_1, ctx_1.value, ctx_1) !== false) {\n                                    if (ctx_1.value == null) {\n                                        deleteKeys.push(keys[offset + i]);\n                                    }\n                                    else if (!outbound && cmp(extractKey(origValue), extractKey(ctx_1.value)) !== 0) {\n                                        deleteKeys.push(keys[offset + i]);\n                                        addValues.push(ctx_1.value);\n                                    }\n                                    else {\n                                        putValues.push(ctx_1.value);\n                                        if (outbound)\n                                            putKeys.push(keys[offset + i]);\n                                    }\n                                }\n                            }\n                            return Promise.resolve(addValues.length > 0 &&\n                                coreTable.mutate({ trans: trans, type: 'add', values: addValues })\n                                    .then(function (res) {\n                                    for (var pos in res.failures) {\n                                        deleteKeys.splice(parseInt(pos), 1);\n                                    }\n                                    applyMutateResult(addValues.length, res);\n                                })).then(function () { return (putValues.length > 0 || (criteria && typeof changes === 'object')) &&\n                                coreTable.mutate({\n                                    trans: trans,\n                                    type: 'put',\n                                    keys: putKeys,\n                                    values: putValues,\n                                    criteria: criteria,\n                                    changeSpec: typeof changes !== 'function'\n                                        && changes,\n                                    isAdditionalChunk: offset > 0\n                                }).then(function (res) { return applyMutateResult(putValues.length, res); }); }).then(function () { return (deleteKeys.length > 0 || (criteria && changes === deleteCallback)) &&\n                                coreTable.mutate({\n                                    trans: trans,\n                                    type: 'delete',\n                                    keys: deleteKeys,\n                                    criteria: criteria,\n                                    isAdditionalChunk: offset > 0\n                                }).then(function (res) { return applyMutateResult(deleteKeys.length, res); }); }).then(function () {\n                                return keys.length > offset + count && nextChunk(offset + limit);\n                            });\n                        });\n                    };\n                    return nextChunk(0).then(function () {\n                        if (totalFailures.length > 0)\n                            throw new ModifyError(\"Error modifying one or more objects\", totalFailures, successCount, failedKeys);\n                        return keys.length;\n                    });\n                });\n            });\n        };\n        Collection.prototype.delete = function () {\n            var ctx = this._ctx, range = ctx.range;\n            if (isPlainKeyRange(ctx) &&\n                (ctx.isPrimKey || range.type === 3 ))\n             {\n                return this._write(function (trans) {\n                    var primaryKey = ctx.table.core.schema.primaryKey;\n                    var coreRange = range;\n                    return ctx.table.core.count({ trans: trans, query: { index: primaryKey, range: coreRange } }).then(function (count) {\n                        return ctx.table.core.mutate({ trans: trans, type: 'deleteRange', range: coreRange })\n                            .then(function (_a) {\n                            var failures = _a.failures; _a.lastResult; _a.results; var numFailures = _a.numFailures;\n                            if (numFailures)\n                                throw new ModifyError(\"Could not delete some values\", Object.keys(failures).map(function (pos) { return failures[pos]; }), count - numFailures);\n                            return count - numFailures;\n                        });\n                    });\n                });\n            }\n            return this.modify(deleteCallback);\n        };\n        return Collection;\n    }());\n    var deleteCallback = function (value, ctx) { return ctx.value = null; };\n\n    function createCollectionConstructor(db) {\n        return makeClassConstructor(Collection.prototype, function Collection(whereClause, keyRangeGenerator) {\n            this.db = db;\n            var keyRange = AnyRange, error = null;\n            if (keyRangeGenerator)\n                try {\n                    keyRange = keyRangeGenerator();\n                }\n                catch (ex) {\n                    error = ex;\n                }\n            var whereCtx = whereClause._ctx;\n            var table = whereCtx.table;\n            var readingHook = table.hook.reading.fire;\n            this._ctx = {\n                table: table,\n                index: whereCtx.index,\n                isPrimKey: (!whereCtx.index || (table.schema.primKey.keyPath && whereCtx.index === table.schema.primKey.name)),\n                range: keyRange,\n                keysOnly: false,\n                dir: \"next\",\n                unique: \"\",\n                algorithm: null,\n                filter: null,\n                replayFilter: null,\n                justLimit: true,\n                isMatch: null,\n                offset: 0,\n                limit: Infinity,\n                error: error,\n                or: whereCtx.or,\n                valueMapper: readingHook !== mirror ? readingHook : null\n            };\n        });\n    }\n\n    function simpleCompare(a, b) {\n        return a < b ? -1 : a === b ? 0 : 1;\n    }\n    function simpleCompareReverse(a, b) {\n        return a > b ? -1 : a === b ? 0 : 1;\n    }\n\n    function fail(collectionOrWhereClause, err, T) {\n        var collection = collectionOrWhereClause instanceof WhereClause ?\n            new collectionOrWhereClause.Collection(collectionOrWhereClause) :\n            collectionOrWhereClause;\n        collection._ctx.error = T ? new T(err) : new TypeError(err);\n        return collection;\n    }\n    function emptyCollection(whereClause) {\n        return new whereClause.Collection(whereClause, function () { return rangeEqual(\"\"); }).limit(0);\n    }\n    function upperFactory(dir) {\n        return dir === \"next\" ?\n            function (s) { return s.toUpperCase(); } :\n            function (s) { return s.toLowerCase(); };\n    }\n    function lowerFactory(dir) {\n        return dir === \"next\" ?\n            function (s) { return s.toLowerCase(); } :\n            function (s) { return s.toUpperCase(); };\n    }\n    function nextCasing(key, lowerKey, upperNeedle, lowerNeedle, cmp, dir) {\n        var length = Math.min(key.length, lowerNeedle.length);\n        var llp = -1;\n        for (var i = 0; i < length; ++i) {\n            var lwrKeyChar = lowerKey[i];\n            if (lwrKeyChar !== lowerNeedle[i]) {\n                if (cmp(key[i], upperNeedle[i]) < 0)\n                    return key.substr(0, i) + upperNeedle[i] + upperNeedle.substr(i + 1);\n                if (cmp(key[i], lowerNeedle[i]) < 0)\n                    return key.substr(0, i) + lowerNeedle[i] + upperNeedle.substr(i + 1);\n                if (llp >= 0)\n                    return key.substr(0, llp) + lowerKey[llp] + upperNeedle.substr(llp + 1);\n                return null;\n            }\n            if (cmp(key[i], lwrKeyChar) < 0)\n                llp = i;\n        }\n        if (length < lowerNeedle.length && dir === \"next\")\n            return key + upperNeedle.substr(key.length);\n        if (length < key.length && dir === \"prev\")\n            return key.substr(0, upperNeedle.length);\n        return (llp < 0 ? null : key.substr(0, llp) + lowerNeedle[llp] + upperNeedle.substr(llp + 1));\n    }\n    function addIgnoreCaseAlgorithm(whereClause, match, needles, suffix) {\n        var upper, lower, compare, upperNeedles, lowerNeedles, direction, nextKeySuffix, needlesLen = needles.length;\n        if (!needles.every(function (s) { return typeof s === 'string'; })) {\n            return fail(whereClause, STRING_EXPECTED);\n        }\n        function initDirection(dir) {\n            upper = upperFactory(dir);\n            lower = lowerFactory(dir);\n            compare = (dir === \"next\" ? simpleCompare : simpleCompareReverse);\n            var needleBounds = needles.map(function (needle) {\n                return { lower: lower(needle), upper: upper(needle) };\n            }).sort(function (a, b) {\n                return compare(a.lower, b.lower);\n            });\n            upperNeedles = needleBounds.map(function (nb) { return nb.upper; });\n            lowerNeedles = needleBounds.map(function (nb) { return nb.lower; });\n            direction = dir;\n            nextKeySuffix = (dir === \"next\" ? \"\" : suffix);\n        }\n        initDirection(\"next\");\n        var c = new whereClause.Collection(whereClause, function () { return createRange(upperNeedles[0], lowerNeedles[needlesLen - 1] + suffix); });\n        c._ondirectionchange = function (direction) {\n            initDirection(direction);\n        };\n        var firstPossibleNeedle = 0;\n        c._addAlgorithm(function (cursor, advance, resolve) {\n            var key = cursor.key;\n            if (typeof key !== 'string')\n                return false;\n            var lowerKey = lower(key);\n            if (match(lowerKey, lowerNeedles, firstPossibleNeedle)) {\n                return true;\n            }\n            else {\n                var lowestPossibleCasing = null;\n                for (var i = firstPossibleNeedle; i < needlesLen; ++i) {\n                    var casing = nextCasing(key, lowerKey, upperNeedles[i], lowerNeedles[i], compare, direction);\n                    if (casing === null && lowestPossibleCasing === null)\n                        firstPossibleNeedle = i + 1;\n                    else if (lowestPossibleCasing === null || compare(lowestPossibleCasing, casing) > 0) {\n                        lowestPossibleCasing = casing;\n                    }\n                }\n                if (lowestPossibleCasing !== null) {\n                    advance(function () { cursor.continue(lowestPossibleCasing + nextKeySuffix); });\n                }\n                else {\n                    advance(resolve);\n                }\n                return false;\n            }\n        });\n        return c;\n    }\n    function createRange(lower, upper, lowerOpen, upperOpen) {\n        return {\n            type: 2 ,\n            lower: lower,\n            upper: upper,\n            lowerOpen: lowerOpen,\n            upperOpen: upperOpen\n        };\n    }\n    function rangeEqual(value) {\n        return {\n            type: 1 ,\n            lower: value,\n            upper: value\n        };\n    }\n\n    var WhereClause =  (function () {\n        function WhereClause() {\n        }\n        Object.defineProperty(WhereClause.prototype, \"Collection\", {\n            get: function () {\n                return this._ctx.table.db.Collection;\n            },\n            enumerable: false,\n            configurable: true\n        });\n        WhereClause.prototype.between = function (lower, upper, includeLower, includeUpper) {\n            includeLower = includeLower !== false;\n            includeUpper = includeUpper === true;\n            try {\n                if ((this._cmp(lower, upper) > 0) ||\n                    (this._cmp(lower, upper) === 0 && (includeLower || includeUpper) && !(includeLower && includeUpper)))\n                    return emptyCollection(this);\n                return new this.Collection(this, function () { return createRange(lower, upper, !includeLower, !includeUpper); });\n            }\n            catch (e) {\n                return fail(this, INVALID_KEY_ARGUMENT);\n            }\n        };\n        WhereClause.prototype.equals = function (value) {\n            if (value == null)\n                return fail(this, INVALID_KEY_ARGUMENT);\n            return new this.Collection(this, function () { return rangeEqual(value); });\n        };\n        WhereClause.prototype.above = function (value) {\n            if (value == null)\n                return fail(this, INVALID_KEY_ARGUMENT);\n            return new this.Collection(this, function () { return createRange(value, undefined, true); });\n        };\n        WhereClause.prototype.aboveOrEqual = function (value) {\n            if (value == null)\n                return fail(this, INVALID_KEY_ARGUMENT);\n            return new this.Collection(this, function () { return createRange(value, undefined, false); });\n        };\n        WhereClause.prototype.below = function (value) {\n            if (value == null)\n                return fail(this, INVALID_KEY_ARGUMENT);\n            return new this.Collection(this, function () { return createRange(undefined, value, false, true); });\n        };\n        WhereClause.prototype.belowOrEqual = function (value) {\n            if (value == null)\n                return fail(this, INVALID_KEY_ARGUMENT);\n            return new this.Collection(this, function () { return createRange(undefined, value); });\n        };\n        WhereClause.prototype.startsWith = function (str) {\n            if (typeof str !== 'string')\n                return fail(this, STRING_EXPECTED);\n            return this.between(str, str + maxString, true, true);\n        };\n        WhereClause.prototype.startsWithIgnoreCase = function (str) {\n            if (str === \"\")\n                return this.startsWith(str);\n            return addIgnoreCaseAlgorithm(this, function (x, a) { return x.indexOf(a[0]) === 0; }, [str], maxString);\n        };\n        WhereClause.prototype.equalsIgnoreCase = function (str) {\n            return addIgnoreCaseAlgorithm(this, function (x, a) { return x === a[0]; }, [str], \"\");\n        };\n        WhereClause.prototype.anyOfIgnoreCase = function () {\n            var set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n            if (set.length === 0)\n                return emptyCollection(this);\n            return addIgnoreCaseAlgorithm(this, function (x, a) { return a.indexOf(x) !== -1; }, set, \"\");\n        };\n        WhereClause.prototype.startsWithAnyOfIgnoreCase = function () {\n            var set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n            if (set.length === 0)\n                return emptyCollection(this);\n            return addIgnoreCaseAlgorithm(this, function (x, a) { return a.some(function (n) { return x.indexOf(n) === 0; }); }, set, maxString);\n        };\n        WhereClause.prototype.anyOf = function () {\n            var _this = this;\n            var set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n            var compare = this._cmp;\n            try {\n                set.sort(compare);\n            }\n            catch (e) {\n                return fail(this, INVALID_KEY_ARGUMENT);\n            }\n            if (set.length === 0)\n                return emptyCollection(this);\n            var c = new this.Collection(this, function () { return createRange(set[0], set[set.length - 1]); });\n            c._ondirectionchange = function (direction) {\n                compare = (direction === \"next\" ?\n                    _this._ascending :\n                    _this._descending);\n                set.sort(compare);\n            };\n            var i = 0;\n            c._addAlgorithm(function (cursor, advance, resolve) {\n                var key = cursor.key;\n                while (compare(key, set[i]) > 0) {\n                    ++i;\n                    if (i === set.length) {\n                        advance(resolve);\n                        return false;\n                    }\n                }\n                if (compare(key, set[i]) === 0) {\n                    return true;\n                }\n                else {\n                    advance(function () { cursor.continue(set[i]); });\n                    return false;\n                }\n            });\n            return c;\n        };\n        WhereClause.prototype.notEqual = function (value) {\n            return this.inAnyRange([[minKey, value], [value, this.db._maxKey]], { includeLowers: false, includeUppers: false });\n        };\n        WhereClause.prototype.noneOf = function () {\n            var set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n            if (set.length === 0)\n                return new this.Collection(this);\n            try {\n                set.sort(this._ascending);\n            }\n            catch (e) {\n                return fail(this, INVALID_KEY_ARGUMENT);\n            }\n            var ranges = set.reduce(function (res, val) { return res ?\n                res.concat([[res[res.length - 1][1], val]]) :\n                [[minKey, val]]; }, null);\n            ranges.push([set[set.length - 1], this.db._maxKey]);\n            return this.inAnyRange(ranges, { includeLowers: false, includeUppers: false });\n        };\n        WhereClause.prototype.inAnyRange = function (ranges, options) {\n            var _this = this;\n            var cmp = this._cmp, ascending = this._ascending, descending = this._descending, min = this._min, max = this._max;\n            if (ranges.length === 0)\n                return emptyCollection(this);\n            if (!ranges.every(function (range) {\n                return range[0] !== undefined &&\n                    range[1] !== undefined &&\n                    ascending(range[0], range[1]) <= 0;\n            })) {\n                return fail(this, \"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower\", exceptions.InvalidArgument);\n            }\n            var includeLowers = !options || options.includeLowers !== false;\n            var includeUppers = options && options.includeUppers === true;\n            function addRange(ranges, newRange) {\n                var i = 0, l = ranges.length;\n                for (; i < l; ++i) {\n                    var range = ranges[i];\n                    if (cmp(newRange[0], range[1]) < 0 && cmp(newRange[1], range[0]) > 0) {\n                        range[0] = min(range[0], newRange[0]);\n                        range[1] = max(range[1], newRange[1]);\n                        break;\n                    }\n                }\n                if (i === l)\n                    ranges.push(newRange);\n                return ranges;\n            }\n            var sortDirection = ascending;\n            function rangeSorter(a, b) { return sortDirection(a[0], b[0]); }\n            var set;\n            try {\n                set = ranges.reduce(addRange, []);\n                set.sort(rangeSorter);\n            }\n            catch (ex) {\n                return fail(this, INVALID_KEY_ARGUMENT);\n            }\n            var rangePos = 0;\n            var keyIsBeyondCurrentEntry = includeUppers ?\n                function (key) { return ascending(key, set[rangePos][1]) > 0; } :\n                function (key) { return ascending(key, set[rangePos][1]) >= 0; };\n            var keyIsBeforeCurrentEntry = includeLowers ?\n                function (key) { return descending(key, set[rangePos][0]) > 0; } :\n                function (key) { return descending(key, set[rangePos][0]) >= 0; };\n            function keyWithinCurrentRange(key) {\n                return !keyIsBeyondCurrentEntry(key) && !keyIsBeforeCurrentEntry(key);\n            }\n            var checkKey = keyIsBeyondCurrentEntry;\n            var c = new this.Collection(this, function () { return createRange(set[0][0], set[set.length - 1][1], !includeLowers, !includeUppers); });\n            c._ondirectionchange = function (direction) {\n                if (direction === \"next\") {\n                    checkKey = keyIsBeyondCurrentEntry;\n                    sortDirection = ascending;\n                }\n                else {\n                    checkKey = keyIsBeforeCurrentEntry;\n                    sortDirection = descending;\n                }\n                set.sort(rangeSorter);\n            };\n            c._addAlgorithm(function (cursor, advance, resolve) {\n                var key = cursor.key;\n                while (checkKey(key)) {\n                    ++rangePos;\n                    if (rangePos === set.length) {\n                        advance(resolve);\n                        return false;\n                    }\n                }\n                if (keyWithinCurrentRange(key)) {\n                    return true;\n                }\n                else if (_this._cmp(key, set[rangePos][1]) === 0 || _this._cmp(key, set[rangePos][0]) === 0) {\n                    return false;\n                }\n                else {\n                    advance(function () {\n                        if (sortDirection === ascending)\n                            cursor.continue(set[rangePos][0]);\n                        else\n                            cursor.continue(set[rangePos][1]);\n                    });\n                    return false;\n                }\n            });\n            return c;\n        };\n        WhereClause.prototype.startsWithAnyOf = function () {\n            var set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n            if (!set.every(function (s) { return typeof s === 'string'; })) {\n                return fail(this, \"startsWithAnyOf() only works with strings\");\n            }\n            if (set.length === 0)\n                return emptyCollection(this);\n            return this.inAnyRange(set.map(function (str) { return [str, str + maxString]; }));\n        };\n        return WhereClause;\n    }());\n\n    function createWhereClauseConstructor(db) {\n        return makeClassConstructor(WhereClause.prototype, function WhereClause(table, index, orCollection) {\n            this.db = db;\n            this._ctx = {\n                table: table,\n                index: index === \":id\" ? null : index,\n                or: orCollection\n            };\n            this._cmp = this._ascending = cmp;\n            this._descending = function (a, b) { return cmp(b, a); };\n            this._max = function (a, b) { return cmp(a, b) > 0 ? a : b; };\n            this._min = function (a, b) { return cmp(a, b) < 0 ? a : b; };\n            this._IDBKeyRange = db._deps.IDBKeyRange;\n            if (!this._IDBKeyRange)\n                throw new exceptions.MissingAPI();\n        });\n    }\n\n    function eventRejectHandler(reject) {\n        return wrap(function (event) {\n            preventDefault(event);\n            reject(event.target.error);\n            return false;\n        });\n    }\n    function preventDefault(event) {\n        if (event.stopPropagation)\n            event.stopPropagation();\n        if (event.preventDefault)\n            event.preventDefault();\n    }\n\n    var DEXIE_STORAGE_MUTATED_EVENT_NAME = 'storagemutated';\n    var STORAGE_MUTATED_DOM_EVENT_NAME = 'x-storagemutated-1';\n    var globalEvents = Events(null, DEXIE_STORAGE_MUTATED_EVENT_NAME);\n\n    var Transaction =  (function () {\n        function Transaction() {\n        }\n        Transaction.prototype._lock = function () {\n            assert(!PSD.global);\n            ++this._reculock;\n            if (this._reculock === 1 && !PSD.global)\n                PSD.lockOwnerFor = this;\n            return this;\n        };\n        Transaction.prototype._unlock = function () {\n            assert(!PSD.global);\n            if (--this._reculock === 0) {\n                if (!PSD.global)\n                    PSD.lockOwnerFor = null;\n                while (this._blockedFuncs.length > 0 && !this._locked()) {\n                    var fnAndPSD = this._blockedFuncs.shift();\n                    try {\n                        usePSD(fnAndPSD[1], fnAndPSD[0]);\n                    }\n                    catch (e) { }\n                }\n            }\n            return this;\n        };\n        Transaction.prototype._locked = function () {\n            return this._reculock && PSD.lockOwnerFor !== this;\n        };\n        Transaction.prototype.create = function (idbtrans) {\n            var _this = this;\n            if (!this.mode)\n                return this;\n            var idbdb = this.db.idbdb;\n            var dbOpenError = this.db._state.dbOpenError;\n            assert(!this.idbtrans);\n            if (!idbtrans && !idbdb) {\n                switch (dbOpenError && dbOpenError.name) {\n                    case \"DatabaseClosedError\":\n                        throw new exceptions.DatabaseClosed(dbOpenError);\n                    case \"MissingAPIError\":\n                        throw new exceptions.MissingAPI(dbOpenError.message, dbOpenError);\n                    default:\n                        throw new exceptions.OpenFailed(dbOpenError);\n                }\n            }\n            if (!this.active)\n                throw new exceptions.TransactionInactive();\n            assert(this._completion._state === null);\n            idbtrans = this.idbtrans = idbtrans ||\n                (this.db.core\n                    ? this.db.core.transaction(this.storeNames, this.mode, { durability: this.chromeTransactionDurability })\n                    : idbdb.transaction(this.storeNames, this.mode, { durability: this.chromeTransactionDurability }));\n            idbtrans.onerror = wrap(function (ev) {\n                preventDefault(ev);\n                _this._reject(idbtrans.error);\n            });\n            idbtrans.onabort = wrap(function (ev) {\n                preventDefault(ev);\n                _this.active && _this._reject(new exceptions.Abort(idbtrans.error));\n                _this.active = false;\n                _this.on(\"abort\").fire(ev);\n            });\n            idbtrans.oncomplete = wrap(function () {\n                _this.active = false;\n                _this._resolve();\n                if ('mutatedParts' in idbtrans) {\n                    globalEvents.storagemutated.fire(idbtrans[\"mutatedParts\"]);\n                }\n            });\n            return this;\n        };\n        Transaction.prototype._promise = function (mode, fn, bWriteLock) {\n            var _this = this;\n            if (mode === 'readwrite' && this.mode !== 'readwrite')\n                return rejection(new exceptions.ReadOnly(\"Transaction is readonly\"));\n            if (!this.active)\n                return rejection(new exceptions.TransactionInactive());\n            if (this._locked()) {\n                return new DexiePromise(function (resolve, reject) {\n                    _this._blockedFuncs.push([function () {\n                            _this._promise(mode, fn, bWriteLock).then(resolve, reject);\n                        }, PSD]);\n                });\n            }\n            else if (bWriteLock) {\n                return newScope(function () {\n                    var p = new DexiePromise(function (resolve, reject) {\n                        _this._lock();\n                        var rv = fn(resolve, reject, _this);\n                        if (rv && rv.then)\n                            rv.then(resolve, reject);\n                    });\n                    p.finally(function () { return _this._unlock(); });\n                    p._lib = true;\n                    return p;\n                });\n            }\n            else {\n                var p = new DexiePromise(function (resolve, reject) {\n                    var rv = fn(resolve, reject, _this);\n                    if (rv && rv.then)\n                        rv.then(resolve, reject);\n                });\n                p._lib = true;\n                return p;\n            }\n        };\n        Transaction.prototype._root = function () {\n            return this.parent ? this.parent._root() : this;\n        };\n        Transaction.prototype.waitFor = function (promiseLike) {\n            var root = this._root();\n            var promise = DexiePromise.resolve(promiseLike);\n            if (root._waitingFor) {\n                root._waitingFor = root._waitingFor.then(function () { return promise; });\n            }\n            else {\n                root._waitingFor = promise;\n                root._waitingQueue = [];\n                var store = root.idbtrans.objectStore(root.storeNames[0]);\n                (function spin() {\n                    ++root._spinCount;\n                    while (root._waitingQueue.length)\n                        (root._waitingQueue.shift())();\n                    if (root._waitingFor)\n                        store.get(-Infinity).onsuccess = spin;\n                }());\n            }\n            var currentWaitPromise = root._waitingFor;\n            return new DexiePromise(function (resolve, reject) {\n                promise.then(function (res) { return root._waitingQueue.push(wrap(resolve.bind(null, res))); }, function (err) { return root._waitingQueue.push(wrap(reject.bind(null, err))); }).finally(function () {\n                    if (root._waitingFor === currentWaitPromise) {\n                        root._waitingFor = null;\n                    }\n                });\n            });\n        };\n        Transaction.prototype.abort = function () {\n            if (this.active) {\n                this.active = false;\n                if (this.idbtrans)\n                    this.idbtrans.abort();\n                this._reject(new exceptions.Abort());\n            }\n        };\n        Transaction.prototype.table = function (tableName) {\n            var memoizedTables = (this._memoizedTables || (this._memoizedTables = {}));\n            if (hasOwn(memoizedTables, tableName))\n                return memoizedTables[tableName];\n            var tableSchema = this.schema[tableName];\n            if (!tableSchema) {\n                throw new exceptions.NotFound(\"Table \" + tableName + \" not part of transaction\");\n            }\n            var transactionBoundTable = new this.db.Table(tableName, tableSchema, this);\n            transactionBoundTable.core = this.db.core.table(tableName);\n            memoizedTables[tableName] = transactionBoundTable;\n            return transactionBoundTable;\n        };\n        return Transaction;\n    }());\n\n    function createTransactionConstructor(db) {\n        return makeClassConstructor(Transaction.prototype, function Transaction(mode, storeNames, dbschema, chromeTransactionDurability, parent) {\n            var _this = this;\n            this.db = db;\n            this.mode = mode;\n            this.storeNames = storeNames;\n            this.schema = dbschema;\n            this.chromeTransactionDurability = chromeTransactionDurability;\n            this.idbtrans = null;\n            this.on = Events(this, \"complete\", \"error\", \"abort\");\n            this.parent = parent || null;\n            this.active = true;\n            this._reculock = 0;\n            this._blockedFuncs = [];\n            this._resolve = null;\n            this._reject = null;\n            this._waitingFor = null;\n            this._waitingQueue = null;\n            this._spinCount = 0;\n            this._completion = new DexiePromise(function (resolve, reject) {\n                _this._resolve = resolve;\n                _this._reject = reject;\n            });\n            this._completion.then(function () {\n                _this.active = false;\n                _this.on.complete.fire();\n            }, function (e) {\n                var wasActive = _this.active;\n                _this.active = false;\n                _this.on.error.fire(e);\n                _this.parent ?\n                    _this.parent._reject(e) :\n                    wasActive && _this.idbtrans && _this.idbtrans.abort();\n                return rejection(e);\n            });\n        });\n    }\n\n    function createIndexSpec(name, keyPath, unique, multi, auto, compound, isPrimKey) {\n        return {\n            name: name,\n            keyPath: keyPath,\n            unique: unique,\n            multi: multi,\n            auto: auto,\n            compound: compound,\n            src: (unique && !isPrimKey ? '&' : '') + (multi ? '*' : '') + (auto ? \"++\" : \"\") + nameFromKeyPath(keyPath)\n        };\n    }\n    function nameFromKeyPath(keyPath) {\n        return typeof keyPath === 'string' ?\n            keyPath :\n            keyPath ? ('[' + [].join.call(keyPath, '+') + ']') : \"\";\n    }\n\n    function createTableSchema(name, primKey, indexes) {\n        return {\n            name: name,\n            primKey: primKey,\n            indexes: indexes,\n            mappedClass: null,\n            idxByName: arrayToObject(indexes, function (index) { return [index.name, index]; })\n        };\n    }\n\n    function safariMultiStoreFix(storeNames) {\n        return storeNames.length === 1 ? storeNames[0] : storeNames;\n    }\n    var getMaxKey = function (IdbKeyRange) {\n        try {\n            IdbKeyRange.only([[]]);\n            getMaxKey = function () { return [[]]; };\n            return [[]];\n        }\n        catch (e) {\n            getMaxKey = function () { return maxString; };\n            return maxString;\n        }\n    };\n\n    function getKeyExtractor(keyPath) {\n        if (keyPath == null) {\n            return function () { return undefined; };\n        }\n        else if (typeof keyPath === 'string') {\n            return getSinglePathKeyExtractor(keyPath);\n        }\n        else {\n            return function (obj) { return getByKeyPath(obj, keyPath); };\n        }\n    }\n    function getSinglePathKeyExtractor(keyPath) {\n        var split = keyPath.split('.');\n        if (split.length === 1) {\n            return function (obj) { return obj[keyPath]; };\n        }\n        else {\n            return function (obj) { return getByKeyPath(obj, keyPath); };\n        }\n    }\n\n    function arrayify(arrayLike) {\n        return [].slice.call(arrayLike);\n    }\n    var _id_counter = 0;\n    function getKeyPathAlias(keyPath) {\n        return keyPath == null ?\n            \":id\" :\n            typeof keyPath === 'string' ?\n                keyPath :\n                \"[\".concat(keyPath.join('+'), \"]\");\n    }\n    function createDBCore(db, IdbKeyRange, tmpTrans) {\n        function extractSchema(db, trans) {\n            var tables = arrayify(db.objectStoreNames);\n            return {\n                schema: {\n                    name: db.name,\n                    tables: tables.map(function (table) { return trans.objectStore(table); }).map(function (store) {\n                        var keyPath = store.keyPath, autoIncrement = store.autoIncrement;\n                        var compound = isArray(keyPath);\n                        var outbound = keyPath == null;\n                        var indexByKeyPath = {};\n                        var result = {\n                            name: store.name,\n                            primaryKey: {\n                                name: null,\n                                isPrimaryKey: true,\n                                outbound: outbound,\n                                compound: compound,\n                                keyPath: keyPath,\n                                autoIncrement: autoIncrement,\n                                unique: true,\n                                extractKey: getKeyExtractor(keyPath)\n                            },\n                            indexes: arrayify(store.indexNames).map(function (indexName) { return store.index(indexName); })\n                                .map(function (index) {\n                                var name = index.name, unique = index.unique, multiEntry = index.multiEntry, keyPath = index.keyPath;\n                                var compound = isArray(keyPath);\n                                var result = {\n                                    name: name,\n                                    compound: compound,\n                                    keyPath: keyPath,\n                                    unique: unique,\n                                    multiEntry: multiEntry,\n                                    extractKey: getKeyExtractor(keyPath)\n                                };\n                                indexByKeyPath[getKeyPathAlias(keyPath)] = result;\n                                return result;\n                            }),\n                            getIndexByKeyPath: function (keyPath) { return indexByKeyPath[getKeyPathAlias(keyPath)]; }\n                        };\n                        indexByKeyPath[\":id\"] = result.primaryKey;\n                        if (keyPath != null) {\n                            indexByKeyPath[getKeyPathAlias(keyPath)] = result.primaryKey;\n                        }\n                        return result;\n                    })\n                },\n                hasGetAll: tables.length > 0 && ('getAll' in trans.objectStore(tables[0])) &&\n                    !(typeof navigator !== 'undefined' && /Safari/.test(navigator.userAgent) &&\n                        !/(Chrome\\/|Edge\\/)/.test(navigator.userAgent) &&\n                        [].concat(navigator.userAgent.match(/Safari\\/(\\d*)/))[1] < 604)\n            };\n        }\n        function makeIDBKeyRange(range) {\n            if (range.type === 3 )\n                return null;\n            if (range.type === 4 )\n                throw new Error(\"Cannot convert never type to IDBKeyRange\");\n            var lower = range.lower, upper = range.upper, lowerOpen = range.lowerOpen, upperOpen = range.upperOpen;\n            var idbRange = lower === undefined ?\n                upper === undefined ?\n                    null :\n                    IdbKeyRange.upperBound(upper, !!upperOpen) :\n                upper === undefined ?\n                    IdbKeyRange.lowerBound(lower, !!lowerOpen) :\n                    IdbKeyRange.bound(lower, upper, !!lowerOpen, !!upperOpen);\n            return idbRange;\n        }\n        function createDbCoreTable(tableSchema) {\n            var tableName = tableSchema.name;\n            function mutate(_a) {\n                var trans = _a.trans, type = _a.type, keys = _a.keys, values = _a.values, range = _a.range;\n                return new Promise(function (resolve, reject) {\n                    resolve = wrap(resolve);\n                    var store = trans.objectStore(tableName);\n                    var outbound = store.keyPath == null;\n                    var isAddOrPut = type === \"put\" || type === \"add\";\n                    if (!isAddOrPut && type !== 'delete' && type !== 'deleteRange')\n                        throw new Error(\"Invalid operation type: \" + type);\n                    var length = (keys || values || { length: 1 }).length;\n                    if (keys && values && keys.length !== values.length) {\n                        throw new Error(\"Given keys array must have same length as given values array.\");\n                    }\n                    if (length === 0)\n                        return resolve({ numFailures: 0, failures: {}, results: [], lastResult: undefined });\n                    var req;\n                    var reqs = [];\n                    var failures = [];\n                    var numFailures = 0;\n                    var errorHandler = function (event) {\n                        ++numFailures;\n                        preventDefault(event);\n                    };\n                    if (type === 'deleteRange') {\n                        if (range.type === 4 )\n                            return resolve({ numFailures: numFailures, failures: failures, results: [], lastResult: undefined });\n                        if (range.type === 3 )\n                            reqs.push(req = store.clear());\n                        else\n                            reqs.push(req = store.delete(makeIDBKeyRange(range)));\n                    }\n                    else {\n                        var _a = isAddOrPut ?\n                            outbound ?\n                                [values, keys] :\n                                [values, null] :\n                            [keys, null], args1 = _a[0], args2 = _a[1];\n                        if (isAddOrPut) {\n                            for (var i = 0; i < length; ++i) {\n                                reqs.push(req = (args2 && args2[i] !== undefined ?\n                                    store[type](args1[i], args2[i]) :\n                                    store[type](args1[i])));\n                                req.onerror = errorHandler;\n                            }\n                        }\n                        else {\n                            for (var i = 0; i < length; ++i) {\n                                reqs.push(req = store[type](args1[i]));\n                                req.onerror = errorHandler;\n                            }\n                        }\n                    }\n                    var done = function (event) {\n                        var lastResult = event.target.result;\n                        reqs.forEach(function (req, i) { return req.error != null && (failures[i] = req.error); });\n                        resolve({\n                            numFailures: numFailures,\n                            failures: failures,\n                            results: type === \"delete\" ? keys : reqs.map(function (req) { return req.result; }),\n                            lastResult: lastResult\n                        });\n                    };\n                    req.onerror = function (event) {\n                        errorHandler(event);\n                        done(event);\n                    };\n                    req.onsuccess = done;\n                });\n            }\n            function openCursor(_a) {\n                var trans = _a.trans, values = _a.values, query = _a.query, reverse = _a.reverse, unique = _a.unique;\n                return new Promise(function (resolve, reject) {\n                    resolve = wrap(resolve);\n                    var index = query.index, range = query.range;\n                    var store = trans.objectStore(tableName);\n                    var source = index.isPrimaryKey ?\n                        store :\n                        store.index(index.name);\n                    var direction = reverse ?\n                        unique ?\n                            \"prevunique\" :\n                            \"prev\" :\n                        unique ?\n                            \"nextunique\" :\n                            \"next\";\n                    var req = values || !('openKeyCursor' in source) ?\n                        source.openCursor(makeIDBKeyRange(range), direction) :\n                        source.openKeyCursor(makeIDBKeyRange(range), direction);\n                    req.onerror = eventRejectHandler(reject);\n                    req.onsuccess = wrap(function (ev) {\n                        var cursor = req.result;\n                        if (!cursor) {\n                            resolve(null);\n                            return;\n                        }\n                        cursor.___id = ++_id_counter;\n                        cursor.done = false;\n                        var _cursorContinue = cursor.continue.bind(cursor);\n                        var _cursorContinuePrimaryKey = cursor.continuePrimaryKey;\n                        if (_cursorContinuePrimaryKey)\n                            _cursorContinuePrimaryKey = _cursorContinuePrimaryKey.bind(cursor);\n                        var _cursorAdvance = cursor.advance.bind(cursor);\n                        var doThrowCursorIsNotStarted = function () { throw new Error(\"Cursor not started\"); };\n                        var doThrowCursorIsStopped = function () { throw new Error(\"Cursor not stopped\"); };\n                        cursor.trans = trans;\n                        cursor.stop = cursor.continue = cursor.continuePrimaryKey = cursor.advance = doThrowCursorIsNotStarted;\n                        cursor.fail = wrap(reject);\n                        cursor.next = function () {\n                            var _this = this;\n                            var gotOne = 1;\n                            return this.start(function () { return gotOne-- ? _this.continue() : _this.stop(); }).then(function () { return _this; });\n                        };\n                        cursor.start = function (callback) {\n                            var iterationPromise = new Promise(function (resolveIteration, rejectIteration) {\n                                resolveIteration = wrap(resolveIteration);\n                                req.onerror = eventRejectHandler(rejectIteration);\n                                cursor.fail = rejectIteration;\n                                cursor.stop = function (value) {\n                                    cursor.stop = cursor.continue = cursor.continuePrimaryKey = cursor.advance = doThrowCursorIsStopped;\n                                    resolveIteration(value);\n                                };\n                            });\n                            var guardedCallback = function () {\n                                if (req.result) {\n                                    try {\n                                        callback();\n                                    }\n                                    catch (err) {\n                                        cursor.fail(err);\n                                    }\n                                }\n                                else {\n                                    cursor.done = true;\n                                    cursor.start = function () { throw new Error(\"Cursor behind last entry\"); };\n                                    cursor.stop();\n                                }\n                            };\n                            req.onsuccess = wrap(function (ev) {\n                                req.onsuccess = guardedCallback;\n                                guardedCallback();\n                            });\n                            cursor.continue = _cursorContinue;\n                            cursor.continuePrimaryKey = _cursorContinuePrimaryKey;\n                            cursor.advance = _cursorAdvance;\n                            guardedCallback();\n                            return iterationPromise;\n                        };\n                        resolve(cursor);\n                    }, reject);\n                });\n            }\n            function query(hasGetAll) {\n                return function (request) {\n                    return new Promise(function (resolve, reject) {\n                        resolve = wrap(resolve);\n                        var trans = request.trans, values = request.values, limit = request.limit, query = request.query;\n                        var nonInfinitLimit = limit === Infinity ? undefined : limit;\n                        var index = query.index, range = query.range;\n                        var store = trans.objectStore(tableName);\n                        var source = index.isPrimaryKey ? store : store.index(index.name);\n                        var idbKeyRange = makeIDBKeyRange(range);\n                        if (limit === 0)\n                            return resolve({ result: [] });\n                        if (hasGetAll) {\n                            var req = values ?\n                                source.getAll(idbKeyRange, nonInfinitLimit) :\n                                source.getAllKeys(idbKeyRange, nonInfinitLimit);\n                            req.onsuccess = function (event) { return resolve({ result: event.target.result }); };\n                            req.onerror = eventRejectHandler(reject);\n                        }\n                        else {\n                            var count_1 = 0;\n                            var req_1 = values || !('openKeyCursor' in source) ?\n                                source.openCursor(idbKeyRange) :\n                                source.openKeyCursor(idbKeyRange);\n                            var result_1 = [];\n                            req_1.onsuccess = function (event) {\n                                var cursor = req_1.result;\n                                if (!cursor)\n                                    return resolve({ result: result_1 });\n                                result_1.push(values ? cursor.value : cursor.primaryKey);\n                                if (++count_1 === limit)\n                                    return resolve({ result: result_1 });\n                                cursor.continue();\n                            };\n                            req_1.onerror = eventRejectHandler(reject);\n                        }\n                    });\n                };\n            }\n            return {\n                name: tableName,\n                schema: tableSchema,\n                mutate: mutate,\n                getMany: function (_a) {\n                    var trans = _a.trans, keys = _a.keys;\n                    return new Promise(function (resolve, reject) {\n                        resolve = wrap(resolve);\n                        var store = trans.objectStore(tableName);\n                        var length = keys.length;\n                        var result = new Array(length);\n                        var keyCount = 0;\n                        var callbackCount = 0;\n                        var req;\n                        var successHandler = function (event) {\n                            var req = event.target;\n                            if ((result[req._pos] = req.result) != null)\n                                ;\n                            if (++callbackCount === keyCount)\n                                resolve(result);\n                        };\n                        var errorHandler = eventRejectHandler(reject);\n                        for (var i = 0; i < length; ++i) {\n                            var key = keys[i];\n                            if (key != null) {\n                                req = store.get(keys[i]);\n                                req._pos = i;\n                                req.onsuccess = successHandler;\n                                req.onerror = errorHandler;\n                                ++keyCount;\n                            }\n                        }\n                        if (keyCount === 0)\n                            resolve(result);\n                    });\n                },\n                get: function (_a) {\n                    var trans = _a.trans, key = _a.key;\n                    return new Promise(function (resolve, reject) {\n                        resolve = wrap(resolve);\n                        var store = trans.objectStore(tableName);\n                        var req = store.get(key);\n                        req.onsuccess = function (event) { return resolve(event.target.result); };\n                        req.onerror = eventRejectHandler(reject);\n                    });\n                },\n                query: query(hasGetAll),\n                openCursor: openCursor,\n                count: function (_a) {\n                    var query = _a.query, trans = _a.trans;\n                    var index = query.index, range = query.range;\n                    return new Promise(function (resolve, reject) {\n                        var store = trans.objectStore(tableName);\n                        var source = index.isPrimaryKey ? store : store.index(index.name);\n                        var idbKeyRange = makeIDBKeyRange(range);\n                        var req = idbKeyRange ? source.count(idbKeyRange) : source.count();\n                        req.onsuccess = wrap(function (ev) { return resolve(ev.target.result); });\n                        req.onerror = eventRejectHandler(reject);\n                    });\n                }\n            };\n        }\n        var _a = extractSchema(db, tmpTrans), schema = _a.schema, hasGetAll = _a.hasGetAll;\n        var tables = schema.tables.map(function (tableSchema) { return createDbCoreTable(tableSchema); });\n        var tableMap = {};\n        tables.forEach(function (table) { return tableMap[table.name] = table; });\n        return {\n            stack: \"dbcore\",\n            transaction: db.transaction.bind(db),\n            table: function (name) {\n                var result = tableMap[name];\n                if (!result)\n                    throw new Error(\"Table '\".concat(name, \"' not found\"));\n                return tableMap[name];\n            },\n            MIN_KEY: -Infinity,\n            MAX_KEY: getMaxKey(IdbKeyRange),\n            schema: schema\n        };\n    }\n\n    function createMiddlewareStack(stackImpl, middlewares) {\n        return middlewares.reduce(function (down, _a) {\n            var create = _a.create;\n            return (__assign(__assign({}, down), create(down)));\n        }, stackImpl);\n    }\n    function createMiddlewareStacks(middlewares, idbdb, _a, tmpTrans) {\n        var IDBKeyRange = _a.IDBKeyRange; _a.indexedDB;\n        var dbcore = createMiddlewareStack(createDBCore(idbdb, IDBKeyRange, tmpTrans), middlewares.dbcore);\n        return {\n            dbcore: dbcore\n        };\n    }\n    function generateMiddlewareStacks(db, tmpTrans) {\n        var idbdb = tmpTrans.db;\n        var stacks = createMiddlewareStacks(db._middlewares, idbdb, db._deps, tmpTrans);\n        db.core = stacks.dbcore;\n        db.tables.forEach(function (table) {\n            var tableName = table.name;\n            if (db.core.schema.tables.some(function (tbl) { return tbl.name === tableName; })) {\n                table.core = db.core.table(tableName);\n                if (db[tableName] instanceof db.Table) {\n                    db[tableName].core = table.core;\n                }\n            }\n        });\n    }\n\n    function setApiOnPlace(db, objs, tableNames, dbschema) {\n        tableNames.forEach(function (tableName) {\n            var schema = dbschema[tableName];\n            objs.forEach(function (obj) {\n                var propDesc = getPropertyDescriptor(obj, tableName);\n                if (!propDesc || (\"value\" in propDesc && propDesc.value === undefined)) {\n                    if (obj === db.Transaction.prototype || obj instanceof db.Transaction) {\n                        setProp(obj, tableName, {\n                            get: function () { return this.table(tableName); },\n                            set: function (value) {\n                                defineProperty(this, tableName, { value: value, writable: true, configurable: true, enumerable: true });\n                            }\n                        });\n                    }\n                    else {\n                        obj[tableName] = new db.Table(tableName, schema);\n                    }\n                }\n            });\n        });\n    }\n    function removeTablesApi(db, objs) {\n        objs.forEach(function (obj) {\n            for (var key in obj) {\n                if (obj[key] instanceof db.Table)\n                    delete obj[key];\n            }\n        });\n    }\n    function lowerVersionFirst(a, b) {\n        return a._cfg.version - b._cfg.version;\n    }\n    function runUpgraders(db, oldVersion, idbUpgradeTrans, reject) {\n        var globalSchema = db._dbSchema;\n        if (idbUpgradeTrans.objectStoreNames.contains('$meta') && !globalSchema.$meta) {\n            globalSchema.$meta = createTableSchema(\"$meta\", parseIndexSyntax(\"\")[0], []);\n            db._storeNames.push('$meta');\n        }\n        var trans = db._createTransaction('readwrite', db._storeNames, globalSchema);\n        trans.create(idbUpgradeTrans);\n        trans._completion.catch(reject);\n        var rejectTransaction = trans._reject.bind(trans);\n        var transless = PSD.transless || PSD;\n        newScope(function () {\n            PSD.trans = trans;\n            PSD.transless = transless;\n            if (oldVersion === 0) {\n                keys(globalSchema).forEach(function (tableName) {\n                    createTable(idbUpgradeTrans, tableName, globalSchema[tableName].primKey, globalSchema[tableName].indexes);\n                });\n                generateMiddlewareStacks(db, idbUpgradeTrans);\n                DexiePromise.follow(function () { return db.on.populate.fire(trans); }).catch(rejectTransaction);\n            }\n            else {\n                generateMiddlewareStacks(db, idbUpgradeTrans);\n                return getExistingVersion(db, trans, oldVersion)\n                    .then(function (oldVersion) { return updateTablesAndIndexes(db, oldVersion, trans, idbUpgradeTrans); })\n                    .catch(rejectTransaction);\n            }\n        });\n    }\n    function patchCurrentVersion(db, idbUpgradeTrans) {\n        createMissingTables(db._dbSchema, idbUpgradeTrans);\n        if (idbUpgradeTrans.db.version % 10 === 0 && !idbUpgradeTrans.objectStoreNames.contains('$meta')) {\n            idbUpgradeTrans.db.createObjectStore('$meta').add(Math.ceil((idbUpgradeTrans.db.version / 10) - 1), 'version');\n        }\n        var globalSchema = buildGlobalSchema(db, db.idbdb, idbUpgradeTrans);\n        adjustToExistingIndexNames(db, db._dbSchema, idbUpgradeTrans);\n        var diff = getSchemaDiff(globalSchema, db._dbSchema);\n        var _loop_1 = function (tableChange) {\n            if (tableChange.change.length || tableChange.recreate) {\n                console.warn(\"Unable to patch indexes of table \".concat(tableChange.name, \" because it has changes on the type of index or primary key.\"));\n                return { value: void 0 };\n            }\n            var store = idbUpgradeTrans.objectStore(tableChange.name);\n            tableChange.add.forEach(function (idx) {\n                if (debug)\n                    console.debug(\"Dexie upgrade patch: Creating missing index \".concat(tableChange.name, \".\").concat(idx.src));\n                addIndex(store, idx);\n            });\n        };\n        for (var _i = 0, _a = diff.change; _i < _a.length; _i++) {\n            var tableChange = _a[_i];\n            var state_1 = _loop_1(tableChange);\n            if (typeof state_1 === \"object\")\n                return state_1.value;\n        }\n    }\n    function getExistingVersion(db, trans, oldVersion) {\n        if (trans.storeNames.includes('$meta')) {\n            return trans.table('$meta').get('version').then(function (metaVersion) {\n                return metaVersion != null ? metaVersion : oldVersion;\n            });\n        }\n        else {\n            return DexiePromise.resolve(oldVersion);\n        }\n    }\n    function updateTablesAndIndexes(db, oldVersion, trans, idbUpgradeTrans) {\n        var queue = [];\n        var versions = db._versions;\n        var globalSchema = db._dbSchema = buildGlobalSchema(db, db.idbdb, idbUpgradeTrans);\n        var versToRun = versions.filter(function (v) { return v._cfg.version >= oldVersion; });\n        if (versToRun.length === 0) {\n            return DexiePromise.resolve();\n        }\n        versToRun.forEach(function (version) {\n            queue.push(function () {\n                var oldSchema = globalSchema;\n                var newSchema = version._cfg.dbschema;\n                adjustToExistingIndexNames(db, oldSchema, idbUpgradeTrans);\n                adjustToExistingIndexNames(db, newSchema, idbUpgradeTrans);\n                globalSchema = db._dbSchema = newSchema;\n                var diff = getSchemaDiff(oldSchema, newSchema);\n                diff.add.forEach(function (tuple) {\n                    createTable(idbUpgradeTrans, tuple[0], tuple[1].primKey, tuple[1].indexes);\n                });\n                diff.change.forEach(function (change) {\n                    if (change.recreate) {\n                        throw new exceptions.Upgrade(\"Not yet support for changing primary key\");\n                    }\n                    else {\n                        var store_1 = idbUpgradeTrans.objectStore(change.name);\n                        change.add.forEach(function (idx) { return addIndex(store_1, idx); });\n                        change.change.forEach(function (idx) {\n                            store_1.deleteIndex(idx.name);\n                            addIndex(store_1, idx);\n                        });\n                        change.del.forEach(function (idxName) { return store_1.deleteIndex(idxName); });\n                    }\n                });\n                var contentUpgrade = version._cfg.contentUpgrade;\n                if (contentUpgrade && version._cfg.version > oldVersion) {\n                    generateMiddlewareStacks(db, idbUpgradeTrans);\n                    trans._memoizedTables = {};\n                    var upgradeSchema_1 = shallowClone(newSchema);\n                    diff.del.forEach(function (table) {\n                        upgradeSchema_1[table] = oldSchema[table];\n                    });\n                    removeTablesApi(db, [db.Transaction.prototype]);\n                    setApiOnPlace(db, [db.Transaction.prototype], keys(upgradeSchema_1), upgradeSchema_1);\n                    trans.schema = upgradeSchema_1;\n                    var contentUpgradeIsAsync_1 = isAsyncFunction(contentUpgrade);\n                    if (contentUpgradeIsAsync_1) {\n                        incrementExpectedAwaits();\n                    }\n                    var returnValue_1;\n                    var promiseFollowed = DexiePromise.follow(function () {\n                        returnValue_1 = contentUpgrade(trans);\n                        if (returnValue_1) {\n                            if (contentUpgradeIsAsync_1) {\n                                var decrementor = decrementExpectedAwaits.bind(null, null);\n                                returnValue_1.then(decrementor, decrementor);\n                            }\n                        }\n                    });\n                    return (returnValue_1 && typeof returnValue_1.then === 'function' ?\n                        DexiePromise.resolve(returnValue_1) : promiseFollowed.then(function () { return returnValue_1; }));\n                }\n            });\n            queue.push(function (idbtrans) {\n                var newSchema = version._cfg.dbschema;\n                deleteRemovedTables(newSchema, idbtrans);\n                removeTablesApi(db, [db.Transaction.prototype]);\n                setApiOnPlace(db, [db.Transaction.prototype], db._storeNames, db._dbSchema);\n                trans.schema = db._dbSchema;\n            });\n            queue.push(function (idbtrans) {\n                if (db.idbdb.objectStoreNames.contains('$meta')) {\n                    if (Math.ceil(db.idbdb.version / 10) === version._cfg.version) {\n                        db.idbdb.deleteObjectStore('$meta');\n                        delete db._dbSchema.$meta;\n                        db._storeNames = db._storeNames.filter(function (name) { return name !== '$meta'; });\n                    }\n                    else {\n                        idbtrans.objectStore('$meta').put(version._cfg.version, 'version');\n                    }\n                }\n            });\n        });\n        function runQueue() {\n            return queue.length ? DexiePromise.resolve(queue.shift()(trans.idbtrans)).then(runQueue) :\n                DexiePromise.resolve();\n        }\n        return runQueue().then(function () {\n            createMissingTables(globalSchema, idbUpgradeTrans);\n        });\n    }\n    function getSchemaDiff(oldSchema, newSchema) {\n        var diff = {\n            del: [],\n            add: [],\n            change: []\n        };\n        var table;\n        for (table in oldSchema) {\n            if (!newSchema[table])\n                diff.del.push(table);\n        }\n        for (table in newSchema) {\n            var oldDef = oldSchema[table], newDef = newSchema[table];\n            if (!oldDef) {\n                diff.add.push([table, newDef]);\n            }\n            else {\n                var change = {\n                    name: table,\n                    def: newDef,\n                    recreate: false,\n                    del: [],\n                    add: [],\n                    change: []\n                };\n                if ((\n                '' + (oldDef.primKey.keyPath || '')) !== ('' + (newDef.primKey.keyPath || '')) ||\n                    (oldDef.primKey.auto !== newDef.primKey.auto)) {\n                    change.recreate = true;\n                    diff.change.push(change);\n                }\n                else {\n                    var oldIndexes = oldDef.idxByName;\n                    var newIndexes = newDef.idxByName;\n                    var idxName = void 0;\n                    for (idxName in oldIndexes) {\n                        if (!newIndexes[idxName])\n                            change.del.push(idxName);\n                    }\n                    for (idxName in newIndexes) {\n                        var oldIdx = oldIndexes[idxName], newIdx = newIndexes[idxName];\n                        if (!oldIdx)\n                            change.add.push(newIdx);\n                        else if (oldIdx.src !== newIdx.src)\n                            change.change.push(newIdx);\n                    }\n                    if (change.del.length > 0 || change.add.length > 0 || change.change.length > 0) {\n                        diff.change.push(change);\n                    }\n                }\n            }\n        }\n        return diff;\n    }\n    function createTable(idbtrans, tableName, primKey, indexes) {\n        var store = idbtrans.db.createObjectStore(tableName, primKey.keyPath ?\n            { keyPath: primKey.keyPath, autoIncrement: primKey.auto } :\n            { autoIncrement: primKey.auto });\n        indexes.forEach(function (idx) { return addIndex(store, idx); });\n        return store;\n    }\n    function createMissingTables(newSchema, idbtrans) {\n        keys(newSchema).forEach(function (tableName) {\n            if (!idbtrans.db.objectStoreNames.contains(tableName)) {\n                if (debug)\n                    console.debug('Dexie: Creating missing table', tableName);\n                createTable(idbtrans, tableName, newSchema[tableName].primKey, newSchema[tableName].indexes);\n            }\n        });\n    }\n    function deleteRemovedTables(newSchema, idbtrans) {\n        [].slice.call(idbtrans.db.objectStoreNames).forEach(function (storeName) {\n            return newSchema[storeName] == null && idbtrans.db.deleteObjectStore(storeName);\n        });\n    }\n    function addIndex(store, idx) {\n        store.createIndex(idx.name, idx.keyPath, { unique: idx.unique, multiEntry: idx.multi });\n    }\n    function buildGlobalSchema(db, idbdb, tmpTrans) {\n        var globalSchema = {};\n        var dbStoreNames = slice(idbdb.objectStoreNames, 0);\n        dbStoreNames.forEach(function (storeName) {\n            var store = tmpTrans.objectStore(storeName);\n            var keyPath = store.keyPath;\n            var primKey = createIndexSpec(nameFromKeyPath(keyPath), keyPath || \"\", true, false, !!store.autoIncrement, keyPath && typeof keyPath !== \"string\", true);\n            var indexes = [];\n            for (var j = 0; j < store.indexNames.length; ++j) {\n                var idbindex = store.index(store.indexNames[j]);\n                keyPath = idbindex.keyPath;\n                var index = createIndexSpec(idbindex.name, keyPath, !!idbindex.unique, !!idbindex.multiEntry, false, keyPath && typeof keyPath !== \"string\", false);\n                indexes.push(index);\n            }\n            globalSchema[storeName] = createTableSchema(storeName, primKey, indexes);\n        });\n        return globalSchema;\n    }\n    function readGlobalSchema(db, idbdb, tmpTrans) {\n        db.verno = idbdb.version / 10;\n        var globalSchema = db._dbSchema = buildGlobalSchema(db, idbdb, tmpTrans);\n        db._storeNames = slice(idbdb.objectStoreNames, 0);\n        setApiOnPlace(db, [db._allTables], keys(globalSchema), globalSchema);\n    }\n    function verifyInstalledSchema(db, tmpTrans) {\n        var installedSchema = buildGlobalSchema(db, db.idbdb, tmpTrans);\n        var diff = getSchemaDiff(installedSchema, db._dbSchema);\n        return !(diff.add.length || diff.change.some(function (ch) { return ch.add.length || ch.change.length; }));\n    }\n    function adjustToExistingIndexNames(db, schema, idbtrans) {\n        var storeNames = idbtrans.db.objectStoreNames;\n        for (var i = 0; i < storeNames.length; ++i) {\n            var storeName = storeNames[i];\n            var store = idbtrans.objectStore(storeName);\n            db._hasGetAll = 'getAll' in store;\n            for (var j = 0; j < store.indexNames.length; ++j) {\n                var indexName = store.indexNames[j];\n                var keyPath = store.index(indexName).keyPath;\n                var dexieName = typeof keyPath === 'string' ? keyPath : \"[\" + slice(keyPath).join('+') + \"]\";\n                if (schema[storeName]) {\n                    var indexSpec = schema[storeName].idxByName[dexieName];\n                    if (indexSpec) {\n                        indexSpec.name = indexName;\n                        delete schema[storeName].idxByName[dexieName];\n                        schema[storeName].idxByName[indexName] = indexSpec;\n                    }\n                }\n            }\n        }\n        if (typeof navigator !== 'undefined' && /Safari/.test(navigator.userAgent) &&\n            !/(Chrome\\/|Edge\\/)/.test(navigator.userAgent) &&\n            _global.WorkerGlobalScope && _global instanceof _global.WorkerGlobalScope &&\n            [].concat(navigator.userAgent.match(/Safari\\/(\\d*)/))[1] < 604) {\n            db._hasGetAll = false;\n        }\n    }\n    function parseIndexSyntax(primKeyAndIndexes) {\n        return primKeyAndIndexes.split(',').map(function (index, indexNum) {\n            index = index.trim();\n            var name = index.replace(/([&*]|\\+\\+)/g, \"\");\n            var keyPath = /^\\[/.test(name) ? name.match(/^\\[(.*)\\]$/)[1].split('+') : name;\n            return createIndexSpec(name, keyPath || null, /\\&/.test(index), /\\*/.test(index), /\\+\\+/.test(index), isArray(keyPath), indexNum === 0);\n        });\n    }\n\n    var Version =  (function () {\n        function Version() {\n        }\n        Version.prototype._parseStoresSpec = function (stores, outSchema) {\n            keys(stores).forEach(function (tableName) {\n                if (stores[tableName] !== null) {\n                    var indexes = parseIndexSyntax(stores[tableName]);\n                    var primKey = indexes.shift();\n                    primKey.unique = true;\n                    if (primKey.multi)\n                        throw new exceptions.Schema(\"Primary key cannot be multi-valued\");\n                    indexes.forEach(function (idx) {\n                        if (idx.auto)\n                            throw new exceptions.Schema(\"Only primary key can be marked as autoIncrement (++)\");\n                        if (!idx.keyPath)\n                            throw new exceptions.Schema(\"Index must have a name and cannot be an empty string\");\n                    });\n                    outSchema[tableName] = createTableSchema(tableName, primKey, indexes);\n                }\n            });\n        };\n        Version.prototype.stores = function (stores) {\n            var db = this.db;\n            this._cfg.storesSource = this._cfg.storesSource ?\n                extend(this._cfg.storesSource, stores) :\n                stores;\n            var versions = db._versions;\n            var storesSpec = {};\n            var dbschema = {};\n            versions.forEach(function (version) {\n                extend(storesSpec, version._cfg.storesSource);\n                dbschema = (version._cfg.dbschema = {});\n                version._parseStoresSpec(storesSpec, dbschema);\n            });\n            db._dbSchema = dbschema;\n            removeTablesApi(db, [db._allTables, db, db.Transaction.prototype]);\n            setApiOnPlace(db, [db._allTables, db, db.Transaction.prototype, this._cfg.tables], keys(dbschema), dbschema);\n            db._storeNames = keys(dbschema);\n            return this;\n        };\n        Version.prototype.upgrade = function (upgradeFunction) {\n            this._cfg.contentUpgrade = promisableChain(this._cfg.contentUpgrade || nop, upgradeFunction);\n            return this;\n        };\n        return Version;\n    }());\n\n    function createVersionConstructor(db) {\n        return makeClassConstructor(Version.prototype, function Version(versionNumber) {\n            this.db = db;\n            this._cfg = {\n                version: versionNumber,\n                storesSource: null,\n                dbschema: {},\n                tables: {},\n                contentUpgrade: null\n            };\n        });\n    }\n\n    function getDbNamesTable(indexedDB, IDBKeyRange) {\n        var dbNamesDB = indexedDB[\"_dbNamesDB\"];\n        if (!dbNamesDB) {\n            dbNamesDB = indexedDB[\"_dbNamesDB\"] = new Dexie$1(DBNAMES_DB, {\n                addons: [],\n                indexedDB: indexedDB,\n                IDBKeyRange: IDBKeyRange,\n            });\n            dbNamesDB.version(1).stores({ dbnames: \"name\" });\n        }\n        return dbNamesDB.table(\"dbnames\");\n    }\n    function hasDatabasesNative(indexedDB) {\n        return indexedDB && typeof indexedDB.databases === \"function\";\n    }\n    function getDatabaseNames(_a) {\n        var indexedDB = _a.indexedDB, IDBKeyRange = _a.IDBKeyRange;\n        return hasDatabasesNative(indexedDB)\n            ? Promise.resolve(indexedDB.databases()).then(function (infos) {\n                return infos\n                    .map(function (info) { return info.name; })\n                    .filter(function (name) { return name !== DBNAMES_DB; });\n            })\n            : getDbNamesTable(indexedDB, IDBKeyRange).toCollection().primaryKeys();\n    }\n    function _onDatabaseCreated(_a, name) {\n        var indexedDB = _a.indexedDB, IDBKeyRange = _a.IDBKeyRange;\n        !hasDatabasesNative(indexedDB) &&\n            name !== DBNAMES_DB &&\n            getDbNamesTable(indexedDB, IDBKeyRange).put({ name: name }).catch(nop);\n    }\n    function _onDatabaseDeleted(_a, name) {\n        var indexedDB = _a.indexedDB, IDBKeyRange = _a.IDBKeyRange;\n        !hasDatabasesNative(indexedDB) &&\n            name !== DBNAMES_DB &&\n            getDbNamesTable(indexedDB, IDBKeyRange).delete(name).catch(nop);\n    }\n\n    function vip(fn) {\n        return newScope(function () {\n            PSD.letThrough = true;\n            return fn();\n        });\n    }\n\n    function idbReady() {\n        var isSafari = !navigator.userAgentData &&\n            /Safari\\//.test(navigator.userAgent) &&\n            !/Chrom(e|ium)\\//.test(navigator.userAgent);\n        if (!isSafari || !indexedDB.databases)\n            return Promise.resolve();\n        var intervalId;\n        return new Promise(function (resolve) {\n            var tryIdb = function () { return indexedDB.databases().finally(resolve); };\n            intervalId = setInterval(tryIdb, 100);\n            tryIdb();\n        }).finally(function () { return clearInterval(intervalId); });\n    }\n\n    var _a;\n    function isEmptyRange(node) {\n        return !(\"from\" in node);\n    }\n    var RangeSet = function (fromOrTree, to) {\n        if (this) {\n            extend(this, arguments.length ? { d: 1, from: fromOrTree, to: arguments.length > 1 ? to : fromOrTree } : { d: 0 });\n        }\n        else {\n            var rv = new RangeSet();\n            if (fromOrTree && (\"d\" in fromOrTree)) {\n                extend(rv, fromOrTree);\n            }\n            return rv;\n        }\n    };\n    props(RangeSet.prototype, (_a = {\n            add: function (rangeSet) {\n                mergeRanges(this, rangeSet);\n                return this;\n            },\n            addKey: function (key) {\n                addRange(this, key, key);\n                return this;\n            },\n            addKeys: function (keys) {\n                var _this = this;\n                keys.forEach(function (key) { return addRange(_this, key, key); });\n                return this;\n            },\n            hasKey: function (key) {\n                var node = getRangeSetIterator(this).next(key).value;\n                return node && cmp(node.from, key) <= 0 && cmp(node.to, key) >= 0;\n            }\n        },\n        _a[iteratorSymbol] = function () {\n            return getRangeSetIterator(this);\n        },\n        _a));\n    function addRange(target, from, to) {\n        var diff = cmp(from, to);\n        if (isNaN(diff))\n            return;\n        if (diff > 0)\n            throw RangeError();\n        if (isEmptyRange(target))\n            return extend(target, { from: from, to: to, d: 1 });\n        var left = target.l;\n        var right = target.r;\n        if (cmp(to, target.from) < 0) {\n            left\n                ? addRange(left, from, to)\n                : (target.l = { from: from, to: to, d: 1, l: null, r: null });\n            return rebalance(target);\n        }\n        if (cmp(from, target.to) > 0) {\n            right\n                ? addRange(right, from, to)\n                : (target.r = { from: from, to: to, d: 1, l: null, r: null });\n            return rebalance(target);\n        }\n        if (cmp(from, target.from) < 0) {\n            target.from = from;\n            target.l = null;\n            target.d = right ? right.d + 1 : 1;\n        }\n        if (cmp(to, target.to) > 0) {\n            target.to = to;\n            target.r = null;\n            target.d = target.l ? target.l.d + 1 : 1;\n        }\n        var rightWasCutOff = !target.r;\n        if (left && !target.l) {\n            mergeRanges(target, left);\n        }\n        if (right && rightWasCutOff) {\n            mergeRanges(target, right);\n        }\n    }\n    function mergeRanges(target, newSet) {\n        function _addRangeSet(target, _a) {\n            var from = _a.from, to = _a.to, l = _a.l, r = _a.r;\n            addRange(target, from, to);\n            if (l)\n                _addRangeSet(target, l);\n            if (r)\n                _addRangeSet(target, r);\n        }\n        if (!isEmptyRange(newSet))\n            _addRangeSet(target, newSet);\n    }\n    function rangesOverlap(rangeSet1, rangeSet2) {\n        var i1 = getRangeSetIterator(rangeSet2);\n        var nextResult1 = i1.next();\n        if (nextResult1.done)\n            return false;\n        var a = nextResult1.value;\n        var i2 = getRangeSetIterator(rangeSet1);\n        var nextResult2 = i2.next(a.from);\n        var b = nextResult2.value;\n        while (!nextResult1.done && !nextResult2.done) {\n            if (cmp(b.from, a.to) <= 0 && cmp(b.to, a.from) >= 0)\n                return true;\n            cmp(a.from, b.from) < 0\n                ? (a = (nextResult1 = i1.next(b.from)).value)\n                : (b = (nextResult2 = i2.next(a.from)).value);\n        }\n        return false;\n    }\n    function getRangeSetIterator(node) {\n        var state = isEmptyRange(node) ? null : { s: 0, n: node };\n        return {\n            next: function (key) {\n                var keyProvided = arguments.length > 0;\n                while (state) {\n                    switch (state.s) {\n                        case 0:\n                            state.s = 1;\n                            if (keyProvided) {\n                                while (state.n.l && cmp(key, state.n.from) < 0)\n                                    state = { up: state, n: state.n.l, s: 1 };\n                            }\n                            else {\n                                while (state.n.l)\n                                    state = { up: state, n: state.n.l, s: 1 };\n                            }\n                        case 1:\n                            state.s = 2;\n                            if (!keyProvided || cmp(key, state.n.to) <= 0)\n                                return { value: state.n, done: false };\n                        case 2:\n                            if (state.n.r) {\n                                state.s = 3;\n                                state = { up: state, n: state.n.r, s: 0 };\n                                continue;\n                            }\n                        case 3:\n                            state = state.up;\n                    }\n                }\n                return { done: true };\n            },\n        };\n    }\n    function rebalance(target) {\n        var _a, _b;\n        var diff = (((_a = target.r) === null || _a === void 0 ? void 0 : _a.d) || 0) - (((_b = target.l) === null || _b === void 0 ? void 0 : _b.d) || 0);\n        var r = diff > 1 ? \"r\" : diff < -1 ? \"l\" : \"\";\n        if (r) {\n            var l = r === \"r\" ? \"l\" : \"r\";\n            var rootClone = __assign({}, target);\n            var oldRootRight = target[r];\n            target.from = oldRootRight.from;\n            target.to = oldRootRight.to;\n            target[r] = oldRootRight[r];\n            rootClone[r] = oldRootRight[l];\n            target[l] = rootClone;\n            rootClone.d = computeDepth(rootClone);\n        }\n        target.d = computeDepth(target);\n    }\n    function computeDepth(_a) {\n        var r = _a.r, l = _a.l;\n        return (r ? (l ? Math.max(r.d, l.d) : r.d) : l ? l.d : 0) + 1;\n    }\n\n    function extendObservabilitySet(target, newSet) {\n        keys(newSet).forEach(function (part) {\n            if (target[part])\n                mergeRanges(target[part], newSet[part]);\n            else\n                target[part] = cloneSimpleObjectTree(newSet[part]);\n        });\n        return target;\n    }\n\n    function obsSetsOverlap(os1, os2) {\n        return os1.all || os2.all || Object.keys(os1).some(function (key) { return os2[key] && rangesOverlap(os2[key], os1[key]); });\n    }\n\n    var cache = {};\n\n    var unsignaledParts = {};\n    var isTaskEnqueued = false;\n    function signalSubscribersLazily(part, optimistic) {\n        extendObservabilitySet(unsignaledParts, part);\n        if (!isTaskEnqueued) {\n            isTaskEnqueued = true;\n            setTimeout(function () {\n                isTaskEnqueued = false;\n                var parts = unsignaledParts;\n                unsignaledParts = {};\n                signalSubscribersNow(parts, false);\n            }, 0);\n        }\n    }\n    function signalSubscribersNow(updatedParts, deleteAffectedCacheEntries) {\n        if (deleteAffectedCacheEntries === void 0) { deleteAffectedCacheEntries = false; }\n        var queriesToSignal = new Set();\n        if (updatedParts.all) {\n            for (var _i = 0, _a = Object.values(cache); _i < _a.length; _i++) {\n                var tblCache = _a[_i];\n                collectTableSubscribers(tblCache, updatedParts, queriesToSignal, deleteAffectedCacheEntries);\n            }\n        }\n        else {\n            for (var key in updatedParts) {\n                var parts = /^idb\\:\\/\\/(.*)\\/(.*)\\//.exec(key);\n                if (parts) {\n                    var dbName = parts[1], tableName = parts[2];\n                    var tblCache = cache[\"idb://\".concat(dbName, \"/\").concat(tableName)];\n                    if (tblCache)\n                        collectTableSubscribers(tblCache, updatedParts, queriesToSignal, deleteAffectedCacheEntries);\n                }\n            }\n        }\n        queriesToSignal.forEach(function (requery) { return requery(); });\n    }\n    function collectTableSubscribers(tblCache, updatedParts, outQueriesToSignal, deleteAffectedCacheEntries) {\n        var updatedEntryLists = [];\n        for (var _i = 0, _a = Object.entries(tblCache.queries.query); _i < _a.length; _i++) {\n            var _b = _a[_i], indexName = _b[0], entries = _b[1];\n            var filteredEntries = [];\n            for (var _c = 0, entries_1 = entries; _c < entries_1.length; _c++) {\n                var entry = entries_1[_c];\n                if (obsSetsOverlap(updatedParts, entry.obsSet)) {\n                    entry.subscribers.forEach(function (requery) { return outQueriesToSignal.add(requery); });\n                }\n                else if (deleteAffectedCacheEntries) {\n                    filteredEntries.push(entry);\n                }\n            }\n            if (deleteAffectedCacheEntries)\n                updatedEntryLists.push([indexName, filteredEntries]);\n        }\n        if (deleteAffectedCacheEntries) {\n            for (var _d = 0, updatedEntryLists_1 = updatedEntryLists; _d < updatedEntryLists_1.length; _d++) {\n                var _e = updatedEntryLists_1[_d], indexName = _e[0], filteredEntries = _e[1];\n                tblCache.queries.query[indexName] = filteredEntries;\n            }\n        }\n    }\n\n    function dexieOpen(db) {\n        var state = db._state;\n        var indexedDB = db._deps.indexedDB;\n        if (state.isBeingOpened || db.idbdb)\n            return state.dbReadyPromise.then(function () { return state.dbOpenError ?\n                rejection(state.dbOpenError) :\n                db; });\n        state.isBeingOpened = true;\n        state.dbOpenError = null;\n        state.openComplete = false;\n        var openCanceller = state.openCanceller;\n        var nativeVerToOpen = Math.round(db.verno * 10);\n        var schemaPatchMode = false;\n        function throwIfCancelled() {\n            if (state.openCanceller !== openCanceller)\n                throw new exceptions.DatabaseClosed('db.open() was cancelled');\n        }\n        var resolveDbReady = state.dbReadyResolve,\n        upgradeTransaction = null, wasCreated = false;\n        var tryOpenDB = function () { return new DexiePromise(function (resolve, reject) {\n            throwIfCancelled();\n            if (!indexedDB)\n                throw new exceptions.MissingAPI();\n            var dbName = db.name;\n            var req = state.autoSchema || !nativeVerToOpen ?\n                indexedDB.open(dbName) :\n                indexedDB.open(dbName, nativeVerToOpen);\n            if (!req)\n                throw new exceptions.MissingAPI();\n            req.onerror = eventRejectHandler(reject);\n            req.onblocked = wrap(db._fireOnBlocked);\n            req.onupgradeneeded = wrap(function (e) {\n                upgradeTransaction = req.transaction;\n                if (state.autoSchema && !db._options.allowEmptyDB) {\n                    req.onerror = preventDefault;\n                    upgradeTransaction.abort();\n                    req.result.close();\n                    var delreq = indexedDB.deleteDatabase(dbName);\n                    delreq.onsuccess = delreq.onerror = wrap(function () {\n                        reject(new exceptions.NoSuchDatabase(\"Database \".concat(dbName, \" doesnt exist\")));\n                    });\n                }\n                else {\n                    upgradeTransaction.onerror = eventRejectHandler(reject);\n                    var oldVer = e.oldVersion > Math.pow(2, 62) ? 0 : e.oldVersion;\n                    wasCreated = oldVer < 1;\n                    db.idbdb = req.result;\n                    if (schemaPatchMode) {\n                        patchCurrentVersion(db, upgradeTransaction);\n                    }\n                    runUpgraders(db, oldVer / 10, upgradeTransaction, reject);\n                }\n            }, reject);\n            req.onsuccess = wrap(function () {\n                upgradeTransaction = null;\n                var idbdb = db.idbdb = req.result;\n                var objectStoreNames = slice(idbdb.objectStoreNames);\n                if (objectStoreNames.length > 0)\n                    try {\n                        var tmpTrans = idbdb.transaction(safariMultiStoreFix(objectStoreNames), 'readonly');\n                        if (state.autoSchema)\n                            readGlobalSchema(db, idbdb, tmpTrans);\n                        else {\n                            adjustToExistingIndexNames(db, db._dbSchema, tmpTrans);\n                            if (!verifyInstalledSchema(db, tmpTrans) && !schemaPatchMode) {\n                                console.warn(\"Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this.\");\n                                idbdb.close();\n                                nativeVerToOpen = idbdb.version + 1;\n                                schemaPatchMode = true;\n                                return resolve(tryOpenDB());\n                            }\n                        }\n                        generateMiddlewareStacks(db, tmpTrans);\n                    }\n                    catch (e) {\n                    }\n                connections.push(db);\n                idbdb.onversionchange = wrap(function (ev) {\n                    state.vcFired = true;\n                    db.on(\"versionchange\").fire(ev);\n                });\n                idbdb.onclose = wrap(function (ev) {\n                    db.on(\"close\").fire(ev);\n                });\n                if (wasCreated)\n                    _onDatabaseCreated(db._deps, dbName);\n                resolve();\n            }, reject);\n        }).catch(function (err) {\n            switch (err === null || err === void 0 ? void 0 : err.name) {\n                case \"UnknownError\":\n                    if (state.PR1398_maxLoop > 0) {\n                        state.PR1398_maxLoop--;\n                        console.warn('Dexie: Workaround for Chrome UnknownError on open()');\n                        return tryOpenDB();\n                    }\n                    break;\n                case \"VersionError\":\n                    if (nativeVerToOpen > 0) {\n                        nativeVerToOpen = 0;\n                        return tryOpenDB();\n                    }\n                    break;\n            }\n            return DexiePromise.reject(err);\n        }); };\n        return DexiePromise.race([\n            openCanceller,\n            (typeof navigator === 'undefined' ? DexiePromise.resolve() : idbReady()).then(tryOpenDB)\n        ]).then(function () {\n            throwIfCancelled();\n            state.onReadyBeingFired = [];\n            return DexiePromise.resolve(vip(function () { return db.on.ready.fire(db.vip); })).then(function fireRemainders() {\n                if (state.onReadyBeingFired.length > 0) {\n                    var remainders_1 = state.onReadyBeingFired.reduce(promisableChain, nop);\n                    state.onReadyBeingFired = [];\n                    return DexiePromise.resolve(vip(function () { return remainders_1(db.vip); })).then(fireRemainders);\n                }\n            });\n        }).finally(function () {\n            if (state.openCanceller === openCanceller) {\n                state.onReadyBeingFired = null;\n                state.isBeingOpened = false;\n            }\n        }).catch(function (err) {\n            state.dbOpenError = err;\n            try {\n                upgradeTransaction && upgradeTransaction.abort();\n            }\n            catch (_a) { }\n            if (openCanceller === state.openCanceller) {\n                db._close();\n            }\n            return rejection(err);\n        }).finally(function () {\n            state.openComplete = true;\n            resolveDbReady();\n        }).then(function () {\n            if (wasCreated) {\n                var everything_1 = {};\n                db.tables.forEach(function (table) {\n                    table.schema.indexes.forEach(function (idx) {\n                        if (idx.name)\n                            everything_1[\"idb://\".concat(db.name, \"/\").concat(table.name, \"/\").concat(idx.name)] = new RangeSet(-Infinity, [[[]]]);\n                    });\n                    everything_1[\"idb://\".concat(db.name, \"/\").concat(table.name, \"/\")] = everything_1[\"idb://\".concat(db.name, \"/\").concat(table.name, \"/:dels\")] = new RangeSet(-Infinity, [[[]]]);\n                });\n                globalEvents(DEXIE_STORAGE_MUTATED_EVENT_NAME).fire(everything_1);\n                signalSubscribersNow(everything_1, true);\n            }\n            return db;\n        });\n    }\n\n    function awaitIterator(iterator) {\n        var callNext = function (result) { return iterator.next(result); }, doThrow = function (error) { return iterator.throw(error); }, onSuccess = step(callNext), onError = step(doThrow);\n        function step(getNext) {\n            return function (val) {\n                var next = getNext(val), value = next.value;\n                return next.done ? value :\n                    (!value || typeof value.then !== 'function' ?\n                        isArray(value) ? Promise.all(value).then(onSuccess, onError) : onSuccess(value) :\n                        value.then(onSuccess, onError));\n            };\n        }\n        return step(callNext)();\n    }\n\n    function extractTransactionArgs(mode, _tableArgs_, scopeFunc) {\n        var i = arguments.length;\n        if (i < 2)\n            throw new exceptions.InvalidArgument(\"Too few arguments\");\n        var args = new Array(i - 1);\n        while (--i)\n            args[i - 1] = arguments[i];\n        scopeFunc = args.pop();\n        var tables = flatten(args);\n        return [mode, tables, scopeFunc];\n    }\n    function enterTransactionScope(db, mode, storeNames, parentTransaction, scopeFunc) {\n        return DexiePromise.resolve().then(function () {\n            var transless = PSD.transless || PSD;\n            var trans = db._createTransaction(mode, storeNames, db._dbSchema, parentTransaction);\n            trans.explicit = true;\n            var zoneProps = {\n                trans: trans,\n                transless: transless\n            };\n            if (parentTransaction) {\n                trans.idbtrans = parentTransaction.idbtrans;\n            }\n            else {\n                try {\n                    trans.create();\n                    trans.idbtrans._explicit = true;\n                    db._state.PR1398_maxLoop = 3;\n                }\n                catch (ex) {\n                    if (ex.name === errnames.InvalidState && db.isOpen() && --db._state.PR1398_maxLoop > 0) {\n                        console.warn('Dexie: Need to reopen db');\n                        db.close({ disableAutoOpen: false });\n                        return db.open().then(function () { return enterTransactionScope(db, mode, storeNames, null, scopeFunc); });\n                    }\n                    return rejection(ex);\n                }\n            }\n            var scopeFuncIsAsync = isAsyncFunction(scopeFunc);\n            if (scopeFuncIsAsync) {\n                incrementExpectedAwaits();\n            }\n            var returnValue;\n            var promiseFollowed = DexiePromise.follow(function () {\n                returnValue = scopeFunc.call(trans, trans);\n                if (returnValue) {\n                    if (scopeFuncIsAsync) {\n                        var decrementor = decrementExpectedAwaits.bind(null, null);\n                        returnValue.then(decrementor, decrementor);\n                    }\n                    else if (typeof returnValue.next === 'function' && typeof returnValue.throw === 'function') {\n                        returnValue = awaitIterator(returnValue);\n                    }\n                }\n            }, zoneProps);\n            return (returnValue && typeof returnValue.then === 'function' ?\n                DexiePromise.resolve(returnValue).then(function (x) { return trans.active ?\n                    x\n                    : rejection(new exceptions.PrematureCommit(\"Transaction committed too early. See http://bit.ly/2kdckMn\")); })\n                : promiseFollowed.then(function () { return returnValue; })).then(function (x) {\n                if (parentTransaction)\n                    trans._resolve();\n                return trans._completion.then(function () { return x; });\n            }).catch(function (e) {\n                trans._reject(e);\n                return rejection(e);\n            });\n        });\n    }\n\n    function pad(a, value, count) {\n        var result = isArray(a) ? a.slice() : [a];\n        for (var i = 0; i < count; ++i)\n            result.push(value);\n        return result;\n    }\n    function createVirtualIndexMiddleware(down) {\n        return __assign(__assign({}, down), { table: function (tableName) {\n                var table = down.table(tableName);\n                var schema = table.schema;\n                var indexLookup = {};\n                var allVirtualIndexes = [];\n                function addVirtualIndexes(keyPath, keyTail, lowLevelIndex) {\n                    var keyPathAlias = getKeyPathAlias(keyPath);\n                    var indexList = (indexLookup[keyPathAlias] = indexLookup[keyPathAlias] || []);\n                    var keyLength = keyPath == null ? 0 : typeof keyPath === 'string' ? 1 : keyPath.length;\n                    var isVirtual = keyTail > 0;\n                    var virtualIndex = __assign(__assign({}, lowLevelIndex), { name: isVirtual\n                            ? \"\".concat(keyPathAlias, \"(virtual-from:\").concat(lowLevelIndex.name, \")\")\n                            : lowLevelIndex.name, lowLevelIndex: lowLevelIndex, isVirtual: isVirtual, keyTail: keyTail, keyLength: keyLength, extractKey: getKeyExtractor(keyPath), unique: !isVirtual && lowLevelIndex.unique });\n                    indexList.push(virtualIndex);\n                    if (!virtualIndex.isPrimaryKey) {\n                        allVirtualIndexes.push(virtualIndex);\n                    }\n                    if (keyLength > 1) {\n                        var virtualKeyPath = keyLength === 2 ?\n                            keyPath[0] :\n                            keyPath.slice(0, keyLength - 1);\n                        addVirtualIndexes(virtualKeyPath, keyTail + 1, lowLevelIndex);\n                    }\n                    indexList.sort(function (a, b) { return a.keyTail - b.keyTail; });\n                    return virtualIndex;\n                }\n                var primaryKey = addVirtualIndexes(schema.primaryKey.keyPath, 0, schema.primaryKey);\n                indexLookup[\":id\"] = [primaryKey];\n                for (var _i = 0, _a = schema.indexes; _i < _a.length; _i++) {\n                    var index = _a[_i];\n                    addVirtualIndexes(index.keyPath, 0, index);\n                }\n                function findBestIndex(keyPath) {\n                    var result = indexLookup[getKeyPathAlias(keyPath)];\n                    return result && result[0];\n                }\n                function translateRange(range, keyTail) {\n                    return {\n                        type: range.type === 1  ?\n                            2  :\n                            range.type,\n                        lower: pad(range.lower, range.lowerOpen ? down.MAX_KEY : down.MIN_KEY, keyTail),\n                        lowerOpen: true,\n                        upper: pad(range.upper, range.upperOpen ? down.MIN_KEY : down.MAX_KEY, keyTail),\n                        upperOpen: true\n                    };\n                }\n                function translateRequest(req) {\n                    var index = req.query.index;\n                    return index.isVirtual ? __assign(__assign({}, req), { query: {\n                            index: index.lowLevelIndex,\n                            range: translateRange(req.query.range, index.keyTail)\n                        } }) : req;\n                }\n                var result = __assign(__assign({}, table), { schema: __assign(__assign({}, schema), { primaryKey: primaryKey, indexes: allVirtualIndexes, getIndexByKeyPath: findBestIndex }), count: function (req) {\n                        return table.count(translateRequest(req));\n                    }, query: function (req) {\n                        return table.query(translateRequest(req));\n                    }, openCursor: function (req) {\n                        var _a = req.query.index, keyTail = _a.keyTail, isVirtual = _a.isVirtual, keyLength = _a.keyLength;\n                        if (!isVirtual)\n                            return table.openCursor(req);\n                        function createVirtualCursor(cursor) {\n                            function _continue(key) {\n                                key != null ?\n                                    cursor.continue(pad(key, req.reverse ? down.MAX_KEY : down.MIN_KEY, keyTail)) :\n                                    req.unique ?\n                                        cursor.continue(cursor.key.slice(0, keyLength)\n                                            .concat(req.reverse\n                                            ? down.MIN_KEY\n                                            : down.MAX_KEY, keyTail)) :\n                                        cursor.continue();\n                            }\n                            var virtualCursor = Object.create(cursor, {\n                                continue: { value: _continue },\n                                continuePrimaryKey: {\n                                    value: function (key, primaryKey) {\n                                        cursor.continuePrimaryKey(pad(key, down.MAX_KEY, keyTail), primaryKey);\n                                    }\n                                },\n                                primaryKey: {\n                                    get: function () {\n                                        return cursor.primaryKey;\n                                    }\n                                },\n                                key: {\n                                    get: function () {\n                                        var key = cursor.key;\n                                        return keyLength === 1 ?\n                                            key[0] :\n                                            key.slice(0, keyLength);\n                                    }\n                                },\n                                value: {\n                                    get: function () {\n                                        return cursor.value;\n                                    }\n                                }\n                            });\n                            return virtualCursor;\n                        }\n                        return table.openCursor(translateRequest(req))\n                            .then(function (cursor) { return cursor && createVirtualCursor(cursor); });\n                    } });\n                return result;\n            } });\n    }\n    var virtualIndexMiddleware = {\n        stack: \"dbcore\",\n        name: \"VirtualIndexMiddleware\",\n        level: 1,\n        create: createVirtualIndexMiddleware\n    };\n\n    function getObjectDiff(a, b, rv, prfx) {\n        rv = rv || {};\n        prfx = prfx || '';\n        keys(a).forEach(function (prop) {\n            if (!hasOwn(b, prop)) {\n                rv[prfx + prop] = undefined;\n            }\n            else {\n                var ap = a[prop], bp = b[prop];\n                if (typeof ap === 'object' && typeof bp === 'object' && ap && bp) {\n                    var apTypeName = toStringTag(ap);\n                    var bpTypeName = toStringTag(bp);\n                    if (apTypeName !== bpTypeName) {\n                        rv[prfx + prop] = b[prop];\n                    }\n                    else if (apTypeName === 'Object') {\n                        getObjectDiff(ap, bp, rv, prfx + prop + '.');\n                    }\n                    else if (ap !== bp) {\n                        rv[prfx + prop] = b[prop];\n                    }\n                }\n                else if (ap !== bp)\n                    rv[prfx + prop] = b[prop];\n            }\n        });\n        keys(b).forEach(function (prop) {\n            if (!hasOwn(a, prop)) {\n                rv[prfx + prop] = b[prop];\n            }\n        });\n        return rv;\n    }\n\n    function getEffectiveKeys(primaryKey, req) {\n        if (req.type === 'delete')\n            return req.keys;\n        return req.keys || req.values.map(primaryKey.extractKey);\n    }\n\n    var hooksMiddleware = {\n        stack: \"dbcore\",\n        name: \"HooksMiddleware\",\n        level: 2,\n        create: function (downCore) { return (__assign(__assign({}, downCore), { table: function (tableName) {\n                var downTable = downCore.table(tableName);\n                var primaryKey = downTable.schema.primaryKey;\n                var tableMiddleware = __assign(__assign({}, downTable), { mutate: function (req) {\n                        var dxTrans = PSD.trans;\n                        var _a = dxTrans.table(tableName).hook, deleting = _a.deleting, creating = _a.creating, updating = _a.updating;\n                        switch (req.type) {\n                            case 'add':\n                                if (creating.fire === nop)\n                                    break;\n                                return dxTrans._promise('readwrite', function () { return addPutOrDelete(req); }, true);\n                            case 'put':\n                                if (creating.fire === nop && updating.fire === nop)\n                                    break;\n                                return dxTrans._promise('readwrite', function () { return addPutOrDelete(req); }, true);\n                            case 'delete':\n                                if (deleting.fire === nop)\n                                    break;\n                                return dxTrans._promise('readwrite', function () { return addPutOrDelete(req); }, true);\n                            case 'deleteRange':\n                                if (deleting.fire === nop)\n                                    break;\n                                return dxTrans._promise('readwrite', function () { return deleteRange(req); }, true);\n                        }\n                        return downTable.mutate(req);\n                        function addPutOrDelete(req) {\n                            var dxTrans = PSD.trans;\n                            var keys = req.keys || getEffectiveKeys(primaryKey, req);\n                            if (!keys)\n                                throw new Error(\"Keys missing\");\n                            req = req.type === 'add' || req.type === 'put' ? __assign(__assign({}, req), { keys: keys }) : __assign({}, req);\n                            if (req.type !== 'delete')\n                                req.values = __spreadArray([], req.values, true);\n                            if (req.keys)\n                                req.keys = __spreadArray([], req.keys, true);\n                            return getExistingValues(downTable, req, keys).then(function (existingValues) {\n                                var contexts = keys.map(function (key, i) {\n                                    var existingValue = existingValues[i];\n                                    var ctx = { onerror: null, onsuccess: null };\n                                    if (req.type === 'delete') {\n                                        deleting.fire.call(ctx, key, existingValue, dxTrans);\n                                    }\n                                    else if (req.type === 'add' || existingValue === undefined) {\n                                        var generatedPrimaryKey = creating.fire.call(ctx, key, req.values[i], dxTrans);\n                                        if (key == null && generatedPrimaryKey != null) {\n                                            key = generatedPrimaryKey;\n                                            req.keys[i] = key;\n                                            if (!primaryKey.outbound) {\n                                                setByKeyPath(req.values[i], primaryKey.keyPath, key);\n                                            }\n                                        }\n                                    }\n                                    else {\n                                        var objectDiff = getObjectDiff(existingValue, req.values[i]);\n                                        var additionalChanges_1 = updating.fire.call(ctx, objectDiff, key, existingValue, dxTrans);\n                                        if (additionalChanges_1) {\n                                            var requestedValue_1 = req.values[i];\n                                            Object.keys(additionalChanges_1).forEach(function (keyPath) {\n                                                if (hasOwn(requestedValue_1, keyPath)) {\n                                                    requestedValue_1[keyPath] = additionalChanges_1[keyPath];\n                                                }\n                                                else {\n                                                    setByKeyPath(requestedValue_1, keyPath, additionalChanges_1[keyPath]);\n                                                }\n                                            });\n                                        }\n                                    }\n                                    return ctx;\n                                });\n                                return downTable.mutate(req).then(function (_a) {\n                                    var failures = _a.failures, results = _a.results, numFailures = _a.numFailures, lastResult = _a.lastResult;\n                                    for (var i = 0; i < keys.length; ++i) {\n                                        var primKey = results ? results[i] : keys[i];\n                                        var ctx = contexts[i];\n                                        if (primKey == null) {\n                                            ctx.onerror && ctx.onerror(failures[i]);\n                                        }\n                                        else {\n                                            ctx.onsuccess && ctx.onsuccess(req.type === 'put' && existingValues[i] ?\n                                                req.values[i] :\n                                                primKey\n                                            );\n                                        }\n                                    }\n                                    return { failures: failures, results: results, numFailures: numFailures, lastResult: lastResult };\n                                }).catch(function (error) {\n                                    contexts.forEach(function (ctx) { return ctx.onerror && ctx.onerror(error); });\n                                    return Promise.reject(error);\n                                });\n                            });\n                        }\n                        function deleteRange(req) {\n                            return deleteNextChunk(req.trans, req.range, 10000);\n                        }\n                        function deleteNextChunk(trans, range, limit) {\n                            return downTable.query({ trans: trans, values: false, query: { index: primaryKey, range: range }, limit: limit })\n                                .then(function (_a) {\n                                var result = _a.result;\n                                return addPutOrDelete({ type: 'delete', keys: result, trans: trans }).then(function (res) {\n                                    if (res.numFailures > 0)\n                                        return Promise.reject(res.failures[0]);\n                                    if (result.length < limit) {\n                                        return { failures: [], numFailures: 0, lastResult: undefined };\n                                    }\n                                    else {\n                                        return deleteNextChunk(trans, __assign(__assign({}, range), { lower: result[result.length - 1], lowerOpen: true }), limit);\n                                    }\n                                });\n                            });\n                        }\n                    } });\n                return tableMiddleware;\n            } })); }\n    };\n    function getExistingValues(table, req, effectiveKeys) {\n        return req.type === \"add\"\n            ? Promise.resolve([])\n            : table.getMany({ trans: req.trans, keys: effectiveKeys, cache: \"immutable\" });\n    }\n\n    function getFromTransactionCache(keys, cache, clone) {\n        try {\n            if (!cache)\n                return null;\n            if (cache.keys.length < keys.length)\n                return null;\n            var result = [];\n            for (var i = 0, j = 0; i < cache.keys.length && j < keys.length; ++i) {\n                if (cmp(cache.keys[i], keys[j]) !== 0)\n                    continue;\n                result.push(clone ? deepClone(cache.values[i]) : cache.values[i]);\n                ++j;\n            }\n            return result.length === keys.length ? result : null;\n        }\n        catch (_a) {\n            return null;\n        }\n    }\n    var cacheExistingValuesMiddleware = {\n        stack: \"dbcore\",\n        level: -1,\n        create: function (core) {\n            return {\n                table: function (tableName) {\n                    var table = core.table(tableName);\n                    return __assign(__assign({}, table), { getMany: function (req) {\n                            if (!req.cache) {\n                                return table.getMany(req);\n                            }\n                            var cachedResult = getFromTransactionCache(req.keys, req.trans[\"_cache\"], req.cache === \"clone\");\n                            if (cachedResult) {\n                                return DexiePromise.resolve(cachedResult);\n                            }\n                            return table.getMany(req).then(function (res) {\n                                req.trans[\"_cache\"] = {\n                                    keys: req.keys,\n                                    values: req.cache === \"clone\" ? deepClone(res) : res,\n                                };\n                                return res;\n                            });\n                        }, mutate: function (req) {\n                            if (req.type !== \"add\")\n                                req.trans[\"_cache\"] = null;\n                            return table.mutate(req);\n                        } });\n                },\n            };\n        },\n    };\n\n    function isCachableContext(ctx, table) {\n        return (ctx.trans.mode === 'readonly' &&\n            !!ctx.subscr &&\n            !ctx.trans.explicit &&\n            ctx.trans.db._options.cache !== 'disabled' &&\n            !table.schema.primaryKey.outbound);\n    }\n\n    function isCachableRequest(type, req) {\n        switch (type) {\n            case 'query':\n                return req.values && !req.unique;\n            case 'get':\n                return false;\n            case 'getMany':\n                return false;\n            case 'count':\n                return false;\n            case 'openCursor':\n                return false;\n        }\n    }\n\n    var observabilityMiddleware = {\n        stack: \"dbcore\",\n        level: 0,\n        name: \"Observability\",\n        create: function (core) {\n            var dbName = core.schema.name;\n            var FULL_RANGE = new RangeSet(core.MIN_KEY, core.MAX_KEY);\n            return __assign(__assign({}, core), { transaction: function (stores, mode, options) {\n                    if (PSD.subscr && mode !== 'readonly') {\n                        throw new exceptions.ReadOnly(\"Readwrite transaction in liveQuery context. Querier source: \".concat(PSD.querier));\n                    }\n                    return core.transaction(stores, mode, options);\n                }, table: function (tableName) {\n                    var table = core.table(tableName);\n                    var schema = table.schema;\n                    var primaryKey = schema.primaryKey, indexes = schema.indexes;\n                    var extractKey = primaryKey.extractKey, outbound = primaryKey.outbound;\n                    var indexesWithAutoIncPK = primaryKey.autoIncrement && indexes.filter(function (index) { return index.compound && index.keyPath.includes(primaryKey.keyPath); });\n                    var tableClone = __assign(__assign({}, table), { mutate: function (req) {\n                            var _a, _b;\n                            var trans = req.trans;\n                            var mutatedParts = req.mutatedParts || (req.mutatedParts = {});\n                            var getRangeSet = function (indexName) {\n                                var part = \"idb://\".concat(dbName, \"/\").concat(tableName, \"/\").concat(indexName);\n                                return (mutatedParts[part] ||\n                                    (mutatedParts[part] = new RangeSet()));\n                            };\n                            var pkRangeSet = getRangeSet(\"\");\n                            var delsRangeSet = getRangeSet(\":dels\");\n                            var type = req.type;\n                            var _c = req.type === \"deleteRange\"\n                                ? [req.range]\n                                : req.type === \"delete\"\n                                    ? [req.keys]\n                                    : req.values.length < 50\n                                        ? [getEffectiveKeys(primaryKey, req).filter(function (id) { return id; }), req.values]\n                                        : [], keys = _c[0], newObjs = _c[1];\n                            var oldCache = req.trans[\"_cache\"];\n                            if (isArray(keys)) {\n                                pkRangeSet.addKeys(keys);\n                                var oldObjs = type === 'delete' || keys.length === newObjs.length ? getFromTransactionCache(keys, oldCache) : null;\n                                if (!oldObjs) {\n                                    delsRangeSet.addKeys(keys);\n                                }\n                                if (oldObjs || newObjs) {\n                                    trackAffectedIndexes(getRangeSet, schema, oldObjs, newObjs);\n                                }\n                            }\n                            else if (keys) {\n                                var range = {\n                                    from: (_a = keys.lower) !== null && _a !== void 0 ? _a : core.MIN_KEY,\n                                    to: (_b = keys.upper) !== null && _b !== void 0 ? _b : core.MAX_KEY\n                                };\n                                delsRangeSet.add(range);\n                                pkRangeSet.add(range);\n                            }\n                            else {\n                                pkRangeSet.add(FULL_RANGE);\n                                delsRangeSet.add(FULL_RANGE);\n                                schema.indexes.forEach(function (idx) { return getRangeSet(idx.name).add(FULL_RANGE); });\n                            }\n                            return table.mutate(req).then(function (res) {\n                                if (keys && (req.type === 'add' || req.type === 'put')) {\n                                    pkRangeSet.addKeys(res.results);\n                                    if (indexesWithAutoIncPK) {\n                                        indexesWithAutoIncPK.forEach(function (idx) {\n                                            var idxVals = req.values.map(function (v) { return idx.extractKey(v); });\n                                            var pkPos = idx.keyPath.findIndex(function (prop) { return prop === primaryKey.keyPath; });\n                                            for (var i = 0, len = res.results.length; i < len; ++i) {\n                                                idxVals[i][pkPos] = res.results[i];\n                                            }\n                                            getRangeSet(idx.name).addKeys(idxVals);\n                                        });\n                                    }\n                                }\n                                trans.mutatedParts = extendObservabilitySet(trans.mutatedParts || {}, mutatedParts);\n                                return res;\n                            });\n                        } });\n                    var getRange = function (_a) {\n                        var _b, _c;\n                        var _d = _a.query, index = _d.index, range = _d.range;\n                        return [\n                            index,\n                            new RangeSet((_b = range.lower) !== null && _b !== void 0 ? _b : core.MIN_KEY, (_c = range.upper) !== null && _c !== void 0 ? _c : core.MAX_KEY),\n                        ];\n                    };\n                    var readSubscribers = {\n                        get: function (req) { return [primaryKey, new RangeSet(req.key)]; },\n                        getMany: function (req) { return [primaryKey, new RangeSet().addKeys(req.keys)]; },\n                        count: getRange,\n                        query: getRange,\n                        openCursor: getRange,\n                    };\n                    keys(readSubscribers).forEach(function (method) {\n                        tableClone[method] = function (req) {\n                            var subscr = PSD.subscr;\n                            var isLiveQuery = !!subscr;\n                            var cachable = isCachableContext(PSD, table) && isCachableRequest(method, req);\n                            var obsSet = cachable\n                                ? req.obsSet = {}\n                                : subscr;\n                            if (isLiveQuery) {\n                                var getRangeSet = function (indexName) {\n                                    var part = \"idb://\".concat(dbName, \"/\").concat(tableName, \"/\").concat(indexName);\n                                    return (obsSet[part] ||\n                                        (obsSet[part] = new RangeSet()));\n                                };\n                                var pkRangeSet_1 = getRangeSet(\"\");\n                                var delsRangeSet_1 = getRangeSet(\":dels\");\n                                var _a = readSubscribers[method](req), queriedIndex = _a[0], queriedRanges = _a[1];\n                                if (method === 'query' && queriedIndex.isPrimaryKey && !req.values) {\n                                    delsRangeSet_1.add(queriedRanges);\n                                }\n                                else {\n                                    getRangeSet(queriedIndex.name || \"\").add(queriedRanges);\n                                }\n                                if (!queriedIndex.isPrimaryKey) {\n                                    if (method === \"count\") {\n                                        delsRangeSet_1.add(FULL_RANGE);\n                                    }\n                                    else {\n                                        var keysPromise_1 = method === \"query\" &&\n                                            outbound &&\n                                            req.values &&\n                                            table.query(__assign(__assign({}, req), { values: false }));\n                                        return table[method].apply(this, arguments).then(function (res) {\n                                            if (method === \"query\") {\n                                                if (outbound && req.values) {\n                                                    return keysPromise_1.then(function (_a) {\n                                                        var resultingKeys = _a.result;\n                                                        pkRangeSet_1.addKeys(resultingKeys);\n                                                        return res;\n                                                    });\n                                                }\n                                                var pKeys = req.values\n                                                    ? res.result.map(extractKey)\n                                                    : res.result;\n                                                if (req.values) {\n                                                    pkRangeSet_1.addKeys(pKeys);\n                                                }\n                                                else {\n                                                    delsRangeSet_1.addKeys(pKeys);\n                                                }\n                                            }\n                                            else if (method === \"openCursor\") {\n                                                var cursor_1 = res;\n                                                var wantValues_1 = req.values;\n                                                return (cursor_1 &&\n                                                    Object.create(cursor_1, {\n                                                        key: {\n                                                            get: function () {\n                                                                delsRangeSet_1.addKey(cursor_1.primaryKey);\n                                                                return cursor_1.key;\n                                                            },\n                                                        },\n                                                        primaryKey: {\n                                                            get: function () {\n                                                                var pkey = cursor_1.primaryKey;\n                                                                delsRangeSet_1.addKey(pkey);\n                                                                return pkey;\n                                                            },\n                                                        },\n                                                        value: {\n                                                            get: function () {\n                                                                wantValues_1 && pkRangeSet_1.addKey(cursor_1.primaryKey);\n                                                                return cursor_1.value;\n                                                            },\n                                                        },\n                                                    }));\n                                            }\n                                            return res;\n                                        });\n                                    }\n                                }\n                            }\n                            return table[method].apply(this, arguments);\n                        };\n                    });\n                    return tableClone;\n                } });\n        },\n    };\n    function trackAffectedIndexes(getRangeSet, schema, oldObjs, newObjs) {\n        function addAffectedIndex(ix) {\n            var rangeSet = getRangeSet(ix.name || \"\");\n            function extractKey(obj) {\n                return obj != null ? ix.extractKey(obj) : null;\n            }\n            var addKeyOrKeys = function (key) { return ix.multiEntry && isArray(key)\n                ? key.forEach(function (key) { return rangeSet.addKey(key); })\n                : rangeSet.addKey(key); };\n            (oldObjs || newObjs).forEach(function (_, i) {\n                var oldKey = oldObjs && extractKey(oldObjs[i]);\n                var newKey = newObjs && extractKey(newObjs[i]);\n                if (cmp(oldKey, newKey) !== 0) {\n                    if (oldKey != null)\n                        addKeyOrKeys(oldKey);\n                    if (newKey != null)\n                        addKeyOrKeys(newKey);\n                }\n            });\n        }\n        schema.indexes.forEach(addAffectedIndex);\n    }\n\n    function adjustOptimisticFromFailures(tblCache, req, res) {\n        if (res.numFailures === 0)\n            return req;\n        if (req.type === 'deleteRange') {\n            return null;\n        }\n        var numBulkOps = req.keys\n            ? req.keys.length\n            : 'values' in req && req.values\n                ? req.values.length\n                : 1;\n        if (res.numFailures === numBulkOps) {\n            return null;\n        }\n        var clone = __assign({}, req);\n        if (isArray(clone.keys)) {\n            clone.keys = clone.keys.filter(function (_, i) { return !(i in res.failures); });\n        }\n        if ('values' in clone && isArray(clone.values)) {\n            clone.values = clone.values.filter(function (_, i) { return !(i in res.failures); });\n        }\n        return clone;\n    }\n\n    function isAboveLower(key, range) {\n        return range.lower === undefined\n            ? true\n            : range.lowerOpen\n                ? cmp(key, range.lower) > 0\n                : cmp(key, range.lower) >= 0;\n    }\n    function isBelowUpper(key, range) {\n        return range.upper === undefined\n            ? true\n            : range.upperOpen\n                ? cmp(key, range.upper) < 0\n                : cmp(key, range.upper) <= 0;\n    }\n    function isWithinRange(key, range) {\n        return isAboveLower(key, range) && isBelowUpper(key, range);\n    }\n\n    function applyOptimisticOps(result, req, ops, table, cacheEntry, immutable) {\n        if (!ops || ops.length === 0)\n            return result;\n        var index = req.query.index;\n        var multiEntry = index.multiEntry;\n        var queryRange = req.query.range;\n        var primaryKey = table.schema.primaryKey;\n        var extractPrimKey = primaryKey.extractKey;\n        var extractIndex = index.extractKey;\n        var extractLowLevelIndex = (index.lowLevelIndex || index).extractKey;\n        var finalResult = ops.reduce(function (result, op) {\n            var modifedResult = result;\n            var includedValues = [];\n            if (op.type === 'add' || op.type === 'put') {\n                var includedPKs = new RangeSet();\n                for (var i = op.values.length - 1; i >= 0; --i) {\n                    var value = op.values[i];\n                    var pk = extractPrimKey(value);\n                    if (includedPKs.hasKey(pk))\n                        continue;\n                    var key = extractIndex(value);\n                    if (multiEntry && isArray(key)\n                        ? key.some(function (k) { return isWithinRange(k, queryRange); })\n                        : isWithinRange(key, queryRange)) {\n                        includedPKs.addKey(pk);\n                        includedValues.push(value);\n                    }\n                }\n            }\n            switch (op.type) {\n                case 'add': {\n                    var existingKeys_1 = new RangeSet().addKeys(req.values ? result.map(function (v) { return extractPrimKey(v); }) : result);\n                    modifedResult = result.concat(req.values\n                        ? includedValues.filter(function (v) {\n                            var key = extractPrimKey(v);\n                            if (existingKeys_1.hasKey(key))\n                                return false;\n                            existingKeys_1.addKey(key);\n                            return true;\n                        })\n                        : includedValues\n                            .map(function (v) { return extractPrimKey(v); })\n                            .filter(function (k) {\n                            if (existingKeys_1.hasKey(k))\n                                return false;\n                            existingKeys_1.addKey(k);\n                            return true;\n                        }));\n                    break;\n                }\n                case 'put': {\n                    var keySet_1 = new RangeSet().addKeys(op.values.map(function (v) { return extractPrimKey(v); }));\n                    modifedResult = result\n                        .filter(\n                    function (item) { return !keySet_1.hasKey(req.values ? extractPrimKey(item) : item); })\n                        .concat(\n                    req.values\n                        ? includedValues\n                        : includedValues.map(function (v) { return extractPrimKey(v); }));\n                    break;\n                }\n                case 'delete':\n                    var keysToDelete_1 = new RangeSet().addKeys(op.keys);\n                    modifedResult = result.filter(function (item) {\n                        return !keysToDelete_1.hasKey(req.values ? extractPrimKey(item) : item);\n                    });\n                    break;\n                case 'deleteRange':\n                    var range_1 = op.range;\n                    modifedResult = result.filter(function (item) { return !isWithinRange(extractPrimKey(item), range_1); });\n                    break;\n            }\n            return modifedResult;\n        }, result);\n        if (finalResult === result)\n            return result;\n        finalResult.sort(function (a, b) {\n            return cmp(extractLowLevelIndex(a), extractLowLevelIndex(b)) ||\n                cmp(extractPrimKey(a), extractPrimKey(b));\n        });\n        if (req.limit && req.limit < Infinity) {\n            if (finalResult.length > req.limit) {\n                finalResult.length = req.limit;\n            }\n            else if (result.length === req.limit && finalResult.length < req.limit) {\n                cacheEntry.dirty = true;\n            }\n        }\n        return immutable ? Object.freeze(finalResult) : finalResult;\n    }\n\n    function areRangesEqual(r1, r2) {\n        return (cmp(r1.lower, r2.lower) === 0 &&\n            cmp(r1.upper, r2.upper) === 0 &&\n            !!r1.lowerOpen === !!r2.lowerOpen &&\n            !!r1.upperOpen === !!r2.upperOpen);\n    }\n\n    function compareLowers(lower1, lower2, lowerOpen1, lowerOpen2) {\n        if (lower1 === undefined)\n            return lower2 !== undefined ? -1 : 0;\n        if (lower2 === undefined)\n            return 1;\n        var c = cmp(lower1, lower2);\n        if (c === 0) {\n            if (lowerOpen1 && lowerOpen2)\n                return 0;\n            if (lowerOpen1)\n                return 1;\n            if (lowerOpen2)\n                return -1;\n        }\n        return c;\n    }\n    function compareUppers(upper1, upper2, upperOpen1, upperOpen2) {\n        if (upper1 === undefined)\n            return upper2 !== undefined ? 1 : 0;\n        if (upper2 === undefined)\n            return -1;\n        var c = cmp(upper1, upper2);\n        if (c === 0) {\n            if (upperOpen1 && upperOpen2)\n                return 0;\n            if (upperOpen1)\n                return -1;\n            if (upperOpen2)\n                return 1;\n        }\n        return c;\n    }\n    function isSuperRange(r1, r2) {\n        return (compareLowers(r1.lower, r2.lower, r1.lowerOpen, r2.lowerOpen) <= 0 &&\n            compareUppers(r1.upper, r2.upper, r1.upperOpen, r2.upperOpen) >= 0);\n    }\n\n    function findCompatibleQuery(dbName, tableName, type, req) {\n        var tblCache = cache[\"idb://\".concat(dbName, \"/\").concat(tableName)];\n        if (!tblCache)\n            return [];\n        var queries = tblCache.queries[type];\n        if (!queries)\n            return [null, false, tblCache, null];\n        var indexName = req.query ? req.query.index.name : null;\n        var entries = queries[indexName || ''];\n        if (!entries)\n            return [null, false, tblCache, null];\n        switch (type) {\n            case 'query':\n                var equalEntry = entries.find(function (entry) {\n                    return entry.req.limit === req.limit &&\n                        entry.req.values === req.values &&\n                        areRangesEqual(entry.req.query.range, req.query.range);\n                });\n                if (equalEntry)\n                    return [\n                        equalEntry,\n                        true,\n                        tblCache,\n                        entries,\n                    ];\n                var superEntry = entries.find(function (entry) {\n                    var limit = 'limit' in entry.req ? entry.req.limit : Infinity;\n                    return (limit >= req.limit &&\n                        (req.values ? entry.req.values : true) &&\n                        isSuperRange(entry.req.query.range, req.query.range));\n                });\n                return [superEntry, false, tblCache, entries];\n            case 'count':\n                var countQuery = entries.find(function (entry) {\n                    return areRangesEqual(entry.req.query.range, req.query.range);\n                });\n                return [countQuery, !!countQuery, tblCache, entries];\n        }\n    }\n\n    function subscribeToCacheEntry(cacheEntry, container, requery, signal) {\n        cacheEntry.subscribers.add(requery);\n        signal.addEventListener(\"abort\", function () {\n            cacheEntry.subscribers.delete(requery);\n            if (cacheEntry.subscribers.size === 0) {\n                enqueForDeletion(cacheEntry, container);\n            }\n        });\n    }\n    function enqueForDeletion(cacheEntry, container) {\n        setTimeout(function () {\n            if (cacheEntry.subscribers.size === 0) {\n                delArrayItem(container, cacheEntry);\n            }\n        }, 3000);\n    }\n\n    var cacheMiddleware = {\n        stack: 'dbcore',\n        level: 0,\n        name: 'Cache',\n        create: function (core) {\n            var dbName = core.schema.name;\n            var coreMW = __assign(__assign({}, core), { transaction: function (stores, mode, options) {\n                    var idbtrans = core.transaction(stores, mode, options);\n                    if (mode === 'readwrite') {\n                        var ac_1 = new AbortController();\n                        var signal = ac_1.signal;\n                        var endTransaction = function (wasCommitted) { return function () {\n                            ac_1.abort();\n                            if (mode === 'readwrite') {\n                                var affectedSubscribers_1 = new Set();\n                                for (var _i = 0, stores_1 = stores; _i < stores_1.length; _i++) {\n                                    var storeName = stores_1[_i];\n                                    var tblCache = cache[\"idb://\".concat(dbName, \"/\").concat(storeName)];\n                                    if (tblCache) {\n                                        var table = core.table(storeName);\n                                        var ops = tblCache.optimisticOps.filter(function (op) { return op.trans === idbtrans; });\n                                        if (idbtrans._explicit && wasCommitted && idbtrans.mutatedParts) {\n                                            for (var _a = 0, _b = Object.values(tblCache.queries.query); _a < _b.length; _a++) {\n                                                var entries = _b[_a];\n                                                for (var _c = 0, _d = entries.slice(); _c < _d.length; _c++) {\n                                                    var entry = _d[_c];\n                                                    if (obsSetsOverlap(entry.obsSet, idbtrans.mutatedParts)) {\n                                                        delArrayItem(entries, entry);\n                                                        entry.subscribers.forEach(function (requery) { return affectedSubscribers_1.add(requery); });\n                                                    }\n                                                }\n                                            }\n                                        }\n                                        else if (ops.length > 0) {\n                                            tblCache.optimisticOps = tblCache.optimisticOps.filter(function (op) { return op.trans !== idbtrans; });\n                                            for (var _e = 0, _f = Object.values(tblCache.queries.query); _e < _f.length; _e++) {\n                                                var entries = _f[_e];\n                                                for (var _g = 0, _h = entries.slice(); _g < _h.length; _g++) {\n                                                    var entry = _h[_g];\n                                                    if (entry.res != null &&\n                                                        idbtrans.mutatedParts\n    ) {\n                                                        if (wasCommitted && !entry.dirty) {\n                                                            var freezeResults = Object.isFrozen(entry.res);\n                                                            var modRes = applyOptimisticOps(entry.res, entry.req, ops, table, entry, freezeResults);\n                                                            if (entry.dirty) {\n                                                                delArrayItem(entries, entry);\n                                                                entry.subscribers.forEach(function (requery) { return affectedSubscribers_1.add(requery); });\n                                                            }\n                                                            else if (modRes !== entry.res) {\n                                                                entry.res = modRes;\n                                                                entry.promise = DexiePromise.resolve({ result: modRes });\n                                                            }\n                                                        }\n                                                        else {\n                                                            if (entry.dirty) {\n                                                                delArrayItem(entries, entry);\n                                                            }\n                                                            entry.subscribers.forEach(function (requery) { return affectedSubscribers_1.add(requery); });\n                                                        }\n                                                    }\n                                                }\n                                            }\n                                        }\n                                    }\n                                }\n                                affectedSubscribers_1.forEach(function (requery) { return requery(); });\n                            }\n                        }; };\n                        idbtrans.addEventListener('abort', endTransaction(false), {\n                            signal: signal,\n                        });\n                        idbtrans.addEventListener('error', endTransaction(false), {\n                            signal: signal,\n                        });\n                        idbtrans.addEventListener('complete', endTransaction(true), {\n                            signal: signal,\n                        });\n                    }\n                    return idbtrans;\n                }, table: function (tableName) {\n                    var downTable = core.table(tableName);\n                    var primKey = downTable.schema.primaryKey;\n                    var tableMW = __assign(__assign({}, downTable), { mutate: function (req) {\n                            var trans = PSD.trans;\n                            if (primKey.outbound ||\n                                trans.db._options.cache === 'disabled' ||\n                                trans.explicit ||\n                                trans.idbtrans.mode !== 'readwrite'\n                            ) {\n                                return downTable.mutate(req);\n                            }\n                            var tblCache = cache[\"idb://\".concat(dbName, \"/\").concat(tableName)];\n                            if (!tblCache)\n                                return downTable.mutate(req);\n                            var promise = downTable.mutate(req);\n                            if ((req.type === 'add' || req.type === 'put') && (req.values.length >= 50 || getEffectiveKeys(primKey, req).some(function (key) { return key == null; }))) {\n                                promise.then(function (res) {\n                                    var reqWithResolvedKeys = __assign(__assign({}, req), { values: req.values.map(function (value, i) {\n                                            var _a;\n                                            if (res.failures[i])\n                                                return value;\n                                            var valueWithKey = ((_a = primKey.keyPath) === null || _a === void 0 ? void 0 : _a.includes('.'))\n                                                ? deepClone(value)\n                                                : __assign({}, value);\n                                            setByKeyPath(valueWithKey, primKey.keyPath, res.results[i]);\n                                            return valueWithKey;\n                                        }) });\n                                    var adjustedReq = adjustOptimisticFromFailures(tblCache, reqWithResolvedKeys, res);\n                                    tblCache.optimisticOps.push(adjustedReq);\n                                    queueMicrotask(function () { return req.mutatedParts && signalSubscribersLazily(req.mutatedParts); });\n                                });\n                            }\n                            else {\n                                tblCache.optimisticOps.push(req);\n                                req.mutatedParts && signalSubscribersLazily(req.mutatedParts);\n                                promise.then(function (res) {\n                                    if (res.numFailures > 0) {\n                                        delArrayItem(tblCache.optimisticOps, req);\n                                        var adjustedReq = adjustOptimisticFromFailures(tblCache, req, res);\n                                        if (adjustedReq) {\n                                            tblCache.optimisticOps.push(adjustedReq);\n                                        }\n                                        req.mutatedParts && signalSubscribersLazily(req.mutatedParts);\n                                    }\n                                });\n                                promise.catch(function () {\n                                    delArrayItem(tblCache.optimisticOps, req);\n                                    req.mutatedParts && signalSubscribersLazily(req.mutatedParts);\n                                });\n                            }\n                            return promise;\n                        }, query: function (req) {\n                            var _a;\n                            if (!isCachableContext(PSD, downTable) || !isCachableRequest(\"query\", req))\n                                return downTable.query(req);\n                            var freezeResults = ((_a = PSD.trans) === null || _a === void 0 ? void 0 : _a.db._options.cache) === 'immutable';\n                            var _b = PSD, requery = _b.requery, signal = _b.signal;\n                            var _c = findCompatibleQuery(dbName, tableName, 'query', req), cacheEntry = _c[0], exactMatch = _c[1], tblCache = _c[2], container = _c[3];\n                            if (cacheEntry && exactMatch) {\n                                cacheEntry.obsSet = req.obsSet;\n                            }\n                            else {\n                                var promise = downTable.query(req).then(function (res) {\n                                    var result = res.result;\n                                    if (cacheEntry)\n                                        cacheEntry.res = result;\n                                    if (freezeResults) {\n                                        for (var i = 0, l = result.length; i < l; ++i) {\n                                            Object.freeze(result[i]);\n                                        }\n                                        Object.freeze(result);\n                                    }\n                                    else {\n                                        res.result = deepClone(result);\n                                    }\n                                    return res;\n                                }).catch(function (error) {\n                                    if (container && cacheEntry)\n                                        delArrayItem(container, cacheEntry);\n                                    return Promise.reject(error);\n                                });\n                                cacheEntry = {\n                                    obsSet: req.obsSet,\n                                    promise: promise,\n                                    subscribers: new Set(),\n                                    type: 'query',\n                                    req: req,\n                                    dirty: false,\n                                };\n                                if (container) {\n                                    container.push(cacheEntry);\n                                }\n                                else {\n                                    container = [cacheEntry];\n                                    if (!tblCache) {\n                                        tblCache = cache[\"idb://\".concat(dbName, \"/\").concat(tableName)] = {\n                                            queries: {\n                                                query: {},\n                                                count: {},\n                                            },\n                                            objs: new Map(),\n                                            optimisticOps: [],\n                                            unsignaledParts: {}\n                                        };\n                                    }\n                                    tblCache.queries.query[req.query.index.name || ''] = container;\n                                }\n                            }\n                            subscribeToCacheEntry(cacheEntry, container, requery, signal);\n                            return cacheEntry.promise.then(function (res) {\n                                return {\n                                    result: applyOptimisticOps(res.result, req, tblCache === null || tblCache === void 0 ? void 0 : tblCache.optimisticOps, downTable, cacheEntry, freezeResults),\n                                };\n                            });\n                        } });\n                    return tableMW;\n                } });\n            return coreMW;\n        },\n    };\n\n    function vipify(target, vipDb) {\n        return new Proxy(target, {\n            get: function (target, prop, receiver) {\n                if (prop === 'db')\n                    return vipDb;\n                return Reflect.get(target, prop, receiver);\n            }\n        });\n    }\n\n    var Dexie$1 =  (function () {\n        function Dexie(name, options) {\n            var _this = this;\n            this._middlewares = {};\n            this.verno = 0;\n            var deps = Dexie.dependencies;\n            this._options = options = __assign({\n                addons: Dexie.addons, autoOpen: true,\n                indexedDB: deps.indexedDB, IDBKeyRange: deps.IDBKeyRange, cache: 'cloned' }, options);\n            this._deps = {\n                indexedDB: options.indexedDB,\n                IDBKeyRange: options.IDBKeyRange\n            };\n            var addons = options.addons;\n            this._dbSchema = {};\n            this._versions = [];\n            this._storeNames = [];\n            this._allTables = {};\n            this.idbdb = null;\n            this._novip = this;\n            var state = {\n                dbOpenError: null,\n                isBeingOpened: false,\n                onReadyBeingFired: null,\n                openComplete: false,\n                dbReadyResolve: nop,\n                dbReadyPromise: null,\n                cancelOpen: nop,\n                openCanceller: null,\n                autoSchema: true,\n                PR1398_maxLoop: 3,\n                autoOpen: options.autoOpen,\n            };\n            state.dbReadyPromise = new DexiePromise(function (resolve) {\n                state.dbReadyResolve = resolve;\n            });\n            state.openCanceller = new DexiePromise(function (_, reject) {\n                state.cancelOpen = reject;\n            });\n            this._state = state;\n            this.name = name;\n            this.on = Events(this, \"populate\", \"blocked\", \"versionchange\", \"close\", { ready: [promisableChain, nop] });\n            this.on.ready.subscribe = override(this.on.ready.subscribe, function (subscribe) {\n                return function (subscriber, bSticky) {\n                    Dexie.vip(function () {\n                        var state = _this._state;\n                        if (state.openComplete) {\n                            if (!state.dbOpenError)\n                                DexiePromise.resolve().then(subscriber);\n                            if (bSticky)\n                                subscribe(subscriber);\n                        }\n                        else if (state.onReadyBeingFired) {\n                            state.onReadyBeingFired.push(subscriber);\n                            if (bSticky)\n                                subscribe(subscriber);\n                        }\n                        else {\n                            subscribe(subscriber);\n                            var db_1 = _this;\n                            if (!bSticky)\n                                subscribe(function unsubscribe() {\n                                    db_1.on.ready.unsubscribe(subscriber);\n                                    db_1.on.ready.unsubscribe(unsubscribe);\n                                });\n                        }\n                    });\n                };\n            });\n            this.Collection = createCollectionConstructor(this);\n            this.Table = createTableConstructor(this);\n            this.Transaction = createTransactionConstructor(this);\n            this.Version = createVersionConstructor(this);\n            this.WhereClause = createWhereClauseConstructor(this);\n            this.on(\"versionchange\", function (ev) {\n                if (ev.newVersion > 0)\n                    console.warn(\"Another connection wants to upgrade database '\".concat(_this.name, \"'. Closing db now to resume the upgrade.\"));\n                else\n                    console.warn(\"Another connection wants to delete database '\".concat(_this.name, \"'. Closing db now to resume the delete request.\"));\n                _this.close({ disableAutoOpen: false });\n            });\n            this.on(\"blocked\", function (ev) {\n                if (!ev.newVersion || ev.newVersion < ev.oldVersion)\n                    console.warn(\"Dexie.delete('\".concat(_this.name, \"') was blocked\"));\n                else\n                    console.warn(\"Upgrade '\".concat(_this.name, \"' blocked by other connection holding version \").concat(ev.oldVersion / 10));\n            });\n            this._maxKey = getMaxKey(options.IDBKeyRange);\n            this._createTransaction = function (mode, storeNames, dbschema, parentTransaction) { return new _this.Transaction(mode, storeNames, dbschema, _this._options.chromeTransactionDurability, parentTransaction); };\n            this._fireOnBlocked = function (ev) {\n                _this.on(\"blocked\").fire(ev);\n                connections\n                    .filter(function (c) { return c.name === _this.name && c !== _this && !c._state.vcFired; })\n                    .map(function (c) { return c.on(\"versionchange\").fire(ev); });\n            };\n            this.use(cacheExistingValuesMiddleware);\n            this.use(cacheMiddleware);\n            this.use(observabilityMiddleware);\n            this.use(virtualIndexMiddleware);\n            this.use(hooksMiddleware);\n            var vipDB = new Proxy(this, {\n                get: function (_, prop, receiver) {\n                    if (prop === '_vip')\n                        return true;\n                    if (prop === 'table')\n                        return function (tableName) { return vipify(_this.table(tableName), vipDB); };\n                    var rv = Reflect.get(_, prop, receiver);\n                    if (rv instanceof Table)\n                        return vipify(rv, vipDB);\n                    if (prop === 'tables')\n                        return rv.map(function (t) { return vipify(t, vipDB); });\n                    if (prop === '_createTransaction')\n                        return function () {\n                            var tx = rv.apply(this, arguments);\n                            return vipify(tx, vipDB);\n                        };\n                    return rv;\n                }\n            });\n            this.vip = vipDB;\n            addons.forEach(function (addon) { return addon(_this); });\n        }\n        Dexie.prototype.version = function (versionNumber) {\n            if (isNaN(versionNumber) || versionNumber < 0.1)\n                throw new exceptions.Type(\"Given version is not a positive number\");\n            versionNumber = Math.round(versionNumber * 10) / 10;\n            if (this.idbdb || this._state.isBeingOpened)\n                throw new exceptions.Schema(\"Cannot add version when database is open\");\n            this.verno = Math.max(this.verno, versionNumber);\n            var versions = this._versions;\n            var versionInstance = versions.filter(function (v) { return v._cfg.version === versionNumber; })[0];\n            if (versionInstance)\n                return versionInstance;\n            versionInstance = new this.Version(versionNumber);\n            versions.push(versionInstance);\n            versions.sort(lowerVersionFirst);\n            versionInstance.stores({});\n            this._state.autoSchema = false;\n            return versionInstance;\n        };\n        Dexie.prototype._whenReady = function (fn) {\n            var _this = this;\n            return (this.idbdb && (this._state.openComplete || PSD.letThrough || this._vip)) ? fn() : new DexiePromise(function (resolve, reject) {\n                if (_this._state.openComplete) {\n                    return reject(new exceptions.DatabaseClosed(_this._state.dbOpenError));\n                }\n                if (!_this._state.isBeingOpened) {\n                    if (!_this._state.autoOpen) {\n                        reject(new exceptions.DatabaseClosed());\n                        return;\n                    }\n                    _this.open().catch(nop);\n                }\n                _this._state.dbReadyPromise.then(resolve, reject);\n            }).then(fn);\n        };\n        Dexie.prototype.use = function (_a) {\n            var stack = _a.stack, create = _a.create, level = _a.level, name = _a.name;\n            if (name)\n                this.unuse({ stack: stack, name: name });\n            var middlewares = this._middlewares[stack] || (this._middlewares[stack] = []);\n            middlewares.push({ stack: stack, create: create, level: level == null ? 10 : level, name: name });\n            middlewares.sort(function (a, b) { return a.level - b.level; });\n            return this;\n        };\n        Dexie.prototype.unuse = function (_a) {\n            var stack = _a.stack, name = _a.name, create = _a.create;\n            if (stack && this._middlewares[stack]) {\n                this._middlewares[stack] = this._middlewares[stack].filter(function (mw) {\n                    return create ? mw.create !== create :\n                        name ? mw.name !== name :\n                            false;\n                });\n            }\n            return this;\n        };\n        Dexie.prototype.open = function () {\n            var _this = this;\n            return usePSD(globalPSD,\n            function () { return dexieOpen(_this); });\n        };\n        Dexie.prototype._close = function () {\n            var state = this._state;\n            var idx = connections.indexOf(this);\n            if (idx >= 0)\n                connections.splice(idx, 1);\n            if (this.idbdb) {\n                try {\n                    this.idbdb.close();\n                }\n                catch (e) { }\n                this.idbdb = null;\n            }\n            if (!state.isBeingOpened) {\n                state.dbReadyPromise = new DexiePromise(function (resolve) {\n                    state.dbReadyResolve = resolve;\n                });\n                state.openCanceller = new DexiePromise(function (_, reject) {\n                    state.cancelOpen = reject;\n                });\n            }\n        };\n        Dexie.prototype.close = function (_a) {\n            var _b = _a === void 0 ? { disableAutoOpen: true } : _a, disableAutoOpen = _b.disableAutoOpen;\n            var state = this._state;\n            if (disableAutoOpen) {\n                if (state.isBeingOpened) {\n                    state.cancelOpen(new exceptions.DatabaseClosed());\n                }\n                this._close();\n                state.autoOpen = false;\n                state.dbOpenError = new exceptions.DatabaseClosed();\n            }\n            else {\n                this._close();\n                state.autoOpen = this._options.autoOpen ||\n                    state.isBeingOpened;\n                state.openComplete = false;\n                state.dbOpenError = null;\n            }\n        };\n        Dexie.prototype.delete = function (closeOptions) {\n            var _this = this;\n            if (closeOptions === void 0) { closeOptions = { disableAutoOpen: true }; }\n            var hasInvalidArguments = arguments.length > 0 && typeof arguments[0] !== 'object';\n            var state = this._state;\n            return new DexiePromise(function (resolve, reject) {\n                var doDelete = function () {\n                    _this.close(closeOptions);\n                    var req = _this._deps.indexedDB.deleteDatabase(_this.name);\n                    req.onsuccess = wrap(function () {\n                        _onDatabaseDeleted(_this._deps, _this.name);\n                        resolve();\n                    });\n                    req.onerror = eventRejectHandler(reject);\n                    req.onblocked = _this._fireOnBlocked;\n                };\n                if (hasInvalidArguments)\n                    throw new exceptions.InvalidArgument(\"Invalid closeOptions argument to db.delete()\");\n                if (state.isBeingOpened) {\n                    state.dbReadyPromise.then(doDelete);\n                }\n                else {\n                    doDelete();\n                }\n            });\n        };\n        Dexie.prototype.backendDB = function () {\n            return this.idbdb;\n        };\n        Dexie.prototype.isOpen = function () {\n            return this.idbdb !== null;\n        };\n        Dexie.prototype.hasBeenClosed = function () {\n            var dbOpenError = this._state.dbOpenError;\n            return dbOpenError && (dbOpenError.name === 'DatabaseClosed');\n        };\n        Dexie.prototype.hasFailed = function () {\n            return this._state.dbOpenError !== null;\n        };\n        Dexie.prototype.dynamicallyOpened = function () {\n            return this._state.autoSchema;\n        };\n        Object.defineProperty(Dexie.prototype, \"tables\", {\n            get: function () {\n                var _this = this;\n                return keys(this._allTables).map(function (name) { return _this._allTables[name]; });\n            },\n            enumerable: false,\n            configurable: true\n        });\n        Dexie.prototype.transaction = function () {\n            var args = extractTransactionArgs.apply(this, arguments);\n            return this._transaction.apply(this, args);\n        };\n        Dexie.prototype._transaction = function (mode, tables, scopeFunc) {\n            var _this = this;\n            var parentTransaction = PSD.trans;\n            if (!parentTransaction || parentTransaction.db !== this || mode.indexOf('!') !== -1)\n                parentTransaction = null;\n            var onlyIfCompatible = mode.indexOf('?') !== -1;\n            mode = mode.replace('!', '').replace('?', '');\n            var idbMode, storeNames;\n            try {\n                storeNames = tables.map(function (table) {\n                    var storeName = table instanceof _this.Table ? table.name : table;\n                    if (typeof storeName !== 'string')\n                        throw new TypeError(\"Invalid table argument to Dexie.transaction(). Only Table or String are allowed\");\n                    return storeName;\n                });\n                if (mode == \"r\" || mode === READONLY)\n                    idbMode = READONLY;\n                else if (mode == \"rw\" || mode == READWRITE)\n                    idbMode = READWRITE;\n                else\n                    throw new exceptions.InvalidArgument(\"Invalid transaction mode: \" + mode);\n                if (parentTransaction) {\n                    if (parentTransaction.mode === READONLY && idbMode === READWRITE) {\n                        if (onlyIfCompatible) {\n                            parentTransaction = null;\n                        }\n                        else\n                            throw new exceptions.SubTransaction(\"Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY\");\n                    }\n                    if (parentTransaction) {\n                        storeNames.forEach(function (storeName) {\n                            if (parentTransaction && parentTransaction.storeNames.indexOf(storeName) === -1) {\n                                if (onlyIfCompatible) {\n                                    parentTransaction = null;\n                                }\n                                else\n                                    throw new exceptions.SubTransaction(\"Table \" + storeName +\n                                        \" not included in parent transaction.\");\n                            }\n                        });\n                    }\n                    if (onlyIfCompatible && parentTransaction && !parentTransaction.active) {\n                        parentTransaction = null;\n                    }\n                }\n            }\n            catch (e) {\n                return parentTransaction ?\n                    parentTransaction._promise(null, function (_, reject) { reject(e); }) :\n                    rejection(e);\n            }\n            var enterTransaction = enterTransactionScope.bind(null, this, idbMode, storeNames, parentTransaction, scopeFunc);\n            return (parentTransaction ?\n                parentTransaction._promise(idbMode, enterTransaction, \"lock\") :\n                PSD.trans ?\n                    usePSD(PSD.transless, function () { return _this._whenReady(enterTransaction); }) :\n                    this._whenReady(enterTransaction));\n        };\n        Dexie.prototype.table = function (tableName) {\n            if (!hasOwn(this._allTables, tableName)) {\n                throw new exceptions.InvalidTable(\"Table \".concat(tableName, \" does not exist\"));\n            }\n            return this._allTables[tableName];\n        };\n        return Dexie;\n    }());\n\n    var symbolObservable = typeof Symbol !== \"undefined\" && \"observable\" in Symbol\n        ? Symbol.observable\n        : \"@@observable\";\n    var Observable =  (function () {\n        function Observable(subscribe) {\n            this._subscribe = subscribe;\n        }\n        Observable.prototype.subscribe = function (x, error, complete) {\n            return this._subscribe(!x || typeof x === \"function\" ? { next: x, error: error, complete: complete } : x);\n        };\n        Observable.prototype[symbolObservable] = function () {\n            return this;\n        };\n        return Observable;\n    }());\n\n    var domDeps;\n    try {\n        domDeps = {\n            indexedDB: _global.indexedDB || _global.mozIndexedDB || _global.webkitIndexedDB || _global.msIndexedDB,\n            IDBKeyRange: _global.IDBKeyRange || _global.webkitIDBKeyRange\n        };\n    }\n    catch (e) {\n        domDeps = { indexedDB: null, IDBKeyRange: null };\n    }\n\n    function liveQuery(querier) {\n        var hasValue = false;\n        var currentValue;\n        var observable = new Observable(function (observer) {\n            var scopeFuncIsAsync = isAsyncFunction(querier);\n            function execute(ctx) {\n                var wasRootExec = beginMicroTickScope();\n                try {\n                    if (scopeFuncIsAsync) {\n                        incrementExpectedAwaits();\n                    }\n                    var rv = newScope(querier, ctx);\n                    if (scopeFuncIsAsync) {\n                        rv = rv.finally(decrementExpectedAwaits);\n                    }\n                    return rv;\n                }\n                finally {\n                    wasRootExec && endMicroTickScope();\n                }\n            }\n            var closed = false;\n            var abortController;\n            var accumMuts = {};\n            var currentObs = {};\n            var subscription = {\n                get closed() {\n                    return closed;\n                },\n                unsubscribe: function () {\n                    if (closed)\n                        return;\n                    closed = true;\n                    if (abortController)\n                        abortController.abort();\n                    if (startedListening)\n                        globalEvents.storagemutated.unsubscribe(mutationListener);\n                },\n            };\n            observer.start && observer.start(subscription);\n            var startedListening = false;\n            var doQuery = function () { return execInGlobalContext(_doQuery); };\n            function shouldNotify() {\n                return obsSetsOverlap(currentObs, accumMuts);\n            }\n            var mutationListener = function (parts) {\n                extendObservabilitySet(accumMuts, parts);\n                if (shouldNotify()) {\n                    doQuery();\n                }\n            };\n            var _doQuery = function () {\n                if (closed ||\n                    !domDeps.indexedDB)\n                 {\n                    return;\n                }\n                accumMuts = {};\n                var subscr = {};\n                if (abortController)\n                    abortController.abort();\n                abortController = new AbortController();\n                var ctx = {\n                    subscr: subscr,\n                    signal: abortController.signal,\n                    requery: doQuery,\n                    querier: querier,\n                    trans: null\n                };\n                var ret = execute(ctx);\n                Promise.resolve(ret).then(function (result) {\n                    hasValue = true;\n                    currentValue = result;\n                    if (closed || ctx.signal.aborted) {\n                        return;\n                    }\n                    accumMuts = {};\n                    currentObs = subscr;\n                    if (!objectIsEmpty(currentObs) && !startedListening) {\n                        globalEvents(DEXIE_STORAGE_MUTATED_EVENT_NAME, mutationListener);\n                        startedListening = true;\n                    }\n                    execInGlobalContext(function () { return !closed && observer.next && observer.next(result); });\n                }, function (err) {\n                    hasValue = false;\n                    if (!['DatabaseClosedError', 'AbortError'].includes(err === null || err === void 0 ? void 0 : err.name)) {\n                        if (!closed)\n                            execInGlobalContext(function () {\n                                if (closed)\n                                    return;\n                                observer.error && observer.error(err);\n                            });\n                    }\n                });\n            };\n            setTimeout(doQuery, 0);\n            return subscription;\n        });\n        observable.hasValue = function () { return hasValue; };\n        observable.getValue = function () { return currentValue; };\n        return observable;\n    }\n\n    var Dexie = Dexie$1;\n    props(Dexie, __assign(__assign({}, fullNameExceptions), {\n        delete: function (databaseName) {\n            var db = new Dexie(databaseName, { addons: [] });\n            return db.delete();\n        },\n        exists: function (name) {\n            return new Dexie(name, { addons: [] }).open().then(function (db) {\n                db.close();\n                return true;\n            }).catch('NoSuchDatabaseError', function () { return false; });\n        },\n        getDatabaseNames: function (cb) {\n            try {\n                return getDatabaseNames(Dexie.dependencies).then(cb);\n            }\n            catch (_a) {\n                return rejection(new exceptions.MissingAPI());\n            }\n        },\n        defineClass: function () {\n            function Class(content) {\n                extend(this, content);\n            }\n            return Class;\n        }, ignoreTransaction: function (scopeFunc) {\n            return PSD.trans ?\n                usePSD(PSD.transless, scopeFunc) :\n                scopeFunc();\n        }, vip: vip, async: function (generatorFn) {\n            return function () {\n                try {\n                    var rv = awaitIterator(generatorFn.apply(this, arguments));\n                    if (!rv || typeof rv.then !== 'function')\n                        return DexiePromise.resolve(rv);\n                    return rv;\n                }\n                catch (e) {\n                    return rejection(e);\n                }\n            };\n        }, spawn: function (generatorFn, args, thiz) {\n            try {\n                var rv = awaitIterator(generatorFn.apply(thiz, args || []));\n                if (!rv || typeof rv.then !== 'function')\n                    return DexiePromise.resolve(rv);\n                return rv;\n            }\n            catch (e) {\n                return rejection(e);\n            }\n        },\n        currentTransaction: {\n            get: function () { return PSD.trans || null; }\n        }, waitFor: function (promiseOrFunction, optionalTimeout) {\n            var promise = DexiePromise.resolve(typeof promiseOrFunction === 'function' ?\n                Dexie.ignoreTransaction(promiseOrFunction) :\n                promiseOrFunction)\n                .timeout(optionalTimeout || 60000);\n            return PSD.trans ?\n                PSD.trans.waitFor(promise) :\n                promise;\n        },\n        Promise: DexiePromise,\n        debug: {\n            get: function () { return debug; },\n            set: function (value) {\n                setDebug(value);\n            }\n        },\n        derive: derive, extend: extend, props: props, override: override,\n        Events: Events, on: globalEvents, liveQuery: liveQuery, extendObservabilitySet: extendObservabilitySet,\n        getByKeyPath: getByKeyPath, setByKeyPath: setByKeyPath, delByKeyPath: delByKeyPath, shallowClone: shallowClone, deepClone: deepClone, getObjectDiff: getObjectDiff, cmp: cmp, asap: asap$1,\n        minKey: minKey,\n        addons: [],\n        connections: connections,\n        errnames: errnames,\n        dependencies: domDeps, cache: cache,\n        semVer: DEXIE_VERSION, version: DEXIE_VERSION.split('.')\n            .map(function (n) { return parseInt(n); })\n            .reduce(function (p, c, i) { return p + (c / Math.pow(10, i * 2)); }) }));\n    Dexie.maxKey = getMaxKey(Dexie.dependencies.IDBKeyRange);\n\n    if (typeof dispatchEvent !== 'undefined' && typeof addEventListener !== 'undefined') {\n        globalEvents(DEXIE_STORAGE_MUTATED_EVENT_NAME, function (updatedParts) {\n            if (!propagatingLocally) {\n                var event_1;\n                event_1 = new CustomEvent(STORAGE_MUTATED_DOM_EVENT_NAME, {\n                    detail: updatedParts\n                });\n                propagatingLocally = true;\n                dispatchEvent(event_1);\n                propagatingLocally = false;\n            }\n        });\n        addEventListener(STORAGE_MUTATED_DOM_EVENT_NAME, function (_a) {\n            var detail = _a.detail;\n            if (!propagatingLocally) {\n                propagateLocally(detail);\n            }\n        });\n    }\n    function propagateLocally(updateParts) {\n        var wasMe = propagatingLocally;\n        try {\n            propagatingLocally = true;\n            globalEvents.storagemutated.fire(updateParts);\n            signalSubscribersNow(updateParts, true);\n        }\n        finally {\n            propagatingLocally = wasMe;\n        }\n    }\n    var propagatingLocally = false;\n\n    var bc;\n    var createBC = function () { };\n    if (typeof BroadcastChannel !== 'undefined') {\n        createBC = function () {\n            bc = new BroadcastChannel(STORAGE_MUTATED_DOM_EVENT_NAME);\n            bc.onmessage = function (ev) { return ev.data && propagateLocally(ev.data); };\n        };\n        createBC();\n        if (typeof bc.unref === 'function') {\n            bc.unref();\n        }\n        globalEvents(DEXIE_STORAGE_MUTATED_EVENT_NAME, function (changedParts) {\n            if (!propagatingLocally) {\n                bc.postMessage(changedParts);\n            }\n        });\n    }\n\n    if (typeof addEventListener !== 'undefined') {\n        addEventListener('pagehide', function (event) {\n            if (!Dexie$1.disableBfCache && event.persisted) {\n                if (debug)\n                    console.debug('Dexie: handling persisted pagehide');\n                bc === null || bc === void 0 ? void 0 : bc.close();\n                for (var _i = 0, connections_1 = connections; _i < connections_1.length; _i++) {\n                    var db = connections_1[_i];\n                    db.close({ disableAutoOpen: false });\n                }\n            }\n        });\n        addEventListener('pageshow', function (event) {\n            if (!Dexie$1.disableBfCache && event.persisted) {\n                if (debug)\n                    console.debug('Dexie: handling persisted pageshow');\n                createBC();\n                propagateLocally({ all: new RangeSet(-Infinity, [[]]) });\n            }\n        });\n    }\n\n    function add(value) {\n        return new PropModification({ add: value });\n    }\n\n    function remove(value) {\n        return new PropModification({ remove: value });\n    }\n\n    function replacePrefix(a, b) {\n        return new PropModification({ replacePrefix: [a, b] });\n    }\n\n    DexiePromise.rejectionMapper = mapError;\n    setDebug(debug);\n\n    var namedExports = /*#__PURE__*/Object.freeze({\n        __proto__: null,\n        Dexie: Dexie$1,\n        liveQuery: liveQuery,\n        Entity: Entity,\n        cmp: cmp,\n        PropModification: PropModification,\n        replacePrefix: replacePrefix,\n        add: add,\n        remove: remove,\n        'default': Dexie$1,\n        RangeSet: RangeSet,\n        mergeRanges: mergeRanges,\n        rangesOverlap: rangesOverlap\n    });\n\n    __assign(Dexie$1, namedExports, { default: Dexie$1 });\n\n    return Dexie$1;\n\n}));\n//# sourceMappingURL=dexie.js.map\n","// Making the module version consumable via require - to prohibit\n// multiple occurrancies of the same module in the same app\n// (dual package hazard, https://nodejs.org/api/packages.html#dual-package-hazard)\nimport _Dexie from \"./dist/dexie.js\";\nconst DexieSymbol = Symbol.for(\"Dexie\");\nconst Dexie = globalThis[DexieSymbol] || (globalThis[DexieSymbol] = _Dexie);\nif (_Dexie.semVer !== Dexie.semVer) {\n    throw new Error(`Two different versions of Dexie loaded in the same app: ${_Dexie.semVer} and ${Dexie.semVer}`);\n}\nconst { liveQuery, mergeRanges, rangesOverlap, RangeSet, cmp, Entity,\n    PropModification, replacePrefix, add, remove } = Dexie;\nexport { liveQuery, mergeRanges, rangesOverlap, RangeSet, cmp, Dexie, Entity,\n    PropModification, replacePrefix, add, remove };\nexport default Dexie;\n","const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst transactionDoneMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    // This mapping exists in reverseTransformCache but doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(this.request);\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);\n        });\n    }\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event.newVersion, event));\n    }\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking) {\n            db.addEventListener('versionchange', (event) => blocking(event.oldVersion, event.newVersion, event));\n        }\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event));\n    }\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nconst advanceMethodProps = ['continue', 'continuePrimaryKey', 'advance'];\nconst methodMap = {};\nconst advanceResults = new WeakMap();\nconst ittrProxiedCursorToOriginalProxy = new WeakMap();\nconst cursorIteratorTraps = {\n    get(target, prop) {\n        if (!advanceMethodProps.includes(prop))\n            return target[prop];\n        let cachedFunc = methodMap[prop];\n        if (!cachedFunc) {\n            cachedFunc = methodMap[prop] = function (...args) {\n                advanceResults.set(this, ittrProxiedCursorToOriginalProxy.get(this)[prop](...args));\n            };\n        }\n        return cachedFunc;\n    },\n};\nasync function* iterate(...args) {\n    // tslint:disable-next-line:no-this-assignment\n    let cursor = this;\n    if (!(cursor instanceof IDBCursor)) {\n        cursor = await cursor.openCursor(...args);\n    }\n    if (!cursor)\n        return;\n    cursor = cursor;\n    const proxiedCursor = new Proxy(cursor, cursorIteratorTraps);\n    ittrProxiedCursorToOriginalProxy.set(proxiedCursor, cursor);\n    // Map this double-proxy back to the original, so other cursor methods work.\n    reverseTransformCache.set(proxiedCursor, unwrap(cursor));\n    while (cursor) {\n        yield proxiedCursor;\n        // If one of the advancing methods was not called, call continue().\n        cursor = await (advanceResults.get(proxiedCursor) || cursor.continue());\n        advanceResults.delete(proxiedCursor);\n    }\n}\nfunction isIteratorProp(target, prop) {\n    return ((prop === Symbol.asyncIterator &&\n        instanceOfAny(target, [IDBIndex, IDBObjectStore, IDBCursor])) ||\n        (prop === 'iterate' && instanceOfAny(target, [IDBIndex, IDBObjectStore])));\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get(target, prop, receiver) {\n        if (isIteratorProp(target, prop))\n            return iterate;\n        return oldTraps.get(target, prop, receiver);\n    },\n    has(target, prop) {\n        return isIteratorProp(target, prop) || oldTraps.has(target, prop);\n    },\n}));\n\nexport { deleteDB, openDB, unwrap, wrap };\n","// Error classes for specific use cases\nexport class ApiError extends Error {\n    statusCode;\n    details;\n    constructor(message, statusCode, details) {\n        super(message);\n        this.name = 'ApiError';\n        this.statusCode = statusCode;\n        this.details = details;\n    }\n}\nexport class LoggerError extends Error {\n    details = undefined;\n    constructor(message = '', name = 'LoggerError', details) {\n        super(message);\n        this.name = name;\n        this.details = details;\n    }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { LoggerError } from './Errors';\nimport { openDB } from 'idb'; // IndexedDB support\nimport Dexie from 'dexie'; // Dexie.js for IndexedDB\n// import { browser_ext } from \"$lib/common/environment\";\n// import { initSQLite, saveToSQLite } from \"./LoggerSQLite\"; // SQLite integration\nconst isBrowser = typeof window !== 'undefined';\n// Define log levels\nvar LogLevel;\n(function (LogLevel) {\n    LogLevel[LogLevel[\"DEBUG\"] = 0] = \"DEBUG\";\n    LogLevel[LogLevel[\"DEBUG_TRACE\"] = 1] = \"DEBUG_TRACE\";\n    LogLevel[LogLevel[\"INFO\"] = 2] = \"INFO\";\n    LogLevel[LogLevel[\"INFO_TRACE\"] = 3] = \"INFO_TRACE\";\n    LogLevel[LogLevel[\"WARN\"] = 4] = \"WARN\";\n    LogLevel[LogLevel[\"ERROR\"] = 5] = \"ERROR\";\n    LogLevel[LogLevel[\"ERROR_TRACE\"] = 6] = \"ERROR_TRACE\";\n    LogLevel[LogLevel[\"TRACE\"] = 7] = \"TRACE\";\n})(LogLevel || (LogLevel = {}));\nvar LogLevelDirection;\n(function (LogLevelDirection) {\n    LogLevelDirection[LogLevelDirection[\"NONE\"] = 0] = \"NONE\";\n    LogLevelDirection[LogLevelDirection[\"CONTAINS\"] = 1] = \"CONTAINS\";\n    LogLevelDirection[LogLevelDirection[\"LESSTHAN\"] = 2] = \"LESSTHAN\";\n    LogLevelDirection[LogLevelDirection[\"GREATERTHAN\"] = 3] = \"GREATERTHAN\";\n    LogLevelDirection[LogLevelDirection[\"EQUAL\"] = 4] = \"EQUAL\";\n    LogLevelDirection[LogLevelDirection[\"GREATERTHANOREQUAL\"] = 5] = \"GREATERTHANOREQUAL\";\n    LogLevelDirection[LogLevelDirection[\"LESSTHANOREQUAL\"] = 6] = \"LESSTHANOREQUAL\";\n})(LogLevelDirection || (LogLevelDirection = {}));\n// Color styles for browser console logs\nconst COLORS = {\n    DEBUG: 'color: purple; font-weight: bold;',\n    DEBUG_TRACE: 'color: purple; font-weight: bold;',\n    INFO: 'color: green; font-weight: bold;',\n    INFO_TRACE: 'color: green; font-weight: bold;',\n    WARN: 'color: orange; font-weight: bold;',\n    ERROR: 'color: red; font-weight: bold;',\n    ERROR_TRACE: 'color: red; font-weight: bold;',\n    TRACE: 'color: blue; font-weight: bold;'\n};\nconst MAX_STORED_LOGS = 500; // Maximum number of logs to keep in storage\nconst STORAGE_KEY = 'yakklLogs'; // Key for localStorage\n/**\n * Logger class with structured logging, log levels, and optional regex filtering.\n */\nclass Logger {\n    static instance = null;\n    logLevel;\n    logLevelDirection;\n    logsIncluded = [];\n    logRegEx = /^(DEBUG|DEBUG_TRACE|INFO|INFO_TRACE|WARN|ERROR|ERROR_TRACE|TRACE)$/;\n    logFilterEnabled = false;\n    stackIndex = 4;\n    backend = 'localStorage'; // Default logging backend. 'console' should always display and the other values will only get used if persist is true\n    minLogLevel = LogLevel.ERROR;\n    constructor(level = LogLevel.DEBUG, direction = LogLevelDirection.LESSTHAN, logsIncluded = [\n        'DEBUG',\n        'DEBUG_TRACE',\n        'INFO',\n        'INFO_TRACE',\n        'WARN',\n        'ERROR',\n        'ERROR_TRACE',\n        'TRACE'\n    ]) {\n        this.logLevel = level;\n        this.logLevelDirection = direction;\n        this.logsIncluded = logsIncluded;\n    }\n    // Add singleton getter\n    static getInstance() {\n        if (!Logger.instance) {\n            Logger.instance = new Logger();\n        }\n        return Logger.instance;\n    }\n    // Add setter for minimum log level\n    setMinimumLogLevel(level) {\n        this.minLogLevel = level;\n    }\n    setLevel(level, direction, logsIncluded = [\n        'DEBUG',\n        'DEBUG_TRACE',\n        'INFO',\n        'INFO_TRACE',\n        'WARN',\n        'ERROR',\n        'ERROR_TRACE',\n        'TRACE'\n    ]) {\n        this.logLevel = LogLevel[level];\n        this.logLevelDirection = LogLevelDirection[direction];\n        this.logsIncluded = logsIncluded;\n    }\n    /**\n     * Enables or disables regex-based log filtering.\n     */\n    setLogFilterEnabled(enabled) {\n        this.logFilterEnabled = enabled;\n    }\n    /**\n     * Sets a regex pattern to filter log messages.\n     */\n    setLogFilterRegex(pattern) {\n        try {\n            this.logRegEx = new RegExp(pattern, 'i'); // Case-insensitive\n        }\n        catch (error) {\n            this.error('Invalid regex pattern:', false, error);\n        }\n    }\n    setStackIndex(index) {\n        if (index < 0)\n            throw new Error('Stack index must be a positive number');\n        this.stackIndex = index;\n    }\n    /**\n     * Updates the logging backend dynamically.\n     */\n    setBackend(backendType) {\n        this.backend = backendType;\n    }\n    getMinimumLogLevel() {\n        return this.minLogLevel;\n    }\n    getTimestamp() {\n        return new Date().toISOString();\n    }\n    getCallerInfo() {\n        const stack = new Error().stack;\n        if (!stack)\n            return 'Unknown Caller';\n        const stackLines = stack.split('\\n').length;\n        const adjustedIndex = Math.min(this.stackIndex, stackLines - 1) ?? this.stackIndex;\n        const callerLine = stack.split('\\n')[adjustedIndex]?.trim();\n        return callerLine || 'Unknown Caller';\n    }\n    normalizeInput(input) {\n        if (input instanceof Error) {\n            return { message: input.message, stack: input.stack };\n        }\n        else if (typeof input === 'string') {\n            return { message: input };\n        }\n        else if (input === null || input === undefined) {\n            return { message: String(input) };\n        }\n        else {\n            return { message: JSON.stringify(input, null, 2) };\n        }\n    }\n    persistLog(entry) {\n        try {\n            switch (this.backend) {\n                case 'indexedDB':\n                    this.persistLogIndexedDB(entry);\n                    break;\n                case 'dexie':\n                    this.persistLogDexie(entry);\n                    break;\n                case 'sqlite':\n                    this.persistLogSQLite(entry);\n                    break;\n                case 'background':\n                    this.persistLogBackground(entry);\n                    break;\n                case 'localStorage':\n                default:\n                    this.persistLogLocalStorage(entry);\n                    break;\n            }\n        }\n        catch (error) {\n            this.error('Failed to persist log:', false, error);\n        }\n    }\n    persistLogLocalStorage(log) {\n        try {\n            // Do not store at this time. localStorage could fail for local environment reasons.\n            return;\n            if (typeof localStorage !== 'undefined') {\n                const logs = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');\n                // Ensure args are serializable\n                if (log.args) {\n                    log.args = log.args.map((arg) => {\n                        try {\n                            // Test if the arg can be properly serialized\n                            JSON.parse(JSON.stringify(arg));\n                            return arg;\n                        }\n                        catch {\n                            // If not serializable, convert to string representation\n                            return String(arg);\n                        }\n                    });\n                }\n                logs.push(log);\n                while (logs.length > MAX_STORED_LOGS) {\n                    logs.shift();\n                }\n                localStorage.setItem(STORAGE_KEY, JSON.stringify(logs));\n            }\n        }\n        catch (error) {\n            this.error('Failed to persist to localStorage:', error);\n        }\n    }\n    persistLogIndexedDB(log) {\n        const dbPromise = openDB(STORAGE_KEY, 1, {\n            upgrade(db) {\n                if (!db.objectStoreNames.contains('logs')) {\n                    db.createObjectStore('logs', {\n                        keyPath: 'id',\n                        autoIncrement: true\n                    });\n                }\n            }\n        });\n        // Ensure args are serializable\n        if (log.args) {\n            log.args = log.args.map((arg) => {\n                try {\n                    JSON.parse(JSON.stringify(arg));\n                    return arg;\n                }\n                catch {\n                    return String(arg);\n                }\n            });\n        }\n        dbPromise.then(async (db) => {\n            const tx = db.transaction('logs', 'readwrite');\n            const store = tx.objectStore('logs');\n            await store.add(log);\n            // Keep only latest logs\n            const allLogs = await store.getAll();\n            while (allLogs.length > MAX_STORED_LOGS) {\n                await store.delete(allLogs[0].id);\n                allLogs.shift();\n            }\n            await tx.done;\n        });\n    }\n    persistLogDexie(log) {\n        const dexieDB = new Dexie(STORAGE_KEY);\n        dexieDB.version(1).stores({\n            logs: '++id, timestamp, label, message, args'\n        });\n        // Ensure args are serializable\n        if (log.args) {\n            log.args = log.args.map((arg) => {\n                try {\n                    JSON.parse(JSON.stringify(arg));\n                    return arg;\n                }\n                catch {\n                    return String(arg);\n                }\n            });\n        }\n        dexieDB.table('logs').add(log);\n        // Keep only latest logs\n        dexieDB\n            .table('logs')\n            .count()\n            .then((count) => {\n            if (count > MAX_STORED_LOGS) {\n                dexieDB\n                    .table('logs')\n                    .orderBy('id')\n                    .first((firstLog) => {\n                    if (firstLog) {\n                        dexieDB.table('logs').delete(firstLog.id);\n                    }\n                });\n            }\n        });\n    }\n    persistLogSQLite(log) {\n        // saveToSQLite(log);\n        // Keep only the latest MAX_STORED_LOGS entries\n        // const db = initSQLite();\n        // db.transaction((tx) => {\n        //   tx.executeSql(\"SELECT COUNT(*) FROM logs\", [], (tx, result) => {\n        //     const count = result.rows.item(0)[\"COUNT(*)\"];\n        //     if (count > MAX_STORED_LOGS) {\n        //       tx.executeSql(\"DELETE FROM logs WHERE id = (SELECT MIN(id) FROM logs)\");\n        //     }\n        //   });\n        //   tx.executeSql(\"INSERT INTO logs (timestamp, label, message) VALUES (?, ?, ?)\", [log.timestamp, log.label, log.message]);\n        // });\n    }\n    persistLogBackground(log) {\n        // if (!browser_ext) return;\n        // browser_ext.runtime.sendMessage({ type: \"LOG_MESSAGE\", key: STORAGE_KEY, maxStored: MAX_STORED_LOGS, log: log });\n    }\n    // Add utility methods for persistent logs\n    clearPersistedLogs() {\n        switch (this.backend) {\n            case 'indexedDB':\n                openDB(STORAGE_KEY, 1).then((db) => {\n                    db.transaction('logs', 'readwrite').objectStore('logs').clear();\n                });\n                break;\n            case 'dexie':\n                const dexieDB = new Dexie(STORAGE_KEY);\n                dexieDB.version(1).stores({ logs: '++id, message, timestamp' });\n                dexieDB.table('logs').clear();\n                break;\n            case 'sqlite':\n                //   const db = initSQLite();\n                //   db.transaction((tx) => {\n                //     tx.executeSql(\"DELETE FROM logs\");\n                //   });\n                break;\n            case 'background':\n                // if (!browser_ext) return;\n                // browser_ext.runtime.sendMessage({ type: \"CLEAR_LOGS\", key: STORAGE_KEY });\n                break;\n            case 'localStorage':\n            default:\n                localStorage.removeItem(STORAGE_KEY);\n                break;\n        }\n    }\n    getPersistedLogs() {\n        try {\n            switch (this.backend) {\n                case 'indexedDB':\n                    openDB(STORAGE_KEY, 1).then((db) => {\n                        return db.transaction('logs', 'readonly').objectStore('logs').getAll();\n                    });\n                case 'dexie':\n                    // const dexieDB = new Dexie(STORAGE_KEY);\n                    // dexieDB.version(1).stores({ logs: \"++id, message, timestamp\" });\n                    // return dexieDB.table(\"logs\").toArray();\n                    break;\n                case 'sqlite':\n                    //   const db = initSQLite();\n                    //   return new Promise((resolve, reject) => {\n                    //     db.transaction((tx) => {\n                    //       tx.executeSql(\"SELECT * FROM logs\", [], (tx, result) => {\n                    //         const logs: LogEntry[] = [];\n                    //         for (let i = 0; i < result.rows.length; i++) {\n                    //           logs.push(result.rows.item(i));\n                    //         }\n                    //         resolve(logs);\n                    //       }, (tx, error) => {\n                    //         reject(error);\n                    //       });\n                    //     });\n                    //   });\n                    break;\n                case 'background':\n                    // Send to request a background script to fetch logs by sending to a more local listener for the logs\n                    // return browser_ext.runtime.sendMessage({ type: \"GET_LOGS\", key: STORAGE_KEY });\n                    break;\n                case 'localstorage':\n                default:\n                    return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');\n            }\n        }\n        catch {\n            this.error('Failed to retrieve persisted logs');\n            return [];\n        }\n    }\n    /**\n     * Generic logging function.\n     */\n    log(level, label, color, input, includeStack = false, persist = false, ...args) {\n        try {\n            // Environment check that works in both Vite and pure TS environments\n            const isProduction = this.isProductionEnvironment();\n            // Check if we should log based on environment and level\n            if (isProduction) {\n                // In production, only log WARN and above\n                if (level < this.minLogLevel) {\n                    return;\n                }\n            }\n            // Always log to console first\n            const { message, stack } = this.normalizeInput(input);\n            const timestamp = this.getTimestamp();\n            const callerInfo = this.getCallerInfo();\n            // Force console output for debugging\n            console.log(`%c[${label}] ${timestamp}`, color, message, ...(args || []), '\\nCaller:', callerInfo, stack ? '\\nStack:' + stack : '');\n            if (persist) {\n                const entry = {\n                    timestamp,\n                    label,\n                    message,\n                    callerInfo,\n                    stack: includeStack ? stack : undefined,\n                    args\n                };\n                this.persistLog(entry);\n            }\n        }\n        catch (error) {\n            if (!this.isProductionEnvironment() || level >= LogLevel.WARN) {\n                this.error('Logging failed:', false, error);\n            }\n        }\n    }\n    isProductionEnvironment() {\n        // Check various ways to determine if we're in production\n        if (typeof __PROD__ !== 'undefined') {\n            return __PROD__;\n        }\n        // For background scripts or environments without Vite\n        if (typeof process !== 'undefined' && process.env) {\n            return process.env.NODE_ENV === 'production';\n        }\n        // Fallback for browser environments\n        if (typeof window !== 'undefined' && window.location) {\n            // You might want to adjust this based on your production URL patterns\n            return (!window.location.hostname.includes('localhost') &&\n                !window.location.hostname.includes('127.0.0.1'));\n        }\n        // Default to development if we can't determine\n        return false;\n    }\n    debug(input, persist = false, ...args) {\n        this.log(LogLevel.DEBUG, 'DEBUG', COLORS.DEBUG, input, false, persist, ...args);\n    }\n    debugStack(input, persist = false, ...args) {\n        this.log(LogLevel.DEBUG_TRACE, 'DEBUG_TRACE', COLORS.DEBUG, input, true, persist, ...args);\n    }\n    info(input, persist = false, ...args) {\n        this.log(LogLevel.INFO, 'INFO', COLORS.INFO, input, false, persist, ...args);\n    }\n    infoStack(input, persist = false, ...args) {\n        this.log(LogLevel.INFO_TRACE, 'INFO_TRACE', COLORS.INFO, input, false, persist, ...args);\n    }\n    warn(input, persist = false, ...args) {\n        this.log(LogLevel.WARN, 'WARN', COLORS.WARN, input, false, persist, ...args);\n    }\n    error(input, persist = false, ...args) {\n        this.log(LogLevel.ERROR, 'ERROR', COLORS.ERROR, input, false, persist, ...args);\n    }\n    errorStack(error, persist = false, ...args) {\n        this.log(LogLevel.ERROR_TRACE, 'ERROR_TRACE', COLORS.ERROR, false, persist, ...args);\n    }\n    trace(input, persist = false, ...args) {\n        this.log(LogLevel.TRACE, 'TRACE', COLORS.TRACE, input, false, persist, ...args);\n    }\n}\n// Singleton instance\nconst log = Logger.getInstance();\nexport { log, Logger, LogLevel, LogLevelDirection };\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { log } from '$lib/managers/Logger';\n// This script runs in a restricted environment\nwindow.addEventListener('message', (event) => {\n    if (event.origin !==\n        (process.env.DEV_MODE\n            ? import.meta.env.VITE_CHROME_DEV_ID\n            : import.meta.env.VITE_CHROME_PROD_ID)) {\n        log.info('<><><><> Sandbox - YAKKL event ignored:', event.data, event);\n        return;\n    }\n    log.info('<><><><> Sandbox - Third party event received:', event.data, event);\n});\n"],"names":["global","factory","module","exports","this","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__extends","TypeError","String","__","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","__spreadArray","to","from","pack","l","ar","slice","concat","_global","globalThis","self","window","g","keys","isArray","Promise","extend","obj","extension","forEach","key","getProto","getPrototypeOf","_hasOwn","hasOwn","prop","props","proto","Reflect","ownKeys","setProp","defineProperty","functionOrGetSet","options","get","set","configurable","value","writable","derive","Child","Parent","bind","getOwnPropertyDescriptor","getPropertyDescriptor","pd","_slice","args","start","end","override","origFunc","overridedFactory","assert","Error","asap$1","fn","setImmediate","setTimeout","arrayToObject","array","extractor","reduce","result","item","nameAndValue","getByKeyPath","keyPath","rv","val","push","period","indexOf","innerObj","substr","undefined","setByKeyPath","isFrozen","currentKeyPath","remainingKeyPath","isNaN","parseInt","splice","delByKeyPath","map","kp","shallowClone","m","flatten","a","intrinsicTypeNames","split","num","filter","intrinsicTypes","Set","cloneSimpleObjectTree","o","k","v","has","objectIsEmpty","circularRefs","deepClone","any","WeakMap","innerDeepClone","x","toString","toStringTag","iteratorSymbol","Symbol","iterator","getIteratorOf","delArrayItem","NO_CHAR_ARRAY","getArrayOf","arrayLike","it","next","done","isAsyncFunction","dexieErrorNames","idbDomErrorNames","errorList","defaultTexts","VersionChanged","DatabaseClosed","Abort","TransactionInactive","MissingAPI","DexieError","name","msg","message","getMultiErrorMessage","failures","join","ModifyError","successCount","failedKeys","BulkError","pos","failuresByPos","errnames","BaseException","exceptions","fullName","msgOrInner","inner","Syntax","SyntaxError","Type","Range","RangeError","exceptionMap","mapError","domError","stack","fullNameExceptions","nop","mirror","pureFunctionChain","f1","f2","callBoth","on1","on2","hookCreatingChain","res","onsuccess","onerror","res2","hookDeletingChain","hookUpdatingChain","modifications","reverseStoppableEventChain","promisableChain","then","thiz","debug","location","test","href","setDebug","INTERNAL","ZONE_ECHO_LIMIT","_a$1","globalP","resolve","crypto","subtle","nativeP","digest","Uint8Array","resolvedNativePromise","nativePromiseProto","resolvedGlobalPromise","nativePromiseThen","NativePromise","patchGlobalPromise","schedulePhysicalTick","queueMicrotask","physicalTick","asap","callback","microtickQueue","needsNewPhysicalTick","isOutsideMicroTick","unhandledErrors","rejectingErrors","rejectionMapper","globalPSD","id","ref","unhandleds","onunhandled","pgp","env","finalize","PSD","numScheduledCalls","tickFinalizers","DexiePromise","_listeners","_lib","psd","_PSD","_state","_value","handleRejection","executePromiseTask","thenProp","microTaskId","totalEchoes","onFulfilled","onRejected","_this","possibleAwait","cleanup","decrementExpectedAwaits","reject","propagateToListener","Listener","nativeAwaitCompatibleWrap","_consoleTask","_then","catch","type","handler","err","PromiseReject","finally","onFinally","timeout","ms","Infinity","handle","Timeout","clearTimeout","snapShot","zone","all","values","onPossibleParallellAsync","remaining","race","newPSD","newScope","usePSD","scheduler","follow","zoneProps","run_at_end_of_this_or_next_physical_tick","allSettled","possiblePromises","results","status","reason","AggregateError","failure","withResolvers","promise","shouldExecuteTick","beginMicroTickScope","propagateAllListeners","endMicroTickScope","ex","addPossiblyUnhandledError","listeners","len","finalizePhysicalTick","listener","cb","callListener","ret","run","markErrorAsHandled","e","wasRootExec","callbacks","unhandledErrs","finalizers","finalizer","some","wrap","errorCatcher","outerScope","switchToZone","task","awaits","echoes","taskCounter","zoneStack","zoneEchoes","zone_id_counter","a1","a2","parent","PromiseProp","incrementExpectedAwaits","possiblePromise","rejection","zoneEnterEcho","targetZone","zoneLeaveEcho","pop","bEnteringZone","currentZone","GlobalPromise","targetEnv","a3","outerZone","execInGlobalContext","enqueueNativeMicroTask","tempTransaction","db","mode","storeNames","idbdb","openComplete","letThrough","_vip","dbOpenError","isBeingOpened","autoOpen","open","dbReadyPromise","trans","_createTransaction","_dbSchema","PR1398_maxLoop","InvalidState","isOpen","console","warn","close","disableAutoOpen","_promise","idbtrans","commit","_a","_completion","DEXIE_VERSION","maxString","fromCharCode","minKey","INVALID_KEY_ARGUMENT","STRING_EXPECTED","connections","DBNAMES_DB","READONLY","READWRITE","combine","filter1","filter2","AnyRange","lower","lowerOpen","upper","upperOpen","workaroundForUndefinedPrimKey","Entity","cmp","ta","tb","NaN","compareUint8Arrays","getUint8Array","compareArrays","al","bl","ArrayBuffer","isView","tsTag","buffer","byteOffset","byteLength","Table","_trans","writeLocked","_tx","tableName","createTask","checkTableInTransaction","schema","NotFound","_novip","transless","trace","keyOrCrit","where","first","core","hook","reading","fire","indexOrCrit","WhereClause","keyPaths","equals","compoundIndex","indexes","primKey","ix","compound","every","sort","_maxKey","keyPathsInValidOrder","JSON","stringify","idxByName","prevIndex","prevFilterFn","index","multi","idx","filterFunction","toCollection","and","count","thenShortcut","offset","limit","numRows","each","toArray","Collection","orderBy","reverse","mapToClass","mappedClass","_super","class_1","enumerable","table","inheritedProps","getOwnPropertyNames","propName","add","readHook","_","unsubscribe","defineClass","Class","content","auto","objToAdd","mutate","numFailures","lastResult","update","keyOrObject","InvalidArgument","modify","put","delete","clear","range","bulkGet","getMany","bulkAdd","objects","keysOrOptions","wantResults","allKeys","numObjects","objectsToAdd","bulkPut","objectsToPut","bulkUpdate","keysAndChanges","coreTable","entry","changeSpecs","changes","offsetMap","cache","objs","resultKeys","resultObjs","_i","_b","Constraint","numEntries","updates","mappedOffset","Number","bulkDelete","numKeys","Events","ctx","evs","eventName","subscriber","subscribe","addEventType","chainFunction","defaultFunction","addConfiguredEvents","context","subscribers","cfg","fireEvent","makeClassConstructor","createTableConstructor","tableSchema","_allTables","isPlainKeyRange","ignoreLimitFilter","algorithm","or","justLimit","replayFilter","addFilter","addReplayFilter","isLimitFilter","curr","addMatchFilter","isMatch","getIndexOrStore","coreSchema","isPrimKey","primaryKey","getIndexByKeyPath","Schema","openCursor","keysOnly","dir","unique","query","iter","coreTrans","iterate","valueMapper","set_1","union","cursor","advance","stop","fail","_iterate","cursorPromise","mappedFn","c","wrappedFn","continue","advancer","PropModification","spec","execute","term","BigInt","remove","subtrahend_1","includes","_c","prefixToReplace","replacePrefix","startsWith","substring","_read","_ctx","error","_write","_addAlgorithm","clone","raw","Math","min","sortBy","parts","lastPart","lastIndex","getval","order","sorter","aVal","bVal","valueMapper_1","a_1","offsetLeft","rowsLeft","until","bIncludeStopEntry","last","indexName","_ondirectionchange","desc","eachKey","eachUniqueKey","eachPrimaryKey","primaryKeys","uniqueKeys","firstKey","lastKey","distinct","strKey","found","modifyer","anythingModified","origVal","outbound","extractKey","modifyChunkSize","_options","totalFailures","applyMutateResult","expectedCount","criteria","deleteCallback","nextChunk","addValues","putValues","putKeys","deleteKeys","origValue","ctx_1","changeSpec","isAdditionalChunk","coreRange","createCollectionConstructor","whereClause","keyRangeGenerator","keyRange","whereCtx","readingHook","simpleCompare","simpleCompareReverse","collectionOrWhereClause","T","collection","emptyCollection","rangeEqual","upperFactory","toUpperCase","toLowerCase","lowerFactory","nextCasing","lowerKey","upperNeedle","lowerNeedle","llp","lwrKeyChar","addIgnoreCaseAlgorithm","match","needles","suffix","compare","upperNeedles","lowerNeedles","direction","nextKeySuffix","needlesLen","initDirection","needleBounds","needle","nb","createRange","firstPossibleNeedle","lowestPossibleCasing","casing","between","includeLower","includeUpper","_cmp","above","aboveOrEqual","below","belowOrEqual","str","startsWithIgnoreCase","equalsIgnoreCase","anyOfIgnoreCase","startsWithAnyOfIgnoreCase","anyOf","_ascending","_descending","notEqual","inAnyRange","includeLowers","includeUppers","noneOf","ranges","ascending","descending","_min","max","_max","addRange","newRange","sortDirection","rangeSorter","rangePos","keyIsBeyondCurrentEntry","keyIsBeforeCurrentEntry","keyWithinCurrentRange","checkKey","startsWithAnyOf","createWhereClauseConstructor","orCollection","_IDBKeyRange","_deps","IDBKeyRange","eventRejectHandler","event","preventDefault","target","stopPropagation","DEXIE_STORAGE_MUTATED_EVENT_NAME","STORAGE_MUTATED_DOM_EVENT_NAME","globalEvents","Transaction","_lock","_reculock","lockOwnerFor","_unlock","_blockedFuncs","_locked","fnAndPSD","shift","OpenFailed","active","transaction","durability","chromeTransactionDurability","ev","_reject","onabort","on","oncomplete","_resolve","storagemutated","bWriteLock","ReadOnly","_root","waitFor","promiseLike","root","_waitingFor","_waitingQueue","store","objectStore","spin","_spinCount","currentWaitPromise","abort","memoizedTables","_memoizedTables","transactionBoundTable","createTransactionConstructor","dbschema","complete","wasActive","createIndexSpec","src","nameFromKeyPath","createTableSchema","safariMultiStoreFix","getMaxKey","IdbKeyRange","only","getKeyExtractor","getSinglePathKeyExtractor","arrayify","_id_counter","getKeyPathAlias","createDBCore","tmpTrans","extractSchema","tables","objectStoreNames","autoIncrement","indexByKeyPath","isPrimaryKey","indexNames","multiEntry","hasGetAll","navigator","userAgent","makeIDBKeyRange","idbRange","upperBound","lowerBound","bound","createDbCoreTable","isAddOrPut","req","reqs","errorHandler","args1","args2","source","openKeyCursor","___id","_cursorContinue","_cursorContinuePrimaryKey","continuePrimaryKey","_cursorAdvance","doThrowCursorIsNotStarted","doThrowCursorIsStopped","gotOne","iterationPromise","resolveIteration","rejectIteration","guardedCallback","request","nonInfinitLimit","idbKeyRange","getAll","getAllKeys","count_1","req_1","result_1","keyCount","callbackCount","successHandler","_pos","tableMap","MIN_KEY","MAX_KEY","createMiddlewareStack","stackImpl","middlewares","down","createMiddlewareStacks","indexedDB","dbcore","generateMiddlewareStacks","stacks","_middlewares","tbl","setApiOnPlace","tableNames","propDesc","removeTablesApi","lowerVersionFirst","_cfg","version","runUpgraders","oldVersion","idbUpgradeTrans","globalSchema","contains","$meta","parseIndexSyntax","_storeNames","rejectTransaction","createTable","populate","getExistingVersion","updateTablesAndIndexes","patchCurrentVersion","createMissingTables","createObjectStore","ceil","buildGlobalSchema","adjustToExistingIndexNames","diff","getSchemaDiff","_loop_1","tableChange","change","recreate","addIndex","state_1","metaVersion","queue","versions","_versions","versToRun","oldSchema","newSchema","tuple","Upgrade","store_1","deleteIndex","del","idxName","contentUpgrade","upgradeSchema_1","contentUpgradeIsAsync_1","returnValue_1","promiseFollowed","decrementor","deleteRemovedTables","deleteObjectStore","runQueue","oldDef","newDef","def","oldIndexes","newIndexes","oldIdx","newIdx","storeName","createIndex","dbStoreNames","j","idbindex","readGlobalSchema","verno","verifyInstalledSchema","installedSchema","ch","_hasGetAll","dexieName","indexSpec","WorkerGlobalScope","primKeyAndIndexes","indexNum","trim","replace","Version","_parseStoresSpec","stores","outSchema","storesSource","storesSpec","upgrade","upgradeFunction","createVersionConstructor","versionNumber","getDbNamesTable","dbNamesDB","Dexie$1","addons","dbnames","hasDatabasesNative","databases","getDatabaseNames","infos","info","_onDatabaseCreated","_onDatabaseDeleted","vip","idbReady","isSafari","userAgentData","intervalId","tryIdb","setInterval","clearInterval","isEmptyRange","node","RangeSet","fromOrTree","rangeSet","mergeRanges","addKey","addKeys","hasKey","getRangeSetIterator","left","right","r","rebalance","rightWasCutOff","newSet","_addRangeSet","rangesOverlap","rangeSet1","rangeSet2","i1","nextResult1","i2","nextResult2","state","keyProvided","up","rootClone","oldRootRight","computeDepth","extendObservabilitySet","part","obsSetsOverlap","os1","os2","unsignaledParts","isTaskEnqueued","signalSubscribersLazily","optimistic","signalSubscribersNow","updatedParts","deleteAffectedCacheEntries","queriesToSignal","tblCache","collectTableSubscribers","exec","dbName","requery","outQueriesToSignal","updatedEntryLists","entries","queries","filteredEntries","entries_1","obsSet","_d","updatedEntryLists_1","_e","dexieOpen","openCanceller","nativeVerToOpen","round","schemaPatchMode","throwIfCancelled","resolveDbReady","dbReadyResolve","upgradeTransaction","wasCreated","tryOpenDB","autoSchema","onblocked","_fireOnBlocked","onupgradeneeded","allowEmptyDB","delreq","deleteDatabase","NoSuchDatabase","oldVer","pow","onversionchange","vcFired","onclose","onReadyBeingFired","ready","fireRemainders","remainders_1","_close","everything_1","awaitIterator","callNext","doThrow","throw","onSuccess","step","onError","getNext","extractTransactionArgs","_tableArgs_","scopeFunc","enterTransactionScope","parentTransaction","explicit","_explicit","scopeFuncIsAsync","returnValue","PrematureCommit","pad","createVirtualIndexMiddleware","indexLookup","allVirtualIndexes","addVirtualIndexes","keyTail","lowLevelIndex","keyPathAlias","indexList","keyLength","isVirtual","virtualIndex","virtualKeyPath","findBestIndex","translateRange","translateRequest","createVirtualCursor","_continue","virtualCursor","virtualIndexMiddleware","level","getObjectDiff","prfx","ap","bp","apTypeName","bpTypeName","getEffectiveKeys","hooksMiddleware","downCore","downTable","tableMiddleware","dxTrans","deleting","creating","updating","addPutOrDelete","deleteRange","getExistingValues","existingValues","contexts","existingValue","generatedPrimaryKey","objectDiff","additionalChanges_1","requestedValue_1","deleteNextChunk","effectiveKeys","getFromTransactionCache","cacheExistingValuesMiddleware","cachedResult","isCachableContext","subscr","isCachableRequest","observabilityMiddleware","FULL_RANGE","querier","indexesWithAutoIncPK","tableClone","mutatedParts","getRangeSet","pkRangeSet","delsRangeSet","newObjs","oldCache","oldObjs","trackAffectedIndexes","idxVals","pkPos","findIndex","getRange","readSubscribers","method","isLiveQuery","cachable","pkRangeSet_1","delsRangeSet_1","queriedIndex","queriedRanges","keysPromise_1","resultingKeys","pKeys","cursor_1","wantValues_1","pkey","addAffectedIndex","addKeyOrKeys","oldKey","newKey","adjustOptimisticFromFailures","numBulkOps","isAboveLower","isBelowUpper","isWithinRange","applyOptimisticOps","ops","cacheEntry","immutable","queryRange","extractPrimKey","extractIndex","extractLowLevelIndex","finalResult","op","modifedResult","includedValues","includedPKs","pk","existingKeys_1","keySet_1","keysToDelete_1","range_1","dirty","freeze","areRangesEqual","r1","r2","compareLowers","lower1","lower2","lowerOpen1","lowerOpen2","compareUppers","upper1","upper2","upperOpen1","upperOpen2","isSuperRange","findCompatibleQuery","equalEntry","find","superEntry","countQuery","subscribeToCacheEntry","container","signal","addEventListener","size","enqueForDeletion","cacheMiddleware","coreMW","ac_1","AbortController","endTransaction","wasCommitted","affectedSubscribers_1","stores_1","optimisticOps","_f","_g","_h","freezeResults","modRes","tableMW","reqWithResolvedKeys","valueWithKey","adjustedReq","exactMatch","Map","vipify","vipDb","Proxy","receiver","Dexie","deps","dependencies","cancelOpen","bSticky","db_1","newVersion","use","vipDB","tx","addon","versionInstance","_whenReady","unuse","mw","closeOptions","hasInvalidArguments","doDelete","backendDB","hasBeenClosed","hasFailed","dynamicallyOpened","_transaction","onlyIfCompatible","idbMode","SubTransaction","enterTransaction","InvalidTable","symbolObservable","observable","Observable","_subscribe","domDeps","mozIndexedDB","webkitIndexedDB","msIndexedDB","webkitIDBKeyRange","liveQuery","hasValue","currentValue","observer","closed","abortController","accumMuts","currentObs","subscription","startedListening","mutationListener","doQuery","_doQuery","shouldNotify","aborted","getValue","databaseName","exists","ignoreTransaction","async","generatorFn","spawn","currentTransaction","promiseOrFunction","optionalTimeout","semVer","maxKey","dispatchEvent","propagatingLocally","event_1","CustomEvent","detail","propagateLocally","updateParts","wasMe","bc","createBC","BroadcastChannel","onmessage","data","unref","changedParts","postMessage","disableBfCache","persisted","connections_1","namedExports","default","DexieSymbol","for","instanceOfAny","object","constructors","idbProxyableTypes","cursorAdvanceMethods","getIdbProxyableTypes","IDBDatabase","IDBObjectStore","IDBIndex","IDBCursor","IDBTransaction","getCursorAdvanceMethods","transactionDoneMap","transformCache","reverseTransformCache","promisifyRequest","unlisten","removeEventListener","success","cacheDonePromiseForTransaction","DOMException","idbProxyTraps","replaceTraps","wrapFunction","func","unwrap","transformCachableValue","IDBRequest","newValue","openDB","blocked","blocking","terminated","openPromise","deleteDB","readMethods","writeMethods","cachedMethods","getMethod","targetFuncName","useIndex","isWrite","oldTraps","advanceMethodProps","methodMap","advanceResults","ittrProxiedCursorToOriginalProxy","cursorIteratorTraps","cachedFunc","proxiedCursor","isIteratorProp","asyncIterator","ApiError","statusCode","details","super","LoggerError","isBrowser","LogLevel","LogLevelDirection","COLORS","DEBUG","DEBUG_TRACE","INFO","INFO_TRACE","WARN","ERROR","ERROR_TRACE","TRACE","MAX_STORED_LOGS","STORAGE_KEY","Logger","static","logLevel","logLevelDirection","logsIncluded","logRegEx","logFilterEnabled","stackIndex","backend","minLogLevel","LESSTHAN","getInstance","instance","setMinimumLogLevel","setLevel","setLogFilterEnabled","enabled","setLogFilterRegex","pattern","RegExp","setStackIndex","setBackend","backendType","getMinimumLogLevel","getTimestamp","Date","toISOString","getCallerInfo","stackLines","adjustedIndex","callerLine","normalizeInput","input","persistLog","persistLogIndexedDB","persistLogDexie","persistLogSQLite","persistLogBackground","persistLogLocalStorage","log","dbPromise","arg","parse","allLogs","dexieDB","logs","firstLog","clearPersistedLogs","localStorage","removeItem","getPersistedLogs","getItem","label","color","includeStack","persist","isProduction","isProductionEnvironment","timestamp","callerInfo","debugStack","infoStack","errorStack","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","definition","Function","origin"],"sourceRoot":""}